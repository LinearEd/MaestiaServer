PROGRAM  : Maestia.exe
FUNCTION : FUN_006bcaf0
ENTRY    : 006bcaf0
BODY     : [[006bcaf0, 006bcda5]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006bcaf0(void)

{
  char *pcVar1;
  int *piVar2;
  undefined4 uVar3;
  char *pcVar4;
  bool bVar5;
  undefined2 *puVar6;
  int in_EAX;
  int iVar7;
  undefined4 uVar8;
  short *psVar9;
  undefined4 *in_ECX;
  int iVar10;
  undefined1 *puVar11;
  int iVar12;
  undefined1 *puVar13;
  byte *pbVar14;
  char *pcVar15;
  undefined1 *puVar16;
  int iVar17;
  undefined4 uVar18;
  int local_18;
  int local_14;
  undefined2 *local_4;
  
  piVar2 = in_ECX + in_EAX * 7 + 0xc;
  uVar3 = *in_ECX;
  iVar7 = in_ECX[0x1c];
  iVar17 = *piVar2;
  pcVar4 = (char *)piVar2[2];
  piVar2[3] = 0;
  if (in_EAX == 0) {
    uVar18 = in_ECX[1];
    local_14 = FUN_00685f30(0x40,in_ECX[3]);
  }
  else {
    uVar18 = in_ECX[3];
    local_14 = 0;
  }
  iVar7 = FUN_00685ea0(*(undefined4 *)(in_EAX * 0x18c + iVar7 + 0xf0),uVar18);
  if (0x10 < iVar7) {
    iVar7 = 0x10;
  }
  iVar7 = FUN_00685f30(iVar7,uVar18);
  if (pcVar4 < pcVar4 + iVar17 * 0x34) {
    pcVar15 = pcVar4 + 1;
    do {
      if ((local_14 <= *(short *)(pcVar15 + 7)) &&
         ((*(int *)(pcVar15 + 0x17) == 0 || (local_14 * 3 <= *(short *)(pcVar15 + 7) * 2)))) {
        iVar12 = 0;
        if (0 < piVar2[3]) {
          psVar9 = (short *)piVar2[5];
          do {
            iVar10 = (int)*(short *)(pcVar15 + 1) - (int)*psVar9;
            if (iVar10 < 0) {
              iVar10 = -iVar10;
            }
            if ((iVar10 < iVar7) && (*(char *)((int)psVar9 + 0xd) == *pcVar15)) {
              *(undefined4 *)(pcVar15 + 0xf) = *(undefined4 *)(psVar9 + 0x14);
              *(char **)(*(int *)(psVar9 + 0x16) + 0x10) = pcVar15 + -1;
              *(char **)(psVar9 + 0x16) = pcVar15 + -1;
              goto LAB_006bcc5c;
            }
            iVar12 = iVar12 + 1;
            psVar9 = psVar9 + 0x18;
          } while (iVar12 < piVar2[3]);
        }
        iVar12 = FUN_006bb5c0((int)*(short *)(pcVar15 + 1),(int)*pcVar15,uVar3,&local_4);
        puVar6 = local_4;
        if (iVar12 != 0) {
          return iVar12;
        }
        _memset(local_4,0,0x30);
        pcVar1 = pcVar15 + -1;
        *(char **)(puVar6 + 0x14) = pcVar1;
        *(char **)(puVar6 + 0x16) = pcVar1;
        *puVar6 = *(undefined2 *)(pcVar15 + 1);
        *(char *)((int)puVar6 + 0xd) = *pcVar15;
        uVar8 = FUN_00685ea0((int)*(short *)(pcVar15 + 1),uVar18);
        *(undefined4 *)(puVar6 + 4) = uVar8;
        *(undefined4 *)(puVar6 + 2) = uVar8;
        *(char **)(pcVar15 + 0xf) = pcVar1;
      }
LAB_006bcc5c:
      pcVar1 = pcVar15 + 0x33;
      pcVar15 = pcVar15 + 0x34;
    } while (pcVar1 < pcVar4 + iVar17 * 0x34);
  }
  puVar11 = (undefined1 *)piVar2[5];
  puVar16 = puVar11 + piVar2[3] * 0x30;
  puVar13 = puVar11;
  if (puVar11 < puVar16) {
    do {
      iVar7 = *(int *)(puVar13 + 0x28);
      if (iVar7 != 0) {
        do {
          *(undefined1 **)(iVar7 + 0xc) = puVar13;
          iVar7 = *(int *)(iVar7 + 0x10);
        } while (iVar7 != *(int *)(puVar13 + 0x28));
      }
      puVar13 = puVar13 + 0x30;
    } while (puVar13 < puVar16);
    if (puVar11 < puVar16) {
      puVar11 = puVar11 + 0xc;
      do {
        pbVar14 = *(byte **)(puVar11 + 0x1c);
        local_18 = 0;
        local_14 = 0;
        do {
          if ((*pbVar14 & 1) == 0) {
            local_14 = local_14 + 1;
          }
          else {
            local_18 = local_18 + 1;
          }
          iVar7 = *(int *)(pbVar14 + 0x18);
          if (((iVar7 == 0) || (*(undefined1 **)(iVar7 + 0xc) == (undefined1 *)0x0)) ||
             (*(undefined1 **)(iVar7 + 0xc) == puVar11 + -0xc)) {
            bVar5 = false;
          }
          else {
            bVar5 = true;
          }
          iVar17 = *(int *)(pbVar14 + 0x14);
          if (((iVar17 != 0) && (*(int *)(iVar17 + 0xc) != 0)) || (bVar5)) {
            psVar9 = *(short **)(puVar11 + 0xc);
            if (bVar5) {
              psVar9 = *(short **)(puVar11 + 0x10);
              iVar17 = iVar7;
            }
            if (psVar9 == (short *)0x0) {
LAB_006bcd3e:
              psVar9 = *(short **)(iVar17 + 0xc);
            }
            else {
              iVar7 = (int)*(short *)(puVar11 + -0xc) - (int)*psVar9;
              if (iVar7 < 0) {
                iVar7 = -iVar7;
              }
              iVar12 = (int)*(short *)(pbVar14 + 2) - (int)*(short *)(iVar17 + 2);
              if (iVar12 < 0) {
                iVar12 = -iVar12;
              }
              if (iVar12 < iVar7) goto LAB_006bcd3e;
            }
            if (bVar5) {
              *(short **)(puVar11 + 0x10) = psVar9;
              *(byte *)(psVar9 + 6) = *(byte *)(psVar9 + 6) | 2;
            }
            else {
              *(short **)(puVar11 + 0xc) = psVar9;
            }
          }
          pbVar14 = *(byte **)(pbVar14 + 0x10);
        } while (pbVar14 != *(byte **)(puVar11 + 0x1c));
        *puVar11 = 0;
        if ((0 < local_18) && (local_14 <= local_18)) {
          *puVar11 = 1;
        }
        if ((*(int *)(puVar11 + 0x10) != 0) && (*(int *)(puVar11 + 0xc) != 0)) {
          *(undefined4 *)(puVar11 + 0x10) = 0;
        }
        puVar13 = puVar11 + 0x24;
        puVar11 = puVar11 + 0x30;
      } while (puVar13 < puVar16);
    }
  }
  return 0;
}



============================================================
DISASSEMBLY
============================================================
006bcaf0 : SUB ESP,0x1c
006bcaf3 : PUSH EBX
006bcaf4 : LEA EDX,[EAX*0x8 + 0x0]
006bcafb : SUB EDX,EAX
006bcafd : PUSH EBP
006bcafe : LEA EBP,[ECX + EDX*0x4 + 0x30]
006bcb02 : MOV EDX,dword ptr [ECX]
006bcb04 : MOV dword ptr [ESP + 0x1c],EDX
006bcb08 : MOV EDX,EAX
006bcb0a : IMUL EDX,EDX,0x18c
006bcb10 : PUSH ESI
006bcb11 : MOV ESI,dword ptr [ECX + 0x70]
006bcb14 : LEA EBX,[EDX + ESI*0x1 + 0x24]
006bcb18 : MOV EDX,dword ptr [EBP]
006bcb1b : MOV ESI,dword ptr [EBP + 0x8]
006bcb1e : IMUL EDX,EDX,0x34
006bcb21 : PUSH EDI
006bcb22 : XOR EDI,EDI
006bcb24 : ADD EDX,ESI
006bcb26 : MOV dword ptr [ESP + 0x1c],EDI
006bcb2a : MOV dword ptr [ESP + 0x14],EDX
006bcb2e : MOV dword ptr [EBP + 0xc],EDI
006bcb31 : CMP EAX,EDI
006bcb33 : JNZ 0x006bcb50
006bcb35 : MOV EDI,dword ptr [ECX + 0x4]
006bcb38 : MOV ECX,dword ptr [ECX + 0xc]
006bcb3b : PUSH ECX
006bcb3c : PUSH 0x40
006bcb3e : MOV dword ptr [ESP + 0x18],EDI
006bcb42 : CALL 0x00685f30
006bcb47 : ADD ESP,0x8
006bcb4a : MOV dword ptr [ESP + 0x18],EAX
006bcb4e : JMP 0x006bcb5d
006bcb50 : MOV EAX,dword ptr [ECX + 0xc]
006bcb53 : MOV dword ptr [ESP + 0x18],EDI
006bcb57 : MOV dword ptr [ESP + 0x10],EAX
006bcb5b : MOV EDI,EAX
006bcb5d : MOV EDX,dword ptr [EBX + 0xcc]
006bcb63 : PUSH EDI
006bcb64 : PUSH EDX
006bcb65 : CALL 0x00685ea0
006bcb6a : ADD ESP,0x8
006bcb6d : CMP EAX,0x10
006bcb70 : JLE 0x006bcb77
006bcb72 : MOV EAX,0x10
006bcb77 : PUSH EDI
006bcb78 : PUSH EAX
006bcb79 : CALL 0x00685f30
006bcb7e : ADD ESP,0x8
006bcb81 : MOV dword ptr [ESP + 0x20],EAX
006bcb85 : CMP ESI,dword ptr [ESP + 0x14]
006bcb89 : JNC 0x006bcc6c
006bcb8f : INC ESI
006bcb90 : MOVSX EAX,word ptr [ESI + 0x7]
006bcb94 : MOV ECX,dword ptr [ESP + 0x18]
006bcb98 : CMP EAX,ECX
006bcb9a : JL 0x006bcc5c
006bcba0 : CMP dword ptr [ESI + 0x17],0x0
006bcba4 : JZ 0x006bcbb3
006bcba6 : ADD EAX,EAX
006bcba8 : LEA ECX,[ECX + ECX*0x2]
006bcbab : CMP EAX,ECX
006bcbad : JL 0x006bcc5c
006bcbb3 : XOR EDX,EDX
006bcbb5 : CMP dword ptr [EBP + 0xc],EDX
006bcbb8 : JLE 0x006bcbe2
006bcbba : MOVSX EDI,word ptr [ESI + 0x1]
006bcbbe : MOV EAX,dword ptr [EBP + 0x14]
006bcbc1 : MOVSX EBX,word ptr [EAX]
006bcbc4 : MOV ECX,EDI
006bcbc6 : SUB ECX,EBX
006bcbc8 : JNS 0x006bcbcc
006bcbca : NEG ECX
006bcbcc : CMP ECX,dword ptr [ESP + 0x20]
006bcbd0 : JGE 0x006bcbd9
006bcbd2 : MOV CL,byte ptr [EAX + 0xd]
006bcbd5 : CMP CL,byte ptr [ESI]
006bcbd7 : JZ 0x006bcc4a
006bcbd9 : INC EDX
006bcbda : ADD EAX,0x30
006bcbdd : CMP EDX,dword ptr [EBP + 0xc]
006bcbe0 : JL 0x006bcbc1
006bcbe2 : MOV EAX,dword ptr [ESP + 0x24]
006bcbe6 : MOVSX ECX,byte ptr [ESI]
006bcbe9 : LEA EDX,[ESP + 0x28]
006bcbed : PUSH EDX
006bcbee : MOVSX EDX,word ptr [ESI + 0x1]
006bcbf2 : PUSH EAX
006bcbf3 : PUSH ECX
006bcbf4 : PUSH EDX
006bcbf5 : MOV EBX,EBP
006bcbf7 : CALL 0x006bb5c0
006bcbfc : ADD ESP,0x10
006bcbff : MOV dword ptr [ESP + 0x1c],EAX
006bcc03 : TEST EAX,EAX
006bcc05 : JNZ 0x006bcd9e
006bcc0b : MOV EDI,dword ptr [ESP + 0x28]
006bcc0f : PUSH 0x30
006bcc11 : PUSH EAX
006bcc12 : PUSH EDI
006bcc13 : CALL 0x0063b700
006bcc18 : MOV EDX,dword ptr [ESP + 0x1c]
006bcc1c : LEA EBX,[ESI + -0x1]
006bcc1f : MOV dword ptr [EDI + 0x28],EBX
006bcc22 : MOV dword ptr [EDI + 0x2c],EBX
006bcc25 : MOV AX,word ptr [ESI + 0x1]
006bcc29 : MOV word ptr [EDI],AX
006bcc2c : MOV CL,byte ptr [ESI]
006bcc2e : MOV byte ptr [EDI + 0xd],CL
006bcc31 : MOVSX EAX,word ptr [ESI + 0x1]
006bcc35 : PUSH EDX
006bcc36 : PUSH EAX
006bcc37 : CALL 0x00685ea0
006bcc3c : MOV dword ptr [EDI + 0x8],EAX
006bcc3f : MOV dword ptr [EDI + 0x4],EAX
006bcc42 : ADD ESP,0x14
006bcc45 : MOV dword ptr [ESI + 0xf],EBX
006bcc48 : JMP 0x006bcc5c
006bcc4a : MOV ECX,dword ptr [EAX + 0x28]
006bcc4d : MOV dword ptr [ESI + 0xf],ECX
006bcc50 : MOV EDX,dword ptr [EAX + 0x2c]
006bcc53 : LEA ECX,[ESI + -0x1]
006bcc56 : MOV dword ptr [EDX + 0x10],ECX
006bcc59 : MOV dword ptr [EAX + 0x2c],ECX
006bcc5c : ADD ESI,0x34
006bcc5f : LEA EAX,[ESI + -0x1]
006bcc62 : CMP EAX,dword ptr [ESP + 0x14]
006bcc66 : JC 0x006bcb90
006bcc6c : MOV ECX,dword ptr [EBP + 0x14]
006bcc6f : MOV EBP,dword ptr [EBP + 0xc]
006bcc72 : LEA ESI,[EBP + EBP*0x2]
006bcc76 : SHL ESI,0x4
006bcc79 : ADD ESI,ECX
006bcc7b : MOV dword ptr [ESP + 0x20],ESI
006bcc7f : MOV EDX,ECX
006bcc81 : CMP ECX,ESI
006bcc83 : JNC 0x006bcd9a
006bcc89 : LEA ESP,[ESP]
006bcc90 : MOV EAX,dword ptr [EDX + 0x28]
006bcc93 : TEST EAX,EAX
006bcc95 : JZ 0x006bcca2
006bcc97 : MOV dword ptr [EAX + 0xc],EDX
006bcc9a : MOV EAX,dword ptr [EAX + 0x10]
006bcc9d : CMP EAX,dword ptr [EDX + 0x28]
006bcca0 : JNZ 0x006bcc97
006bcca2 : ADD EDX,0x30
006bcca5 : CMP EDX,ESI
006bcca7 : JC 0x006bcc90
006bcca9 : CMP ECX,ESI
006bccab : JNC 0x006bcd9a
006bccb1 : ADD ECX,0xc
006bccb4 : MOV EBP,dword ptr [ECX + 0x1c]
006bccb7 : XOR EAX,EAX
006bccb9 : MOV dword ptr [ESP + 0x14],EAX
006bccbd : MOV dword ptr [ESP + 0x18],EAX
006bccc1 : MOV dword ptr [ESP + 0x10],EBP
006bccc5 : TEST byte ptr [EBP],0x1
006bccc9 : JZ 0x006bccd1
006bcccb : INC dword ptr [ESP + 0x14]
006bcccf : JMP 0x006bccd5
006bccd1 : INC dword ptr [ESP + 0x18]
006bccd5 : MOV EDI,dword ptr [EBP + 0x18]
006bccd8 : TEST EDI,EDI
006bccda : JZ 0x006bccee
006bccdc : MOV EAX,dword ptr [EDI + 0xc]
006bccdf : TEST EAX,EAX
006bcce1 : JZ 0x006bccee
006bcce3 : LEA EDX,[ECX + -0xc]
006bcce6 : CMP EAX,EDX
006bcce8 : JZ 0x006bccee
006bccea : MOV BL,0x1
006bccec : JMP 0x006bccf0
006bccee : XOR BL,BL
006bccf0 : MOV EDX,dword ptr [EBP + 0x14]
006bccf3 : TEST EDX,EDX
006bccf5 : JZ 0x006bccfd
006bccf7 : CMP dword ptr [EDX + 0xc],0x0
006bccfb : JNZ 0x006bcd01
006bccfd : TEST BL,BL
006bccff : JZ 0x006bcd55
006bcd01 : MOV EAX,dword ptr [ECX + 0xc]
006bcd04 : MOV ESI,EDX
006bcd06 : TEST BL,BL
006bcd08 : JZ 0x006bcd0f
006bcd0a : MOV EAX,dword ptr [ECX + 0x10]
006bcd0d : MOV ESI,EDI
006bcd0f : TEST EAX,EAX
006bcd11 : JZ 0x006bcd3e
006bcd13 : MOVSX EDI,word ptr [ECX + -0xc]
006bcd17 : MOVSX EDX,word ptr [EAX]
006bcd1a : SUB EDI,EDX
006bcd1c : JNS 0x006bcd20
006bcd1e : NEG EDI
006bcd20 : MOVSX EDX,word ptr [ESI + 0x2]
006bcd24 : MOV dword ptr [ESP + 0x28],EDX
006bcd28 : MOVSX EDX,word ptr [EBP + 0x2]
006bcd2c : MOV EBP,dword ptr [ESP + 0x28]
006bcd30 : SUB EDX,EBP
006bcd32 : JNS 0x006bcd36
006bcd34 : NEG EDX
006bcd36 : CMP EDX,EDI
006bcd38 : MOV EBP,dword ptr [ESP + 0x10]
006bcd3c : JGE 0x006bcd41
006bcd3e : MOV EAX,dword ptr [ESI + 0xc]
006bcd41 : MOV ESI,dword ptr [ESP + 0x20]
006bcd45 : TEST BL,BL
006bcd47 : JZ 0x006bcd52
006bcd49 : MOV dword ptr [ECX + 0x10],EAX
006bcd4c : OR byte ptr [EAX + 0xc],0x2
006bcd50 : JMP 0x006bcd55
006bcd52 : MOV dword ptr [ECX + 0xc],EAX
006bcd55 : MOV EBP,dword ptr [EBP + 0x10]
006bcd58 : MOV dword ptr [ESP + 0x10],EBP
006bcd5c : CMP EBP,dword ptr [ECX + 0x1c]
006bcd5f : JNZ 0x006bccc5
006bcd65 : MOV EAX,dword ptr [ESP + 0x14]
006bcd69 : MOV byte ptr [ECX],0x0
006bcd6c : TEST EAX,EAX
006bcd6e : JLE 0x006bcd79
006bcd70 : CMP EAX,dword ptr [ESP + 0x18]
006bcd74 : JL 0x006bcd79
006bcd76 : MOV byte ptr [ECX],0x1
006bcd79 : CMP dword ptr [ECX + 0x10],0x0
006bcd7d : JZ 0x006bcd8c
006bcd7f : CMP dword ptr [ECX + 0xc],0x0
006bcd83 : JZ 0x006bcd8c
006bcd85 : MOV dword ptr [ECX + 0x10],0x0
006bcd8c : ADD ECX,0x30
006bcd8f : LEA EAX,[ECX + -0xc]
006bcd92 : CMP EAX,ESI
006bcd94 : JC 0x006bccb4
006bcd9a : MOV EAX,dword ptr [ESP + 0x1c]
006bcd9e : POP EDI
006bcd9f : POP ESI
006bcda0 : POP EBP
006bcda1 : POP EBX
006bcda2 : ADD ESP,0x1c
006bcda5 : RET
