PROGRAM  : Maestia.exe
FUNCTION : FUN_00540b60
ENTRY    : 00540b60
BODY     : [[00540b60, 00540c9f]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00540b60(int param_1)

{
  undefined4 *puVar1;
  int *piVar2;
  int iVar3;
  uint uVar4;
  undefined4 uVar5;
  int iVar6;
  undefined4 *puVar7;
  int in_ECX;
  short *psVar8;
  int local_4;
  
  local_4 = 0;
  if (*(int *)(in_ECX + 0x10) != 0) {
    piVar2 = *(int **)(*(int *)(in_ECX + 0xc) + -4 + *(int *)(in_ECX + 0x10) * 4);
    uVar4 = piVar2[1];
    if (uVar4 != 0) {
      if ((*piVar2 == 0) || (uVar4 <= uVar4 - 1)) {
        psVar8 = (short *)0x0;
      }
      else {
        psVar8 = (short *)(*piVar2 + (uVar4 - 1) * 2);
      }
      if (*psVar8 == 0) {
        uVar4 = uVar4 - 1;
      }
    }
    local_4 = uVar4 + piVar2[7];
  }
  if (*(int *)(in_ECX + 8) == 0) {
    uVar5 = FUN_00515dd0(in_ECX);
    iVar6 = FUN_00515840(0x50,0);
    if (iVar6 == 0) {
      uVar5 = 0;
    }
    else {
      uVar5 = FUN_00508200(uVar5,0);
    }
    if (*(GRefCountNTSImpl **)(in_ECX + 8) != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(in_ECX + 8));
    }
    *(undefined4 *)(in_ECX + 8) = uVar5;
  }
  iVar6 = *(int *)(in_ECX + 8);
  puVar7 = (undefined4 *)FUN_00515840(0x28,0);
  if (puVar7 == (undefined4 *)0x0) {
    puVar7 = (undefined4 *)0x0;
  }
  else {
    *puVar7 = 0;
    puVar7[1] = 0;
    puVar7[2] = 0;
    puVar7[3] = 0;
    puVar7[4] = 0;
    puVar7[5] = 0;
    puVar7[6] = 0;
    *(undefined2 *)(puVar7 + 9) = 0;
    puVar7[7] = 0;
    iVar3 = *(int *)(iVar6 + 0x18);
    *(int *)(iVar6 + 0x18) = iVar3 + 1;
    puVar7[8] = iVar3;
  }
  piVar2 = (int *)(in_ECX + 0xc);
  FUN_005402b0(piVar2,*(int *)(in_ECX + 0x10) + 1);
  puVar1 = (undefined4 *)(*piVar2 + -4 + *(int *)(in_ECX + 0x10) * 4);
  if (puVar1 == (undefined4 *)0x0) {
    if (puVar7 != (undefined4 *)0x0) {
      FUN_0053bb30(puVar7[4],puVar7[5]);
      FUN_00515cf0(puVar7[4]);
      if ((GRefCountNTSImpl *)puVar7[3] != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release((GRefCountNTSImpl *)puVar7[3]);
      }
      FUN_00515cf0(puVar7);
    }
  }
  else {
    *puVar1 = puVar7;
  }
  iVar6 = *(int *)(*piVar2 + -4 + *(int *)(in_ECX + 0x10) * 4);
  if (param_1 == 0) {
    param_1 = *(int *)(in_ECX + 0x18);
  }
  FUN_0053c230(*(undefined4 *)(in_ECX + 8),param_1);
  *(int *)(iVar6 + 0x1c) = local_4;
  return iVar6;
}



============================================================
DISASSEMBLY
============================================================
00540b60 : PUSH ECX
00540b61 : PUSH EBX
00540b62 : PUSH EBP
00540b63 : PUSH ESI
00540b64 : PUSH EDI
00540b65 : MOV EDI,ECX
00540b67 : MOV EAX,dword ptr [EDI + 0x10]
00540b6a : XOR EBP,EBP
00540b6c : MOV dword ptr [ESP + 0x10],EBP
00540b70 : CMP EAX,EBP
00540b72 : JBE 0x00540ba5
00540b74 : MOV ECX,dword ptr [EDI + 0xc]
00540b77 : MOV ECX,dword ptr [ECX + EAX*0x4 + -0x4]
00540b7b : MOV EAX,dword ptr [ECX + 0x4]
00540b7e : MOV ESI,dword ptr [ECX + 0x1c]
00540b81 : CMP EAX,EBP
00540b83 : JBE 0x00540b9f
00540b85 : MOV ECX,dword ptr [ECX]
00540b87 : LEA EDX,[EAX + -0x1]
00540b8a : CMP ECX,EBP
00540b8c : JZ 0x00540b97
00540b8e : CMP EDX,EAX
00540b90 : JNC 0x00540b97
00540b92 : LEA ECX,[ECX + EDX*0x2]
00540b95 : JMP 0x00540b99
00540b97 : XOR ECX,ECX
00540b99 : CMP word ptr [ECX],BP
00540b9c : JNZ 0x00540b9f
00540b9e : DEC EAX
00540b9f : ADD EAX,ESI
00540ba1 : MOV dword ptr [ESP + 0x10],EAX
00540ba5 : CMP dword ptr [EDI + 0x8],EBP
00540ba8 : JNZ 0x00540bde
00540baa : PUSH EDI
00540bab : CALL 0x00515dd0
00540bb0 : MOV ESI,EAX
00540bb2 : PUSH EBP
00540bb3 : PUSH 0x50
00540bb5 : MOV ECX,ESI
00540bb7 : CALL 0x00515840
00540bbc : CMP EAX,EBP
00540bbe : JZ 0x00540bcd
00540bc0 : PUSH EBP
00540bc1 : PUSH ESI
00540bc2 : MOV ECX,EAX
00540bc4 : CALL 0x00508200
00540bc9 : MOV ESI,EAX
00540bcb : JMP 0x00540bcf
00540bcd : XOR ESI,ESI
00540bcf : MOV ECX,dword ptr [EDI + 0x8]
00540bd2 : CMP ECX,EBP
00540bd4 : JZ 0x00540bdb
00540bd6 : CALL 0x004ff7c0
00540bdb : MOV dword ptr [EDI + 0x8],ESI
00540bde : MOV ESI,dword ptr [EDI + 0x8]
00540be1 : MOV ECX,dword ptr [ESI + 0x1c]
00540be4 : PUSH EBP
00540be5 : PUSH 0x28
00540be7 : CALL 0x00515840
00540bec : CMP EAX,EBP
00540bee : JZ 0x00540c1d
00540bf0 : MOV dword ptr [EAX],EBP
00540bf2 : MOV dword ptr [EAX + 0x4],EBP
00540bf5 : MOV dword ptr [EAX + 0x8],EBP
00540bf8 : MOV dword ptr [EAX + 0xc],EBP
00540bfb : MOV dword ptr [EAX + 0x10],EBP
00540bfe : MOV dword ptr [EAX + 0x14],EBP
00540c01 : MOV dword ptr [EAX + 0x18],EBP
00540c04 : XOR EDX,EDX
00540c06 : MOV word ptr [EAX + 0x24],DX
00540c0a : MOV dword ptr [EAX + 0x1c],EBP
00540c0d : MOV ECX,dword ptr [ESI + 0x18]
00540c10 : LEA EDX,[ECX + 0x1]
00540c13 : MOV dword ptr [ESI + 0x18],EDX
00540c16 : MOV dword ptr [EAX + 0x20],ECX
00540c19 : MOV EBX,EAX
00540c1b : JMP 0x00540c1f
00540c1d : XOR EBX,EBX
00540c1f : MOV EAX,dword ptr [EDI + 0x10]
00540c22 : LEA ESI,[EDI + 0xc]
00540c25 : INC EAX
00540c26 : PUSH EAX
00540c27 : PUSH ESI
00540c28 : MOV ECX,ESI
00540c2a : CALL 0x005402b0
00540c2f : MOV ECX,dword ptr [ESI + 0x4]
00540c32 : MOV EDX,dword ptr [ESI]
00540c34 : LEA EAX,[EDX + ECX*0x4 + -0x4]
00540c38 : CMP EAX,EBP
00540c3a : JZ 0x00540c40
00540c3c : MOV dword ptr [EAX],EBX
00540c3e : JMP 0x00540c6f
00540c40 : CMP EBX,EBP
00540c42 : JZ 0x00540c6f
00540c44 : MOV EAX,dword ptr [EBX + 0x14]
00540c47 : MOV ECX,dword ptr [EBX + 0x10]
00540c4a : PUSH EAX
00540c4b : PUSH ECX
00540c4c : CALL 0x0053bb30
00540c51 : MOV EDX,dword ptr [EBX + 0x10]
00540c54 : ADD ESP,0x8
00540c57 : PUSH EDX
00540c58 : CALL 0x00515cf0
00540c5d : MOV ECX,dword ptr [EBX + 0xc]
00540c60 : CMP ECX,EBP
00540c62 : JZ 0x00540c69
00540c64 : CALL 0x004ff7c0
00540c69 : PUSH EBX
00540c6a : CALL 0x00515cf0
00540c6f : MOV EAX,dword ptr [EDI + 0x10]
00540c72 : MOV ECX,dword ptr [ESI]
00540c74 : MOV ESI,dword ptr [ECX + EAX*0x4 + -0x4]
00540c78 : MOV EAX,dword ptr [ESP + 0x18]
00540c7c : CMP EAX,EBP
00540c7e : JNZ 0x00540c83
00540c80 : MOV EAX,dword ptr [EDI + 0x18]
00540c83 : MOV EDX,dword ptr [EDI + 0x8]
00540c86 : PUSH EAX
00540c87 : PUSH EDX
00540c88 : MOV ECX,ESI
00540c8a : CALL 0x0053c230
00540c8f : MOV EAX,dword ptr [ESP + 0x10]
00540c93 : POP EDI
00540c94 : MOV dword ptr [ESI + 0x1c],EAX
00540c97 : MOV EAX,ESI
00540c99 : POP ESI
00540c9a : POP EBP
00540c9b : POP EBX
00540c9c : POP ECX
00540c9d : RET 0x4
