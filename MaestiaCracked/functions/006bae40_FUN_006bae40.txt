PROGRAM  : Maestia.exe
FUNCTION : FUN_006bae40
ENTRY    : 006bae40
BODY     : [[006bae40, 006bafe8]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006bae40(int param_1,int param_2,uint param_3)

{
  int iVar1;
  int iVar2;
  int iVar3;
  undefined4 uVar4;
  int iVar5;
  int *unaff_EBX;
  uint uVar6;
  undefined4 *puVar7;
  undefined4 *puVar8;
  bool bVar9;
  
  iVar1 = *(int *)(param_2 + 4);
  iVar2 = *(int *)(iVar1 + 0x68);
  _memset(unaff_EBX,0,0xd0);
  if ((param_3 & 2) == 0) {
    if ((*(char *)(param_1 + 0x12d) == '\0') && (iVar3 = FUN_006ba980(param_1), iVar3 != 0)) {
      return iVar3;
    }
    if (*(char *)(param_1 + 0x124) == '\0') {
      iVar3 = *(int *)(*(int *)(iVar1 + 0x60) + 0x28);
    }
    else {
      iVar3 = *(int *)(param_1 + 0x128);
    }
    if (iVar3 == 0) {
      return 0x99;
    }
    bVar9 = (param_3 & 0xf0000) != 0x20000;
    FUN_006b3b80(iVar3,iVar1);
    if (bVar9 != (bool)*(char *)(iVar3 + 0x25c)) {
      uVar6 = 0;
      *(bool *)(iVar3 + 0x25c) = bVar9;
      if (*(int *)(param_1 + 0xf0) != 0) {
        do {
          uVar4 = FUN_00685ea0((int)*(short *)(*(int *)(iVar1 + 0x2a0) + uVar6 * 2),
                               *(undefined4 *)(param_1 + 0x58));
          *(undefined4 *)(*(int *)(param_1 + 0xf4) + uVar6 * 4) = uVar4;
          uVar6 = uVar6 + 1;
        } while (uVar6 < *(uint *)(param_1 + 0xf0));
      }
      FUN_006ba700(param_1);
    }
    if ((*(byte *)(iVar3 + 0x150) & 1) != 0) {
      param_3 = param_3 | 2;
    }
    if ((*(byte *)(iVar3 + 0x150) & 2) != 0) {
      puVar7 = &DAT_00beb9b0;
      puVar8 = (undefined4 *)(iVar3 + 0x11c);
      for (iVar5 = 0x11; iVar5 != 0; iVar5 = iVar5 + -1) {
        *puVar8 = *puVar7;
        puVar7 = puVar7 + 1;
        puVar8 = puVar8 + 1;
      }
    }
    *(byte *)(iVar3 + 0x231) = (byte)param_3 & 0x80;
    unaff_EBX[0x28] = iVar3;
    unaff_EBX[0x29] = *(int *)(iVar3 + 0x188);
  }
  iVar3 = (**(code **)(iVar1 + 0x1fc))(iVar1,0x676c7966,iVar2,0);
  if (iVar3 == 0) {
    iVar3 = FUN_00687830(iVar2);
    unaff_EBX[0x15] = iVar3;
    iVar3 = **(int **)(param_2 + 0x9c);
    FUN_00686310(iVar3);
    unaff_EBX[4] = param_3;
    unaff_EBX[3] = iVar3;
    *unaff_EBX = iVar1;
    unaff_EBX[1] = param_1;
    unaff_EBX[2] = param_2;
    unaff_EBX[6] = iVar2;
    iVar3 = 0;
  }
  return iVar3;
}



============================================================
DISASSEMBLY
============================================================
006bae40 : SUB ESP,0x10
006bae43 : MOV EAX,dword ptr [ESP + 0x18]
006bae47 : PUSH EBP
006bae48 : MOV EBP,dword ptr [ESP + 0x18]
006bae4c : PUSH ESI
006bae4d : MOV ESI,dword ptr [EAX + 0x4]
006bae50 : PUSH EDI
006bae51 : MOV EDI,dword ptr [ESI + 0x68]
006bae54 : PUSH 0xd0
006bae59 : PUSH 0x0
006bae5b : PUSH EBX
006bae5c : MOV dword ptr [ESP + 0x20],ESI
006bae60 : MOV dword ptr [ESP + 0x24],EDI
006bae64 : CALL 0x0063b700
006bae69 : ADD ESP,0xc
006bae6c : TEST byte ptr [ESP + 0x28],0x2
006bae71 : JNZ 0x006baf89
006bae77 : CMP byte ptr [EBP + 0x12d],0x0
006bae7e : JNZ 0x006bae91
006bae80 : PUSH EBP
006bae81 : CALL 0x006ba980
006bae86 : ADD ESP,0x4
006bae89 : TEST EAX,EAX
006bae8b : JNZ 0x006bafe2
006bae91 : CMP byte ptr [EBP + 0x124],0x0
006bae98 : JZ 0x006baea6
006bae9a : MOV EDI,dword ptr [EBP + 0x128]
006baea0 : MOV dword ptr [ESP + 0x10],EDI
006baea4 : JMP 0x006baeb2
006baea6 : MOV ECX,dword ptr [ESI + 0x60]
006baea9 : MOV EDX,dword ptr [ECX + 0x28]
006baeac : MOV dword ptr [ESP + 0x10],EDX
006baeb0 : MOV EDI,EDX
006baeb2 : TEST EDI,EDI
006baeb4 : JNZ 0x006baec2
006baeb6 : POP EDI
006baeb7 : POP ESI
006baeb8 : MOV EAX,0x99
006baebd : POP EBP
006baebe : ADD ESP,0x10
006baec1 : RET
006baec2 : MOV EAX,dword ptr [ESP + 0x28]
006baec6 : AND EAX,0xf0000
006baecb : CMP EAX,0x20000
006baed0 : PUSH ESI
006baed1 : PUSH EDI
006baed2 : MOV EAX,EBP
006baed4 : SETNZ byte ptr [ESP + 0x17]
006baed9 : CALL 0x006b3b80
006baede : MOV AL,byte ptr [ESP + 0x17]
006baee2 : ADD ESP,0x8
006baee5 : CMP AL,byte ptr [EDI + 0x25c]
006baeeb : JZ 0x006baf3a
006baeed : XOR ESI,ESI
006baeef : MOV byte ptr [EDI + 0x25c],AL
006baef5 : CMP dword ptr [EBP + 0xf0],ESI
006baefb : JBE 0x006baf2d
006baefd : LEA ECX,[ECX]
006baf00 : MOV ECX,dword ptr [EBP + 0x58]
006baf03 : MOV EDX,dword ptr [ESP + 0x14]
006baf07 : MOV EAX,dword ptr [EDX + 0x2a0]
006baf0d : PUSH ECX
006baf0e : MOVSX ECX,word ptr [EAX + ESI*0x2]
006baf12 : PUSH ECX
006baf13 : CALL 0x00685ea0
006baf18 : MOV EDX,dword ptr [EBP + 0xf4]
006baf1e : MOV dword ptr [EDX + ESI*0x4],EAX
006baf21 : INC ESI
006baf22 : ADD ESP,0x8
006baf25 : CMP ESI,dword ptr [EBP + 0xf0]
006baf2b : JC 0x006baf00
006baf2d : PUSH EBP
006baf2e : CALL 0x006ba700
006baf33 : MOV ESI,dword ptr [ESP + 0x18]
006baf37 : ADD ESP,0x4
006baf3a : MOV AL,byte ptr [EDI + 0x150]
006baf40 : TEST AL,0x1
006baf42 : JZ 0x006baf49
006baf44 : OR dword ptr [ESP + 0x28],0x2
006baf49 : TEST AL,0x2
006baf4b : JZ 0x006baf67
006baf4d : ADD EDI,0x11c
006baf53 : MOV ECX,0x11
006baf58 : MOV ESI,0xbeb9b0
006baf5d : MOVSD.REP ES:EDI,ESI
006baf5f : MOV EDI,dword ptr [ESP + 0x10]
006baf63 : MOV ESI,dword ptr [ESP + 0x14]
006baf67 : MOV AL,byte ptr [ESP + 0x28]
006baf6b : AND AL,0x80
006baf6d : MOV byte ptr [EDI + 0x231],AL
006baf73 : MOV dword ptr [EBX + 0xa0],EDI
006baf79 : MOV ECX,dword ptr [EDI + 0x188]
006baf7f : MOV EDI,dword ptr [ESP + 0x18]
006baf83 : MOV dword ptr [EBX + 0xa4],ECX
006baf89 : MOV EDX,dword ptr [ESI + 0x1fc]
006baf8f : PUSH 0x0
006baf91 : PUSH EDI
006baf92 : PUSH 0x676c7966
006baf97 : PUSH ESI
006baf98 : CALL EDX
006baf9a : ADD ESP,0x10
006baf9d : TEST EAX,EAX
006baf9f : JNZ 0x006bafe2
006bafa1 : PUSH EDI
006bafa2 : CALL 0x00687830
006bafa7 : MOV dword ptr [EBX + 0x54],EAX
006bafaa : MOV EAX,dword ptr [ESP + 0x28]
006bafae : MOV ECX,dword ptr [EAX + 0x9c]
006bafb4 : MOV EAX,dword ptr [ECX]
006bafb6 : PUSH EAX
006bafb7 : MOV dword ptr [ESP + 0x20],EAX
006bafbb : CALL 0x00686310
006bafc0 : MOV EAX,dword ptr [ESP + 0x30]
006bafc4 : MOV EDX,dword ptr [ESP + 0x20]
006bafc8 : MOV ECX,dword ptr [ESP + 0x2c]
006bafcc : ADD ESP,0x8
006bafcf : MOV dword ptr [EBX + 0x10],EAX
006bafd2 : MOV dword ptr [EBX + 0xc],EDX
006bafd5 : MOV dword ptr [EBX],ESI
006bafd7 : MOV dword ptr [EBX + 0x4],EBP
006bafda : MOV dword ptr [EBX + 0x8],ECX
006bafdd : MOV dword ptr [EBX + 0x18],EDI
006bafe0 : XOR EAX,EAX
006bafe2 : POP EDI
006bafe3 : POP ESI
006bafe4 : POP EBP
006bafe5 : ADD ESP,0x10
006bafe8 : RET
