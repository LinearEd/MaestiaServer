PROGRAM  : Maestia.exe
FUNCTION : FUN_0047a720
ENTRY    : 0047a720
BODY     : [[0047a720, 0047aab2]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0047a720(int param_1,float param_2)

{
  int iVar1;
  ushort uVar2;
  uint uVar3;
  undefined4 uVar4;
  undefined4 *puVar5;
  undefined8 *in_ECX;
  int iVar6;
  int unaff_EDI;
  undefined1 local_8c [28];
  undefined1 local_70 [28];
  undefined1 local_54 [28];
  uint local_38;
  undefined8 *local_34;
  undefined1 local_30 [4];
  undefined4 local_2c;
  int local_1c;
  uint local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b7d20b;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_14 = uVar3;
  if (param_1 == 0) {
    FUN_00406460(L"Keydata NULL");
    local_8 = 0;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                (L"AvaLib::AvaAnimController::GetRotKey",0x45,local_30);
    }
    local_8 = 0xffffffff;
    if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_18 = 7;
    local_1c = 0;
    local_2c = (undefined4 *)((uint)local_2c._2_2_ << 0x10);
  }
  else {
    uVar2 = *(ushort *)(param_1 + 0xd8);
    if (uVar2 == 1) {
      iVar6 = *(int *)(param_1 + 0xdc);
      *in_ECX = *(undefined8 *)(iVar6 + 4);
      in_ECX[1] = *(undefined8 *)(iVar6 + 0xc);
    }
    else if (uVar2 != 0) {
      local_38 = uVar2 + 0xffff;
      local_34 = in_ECX;
      if (param_2 < 0.0) {
        local_18 = 7;
        local_1c = 0;
        local_2c = (undefined4 *)((uint)local_2c & 0xffff0000);
        local_8 = 1;
        if (*(int *)(unaff_EDI + 0xac) != 0) {
          uVar4 = FUN_00403380(local_54,*(int *)(unaff_EDI + 0xac) + 4,uVar3);
          local_8._0_1_ = 2;
          FUN_00405eb0(uVar4,0,0xffffffff);
          local_8 = CONCAT31(local_8._1_3_,1);
          FUN_00406560();
        }
        if (*(int *)(unaff_EDI + 0xdc) != 0) {
          uVar4 = FUN_00403380(local_70,*(int *)(unaff_EDI + 0xdc) + 4,uVar3);
          local_8._0_1_ = 3;
          FUN_00405c30(uVar4,0,0xffffffff);
          local_8 = CONCAT31(local_8._1_3_,1);
          FUN_00406560();
        }
        if (*(int *)(unaff_EDI + 0x10c) != 0) {
          uVar4 = FUN_00403380(local_8c,*(int *)(unaff_EDI + 0x10c) + 4,uVar3);
          local_8._0_1_ = 4;
          FUN_00405c30(uVar4,0,0xffffffff);
          local_8 = CONCAT31(local_8._1_3_,1);
          FUN_00406560();
        }
        if (local_1c == 0) {
          FUN_00405c00(local_30);
        }
        puVar5 = local_2c;
        if (local_18 < 8) {
          puVar5 = &local_2c;
        }
        FUN_008018d0(L"%d : [%s]  Error Ani file Name : %s",0x61,
                     L"AvaLib::AvaAnimController::GetRotKey",puVar5);
        param_2 = 0.0;
        local_8 = 0xffffffff;
        FUN_00406560();
      }
      if (*(float *)(unaff_EDI + 0x138) == 0.0) {
        FUN_00406460(L"m_fFrameSpeed Zero!!");
        local_8 = 5;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                    (L"AvaLib::AvaAnimController::GetRotKey",0x67,local_30);
        }
        local_8 = 0xffffffff;
        FUN_00406560();
        *(undefined4 *)(unaff_EDI + 0x138) = 0x3c23d70a;
      }
      uVar3 = local_38 & 0xffff;
      param_2 = param_2 / *(float *)(unaff_EDI + 0x138);
      iVar6 = (int)param_2;
      if (iVar6 < (int)uVar3) {
        iVar1 = *(int *)(param_1 + 0xdc) + iVar6 * 0x14;
        if ((iVar1 == 0) || (iVar1 == -0x14)) {
          FUN_00406460(L"pPrev or pNext NULL");
          local_8 = 6;
          if ((int *)*DAT_00da98e8 != (int *)0x0) {
            (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                      (L"AvaLib::AvaAnimController::GetRotKey",0x7b,local_30);
          }
          local_8 = 0xffffffff;
          FUN_00406560();
        }
        else if ((((*(float *)(iVar1 + 4) == *(float *)(iVar1 + 0x18)) &&
                  (*(float *)(iVar1 + 8) == *(float *)(iVar1 + 0x1c))) &&
                 (*(float *)(iVar1 + 0xc) == *(float *)(iVar1 + 0x20))) &&
                (*(float *)(iVar1 + 0x10) == *(float *)(iVar1 + 0x24))) {
          *local_34 = *(undefined8 *)(iVar1 + 4);
          local_34[1] = *(undefined8 *)(iVar1 + 0xc);
        }
        else {
          D3DXQuaternionSlerp(local_34,(undefined8 *)(iVar1 + 4),iVar1 + 0x18,param_2 - (float)iVar6
                             );
        }
      }
      else {
        iVar6 = *(int *)(param_1 + 0xdc);
        *local_34 = *(undefined8 *)(iVar6 + 4 + uVar3 * 0x14);
        local_34[1] = *(undefined8 *)(iVar6 + uVar3 * 0x14 + 0xc);
      }
    }
  }
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
0047a720 : PUSH EBP
0047a721 : MOV EBP,ESP
0047a723 : PUSH -0x1
0047a725 : PUSH 0xb7d20b
0047a72a : MOV EAX,FS:[0x0]
0047a730 : PUSH EAX
0047a731 : SUB ESP,0x7c
0047a734 : MOV EAX,[0x00d66fa0]
0047a739 : XOR EAX,EBP
0047a73b : MOV dword ptr [EBP + -0x10],EAX
0047a73e : PUSH EBX
0047a73f : PUSH ESI
0047a740 : PUSH EAX
0047a741 : LEA EAX,[EBP + -0xc]
0047a744 : MOV FS:[0x0],EAX
0047a74a : MOV EBX,dword ptr [EBP + 0x8]
0047a74d : XOR ESI,ESI
0047a74f : MOV dword ptr [EBP + -0x30],ECX
0047a752 : CMP EBX,ESI
0047a754 : JNZ 0x0047a7ad
0047a756 : PUSH 0xcd6bf8
0047a75b : LEA ECX,[EBP + -0x2c]
0047a75e : CALL 0x00406460
0047a763 : MOV dword ptr [EBP + -0x4],ESI
0047a766 : MOV EAX,[0x00da98e8]
0047a76b : MOV ECX,dword ptr [EAX]
0047a76d : CMP ECX,ESI
0047a76f : JZ 0x0047a783
0047a771 : MOV EDX,dword ptr [ECX]
0047a773 : MOV EDX,dword ptr [EDX + 0x14]
0047a776 : LEA EAX,[EBP + -0x2c]
0047a779 : PUSH EAX
0047a77a : PUSH 0x45
0047a77c : PUSH 0xcd6c18
0047a781 : CALL EDX
0047a783 : MOV dword ptr [EBP + -0x4],0xffffffff
0047a78a : CMP dword ptr [EBP + -0x14],0x8
0047a78e : JC 0x0047a798
0047a790 : MOV ECX,dword ptr [EBP + -0x28]
0047a793 : CALL 0x006f04e0
0047a798 : XOR EAX,EAX
0047a79a : MOV dword ptr [EBP + -0x14],0x7
0047a7a1 : MOV dword ptr [EBP + -0x18],ESI
0047a7a4 : MOV word ptr [EBP + -0x28],AX
0047a7a8 : JMP 0x0047aa96
0047a7ad : MOVZX EAX,word ptr [EBX + 0xd8]
0047a7b4 : CMP AX,0x1
0047a7b8 : JNZ 0x0047a7db
0047a7ba : MOV EAX,dword ptr [EBX + 0xdc]
0047a7c0 : MOVQ XMM0,qword ptr [EAX + 0x4]
0047a7c5 : ADD EAX,0x4
0047a7c8 : MOVQ qword ptr [ECX],XMM0
0047a7cc : MOVQ XMM0,qword ptr [EAX + 0x8]
0047a7d1 : MOVQ qword ptr [ECX + 0x8],XMM0
0047a7d6 : JMP 0x0047aa96
0047a7db : CMP AX,SI
0047a7de : JBE 0x0047aa96
0047a7e4 : MOVSS XMM0,dword ptr [EBP + 0xc]
0047a7e9 : XORPS XMM1,XMM1
0047a7ec : ADD EAX,0xffff
0047a7f1 : COMISS XMM1,XMM0
0047a7f4 : MOV dword ptr [EBP + -0x34],EAX
0047a7f7 : JBE 0x0047a923
0047a7fd : XOR ECX,ECX
0047a7ff : MOV dword ptr [EBP + -0x14],0x7
0047a806 : MOV dword ptr [EBP + -0x18],ESI
0047a809 : MOV word ptr [EBP + -0x28],CX
0047a80d : MOV dword ptr [EBP + -0x4],0x1
0047a814 : MOV EAX,dword ptr [EDI + 0xac]
0047a81a : CMP EAX,ESI
0047a81c : JZ 0x0047a84f
0047a81e : ADD EAX,0x4
0047a821 : PUSH EAX
0047a822 : LEA EDX,[EBP + -0x50]
0047a825 : PUSH EDX
0047a826 : MOV EDX,0xcd6a9c
0047a82b : CALL 0x00403380
0047a830 : ADD ESP,0x8
0047a833 : MOV byte ptr [EBP + -0x4],0x2
0047a837 : PUSH -0x1
0047a839 : PUSH ESI
0047a83a : PUSH EAX
0047a83b : LEA ECX,[EBP + -0x2c]
0047a83e : CALL 0x00405eb0
0047a843 : MOV byte ptr [EBP + -0x4],0x1
0047a847 : LEA ECX,[EBP + -0x50]
0047a84a : CALL 0x00406560
0047a84f : MOV EAX,dword ptr [EDI + 0xdc]
0047a855 : CMP EAX,ESI
0047a857 : JZ 0x0047a88a
0047a859 : ADD EAX,0x4
0047a85c : PUSH EAX
0047a85d : LEA EAX,[EBP + -0x6c]
0047a860 : PUSH EAX
0047a861 : MOV EDX,0xcd6ac4
0047a866 : CALL 0x00403380
0047a86b : ADD ESP,0x8
0047a86e : MOV byte ptr [EBP + -0x4],0x3
0047a872 : PUSH -0x1
0047a874 : PUSH ESI
0047a875 : PUSH EAX
0047a876 : LEA ECX,[EBP + -0x2c]
0047a879 : CALL 0x00405c30
0047a87e : MOV byte ptr [EBP + -0x4],0x1
0047a882 : LEA ECX,[EBP + -0x6c]
0047a885 : CALL 0x00406560
0047a88a : MOV EAX,dword ptr [EDI + 0x10c]
0047a890 : CMP EAX,ESI
0047a892 : JZ 0x0047a8cb
0047a894 : ADD EAX,0x4
0047a897 : PUSH EAX
0047a898 : LEA ECX,[EBP + 0xffffff78]
0047a89e : PUSH ECX
0047a89f : MOV EDX,0xcd6af4
0047a8a4 : CALL 0x00403380
0047a8a9 : ADD ESP,0x8
0047a8ac : MOV byte ptr [EBP + -0x4],0x4
0047a8b0 : PUSH -0x1
0047a8b2 : PUSH ESI
0047a8b3 : PUSH EAX
0047a8b4 : LEA ECX,[EBP + -0x2c]
0047a8b7 : CALL 0x00405c30
0047a8bc : MOV byte ptr [EBP + -0x4],0x1
0047a8c0 : LEA ECX,[EBP + 0xffffff78]
0047a8c6 : CALL 0x00406560
0047a8cb : CMP dword ptr [EBP + -0x18],ESI
0047a8ce : JNZ 0x0047a8de
0047a8d0 : LEA EDX,[EBP + -0x2c]
0047a8d3 : PUSH EDX
0047a8d4 : MOV EDX,0xcd6b24
0047a8d9 : CALL 0x00405c00
0047a8de : CMP dword ptr [EBP + -0x14],0x8
0047a8e2 : MOV EAX,dword ptr [EBP + -0x28]
0047a8e5 : JNC 0x0047a8ea
0047a8e7 : LEA EAX,[EBP + -0x28]
0047a8ea : MOV ESI,dword ptr [0x00da98e8]
0047a8f0 : PUSH EAX
0047a8f1 : PUSH 0xcd6c18
0047a8f6 : PUSH 0x61
0047a8f8 : PUSH 0xcd6bb0
0047a8fd : CALL 0x008018d0
0047a902 : XORPS XMM0,XMM0
0047a905 : ADD ESP,0x10
0047a908 : MOVSS dword ptr [EBP + 0xc],XMM0
0047a90d : MOV dword ptr [EBP + -0x4],0xffffffff
0047a914 : LEA ECX,[EBP + -0x2c]
0047a917 : CALL 0x00406560
0047a91c : MOVSS XMM0,dword ptr [EBP + 0xc]
0047a921 : XOR ESI,ESI
0047a923 : MOVSS XMM1,dword ptr [EDI + 0x138]
0047a92b : UCOMISS XMM1,dword ptr [0x00b9b0b4]
0047a932 : LAHF
0047a933 : TEST AH,0x44
0047a936 : JP 0x0047a98d
0047a938 : PUSH 0xcd6c64
0047a93d : LEA ECX,[EBP + -0x2c]
0047a940 : CALL 0x00406460
0047a945 : MOV dword ptr [EBP + -0x4],0x5
0047a94c : MOV EAX,[0x00da98e8]
0047a951 : MOV ECX,dword ptr [EAX]
0047a953 : CMP ECX,ESI
0047a955 : JZ 0x0047a969
0047a957 : MOV EDX,dword ptr [ECX]
0047a959 : MOV EDX,dword ptr [EDX + 0x14]
0047a95c : LEA EAX,[EBP + -0x2c]
0047a95f : PUSH EAX
0047a960 : PUSH 0x67
0047a962 : PUSH 0xcd6c18
0047a967 : CALL EDX
0047a969 : MOV dword ptr [EBP + -0x4],0xffffffff
0047a970 : LEA ECX,[EBP + -0x2c]
0047a973 : CALL 0x00406560
0047a978 : MOVSS XMM0,dword ptr [0x00cdf23c]
0047a980 : MOVSS dword ptr [EDI + 0x138],XMM0
0047a988 : MOVSS XMM0,dword ptr [EBP + 0xc]
0047a98d : MOVZX EAX,word ptr [EBP + -0x34]
0047a991 : DIVSS XMM0,dword ptr [EDI + 0x138]
0047a999 : CVTTSS2SI ESI,XMM0
0047a99d : CMP ESI,EAX
0047a99f : JL 0x0047a9ca
0047a9a1 : MOV ECX,dword ptr [EBX + 0xdc]
0047a9a7 : LEA EAX,[EAX + EAX*0x4]
0047a9aa : MOVQ XMM0,qword ptr [ECX + EAX*0x4 + 0x4]
0047a9b0 : LEA EAX,[ECX + EAX*0x4 + 0x4]
0047a9b4 : MOV ECX,dword ptr [EBP + -0x30]
0047a9b7 : MOVQ qword ptr [ECX],XMM0
0047a9bb : MOVQ XMM0,qword ptr [EAX + 0x8]
0047a9c0 : MOVQ qword ptr [ECX + 0x8],XMM0
0047a9c5 : JMP 0x0047aa96
0047a9ca : MOV EAX,dword ptr [EBX + 0xdc]
0047a9d0 : LEA EDX,[ESI + ESI*0x4]
0047a9d3 : LEA EAX,[EAX + EDX*0x4]
0047a9d6 : LEA ECX,[EAX + 0x14]
0047a9d9 : TEST EAX,EAX
0047a9db : JZ 0x0047aa55
0047a9dd : TEST ECX,ECX
0047a9df : JZ 0x0047aa55
0047a9e1 : MOVSS XMM1,dword ptr [EAX + 0x4]
0047a9e6 : UCOMISS XMM1,dword ptr [ECX + 0x4]
0047a9ea : LEA EDX,[ECX + 0x4]
0047a9ed : LEA ECX,[EAX + 0x4]
0047a9f0 : LAHF
0047a9f1 : TEST AH,0x44
0047a9f4 : JP 0x0047aa3a
0047a9f6 : MOVSS XMM1,dword ptr [ECX + 0x4]
0047a9fb : UCOMISS XMM1,dword ptr [EDX + 0x4]
0047a9ff : LAHF
0047aa00 : TEST AH,0x44
0047aa03 : JP 0x0047aa3a
0047aa05 : MOVSS XMM1,dword ptr [ECX + 0x8]
0047aa0a : UCOMISS XMM1,dword ptr [EDX + 0x8]
0047aa0e : LAHF
0047aa0f : TEST AH,0x44
0047aa12 : JP 0x0047aa3a
0047aa14 : MOVSS XMM1,dword ptr [ECX + 0xc]
0047aa19 : UCOMISS XMM1,dword ptr [EDX + 0xc]
0047aa1d : LAHF
0047aa1e : TEST AH,0x44
0047aa21 : JP 0x0047aa3a
0047aa23 : MOVQ XMM0,qword ptr [ECX]
0047aa27 : MOV EAX,dword ptr [EBP + -0x30]
0047aa2a : MOVQ qword ptr [EAX],XMM0
0047aa2e : MOVQ XMM0,qword ptr [ECX + 0x8]
0047aa33 : MOVQ qword ptr [EAX + 0x8],XMM0
0047aa38 : JMP 0x0047aa96
0047aa3a : PUSH ECX
0047aa3b : CVTSI2SS XMM1,ESI
0047aa3f : SUBSS XMM0,XMM1
0047aa43 : MOVSS dword ptr [ESP],XMM0
0047aa48 : PUSH EDX
0047aa49 : PUSH ECX
0047aa4a : MOV ECX,dword ptr [EBP + -0x30]
0047aa4d : PUSH ECX
0047aa4e : CALL 0x004ff758
0047aa53 : JMP 0x0047aa96
0047aa55 : PUSH 0xcd6c90
0047aa5a : LEA ECX,[EBP + -0x2c]
0047aa5d : CALL 0x00406460
0047aa62 : MOV dword ptr [EBP + -0x4],0x6
0047aa69 : MOV EDX,dword ptr [0x00da98e8]
0047aa6f : MOV ECX,dword ptr [EDX]
0047aa71 : TEST ECX,ECX
0047aa73 : JZ 0x0047aa87
0047aa75 : MOV EAX,dword ptr [ECX]
0047aa77 : MOV EAX,dword ptr [EAX + 0x14]
0047aa7a : LEA EDX,[EBP + -0x2c]
0047aa7d : PUSH EDX
0047aa7e : PUSH 0x7b
0047aa80 : PUSH 0xcd6c18
0047aa85 : CALL EAX
0047aa87 : MOV dword ptr [EBP + -0x4],0xffffffff
0047aa8e : LEA ECX,[EBP + -0x2c]
0047aa91 : CALL 0x00406560
0047aa96 : MOV ECX,dword ptr [EBP + -0xc]
0047aa99 : MOV dword ptr FS:[0x0],ECX
0047aaa0 : POP ECX
0047aaa1 : POP ESI
0047aaa2 : POP EBX
0047aaa3 : MOV ECX,dword ptr [EBP + -0x10]
0047aaa6 : XOR ECX,EBP
0047aaa8 : CALL 0x00633e6b
0047aaad : MOV ESP,EBP
0047aaaf : POP EBP
0047aab0 : RET 0x8
