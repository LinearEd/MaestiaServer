PROGRAM  : Maestia.exe
FUNCTION : FUN_00845e70
ENTRY    : 00845e70
BODY     : [[00845e70, 0084605d]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00845e70(int param_1,short param_2)

{
  char cVar1;
  int *piVar2;
  ulonglong uVar3;
  uint uVar4;
  uint8_t *packet;
  int in_ECX;
  int iVar5;
  byte bVar6;
  int local_20;
  uint8_t *local_1c;
  void *local_14;
  undefined1 *puStack_10;
  undefined4 uStack_c;
  
  uStack_c = 0xffffffff;
  puStack_10 = &LAB_00b684ac;
  local_14 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xffffffd0;
  ExceptionList = &local_14;
  local_20 = param_1;
  FUN_004437f0(&local_20);
  if ((local_1c != (uint8_t *)DAT_017245e4) && (iVar5 = *(int *)((int)local_1c + 0x10), iVar5 != 0))
  {
    if ((*(int *)(iVar5 + 0xac) == 2) && ((param_2 == 6 || (param_2 == 5)))) {
      FUN_00a3f530(DAT_00da93ec);
    }
    if ((*(int *)(iVar5 + 0xb4) == 2) && (param_2 == 7)) {
      FUN_00a3f530(DAT_00da93ec);
    }
  }
  iVar5 = DAT_0172490c;
  piVar2 = DAT_00da9894;
  if (*(int *)(in_ECX + 8) != 5) {
    ExceptionList = local_14;
    return;
  }
  if (param_1 == 0) {
    *(undefined4 *)(in_ECX + 8) = 4;
    piVar2 = *(int **)(*piVar2 + 0x208);
    *(undefined4 *)(iVar5 + 0x44) = 0;
    (**(code **)(*piVar2 + 0x48))();
    iVar5 = *(int *)ThreadLocalStoragePointer;
    bVar6 = (byte)((ulonglong)(*(byte *)(iVar5 + 0x18) + 1) % 3);
    *(byte *)(iVar5 + 0x18) = bVar6;
    local_1c = (uint8_t *)((uint)bVar6 * 0x2000 + 0x122cb8 + iVar5);
    if (local_1c == (uint8_t *)0x0) {
      packet = (uint8_t *)0x0;
    }
    else {
      local_1c[0] = '\0';
      local_1c[1] = '\0';
      local_1c[2] = '>';
      local_1c[3] = '\x19';
      local_1c[4] = '\0';
      local_1c[5] = '\0';
      local_1c[6] = '\0';
      local_1c[7] = '\0';
      packet = local_1c;
    }
    iVar5 = *(int *)(DAT_017247d4 + 4);
    if (iVar5 == 0) {
      ExceptionList = local_14;
      return;
    }
    cVar1 = *(char *)(DAT_017247d4 + 8);
  }
  else {
    if (((param_2 != 6) && (param_2 != 5)) && (param_2 != 7)) {
      ExceptionList = local_14;
      return;
    }
    *(undefined4 *)(in_ECX + 8) = 2;
    FUN_00843a80(uVar4);
    iVar5 = *(int *)ThreadLocalStoragePointer;
    uVar3 = (ulonglong)(*(byte *)(iVar5 + 0x18) + 1) % 3;
    local_1c = (uint8_t *)((int)uVar3 * 0x2000 + 0x122cb8 + iVar5);
    *(char *)(iVar5 + 0x18) = (char)uVar3;
    if (local_1c == (uint8_t *)0x0) {
      packet = (uint8_t *)0x0;
    }
    else {
      local_1c[0] = '\0';
      local_1c[1] = '\0';
      local_1c[2] = '>';
      local_1c[3] = '\x19';
      *(int *)(local_1c + 4) = param_1;
      packet = local_1c;
    }
    iVar5 = *(int *)(DAT_017247d4 + 4);
    if (iVar5 == 0) {
      ExceptionList = local_14;
      return;
    }
    cVar1 = *(char *)(DAT_017247d4 + 8);
  }
  uStack_c = 0xffffffff;
  if (cVar1 != '\0') {
    FUN_00a0dd40(iVar5,8,packet);
  }
  ExceptionList = local_14;
  return;
}



============================================================
DISASSEMBLY
============================================================
00845e70 : PUSH EBP
00845e71 : MOV EBP,ESP
00845e73 : AND ESP,0xfffffff8
00845e76 : PUSH -0x1
00845e78 : PUSH 0xb684ac
00845e7d : MOV EAX,FS:[0x0]
00845e83 : PUSH EAX
00845e84 : SUB ESP,0x10
00845e87 : PUSH EBX
00845e88 : PUSH ESI
00845e89 : PUSH EDI
00845e8a : MOV EAX,[0x00d66fa0]
00845e8f : XOR EAX,ESP
00845e91 : PUSH EAX
00845e92 : LEA EAX,[ESP + 0x20]
00845e96 : MOV FS:[0x0],EAX
00845e9c : MOV BX,word ptr [EBP + 0xc]
00845ea0 : MOV ESI,ECX
00845ea2 : MOV EAX,dword ptr [EBP + 0x8]
00845ea5 : LEA ECX,[ESP + 0x14]
00845ea9 : MOV dword ptr [ESP + 0x14],EAX
00845ead : PUSH ECX
00845eae : LEA EAX,[ESP + 0x1c]
00845eb2 : MOV ECX,0x17245e0
00845eb7 : CALL 0x004437f0
00845ebc : MOV EAX,dword ptr [ESP + 0x18]
00845ec0 : CMP EAX,dword ptr [0x017245e4]
00845ec6 : JZ 0x00845f18
00845ec8 : MOV EDI,dword ptr [EAX + 0x10]
00845ecb : TEST EDI,EDI
00845ecd : JZ 0x00845f18
00845ecf : CMP dword ptr [EDI + 0xac],0x2
00845ed6 : JNZ 0x00845ef7
00845ed8 : CMP BX,0x6
00845edc : JZ 0x00845ee4
00845ede : CMP BX,0x5
00845ee2 : JNZ 0x00845ef7
00845ee4 : MOV EDX,dword ptr [0x00da93ec]
00845eea : MOVZX ECX,word ptr [EDI + 0xb0]
00845ef1 : PUSH EDX
00845ef2 : CALL 0x00a3f530
00845ef7 : CMP dword ptr [EDI + 0xb4],0x2
00845efe : JNZ 0x00845f18
00845f00 : CMP BX,0x7
00845f04 : JNZ 0x00845f18
00845f06 : MOV EAX,[0x00da93ec]
00845f0b : MOVZX ECX,word ptr [EDI + 0xb8]
00845f12 : PUSH EAX
00845f13 : CALL 0x00a3f530
00845f18 : CMP dword ptr [ESI + 0x8],0x5
00845f1c : JNZ 0x00846049
00845f22 : MOV EDI,dword ptr [EBP + 0x8]
00845f25 : TEST EDI,EDI
00845f27 : JNZ 0x00845fba
00845f2d : MOV ECX,dword ptr [0x00da9894]
00845f33 : MOV EDX,dword ptr [0x0172490c]
00845f39 : MOV dword ptr [ESI + 0x8],0x4
00845f40 : MOV EAX,dword ptr [ECX]
00845f42 : MOV ECX,dword ptr [EAX + 0x208]
00845f48 : MOV dword ptr [EDX + 0x44],EDI
00845f4b : MOV EAX,dword ptr [ECX]
00845f4d : MOV EDX,dword ptr [EAX + 0x48]
00845f50 : CALL EDX
00845f52 : MOV EAX,FS:[0x2c]
00845f58 : MOV ECX,dword ptr [EAX]
00845f5a : MOVZX EAX,byte ptr [ECX + 0x18]
00845f5e : INC EAX
00845f5f : CDQ
00845f60 : MOV ESI,0x3
00845f65 : IDIV ESI
00845f67 : MOV byte ptr [ECX + 0x18],DL
00845f6a : MOVZX EDX,DL
00845f6d : SHL EDX,0xd
00845f70 : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
00845f77 : MOV dword ptr [ESP + 0x18],EAX
00845f7b : XOR EDX,EDX
00845f7d : MOV dword ptr [ESP + 0x28],EDX
00845f81 : CMP EAX,EDX
00845f83 : JZ 0x00845f97
00845f85 : XOR ECX,ECX
00845f87 : MOV word ptr [EAX],CX
00845f8a : MOV byte ptr [EAX + 0x2],0x3e
00845f8e : MOV byte ptr [EAX + 0x3],0x19
00845f92 : MOV dword ptr [EAX + 0x4],EDX
00845f95 : JMP 0x00845f99
00845f97 : XOR EAX,EAX
00845f99 : MOV dword ptr [ESP + 0x28],0xffffffff
00845fa1 : MOV ESI,dword ptr [0x017247d4]
00845fa7 : MOV ECX,dword ptr [ESI + 0x4]
00845faa : CMP ECX,EDX
00845fac : JZ 0x00846049
00845fb2 : CMP byte ptr [ESI + 0x8],DL
00845fb5 : JMP 0x0084603d
00845fba : CMP BX,0x6
00845fbe : JZ 0x00845fcc
00845fc0 : CMP BX,0x5
00845fc4 : JZ 0x00845fcc
00845fc6 : CMP BX,0x7
00845fca : JNZ 0x00846049
00845fcc : MOV EAX,ESI
00845fce : MOV dword ptr [ESI + 0x8],0x2
00845fd5 : CALL 0x00843a80
00845fda : MOV EDX,dword ptr FS:[0x2c]
00845fe1 : MOV ECX,dword ptr [EDX]
00845fe3 : MOVZX EAX,byte ptr [ECX + 0x18]
00845fe7 : INC EAX
00845fe8 : CDQ
00845fe9 : MOV ESI,0x3
00845fee : IDIV ESI
00845ff0 : MOVZX EAX,DL
00845ff3 : SHL EAX,0xd
00845ff6 : LEA EAX,[EAX + ECX*0x1 + 0x122cb8]
00845ffd : MOV byte ptr [ECX + 0x18],DL
00846000 : MOV dword ptr [ESP + 0x18],EAX
00846004 : MOV dword ptr [ESP + 0x28],0x1
0084600c : TEST EAX,EAX
0084600e : JZ 0x00846022
00846010 : XOR ECX,ECX
00846012 : MOV word ptr [EAX],CX
00846015 : MOV byte ptr [EAX + 0x2],0x3e
00846019 : MOV byte ptr [EAX + 0x3],0x19
0084601d : MOV dword ptr [EAX + 0x4],EDI
00846020 : JMP 0x00846024
00846022 : XOR EAX,EAX
00846024 : MOV dword ptr [ESP + 0x28],0xffffffff
0084602c : MOV EDX,dword ptr [0x017247d4]
00846032 : MOV ECX,dword ptr [EDX + 0x4]
00846035 : TEST ECX,ECX
00846037 : JZ 0x00846049
00846039 : CMP byte ptr [EDX + 0x8],0x0
0084603d : JZ 0x00846049
0084603f : PUSH 0x8
00846041 : PUSH ECX
00846042 : MOV EDI,EAX
00846044 : CALL 0x00a0dd40
00846049 : MOV ECX,dword ptr [ESP + 0x20]
0084604d : MOV dword ptr FS:[0x0],ECX
00846054 : POP ECX
00846055 : POP EDI
00846056 : POP ESI
00846057 : POP EBX
00846058 : MOV ESP,EBP
0084605a : POP EBP
0084605b : RET 0x8
