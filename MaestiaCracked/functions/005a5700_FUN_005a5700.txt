PROGRAM  : Maestia.exe
FUNCTION : FUN_005a5700
ENTRY    : 005a5700
BODY     : [[005a5700, 005a5863] [005a5870, 005a58b5]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005a5700(void)

{
  int *piVar1;
  undefined4 *puVar2;
  uint uVar3;
  undefined4 *puVar4;
  undefined4 *puVar5;
  int in_ECX;
  int *piVar6;
  int iVar7;
  int iVar8;
  int *piVar9;
  uint uVar10;
  
  EnterCriticalSection((LPCRITICAL_SECTION)(in_ECX + 0x9e4));
  FUN_005a5360();
  iVar8 = in_ECX + 0x38;
  *(int *)iVar8 = iVar8;
  *(int *)(in_ECX + 0x3c) = iVar8;
  FUN_005a3740();
  iVar8 = *(int *)(in_ECX + 0x8e0);
  piVar1 = (int *)(in_ECX + 0x8e0);
  if (iVar8 == 0) {
    uVar10 = 0;
    piVar9 = (int *)0x0;
  }
  else {
    uVar10 = 0;
    piVar6 = (int *)(iVar8 + 8);
    do {
      piVar9 = piVar1;
      if (*piVar6 != -2) break;
      uVar10 = uVar10 + 1;
      piVar6 = piVar6 + 3;
    } while (uVar10 <= *(uint *)(iVar8 + 4));
  }
  do {
    do {
      if (((piVar9 == (int *)0x0) || (*piVar9 == 0)) || (*(int *)(*piVar9 + 4) < (int)uVar10)) {
        if (*piVar1 != 0) {
          iVar7 = 0;
          iVar8 = *(int *)(*piVar1 + 4) + 1;
          do {
            if (*(int *)(iVar7 + 8 + *piVar1) != -2) {
              *(undefined4 *)(iVar7 + 8 + *piVar1) = 0xfffffffe;
            }
            iVar7 = iVar7 + 0xc;
            iVar8 = iVar8 + -1;
          } while (iVar8 != 0);
          FUN_00515cf0(*piVar1);
          *piVar1 = 0;
        }
        puVar2 = (undefined4 *)(in_ECX + 0x8f8);
        puVar5 = *(undefined4 **)(in_ECX + 0x8fc);
        while (puVar5 != puVar2) {
          puVar4 = (undefined4 *)puVar5[1];
          if (puVar5[4] != 0) {
            FUN_00557b30();
          }
          *puVar5 = *(undefined4 *)(in_ECX + 0x8f0);
          *(undefined4 **)(in_ECX + 0x8f0) = puVar5;
          puVar5 = puVar4;
        }
        *puVar2 = puVar2;
        *(undefined4 **)(in_ECX + 0x8fc) = puVar2;
        iVar8 = *(int *)(in_ECX + 0x8e4);
        while (iVar8 != 0) {
          iVar7 = *(int *)(iVar8 + 0x9ec);
          FUN_00515cf0(iVar8);
          iVar8 = iVar7;
        }
        iVar8 = 0;
        *(undefined4 *)(in_ECX + 0x8e4) = 0;
        *(undefined4 *)(in_ECX + 0x8e8) = 0;
        *(undefined4 *)(in_ECX + 0x8ec) = 0x7f;
        *(undefined4 *)(in_ECX + 0x8f0) = 0;
        if (*(int *)(in_ECX + 0x900) != 0) {
          iVar7 = *(int *)(*(int *)(in_ECX + 0x900) + 4) + 1;
          do {
            if (*(int *)(*(int *)(in_ECX + 0x900) + 8 + iVar8) != -2) {
              *(undefined4 *)(*(int *)(in_ECX + 0x900) + 8 + iVar8) = 0xfffffffe;
            }
            iVar8 = iVar8 + 0x14;
            iVar7 = iVar7 + -1;
          } while (iVar7 != 0);
          FUN_00515cf0(*(undefined4 *)(in_ECX + 0x900));
          *(undefined4 *)(in_ECX + 0x900) = 0;
        }
        LeaveCriticalSection((LPCRITICAL_SECTION)(in_ECX + 0x9e4));
        return;
      }
      FUN_005e4170(in_ECX + 8);
      uVar3 = *(uint *)(*piVar9 + 4);
    } while (((int)uVar3 < (int)uVar10) || (uVar10 = uVar10 + 1, uVar3 < uVar10));
    piVar6 = (int *)(*piVar9 + 8 + uVar10 * 0xc);
    do {
      if (*piVar6 != -2) break;
      uVar10 = uVar10 + 1;
      piVar6 = piVar6 + 3;
    } while (uVar10 <= uVar3);
  } while( true );
}



============================================================
DISASSEMBLY
============================================================
005a5700 : PUSH ECX
005a5701 : PUSH EBX
005a5702 : PUSH EBP
005a5703 : PUSH ESI
005a5704 : PUSH EDI
005a5705 : MOV EDI,ECX
005a5707 : LEA EAX,[EDI + 0x9e4]
005a570d : PUSH EAX
005a570e : MOV dword ptr [ESP + 0x14],EAX
005a5712 : CALL dword ptr [0x00b85118]
005a5718 : MOV ECX,EDI
005a571a : CALL 0x005a5360
005a571f : LEA EAX,[EDI + 0x38]
005a5722 : LEA ECX,[EDI + 0x24]
005a5725 : MOV dword ptr [EAX],EAX
005a5727 : MOV dword ptr [EAX + 0x4],EAX
005a572a : CALL 0x005a3740
005a572f : MOV EAX,dword ptr [EDI + 0x8e0]
005a5735 : LEA EBP,[EDI + 0x8e0]
005a573b : TEST EAX,EAX
005a573d : JNZ 0x005a5745
005a573f : XOR EBX,EBX
005a5741 : XOR ESI,ESI
005a5743 : JMP 0x005a5760
005a5745 : XOR ESI,ESI
005a5747 : LEA ECX,[EAX + 0x8]
005a574a : LEA EBX,[EBX]
005a5750 : CMP dword ptr [ECX],-0x2
005a5753 : JNZ 0x005a575e
005a5755 : INC ESI
005a5756 : ADD ECX,0xc
005a5759 : CMP ESI,dword ptr [EAX + 0x4]
005a575c : JBE 0x005a5750
005a575e : MOV EBX,EBP
005a5760 : TEST EBX,EBX
005a5762 : JZ 0x005a57a3
005a5764 : MOV EAX,dword ptr [EBX]
005a5766 : TEST EAX,EAX
005a5768 : JZ 0x005a57a3
005a576a : CMP ESI,dword ptr [EAX + 0x4]
005a576d : JG 0x005a57a3
005a576f : LEA ECX,[EDI + 0x8]
005a5772 : LEA EDX,[ESI + ESI*0x2]
005a5775 : PUSH ECX
005a5776 : MOV ECX,dword ptr [EAX + EDX*0x4 + 0x10]
005a577a : CALL 0x005e4170
005a577f : MOV ECX,dword ptr [EBX]
005a5781 : MOV EAX,dword ptr [ECX + 0x4]
005a5784 : CMP ESI,EAX
005a5786 : JG 0x005a5760
005a5788 : INC ESI
005a5789 : CMP ESI,EAX
005a578b : JA 0x005a5760
005a578d : LEA EDX,[ESI + ESI*0x2]
005a5790 : LEA ECX,[ECX + EDX*0x4 + 0x8]
005a5794 : CMP dword ptr [ECX],-0x2
005a5797 : JNZ 0x005a5760
005a5799 : INC ESI
005a579a : ADD ECX,0xc
005a579d : CMP ESI,EAX
005a579f : JBE 0x005a5794
005a57a1 : JMP 0x005a5760
005a57a3 : MOV EAX,dword ptr [EBP]
005a57a6 : TEST EAX,EAX
005a57a8 : JZ 0x005a57de
005a57aa : MOV EAX,dword ptr [EAX + 0x4]
005a57ad : XOR ECX,ECX
005a57af : LEA EDX,[EAX + 0x1]
005a57b2 : MOV EAX,dword ptr [EBP]
005a57b5 : CMP dword ptr [ECX + EAX*0x1 + 0x8],-0x2
005a57ba : LEA EAX,[ECX + EAX*0x1 + 0x8]
005a57be : JZ 0x005a57c6
005a57c0 : MOV dword ptr [EAX],0xfffffffe
005a57c6 : ADD ECX,0xc
005a57c9 : SUB EDX,0x1
005a57cc : JNZ 0x005a57b2
005a57ce : MOV ECX,dword ptr [EBP]
005a57d1 : PUSH ECX
005a57d2 : CALL 0x00515cf0
005a57d7 : MOV dword ptr [EBP],0x0
005a57de : MOV ESI,dword ptr [EDI + 0x8fc]
005a57e4 : LEA EBX,[EDI + 0x8f8]
005a57ea : CMP ESI,EBX
005a57ec : JZ 0x005a5813
005a57ee : MOV EDI,EDI
005a57f0 : MOV ECX,dword ptr [ESI + 0x10]
005a57f3 : MOV EBP,dword ptr [ESI + 0x4]
005a57f6 : TEST ECX,ECX
005a57f8 : JZ 0x005a57ff
005a57fa : CALL 0x00557b30
005a57ff : MOV EDX,dword ptr [EDI + 0x8f0]
005a5805 : MOV dword ptr [ESI],EDX
005a5807 : MOV dword ptr [EDI + 0x8f0],ESI
005a580d : MOV ESI,EBP
005a580f : CMP EBP,EBX
005a5811 : JNZ 0x005a57f0
005a5813 : MOV dword ptr [EBX],EBX
005a5815 : MOV dword ptr [EBX + 0x4],EBX
005a5818 : MOV EAX,dword ptr [EDI + 0x8e4]
005a581e : TEST EAX,EAX
005a5820 : JZ 0x005a5834
005a5822 : MOV ESI,dword ptr [EAX + 0x9ec]
005a5828 : PUSH EAX
005a5829 : CALL 0x00515cf0
005a582e : MOV EAX,ESI
005a5830 : TEST ESI,ESI
005a5832 : JNZ 0x005a5822
005a5834 : XOR ECX,ECX
005a5836 : MOV dword ptr [EDI + 0x8e4],ECX
005a583c : MOV dword ptr [EDI + 0x8e8],ECX
005a5842 : MOV dword ptr [EDI + 0x8ec],0x7f
005a584c : MOV dword ptr [EDI + 0x8f0],ECX
005a5852 : MOV EAX,dword ptr [EDI + 0x900]
005a5858 : CMP EAX,ECX
005a585a : JZ 0x005a58a5
005a585c : MOV EAX,dword ptr [EAX + 0x4]
005a585f : LEA EDX,[EAX + 0x1]
005a5862 : JMP 0x005a5870
005a5870 : MOV EAX,dword ptr [EDI + 0x900]
005a5876 : CMP dword ptr [EAX + ECX*0x1 + 0x8],-0x2
005a587b : LEA EAX,[EAX + ECX*0x1 + 0x8]
005a587f : JZ 0x005a5887
005a5881 : MOV dword ptr [EAX],0xfffffffe
005a5887 : ADD ECX,0x14
005a588a : SUB EDX,0x1
005a588d : JNZ 0x005a5870
005a588f : MOV ECX,dword ptr [EDI + 0x900]
005a5895 : PUSH ECX
005a5896 : CALL 0x00515cf0
005a589b : MOV dword ptr [EDI + 0x900],0x0
005a58a5 : MOV EDX,dword ptr [ESP + 0x10]
005a58a9 : PUSH EDX
005a58aa : CALL dword ptr [0x00b8511c]
005a58b0 : POP EDI
005a58b1 : POP ESI
005a58b2 : POP EBP
005a58b3 : POP EBX
005a58b4 : POP ECX
005a58b5 : RET
