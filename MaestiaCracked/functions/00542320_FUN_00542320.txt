PROGRAM  : Maestia.exe
FUNCTION : FUN_00542320
ENTRY    : 00542320
BODY     : [[00542320, 00542550]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00542320(undefined4 param_1,int *param_2)

{
  int iVar1;
  undefined4 *puVar2;
  uint uVar3;
  int *piVar4;
  int *in_ECX;
  short *psVar5;
  int *unaff_EBP;
  uint uVar6;
  int iVar7;
  uint unaff_retaddr;
  int iVar8;
  int *local_14;
  int *piStack_10;
  int iStack_c;
  char cStack_4;
  
  local_14 = in_ECX;
  if (param_2 == (int *)0xffffffff) {
    param_2 = (int *)FUN_0053c470();
  }
  (**(code **)(*in_ECX + 0xc))(param_1,param_2);
  FUN_0053c2d0(&piStack_10,param_1,&local_14);
  iVar7 = iStack_c;
  iVar8 = 0;
  cStack_4 = '\0';
  if (piStack_10 == (int *)0x0) goto LAB_005424e9;
  if ((-1 < iStack_c) && (iStack_c < piStack_10[1])) {
    iVar1 = *(int *)(*piStack_10 + iStack_c * 4);
    uVar3 = *(int *)(iVar1 + 4) - (int)local_14;
    uVar6 = unaff_retaddr;
    if (uVar3 <= unaff_retaddr) {
      uVar6 = uVar3;
    }
    in_ECX = unaff_EBP;
    if (uVar6 <= *(uint *)(iVar1 + 4)) {
      cStack_4 = *(uint *)(iVar1 + 4) <= uVar6 + (int)local_14;
      FUN_00540170(local_14,uVar6 + (int)local_14);
      param_2 = (int *)(unaff_retaddr - uVar6);
      iVar8 = iVar1;
      if (iVar7 < piStack_10[1]) {
        iVar7 = iVar7 + 1;
        iStack_c = iVar7;
      }
    }
  }
  do {
    if (piStack_10 == (int *)0x0) goto LAB_005424e9;
    if ((iVar7 < 0) || (piStack_10[1] <= iVar7)) break;
    puVar2 = *(undefined4 **)(*piStack_10 + iVar7 * 4);
    local_14 = (int *)puVar2[1];
    if (param_2 < local_14) {
      in_ECX = unaff_EBP;
      if ((iVar8 != 0) && (cStack_4 != '\0')) {
        FUN_005408a0(unaff_EBP[2],puVar2,param_2,*(undefined4 *)(iVar8 + 4),
                     (int)local_14 - (int)param_2);
        FUN_005422e0(&piStack_10,puVar2);
        cStack_4 = '\0';
      }
      break;
    }
    (**(code **)(*unaff_EBP + 0x14))(puVar2);
    FUN_00515cf0(*puVar2);
    *puVar2 = 0;
    puVar2[2] = 0;
    puVar2[1] = 0;
    if (iVar7 < piStack_10[1]) {
      FUN_00540ae0(iVar7);
    }
    param_2 = (int *)((int)param_2 - (int)local_14);
    in_ECX = unaff_EBP;
  } while (param_2 != (int *)0x0);
  if (piStack_10 == (int *)0x0) goto LAB_005424e9;
  if ((-1 < iVar7) && (iVar7 < piStack_10[1])) {
    iVar1 = *(int *)(*piStack_10 + iVar7 * 4);
    if (*(int *)(iVar1 + 4) != 0) {
      if ((iVar8 == 0) || (cStack_4 == '\0')) goto LAB_005424c7;
      FUN_005408a0(in_ECX[2],iVar1,0,*(undefined4 *)(iVar8 + 4),*(int *)(iVar1 + 4));
    }
    FUN_005422e0(&piStack_10,iVar1);
  }
LAB_005424c7:
  while (((piStack_10 != (int *)0x0 && (-1 < iVar7)) && (iVar7 < piStack_10[1]))) {
    piVar4 = (int *)(*(int *)(*piStack_10 + iVar7 * 4) + 0x1c);
    *piVar4 = *piVar4 - unaff_retaddr;
    if (iVar7 < piStack_10[1]) {
      iVar7 = iVar7 + 1;
    }
  }
LAB_005424e9:
  iVar7 = in_ECX[4] + -1;
  if ((((-1 < iVar7) && (iVar7 < in_ECX[4])) &&
      (piVar4 = *(int **)(in_ECX[3] + iVar7 * 4), piVar4 != (int *)0x0)) ||
     (piVar4 = (int *)FUN_00540b60(0), piVar4 != (int *)0x0)) {
    uVar6 = piVar4[1];
    if (uVar6 != 0) {
      if ((*piVar4 == 0) || (uVar6 <= uVar6 - 1)) {
        psVar5 = (short *)0x0;
      }
      else {
        psVar5 = (short *)(*piVar4 + (uVar6 - 1) * 2);
      }
      if (*psVar5 == 0xd) {
        return;
      }
      if (*psVar5 == 10) {
        return;
      }
    }
    FUN_005406c0(in_ECX[2],in_ECX[7]);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00542320 : SUB ESP,0x14
00542323 : PUSH EBX
00542324 : MOV EBX,dword ptr [ESP + 0x20]
00542328 : PUSH EBP
00542329 : PUSH ESI
0054232a : MOV ESI,ECX
0054232c : PUSH EDI
0054232d : MOV dword ptr [ESP + 0x10],ESI
00542331 : CMP EBX,-0x1
00542334 : JNZ 0x00542341
00542336 : CALL 0x0053c470
0054233b : MOV dword ptr [ESP + 0x2c],EAX
0054233f : MOV EBX,EAX
00542341 : MOV EAX,dword ptr [ESI]
00542343 : MOV EDI,dword ptr [ESP + 0x28]
00542347 : MOV EDX,dword ptr [EAX + 0xc]
0054234a : PUSH EBX
0054234b : PUSH EDI
0054234c : MOV ECX,ESI
0054234e : CALL EDX
00542350 : LEA EAX,[ESP + 0x18]
00542354 : PUSH EAX
00542355 : PUSH EDI
00542356 : LEA ECX,[ESP + 0x24]
0054235a : PUSH ECX
0054235b : MOV ECX,ESI
0054235d : CALL 0x0053c2d0
00542362 : MOV EBP,dword ptr [ESP + 0x1c]
00542366 : MOV EDI,dword ptr [ESP + 0x20]
0054236a : MOV dword ptr [ESP + 0x14],0x0
00542372 : MOV byte ptr [ESP + 0x28],0x0
00542377 : TEST EBP,EBP
00542379 : JZ 0x005424e9
0054237f : TEST EDI,EDI
00542381 : JL 0x005423d8
00542383 : CMP EDI,dword ptr [EBP + 0x4]
00542386 : JGE 0x005423d8
00542388 : MOV EDX,dword ptr [EBP]
0054238b : MOV ECX,dword ptr [EDX + EDI*0x4]
0054238e : MOV EAX,dword ptr [ECX + 0x4]
00542391 : MOV EDX,dword ptr [ESP + 0x18]
00542395 : MOV ESI,dword ptr [ESP + 0x2c]
00542399 : SUB EAX,EDX
0054239b : CMP dword ptr [ESP + 0x2c],EAX
0054239f : JC 0x005423a3
005423a1 : MOV ESI,EAX
005423a3 : CMP ESI,dword ptr [ECX + 0x4]
005423a6 : JA 0x005423d4
005423a8 : LEA EAX,[ESI + EDX*0x1]
005423ab : CMP EAX,dword ptr [ECX + 0x4]
005423ae : PUSH EAX
005423af : PUSH EDX
005423b0 : SETNC byte ptr [ESP + 0x30]
005423b5 : MOV dword ptr [ESP + 0x1c],ECX
005423b9 : CALL 0x00540170
005423be : MOV EBX,dword ptr [ESP + 0x2c]
005423c2 : SUB EBX,ESI
005423c4 : CMP EDI,dword ptr [EBP + 0x4]
005423c7 : MOV ESI,dword ptr [ESP + 0x10]
005423cb : JGE 0x005423d8
005423cd : INC EDI
005423ce : MOV dword ptr [ESP + 0x20],EDI
005423d2 : JMP 0x005423d8
005423d4 : MOV ESI,dword ptr [ESP + 0x10]
005423d8 : TEST EBP,EBP
005423da : JZ 0x005424e9
005423e0 : TEST EDI,EDI
005423e2 : JL 0x00542478
005423e8 : CMP EDI,dword ptr [EBP + 0x4]
005423eb : JGE 0x00542478
005423f1 : MOV EAX,dword ptr [EBP]
005423f4 : MOV ESI,dword ptr [EAX + EDI*0x4]
005423f7 : MOV EAX,dword ptr [ESI + 0x4]
005423fa : MOV dword ptr [ESP + 0x18],EAX
005423fe : CMP EBX,EAX
00542400 : JC 0x00542439
00542402 : MOV ECX,dword ptr [ESP + 0x10]
00542406 : MOV EDX,dword ptr [ECX]
00542408 : MOV EAX,dword ptr [EDX + 0x14]
0054240b : PUSH ESI
0054240c : CALL EAX
0054240e : MOV ECX,dword ptr [ESI]
00542410 : PUSH ECX
00542411 : CALL 0x00515cf0
00542416 : XOR EAX,EAX
00542418 : MOV dword ptr [ESI],EAX
0054241a : MOV dword ptr [ESI + 0x8],EAX
0054241d : MOV dword ptr [ESI + 0x4],EAX
00542420 : CMP EDI,dword ptr [EBP + 0x4]
00542423 : JGE 0x0054242d
00542425 : PUSH EDI
00542426 : MOV ECX,EBP
00542428 : CALL 0x00540ae0
0054242d : SUB EBX,dword ptr [ESP + 0x18]
00542431 : MOV ESI,dword ptr [ESP + 0x10]
00542435 : JZ 0x00542478
00542437 : JMP 0x005423d8
00542439 : MOV ECX,dword ptr [ESP + 0x14]
0054243d : TEST ECX,ECX
0054243f : JZ 0x00542474
00542441 : CMP byte ptr [ESP + 0x28],0x0
00542446 : JZ 0x00542474
00542448 : MOV EDX,dword ptr [ECX + 0x4]
0054244b : SUB EAX,EBX
0054244d : PUSH EAX
0054244e : PUSH EDX
0054244f : PUSH EBX
00542450 : MOV EBX,dword ptr [ESP + 0x1c]
00542454 : MOV EAX,dword ptr [EBX + 0x8]
00542457 : PUSH ESI
00542458 : PUSH EAX
00542459 : CALL 0x005408a0
0054245e : PUSH ESI
0054245f : LEA ECX,[ESP + 0x20]
00542463 : PUSH ECX
00542464 : MOV ECX,EBX
00542466 : CALL 0x005422e0
0054246b : MOV byte ptr [ESP + 0x28],0x0
00542470 : MOV ESI,EBX
00542472 : JMP 0x00542478
00542474 : MOV ESI,dword ptr [ESP + 0x10]
00542478 : TEST EBP,EBP
0054247a : JZ 0x005424e9
0054247c : TEST EDI,EDI
0054247e : JL 0x005424c7
00542480 : CMP EDI,dword ptr [EBP + 0x4]
00542483 : JGE 0x005424c7
00542485 : MOV EDX,dword ptr [EBP]
00542488 : MOV EBX,dword ptr [EDX + EDI*0x4]
0054248b : MOV EAX,dword ptr [EBX + 0x4]
0054248e : TEST EAX,EAX
00542490 : JNZ 0x0054249a
00542492 : PUSH EBX
00542493 : LEA EAX,[ESP + 0x20]
00542497 : PUSH EAX
00542498 : JMP 0x005424c0
0054249a : MOV ECX,dword ptr [ESP + 0x14]
0054249e : TEST ECX,ECX
005424a0 : JZ 0x005424c7
005424a2 : CMP byte ptr [ESP + 0x28],0x0
005424a7 : JZ 0x005424c7
005424a9 : MOV EDX,dword ptr [ECX + 0x4]
005424ac : PUSH EAX
005424ad : MOV EAX,dword ptr [ESI + 0x8]
005424b0 : PUSH EDX
005424b1 : PUSH 0x0
005424b3 : PUSH EBX
005424b4 : PUSH EAX
005424b5 : CALL 0x005408a0
005424ba : PUSH EBX
005424bb : LEA ECX,[ESP + 0x20]
005424bf : PUSH ECX
005424c0 : MOV ECX,ESI
005424c2 : CALL 0x005422e0
005424c7 : TEST EBP,EBP
005424c9 : JZ 0x005424e9
005424cb : TEST EDI,EDI
005424cd : JL 0x005424e9
005424cf : CMP EDI,dword ptr [EBP + 0x4]
005424d2 : JGE 0x005424e9
005424d4 : MOV EDX,dword ptr [EBP]
005424d7 : MOV EAX,dword ptr [EDX + EDI*0x4]
005424da : MOV ECX,dword ptr [ESP + 0x2c]
005424de : SUB dword ptr [EAX + 0x1c],ECX
005424e1 : CMP EDI,dword ptr [EBP + 0x4]
005424e4 : JGE 0x005424c7
005424e6 : INC EDI
005424e7 : JMP 0x005424c7
005424e9 : MOV ECX,dword ptr [ESI + 0x10]
005424ec : LEA EAX,[ECX + -0x1]
005424ef : TEST EAX,EAX
005424f1 : JL 0x00542501
005424f3 : CMP EAX,ECX
005424f5 : JGE 0x00542501
005424f7 : MOV EDX,dword ptr [ESI + 0xc]
005424fa : MOV EAX,dword ptr [EDX + EAX*0x4]
005424fd : TEST EAX,EAX
005424ff : JNZ 0x0054250e
00542501 : PUSH 0x0
00542503 : MOV ECX,ESI
00542505 : CALL 0x00540b60
0054250a : TEST EAX,EAX
0054250c : JZ 0x00542547
0054250e : MOV ECX,dword ptr [EAX + 0x4]
00542511 : TEST ECX,ECX
00542513 : JBE 0x00542538
00542515 : MOV EDX,dword ptr [EAX]
00542517 : LEA EDI,[ECX + -0x1]
0054251a : TEST EDX,EDX
0054251c : JZ 0x00542527
0054251e : CMP EDI,ECX
00542520 : JNC 0x00542527
00542522 : LEA ECX,[EDX + EDI*0x2]
00542525 : JMP 0x00542529
00542527 : XOR ECX,ECX
00542529 : MOVZX ECX,word ptr [ECX]
0054252c : CMP CX,0xd
00542530 : JZ 0x00542547
00542532 : CMP CX,0xa
00542536 : JZ 0x00542547
00542538 : MOV ECX,dword ptr [ESI + 0x1c]
0054253b : MOV EDX,dword ptr [ESI + 0x8]
0054253e : PUSH ECX
0054253f : PUSH EDX
00542540 : MOV ECX,EAX
00542542 : CALL 0x005406c0
00542547 : POP EDI
00542548 : POP ESI
00542549 : POP EBP
0054254a : POP EBX
0054254b : ADD ESP,0x14
0054254e : RET 0x8
