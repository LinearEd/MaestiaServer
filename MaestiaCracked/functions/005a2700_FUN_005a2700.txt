PROGRAM  : Maestia.exe
FUNCTION : FUN_005a2700
ENTRY    : 005a2700
BODY     : [[005a2700, 005a293a]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_005a2700(int *param_1)

{
  char cVar1;
  int iVar2;
  undefined4 uVar3;
  GRefCountImpl *this;
  GRefCountNTSImpl *this_00;
  int *piVar4;
  LONG LVar5;
  int in_ECX;
  uint uVar6;
  uint uVar7;
  
  if (*param_1 == 1) {
    this_00 = (GRefCountNTSImpl *)param_1[4];
    if (this_00 != (GRefCountNTSImpl *)0x0) {
      *(int *)(this_00 + 4) = *(int *)(this_00 + 4) + 1;
    }
    uVar7 = *(uint *)(this_00 + 0xc);
    uVar6 = *(uint *)(this_00 + 0x10);
  }
  else {
    if (*param_1 != 2) {
      iVar2 = FUN_00515840(0x24,0);
      if (iVar2 == 0) {
        return 0;
      }
      uVar3 = FUN_00512330(0,0);
      return uVar3;
    }
    this = (GRefCountImpl *)
           (**(code **)(*(int *)param_1[5] + 4))
                     ((*(uint *)(param_1[4] + 0x10) & 0xfffffffc) + 8,0x21,0x1b6);
    if (this == (GRefCountImpl *)0x0) {
      return 0;
    }
    this_00 = (GRefCountNTSImpl *)
              FUN_005a2450(this,*(undefined4 *)(param_1[4] + 8),param_1[1],param_1[7],param_1[8],
                           param_1[9],param_1[10]);
    if (this_00 == (GRefCountNTSImpl *)0x0) {
      GRefCountImpl::Release(this);
      return 0;
    }
    uVar6 = (uint)*(ushort *)(param_1[4] + 0x16);
    uVar7 = (uint)*(ushort *)(param_1[4] + 0x14);
    GRefCountImpl::Release(this);
  }
  if (*(char *)(in_ECX + 0xc) == '\0') {
    iVar2 = param_1[6];
    if ((iVar2 == 0) || (*(int **)(iVar2 + 0xc) == (int *)0x0)) {
LAB_005a2928:
      GRefCountNTSImpl::Release(this_00);
      return 0;
    }
    if ((*(uint *)(iVar2 + 0x1c) & 0x10000) == 0) {
      if (((char)param_1[0xb] == '\0') || ((*(uint *)(iVar2 + 0x1c) & 0x100000) != 0)) {
        piVar4 = (int *)(**(code **)(**(int **)(iVar2 + 0xc) + 8))();
        if (piVar4 != (int *)0x0) {
          cVar1 = (**(code **)(*piVar4 + 8))(this_00 + 8,1);
          if (cVar1 != '\0') {
            iVar2 = FUN_00515840(0x24,0);
            if (iVar2 == 0) {
              uVar3 = 0;
            }
            else {
              uVar3 = FUN_005123f0(piVar4,uVar7,uVar6);
            }
            LVar5 = InterlockedExchangeAdd(piVar4 + 1,-1);
            if (LVar5 == 1) {
              (**(code **)*piVar4)(1);
            }
            GRefCountNTSImpl::Release(this_00);
            return uVar3;
          }
          LVar5 = InterlockedExchangeAdd(piVar4 + 1,-1);
          if (LVar5 == 1) {
            (**(code **)*piVar4)(1);
          }
        }
        goto LAB_005a2928;
      }
      iVar2 = FUN_00515840(0x24,0);
      if (iVar2 != 0) {
        uVar3 = FUN_00512390(this_00,uVar7,uVar6,1);
        GRefCountNTSImpl::Release(this_00);
        return uVar3;
      }
      goto LAB_005a282c;
    }
  }
  iVar2 = FUN_00515840(0x24,0);
  if (iVar2 != 0) {
    uVar3 = FUN_00512390(this_00,uVar7,uVar6,0);
    GRefCountNTSImpl::Release(this_00);
    return uVar3;
  }
LAB_005a282c:
  GRefCountNTSImpl::Release(this_00);
  return 0;
}



============================================================
DISASSEMBLY
============================================================
005a2700 : SUB ESP,0x8
005a2703 : PUSH EBX
005a2704 : PUSH EBP
005a2705 : PUSH ESI
005a2706 : MOV ESI,dword ptr [ESP + 0x18]
005a270a : MOV EAX,dword ptr [ESI + 0x28]
005a270d : PUSH EDI
005a270e : MOV dword ptr [ESP + 0x14],ECX
005a2712 : TEST EAX,EAX
005a2714 : JZ 0x005a271e
005a2716 : MOV ECX,EAX
005a2718 : MOV dword ptr [ESP + 0x1c],ECX
005a271c : JMP 0x005a2729
005a271e : MOV EAX,[0x00d73250]
005a2723 : MOV dword ptr [ESP + 0x1c],EAX
005a2727 : MOV ECX,EAX
005a2729 : MOV EAX,dword ptr [ESI]
005a272b : SUB EAX,0x1
005a272e : JZ 0x005a27e2
005a2734 : SUB EAX,0x1
005a2737 : JZ 0x005a275f
005a2739 : PUSH 0x0
005a273b : PUSH 0x24
005a273d : CALL 0x00515840
005a2742 : TEST EAX,EAX
005a2744 : JZ 0x005a292f
005a274a : PUSH 0x0
005a274c : PUSH 0x0
005a274e : MOV ECX,EAX
005a2750 : CALL 0x00512330
005a2755 : POP EDI
005a2756 : POP ESI
005a2757 : POP EBP
005a2758 : POP EBX
005a2759 : ADD ESP,0x8
005a275c : RET 0x4
005a275f : MOV ECX,dword ptr [ESI + 0x10]
005a2762 : MOV EAX,dword ptr [ECX + 0x10]
005a2765 : MOV ECX,dword ptr [ESI + 0x14]
005a2768 : MOV EDX,dword ptr [ECX]
005a276a : AND EAX,0xfffffffc
005a276d : PUSH 0x1b6
005a2772 : ADD EAX,0x8
005a2775 : PUSH 0x21
005a2777 : PUSH EAX
005a2778 : MOV EAX,dword ptr [EDX + 0x4]
005a277b : CALL EAX
005a277d : MOV EDI,EAX
005a277f : TEST EDI,EDI
005a2781 : JZ 0x005a292f
005a2787 : MOV ECX,dword ptr [ESI + 0x28]
005a278a : MOV EDX,dword ptr [ESI + 0x24]
005a278d : MOV EAX,dword ptr [ESI + 0x20]
005a2790 : PUSH ECX
005a2791 : MOV ECX,dword ptr [ESI + 0x1c]
005a2794 : PUSH EDX
005a2795 : MOV EDX,dword ptr [ESI + 0x4]
005a2798 : PUSH EAX
005a2799 : MOV EAX,dword ptr [ESI + 0x10]
005a279c : PUSH ECX
005a279d : MOV ECX,dword ptr [EAX + 0x8]
005a27a0 : PUSH EDX
005a27a1 : PUSH ECX
005a27a2 : PUSH EDI
005a27a3 : CALL 0x005a2450
005a27a8 : MOV EBX,EAX
005a27aa : ADD ESP,0x1c
005a27ad : MOV ECX,EDI
005a27af : TEST EBX,EBX
005a27b1 : JNZ 0x005a27c4
005a27b3 : CALL 0x004ff7e0
005a27b8 : POP EDI
005a27b9 : POP ESI
005a27ba : POP EBP
005a27bb : XOR EAX,EAX
005a27bd : POP EBX
005a27be : ADD ESP,0x8
005a27c1 : RET 0x4
005a27c4 : MOV EAX,dword ptr [ESI + 0x10]
005a27c7 : MOVZX EDX,word ptr [EAX + 0x16]
005a27cb : MOVZX EBP,word ptr [EAX + 0x14]
005a27cf : MOV dword ptr [ESP + 0x10],EDX
005a27d3 : CALL 0x004ff7e0
005a27d8 : MOV EDI,dword ptr [ESP + 0x10]
005a27dc : MOV ECX,dword ptr [ESP + 0x1c]
005a27e0 : JMP 0x005a27f4
005a27e2 : MOV EAX,dword ptr [ESI + 0x10]
005a27e5 : TEST EAX,EAX
005a27e7 : JZ 0x005a27ec
005a27e9 : INC dword ptr [EAX + 0x4]
005a27ec : MOV EBP,dword ptr [EAX + 0xc]
005a27ef : MOV EDI,dword ptr [EAX + 0x10]
005a27f2 : MOV EBX,EAX
005a27f4 : MOV EAX,dword ptr [ESP + 0x14]
005a27f8 : CMP byte ptr [EAX + 0xc],0x0
005a27fc : JZ 0x005a2841
005a27fe : PUSH 0x0
005a2800 : PUSH 0x24
005a2802 : CALL 0x00515840
005a2807 : TEST EAX,EAX
005a2809 : JZ 0x005a282c
005a280b : PUSH 0x0
005a280d : PUSH EDI
005a280e : PUSH EBP
005a280f : PUSH EBX
005a2810 : MOV ECX,EAX
005a2812 : CALL 0x00512390
005a2817 : MOV ECX,EBX
005a2819 : MOV ESI,EAX
005a281b : CALL 0x004ff7c0
005a2820 : POP EDI
005a2821 : MOV EAX,ESI
005a2823 : POP ESI
005a2824 : POP EBP
005a2825 : POP EBX
005a2826 : ADD ESP,0x8
005a2829 : RET 0x4
005a282c : MOV ECX,EBX
005a282e : XOR ESI,ESI
005a2830 : CALL 0x004ff7c0
005a2835 : POP EDI
005a2836 : MOV EAX,ESI
005a2838 : POP ESI
005a2839 : POP EBP
005a283a : POP EBX
005a283b : ADD ESP,0x8
005a283e : RET 0x4
005a2841 : MOV EAX,dword ptr [ESI + 0x18]
005a2844 : TEST EAX,EAX
005a2846 : JZ 0x005a2928
005a284c : MOV EDX,dword ptr [EAX + 0xc]
005a284f : TEST EDX,EDX
005a2851 : JZ 0x005a2928
005a2857 : MOV EAX,dword ptr [EAX + 0x1c]
005a285a : TEST EAX,0x10000
005a285f : JNZ 0x005a27fe
005a2861 : CMP byte ptr [ESI + 0x2c],0x0
005a2865 : JZ 0x005a289c
005a2867 : TEST EAX,0x100000
005a286c : JNZ 0x005a289c
005a286e : PUSH 0x0
005a2870 : PUSH 0x24
005a2872 : CALL 0x00515840
005a2877 : TEST EAX,EAX
005a2879 : JZ 0x005a282c
005a287b : PUSH 0x1
005a287d : PUSH EDI
005a287e : PUSH EBP
005a287f : PUSH EBX
005a2880 : MOV ECX,EAX
005a2882 : CALL 0x00512390
005a2887 : MOV ECX,EBX
005a2889 : MOV ESI,EAX
005a288b : CALL 0x004ff7c0
005a2890 : POP EDI
005a2891 : MOV EAX,ESI
005a2893 : POP ESI
005a2894 : POP EBP
005a2895 : POP EBX
005a2896 : ADD ESP,0x8
005a2899 : RET 0x4
005a289c : MOV EAX,dword ptr [EDX]
005a289e : MOV ECX,EDX
005a28a0 : MOV EDX,dword ptr [EAX + 0x8]
005a28a3 : CALL EDX
005a28a5 : MOV ESI,EAX
005a28a7 : TEST ESI,ESI
005a28a9 : JZ 0x005a2928
005a28ab : MOV EDX,dword ptr [ESI]
005a28ad : LEA EAX,[EBX + 0x8]
005a28b0 : PUSH 0x1
005a28b2 : PUSH EAX
005a28b3 : MOV EAX,dword ptr [EDX + 0x8]
005a28b6 : MOV ECX,ESI
005a28b8 : CALL EAX
005a28ba : TEST AL,AL
005a28bc : JZ 0x005a290d
005a28be : MOV ECX,dword ptr [ESP + 0x1c]
005a28c2 : PUSH 0x0
005a28c4 : PUSH 0x24
005a28c6 : CALL 0x00515840
005a28cb : TEST EAX,EAX
005a28cd : JZ 0x005a28dd
005a28cf : PUSH EDI
005a28d0 : PUSH EBP
005a28d1 : PUSH ESI
005a28d2 : MOV ECX,EAX
005a28d4 : CALL 0x005123f0
005a28d9 : MOV EDI,EAX
005a28db : JMP 0x005a28df
005a28dd : XOR EDI,EDI
005a28df : PUSH -0x1
005a28e1 : LEA ECX,[ESI + 0x4]
005a28e4 : PUSH ECX
005a28e5 : CALL dword ptr [0x00b851cc]
005a28eb : SUB EAX,0x1
005a28ee : JNZ 0x005a28fa
005a28f0 : MOV EDX,dword ptr [ESI]
005a28f2 : MOV EAX,dword ptr [EDX]
005a28f4 : PUSH 0x1
005a28f6 : MOV ECX,ESI
005a28f8 : CALL EAX
005a28fa : MOV ECX,EBX
005a28fc : CALL 0x004ff7c0
005a2901 : MOV EAX,EDI
005a2903 : POP EDI
005a2904 : POP ESI
005a2905 : POP EBP
005a2906 : POP EBX
005a2907 : ADD ESP,0x8
005a290a : RET 0x4
005a290d : PUSH -0x1
005a290f : LEA ECX,[ESI + 0x4]
005a2912 : PUSH ECX
005a2913 : CALL dword ptr [0x00b851cc]
005a2919 : SUB EAX,0x1
005a291c : JNZ 0x005a2928
005a291e : MOV EDX,dword ptr [ESI]
005a2920 : MOV EAX,dword ptr [EDX]
005a2922 : PUSH 0x1
005a2924 : MOV ECX,ESI
005a2926 : CALL EAX
005a2928 : MOV ECX,EBX
005a292a : CALL 0x004ff7c0
005a292f : POP EDI
005a2930 : POP ESI
005a2931 : POP EBP
005a2932 : XOR EAX,EAX
005a2934 : POP EBX
005a2935 : ADD ESP,0x8
005a2938 : RET 0x4
