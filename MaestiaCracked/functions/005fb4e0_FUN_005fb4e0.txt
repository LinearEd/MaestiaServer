PROGRAM  : Maestia.exe
FUNCTION : FUN_005fb4e0
ENTRY    : 005fb4e0
BODY     : [[005fb4e0, 005fb8aa]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005fb4e0(void)

{
  float *pfVar1;
  float fVar2;
  undefined4 uVar3;
  float fVar4;
  uint *puVar5;
  uint uVar6;
  int *piVar7;
  int in_ECX;
  uint uVar8;
  int *piVar9;
  uint uVar10;
  int iVar11;
  int iVar12;
  uint uVar13;
  int iVar14;
  bool bVar15;
  int local_2c;
  int local_28;
  int local_24;
  int local_20;
  uint local_1c;
  int local_18;
  uint local_10;
  
  fVar2 = *(float *)(in_ECX + 0xe8) - *(float *)(in_ECX + 0xe0);
  *(undefined1 *)(in_ECX + 8) = 0;
  fVar4 = *(float *)(in_ECX + 0xec) - *(float *)(in_ECX + 0xe4);
  if (((0.0 < fVar2) && (0.0 < fVar4)) && (0x40 < *(uint *)(in_ECX + 0x30))) {
    FUN_005fa0f0(0x42,0);
    *(undefined4 *)(in_ECX + 0x1c) = 0x42;
    FUN_005fa0f0(0x42,0);
    *(undefined4 *)(in_ECX + 0x10) = 0x42;
    _memset(*(void **)(in_ECX + 0x18),0,*(int *)(in_ECX + 0x1c) * 4);
    _memset(*(void **)(in_ECX + 0xc),0,*(int *)(in_ECX + 0x10) * 4);
    fVar2 = 64.0 / fVar2;
    local_1c = 0;
    fVar4 = 64.0 / fVar4;
    if (*(int *)(in_ECX + 0x40) != 0) {
      do {
        puVar5 = (uint *)((local_1c & 0x3f) * 0x10 +
                         *(int *)(*(int *)(in_ECX + 0x4c) + (local_1c >> 6) * 4));
        uVar10 = *puVar5;
        uVar13 = uVar10 + 1;
        if ((int)uVar13 <= (int)puVar5[1]) {
          do {
            iVar12 = *(int *)(*(int *)(in_ECX + 0x3c) + (uVar10 >> 10) * 4);
            pfVar1 = (float *)(*(int *)(*(int *)(in_ECX + 0x3c) + (uVar13 >> 10) * 4) +
                              (uVar13 & 0x3ff) * 8);
            local_10 = (uint)(longlong)
                             ROUND((*(float *)(iVar12 + (uVar10 & 0x3ff) * 8) -
                                   *(float *)(in_ECX + 0xe0)) * fVar2 + 0.5);
            uVar8 = local_10;
            local_10 = (uint)(longlong)ROUND((*pfVar1 - *(float *)(in_ECX + 0xe0)) * fVar2 + 0.5);
            bVar15 = uVar8 < local_10;
            uVar6 = local_10;
            if (local_10 < uVar8) {
              bVar15 = local_10 < uVar8;
              uVar6 = uVar8;
              uVar8 = local_10;
            }
            if (bVar15) {
              do {
                piVar9 = (int *)(*(int *)(in_ECX + 0xc) + uVar8 * 4);
                *piVar9 = *piVar9 + 1;
                uVar8 = uVar8 + 1;
              } while (uVar8 < uVar6);
            }
            local_10 = (uint)(longlong)
                             ROUND((*(float *)(iVar12 + (uVar10 & 0x3ff) * 8 + 4) -
                                   *(float *)(in_ECX + 0xe4)) * fVar4 + 0.5);
            uVar6 = local_10;
            local_10 = (uint)(longlong)ROUND((pfVar1[1] - *(float *)(in_ECX + 0xe4)) * fVar4 + 0.5);
            uVar8 = uVar6;
            if (local_10 < uVar6) {
              uVar8 = local_10;
              local_10 = uVar6;
            }
            for (; uVar8 < local_10; uVar8 = uVar8 + 1) {
              piVar9 = (int *)(*(int *)(in_ECX + 0x18) + uVar8 * 4);
              *piVar9 = *piVar9 + 1;
            }
            uVar10 = uVar10 + 1;
            uVar13 = uVar13 + 1;
          } while ((int)uVar13 <= (int)puVar5[1]);
        }
        local_1c = local_1c + 1;
      } while (local_1c < *(uint *)(in_ECX + 0x40));
    }
    local_1c = 0;
    local_20 = 0;
    local_24 = 0;
    local_2c = 0;
    local_28 = 0;
    piVar9 = (int *)(*(int *)(in_ECX + 0xc) + 0xc);
    iVar14 = 0;
    iVar11 = 0;
    iVar12 = 0;
    piVar7 = (int *)(*(int *)(in_ECX + 0x18) + 4);
    local_18 = 0x10;
    do {
      iVar12 = iVar12 + *(int *)((int)piVar7 + (*(int *)(in_ECX + 0xc) - *(int *)(in_ECX + 0x18)));
      local_28 = local_28 + *piVar7;
      local_20 = local_20 + piVar9[-1];
      local_2c = local_2c + piVar7[1];
      local_1c = local_1c + *piVar9;
      iVar14 = iVar14 + piVar9[-3];
      iVar11 = iVar11 + piVar7[-1];
      local_24 = local_24 + piVar7[2];
      piVar7 = piVar7 + 4;
      piVar9 = piVar9 + 4;
      local_18 = local_18 + -1;
    } while (local_18 != 0);
    if (iVar14 + iVar12 + local_20 + local_1c < (uint)(iVar11 + local_28 + local_2c + local_24)) {
      if (*(int *)(in_ECX + 0x30) != 0) {
        uVar10 = 0;
        do {
          iVar12 = *(int *)(*(int *)(in_ECX + 0x3c) + (uVar10 >> 10) * 4);
          fVar2 = *(float *)(iVar12 + (uVar10 & 0x3ff) * 8);
          pfVar1 = (float *)(iVar12 + (uVar10 & 0x3ff) * 8);
          uVar10 = uVar10 + 1;
          *pfVar1 = -pfVar1[1];
          pfVar1[1] = fVar2;
        } while (uVar10 < *(uint *)(in_ECX + 0x30));
      }
      uVar3 = *(undefined4 *)(in_ECX + 0xe0);
      *(undefined1 *)(in_ECX + 8) = 1;
      *(float *)(in_ECX + 0xe0) = -*(float *)(in_ECX + 0xe4);
      *(undefined4 *)(in_ECX + 0xe4) = uVar3;
      uVar3 = *(undefined4 *)(in_ECX + 0xe8);
      *(float *)(in_ECX + 0xe8) = -*(float *)(in_ECX + 0xec);
      *(undefined4 *)(in_ECX + 0xec) = uVar3;
      uVar3 = *(undefined4 *)(in_ECX + 0xe0);
      *(undefined4 *)(in_ECX + 0xe0) = *(undefined4 *)(in_ECX + 0xe8);
      *(undefined4 *)(in_ECX + 0xe8) = uVar3;
      return;
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005fb4e0 : PUSH EBP
005fb4e1 : MOV EBP,ESP
005fb4e3 : AND ESP,0xfffffff8
005fb4e6 : SUB ESP,0x28
005fb4e9 : PUSH EBX
005fb4ea : PUSH EBP
005fb4eb : PUSH ESI
005fb4ec : MOV ESI,ECX
005fb4ee : FLD float ptr [ESI + 0xe8]
005fb4f4 : PUSH EDI
005fb4f5 : FSUB float ptr [ESI + 0xe0]
005fb4fb : MOV byte ptr [ESI + 0x8],0x0
005fb4ff : FSTP float ptr [ESP + 0x24]
005fb503 : FLD float ptr [ESI + 0xec]
005fb509 : FSUB float ptr [ESI + 0xe4]
005fb50f : FSTP float ptr [ESP + 0x20]
005fb513 : FLDZ
005fb515 : FCOM float ptr [ESP + 0x24]
005fb519 : FNSTSW AX
005fb51b : TEST AH,0x5
005fb51e : JP 0x005fb8a1
005fb524 : FCOMP float ptr [ESP + 0x20]
005fb528 : FNSTSW AX
005fb52a : TEST AH,0x5
005fb52d : JP 0x005fb8a3
005fb533 : CMP dword ptr [ESI + 0x30],0x40
005fb537 : JBE 0x005fb8a3
005fb53d : XOR EBP,EBP
005fb53f : PUSH EBP
005fb540 : LEA EDI,[ESI + 0x18]
005fb543 : PUSH 0x42
005fb545 : MOV ECX,EDI
005fb547 : CALL 0x005fa0f0
005fb54c : PUSH EBP
005fb54d : LEA EBX,[ESI + 0xc]
005fb550 : PUSH 0x42
005fb552 : MOV ECX,EBX
005fb554 : MOV dword ptr [EDI + 0x4],0x42
005fb55b : CALL 0x005fa0f0
005fb560 : MOV dword ptr [EBX + 0x4],0x42
005fb567 : MOV EAX,dword ptr [EDI + 0x4]
005fb56a : MOV ECX,dword ptr [EDI]
005fb56c : ADD EAX,EAX
005fb56e : ADD EAX,EAX
005fb570 : PUSH EAX
005fb571 : PUSH EBP
005fb572 : PUSH ECX
005fb573 : CALL 0x0063b700
005fb578 : MOV EDX,dword ptr [EBX + 0x4]
005fb57b : MOV EAX,dword ptr [EBX]
005fb57d : ADD EDX,EDX
005fb57f : ADD EDX,EDX
005fb581 : PUSH EDX
005fb582 : PUSH EBP
005fb583 : PUSH EAX
005fb584 : CALL 0x0063b700
005fb589 : FLD float ptr [ESP + 0x3c]
005fb58d : FLD double ptr [0x00b95728]
005fb593 : XOR ECX,ECX
005fb595 : FLD ST0
005fb597 : ADD ESP,0x18
005fb59a : FDIVRP ST2,ST0
005fb59c : MOV dword ptr [ESP + 0x24],ECX
005fb5a0 : FXCH
005fb5a2 : FSTP float ptr [ESP + 0x28]
005fb5a6 : FDIV float ptr [ESP + 0x20]
005fb5aa : FSTP float ptr [ESP + 0x20]
005fb5ae : CMP dword ptr [ESI + 0x40],EBP
005fb5b1 : JBE 0x005fb75d
005fb5b7 : FLD float ptr [ESP + 0x28]
005fb5bb : FLD float ptr [ESP + 0x20]
005fb5bf : FLD double ptr [0x00cdf120]
005fb5c5 : MOV EDI,dword ptr [ESI + 0x4c]
005fb5c8 : MOV EAX,ECX
005fb5ca : AND EAX,0x3f
005fb5cd : MOV EDX,ECX
005fb5cf : SHR EDX,0x6
005fb5d2 : SHL EAX,0x4
005fb5d5 : ADD EAX,dword ptr [EDI + EDX*0x4]
005fb5d8 : MOV EDI,dword ptr [EAX]
005fb5da : INC EDI
005fb5db : CMP EDI,dword ptr [EAX + 0x4]
005fb5de : MOV dword ptr [ESP + 0x20],EAX
005fb5e2 : JG 0x005fb749
005fb5e8 : LEA ECX,[EDI + -0x1]
005fb5eb : MOV dword ptr [ESP + 0x18],ECX
005fb5ef : JMP 0x005fb5f5
005fb5f1 : MOV ECX,dword ptr [ESP + 0x18]
005fb5f5 : MOV EAX,dword ptr [ESI + 0x3c]
005fb5f8 : FNSTCW word ptr [ESP + 0x14]
005fb5fc : MOV EDX,ECX
005fb5fe : SHR EDX,0xa
005fb601 : MOV EDX,dword ptr [EAX + EDX*0x4]
005fb604 : AND ECX,0x3ff
005fb60a : FLD float ptr [EDX + ECX*0x8]
005fb60d : LEA EBP,[EDX + ECX*0x8]
005fb610 : FSUB float ptr [ESI + 0xe0]
005fb616 : MOV ECX,EDI
005fb618 : SHR ECX,0xa
005fb61b : MOV EAX,dword ptr [EAX + ECX*0x4]
005fb61e : FMUL ST3
005fb620 : MOV EDX,EDI
005fb622 : AND EDX,0x3ff
005fb628 : LEA EBX,[EAX + EDX*0x8]
005fb62b : MOVZX EAX,word ptr [ESP + 0x14]
005fb630 : FSTP float ptr [ESP + 0x28]
005fb634 : FLD float ptr [ESP + 0x28]
005fb638 : OR EAX,0xc00
005fb63d : FADD ST0,ST1
005fb63f : MOV dword ptr [ESP + 0x28],EAX
005fb643 : FLDCW word ptr [ESP + 0x28]
005fb647 : FISTP qword ptr [ESP + 0x30]
005fb64b : MOV ECX,dword ptr [ESP + 0x30]
005fb64f : FLDCW word ptr [ESP + 0x14]
005fb653 : FLD float ptr [EBX]
005fb655 : FSUB float ptr [ESI + 0xe0]
005fb65b : FNSTCW word ptr [ESP + 0x14]
005fb65f : FMUL ST3
005fb661 : MOVZX EAX,word ptr [ESP + 0x14]
005fb666 : OR EAX,0xc00
005fb66b : FSTP float ptr [ESP + 0x28]
005fb66f : FLD float ptr [ESP + 0x28]
005fb673 : MOV dword ptr [ESP + 0x28],EAX
005fb677 : FADD ST0,ST1
005fb679 : FLDCW word ptr [ESP + 0x28]
005fb67d : FISTP qword ptr [ESP + 0x30]
005fb681 : MOV EAX,dword ptr [ESP + 0x30]
005fb685 : FLDCW word ptr [ESP + 0x14]
005fb689 : CMP ECX,EAX
005fb68b : JBE 0x005fb695
005fb68d : MOV EDX,ECX
005fb68f : MOV ECX,EAX
005fb691 : MOV EAX,EDX
005fb693 : CMP ECX,EAX
005fb695 : JNC 0x005fb6a5
005fb697 : MOV EDX,dword ptr [ESI + 0xc]
005fb69a : INC dword ptr [EDX + ECX*0x4]
005fb69d : LEA EDX,[EDX + ECX*0x4]
005fb6a0 : INC ECX
005fb6a1 : CMP ECX,EAX
005fb6a3 : JC 0x005fb697
005fb6a5 : FLD float ptr [EBP + 0x4]
005fb6a8 : FSUB float ptr [ESI + 0xe4]
005fb6ae : FNSTCW word ptr [ESP + 0x14]
005fb6b2 : MOVZX EAX,word ptr [ESP + 0x14]
005fb6b7 : FMUL ST2
005fb6b9 : OR EAX,0xc00
005fb6be : FSTP float ptr [ESP + 0x28]
005fb6c2 : FLD float ptr [ESP + 0x28]
005fb6c6 : MOV dword ptr [ESP + 0x28],EAX
005fb6ca : FADD ST0,ST1
005fb6cc : FLDCW word ptr [ESP + 0x28]
005fb6d0 : FISTP qword ptr [ESP + 0x30]
005fb6d4 : MOV EDX,dword ptr [ESP + 0x30]
005fb6d8 : FLDCW word ptr [ESP + 0x14]
005fb6dc : FLD float ptr [EBX + 0x4]
005fb6df : FSUB float ptr [ESI + 0xe4]
005fb6e5 : FNSTCW word ptr [ESP + 0x14]
005fb6e9 : FMUL ST2
005fb6eb : MOVZX EAX,word ptr [ESP + 0x14]
005fb6f0 : OR EAX,0xc00
005fb6f5 : FSTP float ptr [ESP + 0x28]
005fb6f9 : FLD float ptr [ESP + 0x28]
005fb6fd : MOV dword ptr [ESP + 0x28],EAX
005fb701 : FADD ST0,ST1
005fb703 : FLDCW word ptr [ESP + 0x28]
005fb707 : FISTP qword ptr [ESP + 0x30]
005fb70b : MOV ECX,dword ptr [ESP + 0x30]
005fb70f : FLDCW word ptr [ESP + 0x14]
005fb713 : CMP EDX,ECX
005fb715 : JBE 0x005fb71d
005fb717 : MOV EAX,EDX
005fb719 : MOV EDX,ECX
005fb71b : MOV ECX,EAX
005fb71d : MOV EAX,EDX
005fb71f : CMP EDX,ECX
005fb721 : JNC 0x005fb731
005fb723 : MOV EDX,dword ptr [ESI + 0x18]
005fb726 : INC dword ptr [EDX + EAX*0x4]
005fb729 : LEA EDX,[EDX + EAX*0x4]
005fb72c : INC EAX
005fb72d : CMP EAX,ECX
005fb72f : JC 0x005fb723
005fb731 : MOV EAX,dword ptr [ESP + 0x20]
005fb735 : INC dword ptr [ESP + 0x18]
005fb739 : INC EDI
005fb73a : CMP EDI,dword ptr [EAX + 0x4]
005fb73d : JLE 0x005fb5f1
005fb743 : MOV ECX,dword ptr [ESP + 0x24]
005fb747 : XOR EBP,EBP
005fb749 : INC ECX
005fb74a : MOV dword ptr [ESP + 0x24],ECX
005fb74e : CMP ECX,dword ptr [ESI + 0x40]
005fb751 : JC 0x005fb5c5
005fb757 : FSTP ST0
005fb759 : FSTP ST1
005fb75b : FSTP ST0
005fb75d : MOV EBX,dword ptr [ESI + 0xc]
005fb760 : MOV dword ptr [ESP + 0x2c],EBP
005fb764 : MOV dword ptr [ESP + 0x24],EBP
005fb768 : MOV dword ptr [ESP + 0x20],EBP
005fb76c : MOV dword ptr [ESP + 0x1c],EBP
005fb770 : MOV dword ptr [ESP + 0x14],EBP
005fb774 : MOV dword ptr [ESP + 0x18],EBP
005fb778 : MOV EBP,dword ptr [ESI + 0x18]
005fb77b : LEA ECX,[EBX + 0xc]
005fb77e : XOR EDI,EDI
005fb780 : XOR EDX,EDX
005fb782 : SUB EBX,EBP
005fb784 : MOV dword ptr [ESP + 0x30],EBX
005fb788 : MOV EBX,dword ptr [ESP + 0x2c]
005fb78c : LEA EAX,[EBP + 0x4]
005fb78f : MOV dword ptr [ESP + 0x28],0x10
005fb797 : MOV EBP,dword ptr [ESP + 0x30]
005fb79b : ADD EBX,dword ptr [EAX + EBP*0x1]
005fb79e : MOV EBP,dword ptr [EAX]
005fb7a0 : ADD dword ptr [ESP + 0x18],EBP
005fb7a4 : MOV EBP,dword ptr [ECX + -0x4]
005fb7a7 : ADD dword ptr [ESP + 0x20],EBP
005fb7ab : MOV EBP,dword ptr [EAX + 0x4]
005fb7ae : ADD dword ptr [ESP + 0x14],EBP
005fb7b2 : MOV EBP,dword ptr [ECX]
005fb7b4 : ADD dword ptr [ESP + 0x24],EBP
005fb7b8 : MOV EBP,dword ptr [EAX + 0x8]
005fb7bb : ADD EDI,dword ptr [ECX + -0xc]
005fb7be : ADD EDX,dword ptr [EAX + -0x4]
005fb7c1 : ADD dword ptr [ESP + 0x1c],EBP
005fb7c5 : ADD EAX,0x10
005fb7c8 : ADD ECX,0x10
005fb7cb : SUB dword ptr [ESP + 0x28],0x1
005fb7d0 : JNZ 0x005fb797
005fb7d2 : MOV ECX,dword ptr [ESP + 0x18]
005fb7d6 : MOV EAX,dword ptr [ESP + 0x14]
005fb7da : ADD ECX,EAX
005fb7dc : ADD ECX,dword ptr [ESP + 0x1c]
005fb7e0 : ADD EDX,ECX
005fb7e2 : MOV ECX,dword ptr [ESP + 0x20]
005fb7e6 : ADD EBX,ECX
005fb7e8 : ADD EBX,dword ptr [ESP + 0x24]
005fb7ec : ADD EDI,EBX
005fb7ee : CMP EDI,EDX
005fb7f0 : JNC 0x005fb8a3
005fb7f6 : XOR ECX,ECX
005fb7f8 : CMP dword ptr [ESI + 0x30],ECX
005fb7fb : JBE 0x005fb831
005fb7fd : LEA ECX,[ECX]
005fb800 : MOV EAX,dword ptr [ESI + 0x3c]
005fb803 : MOV EDX,ECX
005fb805 : SHR EDX,0xa
005fb808 : MOV EDX,dword ptr [EAX + EDX*0x4]
005fb80b : MOV EDI,ECX
005fb80d : AND EDI,0x3ff
005fb813 : FLD float ptr [EDX + EDI*0x8]
005fb816 : LEA EAX,[EDX + EDI*0x8]
005fb819 : FSTP float ptr [ESP + 0x14]
005fb81d : INC ECX
005fb81e : FLD float ptr [EAX + 0x4]
005fb821 : FCHS
005fb823 : FSTP float ptr [EAX]
005fb825 : FLD float ptr [ESP + 0x14]
005fb829 : FSTP float ptr [EAX + 0x4]
005fb82c : CMP ECX,dword ptr [ESI + 0x30]
005fb82f : JC 0x005fb800
005fb831 : FLD float ptr [ESI + 0xe0]
005fb837 : MOV byte ptr [ESI + 0x8],0x1
005fb83b : FSTP float ptr [ESP + 0x14]
005fb83f : FLD float ptr [ESI + 0xe4]
005fb845 : FCHS
005fb847 : FSTP float ptr [ESI + 0xe0]
005fb84d : FLD float ptr [ESP + 0x14]
005fb851 : FSTP float ptr [ESI + 0xe4]
005fb857 : FLD float ptr [ESI + 0xe8]
005fb85d : FSTP float ptr [ESP + 0x14]
005fb861 : FLD float ptr [ESI + 0xec]
005fb867 : FCHS
005fb869 : FSTP float ptr [ESI + 0xe8]
005fb86f : FLD float ptr [ESP + 0x14]
005fb873 : FSTP float ptr [ESI + 0xec]
005fb879 : FLD float ptr [ESI + 0xe0]
005fb87f : FSTP float ptr [ESP + 0x14]
005fb883 : FLD float ptr [ESI + 0xe8]
005fb889 : FSTP float ptr [ESI + 0xe0]
005fb88f : FLD float ptr [ESP + 0x14]
005fb893 : FSTP float ptr [ESI + 0xe8]
005fb899 : POP EDI
005fb89a : POP ESI
005fb89b : POP EBP
005fb89c : POP EBX
005fb89d : MOV ESP,EBP
005fb89f : POP EBP
005fb8a0 : RET
005fb8a1 : FSTP ST0
005fb8a3 : POP EDI
005fb8a4 : POP ESI
005fb8a5 : POP EBP
005fb8a6 : POP EBX
005fb8a7 : MOV ESP,EBP
005fb8a9 : POP EBP
005fb8aa : RET
