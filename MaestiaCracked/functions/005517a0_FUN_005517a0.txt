PROGRAM  : Maestia.exe
FUNCTION : FUN_005517a0
ENTRY    : 005517a0
BODY     : [[005517a0, 00551896] [005518a0, 0055194f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005517a0(undefined4 param_1,uint param_2)

{
  int *piVar1;
  undefined4 *puVar2;
  undefined4 *puVar3;
  int iVar4;
  int *in_ECX;
  int iVar5;
  int iVar6;
  float10 fVar7;
  longlong local_8;
  
  iVar5 = 0;
  if (param_2 == 0) {
    FUN_00551090();
    return;
  }
  if (param_2 < 8) {
    iVar6 = 8;
  }
  else {
    fVar7 = (float10)FUN_0063b270();
    local_8 = (longlong)ROUND((float)fVar7 / 0.6931472 + 1.0);
    iVar6 = 1 << ((byte)local_8 & 0x1f);
  }
  local_8 = CONCAT44(local_8._4_4_,0x143);
  puVar3 = (undefined4 *)FUN_00515d60(param_1,iVar6 * 0x24 + 8,&local_8);
  *puVar3 = 0;
  puVar3[1] = iVar6 + -1;
  if (iVar6 != 0) {
    iVar4 = 0;
    do {
      *(undefined4 *)(iVar4 + 8 + (int)puVar3) = 0xfffffffe;
      iVar4 = iVar4 + 0x24;
      iVar6 = iVar6 + -1;
    } while (iVar6 != 0);
  }
  if (*in_ECX != 0) {
    iVar6 = *(int *)(*in_ECX + 4) + 1;
    do {
      puVar2 = (undefined4 *)(*in_ECX + 8 + iVar5);
      if (*(int *)(*in_ECX + 8 + iVar5) != -2) {
        FUN_00551f20(param_1,puVar2 + 1,*(undefined4 *)(puVar2[1] + 0xc));
        FUN_00526bc0();
        if (((*(byte *)(puVar2 + 4) & 2) == 0) && (puVar2[2] != 0)) {
          FUN_00503db0();
        }
        puVar2[2] = 0;
        if (((*(byte *)(puVar2 + 4) & 1) == 0) && (puVar2[3] != 0)) {
          FUN_00503db0();
        }
        puVar2[3] = 0;
        piVar1 = (int *)(puVar2[1] + 8);
        *piVar1 = *piVar1 + -1;
        if (*piVar1 == 0) {
          FUN_00525340();
        }
        *puVar2 = 0xfffffffe;
      }
      iVar5 = iVar5 + 0x24;
      iVar6 = iVar6 + -1;
    } while (iVar6 != 0);
    FUN_00515cf0(*in_ECX);
  }
  *in_ECX = (int)puVar3;
  FUN_0054f2a0();
  return;
}



============================================================
DISASSEMBLY
============================================================
005517a0 : SUB ESP,0xc
005517a3 : MOV EAX,dword ptr [ESP + 0x14]
005517a7 : PUSH EBP
005517a8 : PUSH EDI
005517a9 : XOR EBP,EBP
005517ab : MOV EDI,ECX
005517ad : MOV dword ptr [ESP + 0x8],EDI
005517b1 : CMP EAX,EBP
005517b3 : JNZ 0x005517c2
005517b5 : CALL 0x00551090
005517ba : POP EDI
005517bb : POP EBP
005517bc : ADD ESP,0xc
005517bf : RET 0x8
005517c2 : PUSH ESI
005517c3 : CMP EAX,0x8
005517c6 : JNC 0x005517cf
005517c8 : MOV ESI,0x8
005517cd : JMP 0x00551834
005517cf : DEC EAX
005517d0 : MOV dword ptr [ESP + 0x20],EAX
005517d4 : FILD dword ptr [ESP + 0x20]
005517d8 : TEST EAX,EAX
005517da : JGE 0x005517e2
005517dc : FADD float ptr [0x00cdf0e0]
005517e2 : CALL 0x0063b270
005517e7 : FSTP float ptr [ESP + 0x20]
005517eb : FLD float ptr [ESP + 0x20]
005517ef : MOV ESI,0x1
005517f4 : FDIV double ptr [0x00b85fe0]
005517fa : FSTP float ptr [ESP + 0x20]
005517fe : FLD float ptr [ESP + 0x20]
00551802 : FADD double ptr [0x00cdf108]
00551808 : FSTP float ptr [ESP + 0x20]
0055180c : FLD float ptr [ESP + 0x20]
00551810 : FNSTCW word ptr [ESP + 0x20]
00551814 : MOVZX EAX,word ptr [ESP + 0x20]
00551819 : OR EAX,0xc00
0055181e : MOV dword ptr [ESP + 0x10],EAX
00551822 : FLDCW word ptr [ESP + 0x10]
00551826 : FISTP qword ptr [ESP + 0x10]
0055182a : MOV CL,byte ptr [ESP + 0x10]
0055182e : SHL ESI,CL
00551830 : FLDCW word ptr [ESP + 0x20]
00551834 : LEA EAX,[ESP + 0x10]
00551838 : PUSH EAX
00551839 : MOV EAX,dword ptr [ESP + 0x20]
0055183d : LEA ECX,[ESI + ESI*0x8]
00551840 : LEA EDX,[ECX*0x4 + 0x8]
00551847 : PUSH EDX
00551848 : PUSH EAX
00551849 : MOV dword ptr [ESP + 0x2c],EBP
0055184d : MOV dword ptr [ESP + 0x1c],0x143
00551855 : CALL 0x00515d60
0055185a : MOV dword ptr [ESP + 0x20],EAX
0055185e : MOV dword ptr [EAX],EBP
00551860 : MOV EDX,dword ptr [ESP + 0x20]
00551864 : LEA ECX,[ESI + -0x1]
00551867 : MOV dword ptr [EDX + 0x4],ECX
0055186a : CMP ESI,EBP
0055186c : JBE 0x00551884
0055186e : XOR EAX,EAX
00551870 : MOV ECX,dword ptr [ESP + 0x20]
00551874 : MOV dword ptr [EAX + ECX*0x1 + 0x8],0xfffffffe
0055187c : ADD EAX,0x24
0055187f : SUB ESI,0x1
00551882 : JNZ 0x00551870
00551884 : MOV EAX,dword ptr [EDI]
00551886 : CMP EAX,EBP
00551888 : JZ 0x00551930
0055188e : MOV EAX,dword ptr [EAX + 0x4]
00551891 : PUSH EBX
00551892 : LEA EBX,[EAX + 0x1]
00551895 : JMP 0x005518a4
005518a0 : MOV EDI,dword ptr [ESP + 0x10]
005518a4 : MOV EDX,dword ptr [EDI]
005518a6 : CMP dword ptr [EDX + EBP*0x1 + 0x8],-0x2
005518ab : LEA EDI,[EDX + EBP*0x1 + 0x8]
005518af : JZ 0x00551917
005518b1 : MOV EAX,dword ptr [EDI + 0x4]
005518b4 : MOV ECX,dword ptr [EAX + 0xc]
005518b7 : MOV EDX,dword ptr [ESP + 0x20]
005518bb : LEA ESI,[EDI + 0x4]
005518be : PUSH ECX
005518bf : PUSH ESI
005518c0 : PUSH EDX
005518c1 : LEA ECX,[ESP + 0x30]
005518c5 : CALL 0x00551f20
005518ca : LEA ECX,[ESI + 0x10]
005518cd : CALL 0x00526bc0
005518d2 : TEST byte ptr [ESI + 0xc],0x2
005518d6 : JNZ 0x005518e4
005518d8 : MOV ECX,dword ptr [ESI + 0x4]
005518db : TEST ECX,ECX
005518dd : JZ 0x005518e4
005518df : CALL 0x00503db0
005518e4 : TEST byte ptr [ESI + 0xc],0x1
005518e8 : MOV dword ptr [ESI + 0x4],0x0
005518ef : JNZ 0x005518fd
005518f1 : MOV ECX,dword ptr [ESI + 0x8]
005518f4 : TEST ECX,ECX
005518f6 : JZ 0x005518fd
005518f8 : CALL 0x00503db0
005518fd : MOV dword ptr [ESI + 0x8],0x0
00551904 : MOV ECX,dword ptr [ESI]
00551906 : ADD dword ptr [ECX + 0x8],-0x1
0055190a : JNZ 0x00551911
0055190c : CALL 0x00525340
00551911 : MOV dword ptr [EDI],0xfffffffe
00551917 : ADD EBP,0x24
0055191a : SUB EBX,0x1
0055191d : JNZ 0x005518a0
0055191f : MOV EAX,dword ptr [ESP + 0x10]
00551923 : MOV ECX,dword ptr [EAX]
00551925 : PUSH ECX
00551926 : CALL 0x00515cf0
0055192b : MOV EDI,dword ptr [ESP + 0x10]
0055192f : POP EBX
00551930 : MOV EDX,dword ptr [ESP + 0x20]
00551934 : LEA ECX,[ESP + 0x20]
00551938 : MOV dword ptr [EDI],EDX
0055193a : MOV dword ptr [ESP + 0x20],0x0
00551942 : CALL 0x0054f2a0
00551947 : POP ESI
00551948 : POP EDI
00551949 : POP EBP
0055194a : ADD ESP,0xc
0055194d : RET 0x8
