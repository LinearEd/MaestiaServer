PROGRAM  : Maestia.exe
FUNCTION : FUN_006ada20
ENTRY    : 006ada20
BODY     : [[006ada20, 006adabd]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006ada20(int *param_1,uint param_2,uint param_3)

{
  uint uVar1;
  bool bVar2;
  int in_EAX;
  int iVar3;
  uint uVar4;
  undefined4 uVar5;
  undefined4 uVar6;
  uint uVar7;
  undefined4 *puVar8;
  undefined2 *puVar9;
  int iVar10;
  bool bVar11;
  undefined4 uStack_374;
  undefined4 uStack_370;
  undefined4 uStack_36c;
  uint uStack_368;
  uint local_364;
  int iStack_360;
  int iStack_35c;
  undefined2 *puStack_358;
  int iStack_354;
  undefined4 uStack_350;
  int iStack_34c;
  int iStack_348;
  int iStack_344;
  uint uStack_340;
  int iStack_33c;
  int iStack_338;
  int iStack_334;
  int iStack_330;
  undefined1 auStack_32c [40];
  undefined4 uStack_304;
  byte bStack_2e2;
  int iStack_2e0;
  undefined4 uStack_3c;
  
  uVar7 = *(uint *)(in_EAX + 4);
  iVar10 = *(int *)(uVar7 + 0x2b8);
  bVar11 = false;
  local_364 = uVar7;
  if ((*(int *)(iVar10 + 0x5c4) == 0xffff) || (*(int *)(iVar10 + 0x4ac) == 0)) {
    if (*(uint *)(iVar10 + 0xc) <= param_2) {
      return 6;
    }
  }
  else {
    param_2 = FUN_006aa050();
    if (param_2 == 0) {
      return 6;
    }
  }
  if ((param_3 & 0x400) != 0) {
    param_3 = param_3 | 3;
  }
  *(undefined4 *)(in_EAX + 0xa4) = 0x10000;
  *(undefined4 *)(in_EAX + 0xa8) = 0x10000;
  if (param_1 != (int *)0x0) {
    *(int *)(in_EAX + 0xa4) = param_1[4];
    *(int *)(in_EAX + 0xa8) = param_1[5];
    uStack_368 = *(uint *)(*param_1 + 0x214);
    uStack_374 = *(undefined4 *)(*param_1 + 0x68);
    if ((((param_1[0xb] != -1) && (*(int *)(uStack_368 + 0x8c) != 0)) && ((param_3 & 8) == 0)) &&
       (iVar3 = (**(code **)(uStack_368 + 0x68))
                          (uVar7,param_1[0xb],param_2,param_3,uStack_374,in_EAX + 0x4c,&uStack_370),
       iVar3 == 0)) {
      *(undefined2 *)(in_EAX + 0x6e) = 0;
      *(undefined2 *)(in_EAX + 0x6c) = 0;
      *(uint *)(in_EAX + 0x18) = (uStack_370 >> 8 & 0xff) << 6;
      *(uint *)(in_EAX + 0x1c) = (uStack_370 & 0xff) << 6;
      *(int *)(in_EAX + 0x20) = (int)uStack_370._2_1_ << 6;
      *(int *)(in_EAX + 0x24) = (int)uStack_370._3_1_ << 6;
      *(uint *)(in_EAX + 0x28) = (uStack_36c & 0xff) << 6;
      *(int *)(in_EAX + 0x2c) = (int)uStack_36c._1_1_ << 6;
      *(int *)(in_EAX + 0x30) = (int)uStack_36c._2_1_ << 6;
      *(uint *)(in_EAX + 0x34) = (uStack_36c >> 0x18) << 6;
      *(undefined4 *)(in_EAX + 0x48) = 0x62697473;
      if ((param_3 & 0x10) == 0) {
        *(int *)(in_EAX + 100) = (int)uStack_370._2_1_;
        *(int *)(in_EAX + 0x68) = (int)uStack_370._3_1_;
        return 0;
      }
      *(int *)(in_EAX + 0x68) = (int)uStack_36c._2_1_;
      *(int *)(in_EAX + 100) = (int)uStack_36c._1_1_;
      return 0;
    }
  }
  if ((param_3 & 0x4000) != 0) {
    return 6;
  }
  if (*(int *)(iVar10 + 0x780) == 0) {
    uStack_350 = *(undefined4 *)(iVar10 + 0x574);
    iStack_34c = *(int *)(iVar10 + 0x578);
    iStack_348 = *(int *)(iVar10 + 0x57c);
    iStack_344 = *(int *)(iVar10 + 0x580);
    uStack_370 = *(int *)(iVar10 + 0x588);
    uStack_36c = *(int *)(iVar10 + 0x58c);
  }
  else {
    uVar4 = func_0x006a9f40(param_2);
    uVar1 = *(uint *)(iVar10 + 0x584);
    iVar3 = *(int *)(iVar10 + 0x784 + (uVar4 & 0xff) * 4);
    uStack_368 = *(uint *)(iVar3 + 0x40);
    uStack_350 = *(undefined4 *)(iVar3 + 0x30);
    iStack_34c = *(int *)(iVar3 + 0x34);
    iStack_348 = *(int *)(iVar3 + 0x38);
    iStack_344 = *(int *)(iVar3 + 0x3c);
    iVar3 = *(int *)(iVar10 + 0x784 + (uVar4 & 0xff) * 4);
    uStack_36c = *(int *)(iVar3 + 0x48);
    uStack_370 = *(int *)(iVar3 + 0x44);
    bVar11 = uVar1 != uStack_368;
    if (bVar11) {
      uVar5 = FUN_00685d60(*(undefined4 *)(in_EAX + 0xa4),uVar1,uStack_368);
      *(undefined4 *)(in_EAX + 0xa4) = uVar5;
      uVar5 = FUN_00685d60(*(undefined4 *)(in_EAX + 0xa8),uVar1,uStack_368);
      *(undefined4 *)(in_EAX + 0xa8) = uVar5;
    }
  }
  puStack_358 = (undefined2 *)(in_EAX + 0x6c);
  *puStack_358 = 0;
  uStack_340 = param_3 & 1;
  *(undefined2 *)(in_EAX + 0x6e) = 0;
  if (uStack_340 == 0) {
    uStack_368 = CONCAT31(uStack_368._1_3_,1);
    if ((param_3 & 2) == 0) goto code_r0x006adcd9;
  }
  uStack_368 = uStack_368 & 0xffffff00;
code_r0x006adcd9:
  *(undefined4 *)(in_EAX + 0x48) = 0x6f75746c;
  func_0x006abe10(uVar7,param_1,uStack_368,(int)param_3 >> 0x10 & 0xf);
  bStack_2e2 = (byte)(param_3 >> 10) & 1;
  iStack_354 = FUN_006ac110(param_2);
  if (iStack_354 == 0) {
    iStack_354 = func_0x006abe80(param_1,param_2);
    uVar7 = local_364;
    if (iStack_354 == 0) {
      iStack_354 = FUN_006ac300(auStack_32c,uStack_374,iStack_360);
      FUN_006ac130();
      uVar7 = local_364;
      if (*(int *)(iVar10 + 0x4d0) != 0) {
        *(int *)(in_EAX + 0x88) =
             *(int *)(*(int *)(iVar10 + 0x4d0) + param_2 * 4) + -1 + *(int *)(iVar10 + 0x4d4);
        *(int *)(in_EAX + 0x8c) = iStack_360;
      }
    }
  }
  func_0x006abdc0();
  if (iStack_354 == 0) {
    if ((param_3 & 0x400) != 0) {
      iVar10 = *(int *)(in_EAX + 0x9c);
      *(undefined4 *)(in_EAX + 0x20) = uStack_304;
      *(undefined4 *)(in_EAX + 0x28) = uStack_3c;
      *(undefined4 *)(iVar10 + 0xc) = uStack_350;
      *(int *)(iVar10 + 0x10) = iStack_34c;
      *(int *)(iVar10 + 0x14) = iStack_348;
      *(int *)(iVar10 + 0x18) = iStack_344;
      *(uint *)(iVar10 + 0x1c) = uStack_370;
      *(uint *)(iVar10 + 0x20) = uStack_36c;
      *(undefined1 *)(iVar10 + 8) = 1;
      return 0;
    }
    *(undefined4 *)(in_EAX + 0x28) = uStack_3c;
    *(undefined4 *)(in_EAX + 0x38) = uStack_3c;
    *(undefined1 *)(*(int *)(in_EAX + 0x9c) + 8) = 0;
    if (((*(char *)(uVar7 + 0x128) == '\0') || (*(short *)(uVar7 + 0x14e) == 0)) ||
       (*(int *)(uVar7 + 0x150) == 0)) {
      bVar2 = false;
      if (*(short *)(uVar7 + 0x170) == -1) {
        *(int *)(in_EAX + 0x34) = (int)*(short *)(uVar7 + 0xdc) - (int)*(short *)(uVar7 + 0xde);
      }
      else {
        *(int *)(in_EAX + 0x34) = (int)*(short *)(uVar7 + 0x1b6) - (int)*(short *)(uVar7 + 0x1b8);
      }
    }
    else {
      uStack_374 = 0;
      local_364 = 0;
      bVar2 = true;
      (**(code **)(*(int *)(uVar7 + 0x214) + 0x9c))(uVar7,1,param_2,&uStack_374,&local_364);
      *(int *)(in_EAX + 0x30) = (int)(short)uStack_374;
      *(uint *)(in_EAX + 0x34) = local_364 & 0xffff;
    }
    puVar9 = puStack_358;
    *(undefined4 *)(in_EAX + 0x3c) = *(undefined4 *)(in_EAX + 0x34);
    *(undefined4 *)(in_EAX + 0x48) = 0x6f75746c;
    *(undefined4 *)(in_EAX + 0x7c) = 0;
    if ((param_1 != (int *)0x0) && (*(ushort *)((int)param_1 + 0xe) < 0x18)) {
      *(undefined4 *)(in_EAX + 0x7c) = 0x100;
    }
    *(uint *)(in_EAX + 0x7c) = *(uint *)(in_EAX + 0x7c) | 4;
    if (((iStack_344 != 0x10000) || (iStack_34c != 0)) || (iStack_348 != 0)) {
      FUN_006874a0(puStack_358,&uStack_350);
    }
    iVar10 = uStack_36c;
    if ((uStack_370 != 0) || (uStack_36c != 0)) {
      FUN_00687400(puVar9,uStack_370,uStack_36c);
    }
    iStack_360 = *(int *)(in_EAX + 0x28);
    iStack_35c = 0;
    FUN_00687440(&iStack_360,&uStack_350);
    iStack_35c = *(int *)(in_EAX + 0x34);
    *(uint *)(in_EAX + 0x28) = iStack_360 + uStack_370;
    iStack_360 = 0;
    FUN_00687440(&iStack_360,&uStack_350);
    *(int *)(in_EAX + 0x34) = iStack_35c + iVar10;
    if ((uStack_340 == 0) || (bVar11)) {
      uStack_374 = *(undefined4 *)(in_EAX + 0xa8);
      puVar8 = *(undefined4 **)(puVar9 + 2);
      uVar5 = *(undefined4 *)(in_EAX + 0xa4);
      if (((char)uStack_368 == '\0') || (iStack_2e0 == 0)) {
        for (iVar10 = (int)(short)puStack_358[1]; 0 < iVar10; iVar10 = iVar10 + -1) {
          uVar6 = FUN_00685ea0(*puVar8,uVar5);
          *puVar8 = uVar6;
          uVar6 = FUN_00685ea0(puVar8[1],uStack_374);
          puVar8[1] = uVar6;
          puVar8 = puVar8 + 2;
        }
      }
      uVar5 = FUN_00685ea0(*(undefined4 *)(in_EAX + 0x28),uVar5);
      *(undefined4 *)(in_EAX + 0x28) = uVar5;
      uVar5 = FUN_00685ea0(*(undefined4 *)(in_EAX + 0x34),uStack_374);
      *(undefined4 *)(in_EAX + 0x34) = uVar5;
      puVar9 = puStack_358;
    }
    FUN_00687370(puVar9,&iStack_33c);
    *(int *)(in_EAX + 0x18) = iStack_334 - iStack_33c;
    *(int *)(in_EAX + 0x1c) = iStack_330 - iStack_338;
    *(int *)(in_EAX + 0x20) = iStack_33c;
    *(int *)(in_EAX + 0x24) = iStack_330;
    if (bVar2) {
      *(int *)(in_EAX + 0x2c) = -((iStack_334 - iStack_33c) / 2);
      return iStack_354;
    }
    FUN_006866c0((int *)(in_EAX + 0x18),*(undefined4 *)(in_EAX + 0x34));
  }
  return iStack_354;
}



============================================================
DISASSEMBLY
============================================================
006ada20 : SUB ESP,0x378
006ada26 : PUSH EBX
006ada27 : PUSH EBP
006ada28 : PUSH ESI
006ada29 : MOV ESI,EAX
006ada2b : MOV EBX,dword ptr [ESI + 0x4]
006ada2e : MOV EBP,dword ptr [EBX + 0x2b8]
006ada34 : CMP dword ptr [EBP + 0x5c4],0xffff
006ada3e : MOV dword ptr [ESP + 0x20],EBX
006ada42 : MOV byte ptr [ESP + 0xe],0x0
006ada47 : JZ 0x006ada7e
006ada49 : CMP dword ptr [EBP + 0x4ac],0x0
006ada50 : JZ 0x006ada7e
006ada52 : MOV ECX,dword ptr [ESP + 0x38c]
006ada59 : LEA EDX,[EBP + 0x4a0]
006ada5f : CALL 0x006aa050
006ada64 : MOV dword ptr [ESP + 0x38c],EAX
006ada6b : TEST EAX,EAX
006ada6d : JNZ 0x006ada8a
006ada6f : POP ESI
006ada70 : POP EBP
006ada71 : MOV EAX,0x6
006ada76 : POP EBX
006ada77 : ADD ESP,0x378
006ada7d : RET
006ada7e : MOV EAX,dword ptr [ESP + 0x38c]
006ada85 : CMP EAX,dword ptr [EBP + 0xc]
006ada88 : JNC 0x006ada6f
006ada8a : MOV EDX,dword ptr [ESP + 0x390]
006ada91 : TEST EDX,0x400
006ada97 : JZ 0x006adaa3
006ada99 : OR EDX,0x3
006ada9c : MOV dword ptr [ESP + 0x390],EDX
006adaa3 : PUSH EDI
006adaa4 : MOV EDI,dword ptr [ESP + 0x38c]
006adaab : MOV EAX,0x10000
006adab0 : MOV dword ptr [ESI + 0xa4],EAX
006adab6 : MOV dword ptr [ESI + 0xa8],EAX
006adabc : TEST EDI,EDI
