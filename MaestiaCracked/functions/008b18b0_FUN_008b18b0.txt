PROGRAM  : Maestia.exe
FUNCTION : FUN_008b18b0
ENTRY    : 008b18b0
BODY     : [[008b18b0, 008b1c99]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008b18b0(int param_1)

{
  int iVar1;
  long _Offset;
  wchar_t *_Source;
  FILE *_File;
  long lVar2;
  void *pvVar3;
  int *piVar4;
  int local_228;
  undefined4 local_224;
  undefined4 local_220;
  uint local_21c;
  uint local_218;
  long local_214;
  wchar_t local_210 [259];
  undefined2 local_a;
  uint local_8;
  
  local_8 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  _memset(local_210,0,0x208);
  if (*(uint *)(param_1 + 0x50) < 8) {
    _Source = (wchar_t *)(param_1 + 0x3c);
  }
  else {
    _Source = *(wchar_t **)(param_1 + 0x3c);
  }
  _wcsncpy(local_210,_Source,0x104);
  local_a = 0;
  _File = __wfopen(local_210,(wchar_t *)&PTR_LAB_00c4c26c);
  if (_File != (FILE *)0x0) {
    local_220 = 0x19770607;
    local_218 = 0x735a9934;
    lVar2 = _ftell(_File);
    _fwrite(&local_218,4,1,_File);
    local_214 = _ftell(_File);
    _fwrite(&local_214,4,1,_File);
    _fwrite(&local_220,4,1,_File);
    FUN_00a0a1d0(local_214,lVar2);
    local_220 = 0x19790901;
    local_218 = 0xcba34a67;
    lVar2 = _ftell(_File);
    _fwrite(&local_218,4,1,_File);
    local_214 = _ftell(_File);
    _fwrite(&local_214,4,1,_File);
    _fwrite(&local_220,4,1,_File);
    FUN_00a0a1d0(local_214,lVar2);
    local_218 = 0xbedc8460;
    lVar2 = _ftell(_File);
    _fwrite(&local_218,4,1,_File);
    local_214 = _ftell(_File);
    _fwrite(&local_214,4,1,_File);
    _fwrite((void *)(param_1 + 4),4,1,_File);
    FUN_00a0a1d0(local_214,lVar2);
    local_218 = 0xbadc3749;
    lVar2 = _ftell(_File);
    _fwrite(&local_218,4,1,_File);
    local_214 = _ftell(_File);
    _fwrite(&local_214,4,1,_File);
    local_218 = (uint)*(ushort *)(param_1 + 0x1c);
    _fwrite(&local_218,2,1,_File);
    if (*(uint *)(param_1 + 0x20) < 8) {
      pvVar3 = (void *)(param_1 + 0xc);
    }
    else {
      pvVar3 = *(void **)(param_1 + 0xc);
    }
    _fwrite(pvVar3,2,local_218 & 0xffff,_File);
    FUN_00a0a1d0(local_214,lVar2);
    local_218 = 0x832409be;
    lVar2 = _ftell(_File);
    _fwrite(&local_218,4,1,_File);
    local_214 = _ftell(_File);
    _fwrite(&local_214,4,1,_File);
    _fwrite((void *)(param_1 + 0x24),2,1,_File);
    FUN_00a0a1d0(local_214,lVar2);
    piVar4 = *(int **)(param_1 + 0x2c);
    local_21c = 0;
    local_224 = 0;
    if (piVar4 != *(int **)(param_1 + 0x30)) {
      do {
        local_218 = 0x983751ca;
        lVar2 = _ftell(_File);
        _fwrite(&local_218,4,1,_File);
        local_214 = _ftell(_File);
        _fwrite(&local_214,4,1,_File);
        local_21c = (uint)*(ushort *)(*piVar4 + 0x14);
        local_224 = *(undefined4 *)(*piVar4 + 0x1c);
        _fwrite(&local_21c,2,1,_File);
        iVar1 = *piVar4;
        if (*(uint *)(iVar1 + 0x18) < 8) {
          pvVar3 = (void *)(iVar1 + 4);
        }
        else {
          pvVar3 = *(void **)(iVar1 + 4);
        }
        _fwrite(pvVar3,2,local_21c & 0xffff,_File);
        _fwrite(&local_224,4,1,_File);
        _Offset = local_214;
        local_218 = _ftell(_File);
        _fseek(_File,_Offset,0);
        local_228 = local_218 - lVar2;
        _fwrite(&local_228,4,1,_File);
        _fseek(_File,local_218,0);
        piVar4 = piVar4 + 1;
      } while (piVar4 != *(int **)(param_1 + 0x30));
    }
    _fclose(_File);
    __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
    return;
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
008b18b0 : PUSH EBP
008b18b1 : MOV EBP,ESP
008b18b3 : SUB ESP,0x22c
008b18b9 : MOV EAX,[0x00d66fa0]
008b18be : XOR EAX,EBP
008b18c0 : MOV dword ptr [EBP + -0x4],EAX
008b18c3 : PUSH EBX
008b18c4 : MOV EBX,dword ptr [EBP + 0x8]
008b18c7 : PUSH ESI
008b18c8 : PUSH 0x208
008b18cd : LEA EAX,[EBP + 0xfffffdf4]
008b18d3 : PUSH 0x0
008b18d5 : PUSH EAX
008b18d6 : CALL 0x0063b700
008b18db : ADD ESP,0xc
008b18de : CMP dword ptr [EBX + 0x50],0x8
008b18e2 : JC 0x008b18e9
008b18e4 : MOV EAX,dword ptr [EBX + 0x3c]
008b18e7 : JMP 0x008b18ec
008b18e9 : LEA EAX,[EBX + 0x3c]
008b18ec : PUSH 0x104
008b18f1 : PUSH EAX
008b18f2 : LEA ECX,[EBP + 0xfffffdf4]
008b18f8 : PUSH ECX
008b18f9 : CALL 0x00634e39
008b18fe : LEA EAX,[EBP + 0xfffffdf4]
008b1904 : XOR EDX,EDX
008b1906 : PUSH 0xc4c26c
008b190b : PUSH EAX
008b190c : MOV word ptr [EBP + -0x6],DX
008b1910 : CALL 0x00636404
008b1915 : MOV ESI,EAX
008b1917 : ADD ESP,0x14
008b191a : TEST ESI,ESI
008b191c : JNZ 0x008b1932
008b191e : POP ESI
008b191f : XOR AL,AL
008b1921 : POP EBX
008b1922 : MOV ECX,dword ptr [EBP + -0x4]
008b1925 : XOR ECX,EBP
008b1927 : CALL 0x00633e6b
008b192c : MOV ESP,EBP
008b192e : POP EBP
008b192f : RET 0x4
008b1932 : PUSH EDI
008b1933 : PUSH ESI
008b1934 : MOV dword ptr [EBP + 0xfffffde4],0x19770607
008b193e : MOV dword ptr [EBP + 0xfffffdec],0x735a9934
008b1948 : CALL 0x0063751f
008b194d : PUSH ESI
008b194e : PUSH 0x1
008b1950 : LEA ECX,[EBP + 0xfffffdec]
008b1956 : PUSH 0x4
008b1958 : PUSH ECX
008b1959 : MOV EDI,EAX
008b195b : CALL 0x006376ef
008b1960 : PUSH ESI
008b1961 : CALL 0x0063751f
008b1966 : PUSH ESI
008b1967 : PUSH 0x1
008b1969 : LEA EDX,[EBP + 0xfffffdf0]
008b196f : PUSH 0x4
008b1971 : PUSH EDX
008b1972 : MOV dword ptr [EBP + 0xfffffdf0],EAX
008b1978 : CALL 0x006376ef
008b197d : PUSH ESI
008b197e : PUSH 0x1
008b1980 : LEA EAX,[EBP + 0xfffffde4]
008b1986 : PUSH 0x4
008b1988 : PUSH EAX
008b1989 : CALL 0x006376ef
008b198e : MOV ECX,dword ptr [EBP + 0xfffffdf0]
008b1994 : PUSH EDI
008b1995 : PUSH ECX
008b1996 : CALL 0x00a0a1d0
008b199b : ADD ESP,0x40
008b199e : PUSH ESI
008b199f : MOV dword ptr [EBP + 0xfffffde4],0x19790901
008b19a9 : MOV dword ptr [EBP + 0xfffffdec],0xcba34a67
008b19b3 : CALL 0x0063751f
008b19b8 : PUSH ESI
008b19b9 : PUSH 0x1
008b19bb : LEA EDX,[EBP + 0xfffffdec]
008b19c1 : PUSH 0x4
008b19c3 : PUSH EDX
008b19c4 : MOV EDI,EAX
008b19c6 : CALL 0x006376ef
008b19cb : PUSH ESI
008b19cc : CALL 0x0063751f
008b19d1 : PUSH ESI
008b19d2 : PUSH 0x1
008b19d4 : MOV dword ptr [EBP + 0xfffffdf0],EAX
008b19da : LEA EAX,[EBP + 0xfffffdf0]
008b19e0 : PUSH 0x4
008b19e2 : PUSH EAX
008b19e3 : CALL 0x006376ef
008b19e8 : PUSH ESI
008b19e9 : PUSH 0x1
008b19eb : LEA ECX,[EBP + 0xfffffde4]
008b19f1 : PUSH 0x4
008b19f3 : PUSH ECX
008b19f4 : CALL 0x006376ef
008b19f9 : MOV EDX,dword ptr [EBP + 0xfffffdf0]
008b19ff : PUSH EDI
008b1a00 : PUSH EDX
008b1a01 : CALL 0x00a0a1d0
008b1a06 : ADD ESP,0x40
008b1a09 : PUSH ESI
008b1a0a : MOV dword ptr [EBP + 0xfffffdec],0xbedc8460
008b1a14 : CALL 0x0063751f
008b1a19 : PUSH ESI
008b1a1a : PUSH 0x1
008b1a1c : MOV EDI,EAX
008b1a1e : LEA EAX,[EBP + 0xfffffdec]
008b1a24 : PUSH 0x4
008b1a26 : PUSH EAX
008b1a27 : CALL 0x006376ef
008b1a2c : PUSH ESI
008b1a2d : CALL 0x0063751f
008b1a32 : PUSH ESI
008b1a33 : PUSH 0x1
008b1a35 : PUSH 0x4
008b1a37 : LEA ECX,[EBP + 0xfffffdf0]
008b1a3d : MOV dword ptr [EBP + 0xfffffdf0],EAX
008b1a43 : PUSH ECX
008b1a44 : CALL 0x006376ef
008b1a49 : PUSH ESI
008b1a4a : PUSH 0x1
008b1a4c : LEA EDX,[EBX + 0x4]
008b1a4f : PUSH 0x4
008b1a51 : PUSH EDX
008b1a52 : CALL 0x006376ef
008b1a57 : MOV EAX,dword ptr [EBP + 0xfffffdf0]
008b1a5d : PUSH EDI
008b1a5e : PUSH EAX
008b1a5f : CALL 0x00a0a1d0
008b1a64 : ADD ESP,0x40
008b1a67 : PUSH ESI
008b1a68 : MOV dword ptr [EBP + 0xfffffdec],0xbadc3749
008b1a72 : CALL 0x0063751f
008b1a77 : PUSH ESI
008b1a78 : PUSH 0x1
008b1a7a : LEA ECX,[EBP + 0xfffffdec]
008b1a80 : PUSH 0x4
008b1a82 : PUSH ECX
008b1a83 : MOV EDI,EAX
008b1a85 : CALL 0x006376ef
008b1a8a : PUSH ESI
008b1a8b : CALL 0x0063751f
008b1a90 : PUSH ESI
008b1a91 : PUSH 0x1
008b1a93 : LEA EDX,[EBP + 0xfffffdf0]
008b1a99 : PUSH 0x4
008b1a9b : PUSH EDX
008b1a9c : MOV dword ptr [EBP + 0xfffffdf0],EAX
008b1aa2 : CALL 0x006376ef
008b1aa7 : MOVZX EAX,word ptr [EBX + 0x1c]
008b1aab : PUSH ESI
008b1aac : PUSH 0x1
008b1aae : LEA ECX,[EBP + 0xfffffdec]
008b1ab4 : PUSH 0x2
008b1ab6 : PUSH ECX
008b1ab7 : MOV dword ptr [EBP + 0xfffffdec],EAX
008b1abd : CALL 0x006376ef
008b1ac2 : ADD ESP,0x38
008b1ac5 : CMP dword ptr [EBX + 0x20],0x8
008b1ac9 : JC 0x008b1ad0
008b1acb : MOV EAX,dword ptr [EBX + 0xc]
008b1ace : JMP 0x008b1ad3
008b1ad0 : LEA EAX,[EBX + 0xc]
008b1ad3 : MOVZX EDX,word ptr [EBP + 0xfffffdec]
008b1ada : PUSH ESI
008b1adb : PUSH EDX
008b1adc : PUSH 0x2
008b1ade : PUSH EAX
008b1adf : CALL 0x006376ef
008b1ae4 : MOV EAX,dword ptr [EBP + 0xfffffdf0]
008b1aea : PUSH EDI
008b1aeb : PUSH EAX
008b1aec : CALL 0x00a0a1d0
008b1af1 : PUSH ESI
008b1af2 : MOV dword ptr [EBP + 0xfffffdec],0x832409be
008b1afc : CALL 0x0063751f
008b1b01 : PUSH ESI
008b1b02 : PUSH 0x1
008b1b04 : LEA ECX,[EBP + 0xfffffdec]
008b1b0a : PUSH 0x4
008b1b0c : PUSH ECX
008b1b0d : MOV EDI,EAX
008b1b0f : CALL 0x006376ef
008b1b14 : PUSH ESI
008b1b15 : CALL 0x0063751f
008b1b1a : PUSH ESI
008b1b1b : PUSH 0x1
008b1b1d : LEA EDX,[EBP + 0xfffffdf0]
008b1b23 : PUSH 0x4
008b1b25 : PUSH EDX
008b1b26 : MOV dword ptr [EBP + 0xfffffdf0],EAX
008b1b2c : CALL 0x006376ef
008b1b31 : ADD ESP,0x40
008b1b34 : PUSH ESI
008b1b35 : PUSH 0x1
008b1b37 : LEA EAX,[EBX + 0x24]
008b1b3a : PUSH 0x2
008b1b3c : PUSH EAX
008b1b3d : CALL 0x006376ef
008b1b42 : MOV ECX,dword ptr [EBP + 0xfffffdf0]
008b1b48 : PUSH EDI
008b1b49 : PUSH ECX
008b1b4a : CALL 0x00a0a1d0
008b1b4f : MOV EDI,dword ptr [EBX + 0x2c]
008b1b52 : XOR EAX,EAX
008b1b54 : ADD ESP,0x18
008b1b57 : MOV dword ptr [EBP + 0xfffffde8],EAX
008b1b5d : MOV dword ptr [EBP + 0xfffffde0],EAX
008b1b63 : CMP EDI,dword ptr [EBX + 0x30]
008b1b66 : JZ 0x008b1c7c
008b1b6c : LEA ESP,[ESP]
008b1b70 : PUSH ESI
008b1b71 : MOV dword ptr [EBP + 0xfffffdec],0x983751ca
008b1b7b : CALL 0x0063751f
008b1b80 : PUSH ESI
008b1b81 : PUSH 0x1
008b1b83 : LEA EDX,[EBP + 0xfffffdec]
008b1b89 : PUSH 0x4
008b1b8b : PUSH EDX
008b1b8c : MOV dword ptr [EBP + 0xfffffdd8],EAX
008b1b92 : CALL 0x006376ef
008b1b97 : PUSH ESI
008b1b98 : CALL 0x0063751f
008b1b9d : PUSH ESI
008b1b9e : PUSH 0x1
008b1ba0 : MOV dword ptr [EBP + 0xfffffdf0],EAX
008b1ba6 : LEA EAX,[EBP + 0xfffffdf0]
008b1bac : PUSH 0x4
008b1bae : PUSH EAX
008b1baf : CALL 0x006376ef
008b1bb4 : MOV ECX,dword ptr [EDI]
008b1bb6 : MOVZX EDX,word ptr [ECX + 0x14]
008b1bba : PUSH ESI
008b1bbb : MOV dword ptr [EBP + 0xfffffde8],EDX
008b1bc1 : MOV EAX,dword ptr [EDI]
008b1bc3 : MOV ECX,dword ptr [EAX + 0x1c]
008b1bc6 : PUSH 0x1
008b1bc8 : LEA EDX,[EBP + 0xfffffde8]
008b1bce : PUSH 0x2
008b1bd0 : PUSH EDX
008b1bd1 : MOV dword ptr [EBP + 0xfffffde0],ECX
008b1bd7 : CALL 0x006376ef
008b1bdc : MOV EAX,dword ptr [EDI]
008b1bde : ADD ESP,0x38
008b1be1 : CMP dword ptr [EAX + 0x18],0x8
008b1be5 : JC 0x008b1bec
008b1be7 : MOV EAX,dword ptr [EAX + 0x4]
008b1bea : JMP 0x008b1bef
008b1bec : ADD EAX,0x4
008b1bef : MOVZX ECX,word ptr [EBP + 0xfffffde8]
008b1bf6 : PUSH ESI
008b1bf7 : PUSH ECX
008b1bf8 : PUSH 0x2
008b1bfa : PUSH EAX
008b1bfb : CALL 0x006376ef
008b1c00 : PUSH ESI
008b1c01 : PUSH 0x1
008b1c03 : LEA EDX,[EBP + 0xfffffde0]
008b1c09 : PUSH 0x4
008b1c0b : PUSH EDX
008b1c0c : CALL 0x006376ef
008b1c11 : MOV EAX,dword ptr [EBP + 0xfffffdf0]
008b1c17 : PUSH ESI
008b1c18 : MOV dword ptr [EBP + 0xfffffdd4],EAX
008b1c1e : CALL 0x0063751f
008b1c23 : MOV ECX,dword ptr [EBP + 0xfffffdd4]
008b1c29 : PUSH 0x0
008b1c2b : PUSH ECX
008b1c2c : PUSH ESI
008b1c2d : MOV dword ptr [EBP + 0xfffffdec],EAX
008b1c33 : CALL 0x006377fb
008b1c38 : MOV EDX,dword ptr [EBP + 0xfffffdec]
008b1c3e : SUB EDX,dword ptr [EBP + 0xfffffdd8]
008b1c44 : PUSH ESI
008b1c45 : PUSH 0x1
008b1c47 : LEA EAX,[EBP + 0xfffffddc]
008b1c4d : PUSH 0x4
008b1c4f : PUSH EAX
008b1c50 : MOV dword ptr [EBP + 0xfffffddc],EDX
008b1c56 : CALL 0x006376ef
008b1c5b : MOV ECX,dword ptr [EBP + 0xfffffdec]
008b1c61 : ADD ESP,0x40
008b1c64 : PUSH 0x0
008b1c66 : PUSH ECX
008b1c67 : PUSH ESI
008b1c68 : CALL 0x006377fb
008b1c6d : ADD EDI,0x4
008b1c70 : ADD ESP,0xc
008b1c73 : CMP EDI,dword ptr [EBX + 0x30]
008b1c76 : JNZ 0x008b1b70
008b1c7c : PUSH ESI
008b1c7d : CALL 0x006366db
008b1c82 : MOV ECX,dword ptr [EBP + -0x4]
008b1c85 : ADD ESP,0x4
008b1c88 : POP EDI
008b1c89 : POP ESI
008b1c8a : XOR ECX,EBP
008b1c8c : MOV AL,0x1
008b1c8e : POP EBX
008b1c8f : CALL 0x00633e6b
008b1c94 : MOV ESP,EBP
008b1c96 : POP EBP
008b1c97 : RET 0x4
