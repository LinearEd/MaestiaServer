PROGRAM  : Maestia.exe
FUNCTION : FUN_00524930
ENTRY    : 00524930
BODY     : [[00524930, 00524a78]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00524930(undefined4 *param_1,int *param_2)

{
  LPCRITICAL_SECTION lpCriticalSection;
  int *piVar1;
  GRefCountImpl *this;
  char cVar2;
  uint uVar3;
  int iVar4;
  undefined4 uVar5;
  int in_ECX;
  int *piVar6;
  int local_8;
  int iStack_4;
  
  lpCriticalSection = (LPCRITICAL_SECTION)(in_ECX + 0xc);
  local_8 = in_ECX;
  EnterCriticalSection(lpCriticalSection);
  piVar1 = (int *)(in_ECX + 0x24);
  if (*(int *)(in_ECX + 0x24) != 0) {
    if ((int *)*param_2 == (int *)0x0) {
      uVar3 = 0;
    }
    else {
      uVar3 = (**(code **)(*(int *)*param_2 + 0x10))(param_2[1]);
    }
    iVar4 = FUN_00523880(param_2,*(uint *)(*piVar1 + 4) & uVar3);
    if ((-1 < iVar4) &&
       (piVar6 = (int *)((iVar4 + 1) * 0x10 + *piVar1), in_ECX = local_8, piVar6 != (int *)0x0)) {
      if (*piVar6 != 0) {
        this = (GRefCountImpl *)piVar6[1];
        param_1[1] = this;
        *param_1 = 2;
        GRefCountImpl::AddRef(this);
        uVar5 = *param_1;
        LeaveCriticalSection(lpCriticalSection);
        return uVar5;
      }
      cVar2 = FUN_00523de0();
      if (cVar2 != '\0') {
        param_1[1] = piVar6[1];
        *param_1 = 1;
        LeaveCriticalSection(lpCriticalSection);
        return 1;
      }
      FUN_005239e0(param_2);
      in_ECX = local_8;
    }
  }
  iVar4 = FUN_00515840(0x4c,0);
  if ((iVar4 != 0) && (iVar4 = FUN_00524280(in_ECX,param_2), iVar4 != 0)) {
    local_8 = 1;
    iStack_4 = iVar4;
    uVar5 = FUN_00523940(&local_8);
    FUN_00523b90(piVar1,&local_8,uVar5);
    param_1[1] = iVar4;
    *param_1 = 3;
    LeaveCriticalSection(lpCriticalSection);
    return 3;
  }
  LeaveCriticalSection(lpCriticalSection);
  return 4;
}



============================================================
DISASSEMBLY
============================================================
00524930 : SUB ESP,0x8
00524933 : PUSH EBX
00524934 : PUSH EBP
00524935 : PUSH ESI
00524936 : MOV ESI,ECX
00524938 : PUSH EDI
00524939 : LEA EBP,[ESI + 0xc]
0052493c : PUSH EBP
0052493d : MOV dword ptr [ESP + 0x14],ESI
00524941 : CALL dword ptr [0x00b85118]
00524947 : CMP dword ptr [ESI + 0x24],0x0
0052494b : MOV EBX,dword ptr [ESP + 0x20]
0052494f : LEA EDI,[ESI + 0x24]
00524952 : JZ 0x005249ca
00524954 : MOV ECX,dword ptr [EBX]
00524956 : TEST ECX,ECX
00524958 : JZ 0x00524967
0052495a : MOV EAX,dword ptr [ECX]
0052495c : MOV EDX,dword ptr [EBX + 0x4]
0052495f : MOV EAX,dword ptr [EAX + 0x10]
00524962 : PUSH EDX
00524963 : CALL EAX
00524965 : JMP 0x00524969
00524967 : XOR EAX,EAX
00524969 : MOV ECX,dword ptr [EDI]
0052496b : MOV ECX,dword ptr [ECX + 0x4]
0052496e : AND ECX,EAX
00524970 : PUSH ECX
00524971 : PUSH EBX
00524972 : MOV ECX,EDI
00524974 : CALL 0x00523880
00524979 : TEST EAX,EAX
0052497b : JL 0x005249ca
0052497d : LEA ESI,[EAX + 0x1]
00524980 : SHL ESI,0x4
00524983 : ADD ESI,dword ptr [EDI]
00524985 : JZ 0x005249c6
00524987 : CMP dword ptr [ESI],0x0
0052498a : JNZ 0x00524a02
0052498c : MOV ECX,dword ptr [ESI + 0x4]
0052498f : CALL 0x00523de0
00524994 : TEST AL,AL
00524996 : JZ 0x005249be
00524998 : MOV EDX,dword ptr [ESI + 0x4]
0052499b : MOV EAX,dword ptr [ESP + 0x1c]
0052499f : PUSH EBP
005249a0 : MOV dword ptr [EAX + 0x4],EDX
005249a3 : MOV dword ptr [EAX],0x1
005249a9 : CALL dword ptr [0x00b8511c]
005249af : POP EDI
005249b0 : POP ESI
005249b1 : POP EBP
005249b2 : MOV EAX,0x1
005249b7 : POP EBX
005249b8 : ADD ESP,0x8
005249bb : RET 0x8
005249be : PUSH EBX
005249bf : MOV ECX,EDI
005249c1 : CALL 0x005239e0
005249c6 : MOV ESI,dword ptr [ESP + 0x10]
005249ca : MOV ECX,dword ptr [0x00d73250]
005249d0 : PUSH 0x0
005249d2 : PUSH 0x4c
005249d4 : CALL 0x00515840
005249d9 : TEST EAX,EAX
005249db : JZ 0x005249ec
005249dd : PUSH EBX
005249de : PUSH ESI
005249df : MOV ECX,EAX
005249e1 : CALL 0x00524280
005249e6 : MOV ESI,EAX
005249e8 : TEST ESI,ESI
005249ea : JNZ 0x00524a2e
005249ec : PUSH EBP
005249ed : CALL dword ptr [0x00b8511c]
005249f3 : POP EDI
005249f4 : POP ESI
005249f5 : POP EBP
005249f6 : MOV EAX,0x4
005249fb : POP EBX
005249fc : ADD ESP,0x8
005249ff : RET 0x8
00524a02 : MOV EAX,dword ptr [ESI + 0x4]
00524a05 : MOV EDI,dword ptr [ESP + 0x1c]
00524a09 : MOV ECX,EAX
00524a0b : MOV dword ptr [EDI + 0x4],EAX
00524a0e : MOV dword ptr [EDI],0x2
00524a14 : CALL 0x00523dd0
00524a19 : MOV EDI,dword ptr [EDI]
00524a1b : PUSH EBP
00524a1c : CALL dword ptr [0x00b8511c]
00524a22 : MOV EAX,EDI
00524a24 : POP EDI
00524a25 : POP ESI
00524a26 : POP EBP
00524a27 : POP EBX
00524a28 : ADD ESP,0x8
00524a2b : RET 0x8
00524a2e : LEA ECX,[ESP + 0x10]
00524a32 : PUSH ECX
00524a33 : LEA ECX,[ESP + 0x20]
00524a37 : MOV dword ptr [ESP + 0x14],0x1
00524a3f : MOV dword ptr [ESP + 0x18],ESI
00524a43 : CALL 0x00523940
00524a48 : PUSH EAX
00524a49 : LEA EDX,[ESP + 0x14]
00524a4d : PUSH EDX
00524a4e : PUSH EDI
00524a4f : MOV ECX,EDI
00524a51 : CALL 0x00523b90
00524a56 : MOV EAX,dword ptr [ESP + 0x1c]
00524a5a : PUSH EBP
00524a5b : MOV dword ptr [EAX + 0x4],ESI
00524a5e : MOV dword ptr [EAX],0x3
00524a64 : CALL dword ptr [0x00b8511c]
00524a6a : POP EDI
00524a6b : POP ESI
00524a6c : POP EBP
00524a6d : MOV EAX,0x3
00524a72 : POP EBX
00524a73 : ADD ESP,0x8
00524a76 : RET 0x8
