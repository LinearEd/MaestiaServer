PROGRAM  : Maestia.exe
FUNCTION : FUN_00802090
ENTRY    : 00802090
BODY     : [[00802090, 00802181]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void FUN_00802090(void)

{
  int iVar1;
  uint uVar2;
  undefined4 *puVar3;
  int *piVar4;
  int in_ECX;
  uint uVar5;
  uint uVar6;
  int aiStack_401c [4096];
  undefined1 local_1c [4];
  DWORD local_18;
  LPCRITICAL_SECTION local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b14976;
  local_10 = ExceptionList;
  local_14 = (LPCRITICAL_SECTION)0x8020ab;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_18 = GetTickCount();
  if (*(uint *)(in_ECX + 8) <= local_18 - *(int *)(in_ECX + 4)) {
    *(DWORD *)(in_ECX + 4) = local_18;
    local_14 = (LPCRITICAL_SECTION)(in_ECX + 0xb8);
    EnterCriticalSection(local_14);
    uVar6 = 0;
    local_8 = 0;
    piVar4 = (int *)**(int **)(in_ECX + 0x18);
    if (piVar4 != *(int **)(in_ECX + 0x18)) {
      do {
        iVar1 = piVar4[9];
        if (*(int *)(iVar1 + 0x2c) < 2) {
          if (local_18 < (uint)(*(int *)(in_ECX + 0xc) + *(int *)(iVar1 + 0x20))) {
            piVar4 = (int *)*piVar4;
          }
          else {
            puVar3 = (undefined4 *)FUN_00462670(local_1c,piVar4);
            piVar4 = (int *)*puVar3;
            aiStack_401c[uVar6] = iVar1;
            uVar6 = uVar6 + 1;
            if (0xfff < uVar6) break;
          }
        }
        else {
          piVar4 = (int *)*piVar4;
        }
      } while (piVar4 != *(undefined4 **)(in_ECX + 0x18));
    }
    uVar5 = 0;
    if (uVar6 != 0) {
      do {
        if ((int *)aiStack_401c[uVar5] != (int *)0x0) {
          (**(code **)(*(int *)aiStack_401c[uVar5] + 0x30))(uVar2);
        }
        uVar5 = uVar5 + 1;
      } while (uVar5 < uVar6);
    }
    local_8 = 0xffffffff;
    LeaveCriticalSection(local_14);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00802090 : PUSH EBP
00802091 : MOV EBP,ESP
00802093 : PUSH -0x1
00802095 : PUSH 0xb14976
0080209a : MOV EAX,FS:[0x0]
008020a0 : PUSH EAX
008020a1 : MOV EAX,0x400c
008020a6 : CALL 0x0063b780
008020ab : PUSH EBX
008020ac : PUSH ESI
008020ad : PUSH EDI
008020ae : MOV EAX,[0x00d66fa0]
008020b3 : XOR EAX,EBP
008020b5 : PUSH EAX
008020b6 : LEA EAX,[EBP + -0xc]
008020b9 : MOV FS:[0x0],EAX
008020bf : MOV ESI,ECX
008020c1 : CALL dword ptr [0x00b850d8]
008020c7 : MOV ECX,EAX
008020c9 : SUB ECX,dword ptr [ESI + 0x4]
008020cc : MOV dword ptr [EBP + -0x14],EAX
008020cf : CMP ECX,dword ptr [ESI + 0x8]
008020d2 : JC 0x00802170
008020d8 : MOV dword ptr [ESI + 0x4],EAX
008020db : LEA EAX,[ESI + 0xb8]
008020e1 : PUSH EAX
008020e2 : MOV dword ptr [EBP + -0x10],EAX
008020e5 : CALL dword ptr [0x00b85118]
008020eb : XOR EDI,EDI
008020ed : MOV dword ptr [EBP + -0x4],EDI
008020f0 : MOV ECX,dword ptr [ESI + 0x18]
008020f3 : MOV EAX,dword ptr [ECX]
008020f5 : CMP EAX,ECX
008020f7 : JZ 0x00802142
008020f9 : LEA ESP,[ESP]
00802100 : MOV EBX,dword ptr [EAX + 0x24]
00802103 : CMP dword ptr [EBX + 0x2c],0x1
00802107 : JLE 0x0080210d
00802109 : MOV EAX,dword ptr [EAX]
0080210b : JMP 0x0080213d
0080210d : MOV ECX,dword ptr [EBX + 0x20]
00802110 : MOV EDX,dword ptr [ESI + 0xc]
00802113 : ADD EDX,ECX
00802115 : CMP EDX,dword ptr [EBP + -0x14]
00802118 : JBE 0x0080211e
0080211a : MOV EAX,dword ptr [EAX]
0080211c : JMP 0x0080213d
0080211e : PUSH EAX
0080211f : LEA EAX,[EBP + -0x18]
00802122 : PUSH EAX
00802123 : LEA ECX,[ESI + 0x10]
00802126 : CALL 0x00462670
0080212b : MOV EAX,dword ptr [EAX]
0080212d : MOV dword ptr [EBP + EDI*0x4 + 0xffffbfe8],EBX
00802134 : INC EDI
00802135 : CMP EDI,0x1000
0080213b : JNC 0x00802142
0080213d : CMP EAX,dword ptr [ESI + 0x18]
00802140 : JNZ 0x00802100
00802142 : XOR ESI,ESI
00802144 : TEST EDI,EDI
00802146 : JBE 0x0080215f
00802148 : MOV ECX,dword ptr [EBP + ESI*0x4 + 0xffffbfe8]
0080214f : TEST ECX,ECX
00802151 : JZ 0x0080215a
00802153 : MOV EDX,dword ptr [ECX]
00802155 : MOV EAX,dword ptr [EDX + 0x30]
00802158 : CALL EAX
0080215a : INC ESI
0080215b : CMP ESI,EDI
0080215d : JC 0x00802148
0080215f : MOV dword ptr [EBP + -0x4],0xffffffff
00802166 : MOV ECX,dword ptr [EBP + -0x10]
00802169 : PUSH ECX
0080216a : CALL dword ptr [0x00b8511c]
00802170 : MOV ECX,dword ptr [EBP + -0xc]
00802173 : MOV dword ptr FS:[0x0],ECX
0080217a : POP ECX
0080217b : POP EDI
0080217c : POP ESI
0080217d : POP EBX
0080217e : MOV ESP,EBP
00802180 : POP EBP
00802181 : RET
