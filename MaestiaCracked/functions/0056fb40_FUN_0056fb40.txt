PROGRAM  : Maestia.exe
FUNCTION : FUN_0056fb40
ENTRY    : 0056fb40
BODY     : [[0056fb40, 0056fbcd]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0056fb40(void)

{
  int *piVar1;
  GRefCountNTSImpl *this;
  char cVar2;
  int in_ECX;
  
  if (((*(byte *)(in_ECX + 0xb02) & 1) != 0) &&
     (piVar1 = *(int **)(in_ECX + 0xad8), piVar1 != (int *)0x0)) {
    if (piVar1[1] == 0) {
      *piVar1 = *piVar1 + -1;
      if (*piVar1 == 0) {
        FUN_00515cf0(piVar1);
      }
      *(undefined4 *)(in_ECX + 0xad8) = 0;
      *(uint *)(in_ECX + 0xb00) = *(uint *)(in_ECX + 0xb00) & 0xfffeffff;
      return;
    }
    this = (GRefCountNTSImpl *)piVar1[1];
    if (this != (GRefCountNTSImpl *)0x0) {
      *(int *)(this + 4) = *(int *)(this + 4) + 1;
      *(int *)(this + 4) = *(int *)(this + 4) + 1;
      GRefCountNTSImpl::Release(this);
      if (*(int *)(this + 0x20) != 0) {
        cVar2 = (**(code **)(*(int *)this + 0xd0))(0,2);
        if (cVar2 == '\0') {
          GRefCountNTSImpl::Release(this);
          return;
        }
      }
      GRefCountNTSImpl::Release(this);
    }
  }
  *(uint *)(in_ECX + 0xb00) = *(uint *)(in_ECX + 0xb00) & 0xfffeffff;
  return;
}



============================================================
DISASSEMBLY
============================================================
0056fb40 : PUSH ESI
0056fb41 : PUSH EDI
0056fb42 : MOV EDI,ECX
0056fb44 : MOV ECX,0x1
0056fb49 : TEST byte ptr [EDI + 0xb02],CL
0056fb4f : JZ 0x0056fbc1
0056fb51 : MOV EAX,dword ptr [EDI + 0xad8]
0056fb57 : TEST EAX,EAX
0056fb59 : JZ 0x0056fbc1
0056fb5b : CMP dword ptr [EAX + 0x4],0x0
0056fb5f : JZ 0x0056fb98
0056fb61 : MOV ESI,dword ptr [EAX + 0x4]
0056fb64 : TEST ESI,ESI
0056fb66 : JZ 0x0056fbc1
0056fb68 : ADD dword ptr [ESI + 0x4],ECX
0056fb6b : ADD dword ptr [ESI + 0x4],ECX
0056fb6e : MOV ECX,ESI
0056fb70 : CALL 0x004ff7c0
0056fb75 : CMP dword ptr [ESI + 0x20],0x0
0056fb79 : JZ 0x0056fbba
0056fb7b : MOV EAX,dword ptr [ESI]
0056fb7d : MOV EDX,dword ptr [EAX + 0xd0]
0056fb83 : PUSH 0x2
0056fb85 : PUSH 0x0
0056fb87 : MOV ECX,ESI
0056fb89 : CALL EDX
0056fb8b : TEST AL,AL
0056fb8d : JNZ 0x0056fbba
0056fb8f : POP EDI
0056fb90 : MOV ECX,ESI
0056fb92 : POP ESI
0056fb93 : JMP 0x004ff7c0
0056fb98 : ADD dword ptr [EAX],-0x1
0056fb9b : JNZ 0x0056fba3
0056fb9d : PUSH EAX
0056fb9e : CALL 0x00515cf0
0056fba3 : MOV dword ptr [EDI + 0xad8],0x0
0056fbad : AND dword ptr [EDI + 0xb00],0xfffeffff
0056fbb7 : POP EDI
0056fbb8 : POP ESI
0056fbb9 : RET
0056fbba : MOV ECX,ESI
0056fbbc : CALL 0x004ff7c0
0056fbc1 : AND dword ptr [EDI + 0xb00],0xfffeffff
0056fbcb : POP EDI
0056fbcc : POP ESI
0056fbcd : RET
