PROGRAM  : Maestia.exe
FUNCTION : FUN_005f6c40
ENTRY    : 005f6c40
BODY     : [[005f6c40, 005f6d6e]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_005f6c40(uint param_1,int *param_2)

{
  int iVar1;
  uint *puVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  byte bVar6;
  undefined4 *in_ECX;
  uint uVar7;
  uint uVar8;
  undefined4 local_10;
  
  iVar5 = FUN_005a8100(param_1 >> ((byte)*in_ECX & 0x1f));
  if (iVar5 != 0) {
    iVar3 = *(int *)(iVar5 + 8);
    iVar4 = *(int *)(iVar3 + 0x1c);
    bVar6 = (byte)*in_ECX;
    uVar7 = (uint)*(ushort *)(iVar5 + 0xc);
    if (0x20 < uVar7) {
      uVar7 = *(uint *)(iVar5 + 0x10);
    }
    uVar7 = uVar7 - (param_1 >> (bVar6 & 0x1f));
    uVar8 = uVar7 << (bVar6 & 0x1f);
    if (uVar8 < 0x10) {
      param_1 = param_1 + uVar8;
    }
    else {
      iVar1 = iVar5 + param_1;
      if (uVar7 < 0x21) {
        *(short *)((uVar8 - 2) + iVar1) = (short)uVar7;
        *(short *)(iVar1 + 0xc) = (short)uVar7;
      }
      else {
        *(undefined2 *)((uVar8 - 2) + iVar1) = 0x21;
        *(undefined2 *)(iVar1 + 0xc) = 0x21;
        *(uint *)((uVar8 - 8) + iVar1) = uVar7;
        *(uint *)(iVar1 + 0x10) = uVar7;
      }
      *(int *)(iVar1 + 8) = iVar3;
      FUN_005a7f80(iVar1);
      uVar8 = (int)((iVar5 - iVar4) + param_1) >> (bVar6 & 0x1f);
      puVar2 = (uint *)(iVar3 + 0x20 + (uVar8 >> 4) * 4);
      *puVar2 = *puVar2 & ~(3 << ((char)uVar8 * '\x02' & 0x1eU));
      uVar7 = (uVar8 - 1) + uVar7;
      puVar2 = (uint *)(iVar3 + 0x20 + (uVar7 >> 4) * 4);
      *puVar2 = *puVar2 & ~(3 << ((char)uVar7 * '\x02' & 0x1eU));
    }
    local_10 = iVar3 + 0x20;
    FUN_005f6640(local_10,iVar5 - iVar4 >> (bVar6 & 0x1f),param_1 >> (bVar6 & 0x1f),0);
    *param_2 = iVar3;
  }
  return iVar5;
}



============================================================
DISASSEMBLY
============================================================
005f6c40 : SUB ESP,0x10
005f6c43 : PUSH EBX
005f6c44 : PUSH ESI
005f6c45 : PUSH EDI
005f6c46 : MOV EDI,dword ptr [ESP + 0x20]
005f6c4a : MOV EBX,ECX
005f6c4c : MOV ECX,dword ptr [EBX]
005f6c4e : MOV EDX,EDI
005f6c50 : SHR EDX,CL
005f6c52 : LEA EAX,[EBX + 0x8]
005f6c55 : MOV ECX,EAX
005f6c57 : MOV dword ptr [ESP + 0x14],EAX
005f6c5b : PUSH EDX
005f6c5c : CALL 0x005a8100
005f6c61 : MOV ESI,EAX
005f6c63 : TEST ESI,ESI
005f6c65 : JZ 0x005f6d66
005f6c6b : MOV EBX,dword ptr [EBX]
005f6c6d : MOV ECX,EBX
005f6c6f : PUSH EBP
005f6c70 : MOV EBP,dword ptr [ESI + 0x8]
005f6c73 : MOV EDX,dword ptr [EBP + 0x1c]
005f6c76 : MOV EAX,EDI
005f6c78 : SHR EAX,CL
005f6c7a : LEA ECX,[EBP + 0x20]
005f6c7d : MOV dword ptr [ESP + 0x10],ECX
005f6c81 : MOVZX ECX,word ptr [ESI + 0xc]
005f6c85 : MOV dword ptr [ESP + 0x1c],EBP
005f6c89 : MOV dword ptr [ESP + 0x14],EDX
005f6c8d : CMP ECX,0x21
005f6c90 : JC 0x005f6c95
005f6c92 : MOV ECX,dword ptr [ESI + 0x10]
005f6c95 : SUB ECX,EAX
005f6c97 : MOV EDX,ECX
005f6c99 : MOV dword ptr [ESP + 0x24],ECX
005f6c9d : MOV ECX,EBX
005f6c9f : SHL EDX,CL
005f6ca1 : CMP EDX,0x10
005f6ca4 : JC 0x005f6d3e
005f6caa : MOV ECX,dword ptr [ESP + 0x24]
005f6cae : LEA EAX,[ESI + EDI*0x1]
005f6cb1 : CMP ECX,0x21
005f6cb4 : JNC 0x005f6cc1
005f6cb6 : MOV word ptr [EDX + EAX*0x1 + -0x2],CX
005f6cbb : MOV word ptr [EAX + 0xc],CX
005f6cbf : JMP 0x005f6cda
005f6cc1 : MOV ECX,0x21
005f6cc6 : MOV word ptr [EDX + EAX*0x1 + -0x2],CX
005f6ccb : MOV word ptr [EAX + 0xc],CX
005f6ccf : MOV ECX,dword ptr [ESP + 0x24]
005f6cd3 : MOV dword ptr [EDX + EAX*0x1 + -0x8],ECX
005f6cd7 : MOV dword ptr [EAX + 0x10],ECX
005f6cda : MOV ECX,dword ptr [ESP + 0x18]
005f6cde : PUSH EAX
005f6cdf : MOV dword ptr [EAX + 0x8],EBP
005f6ce2 : CALL 0x005a7f80
005f6ce7 : MOV EAX,ESI
005f6ce9 : SUB EAX,dword ptr [ESP + 0x14]
005f6ced : MOV ECX,EBX
005f6cef : ADD EAX,EDI
005f6cf1 : SAR EAX,CL
005f6cf3 : MOV ECX,dword ptr [ESP + 0x10]
005f6cf7 : MOV EBP,0x3
005f6cfc : MOV EDX,EAX
005f6cfe : SHR EDX,0x4
005f6d01 : LEA EDX,[ECX + EDX*0x4]
005f6d04 : LEA ECX,[EAX + EAX*0x1]
005f6d07 : AND ECX,0x1e
005f6d0a : SHL EBP,CL
005f6d0c : NOT EBP
005f6d0e : AND dword ptr [EDX],EBP
005f6d10 : MOV EDX,dword ptr [ESP + 0x24]
005f6d14 : MOV EBP,dword ptr [ESP + 0x1c]
005f6d18 : LEA EAX,[EAX + EDX*0x1 + -0x1]
005f6d1c : MOV ECX,EAX
005f6d1e : SHR ECX,0x4
005f6d21 : LEA EDX,[EBP + 0x20]
005f6d24 : MOV dword ptr [ESP + 0x10],EDX
005f6d28 : LEA EDX,[EDX + ECX*0x4]
005f6d2b : LEA ECX,[EAX + EAX*0x1]
005f6d2e : AND ECX,0x1e
005f6d31 : MOV EAX,0x3
005f6d36 : SHL EAX,CL
005f6d38 : NOT EAX
005f6d3a : AND dword ptr [EDX],EAX
005f6d3c : JMP 0x005f6d40
005f6d3e : ADD EDI,EDX
005f6d40 : MOV EAX,dword ptr [ESP + 0x10]
005f6d44 : MOV ECX,EBX
005f6d46 : MOV EDX,ESI
005f6d48 : SUB EDX,dword ptr [ESP + 0x14]
005f6d4c : SHR EDI,CL
005f6d4e : PUSH 0x0
005f6d50 : SAR EDX,CL
005f6d52 : PUSH EDI
005f6d53 : PUSH EDX
005f6d54 : PUSH EAX
005f6d55 : CALL 0x005f6640
005f6d5a : MOV ECX,dword ptr [ESP + 0x38]
005f6d5e : ADD ESP,0x10
005f6d61 : MOV dword ptr [ECX],EBP
005f6d63 : MOV EAX,ESI
005f6d65 : POP EBP
005f6d66 : POP EDI
005f6d67 : POP ESI
005f6d68 : POP EBX
005f6d69 : ADD ESP,0x10
005f6d6c : RET 0x8
