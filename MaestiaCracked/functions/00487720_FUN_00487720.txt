PROGRAM  : Maestia.exe
FUNCTION : FUN_00487720
ENTRY    : 00487720
BODY     : [[00487720, 00487855] [00487867, 00487921]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00487720(uint param_1,undefined4 *param_2)

{
  int iVar1;
  int iVar2;
  uint uVar3;
  undefined4 uVar4;
  undefined4 *puVar5;
  uint uVar6;
  uint extraout_ECX;
  int iVar7;
  uint local_20;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  iVar1 = param_1;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b7a3b0;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  iVar2 = *(int *)(param_1 + 4);
  if (iVar2 == 0) {
    uVar6 = 0;
  }
  else {
    uVar6 = *(int *)(param_1 + 0xc) - iVar2 >> 2;
  }
  iVar7 = *(int *)(param_1 + 8);
  iVar2 = iVar7 - iVar2 >> 2;
  if (0x3fffffffU - iVar2 < 9) {
    iVar2 = FUN_00429be0();
    uVar6 = extraout_ECX;
  }
  uVar3 = iVar2 + 9;
  if (uVar3 <= uVar6) {
    if ((uint)(iVar7 - (int)param_2 >> 2) < 9) {
      FUN_004c17f0(param_2,iVar7);
      local_8 = 2;
      local_20 = local_20 & 0xffffff00;
      FUN_004c1940(*(int *)(param_1 + 8),9 - (*(int *)(param_1 + 8) - (int)param_2 >> 2),param_2,
                   local_20);
      local_8 = 0xffffffff;
      *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + 0x24;
    }
    else {
      puVar5 = (undefined4 *)(iVar7 + -0x24);
      uVar4 = FUN_004c17f0(puVar5,iVar7);
      *(undefined4 *)(param_1 + 8) = uVar4;
      if (param_2 != puVar5) {
        iVar7 = iVar7 - (int)puVar5;
        do {
          puVar5 = puVar5 + -1;
          *(undefined4 *)(iVar7 + (int)puVar5) = *puVar5;
        } while (puVar5 != param_2);
      }
    }
    FUN_00422490(param_2);
    ExceptionList = local_10;
    return;
  }
  if (0x3fffffff - (uVar6 >> 1) < uVar6) {
    param_1 = 0;
  }
  else {
    param_1 = uVar6 + (uVar6 >> 1);
  }
  if (param_1 < uVar3) {
    param_1 = uVar3;
  }
  iVar2 = FUN_004c1790();
  local_8 = 0;
  FUN_004c1760();
  FUN_004c17f0(*(undefined4 *)(iVar1 + 4),param_2);
  FUN_004c17f0(param_2,*(undefined4 *)(iVar1 + 8));
  local_8 = 0xffffffff;
  if (*(int *)(iVar1 + 4) == 0) {
    *(uint *)(iVar1 + 0xc) = iVar2 + param_1 * 4;
    *(int *)(iVar1 + 8) = iVar2 + ((*(int *)(iVar1 + 8) - *(int *)(iVar1 + 4) >> 2) + 9) * 4;
    *(int *)(iVar1 + 4) = iVar2;
    ExceptionList = local_10;
    return;
  }
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
00487720 : PUSH EBP
00487721 : MOV EBP,ESP
00487723 : PUSH -0x1
00487725 : PUSH 0xb7a3b0
0048772a : MOV EAX,FS:[0x0]
00487730 : PUSH EAX
00487731 : SUB ESP,0x10
00487734 : PUSH EBX
00487735 : PUSH ESI
00487736 : PUSH EDI
00487737 : MOV EAX,[0x00d66fa0]
0048773c : XOR EAX,EBP
0048773e : PUSH EAX
0048773f : LEA EAX,[EBP + -0xc]
00487742 : MOV FS:[0x0],EAX
00487748 : MOV dword ptr [EBP + -0x10],ESP
0048774b : MOV ESI,ECX
0048774d : MOV EBX,dword ptr [EBP + 0x8]
00487750 : MOV EDX,dword ptr [EBX + 0x4]
00487753 : TEST EDX,EDX
00487755 : JNZ 0x0048775b
00487757 : XOR ECX,ECX
00487759 : JMP 0x00487765
0048775b : MOV EAX,dword ptr [EBX + 0xc]
0048775e : SUB EAX,EDX
00487760 : SAR EAX,0x2
00487763 : MOV ECX,EAX
00487765 : MOV EDI,dword ptr [EBX + 0x8]
00487768 : MOV EAX,EDI
0048776a : SUB EAX,EDX
0048776c : SAR EAX,0x2
0048776f : MOV EDX,0x3fffffff
00487774 : SUB EDX,EAX
00487776 : CMP EDX,0x9
00487779 : JNC 0x00487780
0048777b : CALL 0x00429be0
00487780 : ADD EAX,0x9
00487783 : CMP ECX,EAX
00487785 : JNC 0x00487867
0048778b : MOV EDX,ECX
0048778d : SHR EDX,0x1
0048778f : MOV EDI,0x3fffffff
00487794 : SUB EDI,EDX
00487796 : CMP EDI,ECX
00487798 : JNC 0x004877a6
0048779a : MOV dword ptr [EBP + 0x8],0x0
004877a1 : MOV ECX,dword ptr [EBP + 0x8]
004877a4 : JMP 0x004877ab
004877a6 : ADD ECX,EDX
004877a8 : MOV dword ptr [EBP + 0x8],ECX
004877ab : CMP ECX,EAX
004877ad : JNC 0x004877b4
004877af : MOV dword ptr [EBP + 0x8],EAX
004877b2 : MOV ECX,EAX
004877b4 : CALL 0x004c1790
004877b9 : MOV dword ptr [EBP + -0x14],EAX
004877bc : MOV ECX,dword ptr [EBP + 0xc]
004877bf : SUB ECX,dword ptr [EBX + 0x4]
004877c2 : SAR ECX,0x2
004877c5 : MOV dword ptr [EBP + -0x1c],ECX
004877c8 : MOV dword ptr [EBP + -0x4],0x0
004877cf : LEA EDI,[EAX + ECX*0x4]
004877d2 : MOV EDX,ESI
004877d4 : MOV ESI,0x9
004877d9 : CALL 0x004c1760
004877de : MOV dword ptr [EBP + -0x18],0x1
004877e5 : MOV EAX,dword ptr [EBP + 0xc]
004877e8 : PUSH EAX
004877e9 : MOV ECX,dword ptr [EBX + 0x4]
004877ec : PUSH ECX
004877ed : MOV EDI,dword ptr [EBP + -0x14]
004877f0 : MOV EDX,EDI
004877f2 : CALL 0x004c17f0
004877f7 : MOV dword ptr [EBP + -0x18],0x2
004877fe : MOV EDX,dword ptr [EBP + -0x1c]
00487801 : LEA EDX,[EDI + EDX*0x4 + 0x24]
00487805 : MOV EAX,dword ptr [EBX + 0x8]
00487808 : PUSH EAX
00487809 : MOV ECX,dword ptr [EBP + 0xc]
0048780c : PUSH ECX
0048780d : CALL 0x004c17f0
00487812 : MOV dword ptr [EBP + -0x4],0xffffffff
00487819 : MOV ECX,dword ptr [EBX + 0x4]
0048781c : MOV ESI,dword ptr [EBX + 0x8]
0048781f : SUB ESI,ECX
00487821 : SAR ESI,0x2
00487824 : ADD ESI,0x9
00487827 : TEST ECX,ECX
00487829 : JZ 0x00487830
0048782b : CALL 0x006f04e0
00487830 : MOV EDX,dword ptr [EBP + 0x8]
00487833 : LEA EAX,[EDI + EDX*0x4]
00487836 : MOV dword ptr [EBX + 0xc],EAX
00487839 : LEA ECX,[EDI + ESI*0x4]
0048783c : MOV dword ptr [EBX + 0x8],ECX
0048783f : MOV dword ptr [EBX + 0x4],EDI
00487842 : MOV ECX,dword ptr [EBP + -0xc]
00487845 : MOV dword ptr FS:[0x0],ECX
0048784c : POP ECX
0048784d : POP EDI
0048784e : POP ESI
0048784f : POP EBX
00487850 : MOV ESP,EBP
00487852 : POP EBP
00487853 : RET 0x8
00487867 : MOV EDX,EDI
00487869 : MOV EAX,dword ptr [EBP + 0xc]
0048786c : SUB EDX,EAX
0048786e : SAR EDX,0x2
00487871 : MOV ECX,dword ptr [ESI]
00487873 : PUSH EDI
00487874 : MOV dword ptr [EBP + 0x8],ECX
00487877 : CMP EDX,0x9
0048787a : JNC 0x004878ce
0048787c : LEA EDX,[EAX + 0x24]
0048787f : PUSH EAX
00487880 : CALL 0x004c17f0
00487885 : MOV dword ptr [EBP + -0x4],0x2
0048788c : MOV ECX,dword ptr [EBX + 0x8]
0048788f : MOV EDX,ECX
00487891 : SUB EDX,dword ptr [EBP + 0xc]
00487894 : SAR EDX,0x2
00487897 : MOV EAX,0x9
0048789c : SUB EAX,EDX
0048789e : MOV byte ptr [EBP + -0x1c],0x0
004878a2 : MOV EDX,dword ptr [EBP + -0x1c]
004878a5 : PUSH EDX
004878a6 : MOV EDX,dword ptr [EBP + 0xc]
004878a9 : PUSH EDX
004878aa : PUSH EAX
004878ab : PUSH ECX
004878ac : LEA EDX,[EBP + 0x8]
004878af : CALL 0x004c1940
004878b4 : ADD ESP,0x10
004878b7 : MOV dword ptr [EBP + -0x4],0xffffffff
004878be : ADD dword ptr [EBX + 0x8],0x24
004878c2 : MOV EBX,dword ptr [EBX + 0x8]
004878c5 : LEA ECX,[EBX + -0x24]
004878c8 : MOV EAX,dword ptr [EBP + 0xc]
004878cb : PUSH EAX
004878cc : JMP 0x00487903
004878ce : LEA ESI,[EDI + -0x24]
004878d1 : PUSH ESI
004878d2 : MOV EDX,EDI
004878d4 : CALL 0x004c17f0
004878d9 : MOV dword ptr [EBX + 0x8],EAX
004878dc : MOV EAX,ESI
004878de : MOV EDX,dword ptr [EBP + 0xc]
004878e1 : MOV ECX,EDX
004878e3 : CMP EDX,EAX
004878e5 : JZ 0x004878ff
004878e7 : SUB EDI,ESI
004878e9 : LEA ESP,[ESP]
004878f0 : SUB EAX,0x4
004878f3 : MOV EDX,dword ptr [EAX]
004878f5 : MOV dword ptr [EDI + EAX*0x1],EDX
004878f8 : CMP EAX,ECX
004878fa : JNZ 0x004878f0
004878fc : MOV EDX,dword ptr [EBP + 0xc]
004878ff : LEA ECX,[EDX + 0x24]
00487902 : PUSH EDX
00487903 : LEA EDX,[EBP + 0x8]
00487906 : CALL 0x00422490
0048790b : ADD ESP,0x4
0048790e : MOV ECX,dword ptr [EBP + -0xc]
00487911 : MOV dword ptr FS:[0x0],ECX
00487918 : POP ECX
00487919 : POP EDI
0048791a : POP ESI
0048791b : POP EBX
0048791c : MOV ESP,EBP
0048791e : POP EBP
0048791f : RET 0x8
