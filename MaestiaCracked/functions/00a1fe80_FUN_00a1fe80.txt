PROGRAM  : Maestia.exe
FUNCTION : FUN_00a1fe80
ENTRY    : 00a1fe80
BODY     : [[00a1fe80, 00a1ffc6]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00a1fe80(uint param_1)

{
  short sVar1;
  int *piVar2;
  uint uVar3;
  int iVar4;
  undefined4 uVar5;
  int iVar6;
  undefined1 local_30 [28];
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  iVar4 = DAT_00d7c54c;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b262f4;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  param_1 = *(uint *)(*(int *)(param_1 + 600) + 8);
  iVar6 = 0;
  if (param_1 >> 0x10 == 0x509) {
    FUN_004437f0(&param_1);
    if ((local_14 != *(int *)(iVar4 + 0x44)) && (*(int *)(local_14 + 0x10) != 0)) {
      sVar1 = *(short *)(*(int *)(local_14 + 0x10) + 0x1b0);
      if (sVar1 == 1) {
        iVar6 = 0x731c8c9;
      }
      else if (sVar1 == 2) {
        iVar6 = 0x731c8ca;
      }
      else if (sVar1 == 3) {
        iVar6 = 0x731c8cb;
      }
      if ((*(int *)(*DAT_00da9894 + 0x17c) != 0) && (iVar6 != 0)) {
        iVar4 = FUN_0090c840(uVar3);
        if (iVar4 != 0) {
          ExceptionList = local_10;
          return iVar6;
        }
        FUN_00406460(L"IDS_MUST_LEARN_GATHER_SKILL");
        local_8 = 0;
        piVar2 = *(int **)(*DAT_00da9894 + 0x1a8);
        uVar5 = FUN_0081d120(local_30);
        local_8._0_1_ = 1;
        (**(code **)(*piVar2 + 0x44))(uVar5,3);
        local_8 = (uint)local_8._1_3_ << 8;
        FUN_00406560();
        local_8 = 0xffffffff;
        FUN_00406560();
      }
    }
  }
  ExceptionList = local_10;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
00a1fe80 : PUSH EBP
00a1fe81 : MOV EBP,ESP
00a1fe83 : PUSH -0x1
00a1fe85 : PUSH 0xb262f4
00a1fe8a : MOV EAX,FS:[0x0]
00a1fe90 : PUSH EAX
00a1fe91 : SUB ESP,0x3c
00a1fe94 : PUSH ESI
00a1fe95 : PUSH EDI
00a1fe96 : MOV EAX,[0x00d66fa0]
00a1fe9b : XOR EAX,EBP
00a1fe9d : PUSH EAX
00a1fe9e : LEA EAX,[EBP + -0xc]
00a1fea1 : MOV FS:[0x0],EAX
00a1fea7 : MOV EAX,dword ptr [EBP + 0x8]
00a1feaa : MOV ECX,dword ptr [EAX + 0x258]
00a1feb0 : MOV EAX,dword ptr [ECX + 0x8]
00a1feb3 : MOV EDX,EAX
00a1feb5 : SHR EDX,0x10
00a1feb8 : XOR ESI,ESI
00a1feba : CMP EDX,0x509
00a1fec0 : JNZ 0x00a1ff9d
00a1fec6 : MOV EDI,dword ptr [0x00d7c54c]
00a1fecc : MOV dword ptr [EBP + 0x8],EAX
00a1fecf : LEA EAX,[EBP + 0x8]
00a1fed2 : PUSH EAX
00a1fed3 : LEA ECX,[EDI + 0x40]
00a1fed6 : LEA EAX,[EBP + -0x10]
00a1fed9 : CALL 0x004437f0
00a1fede : MOV EDI,dword ptr [EDI + 0x44]
00a1fee1 : MOV EAX,dword ptr [EBP + -0x10]
00a1fee4 : CMP EAX,EDI
00a1fee6 : JZ 0x00a1ff9d
00a1feec : MOV EAX,dword ptr [EAX + 0x10]
00a1feef : TEST EAX,EAX
00a1fef1 : JZ 0x00a1ff9d
00a1fef7 : MOVZX EAX,word ptr [EAX + 0x1b0]
00a1fefe : SUB EAX,0x1
00a1ff01 : JZ 0x00a1ff1b
00a1ff03 : SUB EAX,0x1
00a1ff06 : JZ 0x00a1ff14
00a1ff08 : SUB EAX,0x1
00a1ff0b : JNZ 0x00a1ff20
00a1ff0d : MOV ESI,0x731c8cb
00a1ff12 : JMP 0x00a1ff20
00a1ff14 : MOV ESI,0x731c8ca
00a1ff19 : JMP 0x00a1ff20
00a1ff1b : MOV ESI,0x731c8c9
00a1ff20 : MOV ECX,dword ptr [0x00da9894]
00a1ff26 : MOV EAX,dword ptr [ECX]
00a1ff28 : MOV EDI,dword ptr [EAX + 0x17c]
00a1ff2e : TEST EDI,EDI
00a1ff30 : JZ 0x00a1ff9d
00a1ff32 : TEST ESI,ESI
00a1ff34 : JZ 0x00a1ff9d
00a1ff36 : CALL 0x0090c840
00a1ff3b : TEST EAX,EAX
00a1ff3d : JNZ 0x00a1ffb2
00a1ff3f : PUSH 0xcc42f0
00a1ff44 : LEA ECX,[EBP + -0x2c]
00a1ff47 : CALL 0x00406460
00a1ff4c : MOV dword ptr [EBP + -0x4],0x0
00a1ff53 : MOV EDX,dword ptr [0x00da9894]
00a1ff59 : MOV EAX,dword ptr [EDX]
00a1ff5b : MOV ESI,dword ptr [EAX + 0x1a8]
00a1ff61 : MOV ECX,dword ptr [0x0172491c]
00a1ff67 : LEA EAX,[EBP + -0x2c]
00a1ff6a : PUSH EAX
00a1ff6b : LEA EDI,[EBP + -0x48]
00a1ff6e : CALL 0x0081d120
00a1ff73 : MOV byte ptr [EBP + -0x4],0x1
00a1ff77 : MOV EDX,dword ptr [ESI]
00a1ff79 : PUSH 0x3
00a1ff7b : PUSH EAX
00a1ff7c : MOV EAX,dword ptr [EDX + 0x44]
00a1ff7f : MOV ECX,ESI
00a1ff81 : CALL EAX
00a1ff83 : MOV byte ptr [EBP + -0x4],0x0
00a1ff87 : MOV ECX,EDI
00a1ff89 : CALL 0x00406560
00a1ff8e : MOV dword ptr [EBP + -0x4],0xffffffff
00a1ff95 : LEA ECX,[EBP + -0x2c]
00a1ff98 : CALL 0x00406560
00a1ff9d : XOR EAX,EAX
00a1ff9f : MOV ECX,dword ptr [EBP + -0xc]
00a1ffa2 : MOV dword ptr FS:[0x0],ECX
00a1ffa9 : POP ECX
00a1ffaa : POP EDI
00a1ffab : POP ESI
00a1ffac : MOV ESP,EBP
00a1ffae : POP EBP
00a1ffaf : RET 0x4
00a1ffb2 : MOV EAX,ESI
00a1ffb4 : MOV ECX,dword ptr [EBP + -0xc]
00a1ffb7 : MOV dword ptr FS:[0x0],ECX
00a1ffbe : POP ECX
00a1ffbf : POP EDI
00a1ffc0 : POP ESI
00a1ffc1 : MOV ESP,EBP
00a1ffc3 : POP EBP
00a1ffc4 : RET 0x4
