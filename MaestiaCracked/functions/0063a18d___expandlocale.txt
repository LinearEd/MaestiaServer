PROGRAM  : Maestia.exe
FUNCTION : __expandlocale
ENTRY    : 0063a18d
BODY     : [[0063a18d, 0063a23c] [0063a240, 0063a33e] [0063a344, 0063a3a1] [0063a3a5, 0063a3bd]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    __expandlocale
   
   Library: Visual Studio 2008 Release */

void __expandlocale(char *param_1,char *param_2,rsize_t param_3,undefined2 *param_4,
                   undefined4 *param_5)

{
  wchar_t *_Src;
  wchar_t *_Str1;
  wchar_t *_LpCodePage;
  _ptiddata p_Var1;
  char *_Str1_00;
  errno_t eVar2;
  size_t sVar3;
  int iVar4;
  BOOL BVar5;
  undefined1 local_98 [144];
  uint local_8;
  
  local_8 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  p_Var1 = __getptd();
  _Src = (p_Var1->_setloc_data)._cachein + 6;
  _Str1 = (p_Var1->_setloc_data)._cachein + 8;
  _LpCodePage = (p_Var1->_setloc_data)._cachein + 2;
  _Str1_00 = (char *)((int)(p_Var1->_setloc_data)._cachein + 0x93);
  if (((param_1 != (char *)0x0) && (param_2 != (char *)0x0)) && (param_3 != 0)) {
    if ((*param_1 == 'C') && (param_1[1] == '\0')) {
      eVar2 = _strcpy_s(param_2,param_3,"C");
      if (eVar2 != 0) {
                    /* WARNING: Subroutine does not return */
        __invoke_watson((wchar_t *)0x0,(wchar_t *)0x0,(wchar_t *)0x0,0,0);
      }
      if (param_4 != (undefined2 *)0x0) {
        *param_4 = 0;
        param_4[1] = 0;
        param_4[2] = 0;
      }
      if (param_5 != (undefined4 *)0x0) {
        *param_5 = 0;
      }
    }
    else {
      sVar3 = _strlen(param_1);
      if ((0x82 < sVar3) ||
         ((iVar4 = _strcmp(_Str1_00,param_1), iVar4 != 0 &&
          (iVar4 = _strcmp((char *)_Str1,param_1), iVar4 != 0)))) {
        iVar4 = ___lc_strtolc(local_98,param_1);
        if ((iVar4 != 0) ||
           (BVar5 = ___get_qualified_locale
                              ((LPLC_STRINGS)local_98,(UINT *)_LpCodePage,(LPLC_STRINGS)local_98),
           BVar5 == 0)) goto LAB_0063a3af;
        *(uint *)_Src = (uint)(ushort)(p_Var1->_setloc_data)._cachein[4];
        ___lc_lctostr(_Str1_00,0x83,local_98);
        if ((*param_1 == '\0') || (0x82 < sVar3)) {
          sVar3 = 0;
          param_1 = "";
        }
        eVar2 = _strncpy_s((char *)_Str1,0x83,param_1,sVar3 + 1);
        if (eVar2 != 0) {
                    /* WARNING: Subroutine does not return */
          __invoke_watson((wchar_t *)0x0,(wchar_t *)0x0,(wchar_t *)0x0,0,0);
        }
      }
      if (param_4 != (undefined2 *)0x0) {
        _memcpy(param_4,_LpCodePage,6);
      }
      if (param_5 != (undefined4 *)0x0) {
        _memcpy(param_5,_Src,4);
      }
      eVar2 = _strcpy_s(param_2,param_3,_Str1_00);
      if (eVar2 != 0) {
                    /* WARNING: Subroutine does not return */
        __invoke_watson((wchar_t *)0x0,(wchar_t *)0x0,(wchar_t *)0x0,0,0);
      }
    }
  }
LAB_0063a3af:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
0063a18d : MOV EDI,EDI
0063a18f : PUSH EBP
0063a190 : MOV EBP,ESP
0063a192 : SUB ESP,0xb4
0063a198 : MOV EAX,[0x00d66fa0]
0063a19d : XOR EAX,EBP
0063a19f : MOV dword ptr [EBP + -0x4],EAX
0063a1a2 : MOV EAX,dword ptr [EBP + 0xc]
0063a1a5 : PUSH EBX
0063a1a6 : PUSH ESI
0063a1a7 : MOV ESI,dword ptr [EBP + 0x8]
0063a1aa : PUSH EDI
0063a1ab : MOV EDI,dword ptr [EBP + 0x14]
0063a1ae : MOV dword ptr [EBP + 0xffffff64],EAX
0063a1b4 : MOV EAX,dword ptr [EBP + 0x18]
0063a1b7 : MOV dword ptr [EBP + 0xffffff5c],EDI
0063a1bd : MOV dword ptr [EBP + 0xffffff60],EAX
0063a1c3 : CALL 0x006458f6
0063a1c8 : ADD EAX,0x9c
0063a1cd : LEA ECX,[EAX + 0x28]
0063a1d0 : MOV dword ptr [EBP + 0xffffff54],ECX
0063a1d6 : LEA ECX,[EAX + 0x2c]
0063a1d9 : LEA EBX,[EAX + 0x20]
0063a1dc : ADD EAX,0xaf
0063a1e1 : MOV dword ptr [EBP + 0xffffff58],ECX
0063a1e7 : MOV dword ptr [EBP + 0xffffff68],EAX
0063a1ed : TEST ESI,ESI
0063a1ef : JZ 0x0063a3ad
0063a1f5 : CMP dword ptr [EBP + 0xffffff64],0x0
0063a1fc : JZ 0x0063a3ad
0063a202 : CMP dword ptr [EBP + 0x10],0x0
0063a206 : JZ 0x0063a3ad
0063a20c : CMP byte ptr [ESI],0x43
0063a20f : JNZ 0x0063a268
0063a211 : CMP byte ptr [ESI + 0x1],0x0
0063a215 : JNZ 0x0063a268
0063a217 : PUSH 0xb95a3c
0063a21c : PUSH dword ptr [EBP + 0x10]
0063a21f : PUSH dword ptr [EBP + 0xffffff64]
0063a225 : CALL 0x00638300
0063a22a : ADD ESP,0xc
0063a22d : XOR ESI,ESI
0063a22f : TEST EAX,EAX
0063a231 : JZ 0x0063a240
0063a233 : PUSH ESI
0063a234 : PUSH ESI
0063a235 : PUSH ESI
0063a236 : PUSH ESI
0063a237 : PUSH ESI
0063a238 : CALL 0x00637169
0063a240 : CMP EDI,ESI
0063a242 : JZ 0x0063a251
0063a244 : XOR EAX,EAX
0063a246 : MOV word ptr [EDI],AX
0063a249 : MOV word ptr [EDI + 0x2],AX
0063a24d : MOV word ptr [EDI + 0x4],AX
0063a251 : MOV EAX,dword ptr [EBP + 0xffffff60]
0063a257 : CMP EAX,ESI
0063a259 : JZ 0x0063a25d
0063a25b : MOV dword ptr [EAX],ESI
0063a25d : MOV EAX,dword ptr [EBP + 0xffffff64]
0063a263 : JMP 0x0063a3af
0063a268 : PUSH ESI
0063a269 : CALL 0x00640960
0063a26e : MOV EDI,0x83
0063a273 : POP ECX
0063a274 : MOV dword ptr [EBP + 0xffffff50],EAX
0063a27a : CMP EAX,EDI
0063a27c : JNC 0x0063a2aa
0063a27e : PUSH ESI
0063a27f : PUSH dword ptr [EBP + 0xffffff68]
0063a285 : CALL 0x00645e40
0063a28a : POP ECX
0063a28b : POP ECX
0063a28c : TEST EAX,EAX
0063a28e : JZ 0x0063a344
0063a294 : PUSH ESI
0063a295 : PUSH dword ptr [EBP + 0xffffff58]
0063a29b : CALL 0x00645e40
0063a2a0 : POP ECX
0063a2a1 : POP ECX
0063a2a2 : TEST EAX,EAX
0063a2a4 : JZ 0x0063a344
0063a2aa : AND dword ptr [EBP + 0xffffff4c],0x0
0063a2b1 : LEA EAX,[EBP + 0xffffff6c]
0063a2b7 : PUSH ESI
0063a2b8 : PUSH EAX
0063a2b9 : CALL 0x00639e7a
0063a2be : POP ECX
0063a2bf : POP ECX
0063a2c0 : TEST EAX,EAX
0063a2c2 : JNZ 0x0063a3ad
0063a2c8 : LEA EAX,[EBP + 0xffffff6c]
0063a2ce : PUSH EAX
0063a2cf : PUSH EBX
0063a2d0 : PUSH EAX
0063a2d1 : CALL 0x00655976
0063a2d6 : ADD ESP,0xc
0063a2d9 : TEST EAX,EAX
0063a2db : JZ 0x0063a3ad
0063a2e1 : MOVZX EAX,word ptr [EBX + 0x4]
0063a2e5 : MOV ECX,dword ptr [EBP + 0xffffff54]
0063a2eb : MOV dword ptr [ECX],EAX
0063a2ed : LEA EAX,[EBP + 0xffffff6c]
0063a2f3 : PUSH EAX
0063a2f4 : PUSH EDI
0063a2f5 : PUSH dword ptr [EBP + 0xffffff68]
0063a2fb : CALL 0x00639fa3
0063a300 : ADD ESP,0xc
0063a303 : CMP byte ptr [ESI],0x0
0063a306 : JZ 0x0063a312
0063a308 : MOV EAX,dword ptr [EBP + 0xffffff50]
0063a30e : CMP EAX,EDI
0063a310 : JC 0x0063a31d
0063a312 : MOV EAX,dword ptr [EBP + 0xffffff4c]
0063a318 : MOV ESI,0xcca874
0063a31d : INC EAX
0063a31e : PUSH EAX
0063a31f : PUSH ESI
0063a320 : PUSH EDI
0063a321 : PUSH dword ptr [EBP + 0xffffff58]
0063a327 : CALL 0x0063c196
0063a32c : ADD ESP,0x10
0063a32f : TEST EAX,EAX
0063a331 : JZ 0x0063a344
0063a333 : XOR ESI,ESI
0063a335 : PUSH ESI
0063a336 : PUSH ESI
0063a337 : PUSH ESI
0063a338 : PUSH ESI
0063a339 : PUSH ESI
0063a33a : CALL 0x00637169
0063a344 : XOR ESI,ESI
0063a346 : CMP dword ptr [EBP + 0xffffff5c],ESI
0063a34c : JZ 0x0063a35f
0063a34e : PUSH 0x6
0063a350 : PUSH EBX
0063a351 : PUSH dword ptr [EBP + 0xffffff5c]
0063a357 : CALL 0x0063ae40
0063a35c : ADD ESP,0xc
0063a35f : CMP dword ptr [EBP + 0xffffff60],ESI
0063a365 : JZ 0x0063a37d
0063a367 : PUSH 0x4
0063a369 : PUSH dword ptr [EBP + 0xffffff54]
0063a36f : PUSH dword ptr [EBP + 0xffffff60]
0063a375 : CALL 0x0063ae40
0063a37a : ADD ESP,0xc
0063a37d : PUSH dword ptr [EBP + 0xffffff68]
0063a383 : PUSH dword ptr [EBP + 0x10]
0063a386 : PUSH dword ptr [EBP + 0xffffff64]
0063a38c : CALL 0x00638300
0063a391 : ADD ESP,0xc
0063a394 : TEST EAX,EAX
0063a396 : JZ 0x0063a3a5
0063a398 : PUSH ESI
0063a399 : PUSH ESI
0063a39a : PUSH ESI
0063a39b : PUSH ESI
0063a39c : PUSH ESI
0063a39d : CALL 0x00637169
0063a3a5 : MOV EAX,dword ptr [EBP + 0xffffff68]
0063a3ab : JMP 0x0063a3af
0063a3ad : XOR EAX,EAX
0063a3af : MOV ECX,dword ptr [EBP + -0x4]
0063a3b2 : POP EDI
0063a3b3 : POP ESI
0063a3b4 : XOR ECX,EBP
0063a3b6 : POP EBX
0063a3b7 : CALL 0x00633e6b
0063a3bc : LEAVE
0063a3bd : RET
