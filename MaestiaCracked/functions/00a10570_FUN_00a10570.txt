PROGRAM  : Maestia.exe
FUNCTION : FUN_00a10570
ENTRY    : 00a10570
BODY     : [[00a10570, 00a10718] [00a10747, 00a107dd]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a10570(int param_1)

{
  int *piVar1;
  uint uVar2;
  int iVar3;
  LONG LVar4;
  uint uVar5;
  int iVar6;
  undefined1 local_2c [4];
  undefined2 local_28;
  undefined4 local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b709a2;
  local_10 = ExceptionList;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if ((DAT_0172491c == 0) || (*(int *)(DAT_0172491c + 0x17c) == 0)) {
    local_14 = 7;
    local_18 = 0;
    local_28 = 0;
    FUN_00406360(L"CheckTargetMeProcess",0x14);
    local_8 = 0;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                (L"AvaActionQueue::CheckTargetMeProcess",0x460,local_2c);
    }
    local_8 = 0xffffffff;
    if (7 < local_14) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
  }
  else if (*(int *)(param_1 + 0x3c) != 0) {
    do {
      local_8 = 0xffffffff;
      piVar1 = *(int **)(param_1 + 0x20);
      uVar5 = *(uint *)(param_1 + 0x38) >> 2;
      if (piVar1 == (int *)0x0) {
        iVar3 = 0;
      }
      else {
        iVar3 = *piVar1;
      }
      if (*(uint *)(iVar3 + 0x14) <= uVar5) {
        if (piVar1 == (int *)0x0) {
          iVar3 = 0;
        }
        else {
          iVar3 = *piVar1;
        }
        uVar5 = uVar5 - *(int *)(iVar3 + 0x14);
      }
      if (piVar1 == (int *)0x0) {
        iVar3 = 0;
      }
      else {
        iVar3 = *piVar1;
      }
      iVar3 = *(int *)(*(int *)(*(int *)(iVar3 + 0x10) + uVar5 * 4) +
                      (*(uint *)(param_1 + 0x38) & 3) * 4);
      if (iVar3 != 0) {
        iVar6 = *(int *)(iVar3 + 4);
        if ((*(char *)(*(int *)(iVar6 + 8) + 3) == '\x02') &&
           (*(int *)(*(int *)(iVar6 + 8) + 0xc) == *(int *)(*(int *)(DAT_0172491c + 0x17c) + 4))) {
          FUN_00b01d30(uVar2);
          iVar6 = *(int *)(iVar3 + 4);
        }
        LVar4 = InterlockedDecrement((LONG *)(iVar6 + 4));
        if ((LVar4 == 0) && (iVar6 != 0)) {
          if (*(int *)(iVar6 + 8) == 0) {
            *(undefined4 *)(iVar6 + 8) = 0;
                    /* WARNING: Subroutine does not return */
            FUN_006f04e0();
          }
                    /* WARNING: Subroutine does not return */
          FUN_006f04e0();
        }
        *(undefined4 *)(iVar3 + 4) = 0;
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      local_14 = 7;
      local_18 = 0;
      local_28 = 0;
      FUN_00406360(L"pItem NULL",10);
      local_8 = 1;
      if ((int *)*DAT_00da98e8 != (int *)0x0) {
        (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                  (L"AvaActionQueue::CheckTargetMeProcess",0x469,local_2c);
      }
      local_8 = 0xffffffff;
      if (7 < local_14) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      local_28 = 0;
      local_14 = 7;
      local_18 = 0;
      if (*(int *)(param_1 + 0x3c) != 0) {
        *(int *)(param_1 + 0x38) = *(int *)(param_1 + 0x38) + 1;
        if ((uint)(*(int *)(param_1 + 0x34) * 4) <= *(uint *)(param_1 + 0x38)) {
          *(undefined4 *)(param_1 + 0x38) = 0;
        }
        iVar3 = *(int *)(param_1 + 0x3c) + -1;
        *(int *)(param_1 + 0x3c) = iVar3;
        if (iVar3 == 0) {
          *(undefined4 *)(param_1 + 0x38) = 0;
        }
      }
    } while (*(int *)(param_1 + 0x3c) != 0);
    ExceptionList = local_10;
    return;
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00a10570 : PUSH EBP
00a10571 : MOV EBP,ESP
00a10573 : PUSH -0x1
00a10575 : PUSH 0xb709a2
00a1057a : MOV EAX,FS:[0x0]
00a10580 : PUSH EAX
00a10581 : SUB ESP,0x1c
00a10584 : PUSH EBX
00a10585 : PUSH ESI
00a10586 : PUSH EDI
00a10587 : MOV EAX,[0x00d66fa0]
00a1058c : XOR EAX,EBP
00a1058e : PUSH EAX
00a1058f : LEA EAX,[EBP + -0xc]
00a10592 : MOV FS:[0x0],EAX
00a10598 : MOV EBX,dword ptr [EBP + 0x8]
00a1059b : MOV EAX,[0x0172491c]
00a105a0 : XOR ESI,ESI
00a105a2 : CMP EAX,ESI
00a105a4 : JZ 0x00a10765
00a105aa : CMP dword ptr [EAX + 0x17c],ESI
00a105b0 : JZ 0x00a10765
00a105b6 : CMP dword ptr [EBX + 0x3c],ESI
00a105b9 : JZ 0x00a107ca
00a105bf : JMP 0x00a105c3
00a105c1 : XOR ESI,ESI
00a105c3 : MOV EAX,dword ptr [EBX + 0x38]
00a105c6 : MOV EDX,dword ptr [EBX + 0x20]
00a105c9 : MOV ECX,EAX
00a105cb : SHR ECX,0x2
00a105ce : AND EAX,0x3
00a105d1 : CMP EDX,ESI
00a105d3 : JZ 0x00a105d9
00a105d5 : MOV EDI,dword ptr [EDX]
00a105d7 : JMP 0x00a105db
00a105d9 : XOR EDI,EDI
00a105db : CMP dword ptr [EDI + 0x14],ECX
00a105de : JA 0x00a105ed
00a105e0 : CMP EDX,ESI
00a105e2 : JZ 0x00a105e8
00a105e4 : MOV EDI,dword ptr [EDX]
00a105e6 : JMP 0x00a105ea
00a105e8 : XOR EDI,EDI
00a105ea : SUB ECX,dword ptr [EDI + 0x14]
00a105ed : CMP EDX,ESI
00a105ef : JZ 0x00a105f5
00a105f1 : MOV EDX,dword ptr [EDX]
00a105f3 : JMP 0x00a105f7
00a105f5 : XOR EDX,EDX
00a105f7 : MOV EDX,dword ptr [EDX + 0x10]
00a105fa : MOV ECX,dword ptr [EDX + ECX*0x4]
00a105fd : MOV EDI,dword ptr [ECX + EAX*0x4]
00a10600 : MOV dword ptr [EBP + 0x8],EDI
00a10603 : CMP EDI,ESI
00a10605 : JNZ 0x00a106a9
00a1060b : PUSH 0xa
00a1060d : XOR EDX,EDX
00a1060f : MOV EDI,0x7
00a10614 : PUSH 0xcbde5c
00a10619 : LEA ECX,[EBP + -0x28]
00a1061c : MOV dword ptr [EBP + -0x10],EDI
00a1061f : MOV dword ptr [EBP + -0x14],ESI
00a10622 : MOV word ptr [EBP + -0x24],DX
00a10626 : CALL 0x00406360
00a1062b : MOV ESI,0x1
00a10630 : MOV dword ptr [EBP + -0x4],ESI
00a10633 : MOV EAX,[0x00da98e8]
00a10638 : MOV ECX,dword ptr [EAX]
00a1063a : TEST ECX,ECX
00a1063c : JZ 0x00a10653
00a1063e : MOV EDX,dword ptr [ECX]
00a10640 : MOV EDX,dword ptr [EDX + 0x14]
00a10643 : LEA EAX,[EBP + -0x28]
00a10646 : PUSH EAX
00a10647 : PUSH 0x469
00a1064c : PUSH 0xcbde78
00a10651 : CALL EDX
00a10653 : MOV dword ptr [EBP + -0x4],0xffffffff
00a1065a : CMP dword ptr [EBP + -0x10],0x8
00a1065e : JC 0x00a10668
00a10660 : MOV ECX,dword ptr [EBP + -0x24]
00a10663 : CALL 0x006f04e0
00a10668 : XOR EAX,EAX
00a1066a : XOR EDX,EDX
00a1066c : MOV word ptr [EBP + -0x24],AX
00a10670 : MOV EAX,dword ptr [EBX + 0x3c]
00a10673 : MOV dword ptr [EBP + -0x10],EDI
00a10676 : MOV dword ptr [EBP + -0x14],EDX
00a10679 : CMP EAX,EDX
00a1067b : JZ 0x00a10747
00a10681 : ADD dword ptr [EBX + 0x38],ESI
00a10684 : MOV ESI,dword ptr [EBX + 0x34]
00a10687 : MOV ECX,dword ptr [EBX + 0x38]
00a1068a : ADD ESI,ESI
00a1068c : ADD ESI,ESI
00a1068e : CMP ESI,ECX
00a10690 : JA 0x00a10695
00a10692 : MOV dword ptr [EBX + 0x38],EDX
00a10695 : DEC EAX
00a10696 : MOV dword ptr [EBX + 0x3c],EAX
00a10699 : CMP EAX,EDX
00a1069b : JNZ 0x00a10747
00a106a1 : MOV dword ptr [EBX + 0x38],EDX
00a106a4 : JMP 0x00a10747
00a106a9 : MOV ESI,dword ptr [EDI + 0x4]
00a106ac : MOV EAX,dword ptr [ESI + 0x8]
00a106af : CMP byte ptr [EAX + 0x3],0x2
00a106b3 : JNZ 0x00a106df
00a106b5 : MOV ECX,dword ptr [0x0172491c]
00a106bb : MOV EDX,dword ptr [ECX + 0x17c]
00a106c1 : MOV ECX,dword ptr [EAX + 0xc]
00a106c4 : CMP ECX,dword ptr [EDX + 0x4]
00a106c7 : JNZ 0x00a106df
00a106c9 : MOV EDI,dword ptr [EBP + 0xc]
00a106cc : MOV ESI,EAX
00a106ce : CALL 0x00b01d30
00a106d3 : MOV EDI,dword ptr [EBP + 0x8]
00a106d6 : MOV ESI,dword ptr [EDI + 0x4]
00a106d9 : LEA EDX,[ESI + 0x4]
00a106dc : PUSH EDX
00a106dd : JMP 0x00a106e3
00a106df : LEA EAX,[ESI + 0x4]
00a106e2 : PUSH EAX
00a106e3 : CALL dword ptr [0x00b851b0]
00a106e9 : TEST EAX,EAX
00a106eb : JNZ 0x00a1070b
00a106ed : TEST ESI,ESI
00a106ef : JZ 0x00a1070b
00a106f1 : MOV ECX,dword ptr [ESI + 0x8]
00a106f4 : TEST ECX,ECX
00a106f6 : JZ 0x00a106fd
00a106f8 : CALL 0x006f04e0
00a106fd : MOV ECX,ESI
00a106ff : MOV dword ptr [ESI + 0x8],0x0
00a10706 : CALL 0x006f04e0
00a1070b : MOV ECX,EDI
00a1070d : MOV dword ptr [EDI + 0x4],0x0
00a10714 : CALL 0x006f04e0
00a10747 : CMP dword ptr [EBX + 0x3c],0x0
00a1074b : JNZ 0x00a105c1
00a10751 : MOV ECX,dword ptr [EBP + -0xc]
00a10754 : MOV dword ptr FS:[0x0],ECX
00a1075b : POP ECX
00a1075c : POP EDI
00a1075d : POP ESI
00a1075e : POP EBX
00a1075f : MOV ESP,EBP
00a10761 : POP EBP
00a10762 : RET 0x8
00a10765 : PUSH 0x14
00a10767 : XOR EAX,EAX
00a10769 : MOV EDI,0x7
00a1076e : PUSH 0xcbdde4
00a10773 : LEA ECX,[EBP + -0x28]
00a10776 : MOV dword ptr [EBP + -0x10],EDI
00a10779 : MOV dword ptr [EBP + -0x14],ESI
00a1077c : MOV word ptr [EBP + -0x24],AX
00a10780 : CALL 0x00406360
00a10785 : MOV dword ptr [EBP + -0x4],ESI
00a10788 : MOV ECX,dword ptr [0x00da98e8]
00a1078e : MOV ECX,dword ptr [ECX]
00a10790 : CMP ECX,ESI
00a10792 : JZ 0x00a107a9
00a10794 : MOV EDX,dword ptr [ECX]
00a10796 : MOV EDX,dword ptr [EDX + 0x14]
00a10799 : LEA EAX,[EBP + -0x28]
00a1079c : PUSH EAX
00a1079d : PUSH 0x460
00a107a2 : PUSH 0xcbde10
00a107a7 : CALL EDX
00a107a9 : MOV dword ptr [EBP + -0x4],0xffffffff
00a107b0 : CMP dword ptr [EBP + -0x10],0x8
00a107b4 : JC 0x00a107be
00a107b6 : MOV ECX,dword ptr [EBP + -0x24]
00a107b9 : CALL 0x006f04e0
00a107be : XOR EAX,EAX
00a107c0 : MOV dword ptr [EBP + -0x10],EDI
00a107c3 : MOV dword ptr [EBP + -0x14],ESI
00a107c6 : MOV word ptr [EBP + -0x24],AX
00a107ca : MOV ECX,dword ptr [EBP + -0xc]
00a107cd : MOV dword ptr FS:[0x0],ECX
00a107d4 : POP ECX
00a107d5 : POP EDI
00a107d6 : POP ESI
00a107d7 : POP EBX
00a107d8 : MOV ESP,EBP
00a107da : POP EBP
00a107db : RET 0x8
