PROGRAM  : Maestia.exe
FUNCTION : FUN_008665a0
ENTRY    : 008665a0
BODY     : [[008665a0, 008669da]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008665a0(int *param_1,uint param_2,char param_3,undefined4 param_4,int param_5)

{
  undefined1 uVar1;
  int iVar2;
  int iVar3;
  undefined1 auStack_28c [7];
  undefined1 local_285;
  uint local_284;
  int local_280;
  undefined1 local_27c;
  byte local_27b;
  undefined4 local_278;
  undefined4 local_274;
  undefined2 local_270;
  undefined1 local_26e;
  int local_26c;
  undefined1 local_268;
  undefined1 auStack_260 [28];
  undefined1 local_244 [28];
  undefined **ppuStack_228;
  undefined1 auStack_220 [516];
  uint local_1c;
  void *local_14;
  undefined1 *puStack_10;
  undefined4 local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b5f302;
  local_14 = ExceptionList;
  local_1c = DAT_00d66fa0 ^ (uint)auStack_28c;
  ExceptionList = &local_14;
  if ((param_5 != 0) ||
     ((((byte)param_2 < 0x21 && (param_1[(param_2 & 0xff) + 0x5fc] != 0)) &&
      (param_1[(param_2 & 0xff) + 0x5ba] != 0)))) {
    if ((*(char *)((int)param_1 + 0x65d) == '\0') && ((char)param_4 == '\0')) {
      local_27b = (byte)param_2;
      local_270 = 0;
      local_268 = 0;
      local_27c = 0;
      local_278 = 0;
      local_274 = 0;
      local_26e = 1;
      local_26c = param_5;
      FUN_0041dea0(&local_27c);
    }
    else {
      local_285 = 0;
      local_284 = 0;
      local_280 = FUN_00856e80(&local_284);
      if (((byte)param_2 < 0x21) && (param_1[(param_2 & 0xff) + 0x5fc] != 0)) {
        iVar3 = param_1[(param_2 & 0xff) + 0x5ba];
      }
      else {
        iVar3 = 0;
      }
      iVar2 = FUN_00862250(param_1,param_2,&local_284,&local_285,param_5);
      if (iVar2 != 0) {
        switch(param_2 & 0xff) {
        case 0:
          (**(code **)(*param_1 + 0x49c))((short)param_1[0x10f],1);
          (**(code **)(*param_1 + 0x484))(0);
          break;
        case 1:
          FUN_00406460(&DAT_00c3f468);
          local_c = 0;
          FUN_0084ceb0(&local_27c,iVar3);
          local_c = 0xffffffff;
          FUN_00406560();
          *(undefined4 *)(param_1[0x5fd] + 0x28) = 0;
          (**(code **)(*param_1 + 0x48c))(0);
          break;
        case 2:
        case 3:
        case 4:
        case 5:
        case 6:
        case 7:
        case 8:
        case 9:
        case 10:
        case 0x14:
        case 0x15:
        case 0x16:
        case 0x17:
        case 0x18:
        case 0x19:
        case 0x1a:
        case 0x1b:
        case 0x1c:
        case 0x1d:
          break;
        case 0xb:
          FUN_00406460(L"temp");
          local_c = 1;
          uVar1 = (**(code **)(*param_1 + 0x21c))();
          FUN_0084e210(local_244,param_1,1,0,1,uVar1);
          local_c = 0xffffffff;
          FUN_00406560();
          FUN_0085b4d0(param_1,0xb);
          if (local_280 != 0) {
            if (((local_284 >> 0x1e & 1) != 0) && (iVar3 = FUN_00404440(), iVar3 != 0)) {
              FUN_0040e600();
              local_c = 2;
              FUN_00406e40(iVar3 + 0x40);
              FUN_00406460(auStack_220);
              local_c._0_1_ = 3;
              uVar1 = (**(code **)(*param_1 + 0x21c))();
              FUN_0084e210(auStack_260,param_1,1,0,0,uVar1);
              local_c = CONCAT31(local_c._1_3_,2);
              FUN_00406560();
              local_c = 0xffffffff;
              ppuStack_228 = &PTR_FUN_00cd083c;
            }
            FUN_0085a780(param_1,1,(char)param_1[0x6af],1);
          }
          local_284 = 0;
          iVar3 = FUN_0085af40(&local_284,0);
          if (iVar3 != 0) {
            FUN_00862130(4);
          }
          if (((char)param_1[0x6af] != '\0') && (iVar3 = FUN_0085af40(&local_284,0), iVar3 != 0)) {
            FUN_00862130(2);
          }
          iVar3 = FUN_0085af40(&local_284,0);
          if (iVar3 != 0) {
            FUN_00862130(9);
          }
          iVar3 = FUN_0085af40(&local_284,0);
          if (iVar3 != 0) {
            FUN_00862130(5);
          }
          iVar3 = FUN_0085af40(&local_284,0);
          if (iVar3 != 0) {
            FUN_00862130(7);
          }
          iVar3 = FUN_0085af40(&local_284,0);
          if (iVar3 != 0) {
            FUN_00862130(8);
          }
          local_280 = 0x14;
          do {
            if (((local_280 != 0x14) || ((char)param_1[0x6af] != '\0')) &&
               (iVar3 = FUN_0085af40(&local_284,0), iVar3 != 0)) {
              FUN_00862130(local_280);
            }
            local_280 = local_280 + 1;
          } while (local_280 < 0x1e);
          local_285 = 1;
          break;
        default:
          FUN_008018d0(L"Put off UnKnown type");
          break;
        case 0x28:
          FUN_00865f30(param_1,0,param_4);
        }
        FUN_00862750(param_1,local_285);
        if (param_3 != '\0') {
          (**(code **)(*param_1 + 0x4a0))(param_2,1);
        }
      }
    }
  }
  ExceptionList = local_14;
  __security_check_cookie(local_1c ^ (uint)auStack_28c);
  return;
}



============================================================
DISASSEMBLY
============================================================
008665a0 : PUSH EBP
008665a1 : MOV EBP,ESP
008665a3 : AND ESP,0xfffffff8
008665a6 : PUSH -0x1
008665a8 : PUSH 0xb5f302
008665ad : MOV EAX,FS:[0x0]
008665b3 : PUSH EAX
008665b4 : SUB ESP,0x278
008665ba : MOV EAX,[0x00d66fa0]
008665bf : XOR EAX,ESP
008665c1 : MOV dword ptr [ESP + 0x270],EAX
008665c8 : PUSH EBX
008665c9 : PUSH ESI
008665ca : PUSH EDI
008665cb : MOV EAX,[0x00d66fa0]
008665d0 : XOR EAX,ESP
008665d2 : PUSH EAX
008665d3 : LEA EAX,[ESP + 0x288]
008665da : MOV FS:[0x0],EAX
008665e0 : MOV EDX,dword ptr [EBP + 0x18]
008665e3 : MOV EBX,dword ptr [EBP + 0x8]
008665e6 : MOV CL,byte ptr [EBP + 0xc]
008665e9 : XOR EDI,EDI
008665eb : CMP EDX,EDI
008665ed : JNZ 0x00866615
008665ef : CMP CL,0x21
008665f2 : JNC 0x008669b5
008665f8 : MOVZX EAX,CL
008665fb : CMP dword ptr [EBX + EAX*0x4 + 0x17f0],EDI
00866602 : JZ 0x008669b5
00866608 : CMP dword ptr [EBX + EAX*0x4 + 0x16e8],EDI
0086660f : JZ 0x008669b5
00866615 : CMP byte ptr [EBX + 0x65d],0x0
0086661c : JNZ 0x0086665d
0086661e : CMP byte ptr [EBP + 0x14],0x0
00866622 : JNZ 0x0086665d
00866624 : XOR EAX,EAX
00866626 : MOV byte ptr [ESP + 0x21],CL
0086662a : LEA ECX,[ESP + 0x20]
0086662e : MOV word ptr [ESP + 0x2c],AX
00866633 : MOV byte ptr [ESP + 0x34],AL
00866637 : MOV byte ptr [ESP + 0x20],AL
0086663b : PUSH ECX
0086663c : LEA EAX,[EBX + 0x19a4]
00866642 : MOV dword ptr [ESP + 0x28],EDI
00866646 : MOV dword ptr [ESP + 0x2c],EDI
0086664a : MOV byte ptr [ESP + 0x32],0x1
0086664f : MOV dword ptr [ESP + 0x34],EDX
00866653 : CALL 0x0041dea0
00866658 : JMP 0x008669b5
0086665d : LEA EDX,[ESP + 0x18]
00866661 : PUSH EDX
00866662 : MOV EAX,EBX
00866664 : MOV byte ptr [ESP + 0x1b],0x0
00866669 : MOV dword ptr [ESP + 0x1c],EDI
0086666d : CALL 0x00856e80
00866672 : MOV ECX,dword ptr [EBP + 0xc]
00866675 : MOV dword ptr [ESP + 0x1c],EAX
00866679 : CMP CL,0x21
0086667c : JNC 0x00866693
0086667e : MOVZX EAX,CL
00866681 : CMP dword ptr [EBX + EAX*0x4 + 0x17f0],EDI
00866688 : JZ 0x00866693
0086668a : MOV ESI,dword ptr [EBX + EAX*0x4 + 0x16e8]
00866691 : JMP 0x00866695
00866693 : XOR ESI,ESI
00866695 : MOV EAX,dword ptr [EBP + 0x18]
00866698 : PUSH EAX
00866699 : LEA EDX,[ESP + 0x1b]
0086669d : PUSH EDX
0086669e : LEA EAX,[ESP + 0x20]
008666a2 : PUSH EAX
008666a3 : PUSH ECX
008666a4 : PUSH EBX
008666a5 : CALL 0x00862250
008666aa : TEST EAX,EAX
008666ac : JZ 0x008669b5
008666b2 : MOVZX EAX,byte ptr [EBP + 0xc]
008666b6 : CMP EAX,0x28
008666b9 : JA 0x0086697e
008666bf : MOVZX ECX,byte ptr [EAX + 0x8669f4]
008666c6 : JMP dword ptr [ECX*0x4 + 0x8669dc]
008666cd : MOVZX EAX,word ptr [EBX + 0x43c]
008666d4 : MOV EDX,dword ptr [EBX]
008666d6 : MOV EDX,dword ptr [EDX + 0x49c]
008666dc : PUSH 0x1
008666de : PUSH EAX
008666df : MOV ECX,EBX
008666e1 : CALL EDX
008666e3 : MOV EAX,dword ptr [EBX]
008666e5 : MOV EDX,dword ptr [EAX + 0x484]
008666eb : PUSH EDI
008666ec : MOV ECX,EBX
008666ee : CALL EDX
008666f0 : JMP 0x00866991
008666f5 : PUSH 0xc3f468
008666fa : LEA ECX,[ESP + 0x24]
008666fe : CALL 0x00406460
00866703 : MOV dword ptr [ESP + 0x290],EDI
0086670a : MOV ECX,dword ptr [EBX + 0x17f4]
00866710 : PUSH ESI
00866711 : LEA EAX,[ESP + 0x24]
00866715 : PUSH EAX
00866716 : CALL 0x0084ceb0
0086671b : MOV dword ptr [ESP + 0x290],0xffffffff
00866726 : LEA ECX,[ESP + 0x20]
0086672a : CALL 0x00406560
0086672f : MOV ECX,dword ptr [EBX + 0x17f4]
00866735 : MOV dword ptr [ECX + 0x28],EDI
00866738 : MOV EDX,dword ptr [EBX]
0086673a : MOV EAX,dword ptr [EDX + 0x48c]
00866740 : PUSH EDI
00866741 : MOV ECX,EBX
00866743 : CALL EAX
00866745 : JMP 0x00866991
0086674a : PUSH 0xc3f46c
0086674f : LEA ECX,[ESP + 0x5c]
00866753 : CALL 0x00406460
00866758 : MOV dword ptr [ESP + 0x290],0x1
00866763 : MOV EDX,dword ptr [EBX]
00866765 : MOV EAX,dword ptr [EDX + 0x21c]
0086676b : MOV ECX,EBX
0086676d : CALL EAX
0086676f : MOVZX ECX,AL
00866772 : PUSH ECX
00866773 : MOV ECX,dword ptr [EBX + 0x181c]
00866779 : PUSH 0x1
0086677b : PUSH EDI
0086677c : PUSH 0x1
0086677e : PUSH EBX
0086677f : LEA EDX,[ESP + 0x6c]
00866783 : PUSH EDX
00866784 : CALL 0x0084e210
00866789 : MOV dword ptr [ESP + 0x290],0xffffffff
00866794 : LEA ECX,[ESP + 0x58]
00866798 : CALL 0x00406560
0086679d : PUSH 0xb
0086679f : PUSH EBX
008667a0 : CALL 0x0085b4d0
008667a5 : CMP dword ptr [ESP + 0x1c],EDI
008667a9 : JBE 0x00866869
008667af : MOV EAX,dword ptr [ESP + 0x18]
008667b3 : SHR EAX,0x1e
008667b6 : AND EAX,0x1
008667b9 : JZ 0x00866857
008667bf : MOV SI,word ptr [EBX + 0x1698]
008667c6 : CALL 0x00404440
008667cb : MOV EDI,EAX
008667cd : TEST EDI,EDI
008667cf : JZ 0x00866855
008667d5 : LEA ESI,[ESP + 0x74]
008667d9 : CALL 0x0040e600
008667de : MOV dword ptr [ESP + 0x290],0x2
008667e9 : ADD EDI,0x40
008667ec : PUSH EDI
008667ed : MOV EDI,ESI
008667ef : CALL 0x00406e40
008667f4 : LEA ECX,[ESP + 0x7c]
008667f8 : PUSH ECX
008667f9 : LEA ECX,[ESP + 0x40]
008667fd : CALL 0x00406460
00866802 : MOV byte ptr [ESP + 0x290],0x3
0086680a : MOV EDX,dword ptr [EBX]
0086680c : MOV EAX,dword ptr [EDX + 0x21c]
00866812 : MOV ECX,EBX
00866814 : CALL EAX
00866816 : MOVZX ECX,AL
00866819 : PUSH ECX
0086681a : MOV ECX,dword ptr [EBX + 0x1868]
00866820 : PUSH 0x0
00866822 : PUSH 0x0
00866824 : PUSH 0x1
00866826 : PUSH EBX
00866827 : LEA EDX,[ESP + 0x50]
0086682b : PUSH EDX
0086682c : CALL 0x0084e210
00866831 : MOV byte ptr [ESP + 0x290],0x2
00866839 : LEA ECX,[ESP + 0x3c]
0086683d : CALL 0x00406560
00866842 : MOV dword ptr [ESP + 0x290],0xffffffff
0086684d : MOV dword ptr [ESP + 0x74],0xcd083c
00866855 : XOR EDI,EDI
00866857 : MOVZX EAX,byte ptr [EBX + 0x1abc]
0086685e : PUSH 0x1
00866860 : PUSH EAX
00866861 : PUSH 0x1
00866863 : PUSH EBX
00866864 : CALL 0x0085a780
00866869 : PUSH EDI
0086686a : LEA ECX,[ESP + 0x1c]
0086686e : MOV dword ptr [ESP + 0x1c],EDI
00866872 : PUSH ECX
00866873 : MOV CL,0x4
00866875 : MOV EDI,EBX
00866877 : CALL 0x0085af40
0086687c : TEST EAX,EAX
0086687e : JZ 0x00866889
00866880 : PUSH 0x4
00866882 : MOV ECX,EBX
00866884 : CALL 0x00862130
00866889 : CMP byte ptr [EBX + 0x1abc],0x0
00866890 : JZ 0x008668af
00866892 : PUSH 0x0
00866894 : LEA EDX,[ESP + 0x1c]
00866898 : PUSH EDX
00866899 : MOV CL,0x2
0086689b : MOV EDI,EBX
0086689d : CALL 0x0085af40
008668a2 : TEST EAX,EAX
008668a4 : JZ 0x008668af
008668a6 : PUSH 0x2
008668a8 : MOV ECX,EBX
008668aa : CALL 0x00862130
008668af : PUSH 0x0
008668b1 : LEA EAX,[ESP + 0x1c]
008668b5 : PUSH EAX
008668b6 : MOV CL,0x9
008668b8 : MOV EDI,EBX
008668ba : CALL 0x0085af40
008668bf : TEST EAX,EAX
008668c1 : JZ 0x008668cc
008668c3 : PUSH 0x9
008668c5 : MOV ECX,EBX
008668c7 : CALL 0x00862130
008668cc : LEA ECX,[ESP + 0x18]
008668d0 : PUSH 0x0
008668d2 : PUSH ECX
008668d3 : MOV CL,0x5
008668d5 : MOV EDI,EBX
008668d7 : CALL 0x0085af40
008668dc : TEST EAX,EAX
008668de : JZ 0x008668e9
008668e0 : PUSH 0x5
008668e2 : MOV ECX,EBX
008668e4 : CALL 0x00862130
008668e9 : PUSH 0x0
008668eb : LEA EDX,[ESP + 0x1c]
008668ef : PUSH EDX
008668f0 : MOV CL,0x7
008668f2 : MOV EDI,EBX
008668f4 : CALL 0x0085af40
008668f9 : TEST EAX,EAX
008668fb : JZ 0x00866906
008668fd : PUSH 0x7
008668ff : MOV ECX,EBX
00866901 : CALL 0x00862130
00866906 : PUSH 0x0
00866908 : LEA EAX,[ESP + 0x1c]
0086690c : PUSH EAX
0086690d : MOV CL,0x8
0086690f : MOV EDI,EBX
00866911 : CALL 0x0085af40
00866916 : TEST EAX,EAX
00866918 : JZ 0x00866923
0086691a : PUSH 0x8
0086691c : MOV ECX,EBX
0086691e : CALL 0x00862130
00866923 : MOV ECX,0x14
00866928 : MOV dword ptr [ESP + 0x1c],ECX
0086692c : LEA ESP,[ESP]
00866930 : CMP ECX,0x14
00866933 : JNZ 0x0086693e
00866935 : CMP byte ptr [EBX + 0x1abc],0x0
0086693c : JZ 0x00866960
0086693e : PUSH 0x0
00866940 : LEA EDX,[ESP + 0x1c]
00866944 : PUSH EDX
00866945 : MOV EDI,EBX
00866947 : CALL 0x0085af40
0086694c : TEST EAX,EAX
0086694e : JZ 0x0086695c
00866950 : MOV EAX,dword ptr [ESP + 0x1c]
00866954 : PUSH EAX
00866955 : MOV ECX,EBX
00866957 : CALL 0x00862130
0086695c : MOV ECX,dword ptr [ESP + 0x1c]
00866960 : INC ECX
00866961 : CMP ECX,0x1d
00866964 : MOV dword ptr [ESP + 0x1c],ECX
00866968 : JLE 0x00866930
0086696a : MOV byte ptr [ESP + 0x17],0x1
0086696f : JMP 0x00866991
00866971 : MOV ECX,dword ptr [EBP + 0x14]
00866974 : PUSH ECX
00866975 : PUSH EDI
00866976 : PUSH EBX
00866977 : CALL 0x00865f30
0086697c : JMP 0x00866991
0086697e : MOV ESI,dword ptr [0x00da98e8]
00866984 : PUSH 0xc3f478
00866989 : CALL 0x008018d0
0086698e : ADD ESP,0x4
00866991 : MOVZX EDX,byte ptr [ESP + 0x17]
00866996 : PUSH EDX
00866997 : PUSH EBX
00866998 : CALL 0x00862750
0086699d : CMP byte ptr [EBP + 0x10],0x0
008669a1 : JZ 0x008669b5
008669a3 : MOV ECX,dword ptr [EBP + 0xc]
008669a6 : MOV EAX,dword ptr [EBX]
008669a8 : MOV EDX,dword ptr [EAX + 0x4a0]
008669ae : PUSH 0x1
008669b0 : PUSH ECX
008669b1 : MOV ECX,EBX
008669b3 : CALL EDX
008669b5 : MOV ECX,dword ptr [ESP + 0x288]
008669bc : MOV dword ptr FS:[0x0],ECX
008669c3 : POP ECX
008669c4 : POP EDI
008669c5 : POP ESI
008669c6 : POP EBX
008669c7 : MOV ECX,dword ptr [ESP + 0x270]
008669ce : XOR ECX,ESP
008669d0 : CALL 0x00633e6b
008669d5 : MOV ESP,EBP
008669d7 : POP EBP
008669d8 : RET 0x14
