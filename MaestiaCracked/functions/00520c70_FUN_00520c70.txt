PROGRAM  : Maestia.exe
FUNCTION : FUN_00520c70
ENTRY    : 00520c70
BODY     : [[00520c70, 00520d39]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00520c70(int *param_1,int param_2)

{
  int *piVar1;
  int iVar2;
  LONG LVar3;
  int in_ECX;
  uint uVar4;
  
  iVar2 = *param_1;
  piVar1 = (int *)(iVar2 + 8);
  *piVar1 = *piVar1 + 1;
  piVar1 = (int *)(*(int *)(in_ECX + 8) + 8);
  *piVar1 = *piVar1 + -1;
  if (*piVar1 == 0) {
    FUN_00525340();
  }
  *(int *)(in_ECX + 8) = iVar2;
  FUN_0051b6e0();
  if (param_2 != 0) {
    FUN_0051fc70(&param_1);
    FUN_0051b950(&DAT_00b8ab70,0xffffffff);
  }
  FUN_0051b950(**(undefined4 **)(in_ECX + 8),0xffffffff);
  iVar2 = FUN_00525450(((uint)param_1 & 0xfffffffc) + 8,
                       *(uint *)((uint)param_1 & 0xfffffffc) & 0x7fffffff);
  *(int *)(iVar2 + 8) = *(int *)(iVar2 + 8) + 2;
  piVar1 = (int *)(*(int *)(in_ECX + 0xc) + 8);
  *piVar1 = *piVar1 + -1;
  if (*piVar1 == 0) {
    FUN_00525340();
  }
  *(int *)(in_ECX + 0xc) = iVar2;
  piVar1 = (int *)(iVar2 + 8);
  *piVar1 = *piVar1 + -1;
  if (*piVar1 == 0) {
    FUN_00525340();
  }
  uVar4 = (uint)param_1 & 0xfffffffc;
  LVar3 = InterlockedExchangeAdd((LONG *)(uVar4 + 4),-1);
  if (LVar3 == 1) {
    FUN_00515cf0(uVar4);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00520c70 : PUSH EBX
00520c71 : MOV EBX,dword ptr [ESP + 0x8]
00520c75 : PUSH ESI
00520c76 : MOV ESI,dword ptr [EBX]
00520c78 : INC dword ptr [ESI + 0x8]
00520c7b : PUSH EDI
00520c7c : MOV EDI,ECX
00520c7e : MOV ECX,dword ptr [EDI + 0x8]
00520c81 : ADD dword ptr [ECX + 0x8],-0x1
00520c85 : JNZ 0x00520c8c
00520c87 : CALL 0x00525340
00520c8c : LEA ECX,[ESP + 0x10]
00520c90 : MOV dword ptr [EDI + 0x8],ESI
00520c93 : CALL 0x0051b6e0
00520c98 : MOV ECX,dword ptr [ESP + 0x14]
00520c9c : TEST ECX,ECX
00520c9e : JZ 0x00520cba
00520ca0 : LEA EAX,[ESP + 0x10]
00520ca4 : PUSH EAX
00520ca5 : CALL 0x0051fc70
00520caa : PUSH -0x1
00520cac : PUSH 0xb8ab70
00520cb1 : LEA ECX,[ESP + 0x18]
00520cb5 : CALL 0x0051b950
00520cba : MOV ECX,dword ptr [EDI + 0x8]
00520cbd : MOV EDX,dword ptr [ECX]
00520cbf : PUSH -0x1
00520cc1 : PUSH EDX
00520cc2 : LEA ECX,[ESP + 0x18]
00520cc6 : CALL 0x0051b950
00520ccb : MOV EAX,dword ptr [EBX]
00520ccd : AND EAX,0xfffffc00
00520cd2 : MOV ECX,dword ptr [EAX]
00520cd4 : MOV EAX,dword ptr [ESP + 0x10]
00520cd8 : MOV EDX,EAX
00520cda : AND EDX,0xfffffffc
00520cdd : MOV EDX,dword ptr [EDX]
00520cdf : AND EDX,0x7fffffff
00520ce5 : AND EAX,0xfffffffc
00520ce8 : PUSH EDX
00520ce9 : ADD EAX,0x8
00520cec : PUSH EAX
00520ced : CALL 0x00525450
00520cf2 : MOV ESI,EAX
00520cf4 : ADD dword ptr [ESI + 0x8],0x2
00520cf8 : MOV ECX,dword ptr [EDI + 0xc]
00520cfb : ADD dword ptr [ECX + 0x8],-0x1
00520cff : JNZ 0x00520d06
00520d01 : CALL 0x00525340
00520d06 : MOV dword ptr [EDI + 0xc],ESI
00520d09 : ADD dword ptr [ESI + 0x8],-0x1
00520d0d : JNZ 0x00520d16
00520d0f : MOV ECX,ESI
00520d11 : CALL 0x00525340
00520d16 : MOV ESI,dword ptr [ESP + 0x10]
00520d1a : AND ESI,0xfffffffc
00520d1d : PUSH -0x1
00520d1f : LEA EAX,[ESI + 0x4]
00520d22 : PUSH EAX
00520d23 : CALL dword ptr [0x00b851cc]
00520d29 : SUB EAX,0x1
00520d2c : JNZ 0x00520d34
00520d2e : PUSH ESI
00520d2f : CALL 0x00515cf0
00520d34 : POP EDI
00520d35 : POP ESI
00520d36 : POP EBX
00520d37 : RET 0x8
