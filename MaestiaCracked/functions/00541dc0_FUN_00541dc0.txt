PROGRAM  : Maestia.exe
FUNCTION : FUN_00541dc0
ENTRY    : 00541dc0
BODY     : [[00541dc0, 00541ecb]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00541dc0(void)

{
  int *piVar1;
  uint uVar2;
  undefined4 uVar3;
  undefined4 *puVar4;
  int in_ECX;
  uint local_8;
  
  uVar2 = *(uint *)(in_ECX + 0x10);
  local_8 = 0;
  if (uVar2 != 0) {
    do {
      if (*(int *)(in_ECX + 8) == 0) {
        uVar3 = FUN_00515dd0(in_ECX);
        puVar4 = (undefined4 *)FUN_00515840(0x50,0);
        if (puVar4 == (undefined4 *)0x0) {
          puVar4 = (undefined4 *)0x0;
        }
        else {
          *puVar4 = &PTR_FUN_00cd3f2c;
          puVar4[1] = 1;
          *puVar4 = &PTR_FUN_00b8670c;
          puVar4[2] = 0;
          puVar4[3] = 0;
          puVar4[6] = 1;
          puVar4[4] = 100;
          puVar4[5] = 100;
          puVar4[7] = uVar3;
          FUN_00504200(uVar3);
          *(undefined1 *)(puVar4 + 0x13) = 0;
        }
        if (*(GRefCountNTSImpl **)(in_ECX + 8) != (GRefCountNTSImpl *)0x0) {
          GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(in_ECX + 8));
        }
        *(undefined4 **)(in_ECX + 8) = puVar4;
      }
      puVar4 = *(undefined4 **)(*(int *)(in_ECX + 0xc) + local_8 * 4);
      FUN_00515cf0(*puVar4);
      local_8 = local_8 + 1;
      *puVar4 = 0;
      puVar4[2] = 0;
      puVar4[1] = 0;
    } while (local_8 < uVar2);
  }
  piVar1 = (int *)(in_ECX + 0xc);
  if (*(int *)(in_ECX + 0x10) == 0) {
    if (*(int *)(in_ECX + 0x14) == 0) {
      FUN_005b5ef0(piVar1,0);
    }
  }
  else {
    FUN_00540230(*piVar1,*(int *)(in_ECX + 0x10));
    if ((*(uint *)(in_ECX + 0x14) & 0xfffffffe) != 0) {
      if (*piVar1 != 0) {
        FUN_00515cf0(*piVar1);
        *piVar1 = 0;
      }
      *(undefined4 *)(in_ECX + 0x14) = 0;
      *(undefined4 *)(in_ECX + 0x10) = 0;
      *(byte *)(in_ECX + 0x20) = *(byte *)(in_ECX + 0x20) & 0xfe;
      return;
    }
  }
  *(undefined4 *)(in_ECX + 0x10) = 0;
  *(byte *)(in_ECX + 0x20) = *(byte *)(in_ECX + 0x20) & 0xfe;
  return;
}



============================================================
DISASSEMBLY
============================================================
00541dc0 : SUB ESP,0x8
00541dc3 : PUSH EBX
00541dc4 : PUSH EBP
00541dc5 : PUSH ESI
00541dc6 : MOV EBP,ECX
00541dc8 : MOV EAX,dword ptr [EBP + 0x10]
00541dcb : PUSH EDI
00541dcc : XOR EBX,EBX
00541dce : XOR EDI,EDI
00541dd0 : MOV dword ptr [ESP + 0x10],EDI
00541dd4 : MOV dword ptr [ESP + 0x14],EAX
00541dd8 : CMP EAX,EBX
00541dda : JBE 0x00541e70
00541de0 : CMP dword ptr [EBP + 0x8],EBX
00541de3 : JNZ 0x00541e4b
00541de5 : PUSH EBP
00541de6 : CALL 0x00515dd0
00541deb : MOV EDI,EAX
00541ded : PUSH EBX
00541dee : PUSH 0x50
00541df0 : MOV ECX,EDI
00541df2 : CALL 0x00515840
00541df7 : MOV ESI,EAX
00541df9 : CMP ESI,EBX
00541dfb : JZ 0x00541e36
00541dfd : MOV dword ptr [ESI],0xcd3f2c
00541e03 : MOV ECX,0x1
00541e08 : MOV dword ptr [ESI + 0x4],ECX
00541e0b : MOV dword ptr [ESI],0xb8670c
00541e11 : MOV dword ptr [ESI + 0x8],EBX
00541e14 : MOV dword ptr [ESI + 0xc],EBX
00541e17 : MOV EAX,0x64
00541e1c : MOV dword ptr [ESI + 0x18],ECX
00541e1f : PUSH EDI
00541e20 : LEA ECX,[ESI + 0x20]
00541e23 : MOV dword ptr [ESI + 0x10],EAX
00541e26 : MOV dword ptr [ESI + 0x14],EAX
00541e29 : MOV dword ptr [ESI + 0x1c],EDI
00541e2c : CALL 0x00504200
00541e31 : MOV byte ptr [ESI + 0x4c],BL
00541e34 : JMP 0x00541e38
00541e36 : XOR ESI,ESI
00541e38 : MOV ECX,dword ptr [EBP + 0x8]
00541e3b : CMP ECX,EBX
00541e3d : JZ 0x00541e44
00541e3f : CALL 0x004ff7c0
00541e44 : MOV EDI,dword ptr [ESP + 0x10]
00541e48 : MOV dword ptr [EBP + 0x8],ESI
00541e4b : MOV EAX,dword ptr [EBP + 0xc]
00541e4e : MOV ESI,dword ptr [EAX + EDI*0x4]
00541e51 : MOV ECX,dword ptr [ESI]
00541e53 : PUSH ECX
00541e54 : CALL 0x00515cf0
00541e59 : INC EDI
00541e5a : MOV dword ptr [ESI],EBX
00541e5c : MOV dword ptr [ESI + 0x8],EBX
00541e5f : MOV dword ptr [ESI + 0x4],EBX
00541e62 : MOV dword ptr [ESP + 0x10],EDI
00541e66 : CMP EDI,dword ptr [ESP + 0x14]
00541e6a : JC 0x00541de0
00541e70 : MOV EAX,dword ptr [EBP + 0x10]
00541e73 : LEA ESI,[EBP + 0xc]
00541e76 : CMP EAX,EBX
00541e78 : JBE 0x00541eaf
00541e7a : MOV EDX,dword ptr [ESI]
00541e7c : PUSH EAX
00541e7d : PUSH EDX
00541e7e : CALL 0x00540230
00541e83 : ADD ESP,0x8
00541e86 : TEST dword ptr [ESI + 0x8],0xfffffffe
00541e8d : JBE 0x00541ebd
00541e8f : MOV EAX,dword ptr [ESI]
00541e91 : CMP EAX,EBX
00541e93 : JZ 0x00541e9d
00541e95 : PUSH EAX
00541e96 : CALL 0x00515cf0
00541e9b : MOV dword ptr [ESI],EBX
00541e9d : POP EDI
00541e9e : MOV dword ptr [ESI + 0x8],EBX
00541ea1 : MOV dword ptr [ESI + 0x4],EBX
00541ea4 : AND byte ptr [EBP + 0x20],0xfe
00541ea8 : POP ESI
00541ea9 : POP EBP
00541eaa : POP EBX
00541eab : ADD ESP,0x8
00541eae : RET
00541eaf : CMP dword ptr [ESI + 0x8],EBX
00541eb2 : JA 0x00541ebd
00541eb4 : PUSH EBX
00541eb5 : PUSH ESI
00541eb6 : MOV ECX,ESI
00541eb8 : CALL 0x005b5ef0
00541ebd : POP EDI
00541ebe : MOV dword ptr [ESI + 0x4],EBX
00541ec1 : AND byte ptr [EBP + 0x20],0xfe
00541ec5 : POP ESI
00541ec6 : POP EBP
00541ec7 : POP EBX
00541ec8 : ADD ESP,0x8
00541ecb : RET
