PROGRAM  : Maestia.exe
FUNCTION : FUN_007ae960
ENTRY    : 007ae960
BODY     : [[007ae960, 007aebcb]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_007ae960(int param_1,int *param_2,undefined1 *param_3,int *param_4)

{
  LPCRITICAL_SECTION lpCriticalSection;
  int iVar1;
  char cVar2;
  int iVar3;
  int iVar4;
  int unaff_EDI;
  int *local_4c;
  int *local_48;
  undefined1 **local_44;
  undefined4 *local_2c;
  undefined1 *local_28 [2];
  int local_20;
  undefined1 local_1c [4];
  LPCRITICAL_SECTION local_18;
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b3c553;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  if ((*(char *)(param_1 + 700) != '\0') && (*(char *)(param_1 + 0x2bd) != '\0')) {
    lpCriticalSection = (LPCRITICAL_SECTION)(param_1 + 0x2470);
    local_44 = (undefined1 **)0x7ae9ac;
    local_18 = lpCriticalSection;
    EnterCriticalSection(lpCriticalSection);
    local_8 = 0;
    iVar1 = *(int *)(param_1 + 0x378);
    local_44 = (undefined1 **)0x0;
    local_48 = &local_14;
    local_14 = 0;
    local_4c = (int *)&local_2c;
    local_2c = param_2;
    local_28[0] = param_3;
    cVar2 = FUN_007ac0b0();
    if (cVar2 != '\0') {
      local_44 = local_28;
      local_48 = (int *)local_1c;
      local_4c = &local_20;
      FUN_007deaf0();
      local_20 = FUN_0045ea30();
      iVar4 = 0;
      if (local_20 == 0) {
        local_44 = (undefined1 **)0x7aea63;
        FUN_008018d0();
        local_8 = 0xffffffff;
        local_44 = (undefined1 **)0x7aea77;
        LeaveCriticalSection(local_18);
        ExceptionList = local_10;
        return 0;
      }
      *(int *)(*(int *)(unaff_EDI + 4) + 5) = local_14;
      **(undefined2 **)(unaff_EDI + 4) = **(undefined2 **)(local_20 + 8);
      *(undefined1 *)(*(int *)(unaff_EDI + 4) + 4) = *(undefined1 *)(*(int *)(local_20 + 8) + 2);
      *(undefined2 *)(*(int *)(unaff_EDI + 4) + 2) = *(undefined2 *)(*(int *)(local_20 + 8) + 5);
      *param_4 = *param_4 + 1;
      local_28[0] = (undefined1 *)&local_4c;
      local_4c = param_2;
      local_48 = (int *)0x461c4000;
      local_44 = (undefined1 **)param_3;
      local_14 = 0;
      FUN_007ae8a0(iVar1,&local_14);
      iVar3 = 0;
      if (0 < local_14) {
        do {
          *(undefined4 *)(iVar4 + 0xe + *(int *)(unaff_EDI + 4)) =
               *(undefined4 *)(*(int *)(iVar1 + iVar3 * 4) + 0x20);
          *(short *)(iVar4 + *(int *)(unaff_EDI + 4) + 9) =
               (short)(int)(*(float *)(iVar4 + 0xe + *(int *)(unaff_EDI + 4)) + 32767.0);
          *(undefined1 *)(iVar4 + 0xd + *(int *)(unaff_EDI + 4)) =
               *(undefined1 *)(*(int *)(local_20 + 8) + 2);
          *(undefined2 *)(iVar4 + 0xb + *(int *)(unaff_EDI + 4)) =
               *(undefined2 *)(*(int *)(local_20 + 8) + 5);
          if (*(float *)(*(int *)(iVar1 + iVar3 * 4) + 0x20) <
              *(float *)(iVar4 + 5 + *(int *)(unaff_EDI + 4))) {
            FUN_00476d40();
          }
          *param_4 = *param_4 + 1;
          iVar3 = iVar3 + 1;
          iVar4 = iVar4 + 9;
        } while (iVar3 < local_14);
      }
      local_8 = 0xffffffff;
      local_44 = (undefined1 **)0x7aebb7;
      LeaveCriticalSection(local_18);
      ExceptionList = local_10;
      return 1;
    }
    local_8 = 0xffffffff;
    local_44 = (undefined1 **)0x7ae9fc;
    LeaveCriticalSection(lpCriticalSection);
  }
  ExceptionList = local_10;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
007ae960 : PUSH EBP
007ae961 : MOV EBP,ESP
007ae963 : PUSH -0x1
007ae965 : PUSH 0xb3c553
007ae96a : MOV EAX,FS:[0x0]
007ae970 : PUSH EAX
007ae971 : SUB ESP,0x20
007ae974 : PUSH EBX
007ae975 : PUSH ESI
007ae976 : MOV EAX,[0x00d66fa0]
007ae97b : XOR EAX,EBP
007ae97d : PUSH EAX
007ae97e : LEA EAX,[EBP + -0xc]
007ae981 : MOV FS:[0x0],EAX
007ae987 : MOV EBX,dword ptr [EBP + 0x8]
007ae98a : CMP byte ptr [EBX + 0x2bc],0x0
007ae991 : JZ 0x007ae9fc
007ae993 : CMP byte ptr [EBX + 0x2bd],0x0
007ae99a : JZ 0x007ae9fc
007ae99c : LEA ESI,[EBX + 0x2470]
007ae9a2 : PUSH ESI
007ae9a3 : MOV dword ptr [EBP + -0x14],ESI
007ae9a6 : CALL dword ptr [0x00b85118]
007ae9ac : MOV dword ptr [EBP + -0x4],0x0
007ae9b3 : XORPS XMM0,XMM0
007ae9b6 : MOV EAX,dword ptr [EBX + 0x378]
007ae9bc : PUSH 0x0
007ae9be : PUSH 0x0
007ae9c0 : LEA ECX,[EBP + -0x10]
007ae9c3 : PUSH ECX
007ae9c4 : MOVSS dword ptr [EBP + -0x10],XMM0
007ae9c9 : MOVSS XMM0,dword ptr [EBP + 0xc]
007ae9ce : LEA EDX,[EBP + -0x28]
007ae9d1 : PUSH EDX
007ae9d2 : MOVSS dword ptr [EBP + -0x28],XMM0
007ae9d7 : MOVSS XMM0,dword ptr [EBP + 0x10]
007ae9dc : PUSH EBX
007ae9dd : MOV dword ptr [EBP + 0x8],EAX
007ae9e0 : MOVSS dword ptr [EBP + -0x24],XMM0
007ae9e5 : CALL 0x007ac0b0
007ae9ea : TEST AL,AL
007ae9ec : JNZ 0x007aea11
007ae9ee : MOV dword ptr [EBP + -0x4],0xffffffff
007ae9f5 : PUSH ESI
007ae9f6 : CALL dword ptr [0x00b8511c]
007ae9fc : XOR AL,AL
007ae9fe : MOV ECX,dword ptr [EBP + -0xc]
007aea01 : MOV dword ptr FS:[0x0],ECX
007aea08 : POP ECX
007aea09 : POP ESI
007aea0a : POP EBX
007aea0b : MOV ESP,EBP
007aea0d : POP EBP
007aea0e : RET 0x10
007aea11 : FLD float ptr [EBP + 0x10]
007aea14 : LEA EAX,[EBP + -0x20]
007aea17 : PUSH EAX
007aea18 : LEA ECX,[EBP + -0x24]
007aea1b : PUSH ECX
007aea1c : MOV ECX,dword ptr [EBX + 0x278]
007aea22 : LEA EDX,[EBP + -0x18]
007aea25 : PUSH EDX
007aea26 : LEA EAX,[EBP + -0x1c]
007aea29 : PUSH EAX
007aea2a : SUB ESP,0x8
007aea2d : FSTP float ptr [ESP + 0x4]
007aea31 : FLD float ptr [EBP + 0xc]
007aea34 : FSTP float ptr [ESP]
007aea37 : PUSH ECX
007aea38 : CALL 0x007deaf0
007aea3d : MOV ESI,dword ptr [EBP + -0x18]
007aea40 : MOV EDX,dword ptr [EBP + -0x1c]
007aea43 : MOV ECX,EBX
007aea45 : CALL 0x0045ea30
007aea4a : XOR ESI,ESI
007aea4c : MOV dword ptr [EBP + -0x1c],EAX
007aea4f : CMP EAX,ESI
007aea51 : JNZ 0x007aea8c
007aea53 : MOV ESI,dword ptr [0x00da98e8]
007aea59 : PUSH 0xc182b8
007aea5e : CALL 0x008018d0
007aea63 : ADD ESP,0x4
007aea66 : MOV dword ptr [EBP + -0x4],0xffffffff
007aea6d : MOV EDX,dword ptr [EBP + -0x14]
007aea70 : PUSH EDX
007aea71 : CALL dword ptr [0x00b8511c]
007aea77 : XOR AL,AL
007aea79 : MOV ECX,dword ptr [EBP + -0xc]
007aea7c : MOV dword ptr FS:[0x0],ECX
007aea83 : POP ECX
007aea84 : POP ESI
007aea85 : POP EBX
007aea86 : MOV ESP,EBP
007aea88 : POP EBP
007aea89 : RET 0x10
007aea8c : MOV ECX,dword ptr [EDI + 0x4]
007aea8f : MOVSS XMM0,dword ptr [EBP + -0x10]
007aea94 : MOVSS dword ptr [ECX + 0x5],XMM0
007aea99 : MOV EDX,dword ptr [EAX + 0x8]
007aea9c : MOV DX,word ptr [EDX]
007aea9f : MOV ECX,dword ptr [EDI + 0x4]
007aeaa2 : MOVSS XMM0,dword ptr [EBP + 0xc]
007aeaa7 : MOV word ptr [ECX],DX
007aeaaa : MOV ECX,dword ptr [EAX + 0x8]
007aeaad : MOV CL,byte ptr [ECX + 0x2]
007aeab0 : MOV EDX,dword ptr [EDI + 0x4]
007aeab3 : MOVSS XMM1,dword ptr [0x00cdf0d0]
007aeabb : MOV byte ptr [EDX + 0x4],CL
007aeabe : MOV EDX,dword ptr [EAX + 0x8]
007aeac1 : MOV CX,word ptr [EDX + 0x5]
007aeac5 : MOV EAX,dword ptr [EDI + 0x4]
007aeac8 : MOV word ptr [EAX + 0x2],CX
007aeacc : MOV EAX,dword ptr [EBP + 0x14]
007aeacf : INC dword ptr [EAX]
007aead1 : PUSH ESI
007aead2 : SUB ESP,0xc
007aead5 : MOV EAX,ESP
007aead7 : MOVSS dword ptr [EAX],XMM0
007aeadb : MOVSS XMM0,dword ptr [0x00cdf288]
007aeae3 : MOVSS dword ptr [EAX + 0x4],XMM0
007aeae8 : MOVSS XMM0,dword ptr [EBP + 0x10]
007aeaed : MOVSS dword ptr [EAX + 0x8],XMM0
007aeaf2 : XORPS XMM0,XMM0
007aeaf5 : MOV dword ptr [EBP + -0x24],ESP
007aeaf8 : SUB ESP,0xc
007aeafb : MOV EAX,ESP
007aeafd : MOV dword ptr [EBP + 0xc],ESP
007aeb00 : LEA EDX,[EBP + -0x10]
007aeb03 : MOVSS dword ptr [EAX],XMM0
007aeb07 : MOVSS dword ptr [EAX + 0x4],XMM1
007aeb0c : MOVSS dword ptr [EAX + 0x8],XMM0
007aeb11 : MOV EAX,dword ptr [EBP + 0x8]
007aeb14 : PUSH EDX
007aeb15 : PUSH EAX
007aeb16 : MOV ECX,EBX
007aeb18 : MOV dword ptr [EBP + -0x10],ESI
007aeb1b : CALL 0x007ae8a0
007aeb20 : XOR EBX,EBX
007aeb22 : CMP dword ptr [EBP + -0x10],ESI
007aeb25 : JLE 0x007aeba6
007aeb27 : MOV ECX,dword ptr [EBP + 0x8]
007aeb2a : MOV EDX,dword ptr [ECX + EBX*0x4]
007aeb2d : FLD float ptr [EDX + 0x20]
007aeb30 : MOV EAX,dword ptr [EDI + 0x4]
007aeb33 : FSTP float ptr [ESI + EAX*0x1 + 0xe]
007aeb37 : MOV ECX,dword ptr [EDI + 0x4]
007aeb3a : MOVSS XMM0,dword ptr [ESI + ECX*0x1 + 0xe]
007aeb40 : ADDSS XMM0,dword ptr [0x00cdf18c]
007aeb48 : LEA EAX,[ESI + ECX*0x1]
007aeb4b : CVTTSS2SI EDX,XMM0
007aeb4f : MOV word ptr [EAX + 0x9],DX
007aeb53 : MOV EAX,dword ptr [EBP + -0x1c]
007aeb56 : MOV ECX,dword ptr [EAX + 0x8]
007aeb59 : MOV CL,byte ptr [ECX + 0x2]
007aeb5c : MOV EDX,dword ptr [EDI + 0x4]
007aeb5f : MOV byte ptr [ESI + EDX*0x1 + 0xd],CL
007aeb63 : MOV EDX,dword ptr [EAX + 0x8]
007aeb66 : MOV CX,word ptr [EDX + 0x5]
007aeb6a : MOV EAX,dword ptr [EDI + 0x4]
007aeb6d : MOV EDX,dword ptr [EBP + 0x8]
007aeb70 : MOV word ptr [ESI + EAX*0x1 + 0xb],CX
007aeb75 : MOV EAX,dword ptr [EDX + EBX*0x4]
007aeb78 : MOV ECX,dword ptr [EDI + 0x4]
007aeb7b : MOVSS XMM0,dword ptr [EAX + 0x20]
007aeb80 : MOVSS XMM1,dword ptr [ESI + ECX*0x1 + 0x5]
007aeb86 : COMISS XMM1,XMM0
007aeb89 : JBE 0x007aeb98
007aeb8b : MOV EDX,ECX
007aeb8d : LEA ECX,[ESI + EDX*0x1]
007aeb90 : LEA EAX,[ECX + 0x9]
007aeb93 : CALL 0x00476d40
007aeb98 : MOV EAX,dword ptr [EBP + 0x14]
007aeb9b : INC dword ptr [EAX]
007aeb9d : INC EBX
007aeb9e : ADD ESI,0x9
007aeba1 : CMP EBX,dword ptr [EBP + -0x10]
007aeba4 : JL 0x007aeb27
007aeba6 : MOV dword ptr [EBP + -0x4],0xffffffff
007aebad : MOV EAX,dword ptr [EBP + -0x14]
007aebb0 : PUSH EAX
007aebb1 : CALL dword ptr [0x00b8511c]
007aebb7 : MOV AL,0x1
007aebb9 : MOV ECX,dword ptr [EBP + -0xc]
007aebbc : MOV dword ptr FS:[0x0],ECX
007aebc3 : POP ECX
007aebc4 : POP ESI
007aebc5 : POP EBX
007aebc6 : MOV ESP,EBP
007aebc8 : POP EBP
007aebc9 : RET 0x10
