PROGRAM  : Maestia.exe
FUNCTION : FUN_00a29110
ENTRY    : 00a29110
BODY     : [[00a29110, 00a29330]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a29110(int param_1)

{
  uint8_t uVar1;
  int iVar2;
  int *piVar3;
  undefined4 uVar4;
  uint8_t *packet;
  byte bVar5;
  undefined1 local_30 [28];
  uint8_t *local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  piVar3 = DAT_00da9894;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b3af61;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  iVar2 = *(int *)(param_1 + 0xac);
  if (iVar2 != 0) {
    if ((*(int *)(iVar2 + 0x18a8) == 0) || (*(char *)(*(int *)(iVar2 + 0x18a8) + 0x20) == '\0')) {
      if (*(char *)(iVar2 + 0x1fe4) == '\0') {
        uVar4 = FUN_00702b00(DAT_00d66fa0 ^ (uint)&stack0xfffffffc);
        iVar2 = *(int *)ThreadLocalStoragePointer;
        bVar5 = (byte)((ulonglong)(*(byte *)(iVar2 + 0x18) + 1) % 3);
        *(byte *)(iVar2 + 0x18) = bVar5;
        local_14 = (uint8_t *)((uint)bVar5 * 0x2000 + 0x122cb8 + iVar2);
        if (local_14 == (uint8_t *)0x0) {
          packet = (uint8_t *)0x0;
        }
        else {
          uVar1 = *(uint8_t *)(*(int *)(*piVar3 + 0x23c) + 0x38);
          local_14[0] = '\0';
          local_14[1] = '\0';
          local_14[2] = '@';
          local_14[3] = '\x01';
          *(undefined4 *)(local_14 + 4) = uVar4;
          local_14[8] = '\x01';
          local_14[9] = 0xff;
          local_14[10] = 0xff;
          local_14[0xb] = 0xff;
          local_14[0xc] = 0xff;
          local_14[0xd] = uVar1;
          packet = local_14;
        }
        local_8 = 0xffffffff;
        if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
          FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),0xe,packet);
        }
      }
      else if (((DAT_0172491c != 0) && (*DAT_00da9894 != 0)) &&
              (*(int *)(*DAT_00da9894 + 0x1a8) != 0)) {
        FUN_00406460(L"IDS_ERROR_ITEM_REGEN_INVALID_STATUS");
        local_8 = 2;
        piVar3 = *(int **)(*DAT_00da9894 + 0x1a8);
        uVar4 = FUN_0081d120(local_30);
        local_8._0_1_ = 3;
        (**(code **)(*piVar3 + 0x44))(uVar4,3);
        local_8 = CONCAT31(local_8._1_3_,2);
        goto LAB_00a2924b;
      }
    }
    else if (((DAT_0172491c != 0) && (*DAT_00da9894 != 0)) && (*(int *)(*DAT_00da9894 + 0x1a8) != 0)
            ) {
      FUN_00406460(L"IDS_CHARACTER_CANT_MOTION_BY_RIDEING");
      local_8 = 0;
      piVar3 = *(int **)(*DAT_00da9894 + 0x1a8);
      uVar4 = FUN_0081d120(local_30);
      local_8._0_1_ = 1;
      (**(code **)(*piVar3 + 0x44))(uVar4,3);
      local_8 = (uint)local_8._1_3_ << 8;
LAB_00a2924b:
      FUN_00406560();
      local_8 = 0xffffffff;
      FUN_00406560();
      ExceptionList = local_10;
      return;
    }
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00a29110 : PUSH EBP
00a29111 : MOV EBP,ESP
00a29113 : PUSH -0x1
00a29115 : PUSH 0xb3af61
00a2911a : MOV EAX,FS:[0x0]
00a29120 : PUSH EAX
00a29121 : SUB ESP,0x3c
00a29124 : PUSH ESI
00a29125 : PUSH EDI
00a29126 : MOV EAX,[0x00d66fa0]
00a2912b : XOR EAX,EBP
00a2912d : PUSH EAX
00a2912e : LEA EAX,[EBP + -0xc]
00a29131 : MOV FS:[0x0],EAX
00a29137 : MOV EAX,dword ptr [EBP + 0x8]
00a2913a : MOV EAX,dword ptr [EAX + 0xac]
00a29140 : TEST EAX,EAX
00a29142 : JZ 0x00a2931e
00a29148 : MOV ECX,dword ptr [EAX + 0x18a8]
00a2914e : TEST ECX,ECX
00a29150 : JZ 0x00a291cc
00a29152 : CMP byte ptr [ECX + 0x20],0x0
00a29156 : JZ 0x00a291cc
00a29158 : CMP dword ptr [0x0172491c],0x0
00a2915f : JZ 0x00a2931e
00a29165 : MOV ECX,dword ptr [0x00da9894]
00a2916b : MOV EAX,dword ptr [ECX]
00a2916d : TEST EAX,EAX
00a2916f : JZ 0x00a2931e
00a29175 : CMP dword ptr [EAX + 0x1a8],0x0
00a2917c : JZ 0x00a2931e
00a29182 : PUSH 0xcc5568
00a29187 : LEA ECX,[EBP + -0x2c]
00a2918a : CALL 0x00406460
00a2918f : MOV dword ptr [EBP + -0x4],0x0
00a29196 : MOV EDX,dword ptr [0x00da9894]
00a2919c : MOV EAX,dword ptr [EDX]
00a2919e : MOV ESI,dword ptr [EAX + 0x1a8]
00a291a4 : MOV ECX,dword ptr [0x0172491c]
00a291aa : LEA EAX,[EBP + -0x2c]
00a291ad : PUSH EAX
00a291ae : LEA EDI,[EBP + -0x48]
00a291b1 : CALL 0x0081d120
00a291b6 : MOV byte ptr [EBP + -0x4],0x1
00a291ba : MOV EDX,dword ptr [ESI]
00a291bc : PUSH 0x3
00a291be : PUSH EAX
00a291bf : MOV EAX,dword ptr [EDX + 0x44]
00a291c2 : MOV ECX,ESI
00a291c4 : CALL EAX
00a291c6 : MOV byte ptr [EBP + -0x4],0x0
00a291ca : JMP 0x00a2924b
00a291cc : CMP byte ptr [EAX + 0x1fe4],0x0
00a291d3 : JZ 0x00a29275
00a291d9 : CMP dword ptr [0x0172491c],0x0
00a291e0 : JZ 0x00a2931e
00a291e6 : MOV ECX,dword ptr [0x00da9894]
00a291ec : MOV EAX,dword ptr [ECX]
00a291ee : TEST EAX,EAX
00a291f0 : JZ 0x00a2931e
00a291f6 : CMP dword ptr [EAX + 0x1a8],0x0
00a291fd : JZ 0x00a2931e
00a29203 : PUSH 0xcc55b8
00a29208 : LEA ECX,[EBP + -0x2c]
00a2920b : CALL 0x00406460
00a29210 : MOV dword ptr [EBP + -0x4],0x2
00a29217 : MOV EDX,dword ptr [0x00da9894]
00a2921d : MOV EAX,dword ptr [EDX]
00a2921f : MOV ESI,dword ptr [EAX + 0x1a8]
00a29225 : MOV ECX,dword ptr [0x0172491c]
00a2922b : LEA EAX,[EBP + -0x2c]
00a2922e : PUSH EAX
00a2922f : LEA EDI,[EBP + -0x48]
00a29232 : CALL 0x0081d120
00a29237 : MOV byte ptr [EBP + -0x4],0x3
00a2923b : MOV EDX,dword ptr [ESI]
00a2923d : PUSH 0x3
00a2923f : PUSH EAX
00a29240 : MOV EAX,dword ptr [EDX + 0x44]
00a29243 : MOV ECX,ESI
00a29245 : CALL EAX
00a29247 : MOV byte ptr [EBP + -0x4],0x2
00a2924b : LEA ECX,[EBP + -0x48]
00a2924e : CALL 0x00406560
00a29253 : MOV dword ptr [EBP + -0x4],0xffffffff
00a2925a : LEA ECX,[EBP + -0x2c]
00a2925d : CALL 0x00406560
00a29262 : MOV ECX,dword ptr [EBP + -0xc]
00a29265 : MOV dword ptr FS:[0x0],ECX
00a2926c : POP ECX
00a2926d : POP EDI
00a2926e : POP ESI
00a2926f : MOV ESP,EBP
00a29271 : POP EBP
00a29272 : RET 0x4
00a29275 : MOV ESI,dword ptr [0x00da9894]
00a2927b : MOV EAX,dword ptr [ESI]
00a2927d : MOV EAX,dword ptr [EAX + 0x23c]
00a29283 : CMP byte ptr [EAX + 0x38],0x0
00a29287 : MOV EAX,0x8
00a2928c : JNZ 0x00a29293
00a2928e : MOV EAX,0x800
00a29293 : CALL 0x00702b00
00a29298 : MOV ECX,dword ptr FS:[0x2c]
00a2929f : MOV ECX,dword ptr [ECX]
00a292a1 : MOV dword ptr [EBP + 0x8],EAX
00a292a4 : MOVZX EAX,byte ptr [ECX + 0x18]
00a292a8 : INC EAX
00a292a9 : CDQ
00a292aa : MOV EDI,0x3
00a292af : IDIV EDI
00a292b1 : MOV byte ptr [ECX + 0x18],DL
00a292b4 : MOVZX EDX,DL
00a292b7 : SHL EDX,0xd
00a292ba : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
00a292c1 : MOV dword ptr [EBP + -0x10],EAX
00a292c4 : MOV dword ptr [EBP + -0x4],0x4
00a292cb : OR EDX,0xffffffff
00a292ce : TEST EAX,EAX
00a292d0 : JZ 0x00a292fc
00a292d2 : MOV ECX,dword ptr [ESI]
00a292d4 : MOV ECX,dword ptr [ECX + 0x23c]
00a292da : MOV CL,byte ptr [ECX + 0x38]
00a292dd : XOR ESI,ESI
00a292df : MOV word ptr [EAX],SI
00a292e2 : MOV ESI,dword ptr [EBP + 0x8]
00a292e5 : MOV byte ptr [EAX + 0x2],0x40
00a292e9 : MOV byte ptr [EAX + 0x3],0x1
00a292ed : MOV dword ptr [EAX + 0x4],ESI
00a292f0 : MOV byte ptr [EAX + 0x8],0x1
00a292f4 : MOV dword ptr [EAX + 0x9],EDX
00a292f7 : MOV byte ptr [EAX + 0xd],CL
00a292fa : JMP 0x00a292fe
00a292fc : XOR EAX,EAX
00a292fe : MOV dword ptr [EBP + -0x4],EDX
00a29301 : MOV EDX,dword ptr [0x017247d4]
00a29307 : MOV ECX,dword ptr [EDX + 0x4]
00a2930a : TEST ECX,ECX
00a2930c : JZ 0x00a2931e
00a2930e : CMP byte ptr [EDX + 0x8],0x0
00a29312 : JZ 0x00a2931e
00a29314 : PUSH 0xe
00a29316 : PUSH ECX
00a29317 : MOV EDI,EAX
00a29319 : CALL 0x00a0dd40
00a2931e : MOV ECX,dword ptr [EBP + -0xc]
00a29321 : MOV dword ptr FS:[0x0],ECX
00a29328 : POP ECX
00a29329 : POP EDI
00a2932a : POP ESI
00a2932b : MOV ESP,EBP
00a2932d : POP EBP
00a2932e : RET 0x4
