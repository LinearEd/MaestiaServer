PROGRAM  : Maestia.exe
FUNCTION : FUN_006aa390
ENTRY    : 006aa390
BODY     : [[006aa390, 006aa6e0]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006aa390(uint *param_1,int param_2,uint param_3,int param_4,int param_5)

{
  byte bVar1;
  short sVar2;
  uint *puVar3;
  uint uVar4;
  uint uVar5;
  uint uVar6;
  uint uVar7;
  int iVar8;
  int iVar9;
  byte *pbVar10;
  short *psVar11;
  uint in_EDX;
  uint *puVar12;
  uint *puVar13;
  int local_8;
  uint local_4;
  
  local_8 = 0;
  if (*(int *)(param_2 + 8) == 0) {
    return 3;
  }
  puVar3 = param_1 + 0x83;
  iVar9 = 0x100;
  do {
    *(undefined2 *)(puVar3 + -0x80) = 0;
    *(undefined2 *)puVar3 = 0;
    puVar3 = (uint *)((int)puVar3 + 2);
    iVar9 = iVar9 + -1;
  } while (iVar9 != 0);
  if (in_EDX < 2) {
    if (in_EDX == 0) {
      puVar3 = &DAT_00beac28;
    }
    else {
      if (in_EDX != 1) {
        return 3;
      }
      puVar3 = &DAT_00beae28;
    }
    puVar12 = param_1 + 3;
    puVar13 = puVar12;
    for (iVar9 = 0x80; iVar9 != 0; iVar9 = iVar9 + -1) {
      *puVar13 = *puVar3;
      puVar3 = puVar3 + 1;
      puVar13 = puVar13 + 1;
    }
    param_1[2] = 0;
    local_8 = FUN_006a9fd0(*(undefined4 *)(param_4 + 0x1c));
    if (local_8 == 0) {
      iVar9 = 0x100;
      uVar4 = 0;
      do {
        uVar4 = uVar4 + 1;
        if (((short)*puVar12 == 0) || (iVar8 = FUN_006aa050(), iVar8 == 0)) {
          *(undefined2 *)(puVar12 + 0x80) = 0;
          *(undefined2 *)puVar12 = 0;
        }
        else {
          *(short *)(puVar12 + 0x80) = (short)iVar8;
          if (param_1[2] < uVar4) {
            param_1[2] = uVar4;
          }
        }
        puVar12 = (uint *)((int)puVar12 + 2);
        iVar9 = iVar9 + -1;
      } while (iVar9 != 0);
    }
  }
  else {
    param_1[1] = param_5 + in_EDX;
    local_8 = FUN_006877c0(param_4,param_5 + in_EDX);
    if (local_8 == 0) {
      uVar4 = FUN_00687a20(param_4,&local_8);
      *param_1 = uVar4 & 0xff;
      if (local_8 == 0) {
        uVar4 = FUN_00687a20(param_4,&local_8);
        uVar4 = uVar4 & 0xff;
        if (local_8 == 0) {
          if ((*param_1 & 0x7f) == 0) {
            param_1[2] = uVar4 + 1;
            local_8 = FUN_00688900(param_4,uVar4);
            if (local_8 != 0) {
              return local_8;
            }
            pbVar10 = *(byte **)(param_4 + 0x20);
            uVar7 = 1;
            if (uVar4 != 0) {
              do {
                bVar1 = *pbVar10;
                pbVar10 = pbVar10 + 1;
                if (uVar7 < param_3) {
                  *(short *)((int)param_1 + (uint)bVar1 * 2 + 0x20c) = (short)uVar7;
                  *(undefined2 *)((int)param_1 + (uint)bVar1 * 2 + 0xc) =
                       *(undefined2 *)(*(int *)(param_2 + 8) + uVar7 * 2);
                }
                uVar7 = uVar7 + 1;
              } while (uVar7 <= uVar4);
            }
            FUN_006889b0(param_4);
          }
          else {
            if ((*param_1 & 0x7f) != 1) {
              return 3;
            }
            param_1[2] = 0;
            local_4 = 0;
            uVar7 = 1;
            uVar5 = 0;
            if (uVar4 != 0) {
              do {
                uVar5 = FUN_00687a20(param_4,&local_8);
                if (local_8 != 0) {
                  return local_8;
                }
                uVar6 = FUN_00687a20(param_4,&local_8);
                if (local_8 != 0) {
                  return local_8;
                }
                uVar6 = (uVar6 & 0xff) + 1;
                if (param_1[2] < uVar6) {
                  param_1[2] = uVar6;
                }
                uVar6 = uVar6 + uVar7;
                if (uVar7 < uVar6) {
                  pbVar10 = (byte *)((int)param_1 + (uVar5 & 0xff) * 2 + 0xc);
                  iVar9 = (uVar5 & 0xff) - uVar7;
                  do {
                    if ((uVar7 < param_3) && (iVar9 + uVar7 < 0x100)) {
                      *(short *)(pbVar10 + 0x200) = (short)uVar7;
                      *(undefined2 *)pbVar10 = *(undefined2 *)(*(int *)(param_2 + 8) + uVar7 * 2);
                    }
                    uVar7 = uVar7 + 1;
                    pbVar10 = pbVar10 + 2;
                  } while (uVar7 < uVar6);
                }
                local_4 = local_4 + 1;
                uVar7 = uVar6;
                uVar5 = local_4;
              } while (local_4 < uVar4);
            }
            local_4 = uVar5;
            if (0x100 < param_1[2]) {
              param_1[2] = 0x100;
            }
          }
          if ((*param_1 & 0x80) != 0) {
            local_4 = FUN_00687a20(param_4,&local_8);
            local_4 = local_4 & 0xff;
            if ((local_8 == 0) && (uVar4 = 0, local_4 != 0)) {
              while( true ) {
                uVar7 = FUN_00687a20(param_4,&local_8);
                if ((local_8 != 0) || (sVar2 = FUN_00687a80(param_4,&local_8), local_8 != 0)) break;
                uVar5 = 0;
                *(short *)((int)param_1 + (uVar7 & 0xff) * 2 + 0xc) = sVar2;
                if (param_3 != 0) {
                  psVar11 = *(short **)(param_2 + 8);
                  do {
                    if (*psVar11 == sVar2) {
                      *(short *)((int)param_1 + (uVar7 & 0xff) * 2 + 0x20c) = (short)uVar5;
                      break;
                    }
                    uVar5 = uVar5 + 1;
                    psVar11 = psVar11 + 1;
                  } while (uVar5 < param_3);
                }
                uVar4 = uVar4 + 1;
                if (local_4 <= uVar4) {
                  return 0;
                }
              }
            }
          }
        }
      }
    }
  }
  return local_8;
}



============================================================
DISASSEMBLY
============================================================
006aa390 : SUB ESP,0x8
006aa393 : MOV EAX,dword ptr [ESP + 0x10]
006aa397 : CMP dword ptr [EAX + 0x8],0x0
006aa39b : MOV dword ptr [ESP],0x0
006aa3a2 : JNZ 0x006aa3b2
006aa3a4 : MOV dword ptr [ESP],0x3
006aa3ab : MOV EAX,dword ptr [ESP]
006aa3ae : ADD ESP,0x8
006aa3b1 : RET
006aa3b2 : PUSH EBX
006aa3b3 : MOV EBX,dword ptr [ESP + 0x10]
006aa3b7 : LEA EAX,[EBX + 0x20c]
006aa3bd : MOV ECX,0x100
006aa3c2 : PUSH ESI
006aa3c3 : XOR ESI,ESI
006aa3c5 : MOV word ptr [EAX + 0xfffffe00],SI
006aa3cc : MOV word ptr [EAX],SI
006aa3cf : ADD EAX,0x2
006aa3d2 : SUB ECX,0x1
006aa3d5 : JNZ 0x006aa3c3
006aa3d7 : PUSH EBP
006aa3d8 : PUSH EDI
006aa3d9 : CMP EDX,0x1
006aa3dc : JBE 0x006aa62c
006aa3e2 : MOV ECX,dword ptr [ESP + 0x2c]
006aa3e6 : MOV EDI,dword ptr [ESP + 0x28]
006aa3ea : LEA EAX,[ECX + EDX*0x1]
006aa3ed : PUSH EAX
006aa3ee : PUSH EDI
006aa3ef : MOV dword ptr [EBX + 0x4],EAX
006aa3f2 : CALL 0x006877c0
006aa3f7 : ADD ESP,0x8
006aa3fa : MOV dword ptr [ESP + 0x10],EAX
006aa3fe : TEST EAX,EAX
006aa400 : JNZ 0x006aa6d5
006aa406 : LEA EDX,[ESP + 0x10]
006aa40a : PUSH EDX
006aa40b : PUSH EDI
006aa40c : CALL 0x00687a20
006aa411 : MOVZX EAX,AL
006aa414 : ADD ESP,0x8
006aa417 : MOV dword ptr [EBX],EAX
006aa419 : CMP dword ptr [ESP + 0x10],ESI
006aa41d : JNZ 0x006aa6d5
006aa423 : LEA ECX,[ESP + 0x10]
006aa427 : PUSH ECX
006aa428 : PUSH EDI
006aa429 : CALL 0x00687a20
006aa42e : ADD ESP,0x8
006aa431 : MOVZX EBP,AL
006aa434 : CMP dword ptr [ESP + 0x10],ESI
006aa438 : JNZ 0x006aa6d5
006aa43e : MOV EAX,dword ptr [EBX]
006aa440 : AND EAX,0x7f
006aa443 : SUB EAX,ESI
006aa445 : JZ 0x006aa518
006aa44b : SUB EAX,0x1
006aa44e : JNZ 0x006aa638
006aa454 : LEA ESI,[EAX + 0x1]
006aa457 : MOV dword ptr [EBX + 0x8],EAX
006aa45a : MOV dword ptr [ESP + 0x14],EAX
006aa45e : CMP EBP,EAX
006aa460 : JBE 0x006aa505
006aa466 : LEA EDX,[ESP + 0x10]
006aa46a : PUSH EDX
006aa46b : PUSH EDI
006aa46c : CALL 0x00687a20
006aa471 : ADD ESP,0x8
006aa474 : CMP dword ptr [ESP + 0x10],0x0
006aa479 : MOVZX EDI,AL
006aa47c : JNZ 0x006aa6d5
006aa482 : MOV ECX,dword ptr [ESP + 0x28]
006aa486 : LEA EAX,[ESP + 0x10]
006aa48a : PUSH EAX
006aa48b : PUSH ECX
006aa48c : CALL 0x00687a20
006aa491 : ADD ESP,0x8
006aa494 : CMP dword ptr [ESP + 0x10],0x0
006aa499 : MOVZX ECX,AL
006aa49c : JNZ 0x006aa6d5
006aa4a2 : INC ECX
006aa4a3 : CMP ECX,dword ptr [EBX + 0x8]
006aa4a6 : JBE 0x006aa4ab
006aa4a8 : MOV dword ptr [EBX + 0x8],ECX
006aa4ab : LEA EDX,[ECX + ESI*0x1]
006aa4ae : MOV EAX,ESI
006aa4b0 : CMP ESI,EDX
006aa4b2 : JNC 0x006aa4ee
006aa4b4 : LEA ECX,[EBX + EDI*0x2 + 0xc]
006aa4b8 : SUB EDI,ESI
006aa4ba : LEA EBX,[EBX]
006aa4c0 : CMP EAX,dword ptr [ESP + 0x24]
006aa4c4 : JNC 0x006aa4e6
006aa4c6 : LEA ESI,[EDI + EAX*0x1]
006aa4c9 : CMP ESI,0x100
006aa4cf : JNC 0x006aa4e6
006aa4d1 : MOV ESI,dword ptr [ESP + 0x20]
006aa4d5 : MOV word ptr [ECX + 0x200],AX
006aa4dc : MOV ESI,dword ptr [ESI + 0x8]
006aa4df : MOV SI,word ptr [ESI + EAX*0x2]
006aa4e3 : MOV word ptr [ECX],SI
006aa4e6 : INC EAX
006aa4e7 : ADD ECX,0x2
006aa4ea : CMP EAX,EDX
006aa4ec : JC 0x006aa4c0
006aa4ee : MOV EAX,dword ptr [ESP + 0x14]
006aa4f2 : MOV EDI,dword ptr [ESP + 0x28]
006aa4f6 : INC EAX
006aa4f7 : MOV dword ptr [ESP + 0x14],EAX
006aa4fb : MOV ESI,EDX
006aa4fd : CMP EAX,EBP
006aa4ff : JC 0x006aa466
006aa505 : MOV ESI,dword ptr [ESP + 0x24]
006aa509 : MOV EAX,0x100
006aa50e : CMP dword ptr [EBX + 0x8],EAX
006aa511 : JBE 0x006aa57c
006aa513 : MOV dword ptr [EBX + 0x8],EAX
006aa516 : JMP 0x006aa57c
006aa518 : LEA EDX,[EBP + 0x1]
006aa51b : PUSH EBP
006aa51c : PUSH EDI
006aa51d : MOV dword ptr [EBX + 0x8],EDX
006aa520 : CALL 0x00688900
006aa525 : ADD ESP,0x8
006aa528 : MOV dword ptr [ESP + 0x10],EAX
006aa52c : TEST EAX,EAX
006aa52e : JNZ 0x006aa6d5
006aa534 : MOV EDX,dword ptr [EDI + 0x20]
006aa537 : MOV EAX,0x1
006aa53c : CMP EBP,EAX
006aa53e : JC 0x006aa56f
006aa540 : MOVZX ECX,byte ptr [EDX]
006aa543 : MOV ESI,dword ptr [ESP + 0x24]
006aa547 : INC EDX
006aa548 : CMP EAX,ESI
006aa54a : JNC 0x006aa568
006aa54c : MOV EDI,dword ptr [ESP + 0x20]
006aa550 : MOV word ptr [EBX + ECX*0x2 + 0x20c],AX
006aa558 : MOV EDI,dword ptr [EDI + 0x8]
006aa55b : MOV DI,word ptr [EDI + EAX*0x2]
006aa55f : MOV word ptr [EBX + ECX*0x2 + 0xc],DI
006aa564 : MOV EDI,dword ptr [ESP + 0x28]
006aa568 : INC EAX
006aa569 : CMP EAX,EBP
006aa56b : JBE 0x006aa540
006aa56d : JMP 0x006aa573
006aa56f : MOV ESI,dword ptr [ESP + 0x24]
006aa573 : PUSH EDI
006aa574 : CALL 0x006889b0
006aa579 : ADD ESP,0x4
006aa57c : TEST byte ptr [EBX],0x80
006aa57f : JZ 0x006aa6d5
006aa585 : LEA EAX,[ESP + 0x10]
006aa589 : PUSH EAX
006aa58a : PUSH EDI
006aa58b : CALL 0x00687a20
006aa590 : MOVZX EAX,AL
006aa593 : ADD ESP,0x8
006aa596 : CMP dword ptr [ESP + 0x10],0x0
006aa59b : MOV dword ptr [ESP + 0x14],EAX
006aa59f : JNZ 0x006aa6d5
006aa5a5 : XOR EBP,EBP
006aa5a7 : TEST EAX,EAX
006aa5a9 : JBE 0x006aa6d5
006aa5af : NOP
006aa5b0 : MOV EDX,dword ptr [ESP + 0x28]
006aa5b4 : LEA ECX,[ESP + 0x10]
006aa5b8 : PUSH ECX
006aa5b9 : PUSH EDX
006aa5ba : CALL 0x00687a20
006aa5bf : ADD ESP,0x8
006aa5c2 : CMP dword ptr [ESP + 0x10],0x0
006aa5c7 : MOVZX EDI,AL
006aa5ca : JNZ 0x006aa6d5
006aa5d0 : MOV ECX,dword ptr [ESP + 0x28]
006aa5d4 : LEA EAX,[ESP + 0x10]
006aa5d8 : PUSH EAX
006aa5d9 : PUSH ECX
006aa5da : CALL 0x00687a80
006aa5df : ADD ESP,0x8
006aa5e2 : CMP dword ptr [ESP + 0x10],0x0
006aa5e7 : MOVZX EDX,AX
006aa5ea : JNZ 0x006aa6d5
006aa5f0 : XOR EAX,EAX
006aa5f2 : MOV word ptr [EBX + EDI*0x2 + 0xc],DX
006aa5f7 : TEST ESI,ESI
006aa5f9 : JBE 0x006aa619
006aa5fb : MOV ECX,dword ptr [ESP + 0x20]
006aa5ff : MOV ECX,dword ptr [ECX + 0x8]
006aa602 : CMP word ptr [ECX],DX
006aa605 : JZ 0x006aa611
006aa607 : INC EAX
006aa608 : ADD ECX,0x2
006aa60b : CMP EAX,ESI
006aa60d : JC 0x006aa602
006aa60f : JMP 0x006aa619
006aa611 : MOV word ptr [EBX + EDI*0x2 + 0x20c],AX
006aa619 : INC EBP
006aa61a : CMP EBP,dword ptr [ESP + 0x14]
006aa61e : JC 0x006aa5b0
006aa620 : MOV EAX,dword ptr [ESP + 0x10]
006aa624 : POP EDI
006aa625 : POP EBP
006aa626 : POP ESI
006aa627 : POP EBX
006aa628 : ADD ESP,0x8
006aa62b : RET
006aa62c : MOV EAX,EDX
006aa62e : SUB EAX,0x0
006aa631 : JZ 0x006aa653
006aa633 : SUB EAX,0x1
006aa636 : JZ 0x006aa64c
006aa638 : POP EDI
006aa639 : POP EBP
006aa63a : POP ESI
006aa63b : MOV dword ptr [ESP + 0x4],0x3
006aa643 : MOV EAX,dword ptr [ESP + 0x4]
006aa647 : POP EBX
006aa648 : ADD ESP,0x8
006aa64b : RET
006aa64c : MOV ESI,0xbeae28
006aa651 : JMP 0x006aa658
006aa653 : MOV ESI,0xbeac28
006aa658 : MOV EDX,dword ptr [ESP + 0x28]
006aa65c : LEA EBP,[EBX + 0xc]
006aa65f : MOV ECX,0x80
006aa664 : MOV EDI,EBP
006aa666 : MOVSD.REP ES:EDI,ESI
006aa668 : MOV ESI,dword ptr [ESP + 0x20]
006aa66c : MOV dword ptr [EBX + 0x8],0x0
006aa673 : MOV EAX,dword ptr [EDX + 0x1c]
006aa676 : MOV EBX,dword ptr [ESP + 0x24]
006aa67a : PUSH EAX
006aa67b : CALL 0x006a9fd0
006aa680 : ADD ESP,0x4
006aa683 : MOV dword ptr [ESP + 0x10],EAX
006aa687 : TEST EAX,EAX
006aa689 : JNZ 0x006aa6d5
006aa68b : LEA EDI,[EAX + 0x1]
006aa68e : MOV ESI,EBP
006aa690 : MOV EBX,0x100
006aa695 : MOVZX ECX,word ptr [ESI]
006aa698 : TEST ECX,ECX
006aa69a : JZ 0x006aa6be
006aa69c : MOV EDX,dword ptr [ESP + 0x20]
006aa6a0 : CALL 0x006aa050
006aa6a5 : TEST EAX,EAX
006aa6a7 : JZ 0x006aa6be
006aa6a9 : MOV word ptr [ESI + 0x200],AX
006aa6b0 : MOV EAX,dword ptr [ESP + 0x1c]
006aa6b4 : CMP dword ptr [EAX + 0x8],EDI
006aa6b7 : JNC 0x006aa6cc
006aa6b9 : MOV dword ptr [EAX + 0x8],EDI
006aa6bc : JMP 0x006aa6cc
006aa6be : XOR ECX,ECX
006aa6c0 : XOR EDX,EDX
006aa6c2 : MOV word ptr [ESI + 0x200],CX
006aa6c9 : MOV word ptr [ESI],DX
006aa6cc : ADD ESI,0x2
006aa6cf : INC EDI
006aa6d0 : SUB EBX,0x1
006aa6d3 : JNZ 0x006aa695
006aa6d5 : MOV EAX,dword ptr [ESP + 0x10]
006aa6d9 : POP EDI
006aa6da : POP EBP
006aa6db : POP ESI
006aa6dc : POP EBX
006aa6dd : ADD ESP,0x8
006aa6e0 : RET
