PROGRAM  : Maestia.exe
FUNCTION : FUN_00591960
ENTRY    : 00591960
BODY     : [[00591960, 00591ba7]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00591960(int param_1)

{
  int *piVar1;
  GRect<float> *pGVar2;
  int iVar3;
  float unaff_EDI;
  int *piVar4;
  undefined1 *puVar5;
  int *piStack_78;
  int iStack_74;
  float local_58;
  double local_54;
  undefined4 local_4c;
  GMatrix2D local_48 [4];
  double dStack_44;
  GMatrix2D local_30 [4];
  undefined1 auStack_2c [16];
  undefined1 auStack_1c [4];
  GMatrix2D local_18 [12];
  undefined1 auStack_c [12];
  
  if (*(int **)(param_1 + 8) == (int *)0x0) {
    piVar4 = *(int **)(*(int *)(param_1 + 0x18) + 0x74);
  }
  else {
    iVar3 = (**(code **)(**(int **)(param_1 + 8) + 8))();
    if (iVar3 != 2) {
      return;
    }
    if (*(int *)(param_1 + 8) == 0) {
      return;
    }
    piVar4 = (int *)(*(int *)(param_1 + 8) + -0x68);
  }
  if (piVar4 != (int *)0x0) {
    piVar1 = piVar4;
    if (0 < *(int *)(param_1 + 0x1c)) {
      FUN_00526260();
      piVar1 = (int *)FUN_00525fa0();
    }
    if (piVar1 == (int *)0x0) {
      piVar1 = (int *)0x0;
    }
    else {
      piVar1 = (int *)FUN_0054ed10();
    }
    local_58 = 0.0;
    local_54 = 0.0;
    local_4c = 0;
    GMatrix2D::SetIdentity(local_30);
    if (piVar1 != (int *)0x0) {
      if (piVar1 != piVar4) {
        GMatrix2D::SetIdentity(local_48);
        _iStack_74 = (double)CONCAT44(0x591a08,iStack_74);
        FUN_0051cdf0();
        _iStack_74 = (double)CONCAT44(0x591a16,iStack_74);
        GMatrix2D::SetInverse(local_30,local_48);
        GMatrix2D::SetIdentity(local_48);
        _iStack_74 = (double)CONCAT44(0x591a2b,iStack_74);
        FUN_0051cdf0();
        _iStack_74 = (double)CONCAT44(0x591a39,iStack_74);
        GMatrix2D::Prepend(local_30,local_48);
      }
      GMatrix2D::SetIdentity(local_18);
      _iStack_74 = (double)CONCAT44(local_48,0x591a55);
      pGVar2 = (GRect<float> *)(**(code **)(*piVar4 + 0x28))();
      _iStack_74 = (double)CONCAT44((GRect<float> *)&local_58,0x591a64);
      GMatrix2D::EncloseTransform(local_30,(GRect<float> *)&local_58,pGVar2);
    }
    _iStack_74 = 1.01858683053285e-312;
    iVar3 = FUN_00515840();
    if (iVar3 == 0) {
      iVar3 = 0;
    }
    else {
      _iStack_74 = (double)CONCAT44(0x591a88,iStack_74);
      iVar3 = FUN_00551210();
    }
    piVar1 = (int *)(*(int *)(param_1 + 0x18) + 0x78);
    piVar4 = (int *)(iVar3 + 0x10);
    _iStack_74 = (double)CONCAT44(local_48,*(int *)(*(int *)(param_1 + 0x18) + 0x78) + 500);
    local_48[0] = (GMatrix2D)0x3;
    dStack_44 = (double)(local_58 / 20.0);
    piStack_78 = piVar1;
    (**(code **)(*(int *)(iVar3 + 0x10) + 0x28))();
    FUN_00526bc0();
    puVar5 = auStack_c;
    local_58 = (float)CONCAT31(local_58._1_3_,3);
    auStack_c[0] = 0;
    local_54 = (double)(unaff_EDI / 20.0);
    (**(code **)(*piVar4 + 0x28))(piVar1,*piVar1 + 0x1f8,&local_58,puVar5);
    FUN_00526bc0();
    auStack_1c[0] = 0;
    (**(code **)(*piVar4 + 0x28))(piVar1,*piVar1 + 0x1fc,&stack0xffffff98,auStack_1c);
    FUN_00526bc0();
    piStack_78 = (int *)CONCAT31(piStack_78._1_3_,3);
    auStack_2c[0] = 0;
    _iStack_74 = (double)((float)puVar5 / 20.0);
    (**(code **)(*piVar4 + 0x28))(piVar1,*piVar1 + 0x200,&piStack_78,auStack_2c);
    FUN_00526bc0();
    FUN_005271c0(iVar3);
    FUN_00503db0();
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00591960 : SUB ESP,0x58
00591963 : PUSH EBP
00591964 : MOV EBP,dword ptr [ESP + 0x60]
00591968 : MOV ECX,dword ptr [EBP + 0x8]
0059196b : PUSH EDI
0059196c : TEST ECX,ECX
0059196e : JNZ 0x00591978
00591970 : MOV EAX,dword ptr [EBP + 0x18]
00591973 : MOV EDI,dword ptr [EAX + 0x74]
00591976 : JMP 0x00591996
00591978 : MOV EDX,dword ptr [ECX]
0059197a : MOV EAX,dword ptr [EDX + 0x8]
0059197d : CALL EAX
0059197f : CMP EAX,0x2
00591982 : JNZ 0x00591ba2
00591988 : MOV EAX,dword ptr [EBP + 0x8]
0059198b : TEST EAX,EAX
0059198d : JZ 0x00591ba2
00591993 : LEA EDI,[EAX + -0x68]
00591996 : TEST EDI,EDI
00591998 : JZ 0x00591ba2
0059199e : CMP dword ptr [EBP + 0x1c],0x0
005919a2 : JLE 0x005919ba
005919a4 : MOV ECX,dword ptr [EBP + 0x18]
005919a7 : PUSH ECX
005919a8 : PUSH 0x0
005919aa : MOV ECX,EBP
005919ac : CALL 0x00526260
005919b1 : MOV ECX,EAX
005919b3 : CALL 0x00525fa0
005919b8 : JMP 0x005919bc
005919ba : MOV EAX,EDI
005919bc : PUSH EBX
005919bd : PUSH ESI
005919be : TEST EAX,EAX
005919c0 : JZ 0x005919ce
005919c2 : LEA ECX,[EAX + 0x68]
005919c5 : CALL 0x0054ed10
005919ca : MOV ESI,EAX
005919cc : JMP 0x005919d0
005919ce : XOR ESI,ESI
005919d0 : FLDZ
005919d2 : LEA ECX,[ESP + 0x38]
005919d6 : FST float ptr [ESP + 0x10]
005919da : FST float ptr [ESP + 0x14]
005919de : FST float ptr [ESP + 0x18]
005919e2 : FSTP float ptr [ESP + 0x1c]
005919e6 : CALL 0x00522b80
005919eb : TEST ESI,ESI
005919ed : JZ 0x00591a64
005919ef : CMP ESI,EDI
005919f1 : JZ 0x00591a39
005919f3 : LEA ECX,[ESP + 0x20]
005919f7 : CALL 0x00522b80
005919fc : LEA EDX,[ESP + 0x20]
00591a00 : PUSH EDX
00591a01 : MOV ECX,ESI
00591a03 : CALL 0x0051cdf0
00591a08 : LEA EAX,[ESP + 0x20]
00591a0c : PUSH EAX
00591a0d : LEA ECX,[ESP + 0x3c]
00591a11 : CALL 0x00522cb0
00591a16 : LEA ECX,[ESP + 0x20]
00591a1a : CALL 0x00522b80
00591a1f : LEA ECX,[ESP + 0x20]
00591a23 : PUSH ECX
00591a24 : MOV ECX,EDI
00591a26 : CALL 0x0051cdf0
00591a2b : LEA EDX,[ESP + 0x20]
00591a2f : PUSH EDX
00591a30 : LEA ECX,[ESP + 0x3c]
00591a34 : CALL 0x00522e20
00591a39 : LEA ECX,[ESP + 0x50]
00591a3d : CALL 0x00522b80
00591a42 : MOV EAX,dword ptr [EDI]
00591a44 : MOV EAX,dword ptr [EAX + 0x28]
00591a47 : LEA ECX,[ESP + 0x50]
00591a4b : PUSH ECX
00591a4c : LEA EDX,[ESP + 0x24]
00591a50 : PUSH EDX
00591a51 : MOV ECX,EDI
00591a53 : CALL EAX
00591a55 : PUSH EAX
00591a56 : LEA ECX,[ESP + 0x14]
00591a5a : PUSH ECX
00591a5b : LEA ECX,[ESP + 0x40]
00591a5f : CALL 0x005231d0
00591a64 : MOV EDX,dword ptr [EBP + 0x18]
00591a67 : MOV EAX,dword ptr [EDX + 0x78]
00591a6a : MOV ECX,dword ptr [EAX + 0x288]
00591a70 : PUSH 0x0
00591a72 : PUSH 0x30
00591a74 : CALL 0x00515840
00591a79 : TEST EAX,EAX
00591a7b : JZ 0x00591a8c
00591a7d : MOV ECX,dword ptr [EBP + 0x18]
00591a80 : PUSH ECX
00591a81 : MOV ECX,EAX
00591a83 : CALL 0x00551210
00591a88 : MOV EBX,EAX
00591a8a : JMP 0x00591a8e
00591a8c : XOR EBX,EBX
00591a8e : FLD float ptr [ESP + 0x10]
00591a92 : MOV ESI,dword ptr [EBP + 0x18]
00591a95 : FDIV double ptr [0x00b86058]
00591a9b : MOV EDX,dword ptr [EBX + 0x10]
00591a9e : MOV EDX,dword ptr [EDX + 0x28]
00591aa1 : LEA EAX,[ESP + 0x6c]
00591aa5 : PUSH EAX
00591aa6 : MOV EAX,dword ptr [ESI + 0x78]
00591aa9 : ADD ESI,0x78
00591aac : LEA ECX,[ESP + 0x24]
00591ab0 : PUSH ECX
00591ab1 : LEA EDI,[EBX + 0x10]
00591ab4 : ADD EAX,0x1f4
00591ab9 : PUSH EAX
00591aba : PUSH ESI
00591abb : MOV ECX,EDI
00591abd : MOV byte ptr [ESP + 0x30],0x3
00591ac2 : MOV byte ptr [ESP + 0x7c],0x0
00591ac7 : FSTP double ptr [ESP + 0x34]
00591acb : CALL EDX
00591acd : LEA ECX,[ESP + 0x20]
00591ad1 : CALL 0x00526bc0
00591ad6 : FLD float ptr [ESP + 0x18]
00591ada : FDIV double ptr [0x00b86058]
00591ae0 : MOV EAX,dword ptr [EDI]
00591ae2 : LEA ECX,[ESP + 0x6c]
00591ae6 : PUSH ECX
00591ae7 : MOV ECX,dword ptr [ESI]
00591ae9 : LEA EDX,[ESP + 0x24]
00591aed : PUSH EDX
00591aee : MOV EDX,dword ptr [EAX + 0x28]
00591af1 : ADD ECX,0x1f8
00591af7 : PUSH ECX
00591af8 : PUSH ESI
00591af9 : MOV ECX,EDI
00591afb : MOV byte ptr [ESP + 0x30],0x3
00591b00 : MOV byte ptr [ESP + 0x7c],0x0
00591b05 : FSTP double ptr [ESP + 0x34]
00591b09 : CALL EDX
00591b0b : LEA ECX,[ESP + 0x20]
00591b0f : CALL 0x00526bc0
00591b14 : FLD float ptr [ESP + 0x14]
00591b18 : FDIV double ptr [0x00b86058]
00591b1e : MOV EAX,dword ptr [EDI]
00591b20 : LEA ECX,[ESP + 0x6c]
00591b24 : PUSH ECX
00591b25 : MOV ECX,dword ptr [ESI]
00591b27 : LEA EDX,[ESP + 0x24]
00591b2b : PUSH EDX
00591b2c : MOV EDX,dword ptr [EAX + 0x28]
00591b2f : ADD ECX,0x1fc
00591b35 : PUSH ECX
00591b36 : PUSH ESI
00591b37 : MOV ECX,EDI
00591b39 : MOV byte ptr [ESP + 0x30],0x3
00591b3e : MOV byte ptr [ESP + 0x7c],0x0
00591b43 : FSTP double ptr [ESP + 0x34]
00591b47 : CALL EDX
00591b49 : LEA ECX,[ESP + 0x20]
00591b4d : CALL 0x00526bc0
00591b52 : FLD float ptr [ESP + 0x1c]
00591b56 : FDIV double ptr [0x00b86058]
00591b5c : MOV EAX,dword ptr [EDI]
00591b5e : LEA ECX,[ESP + 0x6c]
00591b62 : PUSH ECX
00591b63 : MOV ECX,dword ptr [ESI]
00591b65 : LEA EDX,[ESP + 0x24]
00591b69 : PUSH EDX
00591b6a : MOV EDX,dword ptr [EAX + 0x28]
00591b6d : ADD ECX,0x200
00591b73 : PUSH ECX
00591b74 : PUSH ESI
00591b75 : MOV ECX,EDI
00591b77 : MOV byte ptr [ESP + 0x30],0x3
00591b7c : MOV byte ptr [ESP + 0x7c],0x0
00591b81 : FSTP double ptr [ESP + 0x34]
00591b85 : CALL EDX
00591b87 : LEA ECX,[ESP + 0x20]
00591b8b : CALL 0x00526bc0
00591b90 : MOV ECX,dword ptr [EBP + 0x4]
00591b93 : PUSH EBX
00591b94 : CALL 0x005271c0
00591b99 : MOV ECX,EBX
00591b9b : CALL 0x00503db0
00591ba0 : POP ESI
00591ba1 : POP EBX
00591ba2 : POP EDI
00591ba3 : POP EBP
00591ba4 : ADD ESP,0x58
00591ba7 : RET
