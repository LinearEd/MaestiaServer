PROGRAM  : Maestia.exe
FUNCTION : FUN_00980100
ENTRY    : 00980100
BODY     : [[00980100, 009802df]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00980100(int param_1,undefined4 param_2)

{
  wchar_t wVar1;
  uint uVar2;
  undefined4 uVar3;
  int iVar4;
  wchar_t *pwVar5;
  int *in_ECX;
  wchar_t *pwVar6;
  wchar_t *pwVar7;
  bool bVar8;
  undefined1 local_60 [4];
  int local_5c;
  int local_58;
  undefined1 local_50 [4];
  undefined2 local_4c;
  undefined4 local_3c;
  uint local_38;
  undefined2 local_30;
  undefined4 local_20;
  uint local_1c;
  void *local_14;
  undefined1 *puStack_10;
  undefined4 local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b68e94;
  local_14 = ExceptionList;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xffffff90;
  ExceptionList = &local_14;
  if ((DAT_00da98bb != '\0') && (*(int *)(*DAT_00da9894 + 0x114) != 0)) {
    FUN_00406460(&DAT_00c7fba4);
    local_c = 0;
    uVar3 = FUN_00403dd0(param_2,uVar2);
    local_c._0_1_ = 1;
    FUN_0070cd60(local_60,uVar3,local_50,0);
    local_c = CONCAT31(local_c._1_3_,3);
    if (7 < local_1c) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_1c = 7;
    local_20 = 0;
    local_30 = 0;
    local_c = CONCAT31(local_c._1_3_,4);
    if (7 < local_38) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_4c = 0;
    iVar4 = local_58 - local_5c >> 0x1f;
    local_38 = 7;
    local_3c = 0;
    if ((local_58 - local_5c) / 0x1c + iVar4 != iVar4) {
      pwVar5 = (wchar_t *)(param_1 + 4);
      pwVar7 = pwVar5;
      if (7 < *(uint *)(param_1 + 0x18)) {
        pwVar7 = *(wchar_t **)pwVar5;
      }
      pwVar6 = L"SendCmd";
      do {
        wVar1 = *pwVar7;
        bVar8 = (ushort)wVar1 < (ushort)*pwVar6;
        if (wVar1 != *pwVar6) {
LAB_00980246:
          iVar4 = (1 - (uint)bVar8) - (uint)(bVar8 != 0);
          goto LAB_0098024b;
        }
        if (wVar1 == L'\0') break;
        wVar1 = pwVar7[1];
        bVar8 = (ushort)wVar1 < (ushort)pwVar6[1];
        if (wVar1 != pwVar6[1]) goto LAB_00980246;
        pwVar7 = pwVar7 + 2;
        pwVar6 = pwVar6 + 2;
      } while (wVar1 != L'\0');
      iVar4 = 0;
LAB_0098024b:
      if ((iVar4 == 0) && (*(int *)(*DAT_00da9894 + 0x228) != 0)) {
        FUN_009e6680(local_5c);
      }
      if (7 < *(uint *)(param_1 + 0x18)) {
        pwVar5 = *(wchar_t **)pwVar5;
      }
      pwVar7 = L"Close";
      do {
        wVar1 = *pwVar5;
        bVar8 = (ushort)wVar1 < (ushort)*pwVar7;
        if (wVar1 != *pwVar7) {
LAB_009802a6:
          iVar4 = (1 - (uint)bVar8) - (uint)(bVar8 != 0);
          goto LAB_009802ab;
        }
        if (wVar1 == L'\0') break;
        wVar1 = pwVar5[1];
        bVar8 = (ushort)wVar1 < (ushort)pwVar7[1];
        if (wVar1 != pwVar7[1]) goto LAB_009802a6;
        pwVar5 = pwVar5 + 2;
        pwVar7 = pwVar7 + 2;
      } while (wVar1 != L'\0');
      iVar4 = 0;
LAB_009802ab:
      if (iVar4 == 0) {
        (**(code **)(*in_ECX + 0x20))();
      }
    }
    local_c = 0xffffffff;
    FUN_004042c0();
  }
  ExceptionList = local_14;
  return;
}



============================================================
DISASSEMBLY
============================================================
00980100 : PUSH EBP
00980101 : MOV EBP,ESP
00980103 : AND ESP,0xfffffff8
00980106 : PUSH -0x1
00980108 : PUSH 0xb68e94
0098010d : MOV EAX,FS:[0x0]
00980113 : PUSH EAX
00980114 : SUB ESP,0x50
00980117 : PUSH EBX
00980118 : PUSH ESI
00980119 : PUSH EDI
0098011a : MOV EAX,[0x00d66fa0]
0098011f : XOR EAX,ESP
00980121 : PUSH EAX
00980122 : LEA EAX,[ESP + 0x60]
00980126 : MOV FS:[0x0],EAX
0098012c : MOV dword ptr [ESP + 0x10],ECX
00980130 : CMP byte ptr [0x00da98bb],0x0
00980137 : JZ 0x009802cb
0098013d : MOV EAX,[0x00da9894]
00980142 : MOV EAX,dword ptr [EAX]
00980144 : XOR EDI,EDI
00980146 : CMP dword ptr [EAX + 0x114],EDI
0098014c : JZ 0x009802cb
00980152 : PUSH 0xc7fba4
00980157 : LEA ECX,[ESP + 0x28]
0098015b : CALL 0x00406460
00980160 : MOV dword ptr [ESP + 0x68],EDI
00980164 : MOV ECX,dword ptr [EBP + 0xc]
00980167 : PUSH ECX
00980168 : LEA ESI,[ESP + 0x44]
0098016c : CALL 0x00403dd0
00980171 : ADD ESP,0x4
00980174 : MOV byte ptr [ESP + 0x68],0x1
00980179 : PUSH EDI
0098017a : LEA EDX,[ESP + 0x28]
0098017e : PUSH EDX
0098017f : PUSH EAX
00980180 : LEA EAX,[ESP + 0x20]
00980184 : PUSH EAX
00980185 : CALL 0x0070cd60
0098018a : ADD ESP,0x10
0098018d : MOV byte ptr [ESP + 0x68],0x3
00980192 : MOV EBX,0x8
00980197 : CMP dword ptr [ESP + 0x58],EBX
0098019b : JC 0x009801a6
0098019d : MOV ECX,dword ptr [ESP + 0x44]
009801a1 : CALL 0x006f04e0
009801a6 : MOV ESI,0x7
009801ab : XOR ECX,ECX
009801ad : MOV dword ptr [ESP + 0x58],ESI
009801b1 : MOV dword ptr [ESP + 0x54],EDI
009801b5 : MOV word ptr [ESP + 0x44],CX
009801ba : MOV byte ptr [ESP + 0x68],0x4
009801bf : CMP dword ptr [ESP + 0x3c],EBX
009801c3 : JC 0x009801ce
009801c5 : MOV ECX,dword ptr [ESP + 0x28]
009801c9 : CALL 0x006f04e0
009801ce : MOV ECX,dword ptr [ESP + 0x1c]
009801d2 : MOV EBX,dword ptr [ESP + 0x18]
009801d6 : XOR EDX,EDX
009801d8 : SUB ECX,EBX
009801da : MOV word ptr [ESP + 0x28],DX
009801df : MOV EAX,0x92492493
009801e4 : IMUL ECX
009801e6 : ADD EDX,ECX
009801e8 : SAR EDX,0x4
009801eb : MOV EAX,EDX
009801ed : SHR EAX,0x1f
009801f0 : ADD EAX,EDX
009801f2 : MOV dword ptr [ESP + 0x3c],ESI
009801f6 : MOV dword ptr [ESP + 0x38],EDI
009801fa : CMP EAX,0x1
009801fd : JC 0x009802ba
00980203 : MOV EDI,dword ptr [EBP + 0x8]
00980206 : CMP dword ptr [EDI + 0x18],0x8
0098020a : LEA ESI,[EDI + 0x4]
0098020d : JC 0x00980213
0098020f : MOV EAX,dword ptr [ESI]
00980211 : JMP 0x00980215
00980213 : MOV EAX,ESI
00980215 : MOV ECX,0xc7fba8
0098021a : LEA EBX,[EBX]
00980220 : MOV DX,word ptr [EAX]
00980223 : CMP DX,word ptr [ECX]
00980226 : JNZ 0x00980246
00980228 : TEST DX,DX
0098022b : JZ 0x00980242
0098022d : MOV DX,word ptr [EAX + 0x2]
00980231 : CMP DX,word ptr [ECX + 0x2]
00980235 : JNZ 0x00980246
00980237 : ADD EAX,0x4
0098023a : ADD ECX,0x4
0098023d : TEST DX,DX
00980240 : JNZ 0x00980220
00980242 : XOR EAX,EAX
00980244 : JMP 0x0098024b
00980246 : SBB EAX,EAX
00980248 : SBB EAX,-0x1
0098024b : TEST EAX,EAX
0098024d : JNZ 0x0098026e
0098024f : MOV ECX,dword ptr [0x00da9894]
00980255 : MOV EAX,dword ptr [ECX]
00980257 : CMP dword ptr [EAX + 0x228],0x0
0098025e : JZ 0x0098026e
00980260 : MOV EAX,dword ptr [EAX + 0x228]
00980266 : PUSH EBX
00980267 : MOV ECX,EAX
00980269 : CALL 0x009e6680
0098026e : CMP dword ptr [EDI + 0x18],0x8
00980272 : JC 0x00980278
00980274 : MOV EAX,dword ptr [ESI]
00980276 : JMP 0x0098027a
00980278 : MOV EAX,ESI
0098027a : MOV ECX,0xc7fbb8
0098027f : NOP
00980280 : MOV DX,word ptr [EAX]
00980283 : CMP DX,word ptr [ECX]
00980286 : JNZ 0x009802a6
00980288 : TEST DX,DX
0098028b : JZ 0x009802a2
0098028d : MOV DX,word ptr [EAX + 0x2]
00980291 : CMP DX,word ptr [ECX + 0x2]
00980295 : JNZ 0x009802a6
00980297 : ADD EAX,0x4
0098029a : ADD ECX,0x4
0098029d : TEST DX,DX
009802a0 : JNZ 0x00980280
009802a2 : XOR EAX,EAX
009802a4 : JMP 0x009802ab
009802a6 : SBB EAX,EAX
009802a8 : SBB EAX,-0x1
009802ab : TEST EAX,EAX
009802ad : JNZ 0x009802ba
009802af : MOV ECX,dword ptr [ESP + 0x10]
009802b3 : MOV EDX,dword ptr [ECX]
009802b5 : MOV EAX,dword ptr [EDX + 0x20]
009802b8 : CALL EAX
009802ba : MOV dword ptr [ESP + 0x68],0xffffffff
009802c2 : LEA ESI,[ESP + 0x14]
009802c6 : CALL 0x004042c0
009802cb : MOV ECX,dword ptr [ESP + 0x60]
009802cf : MOV dword ptr FS:[0x0],ECX
009802d6 : POP ECX
009802d7 : POP EDI
009802d8 : POP ESI
009802d9 : POP EBX
009802da : MOV ESP,EBP
009802dc : POP EBP
009802dd : RET 0x8
