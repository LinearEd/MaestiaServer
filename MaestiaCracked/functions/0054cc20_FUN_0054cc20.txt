PROGRAM  : Maestia.exe
FUNCTION : FUN_0054cc20
ENTRY    : 0054cc20
BODY     : [[0054cc20, 0054cf70]]

============================================================
DECOMPILED C CODE
============================================================

undefined4
FUN_0054cc20(uint param_1,float *param_2,int *param_3,int *param_4,char param_5,uint *param_6)

{
  uint *puVar1;
  float fVar2;
  float fVar3;
  char cVar4;
  int iVar5;
  uint uVar6;
  undefined4 uVar7;
  LONG LVar8;
  int in_ECX;
  byte bVar9;
  uint uVar10;
  int iVar11;
  uint uVar12;
  int iVar13;
  bool bVar14;
  float local_68;
  uint local_5c;
  uint local_58;
  int *local_10;
  GRefCountNTSImpl *local_c;
  uint local_4;
  
  FUN_0054ad30();
  iVar5 = FUN_0054b4f0(param_1);
  if (iVar5 == -1) {
    return 0;
  }
  puVar1 = *(uint **)(*(int *)(*(int *)(in_ECX + 8) + 0x28) + iVar5 * 4);
  if (param_6 != (uint *)0x0) {
    *param_6 = *puVar1 >> 0x1c & 3;
  }
  uVar6 = puVar1[2];
  if (((int)*puVar1 < 0) && (uVar6 = uVar6 & 0xffffff, uVar6 == 0xffffff)) {
    uVar6 = 0xffffffff;
  }
  uVar12 = param_1 - uVar6;
  iVar13 = 0;
  iVar11 = (int)puVar1 + 0x1e;
  if ((int)*puVar1 < 0) {
    uVar10 = (uint)(byte)puVar1[7];
  }
  else {
    uVar10 = puVar1[1];
    iVar11 = (int)puVar1 + 0x2a;
  }
  uVar7 = FUN_00599240();
  FUN_00545960(iVar11,uVar10,uVar7);
  param_6 = (uint *)0x0;
  while ((((local_5c != 0 && (local_5c < local_58)) && ((*(ushort *)(local_5c + 4) & 0xf000) == 0))
         && ((*(ushort *)(local_5c + 6) >> 8 & 1) == 0))) {
    uVar10 = (uint)*(ushort *)(local_5c + 2);
    if (((byte)*(ushort *)(local_5c + 6) >> 6 & 1) != 0) {
      uVar10 = -uVar10;
    }
    param_6 = (uint *)((int)param_6 + 1);
    iVar13 = iVar13 + uVar10;
    FUN_005443b0();
  }
  uVar10 = 0;
  bVar14 = param_1 != uVar6;
  uVar6 = local_5c;
  param_1 = iVar13;
  if (bVar14) {
    do {
      uVar6 = local_5c;
      if ((local_5c == 0) || (local_58 <= local_5c)) break;
      bVar9 = (byte)*(undefined2 *)(local_5c + 6);
      uVar6 = (uint)*(ushort *)(local_5c + 2);
      if ((bVar9 >> 6 & 1) != 0) {
        uVar6 = -uVar6;
      }
      param_1 = param_1 + uVar6;
      if ((param_5 == '\0') || ((bVar9 >> 2 & 1) == 0)) {
        uVar10 = uVar10 + (*(ushort *)(local_5c + 4) >> 0xc);
      }
      param_6 = (uint *)((int)param_6 + 1);
      if (local_4 == 0) {
        local_4 = (uint)(*(ushort *)(local_5c + 4) >> 0xc);
      }
      uVar6 = local_5c + 8;
      if ((((*(ushort *)(local_5c + 0xc) & 0xf000) != 0) && (local_4 != 0)) &&
         (cVar4 = FUN_005d2b10(), cVar4 == '\0')) {
        FUN_005d30b0(local_4);
        local_4 = 0;
      }
      FUN_0059a4d0();
      local_5c = uVar6;
    } while (uVar10 < uVar12);
  }
  local_68 = 0.0;
  if ((uVar6 != 0) && (uVar6 < local_58)) {
    if ((*(byte *)(uVar6 + 6) >> 6 & 1) == 0) {
      _param_5 = (uint)*(ushort *)(uVar6 + 2);
    }
    else {
      _param_5 = -(uint)*(ushort *)(uVar6 + 2);
    }
    local_68 = (float)(int)_param_5;
  }
  if ((int)*puVar1 < 0) {
    _param_5 = puVar1[3];
  }
  else {
    _param_5 = puVar1[3];
  }
  fVar2 = (float)(int)_param_5;
  *param_2 = fVar2 + (float)(int)param_1;
  if ((int)*puVar1 < 0) {
    _param_5 = puVar1[4];
  }
  else {
    _param_5 = puVar1[4];
  }
  fVar3 = (float)(int)_param_5;
  param_2[1] = fVar3;
  param_2[2] = local_68 + fVar2 + (float)(int)param_1;
  if ((int)*puVar1 < 0) {
    _param_5 = (uint)*(ushort *)((int)puVar1 + 0x16);
  }
  else {
    _param_5 = puVar1[6];
  }
  param_2[3] = fVar3 + (float)(int)_param_5;
  if (param_3 != (int *)0x0) {
    *param_3 = iVar5;
  }
  if (param_4 != (int *)0x0) {
    *param_4 = (int)param_6;
  }
  if (local_c != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release(local_c);
  }
  if ((local_10 != (int *)0x0) && (*local_10 = *local_10 + -1, *local_10 == 0)) {
    if (local_10[1] != 0) {
      FUN_0055cd60(local_10);
    }
    if (local_10[5] != 0) {
      FUN_00524240();
    }
    local_10[5] = 0;
    if (local_10[6] != 0) {
      FUN_00524240();
    }
    if (local_10[5] != 0) {
      FUN_00524240();
    }
    uVar6 = local_10[3];
    LVar8 = InterlockedExchangeAdd((LONG *)((uVar6 & 0xfffffffc) + 4),-1);
    if (LVar8 == 1) {
      FUN_00515cf0(uVar6 & 0xfffffffc);
    }
    FUN_00515cf0(local_10);
  }
  return 1;
}



============================================================
DISASSEMBLY
============================================================
0054cc20 : SUB ESP,0x68
0054cc23 : PUSH ESI
0054cc24 : MOV ESI,ECX
0054cc26 : MOV ECX,dword ptr [ESI + 0x8]
0054cc29 : PUSH EDI
0054cc2a : CALL 0x0054ad30
0054cc2f : MOV EDI,dword ptr [ESP + 0x74]
0054cc33 : MOV ECX,dword ptr [ESI + 0x8]
0054cc36 : PUSH EDI
0054cc37 : CALL 0x0054b4f0
0054cc3c : MOV dword ptr [ESP + 0x10],EAX
0054cc40 : CMP EAX,-0x1
0054cc43 : JZ 0x0054cf67
0054cc49 : MOV ECX,dword ptr [ESI + 0x8]
0054cc4c : MOV EDX,dword ptr [ECX + 0x28]
0054cc4f : PUSH EBX
0054cc50 : MOV EBX,dword ptr [EDX + EAX*0x4]
0054cc53 : MOV EAX,dword ptr [ESP + 0x8c]
0054cc5a : MOV dword ptr [ESP + 0xc],EBX
0054cc5e : TEST EAX,EAX
0054cc60 : JZ 0x0054cc6c
0054cc62 : MOV ECX,dword ptr [EBX]
0054cc64 : SHR ECX,0x1c
0054cc67 : AND ECX,0x3
0054cc6a : MOV dword ptr [EAX],ECX
0054cc6c : MOV ECX,dword ptr [EBX]
0054cc6e : MOV EAX,dword ptr [EBX + 0x8]
0054cc71 : SHR ECX,0x1f
0054cc74 : AND CL,0x1
0054cc77 : JZ 0x0054cc88
0054cc79 : AND EAX,0xffffff
0054cc7e : CMP EAX,0xffffff
0054cc83 : JNZ 0x0054cc88
0054cc85 : OR EAX,0xffffffff
0054cc88 : SUB EDI,EAX
0054cc8a : MOV dword ptr [ESP + 0x10],EDI
0054cc8e : XOR EDI,EDI
0054cc90 : PUSH EBP
0054cc91 : TEST CL,CL
0054cc93 : JZ 0x0054cc9b
0054cc95 : MOVZX EBP,byte ptr [EBX + 0x1c]
0054cc99 : JMP 0x0054cc9e
0054cc9b : MOV EBP,dword ptr [EBX + 0x4]
0054cc9e : LEA ESI,[EBX + 0x1e]
0054cca1 : TEST CL,CL
0054cca3 : JNZ 0x0054cca8
0054cca5 : LEA ESI,[EBX + 0x2a]
0054cca8 : MOV ECX,EBX
0054ccaa : CALL 0x00599240
0054ccaf : PUSH EAX
0054ccb0 : PUSH EBP
0054ccb1 : PUSH ESI
0054ccb2 : LEA ECX,[ESP + 0x28]
0054ccb6 : CALL 0x00545960
0054ccbb : MOV dword ptr [ESP + 0x90],0x0
0054ccc6 : MOV EAX,dword ptr [ESP + 0x1c]
0054ccca : TEST EAX,EAX
0054cccc : JZ 0x0054cd0f
0054ccce : CMP EAX,dword ptr [ESP + 0x20]
0054ccd2 : JNC 0x0054cd0f
0054ccd4 : MOV EDX,0xf000
0054ccd9 : TEST word ptr [EAX + 0x4],DX
0054ccdd : JNZ 0x0054cd0f
0054ccdf : MOVZX ECX,word ptr [EAX + 0x6]
0054cce3 : MOV EDX,ECX
0054cce5 : SHR EDX,0x8
0054cce8 : TEST DL,0x1
0054cceb : JNZ 0x0054cd0f
0054cced : MOVZX EAX,word ptr [EAX + 0x2]
0054ccf1 : SHR CL,0x6
0054ccf4 : TEST CL,0x1
0054ccf7 : JZ 0x0054ccfb
0054ccf9 : NEG EAX
0054ccfb : INC dword ptr [ESP + 0x90]
0054cd02 : LEA ECX,[ESP + 0x1c]
0054cd06 : ADD EDI,EAX
0054cd08 : CALL 0x005443b0
0054cd0d : JMP 0x0054ccc6
0054cd0f : MOV EBP,dword ptr [ESP + 0x14]
0054cd13 : XOR ESI,ESI
0054cd15 : MOV dword ptr [ESP + 0x7c],EDI
0054cd19 : TEST EBP,EBP
0054cd1b : JBE 0x0054cdd5
0054cd21 : MOV BL,byte ptr [ESP + 0x8c]
0054cd28 : TEST EAX,EAX
0054cd2a : JZ 0x0054cdd1
0054cd30 : CMP EAX,dword ptr [ESP + 0x20]
0054cd34 : JNC 0x0054cdd1
0054cd3a : MOVZX EDX,word ptr [EAX + 0x6]
0054cd3e : MOV CL,DL
0054cd40 : SHR CL,0x6
0054cd43 : TEST CL,0x1
0054cd46 : MOVZX ECX,word ptr [EAX + 0x2]
0054cd4a : JZ 0x0054cd4e
0054cd4c : NEG ECX
0054cd4e : ADD EDI,ECX
0054cd50 : MOV dword ptr [ESP + 0x7c],EDI
0054cd54 : TEST BL,BL
0054cd56 : JZ 0x0054cd60
0054cd58 : SHR DL,0x2
0054cd5b : TEST DL,0x1
0054cd5e : JNZ 0x0054cd69
0054cd60 : MOVZX EDX,word ptr [EAX + 0x4]
0054cd64 : SHR EDX,0xc
0054cd67 : ADD ESI,EDX
0054cd69 : MOV ECX,dword ptr [ESP + 0x74]
0054cd6d : INC dword ptr [ESP + 0x90]
0054cd74 : TEST ECX,ECX
0054cd76 : JNZ 0x0054cd83
0054cd78 : MOVZX ECX,word ptr [EAX + 0x4]
0054cd7c : SHR ECX,0xc
0054cd7f : MOV dword ptr [ESP + 0x74],ECX
0054cd83 : ADD EAX,0x8
0054cd86 : MOV EDX,0xf000
0054cd8b : MOV dword ptr [ESP + 0x1c],EAX
0054cd8f : TEST word ptr [EAX + 0x4],DX
0054cd93 : JBE 0x0054cdbc
0054cd95 : TEST ECX,ECX
0054cd97 : JBE 0x0054cdbc
0054cd99 : LEA ECX,[ESP + 0x28]
0054cd9d : CALL 0x005d2b10
0054cda2 : TEST AL,AL
0054cda4 : JNZ 0x0054cdbc
0054cda6 : MOV EAX,dword ptr [ESP + 0x74]
0054cdaa : PUSH EAX
0054cdab : LEA ECX,[ESP + 0x2c]
0054cdaf : CALL 0x005d30b0
0054cdb4 : MOV dword ptr [ESP + 0x74],0x0
0054cdbc : LEA ECX,[ESP + 0x1c]
0054cdc0 : CALL 0x0059a4d0
0054cdc5 : MOV EAX,dword ptr [ESP + 0x1c]
0054cdc9 : CMP ESI,EBP
0054cdcb : JC 0x0054cd28
0054cdd1 : MOV EBX,dword ptr [ESP + 0x10]
0054cdd5 : FLDZ
0054cdd7 : POP EBP
0054cdd8 : FSTP float ptr [ESP + 0xc]
0054cddc : TEST EAX,EAX
0054cdde : JZ 0x0054ce16
0054cde0 : CMP EAX,dword ptr [ESP + 0x1c]
0054cde4 : JNC 0x0054ce16
0054cde6 : MOV CL,byte ptr [EAX + 0x6]
0054cde9 : SHR CL,0x6
0054cdec : TEST CL,0x1
0054cdef : JNZ 0x0054cdfe
0054cdf1 : MOVZX EDX,word ptr [EAX + 0x2]
0054cdf5 : MOV dword ptr [ESP + 0x88],EDX
0054cdfc : JMP 0x0054ce0b
0054cdfe : MOVZX EAX,word ptr [EAX + 0x2]
0054ce02 : NEG EAX
0054ce04 : MOV dword ptr [ESP + 0x88],EAX
0054ce0b : FILD dword ptr [ESP + 0x88]
0054ce12 : FSTP float ptr [ESP + 0xc]
0054ce16 : MOV ECX,dword ptr [EBX]
0054ce18 : SHR ECX,0x1f
0054ce1b : TEST CL,0x1
0054ce1e : JZ 0x0054ce2c
0054ce20 : MOV EDX,dword ptr [EBX + 0xc]
0054ce23 : MOV dword ptr [ESP + 0x88],EDX
0054ce2a : JMP 0x0054ce36
0054ce2c : MOV EAX,dword ptr [EBX + 0xc]
0054ce2f : MOV dword ptr [ESP + 0x88],EAX
0054ce36 : FILD dword ptr [ESP + 0x88]
0054ce3d : MOV EAX,dword ptr [ESP + 0x7c]
0054ce41 : FIADD dword ptr [ESP + 0x78]
0054ce45 : FSTP float ptr [ESP + 0x88]
0054ce4c : FLD float ptr [ESP + 0x88]
0054ce53 : FST float ptr [EAX]
0054ce55 : MOV ECX,dword ptr [EBX]
0054ce57 : SHR ECX,0x1f
0054ce5a : TEST CL,0x1
0054ce5d : JZ 0x0054ce6b
0054ce5f : MOV EDX,dword ptr [EBX + 0x10]
0054ce62 : MOV dword ptr [ESP + 0x88],EDX
0054ce69 : JMP 0x0054ce75
0054ce6b : MOV ECX,dword ptr [EBX + 0x10]
0054ce6e : MOV dword ptr [ESP + 0x88],ECX
0054ce75 : FILD dword ptr [ESP + 0x88]
0054ce7c : FSTP float ptr [ESP + 0x88]
0054ce83 : FLD float ptr [ESP + 0x88]
0054ce8a : FST float ptr [EAX + 0x4]
0054ce8d : FLD float ptr [ESP + 0xc]
0054ce91 : FADDP ST2,ST0
0054ce93 : FXCH
0054ce95 : FSTP float ptr [EAX + 0x8]
0054ce98 : MOV EDX,dword ptr [EBX]
0054ce9a : SHR EDX,0x1f
0054ce9d : TEST DL,0x1
0054cea0 : JZ 0x0054ceaf
0054cea2 : MOVZX ECX,word ptr [EBX + 0x16]
0054cea6 : MOV dword ptr [ESP + 0x88],ECX
0054cead : JMP 0x0054ceb9
0054ceaf : MOV EDX,dword ptr [EBX + 0x18]
0054ceb2 : MOV dword ptr [ESP + 0x88],EDX
0054ceb9 : FIADD dword ptr [ESP + 0x88]
0054cec0 : POP EBX
0054cec1 : FSTP float ptr [EAX + 0xc]
0054cec4 : MOV EAX,dword ptr [ESP + 0x7c]
0054cec8 : TEST EAX,EAX
0054ceca : JZ 0x0054ced2
0054cecc : MOV ECX,dword ptr [ESP + 0x10]
0054ced0 : MOV dword ptr [EAX],ECX
0054ced2 : MOV EAX,dword ptr [ESP + 0x80]
0054ced9 : TEST EAX,EAX
0054cedb : JZ 0x0054cee6
0054cedd : MOV EDX,dword ptr [ESP + 0x88]
0054cee4 : MOV dword ptr [EAX],EDX
0054cee6 : MOV ECX,dword ptr [ESP + 0x64]
0054ceea : TEST ECX,ECX
0054ceec : JZ 0x0054cef3
0054ceee : CALL 0x004ff7c0
0054cef3 : MOV ESI,dword ptr [ESP + 0x60]
0054cef7 : TEST ESI,ESI
0054cef9 : JZ 0x0054cf5d
0054cefb : DEC dword ptr [ESI]
0054cefd : CMP dword ptr [ESI],0x0
0054cf00 : JNZ 0x0054cf5d
0054cf02 : MOV ECX,dword ptr [ESI + 0x4]
0054cf05 : TEST ECX,ECX
0054cf07 : JZ 0x0054cf0f
0054cf09 : PUSH ESI
0054cf0a : CALL 0x0055cd60
0054cf0f : MOV ECX,dword ptr [ESI + 0x14]
0054cf12 : TEST ECX,ECX
0054cf14 : JZ 0x0054cf1b
0054cf16 : CALL 0x00524240
0054cf1b : MOV dword ptr [ESI + 0x14],0x0
0054cf22 : MOV ECX,dword ptr [ESI + 0x18]
0054cf25 : TEST ECX,ECX
0054cf27 : JZ 0x0054cf2e
0054cf29 : CALL 0x00524240
0054cf2e : MOV ECX,dword ptr [ESI + 0x14]
0054cf31 : TEST ECX,ECX
0054cf33 : JZ 0x0054cf3a
0054cf35 : CALL 0x00524240
0054cf3a : MOV EDI,dword ptr [ESI + 0xc]
0054cf3d : AND EDI,0xfffffffc
0054cf40 : PUSH -0x1
0054cf42 : LEA EAX,[EDI + 0x4]
0054cf45 : PUSH EAX
0054cf46 : CALL dword ptr [0x00b851cc]
0054cf4c : SUB EAX,0x1
0054cf4f : JNZ 0x0054cf57
0054cf51 : PUSH EDI
0054cf52 : CALL 0x00515cf0
0054cf57 : PUSH ESI
0054cf58 : CALL 0x00515cf0
0054cf5d : POP EDI
0054cf5e : MOV AL,0x1
0054cf60 : POP ESI
0054cf61 : ADD ESP,0x68
0054cf64 : RET 0x18
0054cf67 : POP EDI
0054cf68 : XOR AL,AL
0054cf6a : POP ESI
0054cf6b : ADD ESP,0x68
0054cf6e : RET 0x18
