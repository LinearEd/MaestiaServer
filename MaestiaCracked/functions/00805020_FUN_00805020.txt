PROGRAM  : Maestia.exe
FUNCTION : FUN_00805020
ENTRY    : 00805020
BODY     : [[00805020, 00805109]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

uint FUN_00805020(void)

{
  uint in_EAX;
  size_t *psVar1;
  size_t *_Dst;
  int iVar2;
  size_t _Size;
  int *unaff_ESI;
  int unaff_EDI;
  uint local_14 [5];
  
  if (unaff_ESI[2] + 0x14U <= (uint)unaff_ESI[1]) {
    iVar2 = 0;
    _Size = 0;
    local_14[0] = 0;
    local_14[1] = 0;
    local_14[2] = 0;
    local_14[3] = 0;
    local_14[4] = 0;
    do {
      in_EAX = FUN_004575f0();
      local_14[iVar2] = in_EAX;
      iVar2 = iVar2 + 1;
      _Size = _Size + in_EAX;
    } while (iVar2 < 5);
    if (unaff_ESI[2] + _Size <= (uint)unaff_ESI[1]) {
      if (DAT_00da98c8 == (int *)0x0) {
        psVar1 = _malloc(_Size + 4);
      }
      else {
        psVar1 = (size_t *)(**(code **)(*DAT_00da98c8 + 4))();
      }
      if (psVar1 == (size_t *)0x0) {
        _Dst = (size_t *)0x0;
      }
      else {
        _DAT_00da98cc = _DAT_00da98cc + _Size + 4;
        _DAT_00da98d0 = _DAT_00da98d0 + 1;
        _Dst = psVar1 + 1;
        *psVar1 = _Size;
      }
      *(size_t **)(unaff_EDI + 0xd8c) = _Dst;
      _memcpy(_Dst,(void *)(*unaff_ESI + unaff_ESI[2]),_Size);
      unaff_ESI[2] = unaff_ESI[2] + _Size;
      iVar2 = local_14[0] + *(int *)(unaff_EDI + 0xd8c);
      *(int *)(unaff_EDI + 0xd90) = iVar2;
      iVar2 = iVar2 + local_14[1];
      *(int *)(unaff_EDI + 0xd94) = iVar2;
      iVar2 = iVar2 + local_14[2];
      *(int *)(unaff_EDI + 0xd98) = iVar2;
      iVar2 = iVar2 + local_14[3];
      *(int *)(unaff_EDI + 0xd9c) = iVar2;
      return CONCAT31((int3)((uint)iVar2 >> 8),1);
    }
  }
  return in_EAX & 0xffffff00;
}



============================================================
DISASSEMBLY
============================================================
00805020 : MOV ECX,dword ptr [ESI + 0x8]
00805023 : ADD ECX,0x14
00805026 : SUB ESP,0x14
00805029 : XOR AL,AL
0080502b : CMP ECX,dword ptr [ESI + 0x4]
0080502e : JA 0x00805106
00805034 : PUSH EBX
00805035 : XOR EBX,EBX
00805037 : PXOR XMM0,XMM0
0080503b : PUSH EBP
0080503c : XOR EBP,EBP
0080503e : MOV dword ptr [ESP + 0x8],EBX
00805042 : MOVQ qword ptr [ESP + 0xc],XMM0
00805048 : MOVQ qword ptr [ESP + 0x14],XMM0
0080504e : MOV EDI,EDI
00805050 : MOV EAX,ESI
00805052 : CALL 0x004575f0
00805057 : MOV dword ptr [ESP + EBX*0x4 + 0x8],EAX
0080505b : INC EBX
0080505c : ADD EBP,EAX
0080505e : CMP EBX,0x5
00805061 : JL 0x00805050
00805063 : MOV EDX,dword ptr [ESI + 0x8]
00805066 : ADD EDX,EBP
00805068 : CMP EDX,dword ptr [ESI + 0x4]
0080506b : JA 0x00805102
00805071 : MOV ECX,dword ptr [0x00da98c8]
00805077 : LEA EBX,[EBP + 0x4]
0080507a : PUSH EBX
0080507b : TEST ECX,ECX
0080507d : JZ 0x00805088
0080507f : MOV EAX,dword ptr [ECX]
00805081 : MOV EDX,dword ptr [EAX + 0x4]
00805084 : CALL EDX
00805086 : JMP 0x00805090
00805088 : CALL 0x00636043
0080508d : ADD ESP,0x4
00805090 : TEST EAX,EAX
00805092 : JZ 0x008050a9
00805094 : ADD dword ptr [0x00da98cc],EBX
0080509a : INC dword ptr [0x00da98d0]
008050a0 : LEA ECX,[EAX + 0x4]
008050a3 : MOV dword ptr [EAX],EBP
008050a5 : MOV EAX,ECX
008050a7 : JMP 0x008050ab
008050a9 : XOR EAX,EAX
008050ab : MOV dword ptr [EDI + 0xd8c],EAX
008050b1 : MOV ECX,dword ptr [ESI]
008050b3 : ADD ECX,dword ptr [ESI + 0x8]
008050b6 : PUSH EBP
008050b7 : PUSH ECX
008050b8 : PUSH EAX
008050b9 : CALL 0x0063ae40
008050be : ADD dword ptr [ESI + 0x8],EBP
008050c1 : MOV EDX,dword ptr [EDI + 0xd8c]
008050c7 : MOV EAX,dword ptr [ESP + 0x14]
008050cb : MOV ECX,dword ptr [ESP + 0x18]
008050cf : ADD EAX,EDX
008050d1 : MOV EDX,dword ptr [ESP + 0x1c]
008050d5 : MOV dword ptr [EDI + 0xd90],EAX
008050db : ADD EAX,ECX
008050dd : MOV ECX,dword ptr [ESP + 0x20]
008050e1 : MOV dword ptr [EDI + 0xd94],EAX
008050e7 : ADD EAX,EDX
008050e9 : ADD ESP,0xc
008050ec : MOV dword ptr [EDI + 0xd98],EAX
008050f2 : ADD EAX,ECX
008050f4 : POP EBP
008050f5 : MOV dword ptr [EDI + 0xd9c],EAX
008050fb : MOV AL,0x1
008050fd : POP EBX
008050fe : ADD ESP,0x14
00805101 : RET
00805102 : POP EBP
00805103 : XOR AL,AL
00805105 : POP EBX
00805106 : ADD ESP,0x14
00805109 : RET
