PROGRAM  : Maestia.exe
FUNCTION : FUN_005408a0
ENTRY    : 005408a0
BODY     : [[005408a0, 00540a58]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005408a0(undefined4 param_1,int *param_2,int param_3,int param_4,uint param_5)

{
  int iVar1;
  int iVar2;
  GRefCountImpl *this;
  short *psVar3;
  int *in_ECX;
  int iVar4;
  uint uVar5;
  int local_30;
  uint local_2c;
  GRefCountImpl *local_28;
  GRefCountImpl *local_18;
  int *local_10;
  uint local_c;
  int local_8;
  uint local_4;
  
  if (param_5 != 0) {
    FUN_00540620(param_1,*param_2 + param_3 * 2,param_4,param_5,0);
    FUN_0053ccd0(param_2 + 4,param_2,param_3);
    if (local_4 < *(uint *)(local_8 + 4)) {
      do {
        if (param_5 == 0) break;
        iVar2 = FUN_0053cdb0();
        iVar1 = *(int *)(iVar2 + 4);
        uVar5 = *(uint *)(iVar2 + 8);
        if (iVar1 < param_3) {
          iVar4 = 0;
          uVar5 = (uVar5 - param_3) + iVar1;
        }
        else {
          iVar4 = iVar1 - param_3;
        }
        if (param_5 <= uVar5) {
          uVar5 = param_5;
        }
        if (*(int *)(iVar2 + 0xc) != 0) {
          this = (GRefCountImpl *)FUN_00560f80(*(int *)(iVar2 + 0xc));
          local_30 = iVar4 + param_4;
          local_2c = uVar5;
          if (this != (GRefCountImpl *)0x0) {
            GRefCountImpl::AddRef(this);
          }
          local_28 = this;
          FUN_0053fa10(&local_30);
          if (local_28 != (GRefCountImpl *)0x0) {
            GRefCountImpl::Release(local_28);
          }
          if (this != (GRefCountImpl *)0x0) {
            GRefCountImpl::Release(this);
          }
        }
        param_5 = param_5 - uVar5;
        if (((int)local_c < 0) || ((uint)local_10[1] <= local_c)) {
          uVar5 = *(uint *)(local_8 + 4);
        }
        else {
          uVar5 = *(uint *)(*local_10 + local_c * 0xc);
          if ((uVar5 <= local_4) &&
             (uVar5 = local_4 + *(int *)(*local_10 + local_c * 0xc + 4), (int)local_c < local_10[1])
             ) {
            local_c = local_c + 1;
          }
        }
        local_4 = uVar5;
      } while (local_4 < *(uint *)(local_8 + 4));
    }
    uVar5 = in_ECX[1];
    if (uVar5 != 0) {
      iVar1 = *in_ECX;
      if ((iVar1 == 0) || (uVar5 <= uVar5 - 1)) {
        psVar3 = (short *)0x0;
      }
      else {
        psVar3 = (short *)(iVar1 + (uVar5 - 1) * 2);
      }
      if (*psVar3 == 0) {
        if ((uVar5 != 0) && (uVar5 != 0)) {
          if ((iVar1 == 0) || (uVar5 <= uVar5 - 1)) {
            psVar3 = (short *)0x0;
          }
          else {
            psVar3 = (short *)(iVar1 + (uVar5 - 1) * 2);
          }
          if (*psVar3 == 0) {
            uVar5 = uVar5 - 1;
          }
        }
        FUN_0053d280(uVar5,1);
        FUN_0053fde0(uVar5 + 1,1);
      }
    }
    *(short *)(in_ECX + 9) = (short)in_ECX[9] + 1;
    if (local_18 != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(local_18);
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005408a0 : SUB ESP,0x34
005408a3 : PUSH EBX
005408a4 : PUSH EDI
005408a5 : MOV EDI,dword ptr [ESP + 0x50]
005408a9 : MOV EBX,ECX
005408ab : MOV dword ptr [ESP + 0x8],EBX
005408af : TEST EDI,EDI
005408b1 : JBE 0x00540a51
005408b7 : MOV EAX,dword ptr [ESP + 0x4c]
005408bb : PUSH EBP
005408bc : MOV EBP,dword ptr [ESP + 0x4c]
005408c0 : PUSH ESI
005408c1 : MOV ESI,dword ptr [ESP + 0x4c]
005408c5 : MOV ECX,dword ptr [ESI]
005408c7 : PUSH 0x0
005408c9 : PUSH EDI
005408ca : PUSH EAX
005408cb : MOV EAX,dword ptr [ESP + 0x54]
005408cf : LEA EDX,[ECX + EBP*0x2]
005408d2 : PUSH EDX
005408d3 : PUSH EAX
005408d4 : MOV ECX,EBX
005408d6 : CALL 0x00540620
005408db : PUSH EBP
005408dc : PUSH ESI
005408dd : ADD ESI,0x10
005408e0 : PUSH ESI
005408e1 : LEA ECX,[ESP + 0x2c]
005408e5 : CALL 0x0053ccd0
005408ea : MOV ECX,dword ptr [ESP + 0x40]
005408ee : MOV EDX,dword ptr [ESP + 0x3c]
005408f2 : MOV dword ptr [ESP + 0x58],EDI
005408f6 : CMP ECX,dword ptr [EDX + 0x4]
005408f9 : JNC 0x005409e2
005408ff : JMP 0x00540905
00540901 : MOV EDI,dword ptr [ESP + 0x58]
00540905 : TEST EDI,EDI
00540907 : JBE 0x005409e2
0054090d : LEA ECX,[ESP + 0x20]
00540911 : CALL 0x0053cdb0
00540916 : MOV ECX,dword ptr [EAX + 0x4]
00540919 : CMP ECX,EBP
0054091b : MOV ESI,dword ptr [EAX + 0x8]
0054091e : JGE 0x00540928
00540920 : SUB ESI,EBP
00540922 : XOR EBX,EBX
00540924 : ADD ESI,ECX
00540926 : JMP 0x0054092c
00540928 : SUB ECX,EBP
0054092a : MOV EBX,ECX
0054092c : CMP ESI,EDI
0054092e : JC 0x00540932
00540930 : MOV ESI,EDI
00540932 : MOV EAX,dword ptr [EAX + 0xc]
00540935 : TEST EAX,EAX
00540937 : JZ 0x0054098b
00540939 : MOV ECX,dword ptr [ESP + 0x48]
0054093d : PUSH EAX
0054093e : CALL 0x00560f80
00540943 : MOV EDI,EAX
00540945 : MOV EAX,dword ptr [ESP + 0x54]
00540949 : ADD EBX,EAX
0054094b : MOV dword ptr [ESP + 0x14],EBX
0054094f : MOV dword ptr [ESP + 0x18],ESI
00540953 : TEST EDI,EDI
00540955 : JZ 0x0054095e
00540957 : MOV ECX,EDI
00540959 : CALL 0x00523dd0
0054095e : LEA ECX,[ESP + 0x14]
00540962 : PUSH ECX
00540963 : MOV ECX,dword ptr [ESP + 0x14]
00540967 : ADD ECX,0x10
0054096a : MOV dword ptr [ESP + 0x20],EDI
0054096e : CALL 0x0053fa10
00540973 : MOV ECX,dword ptr [ESP + 0x1c]
00540977 : TEST ECX,ECX
00540979 : JZ 0x00540980
0054097b : CALL 0x004ff7e0
00540980 : TEST EDI,EDI
00540982 : JZ 0x0054098b
00540984 : MOV ECX,EDI
00540986 : CALL 0x004ff7e0
0054098b : MOV EAX,dword ptr [ESP + 0x38]
0054098f : SUB dword ptr [ESP + 0x58],ESI
00540993 : MOV EBX,dword ptr [ESP + 0x3c]
00540997 : TEST EAX,EAX
00540999 : JL 0x005409ce
0054099b : MOV EDI,dword ptr [ESP + 0x34]
0054099f : CMP EAX,dword ptr [EDI + 0x4]
005409a2 : JNC 0x005409ce
005409a4 : MOV ECX,dword ptr [EDI]
005409a6 : LEA EDX,[EAX + EAX*0x2]
005409a9 : MOV ESI,dword ptr [ECX + EDX*0x4]
005409ac : LEA EDX,[ECX + EDX*0x4]
005409af : MOV ECX,dword ptr [ESP + 0x40]
005409b3 : CMP ECX,ESI
005409b5 : JNC 0x005409bb
005409b7 : MOV ECX,ESI
005409b9 : JMP 0x005409d1
005409bb : ADD ECX,dword ptr [EDX + 0x4]
005409be : MOV dword ptr [ESP + 0x40],ECX
005409c2 : CMP EAX,dword ptr [EDI + 0x4]
005409c5 : JGE 0x005409d5
005409c7 : INC EAX
005409c8 : MOV dword ptr [ESP + 0x38],EAX
005409cc : JMP 0x005409d5
005409ce : MOV ECX,dword ptr [EBX + 0x4]
005409d1 : MOV dword ptr [ESP + 0x40],ECX
005409d5 : CMP ECX,dword ptr [EBX + 0x4]
005409d8 : MOV EBX,dword ptr [ESP + 0x10]
005409dc : JC 0x00540901
005409e2 : MOV EAX,dword ptr [EBX + 0x4]
005409e5 : TEST EAX,EAX
005409e7 : JBE 0x00540a3e
005409e9 : MOV ECX,dword ptr [EBX]
005409eb : LEA EDX,[EAX + -0x1]
005409ee : TEST ECX,ECX
005409f0 : JZ 0x005409fb
005409f2 : CMP EDX,EAX
005409f4 : JNC 0x005409fb
005409f6 : LEA EDX,[ECX + EDX*0x2]
005409f9 : JMP 0x005409fd
005409fb : XOR EDX,EDX
005409fd : CMP word ptr [EDX],0x0
00540a01 : JNZ 0x00540a3e
00540a03 : MOV EDI,EAX
00540a05 : TEST EDI,EDI
00540a07 : JBE 0x00540a26
00540a09 : TEST EAX,EAX
00540a0b : JBE 0x00540a26
00540a0d : LEA EDX,[EAX + -0x1]
00540a10 : TEST ECX,ECX
00540a12 : JZ 0x00540a1d
00540a14 : CMP EDX,EAX
00540a16 : JNC 0x00540a1d
00540a18 : LEA EAX,[ECX + EDX*0x2]
00540a1b : JMP 0x00540a1f
00540a1d : XOR EAX,EAX
00540a1f : CMP word ptr [EAX],0x0
00540a23 : JNZ 0x00540a26
00540a25 : DEC EDI
00540a26 : PUSH 0x1
00540a28 : LEA ESI,[EBX + 0x10]
00540a2b : PUSH EDI
00540a2c : MOV ECX,ESI
00540a2e : CALL 0x0053d280
00540a33 : PUSH 0x1
00540a35 : INC EDI
00540a36 : PUSH EDI
00540a37 : MOV ECX,ESI
00540a39 : CALL 0x0053fde0
00540a3e : MOV ECX,dword ptr [ESP + 0x2c]
00540a42 : INC word ptr [EBX + 0x24]
00540a46 : POP ESI
00540a47 : POP EBP
00540a48 : TEST ECX,ECX
00540a4a : JZ 0x00540a51
00540a4c : CALL 0x004ff7e0
00540a51 : POP EDI
00540a52 : POP EBX
00540a53 : ADD ESP,0x34
00540a56 : RET 0x14
