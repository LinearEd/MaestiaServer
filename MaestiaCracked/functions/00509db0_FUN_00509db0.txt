PROGRAM  : Maestia.exe
FUNCTION : FUN_00509db0
ENTRY    : 00509db0
BODY     : [[00509db0, 0050a1a9]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00509db0(int param_1,int param_2,int *param_3,undefined4 param_4)

{
  undefined4 *puVar1;
  byte *pbVar2;
  GRefCountNTSImpl *this;
  bool bVar3;
  byte bVar4;
  int iVar5;
  undefined4 uVar6;
  GRefCountNTSImpl *this_00;
  undefined4 *in_ECX;
  byte bVar7;
  undefined4 uVar8;
  
  FUN_00522570(param_2,param_3,param_4);
  puVar1 = in_ECX + 0x1a;
  *in_ECX = &PTR_FUN_00b86978;
  in_ECX[3] = &PTR_LAB_00b8696c;
  *puVar1 = &PTR_LAB_00b86918;
  in_ECX[0x27] = param_1;
  in_ECX[0x28] = 0;
  (**(code **)(*param_3 + 0x5c))();
  iVar5 = FUN_00525450((*(uint *)(param_1 + 0x4c) & 0xfffffffc) + 8,
                       *(uint *)(*(uint *)(param_1 + 0x4c) & 0xfffffffc) & 0x7fffffff);
  in_ECX[0x2d] = iVar5;
  *(int *)(iVar5 + 8) = *(int *)(iVar5 + 8) + 1;
  *(undefined1 *)(in_ECX + 0x2e) = 0;
  FUN_0051c250();
  in_ECX[0x34] = 0;
  *(undefined1 *)(in_ECX + 0x35) = 1;
  FUN_00502ac0();
  in_ECX[0x3a] = 0;
  FUN_0051b6e0();
  FUN_0051b6e0();
  in_ECX[0x3b] = 0;
  iVar5 = *(int *)(param_2 + 0x1c);
  *(undefined2 *)(in_ECX + 0x32) = 0;
  in_ECX[0x29] = iVar5 + 0x18;
  in_ECX[0x2a] = *(undefined4 *)(param_1 + 0x54);
  if ((*(byte *)(param_1 + 0x50) >> 2 & 1) == 0) {
    *(undefined2 *)(in_ECX + 0x32) = 0;
  }
  else {
    *(undefined2 *)(in_ECX + 0x32) = 4;
  }
  if (*(char *)(param_1 + 0x50) < '\0') {
    *(ushort *)(in_ECX + 0x32) = *(ushort *)(in_ECX + 0x32) | 2;
  }
  else {
    *(ushort *)(in_ECX + 0x32) = *(ushort *)(in_ECX + 0x32) & 0xfffd;
  }
  in_ECX[0x39] = 0;
  *(ushort *)(in_ECX + 0x32) = *(ushort *)(in_ECX + 0x32) | 0x80;
  in_ECX[0x2b] = 0xffffff;
  in_ECX[0x2c] = 0;
  if ((*(byte *)(param_1 + 0x50) >> 6 & 1) != 0) {
    *(undefined1 *)((int)in_ECX + 0xaf) = 0xff;
    *(undefined1 *)((int)in_ECX + 0xb3) = 0xff;
  }
  (**(code **)(*param_3 + 0x40))();
  uVar8 = 10;
  uVar6 = FUN_0051cf30(10);
  FUN_0051d6a0(uVar6);
  iVar5 = FUN_00530980(uVar6,uVar8);
  if (iVar5 != 0) {
    *(uint *)(iVar5 + 8) = *(int *)(iVar5 + 8) + 1U & 0x8fffffff;
  }
  if (in_ECX[0x1b] != 0) {
    FUN_00503db0();
  }
  in_ECX[0x1b] = iVar5;
  iVar5 = (**(code **)(*param_3 + 0x5c))();
  FUN_0057b3c0(iVar5 + 0x78,puVar1);
  uVar6 = (**(code **)(*param_3 + 0x5c))(puVar1,puVar1);
  FUN_0057b450(uVar6);
  this_00 = (GRefCountNTSImpl *)FUN_00576750();
  if (this_00 != (GRefCountNTSImpl *)0x0) {
    *(int *)(this_00 + 4) = *(int *)(this_00 + 4) + 1;
  }
  iVar5 = FUN_00515840(0x144,0);
  if (iVar5 == 0) {
    iVar5 = 0;
  }
  else {
    uVar6 = FUN_0051ddb0();
    uVar8 = (**(code **)(*param_3 + 0x4c))(uVar6);
    iVar5 = FUN_0054c0d0(this_00,uVar8,uVar6);
  }
  if ((GRefCountNTSImpl *)in_ECX[0x28] != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release((GRefCountNTSImpl *)in_ECX[0x28]);
  }
  in_ECX[0x28] = iVar5;
  if (in_ECX + 0x36 != (undefined4 *)0x0) {
    in_ECX[0x37] = in_ECX[0x37] + 1;
  }
  this = *(GRefCountNTSImpl **)(iVar5 + 0x14);
  if (this != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release(this);
  }
  *(undefined4 **)(iVar5 + 0x14) = in_ECX + 0x36;
  pbVar2 = (byte *)(*(int *)(in_ECX[0x28] + 0xc) + 0x20);
  *pbVar2 = *pbVar2 | 2;
  FUN_00505280();
  if (0 < *(int *)(param_1 + 0x34)) {
    *(int *)(in_ECX[0x28] + 0x10c) = *(int *)(param_1 + 0x34);
  }
  FUN_00545a20(param_1 + 0x1c,1);
  if ((*(byte *)(param_1 + 0x51) & 1) != 0) {
    *(byte *)(in_ECX[0x28] + 0x141) = *(byte *)(in_ECX[0x28] + 0x141) | 0x20;
    *(byte *)(in_ECX[0x28] + 0x141) = *(byte *)(in_ECX[0x28] + 0x141) | 0x40;
  }
  if ((*(byte *)(param_1 + 0x50) >> 1 & 1) == 0) {
    pbVar2 = (byte *)(in_ECX[0x28] + 0x141);
    *pbVar2 = *pbVar2 & 0xfb;
  }
  else {
    pbVar2 = (byte *)(in_ECX[0x28] + 0x141);
    *pbVar2 = *pbVar2 | 4;
  }
  bVar4 = (byte)*(undefined2 *)(param_1 + 0x50);
  bVar7 = bVar4 >> 4 & 1;
  if ((bVar7 == 0) || (((*(byte *)(param_1 + 0x50) & 1) != 0 && ((bVar4 >> 1 & 1) != 0)))) {
    bVar3 = false;
  }
  else {
    bVar3 = true;
  }
  if (bVar3) {
    FUN_00544660();
  }
  if (bVar7 != 0) {
    FUN_00544680();
  }
  if ((*(byte *)(param_1 + 0x50) & 1) != 0) {
    FUN_005446a0();
  }
  if ((*(byte *)(in_ECX + 0x32) >> 2 & 1) != 0) {
    *(byte *)(in_ECX[0x28] + 0x141) = *(byte *)(in_ECX[0x28] + 0x141) | 0x10;
  }
  if ((*(ushort *)(in_ECX[0x27] + 0x50) >> 10 & 1) != 0) {
    *(byte *)(in_ECX[0x28] + 0x141) = *(byte *)(in_ECX[0x28] + 0x141) | 0x40;
  }
  if (*(int *)(in_ECX[0x28] + 0x118) == 0) {
    bVar4 = *(byte *)(in_ECX[0x27] + 0x50) >> 3;
  }
  else {
    bVar4 = *(byte *)(*(int *)(in_ECX[0x28] + 0x118) + 0x68);
  }
  if (((bVar4 & 1) == 0) || ((*(byte *)(in_ECX[0x27] + 0x50) >> 5 & 1) != 0)) {
    FUN_00500a00();
  }
  if (this_00 != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release(this_00);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00509db0 : PUSH ECX
00509db1 : MOV EAX,dword ptr [ESP + 0x14]
00509db5 : PUSH EBX
00509db6 : PUSH EBP
00509db7 : PUSH ESI
00509db8 : PUSH EDI
00509db9 : MOV EDI,dword ptr [ESP + 0x20]
00509dbd : PUSH ECX
00509dbe : MOV ESI,ECX
00509dc0 : MOV ECX,ESP
00509dc2 : MOV dword ptr [ECX],EAX
00509dc4 : MOV dword ptr [ESP + 0x14],EAX
00509dc8 : MOV EAX,dword ptr [ESP + 0x20]
00509dcc : PUSH EDI
00509dcd : PUSH EAX
00509dce : MOV ECX,ESI
00509dd0 : CALL 0x00522570
00509dd5 : MOV EBP,dword ptr [ESP + 0x18]
00509dd9 : LEA EBX,[ESI + 0x68]
00509ddc : MOV dword ptr [ESI],0xb86978
00509de2 : MOV dword ptr [ESI + 0xc],0xb8696c
00509de9 : MOV dword ptr [EBX],0xb86918
00509def : MOV dword ptr [ESI + 0x9c],EBP
00509df5 : MOV dword ptr [ESI + 0xa0],0x0
00509dff : MOV EDX,dword ptr [EDI]
00509e01 : MOV EAX,dword ptr [EDX + 0x5c]
00509e04 : MOV ECX,EDI
00509e06 : CALL EAX
00509e08 : MOV EDX,dword ptr [EAX + 0x78]
00509e0b : MOV EAX,dword ptr [EBP + 0x4c]
00509e0e : MOV ECX,EAX
00509e10 : AND ECX,0xfffffffc
00509e13 : MOV ECX,dword ptr [ECX]
00509e15 : AND ECX,0x7fffffff
00509e1b : AND EAX,0xfffffffc
00509e1e : PUSH ECX
00509e1f : ADD EAX,0x8
00509e22 : PUSH EAX
00509e23 : LEA ECX,[EDX + 0x254]
00509e29 : CALL 0x00525450
00509e2e : MOV dword ptr [ESI + 0xb4],EAX
00509e34 : INC dword ptr [EAX + 0x8]
00509e37 : LEA ECX,[ESI + 0xcc]
00509e3d : MOV byte ptr [ESI + 0xb8],0x0
00509e44 : CALL 0x0051c250
00509e49 : LEA ECX,[ESI + 0xd8]
00509e4f : MOV dword ptr [ESI + 0xd0],0x0
00509e59 : MOV byte ptr [ESI + 0xd4],0x1
00509e60 : CALL 0x00502ac0
00509e65 : LEA ECX,[ESI + 0xf0]
00509e6b : MOV dword ptr [ESI + 0xe8],0x0
00509e75 : CALL 0x0051b6e0
00509e7a : LEA ECX,[ESI + 0xf4]
00509e80 : CALL 0x0051b6e0
00509e85 : MOV EDX,dword ptr [ESP + 0x1c]
00509e89 : XOR EAX,EAX
00509e8b : MOV dword ptr [ESI + 0xec],EAX
00509e91 : MOV ECX,dword ptr [EDX + 0x1c]
00509e94 : XOR EDX,EDX
00509e96 : ADD ECX,0x18
00509e99 : MOV word ptr [ESI + 0xc8],DX
00509ea0 : MOV dword ptr [ESI + 0xa4],ECX
00509ea6 : MOV ECX,dword ptr [EBP + 0x54]
00509ea9 : MOV dword ptr [ESI + 0xa8],ECX
00509eaf : MOV DL,byte ptr [EBP + 0x50]
00509eb2 : SHR DL,0x2
00509eb5 : TEST DL,0x1
00509eb8 : JZ 0x00509ec8
00509eba : MOV ECX,0x4
00509ebf : MOV word ptr [ESI + 0xc8],CX
00509ec6 : JMP 0x00509ed1
00509ec8 : XOR EDX,EDX
00509eca : MOV word ptr [ESI + 0xc8],DX
00509ed1 : MOV CL,byte ptr [EBP + 0x50]
00509ed4 : SHR CL,0x7
00509ed7 : TEST CL,0x1
00509eda : JZ 0x00509ee6
00509edc : OR word ptr [ESI + 0xc8],0x2
00509ee4 : JMP 0x00509ef2
00509ee6 : MOV EDX,0xfffd
00509eeb : AND word ptr [ESI + 0xc8],DX
00509ef2 : MOV dword ptr [ESI + 0xe4],EAX
00509ef8 : MOV AL,0xff
00509efa : MOV byte ptr [ESP + 0x1e],AL
00509efe : MOV byte ptr [ESP + 0x1d],AL
00509f02 : MOV byte ptr [ESP + 0x1c],AL
00509f06 : MOV byte ptr [ESP + 0x1f],0x0
00509f0b : MOV EDX,dword ptr [ESP + 0x1c]
00509f0f : MOV ECX,0x80
00509f14 : OR word ptr [ESI + 0xc8],CX
00509f1b : MOV byte ptr [ESP + 0x1e],0x0
00509f20 : MOV byte ptr [ESP + 0x1d],0x0
00509f25 : MOV byte ptr [ESP + 0x1c],0x0
00509f2a : MOV byte ptr [ESP + 0x1f],0x0
00509f2f : MOV ECX,dword ptr [ESP + 0x1c]
00509f33 : MOV dword ptr [ESI + 0xac],EDX
00509f39 : MOV dword ptr [ESI + 0xb0],ECX
00509f3f : MOV DL,byte ptr [EBP + 0x50]
00509f42 : SHR DL,0x6
00509f45 : TEST DL,0x1
00509f48 : JZ 0x00509f56
00509f4a : MOV byte ptr [ESI + 0xaf],AL
00509f50 : MOV byte ptr [ESI + 0xb3],AL
00509f56 : MOV EAX,dword ptr [EDI]
00509f58 : MOV EDX,dword ptr [EAX + 0x40]
00509f5b : MOV ECX,EDI
00509f5d : CALL EDX
00509f5f : PUSH 0xa
00509f61 : MOV ECX,ESI
00509f63 : MOV dword ptr [ESP + 0x20],EAX
00509f67 : CALL 0x0051cf30
00509f6c : PUSH EAX
00509f6d : MOV ECX,ESI
00509f6f : CALL 0x0051d6a0
00509f74 : MOV ECX,EAX
00509f76 : CALL 0x00530980
00509f7b : MOV dword ptr [ESP + 0x20],EAX
00509f7f : TEST EAX,EAX
00509f81 : JZ 0x00509f90
00509f83 : MOV ECX,dword ptr [EAX + 0x8]
00509f86 : INC ECX
00509f87 : AND ECX,0x8fffffff
00509f8d : MOV dword ptr [EAX + 0x8],ECX
00509f90 : MOV ECX,dword ptr [ESI + 0x6c]
00509f93 : TEST ECX,ECX
00509f95 : JZ 0x00509fa0
00509f97 : CALL 0x00503db0
00509f9c : MOV EAX,dword ptr [ESP + 0x20]
00509fa0 : MOV dword ptr [ESI + 0x6c],EAX
00509fa3 : MOV EDX,dword ptr [EDI]
00509fa5 : MOV EAX,dword ptr [EDX + 0x5c]
00509fa8 : MOV ECX,EDI
00509faa : CALL EAX
00509fac : ADD EAX,0x78
00509faf : PUSH EBX
00509fb0 : PUSH EAX
00509fb1 : CALL 0x0057b3c0
00509fb6 : MOV EDX,dword ptr [EDI]
00509fb8 : MOV EAX,dword ptr [EDX + 0x5c]
00509fbb : ADD ESP,0x8
00509fbe : PUSH EBX
00509fbf : PUSH EBX
00509fc0 : MOV ECX,EDI
00509fc2 : CALL EAX
00509fc4 : PUSH EAX
00509fc5 : CALL 0x0057b450
00509fca : MOV ECX,dword ptr [ESP + 0x28]
00509fce : ADD ESP,0xc
00509fd1 : CALL 0x00576750
00509fd6 : MOV EBX,EAX
00509fd8 : MOV dword ptr [ESP + 0x20],EBX
00509fdc : TEST EBX,EBX
00509fde : JZ 0x00509fe3
00509fe0 : INC dword ptr [EBX + 0x4]
00509fe3 : MOV ECX,dword ptr [ESP + 0x1c]
00509fe7 : MOV ECX,dword ptr [ECX + 0x14]
00509fea : PUSH 0x0
00509fec : PUSH 0x144
00509ff1 : CALL 0x00515840
00509ff6 : MOV dword ptr [ESP + 0x1c],EAX
00509ffa : TEST EAX,EAX
00509ffc : JZ 0x0050a01e
00509ffe : MOV ECX,ESI
0050a000 : CALL 0x0051ddb0
0050a005 : MOV EDX,dword ptr [EDI]
0050a007 : PUSH EAX
0050a008 : MOV EAX,dword ptr [EDX + 0x4c]
0050a00b : MOV ECX,EDI
0050a00d : CALL EAX
0050a00f : MOV ECX,dword ptr [ESP + 0x20]
0050a013 : PUSH EAX
0050a014 : PUSH EBX
0050a015 : CALL 0x0054c0d0
0050a01a : MOV EDI,EAX
0050a01c : JMP 0x0050a020
0050a01e : XOR EDI,EDI
0050a020 : MOV ECX,dword ptr [ESI + 0xa0]
0050a026 : TEST ECX,ECX
0050a028 : JZ 0x0050a02f
0050a02a : CALL 0x004ff7c0
0050a02f : MOV dword ptr [ESI + 0xa0],EDI
0050a035 : LEA EBX,[ESI + 0xd8]
0050a03b : ADD EDI,0x14
0050a03e : TEST EBX,EBX
0050a040 : JZ 0x0050a045
0050a042 : INC dword ptr [EBX + 0x4]
0050a045 : MOV ECX,dword ptr [EDI]
0050a047 : TEST ECX,ECX
0050a049 : JZ 0x0050a050
0050a04b : CALL 0x004ff7c0
0050a050 : MOV dword ptr [EDI],EBX
0050a052 : MOV ECX,dword ptr [ESI + 0xa0]
0050a058 : MOV EAX,dword ptr [ECX + 0xc]
0050a05b : OR byte ptr [EAX + 0x20],0x2
0050a05f : MOV ECX,ESI
0050a061 : CALL 0x00505280
0050a066 : MOV EAX,dword ptr [EBP + 0x34]
0050a069 : TEST EAX,EAX
0050a06b : JLE 0x0050a079
0050a06d : MOV EDX,dword ptr [ESI + 0xa0]
0050a073 : MOV dword ptr [EDX + 0x10c],EAX
0050a079 : MOV ECX,dword ptr [ESI + 0xa0]
0050a07f : PUSH 0x1
0050a081 : LEA EAX,[EBP + 0x1c]
0050a084 : PUSH EAX
0050a085 : CALL 0x00545a20
0050a08a : TEST byte ptr [EBP + 0x51],0x1
0050a08e : JZ 0x0050a0aa
0050a090 : MOV EAX,dword ptr [ESI + 0xa0]
0050a096 : OR byte ptr [EAX + 0x141],0x20
0050a09d : MOV EAX,dword ptr [ESI + 0xa0]
0050a0a3 : OR byte ptr [EAX + 0x141],0x40
0050a0aa : MOV CL,byte ptr [EBP + 0x50]
0050a0ad : MOV EAX,dword ptr [ESI + 0xa0]
0050a0b3 : SHR CL,0x1
0050a0b5 : TEST CL,0x1
0050a0b8 : JZ 0x0050a0c3
0050a0ba : OR byte ptr [EAX + 0x141],0x4
0050a0c1 : JMP 0x0050a0ca
0050a0c3 : AND byte ptr [EAX + 0x141],0xfb
0050a0ca : MOVZX EAX,word ptr [EBP + 0x50]
0050a0ce : MOV BL,AL
0050a0d0 : SHR BL,0x4
0050a0d3 : AND BL,0x1
0050a0d6 : JZ 0x0050a0e8
0050a0d8 : TEST byte ptr [EBP + 0x50],0x1
0050a0dc : JZ 0x0050a0e4
0050a0de : SHR AL,0x1
0050a0e0 : TEST AL,0x1
0050a0e2 : JNZ 0x0050a0e8
0050a0e4 : MOV AL,0x1
0050a0e6 : JMP 0x0050a0ea
0050a0e8 : XOR AL,AL
0050a0ea : TEST AL,AL
0050a0ec : JZ 0x0050a0f9
0050a0ee : MOV ECX,dword ptr [ESI + 0xa0]
0050a0f4 : CALL 0x00544660
0050a0f9 : TEST BL,BL
0050a0fb : JZ 0x0050a108
0050a0fd : MOV ECX,dword ptr [ESI + 0xa0]
0050a103 : CALL 0x00544680
0050a108 : TEST byte ptr [EBP + 0x50],0x1
0050a10c : JZ 0x0050a119
0050a10e : MOV ECX,dword ptr [ESI + 0xa0]
0050a114 : CALL 0x005446a0
0050a119 : MOV DL,byte ptr [ESI + 0xc8]
0050a11f : SHR DL,0x2
0050a122 : TEST DL,0x1
0050a125 : JZ 0x0050a134
0050a127 : MOV EAX,dword ptr [ESI + 0xa0]
0050a12d : OR byte ptr [EAX + 0x141],0x10
0050a134 : MOV EAX,dword ptr [ESI + 0x9c]
0050a13a : MOV CX,word ptr [EAX + 0x50]
0050a13e : SHR CX,0xa
0050a142 : TEST CL,0x1
0050a145 : JZ 0x0050a154
0050a147 : MOV EAX,dword ptr [ESI + 0xa0]
0050a14d : OR byte ptr [EAX + 0x141],0x40
0050a154 : MOV EDX,dword ptr [ESI + 0xa0]
0050a15a : MOV EAX,dword ptr [EDX + 0x118]
0050a160 : TEST EAX,EAX
0050a162 : JZ 0x0050a169
0050a164 : MOV AL,byte ptr [EAX + 0x68]
0050a167 : JMP 0x0050a175
0050a169 : MOV EAX,dword ptr [ESI + 0x9c]
0050a16f : MOV AL,byte ptr [EAX + 0x50]
0050a172 : SHR AL,0x3
0050a175 : AND AL,0x1
0050a177 : TEST AL,AL
0050a179 : JZ 0x0050a18c
0050a17b : MOV ECX,dword ptr [ESI + 0x9c]
0050a181 : MOV DL,byte ptr [ECX + 0x50]
0050a184 : SHR DL,0x5
0050a187 : TEST DL,0x1
0050a18a : JZ 0x0050a193
0050a18c : MOV ECX,ESI
0050a18e : CALL 0x00500a00
0050a193 : MOV ECX,dword ptr [ESP + 0x20]
0050a197 : TEST ECX,ECX
0050a199 : JZ 0x0050a1a0
0050a19b : CALL 0x004ff7c0
0050a1a0 : POP EDI
0050a1a1 : MOV EAX,ESI
0050a1a3 : POP ESI
0050a1a4 : POP EBP
0050a1a5 : POP EBX
0050a1a6 : POP ECX
0050a1a7 : RET 0x10
