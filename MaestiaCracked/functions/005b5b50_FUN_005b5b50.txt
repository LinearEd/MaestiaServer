PROGRAM  : Maestia.exe
FUNCTION : FUN_005b5b50
ENTRY    : 005b5b50
BODY     : [[005b5b50, 005b5d6a]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_005b5b50(int param_1,int param_2)

{
  byte bVar1;
  undefined2 uVar2;
  uint uVar3;
  int iVar4;
  int iVar5;
  int *in_ECX;
  GThread *this;
  GThread *extraout_ECX;
  GThread *extraout_ECX_00;
  GThread *extraout_ECX_01;
  GThread *extraout_ECX_02;
  GThread *this_00;
  GThread *this_01;
  GThread *extraout_ECX_03;
  GThread *this_02;
  GThread *extraout_ECX_04;
  GThread *pGVar6;
  undefined1 *puVar7;
  int iVar8;
  char *pcVar9;
  undefined1 local_30 [48];
  
  iVar4 = *(int *)(param_1 + 0x314);
  if (iVar4 == 0) {
    iVar4 = param_1 + 0x28;
  }
  *(undefined1 *)(iVar4 + 0x15) = 0;
  if (*(int *)(iVar4 + 0x30) - *(int *)(iVar4 + 0x2c) < 1) {
    FUN_0053a0a0();
  }
  bVar1 = *(byte *)(*(int *)(iVar4 + 0x2c) + *(int *)(iVar4 + 0x3c));
  *(int *)(iVar4 + 0x2c) = *(int *)(iVar4 + 0x2c) + 1;
  if (bVar1 == 0) {
    return 0;
  }
  iVar8 = *(int *)(param_1 + 0x314);
  if (iVar8 == 0) {
    iVar8 = param_1 + 0x28;
  }
  GThread::OnExit((GThread *)CONCAT31((int3)((uint)*(int *)(iVar4 + 0x3c) >> 8),bVar1));
  *(undefined1 *)(in_ECX + 0x12) = 0;
  pGVar6 = this;
  if ((bVar1 & 8) != 0) {
    *(undefined1 *)(in_ECX + 0x12) = 1;
    GThread::OnExit(this);
    pGVar6 = extraout_ECX;
  }
  if ((bVar1 & 4) != 0) {
    *(byte *)(in_ECX + 0x12) = *(byte *)(in_ECX + 0x12) | 2;
    GThread::OnExit(pGVar6);
    pGVar6 = extraout_ECX_00;
  }
  if ((bVar1 & 2) != 0) {
    *(byte *)(in_ECX + 0x12) = *(byte *)(in_ECX + 0x12) | 4;
    GThread::OnExit(pGVar6);
    pGVar6 = extraout_ECX_01;
  }
  if ((bVar1 & 1) != 0) {
    *(byte *)(in_ECX + 0x12) = *(byte *)(in_ECX + 0x12) | 8;
    GThread::OnExit(pGVar6);
    pGVar6 = extraout_ECX_02;
  }
  GThread::OnExit(pGVar6);
  uVar3 = FUN_00500140();
  in_ECX[0xf] = uVar3 & 0xffff;
  uVar2 = FUN_00500140();
  *(undefined2 *)(in_ECX + 0x10) = uVar2;
  FUN_0053acd0(in_ECX + 1);
  GThread::OnExit(this_00);
  GThread::OnExit(this_01);
  pGVar6 = extraout_ECX_03;
  if (param_2 == 0x22) {
    FUN_0053ae40(in_ECX + 7);
    GThread::OnExit(this_02);
    pGVar6 = extraout_ECX_04;
  }
  if ((bVar1 & 0x10) != 0) {
    pcVar9 = "   HasFilters\n";
    iVar4 = iVar8;
    GThread::OnExit(pGVar6);
    iVar4 = FUN_0059d360(iVar8,local_30,4,iVar4,pcVar9);
    if (iVar4 != 0) {
      if (*in_ECX == 0) {
        iVar5 = FUN_00515840(0x1c,0);
        if (iVar5 == 0) {
          iVar5 = 0;
        }
        else {
          iVar5 = FUN_0050b5a0();
        }
        if ((GRefCountNTSImpl *)*in_ECX != (GRefCountNTSImpl *)0x0) {
          GRefCountNTSImpl::Release((GRefCountNTSImpl *)*in_ECX);
        }
        *in_ECX = iVar5;
      }
      if (iVar4 != 0) {
        puVar7 = local_30;
        do {
          FUN_0059d2e0(puVar7);
          puVar7 = puVar7 + 0xc;
          iVar4 = iVar4 + -1;
        } while (iVar4 != 0);
      }
    }
  }
  if ((bVar1 & 0x20) == 0) {
    in_ECX[0x11] = 0;
    return 1;
  }
  *(undefined1 *)(iVar8 + 0x15) = 0;
  if (*(int *)(iVar8 + 0x30) - *(int *)(iVar8 + 0x2c) < 1) {
    FUN_0053a0a0();
  }
  bVar1 = *(byte *)(*(int *)(iVar8 + 0x2c) + *(int *)(iVar8 + 0x3c));
  pGVar6 = (GThread *)(*(int *)(iVar8 + 0x2c) + 1);
  *(GThread **)(iVar8 + 0x2c) = pGVar6;
  if ((bVar1 == 0) || (0xe < bVar1)) {
    bVar1 = 1;
  }
  in_ECX[0x11] = (uint)bVar1;
  GThread::OnExit(pGVar6);
  return 1;
}



============================================================
DISASSEMBLY
============================================================
005b5b50 : SUB ESP,0x34
005b5b53 : PUSH EBX
005b5b54 : PUSH EBP
005b5b55 : MOV EBP,dword ptr [ESP + 0x40]
005b5b59 : PUSH ESI
005b5b5a : MOV ESI,dword ptr [EBP + 0x314]
005b5b60 : PUSH EDI
005b5b61 : MOV EDI,ECX
005b5b63 : TEST ESI,ESI
005b5b65 : JNZ 0x005b5b6a
005b5b67 : LEA ESI,[EBP + 0x28]
005b5b6a : MOV EAX,dword ptr [ESI + 0x30]
005b5b6d : SUB EAX,dword ptr [ESI + 0x2c]
005b5b70 : MOV byte ptr [ESI + 0x15],0x0
005b5b74 : CMP EAX,0x1
005b5b77 : JGE 0x005b5b80
005b5b79 : MOV ECX,ESI
005b5b7b : CALL 0x0053a0a0
005b5b80 : MOV EAX,dword ptr [ESI + 0x2c]
005b5b83 : MOV ECX,dword ptr [ESI + 0x3c]
005b5b86 : MOV CL,byte ptr [EAX + ECX*0x1]
005b5b89 : MOVZX EBX,CL
005b5b8c : INC EAX
005b5b8d : MOV dword ptr [ESI + 0x2c],EAX
005b5b90 : MOV dword ptr [ESP + 0x10],EBX
005b5b94 : TEST EBX,EBX
005b5b96 : JNZ 0x005b5ba4
005b5b98 : POP EDI
005b5b99 : POP ESI
005b5b9a : POP EBP
005b5b9b : XOR AL,AL
005b5b9d : POP EBX
005b5b9e : ADD ESP,0x34
005b5ba1 : RET 0x8
005b5ba4 : MOV ESI,dword ptr [EBP + 0x314]
005b5baa : TEST ESI,ESI
005b5bac : JNZ 0x005b5bb1
005b5bae : LEA ESI,[EBP + 0x28]
005b5bb1 : PUSH 0xb9062c
005b5bb6 : PUSH ESI
005b5bb7 : CALL 0x0051d420
005b5bbc : ADD ESP,0x8
005b5bbf : MOV byte ptr [EDI + 0x48],0x0
005b5bc3 : TEST BL,0x8
005b5bc6 : JZ 0x005b5bda
005b5bc8 : PUSH 0xb90620
005b5bcd : PUSH ESI
005b5bce : MOV byte ptr [EDI + 0x48],0x1
005b5bd2 : CALL 0x0051d420
005b5bd7 : ADD ESP,0x8
005b5bda : TEST BL,0x4
005b5bdd : JZ 0x005b5bf1
005b5bdf : OR byte ptr [EDI + 0x48],0x2
005b5be3 : PUSH 0xb90618
005b5be8 : PUSH ESI
005b5be9 : CALL 0x0051d420
005b5bee : ADD ESP,0x8
005b5bf1 : TEST BL,0x2
005b5bf4 : JZ 0x005b5c08
005b5bf6 : OR byte ptr [EDI + 0x48],0x4
005b5bfa : PUSH 0xb90610
005b5bff : PUSH ESI
005b5c00 : CALL 0x0051d420
005b5c05 : ADD ESP,0x8
005b5c08 : TEST BL,0x1
005b5c0b : JZ 0x005b5c1f
005b5c0d : OR byte ptr [EDI + 0x48],0x8
005b5c11 : PUSH 0xb9060c
005b5c16 : PUSH ESI
005b5c17 : CALL 0x0051d420
005b5c1c : ADD ESP,0x8
005b5c1f : PUSH 0xb8b8fc
005b5c24 : PUSH ESI
005b5c25 : CALL 0x0051d420
005b5c2a : ADD ESP,0x8
005b5c2d : MOV ECX,EBP
005b5c2f : CALL 0x00500140
005b5c34 : MOV ECX,dword ptr [ESP + 0x48]
005b5c38 : MOVZX EBP,AX
005b5c3b : MOV dword ptr [EDI + 0x3c],EBP
005b5c3e : CALL 0x00500140
005b5c43 : LEA EDX,[EDI + 0x4]
005b5c46 : PUSH EDX
005b5c47 : MOV ECX,ESI
005b5c49 : MOV word ptr [EDI + 0x40],AX
005b5c4d : CALL 0x0053acd0
005b5c52 : MOVZX EAX,word ptr [EDI + 0x40]
005b5c56 : PUSH EAX
005b5c57 : PUSH EBP
005b5c58 : PUSH 0xb905e8
005b5c5d : PUSH ESI
005b5c5e : CALL 0x0051d420
005b5c63 : PUSH 0xb905dc
005b5c68 : PUSH ESI
005b5c69 : CALL 0x0051d420
005b5c6e : ADD ESP,0x18
005b5c71 : CMP dword ptr [ESP + 0x4c],0x22
005b5c76 : JNZ 0x005b5c91
005b5c78 : LEA ECX,[EDI + 0x1c]
005b5c7b : PUSH ECX
005b5c7c : MOV ECX,ESI
005b5c7e : CALL 0x0053ae40
005b5c83 : PUSH 0xb905d0
005b5c88 : PUSH ESI
005b5c89 : CALL 0x0051d420
005b5c8e : ADD ESP,0x8
005b5c91 : TEST BL,0x10
005b5c94 : JZ 0x005b5d05
005b5c96 : PUSH 0xb905c0
005b5c9b : PUSH ESI
005b5c9c : CALL 0x0051d420
005b5ca1 : PUSH 0x4
005b5ca3 : LEA EDX,[ESP + 0x20]
005b5ca7 : PUSH EDX
005b5ca8 : PUSH ESI
005b5ca9 : CALL 0x0059d360
005b5cae : MOV EBX,EAX
005b5cb0 : ADD ESP,0x14
005b5cb3 : TEST EBX,EBX
005b5cb5 : JZ 0x005b5d01
005b5cb7 : CMP dword ptr [EDI],0x0
005b5cba : JNZ 0x005b5ce9
005b5cbc : MOV ECX,dword ptr [0x00d73250]
005b5cc2 : PUSH 0x0
005b5cc4 : PUSH 0x1c
005b5cc6 : CALL 0x00515840
005b5ccb : TEST EAX,EAX
005b5ccd : JZ 0x005b5cda
005b5ccf : MOV ECX,EAX
005b5cd1 : CALL 0x0050b5a0
005b5cd6 : MOV EBP,EAX
005b5cd8 : JMP 0x005b5cdc
005b5cda : XOR EBP,EBP
005b5cdc : MOV ECX,dword ptr [EDI]
005b5cde : TEST ECX,ECX
005b5ce0 : JZ 0x005b5ce7
005b5ce2 : CALL 0x004ff7c0
005b5ce7 : MOV dword ptr [EDI],EBP
005b5ce9 : TEST EBX,EBX
005b5ceb : JBE 0x005b5d01
005b5ced : LEA EBP,[ESP + 0x14]
005b5cf1 : MOV ECX,dword ptr [EDI]
005b5cf3 : PUSH EBP
005b5cf4 : CALL 0x0059d2e0
005b5cf9 : ADD EBP,0xc
005b5cfc : SUB EBX,0x1
005b5cff : JNZ 0x005b5cf1
005b5d01 : MOV EBX,dword ptr [ESP + 0x10]
005b5d05 : TEST BL,0x20
005b5d08 : JZ 0x005b5d58
005b5d0a : MOV EAX,dword ptr [ESI + 0x30]
005b5d0d : SUB EAX,dword ptr [ESI + 0x2c]
005b5d10 : MOV byte ptr [ESI + 0x15],0x0
005b5d14 : CMP EAX,0x1
005b5d17 : JGE 0x005b5d20
005b5d19 : MOV ECX,ESI
005b5d1b : CALL 0x0053a0a0
005b5d20 : MOV ECX,dword ptr [ESI + 0x2c]
005b5d23 : MOV EDX,dword ptr [ESI + 0x3c]
005b5d26 : MOV AL,byte ptr [ECX + EDX*0x1]
005b5d29 : INC ECX
005b5d2a : MOV dword ptr [ESI + 0x2c],ECX
005b5d2d : CMP AL,0x1
005b5d2f : JC 0x005b5d35
005b5d31 : CMP AL,0xe
005b5d33 : JBE 0x005b5d37
005b5d35 : MOV AL,0x1
005b5d37 : MOVZX EAX,AL
005b5d3a : PUSH EAX
005b5d3b : PUSH 0xb905ac
005b5d40 : PUSH ESI
005b5d41 : MOV dword ptr [EDI + 0x44],EAX
005b5d44 : CALL 0x0051d420
005b5d49 : ADD ESP,0xc
005b5d4c : POP EDI
005b5d4d : POP ESI
005b5d4e : POP EBP
005b5d4f : MOV AL,0x1
005b5d51 : POP EBX
005b5d52 : ADD ESP,0x34
005b5d55 : RET 0x8
005b5d58 : MOV dword ptr [EDI + 0x44],0x0
005b5d5f : POP EDI
005b5d60 : POP ESI
005b5d61 : POP EBP
005b5d62 : MOV AL,0x1
005b5d64 : POP EBX
005b5d65 : ADD ESP,0x34
005b5d68 : RET 0x8
