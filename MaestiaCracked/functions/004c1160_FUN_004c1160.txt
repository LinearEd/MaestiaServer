PROGRAM  : Maestia.exe
FUNCTION : FUN_004c1160
ENTRY    : 004c1160
BODY     : [[004c1160, 004c12bc]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_004c1160(void)

{
  void *pvVar1;
  rsize_t _DstSize;
  uint uVar2;
  undefined4 *_Dst;
  int iVar3;
  int iVar4;
  uint uVar5;
  int unaff_ESI;
  undefined4 *puVar6;
  undefined4 *puVar7;
  uint local_8;
  
  uVar2 = *(uint *)(unaff_ESI + 0x14);
  local_8 = 1;
  if (uVar2 == 0xfffffff) {
    uVar2 = FUN_00476830();
  }
  uVar5 = uVar2 >> 1;
  if (uVar5 < 8) {
    uVar5 = 8;
  }
  else if (uVar5 < 2) goto LAB_004c11a6;
  if (uVar2 <= 0xfffffff - uVar5) {
    local_8 = uVar5;
  }
LAB_004c11a6:
  uVar2 = *(uint *)(unaff_ESI + 0x18) >> 2;
  _Dst = (undefined4 *)FUN_004c1790();
  iVar4 = uVar2 * 4;
  pvVar1 = (void *)(*(int *)(unaff_ESI + 0x10) + iVar4);
  iVar3 = (*(int *)(unaff_ESI + 0x14) * 4 - (int)pvVar1) + *(int *)(unaff_ESI + 0x10) >> 2;
  puVar7 = _Dst + uVar2 + iVar3;
  if (iVar3 != 0) {
    _memmove_s(_Dst + uVar2,iVar3 * 4,pvVar1,iVar3 * 4);
  }
  if (local_8 < uVar2) {
    iVar3 = (int)(local_8 * 4) >> 2;
    if (iVar3 != 0) {
      _DstSize = iVar3 * 4;
      _memmove_s(puVar7,_DstSize,*(void **)(unaff_ESI + 0x10),_DstSize);
    }
    pvVar1 = (void *)(local_8 * 4 + *(int *)(unaff_ESI + 0x10));
    iVar4 = (*(int *)(unaff_ESI + 0x10) - (int)pvVar1) + iVar4 >> 2;
    puVar7 = _Dst + iVar4;
    uVar2 = local_8;
    if (iVar4 != 0) {
      _memmove_s(_Dst,iVar4 * 4,pvVar1,iVar4 * 4);
    }
  }
  else {
    iVar4 = iVar4 >> 2;
    puVar6 = puVar7 + iVar4;
    if (iVar4 != 0) {
      _memmove_s(puVar7,iVar4 * 4,*(void **)(unaff_ESI + 0x10),iVar4 * 4);
    }
    iVar4 = local_8 - uVar2;
    puVar7 = _Dst;
    if (iVar4 != 0) {
      for (; iVar4 != 0; iVar4 = iVar4 + -1) {
        *puVar6 = 0;
        puVar6 = puVar6 + 1;
      }
    }
  }
  if (uVar2 != 0) {
    for (; uVar2 != 0; uVar2 = uVar2 - 1) {
      *puVar7 = 0;
      puVar7 = puVar7 + 1;
    }
  }
  if (*(int *)(unaff_ESI + 0x10) == 0) {
    *(int *)(unaff_ESI + 0x14) = *(int *)(unaff_ESI + 0x14) + local_8;
    *(undefined4 **)(unaff_ESI + 0x10) = _Dst;
    return;
  }
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
004c1160 : PUSH EBP
004c1161 : MOV EBP,ESP
004c1163 : SUB ESP,0x10
004c1166 : MOV EAX,dword ptr [ESI + 0x14]
004c1169 : MOV ECX,0xfffffff
004c116e : SUB ECX,EAX
004c1170 : PUSH EBX
004c1171 : PUSH EDI
004c1172 : MOV dword ptr [EBP + -0x4],0x1
004c1179 : CMP ECX,0x1
004c117c : JNC 0x004c1183
004c117e : CALL 0x00476830
004c1183 : MOV ECX,EAX
004c1185 : SHR ECX,0x1
004c1187 : CMP ECX,0x8
004c118a : JNC 0x004c1193
004c118c : MOV ECX,0x8
004c1191 : JMP 0x004c1198
004c1193 : CMP ECX,0x1
004c1196 : JBE 0x004c11a6
004c1198 : MOV EDX,0xfffffff
004c119d : SUB EDX,ECX
004c119f : CMP EAX,EDX
004c11a1 : JA 0x004c11a6
004c11a3 : MOV dword ptr [EBP + -0x4],ECX
004c11a6 : MOV EBX,dword ptr [ESI + 0x18]
004c11a9 : MOV ECX,dword ptr [EBP + -0x4]
004c11ac : ADD ECX,EAX
004c11ae : SHR EBX,0x2
004c11b1 : CALL 0x004c1790
004c11b6 : MOV ECX,dword ptr [ESI + 0x10]
004c11b9 : MOV dword ptr [EBP + -0x8],EAX
004c11bc : LEA EDI,[EBX*0x4 + 0x0]
004c11c3 : LEA EDX,[EDI + EAX*0x1]
004c11c6 : LEA EAX,[ECX + EDI*0x1]
004c11c9 : MOV dword ptr [EBP + -0xc],EAX
004c11cc : MOV EAX,dword ptr [ESI + 0x14]
004c11cf : ADD EAX,EAX
004c11d1 : ADD EAX,EAX
004c11d3 : SUB EAX,dword ptr [EBP + -0xc]
004c11d6 : ADD EAX,ECX
004c11d8 : SAR EAX,0x2
004c11db : LEA ECX,[EAX*0x4 + 0x0]
004c11e2 : ADD EDX,ECX
004c11e4 : MOV dword ptr [EBP + -0x10],EDX
004c11e7 : TEST EAX,EAX
004c11e9 : JBE 0x004c1202
004c11eb : MOV EDX,dword ptr [EBP + -0xc]
004c11ee : MOV EAX,dword ptr [EBP + -0x8]
004c11f1 : PUSH ECX
004c11f2 : PUSH EDX
004c11f3 : PUSH ECX
004c11f4 : ADD EAX,EDI
004c11f6 : PUSH EAX
004c11f7 : CALL 0x00634101
004c11fc : MOV EDX,dword ptr [EBP + -0x10]
004c11ff : ADD ESP,0x10
004c1202 : MOV EAX,dword ptr [EBP + -0x4]
004c1205 : MOV ECX,dword ptr [ESI + 0x10]
004c1208 : CMP EBX,EAX
004c120a : JA 0x004c124a
004c120c : MOV EAX,ECX
004c120e : SUB EAX,ECX
004c1210 : ADD EAX,EDI
004c1212 : SAR EAX,0x2
004c1215 : LEA EDI,[EAX*0x4 + 0x0]
004c121c : MOV dword ptr [EBP + -0x10],EDI
004c121f : ADD EDI,EDX
004c1221 : TEST EAX,EAX
004c1223 : JBE 0x004c1234
004c1225 : MOV EAX,dword ptr [EBP + -0x10]
004c1228 : PUSH EAX
004c1229 : PUSH ECX
004c122a : PUSH EAX
004c122b : PUSH EDX
004c122c : CALL 0x00634101
004c1231 : ADD ESP,0x10
004c1234 : MOV ECX,dword ptr [EBP + -0x4]
004c1237 : SUB ECX,EBX
004c1239 : JZ 0x004c123f
004c123b : XOR EAX,EAX
004c123d : STOSD.REP ES:EDI
004c123f : TEST EBX,EBX
004c1241 : JBE 0x004c129f
004c1243 : MOV EDI,dword ptr [EBP + -0x8]
004c1246 : MOV ECX,EBX
004c1248 : JMP 0x004c129b
004c124a : LEA EBX,[EAX*0x4 + 0x0]
004c1251 : MOV EAX,EBX
004c1253 : SAR EAX,0x2
004c1256 : TEST EAX,EAX
004c1258 : JBE 0x004c126a
004c125a : ADD EAX,EAX
004c125c : ADD EAX,EAX
004c125e : PUSH EAX
004c125f : PUSH ECX
004c1260 : PUSH EAX
004c1261 : PUSH EDX
004c1262 : CALL 0x00634101
004c1267 : ADD ESP,0x10
004c126a : MOV EAX,dword ptr [ESI + 0x10]
004c126d : LEA EDX,[EBX + EAX*0x1]
004c1270 : MOV EBX,dword ptr [EBP + -0x8]
004c1273 : SUB EAX,EDX
004c1275 : ADD EAX,EDI
004c1277 : SAR EAX,0x2
004c127a : LEA ECX,[EAX*0x4 + 0x0]
004c1281 : LEA EDI,[ECX + EBX*0x1]
004c1284 : TEST EAX,EAX
004c1286 : JBE 0x004c1294
004c1288 : PUSH ECX
004c1289 : PUSH EDX
004c128a : PUSH ECX
004c128b : PUSH EBX
004c128c : CALL 0x00634101
004c1291 : ADD ESP,0x10
004c1294 : MOV ECX,dword ptr [EBP + -0x4]
004c1297 : TEST ECX,ECX
004c1299 : JBE 0x004c129f
004c129b : XOR EAX,EAX
004c129d : STOSD.REP ES:EDI
004c129f : MOV ECX,dword ptr [ESI + 0x10]
004c12a2 : TEST ECX,ECX
004c12a4 : JZ 0x004c12ab
004c12a6 : CALL 0x006f04e0
004c12ab : MOV ECX,dword ptr [EBP + -0x8]
004c12ae : MOV EDX,dword ptr [EBP + -0x4]
004c12b1 : ADD dword ptr [ESI + 0x14],EDX
004c12b4 : POP EDI
004c12b5 : MOV dword ptr [ESI + 0x10],ECX
004c12b8 : POP EBX
004c12b9 : MOV ESP,EBP
004c12bb : POP EBP
004c12bc : RET
