PROGRAM  : Maestia.exe
FUNCTION : FUN_00a4fee0
ENTRY    : 00a4fee0
BODY     : [[00a4fee0, 00a5012f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a4fee0(void)

{
  char cVar1;
  uint uVar2;
  char *pcVar3;
  undefined4 uVar4;
  int in_ECX;
  int iVar5;
  byte bVar6;
  char *pcVar7;
  uint8_t *puVar8;
  uint8_t *puVar9;
  uint local_b4;
  undefined1 local_b0 [4];
  int local_ac;
  int local_a8;
  uint local_a0;
  char *local_9c;
  uint8_t *local_98;
  char local_94 [128];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b42bd9;
  local_10 = ExceptionList;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_a0 = (uint)*(ushort *)(in_ECX + 0x15c);
  local_14 = uVar2;
  FUN_00413b60(&local_a0);
  if ((local_98 != *(uint8_t **)(in_ECX + 0x128)) && (*(int *)(local_98 + 0x10) != 0)) {
    FUN_00406460(&DAT_00cc6ecc);
    local_8 = 0;
    FUN_0070cd60(local_b0);
    local_8 = CONCAT31(local_8._1_3_,2);
    if (7 < local_b4) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    iVar5 = local_a8 - local_ac >> 0x1f;
    if ((local_a8 - local_ac) / 0x1c + iVar5 != iVar5) {
      if (*(undefined4 **)(in_ECX + 0x40) != (undefined4 *)0x0) {
        (**(code **)**(undefined4 **)(in_ECX + 0x40))("CloseCharPassword",uVar2);
      }
      FUN_00a49030();
      *(undefined1 *)(in_ECX + 500) = 0;
      local_94[0] = '\0';
      _memset(local_94 + 1,0,0x7f);
      if (*(uint *)(local_ac + 0x18) < 8) {
        local_ac = local_ac + 4;
      }
      else {
        local_ac = *(int *)(local_ac + 4);
      }
      pcVar3 = (char *)FUN_0070cf00(local_ac);
      pcVar7 = local_94;
      do {
        cVar1 = *pcVar3;
        *pcVar7 = cVar1;
        pcVar3 = pcVar3 + 1;
        pcVar7 = pcVar7 + 1;
      } while (cVar1 != '\0');
      local_9c = local_94;
      do {
        cVar1 = *local_9c;
        local_9c = local_9c + 1;
      } while (cVar1 != '\0');
      local_9c = local_9c + (1 - (int)(local_94 + 1));
      FUN_006f00e0(local_94,&local_9c,0x80);
      iVar5 = *(int *)ThreadLocalStoragePointer;
      bVar6 = (byte)((ulonglong)(*(byte *)(iVar5 + 0x18) + 1) % 3);
      *(byte *)(iVar5 + 0x18) = bVar6;
      puVar8 = (uint8_t *)((uint)bVar6 * 0x2000 + 0x122cb8 + iVar5);
      local_8._0_1_ = 3;
      local_98 = puVar8;
      if (puVar8 == (uint8_t *)0x0) {
        puVar8 = (uint8_t *)0x0;
      }
      else {
        uVar4 = FUN_00a49c90();
        puVar8[0] = '\0';
        puVar8[1] = '\0';
        puVar8[2] = '3';
        puVar8[3] = '2';
        *(undefined4 *)(puVar8 + 4) = uVar4;
        pcVar7 = local_94;
        puVar9 = puVar8 + 8;
        for (iVar5 = 0x20; iVar5 != 0; iVar5 = iVar5 + -1) {
          *(undefined4 *)puVar9 = *(undefined4 *)pcVar7;
          pcVar7 = pcVar7 + 4;
          puVar9 = puVar9 + 4;
        }
      }
      local_8 = CONCAT31(local_8._1_3_,2);
      if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
        FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),0x88,puVar8);
      }
    }
    local_8 = 0xffffffff;
    FUN_004042c0();
  }
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00a4fee0 : PUSH EBP
00a4fee1 : MOV EBP,ESP
00a4fee3 : PUSH -0x1
00a4fee5 : PUSH 0xb42bd9
00a4feea : MOV EAX,FS:[0x0]
00a4fef0 : PUSH EAX
00a4fef1 : SUB ESP,0xbc
00a4fef7 : MOV EAX,[0x00d66fa0]
00a4fefc : XOR EAX,EBP
00a4fefe : MOV dword ptr [EBP + -0x10],EAX
00a4ff01 : PUSH EBX
00a4ff02 : PUSH ESI
00a4ff03 : PUSH EDI
00a4ff04 : PUSH EAX
00a4ff05 : LEA EAX,[EBP + -0xc]
00a4ff08 : MOV FS:[0x0],EAX
00a4ff0e : MOV ESI,ECX
00a4ff10 : MOVZX EAX,word ptr [ESI + 0x15c]
00a4ff17 : LEA ECX,[EBP + 0xffffff64]
00a4ff1d : MOV dword ptr [EBP + 0xffffff64],EAX
00a4ff23 : PUSH ECX
00a4ff24 : LEA ECX,[ESI + 0x124]
00a4ff2a : LEA EAX,[EBP + 0xffffff6c]
00a4ff30 : MOV EDI,EDX
00a4ff32 : CALL 0x00413b60
00a4ff37 : MOV EAX,dword ptr [ESI + 0x128]
00a4ff3d : MOV ECX,dword ptr [EBP + 0xffffff6c]
00a4ff43 : CMP ECX,EAX
00a4ff45 : JZ 0x00a50114
00a4ff4b : MOV ECX,dword ptr [ECX + 0x10]
00a4ff4e : XOR EBX,EBX
00a4ff50 : CMP ECX,EBX
00a4ff52 : JZ 0x00a50114
00a4ff58 : PUSH 0xcc6ecc
00a4ff5d : LEA ECX,[EBP + 0xffffff38]
00a4ff63 : CALL 0x00406460
00a4ff68 : MOV dword ptr [EBP + -0x4],EBX
00a4ff6b : PUSH EBX
00a4ff6c : LEA EDX,[EBP + 0xffffff38]
00a4ff72 : PUSH EDX
00a4ff73 : LEA EAX,[EBP + 0xffffff54]
00a4ff79 : PUSH EDI
00a4ff7a : PUSH EAX
00a4ff7b : CALL 0x0070cd60
00a4ff80 : ADD ESP,0x10
00a4ff83 : MOV byte ptr [EBP + -0x4],0x2
00a4ff87 : MOV EDI,0x8
00a4ff8c : CMP dword ptr [EBP + 0xffffff50],EDI
00a4ff92 : JC 0x00a4ff9f
00a4ff94 : MOV ECX,dword ptr [EBP + 0xffffff3c]
00a4ff9a : CALL 0x006f04e0
00a4ff9f : XOR ECX,ECX
00a4ffa1 : MOV word ptr [EBP + 0xffffff3c],CX
00a4ffa8 : MOV ECX,dword ptr [EBP + 0xffffff5c]
00a4ffae : SUB ECX,dword ptr [EBP + 0xffffff58]
00a4ffb4 : MOV EAX,0x92492493
00a4ffb9 : IMUL ECX
00a4ffbb : ADD EDX,ECX
00a4ffbd : SAR EDX,0x4
00a4ffc0 : MOV EAX,EDX
00a4ffc2 : SHR EAX,0x1f
00a4ffc5 : ADD EAX,EDX
00a4ffc7 : MOV dword ptr [EBP + 0xffffff50],0x7
00a4ffd1 : MOV dword ptr [EBP + 0xffffff4c],EBX
00a4ffd7 : JZ 0x00a50102
00a4ffdd : MOV ECX,dword ptr [ESI + 0x40]
00a4ffe0 : CMP ECX,EBX
00a4ffe2 : JZ 0x00a4ffef
00a4ffe4 : MOV EDX,dword ptr [ECX]
00a4ffe6 : MOV EAX,dword ptr [EDX]
00a4ffe8 : PUSH 0xcc6da0
00a4ffed : CALL EAX
00a4ffef : MOV DL,0x1
00a4fff1 : MOV EAX,ESI
00a4fff3 : CALL 0x00a49030
00a4fff8 : PUSH 0x7f
00a4fffa : LEA ECX,[EBP + 0xffffff71]
00a50000 : PUSH EBX
00a50001 : PUSH ECX
00a50002 : MOV byte ptr [ESI + 0x1f4],0x0
00a50009 : MOV byte ptr [EBP + 0xffffff70],0x0
00a50010 : CALL 0x0063b700
00a50015 : MOV EAX,dword ptr [EBP + 0xffffff58]
00a5001b : ADD ESP,0xc
00a5001e : CMP dword ptr [EAX + 0x18],EDI
00a50021 : JC 0x00a50028
00a50023 : MOV EAX,dword ptr [EAX + 0x4]
00a50026 : JMP 0x00a5002b
00a50028 : ADD EAX,0x4
00a5002b : PUSH EAX
00a5002c : CALL 0x0070cf00
00a50031 : ADD ESP,0x4
00a50034 : LEA EDX,[EBP + 0xffffff70]
00a5003a : LEA EBX,[EBX]
00a50040 : MOV CL,byte ptr [EAX]
00a50042 : MOV byte ptr [EDX],CL
00a50044 : INC EAX
00a50045 : INC EDX
00a50046 : TEST CL,CL
00a50048 : JNZ 0x00a50040
00a5004a : LEA EAX,[EBP + 0xffffff70]
00a50050 : LEA EDX,[EAX + 0x1]
00a50053 : MOV CL,byte ptr [EAX]
00a50055 : INC EAX
00a50056 : TEST CL,CL
00a50058 : JNZ 0x00a50053
00a5005a : SUB EAX,EDX
00a5005c : INC EAX
00a5005d : PUSH 0x80
00a50062 : LEA EDX,[EBP + 0xffffff68]
00a50068 : MOV dword ptr [EBP + 0xffffff68],EAX
00a5006e : PUSH EDX
00a5006f : LEA EAX,[EBP + 0xffffff70]
00a50075 : PUSH EAX
00a50076 : LEA ECX,[ESI + 0x2dc]
00a5007c : CALL 0x006f00e0
00a50081 : MOV ECX,dword ptr FS:[0x2c]
00a50088 : MOV ECX,dword ptr [ECX]
00a5008a : MOVZX EAX,byte ptr [ECX + 0x18]
00a5008e : INC EAX
00a5008f : CDQ
00a50090 : MOV EDI,0x3
00a50095 : IDIV EDI
00a50097 : MOV byte ptr [ECX + 0x18],DL
00a5009a : MOVZX EDX,DL
00a5009d : SHL EDX,0xd
00a500a0 : LEA EBX,[EDX + ECX*0x1 + 0x122cb8]
00a500a7 : MOV dword ptr [EBP + 0xffffff6c],EBX
00a500ad : MOV byte ptr [EBP + -0x4],0x3
00a500b1 : TEST EBX,EBX
00a500b3 : JZ 0x00a500dc
00a500b5 : CALL 0x00a49c90
00a500ba : XOR ECX,ECX
00a500bc : MOV word ptr [EBX],CX
00a500bf : LEA EDI,[EBX + 0x8]
00a500c2 : MOV ECX,0x20
00a500c7 : LEA ESI,[EBP + 0xffffff70]
00a500cd : MOV byte ptr [EBX + 0x2],0x33
00a500d1 : MOV byte ptr [EBX + 0x3],0x32
00a500d5 : MOV dword ptr [EBX + 0x4],EAX
00a500d8 : MOVSD.REP ES:EDI,ESI
00a500da : JMP 0x00a500de
00a500dc : XOR EBX,EBX
00a500de : MOV byte ptr [EBP + -0x4],0x2
00a500e2 : MOV ECX,dword ptr [0x017247d4]
00a500e8 : MOV EAX,dword ptr [ECX + 0x4]
00a500eb : TEST EAX,EAX
00a500ed : JZ 0x00a50102
00a500ef : CMP byte ptr [ECX + 0x8],0x0
00a500f3 : JZ 0x00a50102
00a500f5 : PUSH 0x88
00a500fa : PUSH EAX
00a500fb : MOV EDI,EBX
00a500fd : CALL 0x00a0dd40
00a50102 : MOV dword ptr [EBP + -0x4],0xffffffff
00a50109 : LEA ESI,[EBP + 0xffffff54]
00a5010f : CALL 0x004042c0
00a50114 : MOV ECX,dword ptr [EBP + -0xc]
00a50117 : MOV dword ptr FS:[0x0],ECX
00a5011e : POP ECX
00a5011f : POP EDI
00a50120 : POP ESI
00a50121 : POP EBX
00a50122 : MOV ECX,dword ptr [EBP + -0x10]
00a50125 : XOR ECX,EBP
00a50127 : CALL 0x00633e6b
00a5012c : MOV ESP,EBP
00a5012e : POP EBP
00a5012f : RET
