PROGRAM  : Maestia.exe
FUNCTION : FUN_0055f150
ENTRY    : 0055f150
BODY     : [[0055f150, 0055f268]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0055f150(undefined4 param_1,uint *param_2,uint param_3)

{
  int *piVar1;
  uint *puVar2;
  uint *puVar3;
  int *piVar4;
  int iVar5;
  int iVar6;
  uint uVar7;
  int *in_ECX;
  uint uVar8;
  
  FUN_00560860(param_1);
  piVar4 = (int *)*in_ECX;
  param_3 = param_3 & piVar4[1];
  *piVar4 = *piVar4 + 1;
  iVar5 = *in_ECX;
  iVar6 = *(int *)(iVar5 + 8 + param_3 * 0xc);
  puVar2 = (uint *)(iVar5 + 8 + param_3 * 0xc);
  if (iVar6 == -2) {
    *puVar2 = 0xffffffff;
    if (*param_2 != 0) {
      piVar4 = (int *)(*param_2 + 4);
      *piVar4 = *piVar4 + 1;
    }
    puVar2[2] = *param_2;
    puVar2[1] = param_3;
    return;
  }
  uVar8 = param_3;
  do {
    uVar8 = uVar8 + 1 & *(uint *)(iVar5 + 4);
  } while (*(int *)(iVar5 + 8 + uVar8 * 0xc) != -2);
  piVar4 = (int *)(iVar5 + 8 + uVar8 * 0xc);
  uVar7 = puVar2[1];
  if (uVar7 != param_3) {
    puVar3 = (uint *)(iVar5 + 8 + uVar7 * 0xc);
    for (uVar7 = *(uint *)(iVar5 + 8 + uVar7 * 0xc); uVar7 != param_3;
        uVar7 = *(uint *)(iVar5 + 8 + uVar7 * 0xc)) {
      uVar7 = *puVar3;
      puVar3 = (uint *)(iVar5 + 8 + uVar7 * 0xc);
    }
    if (piVar4 != (int *)0x0) {
      *piVar4 = iVar6;
      piVar4[1] = puVar2[1];
      if (puVar2[2] != 0) {
        piVar1 = (int *)(puVar2[2] + 4);
        *piVar1 = *piVar1 + 1;
      }
      piVar4[2] = puVar2[2];
    }
    *puVar3 = uVar8;
    uVar8 = *param_2;
    if (uVar8 != 0) {
      *(int *)(uVar8 + 4) = *(int *)(uVar8 + 4) + 1;
    }
    if ((GRefCountNTSImpl *)puVar2[2] != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release((GRefCountNTSImpl *)puVar2[2]);
    }
    puVar2[2] = uVar8;
    puVar2[1] = param_3;
    *puVar2 = 0xffffffff;
    return;
  }
  if (piVar4 != (int *)0x0) {
    *piVar4 = iVar6;
    piVar4[1] = puVar2[1];
    if (puVar2[2] != 0) {
      piVar1 = (int *)(puVar2[2] + 4);
      *piVar1 = *piVar1 + 1;
    }
    piVar4[2] = puVar2[2];
  }
  uVar7 = *param_2;
  if (uVar7 != 0) {
    *(int *)(uVar7 + 4) = *(int *)(uVar7 + 4) + 1;
  }
  if ((GRefCountNTSImpl *)puVar2[2] != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release((GRefCountNTSImpl *)puVar2[2]);
  }
  puVar2[2] = uVar7;
  *puVar2 = uVar8;
  puVar2[1] = param_3;
  return;
}



============================================================
DISASSEMBLY
============================================================
0055f150 : MOV EAX,dword ptr [ESP + 0x4]
0055f154 : PUSH EBP
0055f155 : PUSH ESI
0055f156 : PUSH EDI
0055f157 : PUSH EAX
0055f158 : MOV ESI,ECX
0055f15a : CALL 0x00560860
0055f15f : MOV EAX,dword ptr [ESI]
0055f161 : MOV EDI,dword ptr [ESP + 0x18]
0055f165 : AND EDI,dword ptr [EAX + 0x4]
0055f168 : INC dword ptr [EAX]
0055f16a : MOV EAX,dword ptr [ESI]
0055f16c : LEA ECX,[EDI + EDI*0x2]
0055f16f : MOV EBP,dword ptr [EAX + ECX*0x4 + 0x8]
0055f173 : LEA ESI,[EAX + ECX*0x4 + 0x8]
0055f177 : CMP EBP,-0x2
0055f17a : JNZ 0x0055f19d
0055f17c : MOV ECX,dword ptr [ESP + 0x14]
0055f180 : MOV dword ptr [ESI],0xffffffff
0055f186 : MOV EAX,dword ptr [ECX]
0055f188 : TEST EAX,EAX
0055f18a : JZ 0x0055f18f
0055f18c : INC dword ptr [EAX + 0x4]
0055f18f : MOV EDX,dword ptr [ECX]
0055f191 : MOV dword ptr [ESI + 0x8],EDX
0055f194 : MOV dword ptr [ESI + 0x4],EDI
0055f197 : POP EDI
0055f198 : POP ESI
0055f199 : POP EBP
0055f19a : RET 0xc
0055f19d : MOV ECX,dword ptr [EAX + 0x4]
0055f1a0 : PUSH EBX
0055f1a1 : MOV EBX,EDI
0055f1a3 : INC EBX
0055f1a4 : AND EBX,ECX
0055f1a6 : LEA EDX,[EBX + EBX*0x2]
0055f1a9 : CMP dword ptr [EAX + EDX*0x4 + 0x8],-0x2
0055f1ae : JNZ 0x0055f1a3
0055f1b0 : LEA ECX,[EBX + EBX*0x2]
0055f1b3 : LEA EDX,[EAX + ECX*0x4 + 0x8]
0055f1b7 : MOV ECX,dword ptr [ESI + 0x4]
0055f1ba : CMP ECX,EDI
0055f1bc : JNZ 0x0055f202
0055f1be : TEST EDX,EDX
0055f1c0 : JZ 0x0055f1da
0055f1c2 : MOV dword ptr [EDX],EBP
0055f1c4 : MOV EAX,dword ptr [ESI + 0x4]
0055f1c7 : MOV dword ptr [EDX + 0x4],EAX
0055f1ca : MOV EAX,dword ptr [ESI + 0x8]
0055f1cd : TEST EAX,EAX
0055f1cf : JZ 0x0055f1d4
0055f1d1 : INC dword ptr [EAX + 0x4]
0055f1d4 : MOV ECX,dword ptr [ESI + 0x8]
0055f1d7 : MOV dword ptr [EDX + 0x8],ECX
0055f1da : MOV EDX,dword ptr [ESP + 0x18]
0055f1de : MOV EBP,dword ptr [EDX]
0055f1e0 : TEST EBP,EBP
0055f1e2 : JZ 0x0055f1e7
0055f1e4 : INC dword ptr [EBP + 0x4]
0055f1e7 : MOV ECX,dword ptr [ESI + 0x8]
0055f1ea : TEST ECX,ECX
0055f1ec : JZ 0x0055f1f3
0055f1ee : CALL 0x004ff7c0
0055f1f3 : MOV dword ptr [ESI + 0x8],EBP
0055f1f6 : MOV dword ptr [ESI],EBX
0055f1f8 : POP EBX
0055f1f9 : MOV dword ptr [ESI + 0x4],EDI
0055f1fc : POP EDI
0055f1fd : POP ESI
0055f1fe : POP EBP
0055f1ff : RET 0xc
0055f202 : LEA ECX,[ECX + ECX*0x2]
0055f205 : CMP dword ptr [EAX + ECX*0x4 + 0x8],EDI
0055f209 : LEA ECX,[EAX + ECX*0x4 + 0x8]
0055f20d : JZ 0x0055f21f
0055f20f : NOP
0055f210 : MOV ECX,dword ptr [ECX]
0055f212 : LEA ECX,[ECX + ECX*0x2]
0055f215 : CMP dword ptr [EAX + ECX*0x4 + 0x8],EDI
0055f219 : LEA ECX,[EAX + ECX*0x4 + 0x8]
0055f21d : JNZ 0x0055f210
0055f21f : TEST EDX,EDX
0055f221 : JZ 0x0055f23b
0055f223 : MOV dword ptr [EDX],EBP
0055f225 : MOV EAX,dword ptr [ESI + 0x4]
0055f228 : MOV dword ptr [EDX + 0x4],EAX
0055f22b : MOV EAX,dword ptr [ESI + 0x8]
0055f22e : TEST EAX,EAX
0055f230 : JZ 0x0055f235
0055f232 : INC dword ptr [EAX + 0x4]
0055f235 : MOV EAX,dword ptr [ESI + 0x8]
0055f238 : MOV dword ptr [EDX + 0x8],EAX
0055f23b : MOV dword ptr [ECX],EBX
0055f23d : MOV ECX,dword ptr [ESP + 0x18]
0055f241 : MOV EBX,dword ptr [ECX]
0055f243 : TEST EBX,EBX
0055f245 : JZ 0x0055f24a
0055f247 : INC dword ptr [EBX + 0x4]
0055f24a : MOV ECX,dword ptr [ESI + 0x8]
0055f24d : TEST ECX,ECX
0055f24f : JZ 0x0055f256
0055f251 : CALL 0x004ff7c0
0055f256 : MOV dword ptr [ESI + 0x8],EBX
0055f259 : POP EBX
0055f25a : MOV dword ptr [ESI + 0x4],EDI
0055f25d : POP EDI
0055f25e : MOV dword ptr [ESI],0xffffffff
0055f264 : POP ESI
0055f265 : POP EBP
0055f266 : RET 0xc
