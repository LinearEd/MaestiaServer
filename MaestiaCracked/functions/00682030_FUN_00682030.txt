PROGRAM  : Maestia.exe
FUNCTION : FUN_00682030
ENTRY    : 00682030
BODY     : [[00682030, 006821dc]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00682030(int param_1,undefined4 param_2)

{
  ushort uVar1;
  ushort uVar2;
  LONG LVar3;
  int in_ECX;
  undefined4 uVar4;
  uint *puVar5;
  undefined *puVar6;
  uint local_420;
  void *local_41c [2];
  undefined4 local_414;
  uint local_410;
  uint local_40c;
  uint local_408;
  char local_404 [1024];
  uint local_4;
  
  local_4 = DAT_00d66fa0 ^ (uint)&local_420;
  FUN_0051c6b0(param_2);
  _strcpy_s(local_404,0x400,(char *)((local_420 & 0xfffffffc) + 8));
  uVar1 = *(ushort *)(param_1 + 4);
  uVar2 = uVar1 & 0xfff;
  uVar4 = 0x1000000;
  local_414 = 0x1000000;
  if (uVar2 == 0x409) {
    uVar4 = 0x10000000;
    local_414 = 0x10000000;
  }
  if (uVar2 == 0x404) {
    uVar4 = 9;
    local_414 = 9;
  }
  if (uVar2 == 0x804) {
    uVar4 = 0x80000;
    local_414 = 0x80000;
  }
  if (uVar2 == 0x412) {
    uVar4 = 0x2000;
    local_414 = 0x2000;
  }
  if (uVar2 == 0x411) {
    uVar4 = 0x400;
    local_414 = 0x400;
  }
  *(undefined4 *)(in_ECX + 0x44) = uVar4;
  local_410 = (uint)uVar1;
  local_41c[0] = (void *)FUN_00515840((*(uint *)(local_420 & 0xfffffffc) & 0x7fffffff) + 1,0);
  _memcpy(local_41c[0],local_404,(*(uint *)(local_420 & 0xfffffffc) & 0x7fffffff) + 1);
  FUN_0067c610(local_41c);
  puVar6 = &DAT_00bd6690;
  puVar5 = &local_408;
  FUN_0051c6b0(param_2);
  uVar4 = FUN_0051c6e0(puVar5,puVar6);
  FUN_0051bd70(uVar4);
  LVar3 = InterlockedExchangeAdd((LONG *)((local_408 & 0xfffffffc) + 4),-1);
  if (LVar3 == 1) {
    FUN_00515cf0(local_408 & 0xfffffffc);
  }
  LVar3 = InterlockedExchangeAdd((LONG *)((local_40c & 0xfffffffc) + 4),-1);
  if (LVar3 == 1) {
    FUN_00515cf0(local_40c & 0xfffffffc);
  }
  *(int *)(in_ECX + 0x40) = *(int *)(in_ECX + 0x40) + 1;
  LVar3 = InterlockedExchangeAdd((LONG *)((local_420 & 0xfffffffc) + 4),-1);
  if (LVar3 == 1) {
    FUN_00515cf0(local_420 & 0xfffffffc);
  }
  __security_check_cookie(local_4 ^ (uint)&local_420);
  return;
}



============================================================
DISASSEMBLY
============================================================
00682030 : SUB ESP,0x420
00682036 : MOV EAX,[0x00d66fa0]
0068203b : XOR EAX,ESP
0068203d : MOV dword ptr [ESP + 0x41c],EAX
00682044 : PUSH EBX
00682045 : MOV EBX,dword ptr [ESP + 0x428]
0068204c : PUSH ESI
0068204d : MOV ESI,dword ptr [ESP + 0x430]
00682054 : PUSH EDI
00682055 : MOV EDI,ECX
00682057 : PUSH ESI
00682058 : LEA ECX,[ESP + 0x10]
0068205c : CALL 0x0051c6b0
00682061 : MOV EAX,dword ptr [ESP + 0xc]
00682065 : AND EAX,0xfffffffc
00682068 : ADD EAX,0x8
0068206b : PUSH EAX
0068206c : LEA ECX,[ESP + 0x2c]
00682070 : PUSH 0x400
00682075 : PUSH ECX
00682076 : CALL 0x00638300
0068207b : MOVZX EDX,word ptr [EBX + 0x4]
0068207f : MOV EAX,EDX
00682081 : AND EAX,0xfff
00682086 : MOV EBX,0x409
0068208b : ADD ESP,0xc
0068208e : MOV ECX,0x1000000
00682093 : MOV dword ptr [ESP + 0x18],ECX
00682097 : CMP AX,BX
0068209a : JNZ 0x006820a5
0068209c : MOV ECX,0x10000000
006820a1 : MOV dword ptr [ESP + 0x18],ECX
006820a5 : MOV EBX,0x404
006820aa : CMP AX,BX
006820ad : JNZ 0x006820b8
006820af : MOV ECX,0x9
006820b4 : MOV dword ptr [ESP + 0x18],ECX
006820b8 : MOV EBX,0x804
006820bd : CMP AX,BX
006820c0 : JNZ 0x006820cb
006820c2 : MOV ECX,0x80000
006820c7 : MOV dword ptr [ESP + 0x18],ECX
006820cb : MOV EBX,0x412
006820d0 : CMP AX,BX
006820d3 : JNZ 0x006820de
006820d5 : MOV ECX,0x2000
006820da : MOV dword ptr [ESP + 0x18],ECX
006820de : MOV EBX,0x411
006820e3 : CMP AX,BX
006820e6 : JNZ 0x006820f1
006820e8 : MOV ECX,0x400
006820ed : MOV dword ptr [ESP + 0x18],ECX
006820f1 : MOV EAX,dword ptr [ESP + 0xc]
006820f5 : AND EAX,0xfffffffc
006820f8 : MOV dword ptr [EDI + 0x44],ECX
006820fb : MOV EAX,dword ptr [EAX]
006820fd : MOV ECX,dword ptr [0x00d73250]
00682103 : AND EAX,0x7fffffff
00682108 : MOVZX EDX,DX
0068210b : PUSH 0x0
0068210d : INC EAX
0068210e : PUSH EAX
0068210f : MOV dword ptr [ESP + 0x24],EDX
00682113 : CALL 0x00515840
00682118 : MOV ECX,dword ptr [ESP + 0xc]
0068211c : AND ECX,0xfffffffc
0068211f : MOV EDX,dword ptr [ECX]
00682121 : AND EDX,0x7fffffff
00682127 : INC EDX
00682128 : PUSH EDX
00682129 : LEA ECX,[ESP + 0x2c]
0068212d : PUSH ECX
0068212e : PUSH EAX
0068212f : MOV dword ptr [ESP + 0x1c],EAX
00682133 : CALL 0x0063ae40
00682138 : ADD ESP,0xc
0068213b : LEA EDX,[ESP + 0x10]
0068213f : PUSH EDX
00682140 : LEA ECX,[EDI + 0x4c]
00682143 : CALL 0x0067c610
00682148 : PUSH 0xbd6690
0068214d : LEA EAX,[ESP + 0x28]
00682151 : PUSH EAX
00682152 : PUSH ESI
00682153 : LEA ECX,[ESP + 0x2c]
00682157 : CALL 0x0051c6b0
0068215c : MOV ECX,EAX
0068215e : CALL 0x0051c6e0
00682163 : PUSH EAX
00682164 : LEA ECX,[EDI + 0x38]
00682167 : CALL 0x0051bd70
0068216c : MOV ESI,dword ptr [ESP + 0x24]
00682170 : MOV EBX,dword ptr [0x00b851cc]
00682176 : AND ESI,0xfffffffc
00682179 : PUSH -0x1
0068217b : LEA ECX,[ESI + 0x4]
0068217e : PUSH ECX
0068217f : CALL EBX
00682181 : SUB EAX,0x1
00682184 : JNZ 0x0068218c
00682186 : PUSH ESI
00682187 : CALL 0x00515cf0
0068218c : MOV ESI,dword ptr [ESP + 0x20]
00682190 : AND ESI,0xfffffffc
00682193 : PUSH -0x1
00682195 : LEA EDX,[ESI + 0x4]
00682198 : PUSH EDX
00682199 : CALL EBX
0068219b : SUB EAX,0x1
0068219e : JNZ 0x006821a6
006821a0 : PUSH ESI
006821a1 : CALL 0x00515cf0
006821a6 : MOV ESI,dword ptr [ESP + 0xc]
006821aa : INC dword ptr [EDI + 0x40]
006821ad : AND ESI,0xfffffffc
006821b0 : PUSH -0x1
006821b2 : LEA EAX,[ESI + 0x4]
006821b5 : PUSH EAX
006821b6 : CALL EBX
006821b8 : SUB EAX,0x1
006821bb : JNZ 0x006821c3
006821bd : PUSH ESI
006821be : CALL 0x00515cf0
006821c3 : MOV ECX,dword ptr [ESP + 0x428]
006821ca : POP EDI
006821cb : POP ESI
006821cc : POP EBX
006821cd : XOR ECX,ESP
006821cf : CALL 0x00633e6b
006821d4 : ADD ESP,0x420
006821da : RET 0x8
