PROGRAM  : Maestia.exe
FUNCTION : FUN_0055fca0
ENTRY    : 0055fca0
BODY     : [[0055fca0, 0055fffe]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

undefined4 * FUN_0055fca0(undefined4 *param_1,int param_2)

{
  int *piVar1;
  GRefCountNTSImpl *pGVar2;
  undefined4 *puVar3;
  int *piVar4;
  int iVar5;
  byte bVar6;
  int in_ECX;
  undefined1 local_24 [4];
  undefined4 local_20;
  undefined1 local_1c [8];
  GRefCountNTSImpl *local_14;
  int *local_10;
  uint local_c;
  undefined2 local_8;
  ushort local_6;
  byte local_4;
  ushort local_2;
  
  FUN_0051c380(in_ECX + 8,*(undefined4 *)(in_ECX + 0xc));
  FUN_0051c380(in_ECX + 0x10,*(undefined4 *)(in_ECX + 0xc));
  if (*(int *)(in_ECX + 0x18) != 0) {
    piVar1 = (int *)(*(int *)(in_ECX + 0x18) + 4);
    *piVar1 = *piVar1 + 1;
  }
  piVar1 = *(int **)(in_ECX + 0x1c);
  local_14 = *(GRefCountNTSImpl **)(in_ECX + 0x18);
  if (piVar1 != (int *)0x0) {
    *piVar1 = *piVar1 + 1;
  }
  local_10 = *(int **)(in_ECX + 0x1c);
  local_8 = *(undefined2 *)(in_ECX + 0x24);
  local_c = *(uint *)(in_ECX + 0x20);
  local_6 = *(ushort *)(in_ECX + 0x26);
  local_4 = *(byte *)(in_ECX + 0x28);
  local_2 = *(ushort *)(in_ECX + 0x2a);
  if ((*(byte *)(param_2 + 0x2a) >> 4 & 1) != 0) {
    FUN_0055fbc0(*(byte *)(param_2 + 0x28) & 1);
  }
  if ((*(byte *)(param_2 + 0x2a) >> 5 & 1) != 0) {
    FUN_0055fc30(*(byte *)(param_2 + 0x28) >> 1 & 1);
  }
  bVar6 = (byte)*(undefined2 *)(param_2 + 0x2a);
  if ((bVar6 >> 6 & 1) != 0) {
    if ((*(byte *)(param_2 + 0x28) & 4) == 0) {
      local_4 = local_4 & 0xfb;
    }
    else {
      local_4 = local_4 | 4;
    }
    local_2 = local_2 | 0x40;
  }
  if ((char)bVar6 < '\0') {
    if ((*(byte *)(param_2 + 0x28) & 8) == 0) {
      local_4 = local_4 & 0xf7;
    }
    else {
      local_4 = local_4 | 8;
    }
    local_2 = local_2 | 0x80;
  }
  if ((*(byte *)(param_2 + 0x2a) & 1) != 0) {
    local_c = *(uint *)(param_2 + 0x20);
    local_2 = local_2 | 1;
  }
  if (((byte)((ushort)*(undefined2 *)(param_2 + 0x2a) >> 10) & 1) != 0) {
    local_c = (uint)*(byte *)(param_2 + 0x23) << 0x18 | local_c & 0xffffff;
    local_2 = local_2 | 0x400;
  }
  if ((bVar6 >> 1 & 1) != 0) {
    local_8 = *(undefined2 *)(param_2 + 0x24);
    local_2 = local_2 | 2;
  }
  if ((bVar6 >> 3 & 1) != 0) {
    local_6 = *(ushort *)(param_2 + 0x26);
    if (0x10000 < local_6) {
      local_6 = 0xffff;
    }
    local_2 = local_2 | 8;
  }
  if ((bVar6 >> 2 & 1) != 0) {
    if ((_DAT_00d7328c & 1) == 0) {
      _DAT_00d7328c = _DAT_00d7328c | 1;
      FUN_0051b6e0();
      _atexit((_func_4879 *)&LAB_00b84ba0);
    }
    puVar3 = (undefined4 *)(param_2 + 8);
    if ((*(byte *)(param_2 + 0x2a) >> 2 & 1) == 0) {
      puVar3 = &DAT_00d73288;
    }
    FUN_0055f890(puVar3);
  }
  if ((*(ushort *)(param_2 + 0x2a) >> 0xb & 1) != 0) {
    piVar4 = (int *)FUN_005459d0();
    piVar1 = local_10;
    if (piVar4 != (int *)0x0) {
      *piVar4 = *piVar4 + 1;
    }
    if ((local_10 != (int *)0x0) && (*local_10 = *local_10 + -1, *local_10 == 0)) {
      FUN_00500860();
      FUN_00515cf0(piVar1);
    }
    local_2 = local_2 | 0x800;
    local_10 = piVar4;
  }
  if (((*(ushort *)(param_2 + 0x2a) & 0x100) == 0) || (iVar5 = FUN_0051b1a0(), iVar5 != 0)) {
    if ((*(ushort *)(param_2 + 0x2a) & 0x100) != 0) {
      iVar5 = FUN_0051b1a0();
      if (iVar5 != 0) {
        FUN_0051bc20(param_2 + 0x10);
        local_2 = local_2 | 0x100;
      }
    }
  }
  else {
    FUN_0051bf30();
    local_2 = local_2 & 0xfeff;
  }
  if ((*(ushort *)(param_2 + 0x2a) >> 9 & 1) != 0) {
    pGVar2 = *(GRefCountNTSImpl **)(param_2 + 0x18);
    if (pGVar2 != (GRefCountNTSImpl *)0x0) {
      *(int *)(pGVar2 + 4) = *(int *)(pGVar2 + 4) + 1;
    }
    if (local_14 != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(local_14);
    }
    local_2 = local_2 | 0x200;
    local_14 = pGVar2;
  }
  *param_1 = &PTR_FUN_00cd3f2c;
  param_1[1] = 1;
  *param_1 = &PTR_FUN_00b86530;
  FUN_0051c380(local_24,local_20);
  FUN_0051c380(local_1c,local_20);
  if (local_14 != (GRefCountNTSImpl *)0x0) {
    *(int *)(local_14 + 4) = *(int *)(local_14 + 4) + 1;
  }
  param_1[6] = local_14;
  if (local_10 != (int *)0x0) {
    *local_10 = *local_10 + 1;
  }
  param_1[7] = local_10;
  *(undefined2 *)(param_1 + 9) = local_8;
  param_1[8] = local_c;
  *(ushort *)((int)param_1 + 0x26) = local_6;
  *(byte *)(param_1 + 10) = local_4;
  *(ushort *)((int)param_1 + 0x2a) = local_2;
  FUN_00504260();
  return param_1;
}



============================================================
DISASSEMBLY
============================================================
0055fca0 : SUB ESP,0x34
0055fca3 : PUSH EBX
0055fca4 : PUSH ESI
0055fca5 : MOV ESI,ECX
0055fca7 : MOV EAX,dword ptr [ESI + 0xc]
0055fcaa : PUSH EAX
0055fcab : LEA ECX,[ESI + 0x8]
0055fcae : MOV dword ptr [ESP + 0x14],0xcd3f2c
0055fcb6 : PUSH ECX
0055fcb7 : MOV EBX,0x1
0055fcbc : LEA ECX,[ESP + 0x20]
0055fcc0 : MOV dword ptr [ESP + 0x14],0x0
0055fcc8 : MOV dword ptr [ESP + 0x1c],EBX
0055fccc : MOV dword ptr [ESP + 0x18],0xb86530
0055fcd4 : MOV byte ptr [ESP + 0x10],0x0
0055fcd9 : CALL 0x0051c380
0055fcde : MOV EDX,dword ptr [ESI + 0xc]
0055fce1 : PUSH EDX
0055fce2 : LEA EAX,[ESI + 0x10]
0055fce5 : PUSH EAX
0055fce6 : LEA ECX,[ESP + 0x28]
0055fcea : MOV byte ptr [ESP + 0x11],0x0
0055fcef : CALL 0x0051c380
0055fcf4 : MOV EAX,dword ptr [ESI + 0x18]
0055fcf7 : TEST EAX,EAX
0055fcf9 : JZ 0x0055fcfe
0055fcfb : ADD dword ptr [EAX + 0x4],EBX
0055fcfe : MOV EAX,dword ptr [ESI + 0x1c]
0055fd01 : MOV ECX,dword ptr [ESI + 0x18]
0055fd04 : MOV dword ptr [ESP + 0x28],ECX
0055fd08 : TEST EAX,EAX
0055fd0a : JZ 0x0055fd0e
0055fd0c : ADD dword ptr [EAX],EBX
0055fd0e : MOV EDX,dword ptr [ESI + 0x1c]
0055fd11 : MOV CX,word ptr [ESI + 0x24]
0055fd15 : MOV EAX,dword ptr [ESI + 0x20]
0055fd18 : MOV dword ptr [ESP + 0x2c],EDX
0055fd1c : MOVZX EDX,word ptr [ESI + 0x26]
0055fd20 : MOV word ptr [ESP + 0x34],CX
0055fd25 : MOVZX ECX,byte ptr [ESI + 0x28]
0055fd29 : MOV word ptr [ESP + 0x36],DX
0055fd2e : MOVZX EDX,word ptr [ESI + 0x2a]
0055fd32 : MOV ESI,dword ptr [ESP + 0x44]
0055fd36 : MOV byte ptr [ESP + 0x38],CL
0055fd3a : MOVZX ECX,byte ptr [ESI + 0x2a]
0055fd3e : SHR CL,0x4
0055fd41 : MOV dword ptr [ESP + 0x30],EAX
0055fd45 : MOV word ptr [ESP + 0x3a],DX
0055fd4a : TEST BL,CL
0055fd4c : JZ 0x0055fd64
0055fd4e : MOV DL,byte ptr [ESI + 0x28]
0055fd51 : AND DL,BL
0055fd53 : MOVZX EAX,DL
0055fd56 : PUSH EAX
0055fd57 : LEA ECX,[ESP + 0x14]
0055fd5b : CALL 0x0055fbc0
0055fd60 : MOV EAX,dword ptr [ESP + 0x30]
0055fd64 : MOV CL,byte ptr [ESI + 0x2a]
0055fd67 : SHR CL,0x5
0055fd6a : TEST BL,CL
0055fd6c : JZ 0x0055fd86
0055fd6e : MOV DL,byte ptr [ESI + 0x28]
0055fd71 : SHR DL,0x1
0055fd73 : AND DL,BL
0055fd75 : MOVZX EAX,DL
0055fd78 : PUSH EAX
0055fd79 : LEA ECX,[ESP + 0x14]
0055fd7d : CALL 0x0055fc30
0055fd82 : MOV EAX,dword ptr [ESP + 0x30]
0055fd86 : MOVZX ECX,word ptr [ESI + 0x2a]
0055fd8a : MOV DL,CL
0055fd8c : SHR DL,0x6
0055fd8f : TEST BL,DL
0055fd91 : JZ 0x0055fdab
0055fd93 : TEST byte ptr [ESI + 0x28],0x4
0055fd97 : JZ 0x0055fda0
0055fd99 : OR byte ptr [ESP + 0x38],0x4
0055fd9e : JMP 0x0055fda5
0055fda0 : AND byte ptr [ESP + 0x38],0xfb
0055fda5 : OR word ptr [ESP + 0x3a],0x40
0055fdab : MOV DL,CL
0055fdad : SHR DL,0x7
0055fdb0 : TEST BL,DL
0055fdb2 : JZ 0x0055fdd0
0055fdb4 : TEST byte ptr [ESI + 0x28],0x8
0055fdb8 : JZ 0x0055fdc1
0055fdba : OR byte ptr [ESP + 0x38],0x8
0055fdbf : JMP 0x0055fdc6
0055fdc1 : AND byte ptr [ESP + 0x38],0xf7
0055fdc6 : MOV EDX,0x80
0055fdcb : OR word ptr [ESP + 0x3a],DX
0055fdd0 : TEST byte ptr [ESI + 0x2a],BL
0055fdd3 : JZ 0x0055fde1
0055fdd5 : MOV EAX,dword ptr [ESI + 0x20]
0055fdd8 : OR word ptr [ESP + 0x3a],BX
0055fddd : MOV dword ptr [ESP + 0x30],EAX
0055fde1 : MOV EDX,ECX
0055fde3 : SHR EDX,0xa
0055fde6 : TEST BL,DL
0055fde8 : JZ 0x0055fe06
0055fdea : MOVZX EDX,byte ptr [ESI + 0x23]
0055fdee : AND EAX,0xffffff
0055fdf3 : SHL EDX,0x18
0055fdf6 : OR EDX,EAX
0055fdf8 : MOV EAX,0x400
0055fdfd : OR word ptr [ESP + 0x3a],AX
0055fe02 : MOV dword ptr [ESP + 0x30],EDX
0055fe06 : MOV DL,CL
0055fe08 : SHR DL,0x1
0055fe0a : TEST BL,DL
0055fe0c : JZ 0x0055fe1d
0055fe0e : MOV AX,word ptr [ESI + 0x24]
0055fe12 : OR word ptr [ESP + 0x3a],0x2
0055fe18 : MOV word ptr [ESP + 0x34],AX
0055fe1d : MOV DL,CL
0055fe1f : SHR DL,0x3
0055fe22 : TEST BL,DL
0055fe24 : JZ 0x0055fe41
0055fe26 : MOVZX EAX,word ptr [ESI + 0x26]
0055fe2a : CMP EAX,0x10000
0055fe2f : JBE 0x0055fe36
0055fe31 : MOV EAX,0xffff
0055fe36 : OR word ptr [ESP + 0x3a],0x8
0055fe3c : MOV word ptr [ESP + 0x36],AX
0055fe41 : SHR CL,0x2
0055fe44 : TEST BL,CL
0055fe46 : JZ 0x0055fe89
0055fe48 : TEST byte ptr [0x00d7328c],BL
0055fe4e : JNZ 0x0055fe6d
0055fe50 : OR dword ptr [0x00d7328c],EBX
0055fe56 : MOV ECX,0xd73288
0055fe5b : CALL 0x0051b6e0
0055fe60 : PUSH 0xb84ba0
0055fe65 : CALL 0x006356bc
0055fe6a : ADD ESP,0x4
0055fe6d : MOV CL,byte ptr [ESI + 0x2a]
0055fe70 : SHR CL,0x2
0055fe73 : LEA EAX,[ESI + 0x8]
0055fe76 : TEST BL,CL
0055fe78 : JNZ 0x0055fe7f
0055fe7a : MOV EAX,0xd73288
0055fe7f : PUSH EAX
0055fe80 : LEA ECX,[ESP + 0x14]
0055fe84 : CALL 0x0055f890
0055fe89 : MOV DX,word ptr [ESI + 0x2a]
0055fe8d : SHR DX,0xb
0055fe91 : PUSH EDI
0055fe92 : TEST BL,DL
0055fe94 : JZ 0x0055fed4
0055fe96 : MOV ECX,ESI
0055fe98 : CALL 0x005459d0
0055fe9d : MOV EDI,EAX
0055fe9f : TEST EDI,EDI
0055fea1 : JZ 0x0055fea5
0055fea3 : ADD dword ptr [EDI],EBX
0055fea5 : MOV EAX,dword ptr [ESP + 0x30]
0055fea9 : TEST EAX,EAX
0055feab : JZ 0x0055fec6
0055fead : DEC dword ptr [EAX]
0055feaf : PUSH EBP
0055feb0 : MOV EBP,EAX
0055feb2 : CMP dword ptr [EBP],0x0
0055feb6 : JNZ 0x0055fec5
0055feb8 : MOV ECX,EBP
0055feba : CALL 0x00500860
0055febf : PUSH EBP
0055fec0 : CALL 0x00515cf0
0055fec5 : POP EBP
0055fec6 : MOV EAX,0x800
0055fecb : OR word ptr [ESP + 0x3e],AX
0055fed0 : MOV dword ptr [ESP + 0x30],EDI
0055fed4 : MOV ECX,0x100
0055fed9 : TEST word ptr [ESI + 0x2a],CX
0055fedd : JZ 0x0055ff00
0055fedf : LEA ECX,[ESI + 0x10]
0055fee2 : CALL 0x0051b1a0
0055fee7 : TEST EAX,EAX
0055fee9 : JNZ 0x0055ff00
0055feeb : LEA ECX,[ESP + 0x24]
0055feef : CALL 0x0051bf30
0055fef4 : MOV EDX,0xfeff
0055fef9 : AND word ptr [ESP + 0x3e],DX
0055fefe : JMP 0x0055ff2d
0055ff00 : MOV EAX,0x100
0055ff05 : TEST word ptr [ESI + 0x2a],AX
0055ff09 : JZ 0x0055ff2d
0055ff0b : LEA EDI,[ESI + 0x10]
0055ff0e : MOV ECX,EDI
0055ff10 : CALL 0x0051b1a0
0055ff15 : TEST EAX,EAX
0055ff17 : JZ 0x0055ff2d
0055ff19 : PUSH EDI
0055ff1a : LEA ECX,[ESP + 0x28]
0055ff1e : CALL 0x0051bc20
0055ff23 : MOV ECX,0x100
0055ff28 : OR word ptr [ESP + 0x3e],CX
0055ff2d : MOV DX,word ptr [ESI + 0x2a]
0055ff31 : SHR DX,0x9
0055ff35 : POP EDI
0055ff36 : TEST BL,DL
0055ff38 : JZ 0x0055ff5f
0055ff3a : MOV ESI,dword ptr [ESI + 0x18]
0055ff3d : TEST ESI,ESI
0055ff3f : JZ 0x0055ff44
0055ff41 : ADD dword ptr [ESI + 0x4],EBX
0055ff44 : MOV ECX,dword ptr [ESP + 0x28]
0055ff48 : TEST ECX,ECX
0055ff4a : JZ 0x0055ff51
0055ff4c : CALL 0x004ff7c0
0055ff51 : MOV EAX,0x200
0055ff56 : OR word ptr [ESP + 0x3a],AX
0055ff5b : MOV dword ptr [ESP + 0x28],ESI
0055ff5f : MOV ECX,dword ptr [ESP + 0x1c]
0055ff63 : MOV ESI,dword ptr [ESP + 0x40]
0055ff67 : PUSH ECX
0055ff68 : LEA EDX,[ESP + 0x1c]
0055ff6c : MOV dword ptr [ESI],0xcd3f2c
0055ff72 : PUSH EDX
0055ff73 : LEA ECX,[ESI + 0x8]
0055ff76 : MOV dword ptr [ESI + 0x4],EBX
0055ff79 : MOV dword ptr [ESI],0xb86530
0055ff7f : MOV byte ptr [ESP + 0x12],0x0
0055ff84 : CALL 0x0051c380
0055ff89 : MOV EAX,dword ptr [ESP + 0x1c]
0055ff8d : PUSH EAX
0055ff8e : LEA ECX,[ESP + 0x24]
0055ff92 : PUSH ECX
0055ff93 : LEA ECX,[ESI + 0x10]
0055ff96 : MOV byte ptr [ESP + 0x13],0x0
0055ff9b : CALL 0x0051c380
0055ffa0 : MOV EAX,dword ptr [ESP + 0x28]
0055ffa4 : TEST EAX,EAX
0055ffa6 : JZ 0x0055ffaf
0055ffa8 : ADD dword ptr [EAX + 0x4],EBX
0055ffab : MOV EAX,dword ptr [ESP + 0x28]
0055ffaf : MOV dword ptr [ESI + 0x18],EAX
0055ffb2 : MOV EAX,dword ptr [ESP + 0x2c]
0055ffb6 : TEST EAX,EAX
0055ffb8 : JZ 0x0055ffc0
0055ffba : ADD dword ptr [EAX],EBX
0055ffbc : MOV EAX,dword ptr [ESP + 0x2c]
0055ffc0 : MOV EDX,dword ptr [ESP + 0x30]
0055ffc4 : MOV CX,word ptr [ESP + 0x36]
0055ffc9 : MOV dword ptr [ESI + 0x1c],EAX
0055ffcc : MOVZX EAX,word ptr [ESP + 0x34]
0055ffd1 : MOV word ptr [ESI + 0x24],AX
0055ffd5 : MOVZX EAX,word ptr [ESP + 0x3a]
0055ffda : MOV dword ptr [ESI + 0x20],EDX
0055ffdd : MOV DL,byte ptr [ESP + 0x38]
0055ffe1 : MOV word ptr [ESI + 0x26],CX
0055ffe5 : LEA ECX,[ESP + 0x10]
0055ffe9 : MOV byte ptr [ESI + 0x28],DL
0055ffec : MOV word ptr [ESI + 0x2a],AX
0055fff0 : CALL 0x00504260
0055fff5 : MOV EAX,ESI
0055fff7 : POP ESI
0055fff8 : POP EBX
0055fff9 : ADD ESP,0x34
0055fffc : RET 0x8
