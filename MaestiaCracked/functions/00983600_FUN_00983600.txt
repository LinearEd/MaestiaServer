PROGRAM  : Maestia.exe
FUNCTION : FUN_00983600
ENTRY    : 00983600
BODY     : [[00983600, 00983728] [00983730, 00983a52]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00983600(void)

{
  undefined2 uVar1;
  short sVar2;
  undefined4 *puVar3;
  int iVar4;
  int iVar5;
  undefined1 *puVar6;
  int in_EDX;
  uint uVar7;
  undefined4 *******pppppppuVar8;
  undefined1 auStack_134 [28];
  uint uStack_118;
  int iStack_114;
  int iStack_110;
  int iStack_10c;
  int iStack_108;
  float local_104;
  int iStack_100;
  int iStack_fc;
  int iStack_f8;
  float local_f4;
  int local_f0;
  undefined4 uStack_ec;
  undefined4 uStack_e8;
  undefined4 uStack_e4;
  float fStack_e0;
  float fStack_dc;
  float fStack_d8;
  undefined2 uStack_d0;
  undefined4 uStack_c0;
  uint uStack_bc;
  undefined4 ******appppppuStack_b4 [4];
  int iStack_a4;
  uint uStack_a0;
  undefined1 auStack_9c [24];
  uint local_84;
  void *local_4c;
  undefined1 *puStack_48;
  int iStack_44;
  
  iStack_44 = 0xffffffff;
  puStack_48 = &LAB_00b5ae11;
  local_4c = ExceptionList;
  local_84 = DAT_00d66fa0 ^ (uint)auStack_134;
  ExceptionList = &local_4c;
  iVar4 = *DAT_00da9894;
  local_f0 = in_EDX;
  if ((iVar4 != 0) && (*(int *)(iVar4 + 0x114) != 0)) {
    (**(code **)**(undefined4 **)(iVar4 + 0x114))
              ("ZoneMapClearNPC",DAT_00d66fa0 ^ (uint)&stack0xfffffec0);
  }
  if (*(short *)(in_EDX + 0x6e) == *(short *)(in_EDX + 0x6c)) {
    if ((*DAT_00da9894 != 0) &&
       (puVar3 = *(undefined4 **)(*DAT_00da9894 + 0x114), puVar3 != (undefined4 *)0x0)) {
      (**(code **)*puVar3)("MinimapClearNPC");
    }
    FUN_00983010();
  }
  else {
    FUN_00980690();
    iVar4 = FUN_00703c00(0x300);
    if (iVar4 != 0) {
      iStack_f8 = iVar4 + 0x29c;
      iStack_108 = (**(code **)(*(int *)(iVar4 + 0x29c) + 4))();
      uStack_118 = 0;
      iVar4 = iStack_10c;
      while (iStack_10c = iVar4, iStack_108 != 0) {
        iVar5 = FUN_004f5680();
        iVar4 = iStack_10c;
        if ((iVar5 != 0) && (*(int *)(iVar5 + 0x58) != 0x10)) {
          iStack_fc = iVar5 + 0x78;
          uStack_ec = 0;
          uStack_e8 = 0;
          uStack_e4 = 0;
          iStack_110 = 0;
          iStack_114 = 0;
          iStack_10c = (**(code **)(*(int *)(iVar5 + 0x78) + 4))();
          while (iVar4 = 0, iStack_10c != 0) {
            iVar4 = FUN_004f5680();
            iStack_100 = *(int *)(iVar4 + 0xf0);
            if (iStack_100 != 0) {
              FUN_00824a20(DAT_0172491c,0);
              iStack_44 = 0;
              if (iStack_a4 == 0) {
                FUN_00824a20(DAT_0172491c,0);
                iStack_44._0_1_ = 1;
                FUN_00405eb0();
                iStack_44 = (uint)iStack_44._1_3_ << 8;
                if (7 < uStack_bc) {
                    /* WARNING: Subroutine does not return */
                  FUN_006f04e0();
                }
                uStack_bc = 7;
                uStack_c0 = 0;
                uStack_d0 = 0;
              }
              puVar6 = *(undefined1 **)(iVar4 + 0xf0);
              if (puVar6 == (undefined1 *)0x0) {
                puVar6 = auStack_9c;
              }
              uVar1 = *(undefined2 *)(puVar6 + 4);
              fStack_e0 = (float)*(ushort *)(iVar4 + 0x82);
              fStack_dc = (float)*(ushort *)(iVar4 + 0x84);
              fStack_d8 = (float)*(ushort *)(iVar4 + 0x86);
              FUN_007e9290(*(undefined4 *)(DAT_00da93ec + 0xc));
              if (iStack_a4 == 0) {
                iStack_44 = 0xffffffff;
                if (7 < uStack_a0) {
                    /* WARNING: Subroutine does not return */
                  FUN_006f04e0();
                }
              }
              else {
                sVar2 = *(short *)(iStack_100 + 6);
                if ((((sVar2 == -0x38c5) || (sVar2 == -0x38c2)) || (sVar2 == -0x38b1)) ||
                   ((char)uVar1 == '\x02')) {
                  FUN_009802e0(local_f0);
                  iStack_114 = (int)(((float)iStack_114 - 256.0) * local_f4 + 256.0);
                  uVar7 = 0;
                  iStack_110 = (int)(((float)iStack_110 - 256.0) * local_104 + 256.0);
                  if (((sVar2 == -0x38c5) || (sVar2 == -0x38c2)) || (sVar2 == -0x38b1)) {
                    uVar7 = 0xffffffff;
                  }
                  else if (*(int *)(iVar4 + 0x154) != 0) {
                    uVar7 = (uint)*(ushort *)(*(int *)(iVar4 + 0x154) + 6) % 20000;
                  }
                  iVar4 = *DAT_00da9894;
                  if ((iVar4 != 0) && (*(int *)(iVar4 + 0x114) != 0)) {
                    pppppppuVar8 = (undefined4 *******)appppppuStack_b4[0];
                    if (uStack_a0 < 8) {
                      pppppppuVar8 = appppppuStack_b4;
                    }
                    (**(code **)(**(int **)(iVar4 + 0x114) + 4))
                              (*(int **)(iVar4 + 0x114),"ZoneMapSetNPC","%d,%ls,%f,%f,%d,%d",
                               uStack_118 & 0xffff,pppppppuVar8,(double)iStack_114,
                               (double)iStack_110,0,uVar7);
                    uStack_118 = uStack_118 + 1;
                  }
                }
                iStack_44 = 0xffffffff;
                if (7 < uStack_a0) {
                    /* WARNING: Subroutine does not return */
                  FUN_006f04e0();
                }
              }
              iStack_44 = 0xffffffff;
              appppppuStack_b4[0] = (undefined4 ******)((uint)appppppuStack_b4[0] & 0xffff0000);
              iStack_a4 = 0;
              uStack_a0 = 7;
            }
          }
        }
      }
    }
  }
  ExceptionList = local_4c;
  __security_check_cookie(local_84 ^ (uint)auStack_134);
  return;
}



============================================================
DISASSEMBLY
============================================================
00983600 : PUSH EBP
00983601 : MOV EBP,ESP
00983603 : AND ESP,0xffffffc0
00983606 : PUSH -0x1
00983608 : PUSH 0xb5ae11
0098360d : MOV EAX,FS:[0x0]
00983613 : PUSH EAX
00983614 : SUB ESP,0xe8
0098361a : MOV EAX,[0x00d66fa0]
0098361f : XOR EAX,ESP
00983621 : MOV dword ptr [ESP + 0xb0],EAX
00983628 : PUSH EBX
00983629 : PUSH ESI
0098362a : PUSH EDI
0098362b : MOV EAX,[0x00d66fa0]
00983630 : XOR EAX,ESP
00983632 : PUSH EAX
00983633 : LEA EAX,[ESP + 0xf8]
0098363a : MOV FS:[0x0],EAX
00983640 : MOV EDI,ECX
00983642 : MOV EAX,[0x00da9894]
00983647 : MOV EAX,dword ptr [EAX]
00983649 : XOR EBX,EBX
0098364b : MOV ESI,EDX
0098364d : MOV dword ptr [ESP + 0x54],ESI
00983651 : CMP EAX,EBX
00983653 : JZ 0x00983670
00983655 : CMP dword ptr [EAX + 0x114],EBX
0098365b : JZ 0x00983670
0098365d : MOV EAX,dword ptr [EAX + 0x114]
00983663 : MOV EDX,dword ptr [EAX]
00983665 : MOV ECX,EAX
00983667 : MOV EAX,dword ptr [EDX]
00983669 : PUSH 0xc803bc
0098366e : CALL EAX
00983670 : MOV CX,word ptr [ESI + 0x6e]
00983674 : CMP CX,word ptr [ESI + 0x6c]
00983678 : JZ 0x00983a06
0098367e : LEA EDX,[ESP + 0x40]
00983682 : PUSH EDX
00983683 : LEA EAX,[ESP + 0x54]
00983687 : PUSH EAX
00983688 : PUSH EDI
00983689 : MOV EAX,ESI
0098368b : CALL 0x00980690
00983690 : PUSH 0x300
00983695 : CALL 0x00703c00
0098369a : ADD ESP,0x4
0098369d : CMP EAX,EBX
0098369f : JZ 0x00983a2f
009836a5 : MOV EDX,dword ptr [EAX + 0x29c]
009836ab : LEA EDI,[EAX + 0x29c]
009836b1 : MOV EAX,dword ptr [EDX + 0x4]
009836b4 : MOV ECX,EDI
009836b6 : MOV dword ptr [ESP + 0x4c],EDI
009836ba : CALL EAX
009836bc : MOV dword ptr [ESP + 0x3c],EAX
009836c0 : MOV dword ptr [ESP + 0x2c],EBX
009836c4 : CMP EAX,EBX
009836c6 : JZ 0x00983a2f
009836cc : LEA ESP,[ESP]
009836d0 : LEA EDX,[ESP + 0x3c]
009836d4 : MOV EAX,EDI
009836d6 : CALL 0x004f5680
009836db : CMP EAX,EBX
009836dd : JZ 0x009839fa
009836e3 : CMP dword ptr [EAX + 0x58],0x10
009836e7 : JZ 0x009839fa
009836ed : XORPS XMM0,XMM0
009836f0 : MOV EDX,dword ptr [EAX + 0x78]
009836f3 : LEA ESI,[EAX + 0x78]
009836f6 : MOV EAX,dword ptr [EDX + 0x4]
009836f9 : MOV ECX,ESI
009836fb : MOVSS dword ptr [ESP + 0x58],XMM0
00983701 : MOVSS dword ptr [ESP + 0x5c],XMM0
00983707 : MOVSS dword ptr [ESP + 0x60],XMM0
0098370d : MOV dword ptr [ESP + 0x34],EBX
00983711 : MOV dword ptr [ESP + 0x30],EBX
00983715 : MOV dword ptr [ESP + 0x48],ESI
00983719 : CALL EAX
0098371b : MOV dword ptr [ESP + 0x38],EAX
0098371f : CMP EAX,EBX
00983721 : JZ 0x009839fa
00983727 : JMP 0x00983734
00983730 : MOV ESI,dword ptr [ESP + 0x48]
00983734 : LEA EDX,[ESP + 0x38]
00983738 : MOV EAX,ESI
0098373a : CALL 0x004f5680
0098373f : MOV EDI,EAX
00983741 : MOV EAX,dword ptr [EDI + 0xf0]
00983747 : MOV dword ptr [ESP + 0x44],EAX
0098374b : CMP EAX,EBX
0098374d : JZ 0x009839ec
00983753 : MOV ECX,dword ptr [0x0172491c]
00983759 : PUSH EBX
0098375a : LEA EDX,[EAX + 0x18]
0098375d : PUSH ECX
0098375e : LEA ESI,[ESP + 0x94]
00983765 : CALL 0x00824a20
0098376a : MOV dword ptr [ESP + 0x100],EBX
00983771 : CMP dword ptr [ESP + 0xa0],EBX
00983778 : JNZ 0x009837d9
0098377a : MOV EAX,[0x0172491c]
0098377f : PUSH EBX
00983780 : LEA EDX,[EDI + 0x18]
00983783 : PUSH EAX
00983784 : LEA ESI,[ESP + 0x78]
00983788 : CALL 0x00824a20
0098378d : MOV byte ptr [ESP + 0x100],0x1
00983795 : PUSH -0x1
00983797 : PUSH EBX
00983798 : PUSH EAX
00983799 : LEA ECX,[ESP + 0x98]
009837a0 : CALL 0x00405eb0
009837a5 : MOV byte ptr [ESP + 0x100],0x0
009837ad : CMP dword ptr [ESP + 0x88],0x8
009837b5 : JC 0x009837c0
009837b7 : MOV ECX,dword ptr [ESP + 0x74]
009837bb : CALL 0x006f04e0
009837c0 : XOR ECX,ECX
009837c2 : MOV dword ptr [ESP + 0x88],0x7
009837cd : MOV dword ptr [ESP + 0x84],EBX
009837d4 : MOV word ptr [ESP + 0x74],CX
009837d9 : MOV EAX,dword ptr [EDI + 0xf0]
009837df : CMP EAX,EBX
009837e1 : JNZ 0x009837ea
009837e3 : LEA EAX,[ESP + 0xa8]
009837ea : MOVZX EBX,word ptr [EAX + 0x4]
009837ee : MOVZX EDX,word ptr [EAX + 0x6]
009837f2 : MOVZX EAX,word ptr [EDI + 0x82]
009837f9 : MOVZX ECX,word ptr [EDI + 0x84]
00983800 : SHL EBX,0x10
00983803 : OR EBX,EDX
00983805 : MOVZX EDX,word ptr [EDI + 0x86]
0098380c : CVTSI2SS XMM0,EAX
00983810 : MOV EAX,[0x00da93ec]
00983815 : MOV EAX,dword ptr [EAX + 0xc]
00983818 : CVTSI2SS XMM1,ECX
0098381c : CVTSI2SS XMM2,EDX
00983820 : PUSH EAX
00983821 : LEA EDX,[ESP + 0x5c]
00983825 : LEA ECX,[ESP + 0x68]
00983829 : MOVSS dword ptr [ESP + 0x68],XMM0
0098382f : MOVSS dword ptr [ESP + 0x6c],XMM1
00983835 : MOVSS dword ptr [ESP + 0x70],XMM2
0098383b : CALL 0x007e9290
00983840 : CMP dword ptr [ESP + 0xa0],0x0
00983848 : JNZ 0x0098387a
0098384a : MOV dword ptr [ESP + 0x100],0xffffffff
00983855 : CMP dword ptr [ESP + 0xa4],0x8
0098385d : JC 0x0098386b
0098385f : MOV ECX,dword ptr [ESP + 0x90]
00983866 : CALL 0x006f04e0
0098386b : XOR ECX,ECX
0098386d : MOV word ptr [ESP + 0x90],CX
00983875 : JMP 0x009839d8
0098387a : MOV EDX,dword ptr [ESP + 0x44]
0098387e : MOVZX ESI,word ptr [EDX + 0x6]
00983882 : MOV EAX,0xc73b
00983887 : CMP SI,AX
0098388a : JZ 0x009838ac
0098388c : MOV ECX,0xc73e
00983891 : CMP SI,CX
00983894 : JZ 0x009838ac
00983896 : MOV EDX,0xc74f
0098389b : CMP SI,DX
0098389e : JZ 0x009838ac
009838a0 : SHR EBX,0x10
009838a3 : CMP BL,0x2
009838a6 : JNZ 0x009839ad
009838ac : MOV EAX,dword ptr [ESP + 0x54]
009838b0 : PUSH EAX
009838b1 : LEA ECX,[ESP + 0x34]
009838b5 : LEA EDX,[ESP + 0x5c]
009838b9 : CALL 0x009802e0
009838be : MOVSS XMM0,dword ptr [0x00cdf208]
009838c6 : CVTSI2SS XMM1,dword ptr [ESP + 0x30]
009838cc : MOV EDI,dword ptr [EDI + 0x154]
009838d2 : SUBSS XMM1,XMM0
009838d6 : MULSS XMM1,dword ptr [ESP + 0x50]
009838dc : ADDSS XMM1,XMM0
009838e0 : CVTTSS2SI EBX,XMM1
009838e4 : CVTSI2SS XMM1,dword ptr [ESP + 0x34]
009838ea : SUBSS XMM1,XMM0
009838ee : MULSS XMM1,dword ptr [ESP + 0x40]
009838f4 : MOV EAX,0xc73b
009838f9 : ADDSS XMM1,XMM0
009838fd : XOR EDX,EDX
009838ff : CVTTSS2SI ECX,XMM1
00983903 : MOV dword ptr [ESP + 0x30],EBX
00983907 : MOV dword ptr [ESP + 0x34],ECX
0098390b : CMP SI,AX
0098390e : JZ 0x00983936
00983910 : MOV ECX,0xc73e
00983915 : CMP SI,CX
00983918 : JZ 0x00983936
0098391a : MOV EAX,0xc74f
0098391f : CMP SI,AX
00983922 : JZ 0x00983936
00983924 : TEST EDI,EDI
00983926 : JZ 0x00983939
00983928 : MOVZX EAX,word ptr [EDI + 0x6]
0098392c : CDQ
0098392d : MOV ECX,0x4e20
00983932 : IDIV ECX
00983934 : JMP 0x00983939
00983936 : OR EDX,0xffffffff
00983939 : MOV EAX,[0x00da9894]
0098393e : MOV EAX,dword ptr [EAX]
00983940 : TEST EAX,EAX
00983942 : JZ 0x009839ad
00983944 : CMP dword ptr [EAX + 0x114],0x0
0098394b : JZ 0x009839ad
0098394d : CMP dword ptr [ESP + 0xa4],0x8
00983955 : MOVZX ECX,word ptr [ESP + 0x2c]
0098395a : MOV EAX,dword ptr [EAX + 0x114]
00983960 : MOV ESI,dword ptr [ESP + 0x90]
00983967 : JNC 0x00983970
00983969 : LEA ESI,[ESP + 0x90]
00983970 : CVTSI2SS XMM0,dword ptr [ESP + 0x34]
00983976 : MOV EDI,dword ptr [EAX]
00983978 : PUSH EDX
00983979 : PUSH 0x0
0098397b : SUB ESP,0x10
0098397e : CVTPS2PD XMM0,XMM0
00983981 : MOVSD qword ptr [ESP + 0x8],XMM0
00983987 : CVTSI2SS XMM0,EBX
0098398b : CVTSS2SD XMM0,XMM0
0098398f : MOVSD qword ptr [ESP],XMM0
00983994 : PUSH ESI
00983995 : PUSH ECX
00983996 : MOV ECX,dword ptr [EDI + 0x4]
00983999 : PUSH 0xc803cc
0098399e : PUSH 0xc803e0
009839a3 : PUSH EAX
009839a4 : CALL ECX
009839a6 : ADD ESP,0x2c
009839a9 : INC dword ptr [ESP + 0x2c]
009839ad : MOV dword ptr [ESP + 0x100],0xffffffff
009839b8 : CMP dword ptr [ESP + 0xa4],0x8
009839c0 : JC 0x009839ce
009839c2 : MOV ECX,dword ptr [ESP + 0x90]
009839c9 : CALL 0x006f04e0
009839ce : XOR EDX,EDX
009839d0 : MOV word ptr [ESP + 0x90],DX
009839d8 : XOR EBX,EBX
009839da : MOV dword ptr [ESP + 0xa0],EBX
009839e1 : MOV dword ptr [ESP + 0xa4],0x7
009839ec : CMP dword ptr [ESP + 0x38],EBX
009839f0 : JNZ 0x00983730
009839f6 : MOV EDI,dword ptr [ESP + 0x4c]
009839fa : CMP dword ptr [ESP + 0x3c],EBX
009839fe : JNZ 0x009836d0
00983a04 : JMP 0x00983a2f
00983a06 : MOV EAX,[0x00da9894]
00983a0b : MOV EAX,dword ptr [EAX]
00983a0d : CMP EAX,EBX
00983a0f : JZ 0x00983a28
00983a11 : MOV EAX,dword ptr [EAX + 0x114]
00983a17 : CMP EAX,EBX
00983a19 : JZ 0x00983a28
00983a1b : MOV EDX,dword ptr [EAX]
00983a1d : MOV ECX,EAX
00983a1f : MOV EAX,dword ptr [EDX]
00983a21 : PUSH 0xc803f0
00983a26 : CALL EAX
00983a28 : MOV ECX,ESI
00983a2a : CALL 0x00983010
00983a2f : MOV ECX,dword ptr [ESP + 0xf8]
00983a36 : MOV dword ptr FS:[0x0],ECX
00983a3d : POP ECX
00983a3e : POP EDI
00983a3f : POP ESI
00983a40 : POP EBX
00983a41 : MOV ECX,dword ptr [ESP + 0xb0]
00983a48 : XOR ECX,ESP
00983a4a : CALL 0x00633e6b
00983a4f : MOV ESP,EBP
00983a51 : POP EBP
00983a52 : RET
