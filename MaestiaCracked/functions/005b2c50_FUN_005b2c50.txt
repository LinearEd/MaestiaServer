PROGRAM  : Maestia.exe
FUNCTION : FUN_005b2c50
ENTRY    : 005b2c50
BODY     : [[005b2c50, 005b2da7] [005b2db0, 005b2eec]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 * FUN_005b2c50(undefined4 *param_1,int param_2,int *param_3,char *param_4,uint param_5)

{
  int *piVar1;
  undefined4 *puVar2;
  int iVar3;
  undefined4 uVar4;
  int iVar5;
  LONG LVar6;
  int iVar7;
  uint uVar8;
  int iVar9;
  int iVar10;
  char *local_20;
  int local_1c;
  int local_18;
  int *local_14;
  undefined1 local_10 [4];
  int *local_c;
  
  puVar2 = param_1;
  iVar5 = param_2 + 0x78;
  uVar4 = FUN_005324f0(*(undefined4 *)(*(int *)(param_2 + 0x78) + 0x2a0),
                       *(int *)(param_2 + 0x78) + 0x10,0,0xffffffff);
  piVar1 = (int *)*param_3;
  iVar7 = *piVar1;
  *param_1 = uVar4;
  if ((int)param_5 < 0) {
    param_5 = 0;
  }
  param_2 = iVar7;
  if (param_4 == (char *)0x0) {
    local_10[0] = 5;
    piVar1[2] = piVar1[2] + 1;
    local_c = piVar1;
    FUN_00585540(local_10);
    FUN_00526bc0();
    return param_1;
  }
  if (*param_4 == '\0') {
    FUN_0051b6e0();
    iVar5 = FUN_0051aa70(&param_2);
    while (iVar5 != 0) {
      FUN_0051bf30();
      FUN_0051b7e0(iVar5);
      iVar5 = FUN_00525450((uint *)(param_5 & 0xfffffffc) + 2,
                           *(uint *)(param_5 & 0xfffffffc) & 0x7fffffff);
      *(int *)(iVar5 + 8) = *(int *)(iVar5 + 8) + 1;
      local_10[0] = 5;
      *(int *)(iVar5 + 8) = *(int *)(iVar5 + 8) + 1;
      local_c = (int *)iVar5;
      FUN_00585540(local_10);
      FUN_00526bc0();
      piVar1 = (int *)(iVar5 + 8);
      *piVar1 = *piVar1 + -1;
      if (*piVar1 == 0) {
        FUN_00525340();
      }
      iVar5 = FUN_0051aa70(&param_2);
    }
    uVar8 = param_5 & 0xfffffffc;
    LVar6 = InterlockedExchangeAdd((LONG *)(uVar8 + 4),-1);
    if (LVar6 == 1) {
      FUN_00515cf0(uVar8);
      return param_1;
    }
  }
  else {
    param_1 = (undefined4 *)0x0;
    do {
      iVar10 = param_2;
      local_20 = param_4;
      iVar9 = 0;
      do {
        local_18 = param_2;
        param_3 = (int *)FUN_0051aa70(&param_2);
        local_14 = (int *)FUN_0051aa70(&local_20);
        if (iVar9 == 0) {
          iVar9 = param_2;
        }
        iVar3 = param_2;
        if (param_3 == (int *)0x0) break;
        if (local_14 == (int *)0x0) goto LAB_005b2e04;
        iVar3 = iVar9;
      } while (param_3 == local_14);
      param_2 = iVar3;
      if (local_14 == (int *)0x0) {
LAB_005b2e04:
        if ((int)param_5 <= (int)param_1) {
          return puVar2;
        }
        local_c = (int *)FUN_005b1ff0(&local_1c,iVar5,iVar7,iVar10);
        local_10[0] = 5;
        local_c = (int *)*local_c;
        *(int *)((int)local_c + 8) = *(int *)((int)local_c + 8) + 1;
        FUN_00585540(local_10);
        FUN_00526bc0();
        *(int *)(local_1c + 8) = *(int *)(local_1c + 8) + -1;
        if (*(int *)(local_1c + 8) == 0) {
          FUN_00525340();
        }
        param_1 = (undefined4 *)((int)param_1 + 1);
        param_2 = local_18;
        iVar7 = local_18;
      }
    } while (param_3 != (int *)0x0);
    if ((int)param_1 < (int)param_5) {
      if (local_14 != (int *)0x0) {
        iVar10 = 0;
      }
      local_c = (int *)FUN_005b1ff0(&param_5,iVar5,iVar7,iVar10);
      local_10[0] = 5;
      local_c = (int *)*local_c;
      *(int *)((int)local_c + 8) = *(int *)((int)local_c + 8) + 1;
      FUN_00585540(local_10);
      FUN_00526bc0();
      *(int *)(param_5 + 8) = *(int *)(param_5 + 8) + -1;
      if (*(int *)(param_5 + 8) == 0) {
        FUN_00525340();
      }
    }
  }
  return puVar2;
}



============================================================
DISASSEMBLY
============================================================
005b2c50 : SUB ESP,0x24
005b2c53 : MOV ECX,dword ptr [ESP + 0x2c]
005b2c57 : MOV EAX,dword ptr [ECX + 0x78]
005b2c5a : MOV EDX,dword ptr [EAX + 0x2a0]
005b2c60 : PUSH EBX
005b2c61 : PUSH EBP
005b2c62 : PUSH ESI
005b2c63 : PUSH EDI
005b2c64 : LEA EDI,[ECX + 0x78]
005b2c67 : OR EBX,0xffffffff
005b2c6a : PUSH EBX
005b2c6b : PUSH 0x0
005b2c6d : ADD EAX,0x10
005b2c70 : PUSH EAX
005b2c71 : PUSH EDX
005b2c72 : CALL 0x005324f0
005b2c77 : CMP dword ptr [ESP + 0x48],0x0
005b2c7c : MOV ECX,dword ptr [ESP + 0x40]
005b2c80 : MOV ECX,dword ptr [ECX]
005b2c82 : MOV EBP,dword ptr [ESP + 0x38]
005b2c86 : MOV EDX,dword ptr [ECX]
005b2c88 : MOV dword ptr [EBP],EAX
005b2c8b : MOV dword ptr [ESP + 0x3c],EDX
005b2c8f : JGE 0x005b2c99
005b2c91 : MOV dword ptr [ESP + 0x48],0x0
005b2c99 : MOV ESI,dword ptr [ESP + 0x44]
005b2c9d : TEST ESI,ESI
005b2c9f : JNZ 0x005b2ccc
005b2ca1 : MOV dword ptr [ESP + 0x28],ECX
005b2ca5 : MOV byte ptr [ESP + 0x24],0x5
005b2caa : INC dword ptr [ECX + 0x8]
005b2cad : LEA EDX,[ESP + 0x24]
005b2cb1 : PUSH EDX
005b2cb2 : MOV ECX,EAX
005b2cb4 : CALL 0x00585540
005b2cb9 : LEA ECX,[ESP + 0x24]
005b2cbd : CALL 0x00526bc0
005b2cc2 : POP EDI
005b2cc3 : POP ESI
005b2cc4 : MOV EAX,EBP
005b2cc6 : POP EBP
005b2cc7 : POP EBX
005b2cc8 : ADD ESP,0x24
005b2ccb : RET
005b2ccc : CMP byte ptr [ESI],0x0
005b2ccf : JNZ 0x005b2d9c
005b2cd5 : LEA ECX,[ESP + 0x48]
005b2cd9 : CALL 0x0051b6e0
005b2cde : LEA EAX,[ESP + 0x3c]
005b2ce2 : PUSH EAX
005b2ce3 : CALL 0x0051aa70
005b2ce8 : MOV ESI,EAX
005b2cea : TEST ESI,ESI
005b2cec : JZ 0x005b2d71
005b2cf2 : LEA ECX,[ESP + 0x48]
005b2cf6 : CALL 0x0051bf30
005b2cfb : PUSH ESI
005b2cfc : LEA ECX,[ESP + 0x4c]
005b2d00 : CALL 0x0051b7e0
005b2d05 : MOV ECX,dword ptr [ESP + 0x48]
005b2d09 : MOV EAX,dword ptr [EDI]
005b2d0b : AND ECX,0xfffffffc
005b2d0e : MOV EDX,dword ptr [ECX]
005b2d10 : AND EDX,0x7fffffff
005b2d16 : ADD ECX,0x8
005b2d19 : PUSH EDX
005b2d1a : ADD EAX,0x8
005b2d1d : PUSH ECX
005b2d1e : LEA ECX,[EAX + 0x24c]
005b2d24 : CALL 0x00525450
005b2d29 : MOV ECX,dword ptr [EBP]
005b2d2c : MOV ESI,EAX
005b2d2e : MOV EAX,0x1
005b2d33 : ADD dword ptr [ESI + 0x8],EAX
005b2d36 : LEA EDX,[ESP + 0x24]
005b2d3a : MOV byte ptr [ESP + 0x24],0x5
005b2d3f : MOV dword ptr [ESP + 0x28],ESI
005b2d43 : ADD dword ptr [ESI + 0x8],EAX
005b2d46 : PUSH EDX
005b2d47 : CALL 0x00585540
005b2d4c : LEA ECX,[ESP + 0x24]
005b2d50 : CALL 0x00526bc0
005b2d55 : ADD dword ptr [ESI + 0x8],EBX
005b2d58 : JNZ 0x005b2d61
005b2d5a : MOV ECX,ESI
005b2d5c : CALL 0x00525340
005b2d61 : LEA EAX,[ESP + 0x3c]
005b2d65 : PUSH EAX
005b2d66 : CALL 0x0051aa70
005b2d6b : MOV ESI,EAX
005b2d6d : TEST ESI,ESI
005b2d6f : JNZ 0x005b2cf2
005b2d71 : MOV ESI,dword ptr [ESP + 0x48]
005b2d75 : AND ESI,0xfffffffc
005b2d78 : PUSH EBX
005b2d79 : LEA ECX,[ESI + 0x4]
005b2d7c : PUSH ECX
005b2d7d : CALL dword ptr [0x00b851cc]
005b2d83 : ADD EAX,-0x1
005b2d86 : JNZ 0x005b2ee3
005b2d8c : PUSH ESI
005b2d8d : CALL 0x00515cf0
005b2d92 : POP EDI
005b2d93 : POP ESI
005b2d94 : MOV EAX,EBP
005b2d96 : POP EBP
005b2d97 : POP EBX
005b2d98 : ADD ESP,0x24
005b2d9b : RET
005b2d9c : MOV dword ptr [ESP + 0x38],0x0
005b2da4 : MOV EBX,EDX
005b2da6 : JMP 0x005b2db4
005b2db0 : MOV ESI,dword ptr [ESP + 0x44]
005b2db4 : MOV dword ptr [ESP + 0x14],ESI
005b2db8 : MOV dword ptr [ESP + 0x10],EDX
005b2dbc : XOR ESI,ESI
005b2dbe : MOV EDI,EDI
005b2dc0 : MOV dword ptr [ESP + 0x1c],EDX
005b2dc4 : LEA EDX,[ESP + 0x3c]
005b2dc8 : PUSH EDX
005b2dc9 : CALL 0x0051aa70
005b2dce : MOV dword ptr [ESP + 0x40],EAX
005b2dd2 : LEA EAX,[ESP + 0x14]
005b2dd6 : PUSH EAX
005b2dd7 : CALL 0x0051aa70
005b2ddc : MOV EDX,dword ptr [ESP + 0x3c]
005b2de0 : MOV dword ptr [ESP + 0x20],EAX
005b2de4 : TEST ESI,ESI
005b2de6 : JNZ 0x005b2dea
005b2de8 : MOV ESI,EDX
005b2dea : MOV ECX,dword ptr [ESP + 0x40]
005b2dee : TEST ECX,ECX
005b2df0 : JZ 0x005b2e00
005b2df2 : TEST EAX,EAX
005b2df4 : JZ 0x005b2e04
005b2df6 : CMP ECX,EAX
005b2df8 : JZ 0x005b2dc0
005b2dfa : MOV EDX,ESI
005b2dfc : MOV dword ptr [ESP + 0x3c],EDX
005b2e00 : TEST EAX,EAX
005b2e02 : JNZ 0x005b2e7b
005b2e04 : MOV ECX,dword ptr [ESP + 0x38]
005b2e08 : CMP ECX,dword ptr [ESP + 0x48]
005b2e0c : JGE 0x005b2ee3
005b2e12 : MOV EDX,dword ptr [ESP + 0x10]
005b2e16 : PUSH EDX
005b2e17 : PUSH EBX
005b2e18 : LEA EAX,[ESP + 0x20]
005b2e1c : PUSH EDI
005b2e1d : PUSH EAX
005b2e1e : CALL 0x005b1ff0
005b2e23 : MOV ECX,dword ptr [EBP]
005b2e26 : MOV byte ptr [ESP + 0x34],0x5
005b2e2b : MOV EAX,dword ptr [EAX]
005b2e2d : ADD ESP,0x10
005b2e30 : LEA EDX,[ESP + 0x24]
005b2e34 : MOV dword ptr [ESP + 0x28],EAX
005b2e38 : MOV ESI,0x1
005b2e3d : ADD dword ptr [EAX + 0x8],ESI
005b2e40 : PUSH EDX
005b2e41 : CALL 0x00585540
005b2e46 : LEA ECX,[ESP + 0x24]
005b2e4a : CALL 0x00526bc0
005b2e4f : MOV EAX,dword ptr [ESP + 0x18]
005b2e53 : DEC dword ptr [EAX + 0x8]
005b2e56 : MOV ECX,EAX
005b2e58 : ADD EAX,0x8
005b2e5b : CMP dword ptr [EAX],0x0
005b2e5e : JNZ 0x005b2e65
005b2e60 : CALL 0x00525340
005b2e65 : MOV EDX,dword ptr [ESP + 0x1c]
005b2e69 : ADD dword ptr [ESP + 0x38],ESI
005b2e6d : MOV EAX,dword ptr [ESP + 0x20]
005b2e71 : MOV ECX,dword ptr [ESP + 0x40]
005b2e75 : MOV EBX,EDX
005b2e77 : MOV dword ptr [ESP + 0x3c],EDX
005b2e7b : TEST ECX,ECX
005b2e7d : JNZ 0x005b2db0
005b2e83 : MOV ECX,dword ptr [ESP + 0x48]
005b2e87 : CMP dword ptr [ESP + 0x38],ECX
005b2e8b : JGE 0x005b2ee3
005b2e8d : TEST EAX,EAX
005b2e8f : LEA EAX,[ESP + 0x48]
005b2e93 : JNZ 0x005b2e9c
005b2e95 : MOV EDX,dword ptr [ESP + 0x10]
005b2e99 : PUSH EDX
005b2e9a : JMP 0x005b2e9e
005b2e9c : PUSH 0x0
005b2e9e : PUSH EBX
005b2e9f : PUSH EDI
005b2ea0 : PUSH EAX
005b2ea1 : CALL 0x005b1ff0
005b2ea6 : MOV ECX,dword ptr [EBP]
005b2ea9 : MOV byte ptr [ESP + 0x34],0x5
005b2eae : MOV EAX,dword ptr [EAX]
005b2eb0 : ADD ESP,0x10
005b2eb3 : LEA EDX,[ESP + 0x24]
005b2eb7 : MOV dword ptr [ESP + 0x28],EAX
005b2ebb : INC dword ptr [EAX + 0x8]
005b2ebe : PUSH EDX
005b2ebf : CALL 0x00585540
005b2ec4 : LEA ECX,[ESP + 0x24]
005b2ec8 : CALL 0x00526bc0
005b2ecd : MOV EAX,dword ptr [ESP + 0x48]
005b2ed1 : DEC dword ptr [EAX + 0x8]
005b2ed4 : MOV ECX,EAX
005b2ed6 : ADD EAX,0x8
005b2ed9 : CMP dword ptr [EAX],0x0
005b2edc : JNZ 0x005b2ee3
005b2ede : CALL 0x00525340
005b2ee3 : POP EDI
005b2ee4 : POP ESI
005b2ee5 : MOV EAX,EBP
005b2ee7 : POP EBP
005b2ee8 : POP EBX
005b2ee9 : ADD ESP,0x24
005b2eec : RET
