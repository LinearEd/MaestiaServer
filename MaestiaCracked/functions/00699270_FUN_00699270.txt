PROGRAM  : Maestia.exe
FUNCTION : FUN_00699270
ENTRY    : 00699270
BODY     : [[00699270, 006992b7] [006992c0, 00699416] [00699420, 0069954c] [00699550, 006995bd]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00699270(undefined4 *param_1)

{
  int *piVar1;
  uint *puVar2;
  undefined4 *puVar3;
  uint *puVar4;
  bool bVar5;
  undefined4 *puVar6;
  uint uVar7;
  ushort uVar8;
  uint uVar9;
  int iVar10;
  int extraout_EDX;
  uint uVar11;
  uint uVar12;
  uint *puVar13;
  uint *puVar14;
  uint *local_28;
  uint *local_24;
  int local_20;
  uint local_1c;
  uint *puStack_18;
  uint uStack_14;
  uint local_10;
  int iStack_c;
  uint uStack_8;
  uint uStack_4;
  
  FUN_00698d40();
  FUN_00698d40();
  FUN_00698d40();
  local_10 = (int)param_1[0x14] >> ((byte)*param_1 & 0x1f) & 0xffff;
  local_1c = (int)param_1[0x15] >> ((byte)*param_1 & 0x1f) & 0xffff;
  puVar6 = (undefined4 *)param_1[0x18];
  while (puVar6 != (undefined4 *)0x0) {
    puVar3 = (undefined4 *)puVar6[1];
    uVar8 = (*(short *)(puVar6 + 4) + *(short *)(puVar6 + 5)) - 1;
    if ((short)*(ushort *)(puVar6 + 5) < (short)local_1c) {
      local_1c = (uint)*(ushort *)(puVar6 + 5);
    }
    bVar5 = (short)local_10 < (short)uVar8;
    if (bVar5) {
      local_10 = (uint)uVar8;
    }
    *puVar6 = 0;
    FUN_00698d50();
    puVar6 = puVar3;
  }
  if (param_1[0xd] == 0) {
    param_1[0xc] = 0x14;
    return 1;
  }
  (*(code *)param_1[0x2a])(param_1,&local_1c,&local_10);
  for (iVar10 = local_20; iVar10 != 0; iVar10 = *(int *)(iVar10 + 4)) {
    *(uint *)(iVar10 + 0x18) = (uint)(ushort)(*(short *)(iVar10 + 0x14) - (short)local_1c);
  }
  iVar10 = param_1[0xd];
  uVar11 = local_1c & 0xffff;
  if ((0 < iVar10) && (*(int *)(param_1[9] + iVar10 * -4) == (int)(short)local_1c)) {
    param_1[0xd] = iVar10 + -1;
  }
  iVar10 = param_1[0xd];
  uStack_14 = uVar11;
  uVar9 = 0;
  while( true ) {
    if (iVar10 < 1) {
      if ((short)uVar11 <= (short)local_10) {
        do {
          (*(code *)param_1[0x2d])(param_1);
          uVar11 = uVar11 + 1;
        } while ((short)uVar11 <= (short)local_10);
      }
      return 0;
    }
    if (local_20 != 0) {
      iVar10 = local_20;
      do {
        piVar1 = (int *)(iVar10 + 0x18);
        *piVar1 = *piVar1 - (int)(short)uVar9;
        iVar10 = *(int *)(iVar10 + 4);
        if (*piVar1 == 0) {
          FUN_00698d80();
          if ((*(int *)(extraout_EDX + 0xc) == -1) || (*(int *)(extraout_EDX + 0xc) == 1)) {
            FUN_00698d50();
          }
        }
      } while (iVar10 != 0);
    }
    FUN_00698da0();
    FUN_00698da0();
    uVar8 = *(ushort *)(param_1[9] + param_1[0xd] * -4);
    uStack_4 = (uint)uVar8;
    param_1[0xd] = param_1[0xd] + -1;
    uStack_8 = uStack_4 - uVar11 & 0xffff;
    puVar4 = local_28;
    if ((short)uVar11 < (short)uVar8) break;
joined_r0x00699549:
    while (puVar13 = local_24, puVar4 != (uint *)0x0) {
      puVar13 = puVar4 + 4;
      puVar4 = (uint *)puVar4[1];
      if (*puVar13 == 0) {
        FUN_00698d80();
      }
    }
    while (puVar13 != (uint *)0x0) {
      puVar4 = puVar13 + 4;
      puVar13 = (uint *)puVar13[1];
      if (*puVar4 == 0) {
        FUN_00698d80();
      }
    }
    iVar10 = param_1[0xd];
    uVar9 = uStack_8;
  }
  do {
    iStack_c = 0;
    puStack_18 = local_24;
    puVar13 = local_28;
    if (local_28 != (uint *)0x0) {
      do {
        uVar11 = *puVar13;
        uVar9 = *puStack_18;
        uVar7 = uVar11;
        if ((int)uVar9 < (int)uVar11) {
          uVar7 = uVar9;
          uVar9 = uVar11;
        }
        iVar10 = param_1[1];
        if (iVar10 < (int)(uVar9 - uVar7)) {
LAB_0069949e:
          (*(code *)param_1[0x2b])(param_1,uStack_14,uVar7,uVar9,puVar13,puStack_18);
        }
        else {
          uVar11 = -iVar10 & uVar7;
          uVar12 = iVar10 + -1 + uVar9 & -iVar10;
          if (((int)uVar11 <= (int)uVar12) && (uVar12 != iVar10 + uVar11)) goto LAB_0069949e;
          if (*(char *)(param_1 + 0x2e) != '\x02') {
            *puVar13 = uVar7;
            *puStack_18 = uVar9;
            iStack_c = iStack_c + 1;
            puVar13[6] = 1;
          }
        }
        puVar14 = puVar13 + 1;
        puStack_18 = (uint *)puStack_18[1];
        puVar13 = (uint *)*puVar14;
      } while ((uint *)*puVar14 != (uint *)0x0);
      uVar11 = uStack_14;
      puVar13 = local_28;
      puVar14 = local_24;
      if (0 < (short)iStack_c) {
        do {
          if (puVar13[6] != 0) {
            puVar13[6] = 0;
            (*(code *)param_1[0x2c])(param_1,uStack_14,*puVar13,*puVar14,puVar13,puVar14);
          }
          puVar2 = puVar13 + 1;
          uVar11 = uStack_14;
          puVar13 = (uint *)*puVar2;
          puVar14 = (uint *)puVar14[1];
        } while ((uint *)*puVar2 != (uint *)0x0);
      }
    }
    (*(code *)param_1[0x2d])(param_1);
    uVar11 = uVar11 + 1;
    uStack_14 = uVar11;
    if ((short)uStack_4 <= (short)uVar11) goto joined_r0x00699549;
    FUN_00698da0();
    FUN_00698da0();
  } while( true );
}



============================================================
DISASSEMBLY
============================================================
00699270 : SUB ESP,0x28
00699273 : PUSH EBP
00699274 : PUSH ESI
00699275 : LEA EAX,[ESP + 0x10]
00699279 : CALL 0x00698d40
0069927e : LEA EAX,[ESP + 0x8]
00699282 : CALL 0x00698d40
00699287 : LEA EAX,[ESP + 0xc]
0069928b : CALL 0x00698d40
00699290 : MOV EBP,dword ptr [ESP + 0x34]
00699294 : MOV ECX,dword ptr [EBP]
00699297 : MOV EAX,dword ptr [EBP + 0x50]
0069929a : MOV EDX,dword ptr [EBP + 0x60]
0069929d : SAR EAX,CL
0069929f : MOVZX EAX,AX
006992a2 : MOV dword ptr [ESP + 0x20],EAX
006992a6 : MOV EAX,dword ptr [EBP + 0x54]
006992a9 : SAR EAX,CL
006992ab : MOVZX ECX,AX
006992ae : MOV dword ptr [ESP + 0x14],ECX
006992b2 : TEST EDX,EDX
006992b4 : JZ 0x00699305
006992b6 : JMP 0x006992c0
006992c0 : MOV CX,word ptr [EDX + 0x10]
006992c4 : ADD CX,word ptr [EDX + 0x14]
006992c8 : MOVZX EAX,word ptr [EDX + 0x14]
006992cc : MOV ESI,dword ptr [EDX + 0x4]
006992cf : DEC CX
006992d1 : CMP word ptr [ESP + 0x14],AX
006992d6 : MOVZX ECX,CX
006992d9 : JLE 0x006992e2
006992db : MOVZX EAX,AX
006992de : MOV dword ptr [ESP + 0x14],EAX
006992e2 : CMP word ptr [ESP + 0x20],CX
006992e7 : JGE 0x006992f0
006992e9 : MOVZX ECX,CX
006992ec : MOV dword ptr [ESP + 0x20],ECX
006992f0 : LEA ECX,[ESP + 0x10]
006992f4 : MOV dword ptr [EDX],0x0
006992fa : CALL 0x00698d50
006992ff : MOV EDX,ESI
00699301 : TEST ESI,ESI
00699303 : JNZ 0x006992c0
00699305 : CMP dword ptr [EBP + 0x34],0x0
00699309 : JNZ 0x0069931a
0069930b : POP ESI
0069930c : MOV dword ptr [EBP + 0x30],0x14
00699313 : MOV AL,0x1
00699315 : POP EBP
00699316 : ADD ESP,0x28
00699319 : RET
0069931a : MOV ECX,dword ptr [EBP + 0xa8]
00699320 : LEA EDX,[ESP + 0x20]
00699324 : PUSH EDX
00699325 : LEA EAX,[ESP + 0x18]
00699329 : PUSH EAX
0069932a : PUSH EBP
0069932b : CALL ECX
0069932d : MOV EDX,dword ptr [ESP + 0x1c]
00699331 : ADD ESP,0xc
00699334 : MOV EAX,EDX
00699336 : TEST EDX,EDX
00699338 : JZ 0x00699356
0069933a : LEA EBX,[EBX]
00699340 : MOV CX,word ptr [EAX + 0x14]
00699344 : SUB CX,word ptr [ESP + 0x14]
00699349 : MOVZX ECX,CX
0069934c : MOV dword ptr [EAX + 0x18],ECX
0069934f : MOV EAX,dword ptr [EAX + 0x4]
00699352 : TEST EAX,EAX
00699354 : JNZ 0x00699340
00699356 : MOV ECX,dword ptr [ESP + 0x14]
0069935a : MOV EAX,dword ptr [EBP + 0x34]
0069935d : PUSH EBX
0069935e : MOVZX EBX,CX
00699361 : XOR ESI,ESI
00699363 : PUSH EDI
00699364 : MOV dword ptr [ESP + 0x24],EBX
00699368 : TEST EAX,EAX
0069936a : JLE 0x00699387
0069936c : MOV EDI,dword ptr [EBP + 0x24]
0069936f : LEA EDX,[EAX*0x4 + 0x0]
00699376 : MOVSX ECX,CX
00699379 : SUB EDI,EDX
0069937b : MOV EDX,dword ptr [ESP + 0x18]
0069937f : CMP dword ptr [EDI],ECX
00699381 : JNZ 0x00699387
00699383 : DEC EAX
00699384 : MOV dword ptr [EBP + 0x34],EAX
00699387 : CMP dword ptr [EBP + 0x34],0x0
0069938b : JLE 0x00699592
00699391 : JMP 0x0069939b
00699393 : MOV ESI,dword ptr [ESP + 0x30]
00699397 : MOV EDX,dword ptr [ESP + 0x18]
0069939b : TEST EDX,EDX
0069939d : JZ 0x006993d5
0069939f : MOVSX EDI,SI
006993a2 : SUB dword ptr [EDX + 0x18],EDI
006993a5 : MOV ESI,dword ptr [EDX + 0x4]
006993a8 : JNZ 0x006993cf
006993aa : LEA ECX,[ESP + 0x18]
006993ae : CALL 0x00698d80
006993b3 : MOV EAX,dword ptr [EDX + 0xc]
006993b6 : CMP EAX,-0x1
006993b9 : JZ 0x006993c6
006993bb : CMP EAX,0x1
006993be : JNZ 0x006993cf
006993c0 : LEA ECX,[ESP + 0x10]
006993c4 : JMP 0x006993ca
006993c6 : LEA ECX,[ESP + 0x14]
006993ca : CALL 0x00698d50
006993cf : MOV EDX,ESI
006993d1 : TEST ESI,ESI
006993d3 : JNZ 0x006993a2
006993d5 : LEA EDI,[ESP + 0x10]
006993d9 : CALL 0x00698da0
006993de : LEA EDI,[ESP + 0x14]
006993e2 : CALL 0x00698da0
006993e7 : MOV EAX,dword ptr [EBP + 0x34]
006993ea : MOV ECX,dword ptr [EBP + 0x24]
006993ed : LEA EDX,[EAX*0x4 + 0x0]
006993f4 : SUB ECX,EDX
006993f6 : MOVZX ECX,word ptr [ECX]
006993f9 : DEC EAX
006993fa : MOV EDX,ECX
006993fc : SUB EDX,EBX
006993fe : CMP BX,CX
00699401 : MOV dword ptr [EBP + 0x34],EAX
00699404 : MOVZX EAX,DX
00699407 : MOV dword ptr [ESP + 0x34],ECX
0069940b : MOV dword ptr [ESP + 0x30],EAX
0069940f : JGE 0x00699543
00699415 : JMP 0x00699420
00699420 : MOV EDI,dword ptr [ESP + 0x10]
00699424 : MOV ECX,dword ptr [ESP + 0x14]
00699428 : MOV dword ptr [ESP + 0x2c],0x0
00699430 : MOV dword ptr [ESP + 0x20],ECX
00699434 : TEST EDI,EDI
00699436 : JZ 0x00699514
0069943c : LEA ESP,[ESP]
00699440 : MOV EDX,dword ptr [ESP + 0x20]
00699444 : MOV EAX,dword ptr [EDI]
00699446 : MOV ECX,dword ptr [EDX]
00699448 : CMP EAX,ECX
0069944a : JLE 0x00699452
0069944c : MOV EDX,EAX
0069944e : MOV EAX,ECX
00699450 : MOV ECX,EDX
00699452 : MOV EBX,dword ptr [EBP + 0x4]
00699455 : MOV EDX,ECX
00699457 : SUB EDX,EAX
00699459 : CMP EDX,EBX
0069945b : JG 0x0069949e
0069945d : MOV EBP,EBX
0069945f : NEG EBP
00699461 : MOV EDX,EBP
00699463 : LEA ESI,[EBX + ECX*0x1 + -0x1]
00699467 : AND EDX,EAX
00699469 : AND ESI,EBP
0069946b : CMP EDX,ESI
0069946d : JG 0x00699475
0069946f : ADD EBX,EDX
00699471 : CMP ESI,EBX
00699473 : JNZ 0x0069949a
00699475 : MOV EDX,dword ptr [ESP + 0x3c]
00699479 : CMP byte ptr [EDX + 0xb8],0x2
00699480 : MOV EBP,EDX
00699482 : JZ 0x006994b7
00699484 : MOV dword ptr [EDI],EAX
00699486 : MOV EAX,dword ptr [ESP + 0x20]
0069948a : MOV dword ptr [EAX],ECX
0069948c : MOV EAX,0x1
00699491 : ADD dword ptr [ESP + 0x2c],EAX
00699495 : MOV dword ptr [EDI + 0x18],EAX
00699498 : JMP 0x006994b7
0069949a : MOV EBP,dword ptr [ESP + 0x3c]
0069949e : MOV EDX,dword ptr [ESP + 0x20]
006994a2 : PUSH EDX
006994a3 : PUSH EDI
006994a4 : PUSH ECX
006994a5 : MOV ECX,dword ptr [EBP + 0xac]
006994ab : PUSH EAX
006994ac : MOV EAX,dword ptr [ESP + 0x34]
006994b0 : PUSH EAX
006994b1 : PUSH EBP
006994b2 : CALL ECX
006994b4 : ADD ESP,0x18
006994b7 : MOV EDX,dword ptr [ESP + 0x20]
006994bb : MOV EDI,dword ptr [EDI + 0x4]
006994be : MOV EAX,dword ptr [EDX + 0x4]
006994c1 : MOV dword ptr [ESP + 0x20],EAX
006994c5 : TEST EDI,EDI
006994c7 : JNZ 0x00699440
006994cd : CMP word ptr [ESP + 0x2c],DI
006994d2 : JLE 0x00699510
006994d4 : MOV ESI,dword ptr [ESP + 0x10]
006994d8 : MOV EDI,dword ptr [ESP + 0x14]
006994dc : LEA ESP,[ESP]
006994e0 : CMP dword ptr [ESI + 0x18],0x0
006994e4 : JZ 0x00699506
006994e6 : MOV EDX,dword ptr [ESI]
006994e8 : MOV EAX,dword ptr [ESP + 0x24]
006994ec : PUSH EDI
006994ed : MOV dword ptr [ESI + 0x18],0x0
006994f4 : MOV ECX,dword ptr [EDI]
006994f6 : PUSH ESI
006994f7 : PUSH ECX
006994f8 : MOV ECX,dword ptr [EBP + 0xb0]
006994fe : PUSH EDX
006994ff : PUSH EAX
00699500 : PUSH EBP
00699501 : CALL ECX
00699503 : ADD ESP,0x18
00699506 : MOV ESI,dword ptr [ESI + 0x4]
00699509 : MOV EDI,dword ptr [EDI + 0x4]
0069950c : TEST ESI,ESI
0069950e : JNZ 0x006994e0
00699510 : MOV EBX,dword ptr [ESP + 0x24]
00699514 : MOV EDX,dword ptr [EBP + 0xb4]
0069951a : PUSH EBP
0069951b : CALL EDX
0069951d : INC EBX
0069951e : ADD ESP,0x4
00699521 : CMP BX,word ptr [ESP + 0x34]
00699526 : MOV dword ptr [ESP + 0x24],EBX
0069952a : JGE 0x00699543
0069952c : LEA EDI,[ESP + 0x10]
00699530 : CALL 0x00698da0
00699535 : LEA EDI,[ESP + 0x14]
00699539 : CALL 0x00698da0
0069953e : JMP 0x00699420
00699543 : MOV EDX,dword ptr [ESP + 0x10]
00699547 : TEST EDX,EDX
00699549 : JZ 0x00699568
0069954b : JMP 0x00699550
00699550 : CMP dword ptr [EDX + 0x10],0x0
00699554 : MOV ESI,dword ptr [EDX + 0x4]
00699557 : JNZ 0x00699562
00699559 : LEA ECX,[ESP + 0x10]
0069955d : CALL 0x00698d80
00699562 : MOV EDX,ESI
00699564 : TEST ESI,ESI
00699566 : JNZ 0x00699550
00699568 : MOV EDX,dword ptr [ESP + 0x14]
0069956c : TEST EDX,EDX
0069956e : JZ 0x00699588
00699570 : CMP dword ptr [EDX + 0x10],0x0
00699574 : MOV ESI,dword ptr [EDX + 0x4]
00699577 : JNZ 0x00699582
00699579 : LEA ECX,[ESP + 0x14]
0069957d : CALL 0x00698d80
00699582 : MOV EDX,ESI
00699584 : TEST ESI,ESI
00699586 : JNZ 0x00699570
00699588 : CMP dword ptr [EBP + 0x34],0x0
0069958c : JG 0x00699393
00699592 : CMP BX,word ptr [ESP + 0x28]
00699597 : JG 0x006995b4
00699599 : LEA ESP,[ESP]
006995a0 : MOV EAX,dword ptr [EBP + 0xb4]
006995a6 : PUSH EBP
006995a7 : CALL EAX
006995a9 : INC EBX
006995aa : ADD ESP,0x4
006995ad : CMP BX,word ptr [ESP + 0x28]
006995b2 : JLE 0x006995a0
006995b4 : POP EDI
006995b5 : POP EBX
006995b6 : POP ESI
006995b7 : XOR AL,AL
006995b9 : POP EBP
006995ba : ADD ESP,0x28
006995bd : RET
