PROGRAM  : Maestia.exe
FUNCTION : FUN_00845b70
ENTRY    : 00845b70
BODY     : [[00845b70, 00845e6c]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00845b70(void)

{
  undefined2 uVar1;
  int iVar2;
  int *piVar3;
  uint uVar4;
  int iVar5;
  undefined4 ****ppppuVar6;
  clock_t cVar7;
  int in_EDX;
  undefined4 *puVar8;
  undefined2 uVar9;
  undefined1 local_68 [4];
  undefined4 ***local_64 [4];
  int local_54;
  uint local_50;
  undefined1 local_4c [4];
  undefined4 ***local_48 [4];
  undefined4 local_38;
  uint local_34;
  undefined1 local_30 [4];
  undefined4 local_2c;
  int local_1c;
  uint local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  puStack_c = &LAB_00b62c1a;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_50 = 7;
  local_54 = 0;
  local_64[0] = (undefined4 ***)((uint)local_64[0] & 0xffff0000);
  local_34 = 7;
  local_38 = 0;
  local_48[0] = (undefined4 ***)((uint)local_48[0] & 0xffff0000);
  local_8._0_1_ = 1;
  local_8._1_3_ = 0;
  local_14 = uVar4;
  FUN_00845530(local_68);
  FUN_00845530(local_4c);
  piVar3 = DAT_00da9894;
  *(int *)(in_EDX + 0x48) = (local_54 + 0x19) * 100;
  iVar2 = *piVar3;
  if ((iVar2 != 0) && (*(int *)(iVar2 + 0x114) != 0)) {
    (**(code **)(**(int **)(iVar2 + 0x114) + 4))
              (*(int **)(iVar2 + 0x114),"SetSkipButton",&DAT_00c3b3f4,0,uVar4);
  }
  if (*(int *)(in_EDX + 0x40) == 0) {
    FUN_00843a80();
    if (*(int *)(in_EDX + 0x28) == 0) goto LAB_00845e0c;
    ppppuVar6 = (undefined4 ****)local_64[0];
    if (local_50 < 8) {
      ppppuVar6 = local_64;
    }
    FUN_00406460(ppppuVar6);
    local_8 = CONCAT31(local_8._1_3_,2);
    FUN_008437c0(local_30);
    FUN_00846540(0);
    iVar2 = *DAT_00da9894;
    if ((iVar2 != 0) && (*(int *)(iVar2 + 0x114) != 0)) {
      iVar5 = *(int *)(in_EDX + 0x28);
      if (*(uint *)(iVar5 + 0x24) < 8) {
        iVar5 = iVar5 + 0x10;
      }
      else {
        iVar5 = *(int *)(iVar5 + 0x10);
      }
      puVar8 = local_2c;
      if (local_18 < 8) {
        puVar8 = &local_2c;
      }
      (**(code **)(**(int **)(iVar2 + 0x114) + 4))
                (*(int **)(iVar2 + 0x114),"AddTalkText","%ls,%ls,%ls,%ls",puVar8,L"#5b91b7",iVar5,
                 L"0x526fcd");
    }
    iVar2 = *DAT_00da9894;
    if ((iVar2 != 0) && (*(int *)(iVar2 + 0x114) != 0)) {
      (**(code **)(**(int **)(iVar2 + 0x114) + 4))
                (*(int **)(iVar2 + 0x114),"SetSkipButton",&DAT_00c3b84c,1);
    }
    local_8._0_1_ = 1;
    if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_18 = 7;
    local_1c = 0;
    local_2c = (undefined4 *)((uint)local_2c._2_2_ << 0x10);
  }
  else {
    *(int *)(in_EDX + 0x40) = *(int *)(in_EDX + 0x40) + -1;
  }
  if (*(int *)(in_EDX + 0x28) != 0) {
    FUN_00846540(1);
    ppppuVar6 = (undefined4 ****)local_48[0];
    if (local_34 < 8) {
      ppppuVar6 = local_48;
    }
    FUN_00406460(ppppuVar6);
    local_8._0_1_ = 3;
    iVar2 = *(int *)(in_EDX + 0x58);
    iVar5 = *(int *)(*(int *)(in_EDX + 0x28) + 0x400);
    if (iVar5 != 0) {
      if (*(char *)(DAT_017248cc + 0x3c) == '\0') {
        uVar9 = *(undefined2 *)(DAT_017248cc + 0x34);
        uVar1 = *(undefined2 *)(DAT_017248cc + 0x38);
      }
      else {
        uVar9 = *(undefined2 *)(DAT_017248cc + 0x30);
        uVar1 = *(undefined2 *)(DAT_017248cc + 0x32);
      }
      if (local_1c != 0) {
        FUN_00405eb0(local_30,0,0xffffffff);
        *(undefined4 *)(iVar5 + 0x1f8) = 0xffc4ffc4;
        cVar7 = _clock();
        *(clock_t *)(iVar5 + 0x200) = cVar7;
        *(undefined2 *)(iVar5 + 0x1fc) = uVar9;
        *(undefined2 *)(iVar5 + 0x1fe) = uVar1;
        *(undefined4 *)(iVar5 + 0x204) = 5000;
        *(undefined4 *)(iVar5 + 0x214) = 9;
        *(bool *)(iVar5 + 0x20e) = iVar2 != 0;
        *(undefined1 *)(iVar5 + 0x20f) = 0;
        *(undefined1 *)(iVar5 + 0x210) = 1;
      }
    }
    local_8._0_1_ = 1;
    if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_18 = 7;
    local_1c = 0;
    local_2c = (undefined4 *)((uint)local_2c & 0xffff0000);
  }
LAB_00845e0c:
  local_8 = (uint)local_8._1_3_ << 8;
  if (7 < local_34) {
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  local_34 = 7;
  local_38 = 0;
  local_48[0] = (undefined4 ***)((uint)local_48[0] & 0xffff0000);
  local_8 = 0xffffffff;
  if (local_50 < 8) {
    local_50 = 7;
    local_54 = 0;
    local_64[0] = (undefined4 ***)((uint)local_64[0] & 0xffff0000);
    ExceptionList = local_10;
    __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
    return;
  }
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
00845b70 : PUSH EBP
00845b71 : MOV EBP,ESP
00845b73 : PUSH -0x1
00845b75 : PUSH 0xb62c1a
00845b7a : MOV EAX,FS:[0x0]
00845b80 : PUSH EAX
00845b81 : SUB ESP,0x5c
00845b84 : MOV EAX,[0x00d66fa0]
00845b89 : XOR EAX,EBP
00845b8b : MOV dword ptr [EBP + -0x10],EAX
00845b8e : PUSH EBX
00845b8f : PUSH ESI
00845b90 : PUSH EDI
00845b91 : PUSH EAX
00845b92 : LEA EAX,[EBP + -0xc]
00845b95 : MOV FS:[0x0],EAX
00845b9b : MOV EDI,ECX
00845b9d : MOV EAX,0x7
00845ba2 : XOR EBX,EBX
00845ba4 : XOR ECX,ECX
00845ba6 : MOV ESI,EDX
00845ba8 : MOV dword ptr [EBP + -0x4c],EAX
00845bab : MOV dword ptr [EBP + -0x50],EBX
00845bae : MOV word ptr [EBP + -0x60],CX
00845bb2 : MOV dword ptr [EBP + -0x4],EBX
00845bb5 : XOR EDX,EDX
00845bb7 : MOV dword ptr [EBP + -0x30],EAX
00845bba : MOV dword ptr [EBP + -0x34],EBX
00845bbd : MOV word ptr [EBP + -0x44],DX
00845bc1 : MOV byte ptr [EBP + -0x4],0x1
00845bc5 : LEA EAX,[EBP + -0x64]
00845bc8 : PUSH EAX
00845bc9 : MOV EDX,EDI
00845bcb : CALL 0x00845530
00845bd0 : LEA ECX,[EBP + -0x48]
00845bd3 : PUSH ECX
00845bd4 : MOV EDX,EDI
00845bd6 : CALL 0x00845530
00845bdb : MOV EDX,dword ptr [EBP + -0x50]
00845bde : MOV EAX,[0x00da9894]
00845be3 : ADD EDX,0x19
00845be6 : IMUL EDX,EDX,0x64
00845be9 : MOV dword ptr [ESI + 0x48],EDX
00845bec : MOV EAX,dword ptr [EAX]
00845bee : CMP EAX,EBX
00845bf0 : JZ 0x00845c16
00845bf2 : CMP dword ptr [EAX + 0x114],EBX
00845bf8 : JZ 0x00845c16
00845bfa : MOV EAX,dword ptr [EAX + 0x114]
00845c00 : MOV ECX,dword ptr [EAX]
00845c02 : MOV EDX,dword ptr [ECX + 0x4]
00845c05 : PUSH EBX
00845c06 : PUSH 0xc3b3f4
00845c0b : PUSH 0xc3b7fc
00845c10 : PUSH EAX
00845c11 : CALL EDX
00845c13 : ADD ESP,0x10
00845c16 : MOV EAX,dword ptr [ESI + 0x40]
00845c19 : CMP EAX,EBX
00845c1b : JNZ 0x00845d11
00845c21 : MOV EAX,ESI
00845c23 : CALL 0x00843a80
00845c28 : MOV EDI,0x8
00845c2d : CMP dword ptr [ESI + 0x28],EBX
00845c30 : JZ 0x00845e0c
00845c36 : MOV EAX,dword ptr [EBP + -0x60]
00845c39 : CMP dword ptr [EBP + -0x4c],EDI
00845c3c : JNC 0x00845c41
00845c3e : LEA EAX,[EBP + -0x60]
00845c41 : PUSH EAX
00845c42 : LEA ECX,[EBP + -0x2c]
00845c45 : CALL 0x00406460
00845c4a : MOV byte ptr [EBP + -0x4],0x2
00845c4e : LEA EAX,[EBP + -0x2c]
00845c51 : PUSH EAX
00845c52 : CALL 0x008437c0
00845c57 : PUSH EBX
00845c58 : LEA ECX,[EBP + -0x2c]
00845c5b : CALL 0x00846540
00845c60 : MOV ECX,dword ptr [0x00da9894]
00845c66 : MOV EAX,dword ptr [ECX]
00845c68 : CMP EAX,EBX
00845c6a : JZ 0x00845cbe
00845c6c : CMP dword ptr [EAX + 0x114],EBX
00845c72 : JZ 0x00845cbe
00845c74 : MOV ECX,dword ptr [EAX + 0x114]
00845c7a : MOV EAX,dword ptr [ESI + 0x28]
00845c7d : ADD EAX,0xc
00845c80 : CMP dword ptr [EAX + 0x18],EDI
00845c83 : JC 0x00845c8a
00845c85 : MOV EAX,dword ptr [EAX + 0x4]
00845c88 : JMP 0x00845c8d
00845c8a : ADD EAX,0x4
00845c8d : MOV EDX,dword ptr [EBP + -0x28]
00845c90 : CMP dword ptr [EBP + -0x14],EDI
00845c93 : JNC 0x00845c98
00845c95 : LEA EDX,[EBP + -0x28]
00845c98 : MOV EDI,dword ptr [ECX]
00845c9a : PUSH 0xc3b80c
00845c9f : PUSH EAX
00845ca0 : PUSH 0xc3b820
00845ca5 : PUSH EDX
00845ca6 : MOV EDX,dword ptr [EDI + 0x4]
00845ca9 : PUSH 0xc3b830
00845cae : PUSH 0xc3b840
00845cb3 : PUSH ECX
00845cb4 : CALL EDX
00845cb6 : ADD ESP,0x1c
00845cb9 : MOV EDI,0x8
00845cbe : MOV EAX,[0x00da9894]
00845cc3 : MOV EAX,dword ptr [EAX]
00845cc5 : CMP EAX,EBX
00845cc7 : JZ 0x00845cee
00845cc9 : CMP dword ptr [EAX + 0x114],EBX
00845ccf : JZ 0x00845cee
00845cd1 : MOV EAX,dword ptr [EAX + 0x114]
00845cd7 : MOV ECX,dword ptr [EAX]
00845cd9 : MOV EDX,dword ptr [ECX + 0x4]
00845cdc : PUSH 0x1
00845cde : PUSH 0xc3b84c
00845ce3 : PUSH 0xc3b850
00845ce8 : PUSH EAX
00845ce9 : CALL EDX
00845ceb : ADD ESP,0x10
00845cee : MOV byte ptr [EBP + -0x4],0x1
00845cf2 : CMP dword ptr [EBP + -0x14],EDI
00845cf5 : JC 0x00845cff
00845cf7 : MOV ECX,dword ptr [EBP + -0x28]
00845cfa : CALL 0x006f04e0
00845cff : XOR EAX,EAX
00845d01 : MOV dword ptr [EBP + -0x14],0x7
00845d08 : MOV dword ptr [EBP + -0x18],EBX
00845d0b : MOV word ptr [EBP + -0x28],AX
00845d0f : JMP 0x00845d1a
00845d11 : DEC EAX
00845d12 : MOV dword ptr [ESI + 0x40],EAX
00845d15 : MOV EDI,0x8
00845d1a : CMP dword ptr [ESI + 0x28],EBX
00845d1d : JZ 0x00845e0c
00845d23 : PUSH 0x1
00845d25 : LEA ECX,[EBP + -0x48]
00845d28 : CALL 0x00846540
00845d2d : MOV EAX,dword ptr [EBP + -0x44]
00845d30 : CMP dword ptr [EBP + -0x30],EDI
00845d33 : JNC 0x00845d38
00845d35 : LEA EAX,[EBP + -0x44]
00845d38 : PUSH EAX
00845d39 : LEA ECX,[EBP + -0x2c]
00845d3c : CALL 0x00406460
00845d41 : MOV byte ptr [EBP + -0x4],0x3
00845d45 : MOV ECX,dword ptr [ESI + 0x58]
00845d48 : MOV ESI,dword ptr [ESI + 0x28]
00845d4b : MOV ESI,dword ptr [ESI + 0x400]
00845d51 : MOV dword ptr [EBP + -0x68],ECX
00845d54 : CMP ESI,EBX
00845d56 : JZ 0x00845deb
00845d5c : MOV EAX,[0x017248cc]
00845d61 : CMP byte ptr [EAX + 0x3c],0x0
00845d65 : JZ 0x00845d71
00845d67 : MOVZX EDI,word ptr [EAX + 0x30]
00845d6b : MOVZX EBX,word ptr [EAX + 0x32]
00845d6f : JMP 0x00845d79
00845d71 : MOVZX EDI,word ptr [EAX + 0x34]
00845d75 : MOVZX EBX,word ptr [EAX + 0x38]
00845d79 : CMP dword ptr [EBP + -0x18],0x0
00845d7d : JBE 0x00845de4
00845d7f : PUSH -0x1
00845d81 : PUSH 0x0
00845d83 : LEA EDX,[EBP + -0x2c]
00845d86 : PUSH EDX
00845d87 : LEA ECX,[ESI + 0x1dc]
00845d8d : CALL 0x00405eb0
00845d92 : MOV dword ptr [ESI + 0x1f8],0xffc4ffc4
00845d9c : CALL 0x0063dedd
00845da1 : CMP dword ptr [EBP + -0x68],0x0
00845da5 : MOV dword ptr [ESI + 0x200],EAX
00845dab : SETNZ AL
00845dae : MOV word ptr [ESI + 0x1fc],DI
00845db5 : MOV word ptr [ESI + 0x1fe],BX
00845dbc : MOV dword ptr [ESI + 0x204],0x1388
00845dc6 : MOV dword ptr [ESI + 0x214],0x9
00845dd0 : MOV byte ptr [ESI + 0x20e],AL
00845dd6 : MOV byte ptr [ESI + 0x20f],0x0
00845ddd : MOV byte ptr [ESI + 0x210],0x1
00845de4 : XOR EBX,EBX
00845de6 : MOV EDI,0x8
00845deb : MOV byte ptr [EBP + -0x4],0x1
00845def : CMP dword ptr [EBP + -0x14],EDI
00845df2 : JC 0x00845dfc
00845df4 : MOV ECX,dword ptr [EBP + -0x28]
00845df7 : CALL 0x006f04e0
00845dfc : XOR ECX,ECX
00845dfe : MOV dword ptr [EBP + -0x14],0x7
00845e05 : MOV dword ptr [EBP + -0x18],EBX
00845e08 : MOV word ptr [EBP + -0x28],CX
00845e0c : MOV byte ptr [EBP + -0x4],0x0
00845e10 : CMP dword ptr [EBP + -0x30],EDI
00845e13 : JC 0x00845e1d
00845e15 : MOV ECX,dword ptr [EBP + -0x44]
00845e18 : CALL 0x006f04e0
00845e1d : XOR EDX,EDX
00845e1f : MOV dword ptr [EBP + -0x30],0x7
00845e26 : MOV dword ptr [EBP + -0x34],EBX
00845e29 : MOV word ptr [EBP + -0x44],DX
00845e2d : MOV dword ptr [EBP + -0x4],0xffffffff
00845e34 : CMP dword ptr [EBP + -0x4c],EDI
00845e37 : JC 0x00845e41
00845e39 : MOV ECX,dword ptr [EBP + -0x60]
00845e3c : CALL 0x006f04e0
00845e41 : XOR EAX,EAX
00845e43 : MOV dword ptr [EBP + -0x4c],0x7
00845e4a : MOV dword ptr [EBP + -0x50],EBX
00845e4d : MOV word ptr [EBP + -0x60],AX
00845e51 : MOV ECX,dword ptr [EBP + -0xc]
00845e54 : MOV dword ptr FS:[0x0],ECX
00845e5b : POP ECX
00845e5c : POP EDI
00845e5d : POP ESI
00845e5e : POP EBX
00845e5f : MOV ECX,dword ptr [EBP + -0x10]
00845e62 : XOR ECX,EBP
00845e64 : CALL 0x00633e6b
00845e69 : MOV ESP,EBP
00845e6b : POP EBP
00845e6c : RET
