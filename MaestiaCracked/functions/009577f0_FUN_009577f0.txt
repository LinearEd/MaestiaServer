PROGRAM  : Maestia.exe
FUNCTION : FUN_009577f0
ENTRY    : 009577f0
BODY     : [[009577f0, 00957b09]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_009577f0(int *param_1,ushort param_2,short param_3)

{
  int *piVar1;
  char cVar2;
  ushort uVar3;
  int iVar4;
  int *piVar5;
  undefined4 uVar6;
  int iVar7;
  uint uVar8;
  short sVar9;
  undefined1 local_50 [28];
  undefined1 local_34 [28];
  int local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b40224;
  local_10 = ExceptionList;
  piVar1 = *(int **)(param_1[1] + 0x128);
  if (piVar1 == (int *)0x0) {
    return;
  }
  ExceptionList = &local_10;
  if ((char)param_1[0x18] != '\0') {
    if (*(char *)((int)piVar1 + 0x59) == '\0') {
      piVar1[0x13] = 0;
      piVar1[0x10] = -1;
      *(undefined2 *)(piVar1 + 0x11) = 0xffff;
      *(undefined2 *)((int)piVar1 + 0x46) = 0xffff;
      *(undefined2 *)(piVar1 + 0x12) = 0xffff;
    }
    (**(code **)(*piVar1 + 0x20))();
    ExceptionList = local_10;
    return;
  }
  iVar4 = (**(code **)(*param_1 + 0x74))(param_2,param_3,DAT_00d66fa0 ^ (uint)&stack0xfffffffc);
  iVar7 = piVar1[0x10];
  if (iVar7 == 0x30) {
    uVar3 = *(ushort *)(piVar1 + 0x11);
    sVar9 = *(short *)((int)piVar1 + 0x46);
    if ((param_2 == uVar3) && (param_3 == sVar9)) goto LAB_00957912;
    if (iVar4 != 0) {
      if (piVar1[0x13] == 0) {
        iVar7 = 0;
      }
      else {
        iVar7 = *(int *)(piVar1[0x13] + 0x10);
      }
      if (*(int *)(iVar4 + 0x10) == iVar7) {
        FUN_0097fa60();
      }
    }
    iVar7 = 0x30;
    uVar8 = (uint)uVar3;
  }
  else {
    if (iVar7 == -1) {
      if (iVar4 == 0) {
        ExceptionList = local_10;
        return;
      }
      FUN_0097fb30(iVar4,param_2,param_3);
      ExceptionList = local_10;
      return;
    }
    piVar5 = (int *)FUN_008eb580();
    if (piVar5 == (int *)0x0) {
      ExceptionList = local_10;
      return;
    }
    if (iVar4 != 0) {
      FUN_00406460(L"IDS_TRADE_EXIST_ITEM");
      local_8 = 0;
      piVar1 = *(int **)(param_1[1] + 0x1a8);
      uVar6 = FUN_0081d120(local_34);
      local_8._0_1_ = 1;
      (**(code **)(*piVar1 + 0x44))(uVar6,3);
      local_8 = (uint)local_8._1_3_ << 8;
      FUN_00406560();
      local_8 = 0xffffffff;
      FUN_00406560();
LAB_00957912:
      FUN_0097fa60();
      ExceptionList = local_10;
      return;
    }
    sVar9 = *(short *)((int)piVar1 + 0x46);
    local_14 = (uint)*(ushort *)(piVar1 + 0x11);
    local_18 = (**(code **)(*piVar5 + 0x74))(local_14,sVar9);
    cVar2 = FUN_00a07a30();
    if ((cVar2 == '\0') ||
       (((local_18 != 0 && ((*(uint *)(local_18 + 0x120) & 4) == 0)) &&
        ((*(uint *)(local_18 + 0x120) & 1) != 0)))) {
      FUN_00406460(L"IDS_TRADE_DISABLE_ITEM");
      local_8 = 2;
      piVar1 = *(int **)(param_1[1] + 0x1a8);
      uVar6 = FUN_0081d120(local_50);
      local_8._0_1_ = 3;
      (**(code **)(*piVar1 + 0x44))(uVar6,3);
      local_8 = CONCAT31(local_8._1_3_,2);
      FUN_00406560();
      local_8 = 0xffffffff;
      FUN_00406560();
      FUN_0097fa60();
      ExceptionList = local_10;
      return;
    }
    uVar3 = FUN_0097f9f0();
    uVar8 = local_14;
    if (((1 < uVar3) &&
        (iVar4 = (**(code **)(*(int *)piVar1[0x13] + 0x20))(), uVar8 = local_14, iVar4 != 0)) &&
       ((*(byte *)(piVar1[0x13] + 0x120) & 4) == 0)) {
      FUN_0097f9f0();
      FUN_00955590(iVar7,local_14,sVar9,param_2,param_3);
      ExceptionList = local_10;
      return;
    }
  }
  FUN_008efa90(iVar7,uVar8,sVar9,0x30,param_2,param_3);
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
009577f0 : PUSH EBP
009577f1 : MOV EBP,ESP
009577f3 : PUSH -0x1
009577f5 : PUSH 0xb40224
009577fa : MOV EAX,FS:[0x0]
00957800 : PUSH EAX
00957801 : SUB ESP,0x78
00957804 : PUSH EBX
00957805 : PUSH ESI
00957806 : PUSH EDI
00957807 : MOV EAX,[0x00d66fa0]
0095780c : XOR EAX,EBP
0095780e : PUSH EAX
0095780f : LEA EAX,[EBP + -0xc]
00957812 : MOV FS:[0x0],EAX
00957818 : MOV EBX,dword ptr [EBP + 0x8]
0095781b : MOV EAX,dword ptr [EBX + 0x4]
0095781e : MOV ESI,dword ptr [EAX + 0x128]
00957824 : TEST ESI,ESI
00957826 : JZ 0x00957af6
0095782c : CMP byte ptr [EBX + 0x60],0x0
00957830 : JZ 0x00957878
00957832 : CMP byte ptr [ESI + 0x59],0x0
00957836 : JNZ 0x0095785b
00957838 : MOV ECX,0xffff
0095783d : MOV EDX,ECX
0095783f : MOV EAX,ECX
00957841 : MOV dword ptr [ESI + 0x4c],0x0
00957848 : MOV dword ptr [ESI + 0x40],0xffffffff
0095784f : MOV word ptr [ESI + 0x44],CX
00957853 : MOV word ptr [ESI + 0x46],DX
00957857 : MOV word ptr [ESI + 0x48],AX
0095785b : MOV EDX,dword ptr [ESI]
0095785d : MOV EAX,dword ptr [EDX + 0x20]
00957860 : MOV ECX,ESI
00957862 : CALL EAX
00957864 : MOV ECX,dword ptr [EBP + -0xc]
00957867 : MOV dword ptr FS:[0x0],ECX
0095786e : POP ECX
0095786f : POP EDI
00957870 : POP ESI
00957871 : POP EBX
00957872 : MOV ESP,EBP
00957874 : POP EBP
00957875 : RET 0xc
00957878 : MOVZX ECX,word ptr [EBP + 0x10]
0095787c : MOVZX EAX,word ptr [EBP + 0xc]
00957880 : MOV EDX,dword ptr [EBX]
00957882 : PUSH ECX
00957883 : PUSH EAX
00957884 : MOV EAX,dword ptr [EDX + 0x74]
00957887 : MOV ECX,EBX
00957889 : CALL EAX
0095788b : MOV EDI,dword ptr [ESI + 0x40]
0095788e : MOV dword ptr [EBP + 0x8],EAX
00957891 : CMP EDI,0x30
00957894 : JZ 0x00957a9e
0095789a : CMP EDI,-0x1
0095789d : JZ 0x00957a6b
009578a3 : MOV EAX,dword ptr [EBX + 0x4]
009578a6 : CALL 0x008eb580
009578ab : TEST EAX,EAX
009578ad : JZ 0x00957af6
009578b3 : CMP dword ptr [EBP + 0x8],0x0
009578b7 : JZ 0x0095792d
009578b9 : PUSH 0xc76004
009578be : LEA ECX,[EBP + -0x30]
009578c1 : CALL 0x00406460
009578c6 : MOV dword ptr [EBP + -0x4],0x0
009578cd : MOV ECX,dword ptr [EBX + 0x4]
009578d0 : MOV EBX,dword ptr [ECX + 0x1a8]
009578d6 : MOV ECX,dword ptr [0x0172491c]
009578dc : LEA EDX,[EBP + -0x30]
009578df : PUSH EDX
009578e0 : LEA EDI,[EBP + -0x68]
009578e3 : CALL 0x0081d120
009578e8 : MOV byte ptr [EBP + -0x4],0x1
009578ec : MOV EDX,dword ptr [EBX]
009578ee : PUSH 0x3
009578f0 : PUSH EAX
009578f1 : MOV EAX,dword ptr [EDX + 0x44]
009578f4 : MOV ECX,EBX
009578f6 : CALL EAX
009578f8 : MOV byte ptr [EBP + -0x4],0x0
009578fc : MOV ECX,EDI
009578fe : CALL 0x00406560
00957903 : MOV dword ptr [EBP + -0x4],0xffffffff
0095790a : LEA ECX,[EBP + -0x30]
0095790d : CALL 0x00406560
00957912 : MOV ECX,ESI
00957914 : CALL 0x0097fa60
00957919 : MOV ECX,dword ptr [EBP + -0xc]
0095791c : MOV dword ptr FS:[0x0],ECX
00957923 : POP ECX
00957924 : POP EDI
00957925 : POP ESI
00957926 : POP EBX
00957927 : MOV ESP,EBP
00957929 : POP EBP
0095792a : RET 0xc
0095792d : MOVZX EDX,word ptr [ESI + 0x46]
00957931 : MOVZX ECX,word ptr [ESI + 0x44]
00957935 : MOV dword ptr [EBP + 0x8],EDX
00957938 : PUSH dword ptr [EBP + 0x8]
0095793b : MOV EDX,dword ptr [EAX]
0095793d : MOV dword ptr [EBP + -0x10],ECX
00957940 : PUSH ECX
00957941 : MOV ECX,EAX
00957943 : MOV EAX,dword ptr [EDX + 0x74]
00957946 : CALL EAX
00957948 : MOV dword ptr [EBP + -0x14],EAX
0095794b : MOV EAX,dword ptr [ESI + 0x4c]
0095794e : TEST EAX,EAX
00957950 : JZ 0x00957957
00957952 : MOV EAX,dword ptr [EAX + 0x10]
00957955 : JMP 0x00957959
00957957 : XOR EAX,EAX
00957959 : CALL 0x00a07a30
0095795e : TEST AL,AL
00957960 : JZ 0x009579f4
00957966 : MOV EAX,dword ptr [EBP + -0x14]
00957969 : TEST EAX,EAX
0095796b : JZ 0x0095797b
0095796d : MOV EAX,dword ptr [EAX + 0x120]
00957973 : TEST AL,0x4
00957975 : JNZ 0x0095797b
00957977 : TEST AL,0x1
00957979 : JNZ 0x009579f4
0095797b : MOV EAX,ESI
0095797d : CALL 0x0097f9f0
00957982 : CMP AX,0x1
00957986 : JBE 0x009579da
00957988 : MOV ECX,dword ptr [ESI + 0x4c]
0095798b : MOV EDX,dword ptr [ECX]
0095798d : MOV EAX,dword ptr [EDX + 0x20]
00957990 : CALL EAX
00957992 : TEST EAX,EAX
00957994 : JZ 0x009579da
00957996 : MOV ECX,dword ptr [ESI + 0x4c]
00957999 : TEST byte ptr [ECX + 0x120],0x4
009579a0 : JNZ 0x009579da
009579a2 : MOV EAX,ESI
009579a4 : CALL 0x0097f9f0
009579a9 : MOVZX ECX,word ptr [EBP + 0x10]
009579ad : MOV EDX,dword ptr [EBP + 0x8]
009579b0 : MOV ESI,dword ptr [EBX + 0x5c]
009579b3 : PUSH ECX
009579b4 : MOVZX ECX,word ptr [EBP + 0xc]
009579b8 : PUSH ECX
009579b9 : MOV ECX,dword ptr [EBP + -0x10]
009579bc : PUSH EDX
009579bd : PUSH ECX
009579be : PUSH EDI
009579bf : MOV EDX,EAX
009579c1 : CALL 0x00955590
009579c6 : MOV ECX,dword ptr [EBP + -0xc]
009579c9 : MOV dword ptr FS:[0x0],ECX
009579d0 : POP ECX
009579d1 : POP EDI
009579d2 : POP ESI
009579d3 : POP EBX
009579d4 : MOV ESP,EBP
009579d6 : POP EBP
009579d7 : RET 0xc
009579da : MOVZX EAX,word ptr [EBP + 0x10]
009579de : MOV EDX,dword ptr [EBP + 0x8]
009579e1 : PUSH EAX
009579e2 : MOVZX EAX,word ptr [EBP + 0xc]
009579e6 : PUSH EAX
009579e7 : MOV EAX,dword ptr [EBP + -0x10]
009579ea : PUSH 0x30
009579ec : PUSH EDX
009579ed : PUSH EAX
009579ee : PUSH EDI
009579ef : JMP 0x00957aee
009579f4 : PUSH 0xc76030
009579f9 : LEA ECX,[EBP + -0x4c]
009579fc : CALL 0x00406460
00957a01 : MOV dword ptr [EBP + -0x4],0x2
00957a08 : MOV ECX,dword ptr [EBX + 0x4]
00957a0b : MOV EBX,dword ptr [ECX + 0x1a8]
00957a11 : MOV ECX,dword ptr [0x0172491c]
00957a17 : LEA EDX,[EBP + -0x4c]
00957a1a : PUSH EDX
00957a1b : LEA EDI,[EBP + 0xffffff7c]
00957a21 : CALL 0x0081d120
00957a26 : MOV byte ptr [EBP + -0x4],0x3
00957a2a : MOV EDX,dword ptr [EBX]
00957a2c : PUSH 0x3
00957a2e : PUSH EAX
00957a2f : MOV EAX,dword ptr [EDX + 0x44]
00957a32 : MOV ECX,EBX
00957a34 : CALL EAX
00957a36 : MOV byte ptr [EBP + -0x4],0x2
00957a3a : MOV ECX,EDI
00957a3c : CALL 0x00406560
00957a41 : MOV dword ptr [EBP + -0x4],0xffffffff
00957a48 : LEA ECX,[EBP + -0x4c]
00957a4b : CALL 0x00406560
00957a50 : MOV ECX,ESI
00957a52 : CALL 0x0097fa60
00957a57 : MOV ECX,dword ptr [EBP + -0xc]
00957a5a : MOV dword ptr FS:[0x0],ECX
00957a61 : POP ECX
00957a62 : POP EDI
00957a63 : POP ESI
00957a64 : POP EBX
00957a65 : MOV ESP,EBP
00957a67 : POP EBP
00957a68 : RET 0xc
00957a6b : TEST EAX,EAX
00957a6d : JZ 0x00957af6
00957a73 : MOVZX ECX,word ptr [EBP + 0x10]
00957a77 : PUSH ECX
00957a78 : MOVZX ECX,word ptr [EBP + 0xc]
00957a7c : PUSH ECX
00957a7d : PUSH EAX
00957a7e : MOV EAX,0x30
00957a83 : MOV ECX,ESI
00957a85 : CALL 0x0097fb30
00957a8a : MOV ECX,dword ptr [EBP + -0xc]
00957a8d : MOV dword ptr FS:[0x0],ECX
00957a94 : POP ECX
00957a95 : POP EDI
00957a96 : POP ESI
00957a97 : POP EBX
00957a98 : MOV ESP,EBP
00957a9a : POP EBP
00957a9b : RET 0xc
00957a9e : MOVZX EDI,word ptr [ESI + 0x44]
00957aa2 : MOVZX EBX,word ptr [EBP + 0xc]
00957aa6 : MOVZX EDX,word ptr [ESI + 0x46]
00957aaa : MOV dword ptr [EBP + 0x8],EDX
00957aad : CMP BX,DI
00957ab0 : JNZ 0x00957abf
00957ab2 : MOVZX ECX,word ptr [EBP + 0x10]
00957ab6 : CMP CX,DX
00957ab9 : JZ 0x00957912
00957abf : TEST EAX,EAX
00957ac1 : JZ 0x00957ae2
00957ac3 : MOV ECX,dword ptr [ESI + 0x4c]
00957ac6 : MOV EAX,dword ptr [EAX + 0x10]
00957ac9 : TEST ECX,ECX
00957acb : JZ 0x00957ad2
00957acd : MOV ECX,dword ptr [ECX + 0x10]
00957ad0 : JMP 0x00957ad4
00957ad2 : XOR ECX,ECX
00957ad4 : CMP EAX,ECX
00957ad6 : JNZ 0x00957ae2
00957ad8 : MOV ECX,ESI
00957ada : CALL 0x0097fa60
00957adf : MOV EDX,dword ptr [EBP + 0x8]
00957ae2 : MOVZX EAX,word ptr [EBP + 0x10]
00957ae6 : PUSH EAX
00957ae7 : PUSH EBX
00957ae8 : PUSH 0x30
00957aea : PUSH EDX
00957aeb : PUSH EDI
00957aec : PUSH 0x30
00957aee : CALL 0x008efa90
00957af3 : ADD ESP,0x18
00957af6 : MOV ECX,dword ptr [EBP + -0xc]
00957af9 : MOV dword ptr FS:[0x0],ECX
00957b00 : POP ECX
00957b01 : POP EDI
00957b02 : POP ESI
00957b03 : POP EBX
00957b04 : MOV ESP,EBP
00957b06 : POP EBP
00957b07 : RET 0xc
