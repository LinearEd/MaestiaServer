PROGRAM  : Maestia.exe
FUNCTION : FUN_00546e40
ENTRY    : 00546e40
BODY     : [[00546e40, 00547200]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00546e40(int param_1,uint *param_2)

{
  uint *puVar1;
  char cVar2;
  int iVar3;
  int iVar4;
  undefined4 uVar5;
  int *in_ECX;
  uint uVar6;
  uint uVar7;
  uint uVar8;
  int iVar9;
  undefined1 *puVar10;
  int *local_24;
  int local_20;
  undefined1 local_1c [12];
  undefined2 local_10;
  undefined2 local_e;
  uint local_6;
  
  puVar1 = param_2;
  iVar9 = 0;
  switch(param_1) {
  case 0:
    if ((in_ECX[0x43] == 0) || (iVar4 = FUN_0053c470(), iVar4 + 1U <= (uint)in_ECX[0x43])) {
      iVar9 = FUN_005422b0(param_2 + 1,*param_2,1,1);
      return iVar9;
    }
    break;
  case 1:
    uVar6 = param_2[2];
    iVar9 = FUN_0053c470();
    uVar8 = in_ECX[0x43];
    if ((uVar8 != 0) && (uVar8 < iVar9 + uVar6)) {
      uVar6 = uVar8 - iVar9;
    }
    iVar9 = FUN_005422b0(puVar1[1],*puVar1,uVar6,0);
    return iVar9;
  case 2:
    iVar9 = -1;
    if (in_ECX[0x43] != 0) {
      iVar4 = FUN_0053c470();
      iVar3 = FUN_0053c470();
      if ((uint)in_ECX[0x43] < (uint)(iVar3 + iVar4)) {
        iVar9 = in_ECX[0x43] - iVar4;
      }
    }
    iVar9 = FUN_00541980(puVar1[1],*puVar1,iVar9);
    return iVar9;
  case 3:
    FUN_00500910(*param_2,*param_2 + 1);
    return 1;
  case 4:
    uVar6 = *param_2;
    uVar8 = param_2[1];
    uVar7 = uVar6;
    if (uVar8 < uVar6) {
      uVar7 = uVar8;
      uVar8 = uVar6;
    }
    FUN_00500910(uVar7,uVar8);
    iVar9 = uVar8 - uVar7;
    break;
  case 5:
    uVar6 = *param_2;
    uVar8 = param_2[1];
    uVar7 = uVar6;
    if (uVar8 < uVar6) {
      uVar7 = uVar8;
      uVar8 = uVar6;
    }
    if ((in_ECX[0x43] == 0) ||
       (iVar4 = FUN_0053c470(), iVar4 + (uVar7 - uVar8) + 1 <= (uint)in_ECX[0x43])) {
      iVar9 = FUN_005422b0(param_2 + 2,uVar7,1,0);
      FUN_00500910(uVar7 + 1,uVar8 + 1);
      return iVar9;
    }
    break;
  case 6:
    uVar6 = *param_2;
    uVar8 = param_2[1];
    uVar7 = uVar6;
    if (uVar8 < uVar6) {
      uVar7 = uVar8;
      uVar8 = uVar6;
    }
    param_2 = (uint *)param_2[3];
    if (in_ECX[0x43] != 0) {
      iVar9 = FUN_0053c470();
      iVar9 = iVar9 + (uVar7 - uVar8);
      if ((uint)in_ECX[0x43] < puVar1[3] + iVar9) {
        param_2 = (uint *)(in_ECX[0x43] - iVar9);
      }
    }
    iVar9 = FUN_005422b0(puVar1[2],uVar7,param_2,0);
    FUN_00500910(uVar7 + iVar9,uVar8 + iVar9);
    return iVar9;
  case 7:
    uVar6 = *param_2;
    uVar8 = param_2[1];
    uVar7 = uVar6;
    if (uVar8 < uVar6) {
      uVar7 = uVar8;
      uVar8 = uVar6;
    }
    param_1 = -1;
    if (in_ECX[0x43] != 0) {
      iVar9 = FUN_0053c470();
      local_24 = (int *)in_ECX[0x43];
      iVar9 = iVar9 + (uVar7 - uVar8);
      iVar4 = FUN_0053c470();
      if (local_24 < (int *)(iVar4 + iVar9)) {
        param_1 = in_ECX[0x43] - iVar9;
      }
    }
    iVar9 = FUN_00541980(param_2[2],uVar7,param_1);
    FUN_00500910(uVar7 + iVar9,uVar8 + iVar9);
    return iVar9;
  case 8:
    param_1 = 0;
    FUN_0053c2d0(&local_24,*param_2,&param_1);
    cVar2 = FUN_0053b530();
    if (((cVar2 == '\0') && (param_1 == 0)) &&
       (iVar9 = *(int *)(*(int *)(*local_24 + local_20 * 4) + 0xc), iVar9 != 0)) {
      cVar2 = FUN_0053b350();
      if (cVar2 == '\0') {
        if ((*(short *)(iVar9 + 0xe) == 0) && (*(short *)(iVar9 + 0xc) == 0)) goto LAB_00547192;
        FUN_0053c1c0(iVar9);
        local_e = 0;
        local_10 = 0;
        local_6 = local_6 | 6;
      }
      else {
        FUN_0053c1c0(iVar9);
        local_6 = local_6 & 0xffff7f7f | 0x80;
      }
      puVar10 = local_1c;
      uVar5 = FUN_0053f720(puVar10);
      FUN_0053c230(uVar5,puVar10);
      (**(code **)(*in_ECX + 4))(2);
      FUN_005008c0();
    }
    else {
LAB_00547192:
      uVar6 = *param_2;
      if (uVar6 != 0) {
        FUN_00500910(uVar6 - 1,uVar6);
        return 1;
      }
    }
    return 0;
  }
  return iVar9;
}



============================================================
DISASSEMBLY
============================================================
00546e40 : MOV EAX,dword ptr [ESP + 0x4]
00546e44 : SUB ESP,0x24
00546e47 : PUSH ESI
00546e48 : PUSH EDI
00546e49 : XOR EDI,EDI
00546e4b : MOV ESI,ECX
00546e4d : CMP EAX,0x8
00546e50 : JA 0x005471f7
00546e56 : PUSH EBX
00546e57 : PUSH EBP
00546e58 : JMP dword ptr [EAX*0x4 + 0x547204]
00546e5f : CMP dword ptr [ESI + 0x10c],EDI
00546e65 : JZ 0x00546e7c
00546e67 : MOV ECX,dword ptr [ESI + 0xc]
00546e6a : CALL 0x0053c470
00546e6f : INC EAX
00546e70 : CMP EAX,dword ptr [ESI + 0x10c]
00546e76 : JA 0x005471f5
00546e7c : MOV EAX,dword ptr [ESP + 0x3c]
00546e80 : MOV EDX,dword ptr [EAX]
00546e82 : MOV ECX,dword ptr [ESI + 0xc]
00546e85 : PUSH 0x1
00546e87 : PUSH 0x1
00546e89 : PUSH EDX
00546e8a : ADD EAX,0x4
00546e8d : PUSH EAX
00546e8e : CALL 0x005422b0
00546e93 : POP EBP
00546e94 : POP EBX
00546e95 : MOV EDI,EAX
00546e97 : POP EDI
00546e98 : POP ESI
00546e99 : ADD ESP,0x24
00546e9c : RET 0x8
00546e9f : MOV EBX,dword ptr [ESP + 0x3c]
00546ea3 : MOV ECX,dword ptr [ESI + 0xc]
00546ea6 : MOV EDI,dword ptr [EBX + 0x8]
00546ea9 : CALL 0x0053c470
00546eae : MOV ECX,dword ptr [ESI + 0x10c]
00546eb4 : TEST ECX,ECX
00546eb6 : JZ 0x00546ec3
00546eb8 : LEA EDX,[EAX + EDI*0x1]
00546ebb : CMP EDX,ECX
00546ebd : JBE 0x00546ec3
00546ebf : SUB ECX,EAX
00546ec1 : MOV EDI,ECX
00546ec3 : MOV EAX,dword ptr [EBX]
00546ec5 : MOV ECX,dword ptr [EBX + 0x4]
00546ec8 : MOV ESI,dword ptr [ESI + 0xc]
00546ecb : PUSH 0x0
00546ecd : PUSH EDI
00546ece : PUSH EAX
00546ecf : PUSH ECX
00546ed0 : MOV ECX,ESI
00546ed2 : CALL 0x005422b0
00546ed7 : POP EBP
00546ed8 : POP EBX
00546ed9 : MOV EDI,EAX
00546edb : POP EDI
00546edc : POP ESI
00546edd : ADD ESP,0x24
00546ee0 : RET 0x8
00546ee3 : MOV EBX,dword ptr [ESP + 0x3c]
00546ee7 : OR EBP,0xffffffff
00546eea : CMP dword ptr [ESI + 0x10c],EDI
00546ef0 : JZ 0x00546f14
00546ef2 : MOV ECX,dword ptr [ESI + 0xc]
00546ef5 : CALL 0x0053c470
00546efa : MOV ECX,dword ptr [EBX + 0x4]
00546efd : MOV EDI,EAX
00546eff : CALL 0x0053c470
00546f04 : MOV ECX,dword ptr [ESI + 0x10c]
00546f0a : ADD EAX,EDI
00546f0c : CMP EAX,ECX
00546f0e : JBE 0x00546f14
00546f10 : SUB ECX,EDI
00546f12 : MOV EBP,ECX
00546f14 : MOV EDX,dword ptr [EBX]
00546f16 : MOV EAX,dword ptr [EBX + 0x4]
00546f19 : MOV ECX,dword ptr [ESI + 0xc]
00546f1c : PUSH EBP
00546f1d : PUSH EDX
00546f1e : PUSH EAX
00546f1f : CALL 0x00541980
00546f24 : POP EBP
00546f25 : POP EBX
00546f26 : MOV EDI,EAX
00546f28 : POP EDI
00546f29 : POP ESI
00546f2a : ADD ESP,0x24
00546f2d : RET 0x8
00546f30 : MOV EDX,dword ptr [ESP + 0x3c]
00546f34 : MOV EAX,dword ptr [EDX]
00546f36 : MOV EBP,dword ptr [EDX + 0x4]
00546f39 : CMP EAX,EBP
00546f3b : JBE 0x00546f43
00546f3d : MOV EBX,EBP
00546f3f : MOV EBP,EAX
00546f41 : JMP 0x00546f45
00546f43 : MOV EBX,EAX
00546f45 : CMP dword ptr [ESI + 0x10c],EDI
00546f4b : JZ 0x00546f6c
00546f4d : MOV ECX,dword ptr [ESI + 0xc]
00546f50 : CALL 0x0053c470
00546f55 : MOV ECX,EBX
00546f57 : SUB ECX,EBP
00546f59 : ADD EAX,ECX
00546f5b : INC EAX
00546f5c : CMP EAX,dword ptr [ESI + 0x10c]
00546f62 : JA 0x005471f5
00546f68 : MOV EDX,dword ptr [ESP + 0x3c]
00546f6c : MOV ECX,dword ptr [ESI + 0xc]
00546f6f : PUSH 0x0
00546f71 : PUSH 0x1
00546f73 : PUSH EBX
00546f74 : ADD EDX,0x8
00546f77 : PUSH EDX
00546f78 : CALL 0x005422b0
00546f7d : INC EBP
00546f7e : PUSH EBP
00546f7f : INC EBX
00546f80 : PUSH EBX
00546f81 : MOV ECX,ESI
00546f83 : MOV EDI,EAX
00546f85 : CALL 0x00500910
00546f8a : POP EBP
00546f8b : POP EBX
00546f8c : MOV EAX,EDI
00546f8e : POP EDI
00546f8f : POP ESI
00546f90 : ADD ESP,0x24
00546f93 : RET 0x8
00546f96 : MOV EDI,dword ptr [ESP + 0x3c]
00546f9a : MOV EAX,dword ptr [EDI]
00546f9c : MOV EBP,dword ptr [EDI + 0x4]
00546f9f : CMP EAX,EBP
00546fa1 : JBE 0x00546fa9
00546fa3 : MOV EBX,EBP
00546fa5 : MOV EBP,EAX
00546fa7 : JMP 0x00546fab
00546fa9 : MOV EBX,EAX
00546fab : CMP dword ptr [ESI + 0x10c],0x0
00546fb2 : MOV EDX,dword ptr [EDI + 0xc]
00546fb5 : MOV dword ptr [ESP + 0x3c],EDX
00546fb9 : JZ 0x00546fde
00546fbb : MOV ECX,dword ptr [ESI + 0xc]
00546fbe : CALL 0x0053c470
00546fc3 : MOV EDX,dword ptr [EDI + 0xc]
00546fc6 : MOV ECX,EBX
00546fc8 : SUB ECX,EBP
00546fca : ADD EAX,ECX
00546fcc : MOV ECX,dword ptr [ESI + 0x10c]
00546fd2 : ADD EDX,EAX
00546fd4 : CMP EDX,ECX
00546fd6 : JBE 0x00546fde
00546fd8 : SUB ECX,EAX
00546fda : MOV dword ptr [ESP + 0x3c],ECX
00546fde : MOV EAX,dword ptr [ESP + 0x3c]
00546fe2 : MOV EDX,dword ptr [EDI + 0x8]
00546fe5 : MOV ECX,dword ptr [ESI + 0xc]
00546fe8 : PUSH 0x0
00546fea : PUSH EAX
00546feb : PUSH EBX
00546fec : PUSH EDX
00546fed : CALL 0x005422b0
00546ff2 : MOV EDI,EAX
00546ff4 : ADD EBP,EDI
00546ff6 : PUSH EBP
00546ff7 : ADD EBX,EDI
00546ff9 : PUSH EBX
00546ffa : MOV ECX,ESI
00546ffc : CALL 0x00500910
00547001 : POP EBP
00547002 : POP EBX
00547003 : MOV EAX,EDI
00547005 : POP EDI
00547006 : POP ESI
00547007 : ADD ESP,0x24
0054700a : RET 0x8
0054700d : MOV ECX,dword ptr [ESP + 0x3c]
00547011 : MOV EAX,dword ptr [ECX]
00547013 : MOV EBP,dword ptr [ECX + 0x4]
00547016 : CMP EAX,EBP
00547018 : JBE 0x00547020
0054701a : MOV EBX,EBP
0054701c : MOV EBP,EAX
0054701e : JMP 0x00547022
00547020 : MOV EBX,EAX
00547022 : MOV dword ptr [ESP + 0x38],0xffffffff
0054702a : CMP dword ptr [ESI + 0x10c],EDI
00547030 : JZ 0x0054706c
00547032 : MOV ECX,dword ptr [ESI + 0xc]
00547035 : CALL 0x0053c470
0054703a : MOV ECX,dword ptr [ESI + 0x10c]
00547040 : MOV EDX,dword ptr [ESP + 0x3c]
00547044 : MOV EDI,EAX
00547046 : MOV EAX,EBX
00547048 : SUB EAX,EBP
0054704a : MOV dword ptr [ESP + 0x10],ECX
0054704e : MOV ECX,dword ptr [EDX + 0x8]
00547051 : ADD EDI,EAX
00547053 : CALL 0x0053c470
00547058 : ADD EAX,EDI
0054705a : CMP EAX,dword ptr [ESP + 0x10]
0054705e : JBE 0x0054706c
00547060 : MOV EAX,dword ptr [ESI + 0x10c]
00547066 : SUB EAX,EDI
00547068 : MOV dword ptr [ESP + 0x38],EAX
0054706c : MOV EAX,dword ptr [ESP + 0x38]
00547070 : MOV EDX,dword ptr [ESP + 0x3c]
00547074 : MOV ECX,dword ptr [ESI + 0xc]
00547077 : PUSH EAX
00547078 : MOV EAX,dword ptr [EDX + 0x8]
0054707b : PUSH EBX
0054707c : PUSH EAX
0054707d : CALL 0x00541980
00547082 : MOV EDI,EAX
00547084 : ADD EBP,EDI
00547086 : PUSH EBP
00547087 : ADD EBX,EDI
00547089 : PUSH EBX
0054708a : MOV ECX,ESI
0054708c : CALL 0x00500910
00547091 : POP EBP
00547092 : POP EBX
00547093 : MOV EAX,EDI
00547095 : POP EDI
00547096 : POP ESI
00547097 : ADD ESP,0x24
0054709a : RET 0x8
0054709d : MOV EDX,dword ptr [ESP + 0x3c]
005470a1 : MOV EAX,dword ptr [EDX]
005470a3 : LEA ECX,[ESP + 0x38]
005470a7 : PUSH ECX
005470a8 : PUSH EAX
005470a9 : LEA ECX,[ESP + 0x18]
005470ad : PUSH ECX
005470ae : MOV ECX,dword ptr [ESI + 0xc]
005470b1 : MOV EDI,0x1
005470b6 : MOV dword ptr [ESP + 0x44],0x0
005470be : CALL 0x0053c2d0
005470c3 : LEA ECX,[ESP + 0x10]
005470c7 : CALL 0x0053b530
005470cc : TEST AL,AL
005470ce : JNZ 0x00547192
005470d4 : CMP dword ptr [ESP + 0x38],0x0
005470d9 : JNZ 0x00547192
005470df : MOV EDX,dword ptr [ESP + 0x10]
005470e3 : MOV EAX,dword ptr [EDX]
005470e5 : MOV ECX,dword ptr [ESP + 0x14]
005470e9 : MOV EBP,dword ptr [EAX + ECX*0x4]
005470ec : MOV EBX,dword ptr [EBP + 0xc]
005470ef : TEST EBX,EBX
005470f1 : JZ 0x00547192
005470f7 : MOV ECX,EBX
005470f9 : CALL 0x0053b350
005470fe : TEST AL,AL
00547100 : JZ 0x00547158
00547102 : PUSH EBX
00547103 : LEA ECX,[ESP + 0x1c]
00547107 : CALL 0x0053c1c0
0054710c : MOV EDX,dword ptr [ESP + 0x2e]
00547110 : AND EDX,0x7f7f
00547116 : OR EDX,0x80
0054711c : MOV word ptr [ESP + 0x2e],DX
00547121 : MOV ECX,dword ptr [ESI + 0xc]
00547124 : LEA EAX,[ESP + 0x18]
00547128 : PUSH EAX
00547129 : CALL 0x0053f720
0054712e : PUSH EAX
0054712f : MOV ECX,EBP
00547131 : CALL 0x0053c230
00547136 : MOV EDX,dword ptr [ESI]
00547138 : MOV EAX,dword ptr [EDX + 0x4]
0054713b : PUSH 0x2
0054713d : MOV ECX,ESI
0054713f : CALL EAX
00547141 : LEA ECX,[ESP + 0x18]
00547145 : CALL 0x005008c0
0054714a : POP EBP
0054714b : XOR EDI,EDI
0054714d : POP EBX
0054714e : MOV EAX,EDI
00547150 : POP EDI
00547151 : POP ESI
00547152 : ADD ESP,0x24
00547155 : RET 0x8
00547158 : CMP word ptr [EBX + 0xe],0x0
0054715d : JNZ 0x00547166
0054715f : CMP word ptr [EBX + 0xc],0x0
00547164 : JZ 0x00547192
00547166 : PUSH EBX
00547167 : LEA ECX,[ESP + 0x1c]
0054716b : CALL 0x0053c1c0
00547170 : MOV AX,word ptr [ESP + 0x2e]
00547175 : XOR ECX,ECX
00547177 : OR AX,0x4
0054717b : XOR EDX,EDX
0054717d : OR AX,0x2
00547181 : MOV word ptr [ESP + 0x26],CX
00547186 : MOV word ptr [ESP + 0x24],DX
0054718b : MOV word ptr [ESP + 0x2e],AX
00547190 : JMP 0x00547121
00547192 : MOV ECX,dword ptr [ESP + 0x3c]
00547196 : MOV EAX,dword ptr [ECX]
00547198 : TEST EAX,EAX
0054719a : JBE 0x0054714a
0054719c : PUSH EAX
0054719d : DEC EAX
0054719e : PUSH EAX
0054719f : MOV ECX,ESI
005471a1 : CALL 0x00500910
005471a6 : POP EBP
005471a7 : POP EBX
005471a8 : MOV EAX,EDI
005471aa : POP EDI
005471ab : POP ESI
005471ac : ADD ESP,0x24
005471af : RET 0x8
005471b2 : MOV EDX,dword ptr [ESP + 0x3c]
005471b6 : MOV EAX,dword ptr [EDX]
005471b8 : LEA ECX,[EAX + 0x1]
005471bb : PUSH ECX
005471bc : PUSH EAX
005471bd : MOV ECX,ESI
005471bf : CALL 0x00500910
005471c4 : POP EBP
005471c5 : MOV EDI,0x1
005471ca : POP EBX
005471cb : MOV EAX,EDI
005471cd : POP EDI
005471ce : POP ESI
005471cf : ADD ESP,0x24
005471d2 : RET 0x8
005471d5 : MOV ECX,dword ptr [ESP + 0x3c]
005471d9 : MOV EAX,dword ptr [ECX]
005471db : MOV EDI,dword ptr [ECX + 0x4]
005471de : CMP EAX,EDI
005471e0 : JBE 0x005471e8
005471e2 : MOV EBX,EDI
005471e4 : MOV EDI,EAX
005471e6 : JMP 0x005471ea
005471e8 : MOV EBX,EAX
005471ea : PUSH EDI
005471eb : PUSH EBX
005471ec : MOV ECX,ESI
005471ee : CALL 0x00500910
005471f3 : SUB EDI,EBX
005471f5 : POP EBP
005471f6 : POP EBX
005471f7 : MOV EAX,EDI
005471f9 : POP EDI
005471fa : POP ESI
005471fb : ADD ESP,0x24
005471fe : RET 0x8
