PROGRAM  : Maestia.exe
FUNCTION : FUN_006f1460
ENTRY    : 006f1460
BODY     : [[006f1460, 006f15e8] [006f15f0, 006f1755]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void FUN_006f1460(ushort param_1)

{
  char cVar1;
  short sVar2;
  char *pcVar3;
  FILE *_File;
  short *psVar4;
  undefined4 uVar5;
  int in_ECX;
  char *in_EDX;
  uint uVar6;
  undefined1 local_8878 [32];
  undefined1 local_8858 [8];
  int local_8850;
  undefined1 local_884c [4];
  uint local_8848;
  uint local_8844;
  int local_8840;
  ushort local_883c [2];
  uint local_8838;
  undefined1 local_8834 [4];
  undefined2 local_8830;
  undefined4 local_8820;
  uint local_881c;
  short local_8818;
  undefined1 local_8816 [32766];
  char local_818;
  undefined1 local_817 [1023];
  char local_418 [1024];
  uint local_18;
  undefined4 uStack_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b26908;
  local_10 = ExceptionList;
  uStack_14 = 0x6f147b;
  local_18 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  FUN_006f0ed0(local_18);
  pcVar3 = in_EDX;
  do {
    cVar1 = *pcVar3;
    pcVar3 = pcVar3 + 1;
  } while (cVar1 != '\0');
  if (0 < (int)pcVar3 - (int)(in_EDX + 1)) {
    if (in_EDX[((int)pcVar3 - (int)(in_EDX + 1)) + -1] == '\\') {
      _strcpy_s(local_418,0x400,in_EDX);
      pcVar3 = "StringTable";
    }
    else {
      _strcpy_s(local_418,0x400,in_EDX);
      pcVar3 = "\\StringTable";
    }
    _strcat_s(local_418,0x400,pcVar3);
    _File = _fopen(local_418,"rb");
    if (_File != (FILE *)0x0) {
      local_818 = '\0';
      _memset(local_817,0,0x3ff);
      pcVar3 = _fgets(&local_818,0x400,_File);
      if ((pcVar3 != (char *)0x0) && (_fread(&local_8850,4,1,_File), local_8850 == -0x7d7da77e)) {
        _fread(&local_8844,4,1,_File);
        local_8838 = 0;
        if (local_8844 != 0) {
          local_8840 = in_ECX + 0xc4;
          do {
            if (local_8838 == 0xc) break;
            _fread(&local_8848,4,1,_File);
            uVar6 = 0;
            if (local_8848 != 0) {
              do {
                local_881c = 7;
                local_8820 = 0;
                local_8830 = 0;
                local_8 = 0;
                _fread(local_884c,4,1,_File);
                _fread(local_883c,2,1,_File);
                _fread(&local_8818,2,local_883c[0] + 1,_File);
                psVar4 = &local_8818;
                do {
                  sVar2 = *psVar4;
                  psVar4 = psVar4 + 1;
                } while (sVar2 != 0);
                FUN_00406360(&local_8818,(int)psVar4 - (int)local_8816 >> 1);
                if ((param_1 == 0xc) || (param_1 == local_8838)) {
                  uVar5 = FUN_00410510(local_8878,local_884c,local_8834);
                  local_8._0_1_ = 1;
                  FUN_004103f0(local_8858,uVar5);
                  local_8 = (uint)local_8._1_3_ << 8;
                  FUN_004427d0(local_8878);
                }
                local_8 = 0xffffffff;
                if (7 < local_881c) {
                    /* WARNING: Subroutine does not return */
                  FUN_006f04e0();
                }
                uVar6 = uVar6 + 1;
                local_881c = 7;
                local_8820 = 0;
                local_8830 = 0;
              } while (uVar6 < local_8848);
            }
            local_8840 = local_8840 + 0xc;
            local_8838 = local_8838 + 1;
          } while (local_8838 < local_8844);
        }
        _fclose(_File);
      }
    }
  }
  ExceptionList = local_10;
  __security_check_cookie(local_18 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
006f1460 : PUSH EBP
006f1461 : MOV EBP,ESP
006f1463 : PUSH -0x1
006f1465 : PUSH 0xb26908
006f146a : MOV EAX,FS:[0x0]
006f1470 : PUSH EAX
006f1471 : MOV EAX,0x8868
006f1476 : CALL 0x0063b780
006f147b : MOV EAX,[0x00d66fa0]
006f1480 : XOR EAX,EBP
006f1482 : MOV dword ptr [EBP + -0x14],EAX
006f1485 : PUSH EBX
006f1486 : PUSH ESI
006f1487 : PUSH EDI
006f1488 : PUSH EAX
006f1489 : LEA EAX,[EBP + -0xc]
006f148c : MOV FS:[0x0],EAX
006f1492 : MOV EDI,ECX
006f1494 : MOV EAX,EDI
006f1496 : MOV ESI,EDX
006f1498 : CALL 0x006f0ed0
006f149d : MOV EAX,ESI
006f149f : LEA EDX,[EAX + 0x1]
006f14a2 : XOR EBX,EBX
006f14a4 : MOV CL,byte ptr [EAX]
006f14a6 : INC EAX
006f14a7 : CMP CL,BL
006f14a9 : JNZ 0x006f14a4
006f14ab : SUB EAX,EDX
006f14ad : CMP EAX,0x1
006f14b0 : JGE 0x006f14b9
006f14b2 : XOR EAX,EAX
006f14b4 : JMP 0x006f1738
006f14b9 : CMP byte ptr [ESI + EAX*0x1 + -0x1],0x5c
006f14be : PUSH ESI
006f14bf : PUSH 0x400
006f14c4 : JNZ 0x006f14e8
006f14c6 : LEA EAX,[EBP + 0xfffffbec]
006f14cc : PUSH EAX
006f14cd : CALL 0x00638300
006f14d2 : ADD ESP,0xc
006f14d5 : PUSH 0xbf6080
006f14da : PUSH 0x400
006f14df : LEA ECX,[EBP + 0xfffffbec]
006f14e5 : PUSH ECX
006f14e6 : JMP 0x006f1508
006f14e8 : LEA EDX,[EBP + 0xfffffbec]
006f14ee : PUSH EDX
006f14ef : CALL 0x00638300
006f14f4 : ADD ESP,0xc
006f14f7 : PUSH 0xbf608c
006f14fc : PUSH 0x400
006f1501 : LEA EAX,[EBP + 0xfffffbec]
006f1507 : PUSH EAX
006f1508 : CALL 0x0063db33
006f150d : ADD ESP,0xc
006f1510 : LEA ECX,[EBP + 0xfffffbec]
006f1516 : PUSH 0xbf609c
006f151b : PUSH ECX
006f151c : CALL 0x00638fa0
006f1521 : MOV ESI,EAX
006f1523 : ADD ESP,0x8
006f1526 : CMP ESI,EBX
006f1528 : JZ 0x006f14b2
006f152a : PUSH 0x3ff
006f152f : LEA EDX,[EBP + 0xfffff7ed]
006f1535 : PUSH EBX
006f1536 : PUSH EDX
006f1537 : MOV byte ptr [EBP + 0xfffff7ec],BL
006f153d : CALL 0x0063b700
006f1542 : ADD ESP,0xc
006f1545 : PUSH ESI
006f1546 : LEA EAX,[EBP + 0xfffff7ec]
006f154c : PUSH 0x400
006f1551 : PUSH EAX
006f1552 : CALL 0x0063646e
006f1557 : ADD ESP,0xc
006f155a : TEST EAX,EAX
006f155c : JZ 0x006f14b2
006f1562 : PUSH ESI
006f1563 : PUSH 0x1
006f1565 : LEA ECX,[EBP + 0xffff77b4]
006f156b : PUSH 0x4
006f156d : PUSH ECX
006f156e : CALL 0x00638b7b
006f1573 : ADD ESP,0x10
006f1576 : CMP dword ptr [EBP + 0xffff77b4],0x82825882
006f1580 : JNZ 0x006f14b2
006f1586 : PUSH ESI
006f1587 : PUSH 0x1
006f1589 : LEA EDX,[EBP + 0xffff77c0]
006f158f : PUSH 0x4
006f1591 : PUSH EDX
006f1592 : CALL 0x00638b7b
006f1597 : ADD ESP,0x10
006f159a : MOV dword ptr [EBP + 0xffff77cc],EBX
006f15a0 : CMP dword ptr [EBP + 0xffff77c0],EBX
006f15a6 : JBE 0x006f172a
006f15ac : ADD EDI,0xc4
006f15b2 : MOV dword ptr [EBP + 0xffff77c4],EDI
006f15b8 : CMP dword ptr [EBP + 0xffff77cc],0xc
006f15bf : JZ 0x006f172a
006f15c5 : PUSH ESI
006f15c6 : PUSH 0x1
006f15c8 : LEA EAX,[EBP + 0xffff77bc]
006f15ce : PUSH 0x4
006f15d0 : PUSH EAX
006f15d1 : CALL 0x00638b7b
006f15d6 : ADD ESP,0x10
006f15d9 : XOR EDI,EDI
006f15db : CMP dword ptr [EBP + 0xffff77bc],EBX
006f15e1 : JBE 0x006f170a
006f15e7 : JMP 0x006f15f0
006f15f0 : XOR ECX,ECX
006f15f2 : MOV dword ptr [EBP + 0xffff77e8],0x7
006f15fc : MOV dword ptr [EBP + 0xffff77e4],EBX
006f1602 : MOV word ptr [EBP + 0xffff77d4],CX
006f1609 : MOV dword ptr [EBP + -0x4],EBX
006f160c : PUSH ESI
006f160d : PUSH 0x1
006f160f : LEA EDX,[EBP + 0xffff77b8]
006f1615 : PUSH 0x4
006f1617 : PUSH EDX
006f1618 : CALL 0x00638b7b
006f161d : PUSH ESI
006f161e : PUSH 0x1
006f1620 : LEA EAX,[EBP + 0xffff77c8]
006f1626 : PUSH 0x2
006f1628 : PUSH EAX
006f1629 : CALL 0x00638b7b
006f162e : MOVZX ECX,word ptr [EBP + 0xffff77c8]
006f1635 : PUSH ESI
006f1636 : INC ECX
006f1637 : PUSH ECX
006f1638 : LEA EDX,[EBP + 0xffff77ec]
006f163e : PUSH 0x2
006f1640 : PUSH EDX
006f1641 : CALL 0x00638b7b
006f1646 : LEA EAX,[EBP + 0xffff77ec]
006f164c : ADD ESP,0x30
006f164f : LEA EDX,[EAX + 0x2]
006f1652 : MOV CX,word ptr [EAX]
006f1655 : ADD EAX,0x2
006f1658 : CMP CX,BX
006f165b : JNZ 0x006f1652
006f165d : SUB EAX,EDX
006f165f : SAR EAX,0x1
006f1661 : PUSH EAX
006f1662 : LEA EAX,[EBP + 0xffff77ec]
006f1668 : PUSH EAX
006f1669 : LEA ECX,[EBP + 0xffff77d0]
006f166f : CALL 0x00406360
006f1674 : MOV AX,word ptr [EBP + 0x8]
006f1678 : CMP AX,0xc
006f167c : JZ 0x006f1689
006f167e : MOVZX ECX,AX
006f1681 : CMP ECX,dword ptr [EBP + 0xffff77cc]
006f1687 : JNZ 0x006f16c9
006f1689 : LEA EDX,[EBP + 0xffff77d0]
006f168f : PUSH EDX
006f1690 : LEA EAX,[EBP + 0xffff77b8]
006f1696 : PUSH EAX
006f1697 : LEA ECX,[EBP + 0xffff778c]
006f169d : PUSH ECX
006f169e : CALL 0x00410510
006f16a3 : MOV byte ptr [EBP + -0x4],0x1
006f16a7 : PUSH EAX
006f16a8 : MOV EAX,dword ptr [EBP + 0xffff77c4]
006f16ae : LEA EDX,[EBP + 0xffff77ac]
006f16b4 : PUSH EDX
006f16b5 : CALL 0x004103f0
006f16ba : MOV byte ptr [EBP + -0x4],BL
006f16bd : LEA EAX,[EBP + 0xffff778c]
006f16c3 : PUSH EAX
006f16c4 : CALL 0x004427d0
006f16c9 : MOV dword ptr [EBP + -0x4],0xffffffff
006f16d0 : CMP dword ptr [EBP + 0xffff77e8],0x8
006f16d7 : JC 0x006f16e4
006f16d9 : MOV ECX,dword ptr [EBP + 0xffff77d4]
006f16df : CALL 0x006f04e0
006f16e4 : XOR ECX,ECX
006f16e6 : INC EDI
006f16e7 : MOV dword ptr [EBP + 0xffff77e8],0x7
006f16f1 : MOV dword ptr [EBP + 0xffff77e4],EBX
006f16f7 : MOV word ptr [EBP + 0xffff77d4],CX
006f16fe : CMP EDI,dword ptr [EBP + 0xffff77bc]
006f1704 : JC 0x006f15f0
006f170a : MOV EAX,dword ptr [EBP + 0xffff77cc]
006f1710 : ADD dword ptr [EBP + 0xffff77c4],0xc
006f1717 : INC EAX
006f1718 : MOV dword ptr [EBP + 0xffff77cc],EAX
006f171e : CMP EAX,dword ptr [EBP + 0xffff77c0]
006f1724 : JC 0x006f15b8
006f172a : PUSH ESI
006f172b : CALL 0x006366db
006f1730 : ADD ESP,0x4
006f1733 : MOV EAX,0x1
006f1738 : MOV ECX,dword ptr [EBP + -0xc]
006f173b : MOV dword ptr FS:[0x0],ECX
006f1742 : POP ECX
006f1743 : POP EDI
006f1744 : POP ESI
006f1745 : POP EBX
006f1746 : MOV ECX,dword ptr [EBP + -0x14]
006f1749 : XOR ECX,EBP
006f174b : CALL 0x00633e6b
006f1750 : MOV ESP,EBP
006f1752 : POP EBP
006f1753 : RET 0x4
