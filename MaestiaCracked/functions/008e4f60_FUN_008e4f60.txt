PROGRAM  : Maestia.exe
FUNCTION : FUN_008e4f60
ENTRY    : 008e4f60
BODY     : [[008e4f60, 008e51b5]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008e4f60(int param_1)

{
  int *piVar1;
  uint uVar2;
  int iVar3;
  undefined4 uVar4;
  uint8_t *packet;
  int in_ECX;
  uint uVar5;
  undefined1 local_30 [28];
  uint8_t *local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b3efc2;
  local_10 = ExceptionList;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  uVar5 = 0;
  if (in_ECX != 0) {
    iVar3 = FUN_00405bb0(&DAT_00c59f5c);
    if (iVar3 != 0) {
      iVar3 = *(int *)(in_ECX + 4);
      if (*(uint *)(iVar3 + 0x34) < 8) {
        iVar3 = iVar3 + 0x20;
      }
      else {
        iVar3 = *(int *)(iVar3 + 0x20);
      }
      uVar2 = FUN_00634f4d(iVar3,uVar2);
      if (*(uint *)(*(int *)(DAT_0172491c + 0x17c) + 0x1ed0) < uVar2) {
        FUN_00406460(L"IDS_INSUFFICIENT_MONEY");
        local_8 = 0;
        piVar1 = *(int **)(*DAT_00da9894 + 0x1a8);
        uVar4 = FUN_0081d120(local_30);
        local_8._0_1_ = 1;
        (**(code **)(*piVar1 + 0x44))(uVar4,3);
        local_8 = (uint)local_8._1_3_ << 8;
        FUN_00406560();
        local_8 = 0xffffffff;
        FUN_00406560();
        piVar1 = DAT_00da9894;
        *(undefined4 *)(param_1 + 0x98) = 3;
        (**(code **)(**(int **)(*piVar1 + 0x114) + 4))
                  (*(int **)(*piVar1 + 0x114),"WritePostGold",&DAT_00c59f90,0);
        ExceptionList = local_10;
        return;
      }
      iVar3 = FUN_00703c00(0x8800);
      if (iVar3 != 0) {
        uVar5 = *(uint *)(iVar3 + 0x44);
      }
      if (uVar5 < uVar2) {
        FUN_00406460(L"IDS_CLTNET_ERR_WRONGAMOUNTMONEY");
        local_8 = 2;
        piVar1 = *(int **)(*DAT_00da9894 + 0x1a8);
        uVar4 = FUN_0081d120(local_30);
        local_8._0_1_ = 3;
        (**(code **)(*piVar1 + 0x44))(uVar4,3);
        local_8 = CONCAT31(local_8._1_3_,2);
        FUN_00406560();
        local_8 = 0xffffffff;
        FUN_00406560();
        piVar1 = DAT_00da9894;
        *(undefined4 *)(param_1 + 0x98) = 3;
        (**(code **)(**(int **)(*piVar1 + 0x114) + 4))
                  (*(int **)(*piVar1 + 0x114),"WritePostGold",&DAT_00c59fe8,0);
        ExceptionList = local_10;
        return;
      }
      local_14 = (uint8_t *)FUN_006f4590();
      if (local_14 == (uint8_t *)0x0) {
        packet = (uint8_t *)0x0;
      }
      else {
        local_14[0] = '\0';
        local_14[1] = '\0';
        local_14[2] = 'D';
        local_14[3] = '\x03';
        *(uint *)(local_14 + 4) = uVar2;
        packet = local_14;
      }
      local_8 = 0xffffffff;
      if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
        FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),8,packet);
      }
      *(undefined4 *)(param_1 + 0x98) = 2;
    }
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
008e4f60 : PUSH EBP
008e4f61 : MOV EBP,ESP
008e4f63 : PUSH -0x1
008e4f65 : PUSH 0xb3efc2
008e4f6a : MOV EAX,FS:[0x0]
008e4f70 : PUSH EAX
008e4f71 : SUB ESP,0x40
008e4f74 : PUSH EBX
008e4f75 : PUSH ESI
008e4f76 : PUSH EDI
008e4f77 : MOV EAX,[0x00d66fa0]
008e4f7c : XOR EAX,EBP
008e4f7e : PUSH EAX
008e4f7f : LEA EAX,[EBP + -0xc]
008e4f82 : MOV FS:[0x0],EAX
008e4f88 : MOV ESI,ECX
008e4f8a : XOR EBX,EBX
008e4f8c : CMP ESI,EBX
008e4f8e : JZ 0x008e51a2
008e4f94 : MOV ECX,dword ptr [ESI + 0x4]
008e4f97 : MOV EAX,dword ptr [ECX + 0x30]
008e4f9a : ADD ECX,0x1c
008e4f9d : PUSH 0xc59f5c
008e4fa2 : XOR EDI,EDI
008e4fa4 : CALL 0x00405bb0
008e4fa9 : TEST EAX,EAX
008e4fab : JZ 0x008e51a2
008e4fb1 : MOV EAX,dword ptr [ESI + 0x4]
008e4fb4 : ADD EAX,0x1c
008e4fb7 : CMP dword ptr [EAX + 0x18],0x8
008e4fbb : JC 0x008e4fc2
008e4fbd : MOV EAX,dword ptr [EAX + 0x4]
008e4fc0 : JMP 0x008e4fc5
008e4fc2 : ADD EAX,0x4
008e4fc5 : PUSH EAX
008e4fc6 : CALL 0x00634f4d
008e4fcb : MOV ESI,EAX
008e4fcd : MOV EAX,[0x0172491c]
008e4fd2 : MOV EAX,dword ptr [EAX + 0x17c]
008e4fd8 : ADD ESP,0x4
008e4fdb : CMP ESI,dword ptr [EAX + 0x1ed0]
008e4fe1 : JBE 0x008e5087
008e4fe7 : PUSH 0xc59f60
008e4fec : LEA ECX,[EBP + -0x2c]
008e4fef : CALL 0x00406460
008e4ff4 : MOV dword ptr [EBP + -0x4],EBX
008e4ff7 : MOV ECX,dword ptr [0x00da9894]
008e4ffd : MOV EAX,dword ptr [ECX]
008e4fff : MOV ECX,dword ptr [0x0172491c]
008e5005 : MOV ESI,dword ptr [EAX + 0x1a8]
008e500b : LEA EDX,[EBP + -0x2c]
008e500e : PUSH EDX
008e500f : LEA EDI,[EBP + -0x48]
008e5012 : CALL 0x0081d120
008e5017 : MOV byte ptr [EBP + -0x4],0x1
008e501b : MOV EDX,dword ptr [ESI]
008e501d : MOV EBX,0x3
008e5022 : PUSH EBX
008e5023 : PUSH EAX
008e5024 : MOV EAX,dword ptr [EDX + 0x44]
008e5027 : MOV ECX,ESI
008e5029 : CALL EAX
008e502b : MOV byte ptr [EBP + -0x4],0x0
008e502f : MOV ECX,EDI
008e5031 : CALL 0x00406560
008e5036 : MOV dword ptr [EBP + -0x4],0xffffffff
008e503d : LEA ECX,[EBP + -0x2c]
008e5040 : CALL 0x00406560
008e5045 : MOV ECX,dword ptr [EBP + 0x8]
008e5048 : MOV EDX,dword ptr [0x00da9894]
008e504e : MOV dword ptr [ECX + 0x98],EBX
008e5054 : MOV EAX,dword ptr [EDX]
008e5056 : MOV EAX,dword ptr [EAX + 0x114]
008e505c : MOV ECX,dword ptr [EAX]
008e505e : MOV EDX,dword ptr [ECX + 0x4]
008e5061 : PUSH 0x0
008e5063 : PUSH 0xc59f90
008e5068 : PUSH 0xc59f94
008e506d : PUSH EAX
008e506e : CALL EDX
008e5070 : ADD ESP,0x10
008e5073 : MOV ECX,dword ptr [EBP + -0xc]
008e5076 : MOV dword ptr FS:[0x0],ECX
008e507d : POP ECX
008e507e : POP EDI
008e507f : POP ESI
008e5080 : POP EBX
008e5081 : MOV ESP,EBP
008e5083 : POP EBP
008e5084 : RET 0x4
008e5087 : PUSH 0x8800
008e508c : MOV EDI,0x1
008e5091 : CALL 0x00703c00
008e5096 : ADD ESP,0x4
008e5099 : TEST EAX,EAX
008e509b : JZ 0x008e50a0
008e509d : MOV EBX,dword ptr [EAX + 0x44]
008e50a0 : CMP ESI,EBX
008e50a2 : JBE 0x008e514a
008e50a8 : PUSH 0xc59fa8
008e50ad : LEA ECX,[EBP + -0x2c]
008e50b0 : CALL 0x00406460
008e50b5 : MOV dword ptr [EBP + -0x4],0x2
008e50bc : MOV EAX,[0x00da9894]
008e50c1 : MOV EAX,dword ptr [EAX]
008e50c3 : MOV ESI,dword ptr [EAX + 0x1a8]
008e50c9 : LEA ECX,[EBP + -0x2c]
008e50cc : PUSH ECX
008e50cd : MOV ECX,dword ptr [0x0172491c]
008e50d3 : LEA EDI,[EBP + -0x48]
008e50d6 : CALL 0x0081d120
008e50db : MOV EBX,0x3
008e50e0 : MOV byte ptr [EBP + -0x4],BL
008e50e3 : MOV EDX,dword ptr [ESI]
008e50e5 : PUSH EBX
008e50e6 : PUSH EAX
008e50e7 : MOV EAX,dword ptr [EDX + 0x44]
008e50ea : MOV ECX,ESI
008e50ec : CALL EAX
008e50ee : MOV byte ptr [EBP + -0x4],0x2
008e50f2 : MOV ECX,EDI
008e50f4 : CALL 0x00406560
008e50f9 : MOV dword ptr [EBP + -0x4],0xffffffff
008e5100 : LEA ECX,[EBP + -0x2c]
008e5103 : CALL 0x00406560
008e5108 : MOV ECX,dword ptr [EBP + 0x8]
008e510b : MOV EDX,dword ptr [0x00da9894]
008e5111 : MOV dword ptr [ECX + 0x98],EBX
008e5117 : MOV EAX,dword ptr [EDX]
008e5119 : MOV EAX,dword ptr [EAX + 0x114]
008e511f : MOV ECX,dword ptr [EAX]
008e5121 : MOV EDX,dword ptr [ECX + 0x4]
008e5124 : PUSH 0x0
008e5126 : PUSH 0xc59fe8
008e512b : PUSH 0xc59fec
008e5130 : PUSH EAX
008e5131 : CALL EDX
008e5133 : ADD ESP,0x10
008e5136 : MOV ECX,dword ptr [EBP + -0xc]
008e5139 : MOV dword ptr FS:[0x0],ECX
008e5140 : POP ECX
008e5141 : POP EDI
008e5142 : POP ESI
008e5143 : POP EBX
008e5144 : MOV ESP,EBP
008e5146 : POP EBP
008e5147 : RET 0x4
008e514a : CALL 0x006f4590
008e514f : MOV dword ptr [EBP + -0x10],EAX
008e5152 : MOV dword ptr [EBP + -0x4],0x4
008e5159 : TEST EAX,EAX
008e515b : JZ 0x008e516f
008e515d : XOR ECX,ECX
008e515f : MOV word ptr [EAX],CX
008e5162 : MOV byte ptr [EAX + 0x2],0x44
008e5166 : MOV byte ptr [EAX + 0x3],0x3
008e516a : MOV dword ptr [EAX + 0x4],ESI
008e516d : JMP 0x008e5171
008e516f : XOR EAX,EAX
008e5171 : MOV dword ptr [EBP + -0x4],0xffffffff
008e5178 : MOV EDX,dword ptr [0x017247d4]
008e517e : MOV ECX,dword ptr [EDX + 0x4]
008e5181 : TEST ECX,ECX
008e5183 : JZ 0x008e5195
008e5185 : CMP byte ptr [EDX + 0x8],0x0
008e5189 : JZ 0x008e5195
008e518b : PUSH 0x8
008e518d : PUSH ECX
008e518e : MOV EDI,EAX
008e5190 : CALL 0x00a0dd40
008e5195 : MOV EDX,dword ptr [EBP + 0x8]
008e5198 : MOV dword ptr [EDX + 0x98],0x2
008e51a2 : MOV ECX,dword ptr [EBP + -0xc]
008e51a5 : MOV dword ptr FS:[0x0],ECX
008e51ac : POP ECX
008e51ad : POP EDI
008e51ae : POP ESI
008e51af : POP EBX
008e51b0 : MOV ESP,EBP
008e51b2 : POP EBP
008e51b3 : RET 0x4
