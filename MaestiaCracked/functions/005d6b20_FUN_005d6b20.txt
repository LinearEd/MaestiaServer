PROGRAM  : Maestia.exe
FUNCTION : FUN_005d6b20
ENTRY    : 005d6b20
BODY     : [[005d6b20, 005d6eaa]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_005d6b20(undefined4 param_1,int *param_2,GMatrix2D *param_3)

{
  byte bVar1;
  int *piVar2;
  code *pcVar3;
  float fVar4;
  float fVar5;
  int iVar6;
  undefined4 uVar7;
  int iVar8;
  byte *in_ECX;
  undefined4 unaff_EBP;
  GMatrix2D *pGVar9;
  undefined4 *unaff_retaddr;
  int local_50;
  int local_4c [5];
  undefined4 uStack_38;
  undefined4 uStack_34;
  undefined4 local_30;
  undefined4 uStack_2c;
  undefined4 uStack_28;
  undefined4 uStack_24;
  undefined4 uStack_20;
  undefined4 uStack_1c;
  undefined4 uStack_18;
  undefined4 uStack_14;
  undefined4 uStack_10;
  undefined4 uStack_c;
  undefined4 *puStack_4;
  
  iVar8 = *(int *)(*param_2 + 0xc);
  GMatrix2D::SetIdentity((GMatrix2D *)&local_30);
  if ((*in_ECX & 0x10) != 0) {
    if (*(int *)(in_ECX + 8) == 0) {
      iVar6 = *(int *)(in_ECX + 0xc);
    }
    else {
      local_50 = 0;
      local_4c[0] = 0;
      FUN_00502240(&local_50,*(undefined4 *)(in_ECX + 0xc));
      iVar6 = local_50;
      if (local_50 != 0) {
        FUN_00524240();
      }
    }
    if (iVar6 == 0) {
      if (*(int *)(in_ECX + 8) == 1) {
        return 0;
      }
      iVar6 = FUN_005d65e0(param_2[7],param_2[2],param_2[3],*param_2,param_2[5],0);
      if (iVar6 == 0) {
        return 0;
      }
      FUN_005d4ff0(iVar6);
      FUN_00524240();
    }
    if (*(int **)(iVar6 + 0xc) == (int *)0x0) {
      return 0;
    }
    uVar7 = (**(code **)(**(int **)(iVar6 + 0xc) + 0xc))(iVar8);
    *unaff_retaddr = uVar7;
    unaff_retaddr[7] = 1;
    unaff_retaddr[8] = 1;
    pGVar9 = (GMatrix2D *)(unaff_retaddr + 1);
    GMatrix2D::SetIdentity(pGVar9);
    bVar1 = *in_ECX;
    *(float *)pGVar9 = *(float *)pGVar9 * 3.0517578e-05;
    unaff_retaddr[2] = (float)unaff_retaddr[2] * 3.0517578e-05;
    unaff_retaddr[3] = (float)unaff_retaddr[3] * 3.0517578e-05;
    unaff_retaddr[4] = (float)unaff_retaddr[4] * 3.0517578e-05;
    unaff_retaddr[5] = (float)unaff_retaddr[5] * 3.0517578e-05;
    unaff_retaddr[6] = (float)unaff_retaddr[6] * 3.0517578e-05;
    if (bVar1 == 0x10) {
      unaff_retaddr[3] = (float)unaff_retaddr[3] + 0.5;
      fVar4 = (float)unaff_retaddr[6] + 0.0;
    }
    else {
      unaff_retaddr[3] = (float)unaff_retaddr[3] + 0.5;
      fVar4 = (float)unaff_retaddr[6] + 0.5;
    }
    unaff_retaddr[6] = fVar4;
    uStack_34 = *(undefined4 *)(in_ECX + 0x10);
    local_30 = *(undefined4 *)(in_ECX + 0x14);
    uStack_2c = *(undefined4 *)(in_ECX + 0x18);
    uStack_28 = *(undefined4 *)(in_ECX + 0x1c);
    uStack_24 = *(undefined4 *)(in_ECX + 0x20);
    uStack_20 = *(undefined4 *)(in_ECX + 0x24);
    if (param_3 != (GMatrix2D *)0x0) {
      GMatrix2D::Append((GMatrix2D *)&uStack_34,param_3);
    }
    GMatrix2D::SetIdentity((GMatrix2D *)&uStack_1c);
    GMatrix2D::SetInverse((GMatrix2D *)&uStack_1c,(GMatrix2D *)&uStack_34);
    GMatrix2D::Prepend(pGVar9,(GMatrix2D *)&uStack_1c);
    local_4c[1] = 0;
    local_4c[2] = 0;
    local_4c[3] = 0;
    uStack_38 = 0;
    local_4c[0] = iVar8;
    local_4c[4] = iVar8;
    GMatrix2D::Prepend(pGVar9,(GMatrix2D *)local_4c);
    return 1;
  }
  if ((*in_ECX & 0x40) == 0) {
    return 0;
  }
  iVar6 = FUN_005d5b80(in_ECX + 8);
  if (iVar6 == 0) {
    return 0;
  }
  piVar2 = *(int **)(iVar6 + 0xc);
  if (piVar2 == (int *)0x0) {
    return 0;
  }
  iVar8 = (**(code **)(*piVar2 + 0xc))(iVar8);
  if (iVar8 == 0) {
    return 0;
  }
  uVar7 = 0;
  param_1 = 1;
  switch(*in_ECX) {
  case 0x40:
    uVar7 = 0;
    param_1 = 1;
    break;
  case 0x41:
    param_1 = 1;
    goto LAB_005d6d66;
  case 0x42:
    uVar7 = 0;
    param_1 = 0;
    break;
  case 0x43:
    param_1 = 0;
LAB_005d6d66:
    uVar7 = 1;
  }
  uStack_34 = *(undefined4 *)(in_ECX + 0x10);
  local_30 = *(undefined4 *)(in_ECX + 0x14);
  uStack_2c = *(undefined4 *)(in_ECX + 0x18);
  uStack_28 = *(undefined4 *)(in_ECX + 0x1c);
  uStack_24 = *(undefined4 *)(in_ECX + 0x20);
  uStack_20 = *(undefined4 *)(in_ECX + 0x24);
  if (param_3 != (GMatrix2D *)0x0) {
    GMatrix2D::Append((GMatrix2D *)&uStack_34,param_3);
  }
  (**(code **)(*piVar2 + 0x14))(local_4c);
  pGVar9 = (GMatrix2D *)(puStack_4 + 1);
  *puStack_4 = unaff_EBP;
  GMatrix2D::SetInverse(pGVar9,(GMatrix2D *)&uStack_38);
  uStack_20 = param_1;
  uStack_1c = 0;
  uStack_18 = 0;
  uStack_14 = 0;
  uStack_c = 0;
  uStack_10 = param_1;
  GMatrix2D::Prepend(pGVar9,(GMatrix2D *)&uStack_20);
  pcVar3 = *(code **)(*piVar2 + 4);
  puStack_4[3] = (float)local_50 + (float)puStack_4[3];
  puStack_4[6] = (float)local_4c[0] + (float)puStack_4[6];
  iVar8 = (*pcVar3)();
  fVar4 = (float)iVar8;
  if (iVar8 < 0) {
    fVar4 = fVar4 + 4.2949673e+09;
  }
  fVar4 = 1.0 / fVar4;
  iVar8 = (**(code **)(*piVar2 + 8))();
  fVar5 = (float)iVar8;
  if (iVar8 < 0) {
    fVar5 = fVar5 + 4.2949673e+09;
  }
  fVar5 = 1.0 / fVar5;
  *(float *)pGVar9 = fVar4 * *(float *)pGVar9;
  puStack_4[2] = (float)puStack_4[2] * fVar4;
  puStack_4[3] = fVar4 * (float)puStack_4[3];
  puStack_4[4] = fVar5 * (float)puStack_4[4];
  puStack_4[5] = fVar5 * (float)puStack_4[5];
  puStack_4[6] = fVar5 * (float)puStack_4[6];
  puStack_4[7] = uVar7;
  puStack_4[8] = unaff_retaddr;
  return 1;
}



============================================================
DISASSEMBLY
============================================================
005d6b20 : SUB ESP,0x50
005d6b23 : PUSH EBX
005d6b24 : PUSH EBP
005d6b25 : PUSH ESI
005d6b26 : PUSH EDI
005d6b27 : MOV EDI,dword ptr [ESP + 0x68]
005d6b2b : MOV EAX,dword ptr [EDI]
005d6b2d : MOV EBP,dword ptr [EAX + 0xc]
005d6b30 : MOV ESI,ECX
005d6b32 : LEA ECX,[ESP + 0x30]
005d6b36 : MOV dword ptr [ESP + 0x68],EBP
005d6b3a : CALL 0x00522b80
005d6b3f : MOV AL,byte ptr [ESI]
005d6b41 : TEST AL,0x10
005d6b43 : JZ 0x005d6cf0
005d6b49 : LEA EBP,[ESI + 0x8]
005d6b4c : XOR EAX,EAX
005d6b4e : CMP dword ptr [EBP],EAX
005d6b51 : JNZ 0x005d6b58
005d6b53 : MOV EBX,dword ptr [EBP + 0x4]
005d6b56 : JMP 0x005d6b80
005d6b58 : MOV ECX,dword ptr [EBP + 0x4]
005d6b5b : PUSH ECX
005d6b5c : MOV ECX,dword ptr [EDI + 0x20]
005d6b5f : LEA EDX,[ESP + 0x14]
005d6b63 : PUSH EDX
005d6b64 : MOV dword ptr [ESP + 0x18],EAX
005d6b68 : MOV dword ptr [ESP + 0x1c],EAX
005d6b6c : CALL 0x00502240
005d6b71 : MOV ECX,dword ptr [ESP + 0x10]
005d6b75 : MOV EBX,ECX
005d6b77 : TEST ECX,ECX
005d6b79 : JZ 0x005d6b80
005d6b7b : CALL 0x00524240
005d6b80 : TEST EBX,EBX
005d6b82 : JNZ 0x005d6bc4
005d6b84 : CMP dword ptr [EBP],0x1
005d6b88 : JZ 0x005d6e9f
005d6b8e : MOV EAX,dword ptr [EDI + 0x14]
005d6b91 : MOV ECX,dword ptr [EDI]
005d6b93 : MOV EDX,dword ptr [EDI + 0xc]
005d6b96 : MOV EBX,dword ptr [EDI + 0x8]
005d6b99 : MOV EDI,dword ptr [EDI + 0x1c]
005d6b9c : PUSH 0x0
005d6b9e : PUSH EAX
005d6b9f : PUSH ECX
005d6ba0 : MOV ECX,dword ptr [ESI + 0x4]
005d6ba3 : PUSH EDX
005d6ba4 : PUSH EBX
005d6ba5 : PUSH EDI
005d6ba6 : CALL 0x005d65e0
005d6bab : MOV EBX,EAX
005d6bad : TEST EBX,EBX
005d6baf : JZ 0x005d6e9f
005d6bb5 : PUSH EBX
005d6bb6 : MOV ECX,EBP
005d6bb8 : CALL 0x005d4ff0
005d6bbd : MOV ECX,EBX
005d6bbf : CALL 0x00524240
005d6bc4 : MOV EBX,dword ptr [EBX + 0xc]
005d6bc7 : TEST EBX,EBX
005d6bc9 : JZ 0x005d6e9f
005d6bcf : MOV ECX,dword ptr [ESP + 0x68]
005d6bd3 : MOV EAX,dword ptr [EBX]
005d6bd5 : MOV EDX,dword ptr [EAX + 0xc]
005d6bd8 : PUSH ECX
005d6bd9 : MOV ECX,EBX
005d6bdb : CALL EDX
005d6bdd : MOV EDI,dword ptr [ESP + 0x64]
005d6be1 : MOV dword ptr [EDI],EAX
005d6be3 : MOV EAX,0x1
005d6be8 : MOV dword ptr [EDI + 0x1c],EAX
005d6beb : MOV dword ptr [EDI + 0x20],EAX
005d6bee : ADD EDI,0x4
005d6bf1 : MOV ECX,EDI
005d6bf3 : CALL 0x00522b80
005d6bf8 : FLD float ptr [EDI]
005d6bfa : FLD double ptr [0x00b937e0]
005d6c00 : CMP byte ptr [ESI],0x10
005d6c03 : FMUL ST1
005d6c05 : FXCH
005d6c07 : FSTP float ptr [EDI]
005d6c09 : FLD float ptr [EDI + 0x4]
005d6c0c : FMUL ST1
005d6c0e : FSTP float ptr [EDI + 0x4]
005d6c11 : FLD float ptr [EDI + 0x8]
005d6c14 : FMUL ST1
005d6c16 : FSTP float ptr [EDI + 0x8]
005d6c19 : FLD float ptr [EDI + 0xc]
005d6c1c : FMUL ST1
005d6c1e : FSTP float ptr [EDI + 0xc]
005d6c21 : FLD float ptr [EDI + 0x10]
005d6c24 : FMUL ST1
005d6c26 : FSTP float ptr [EDI + 0x10]
005d6c29 : FMUL float ptr [EDI + 0x14]
005d6c2c : FSTP float ptr [EDI + 0x14]
005d6c2f : FLD float ptr [EDI + 0x8]
005d6c32 : JNZ 0x005d6c48
005d6c34 : FADD double ptr [0x00cdf120]
005d6c3a : FSTP float ptr [EDI + 0x8]
005d6c3d : FLD float ptr [EDI + 0x14]
005d6c40 : FADD double ptr [0x00cdf338]
005d6c46 : JMP 0x005d6c58
005d6c48 : FLD double ptr [0x00cdf120]
005d6c4e : FADD ST1,ST0
005d6c50 : FXCH
005d6c52 : FSTP float ptr [EDI + 0x8]
005d6c55 : FADD float ptr [EDI + 0x14]
005d6c58 : MOV EAX,dword ptr [ESP + 0x70]
005d6c5c : FSTP float ptr [EDI + 0x14]
005d6c5f : FLD float ptr [ESI + 0x10]
005d6c62 : FSTP float ptr [ESP + 0x30]
005d6c66 : FLD float ptr [ESI + 0x14]
005d6c69 : FSTP float ptr [ESP + 0x34]
005d6c6d : FLD float ptr [ESI + 0x18]
005d6c70 : FSTP float ptr [ESP + 0x38]
005d6c74 : FLD float ptr [ESI + 0x1c]
005d6c77 : FSTP float ptr [ESP + 0x3c]
005d6c7b : FLD float ptr [ESI + 0x20]
005d6c7e : FSTP float ptr [ESP + 0x40]
005d6c82 : FLD float ptr [ESI + 0x24]
005d6c85 : FSTP float ptr [ESP + 0x44]
005d6c89 : TEST EAX,EAX
005d6c8b : JZ 0x005d6c97
005d6c8d : PUSH EAX
005d6c8e : LEA ECX,[ESP + 0x34]
005d6c92 : CALL 0x00522ee0
005d6c97 : LEA ECX,[ESP + 0x48]
005d6c9b : CALL 0x00522b80
005d6ca0 : LEA EAX,[ESP + 0x30]
005d6ca4 : PUSH EAX
005d6ca5 : LEA ECX,[ESP + 0x4c]
005d6ca9 : CALL 0x00522cb0
005d6cae : LEA ECX,[ESP + 0x48]
005d6cb2 : PUSH ECX
005d6cb3 : MOV ECX,EDI
005d6cb5 : CALL 0x00522e20
005d6cba : FLD float ptr [ESP + 0x6c]
005d6cbe : FST float ptr [ESP + 0x18]
005d6cc2 : LEA EDX,[ESP + 0x18]
005d6cc6 : FLDZ
005d6cc8 : PUSH EDX
005d6cc9 : FST float ptr [ESP + 0x20]
005d6ccd : MOV ECX,EDI
005d6ccf : FST float ptr [ESP + 0x24]
005d6cd3 : FST float ptr [ESP + 0x28]
005d6cd7 : FSTP float ptr [ESP + 0x30]
005d6cdb : FSTP float ptr [ESP + 0x2c]
005d6cdf : CALL 0x00522e20
005d6ce4 : POP EDI
005d6ce5 : POP ESI
005d6ce6 : POP EBP
005d6ce7 : MOV AL,0x1
005d6ce9 : POP EBX
005d6cea : ADD ESP,0x50
005d6ced : RET 0x10
005d6cf0 : TEST AL,0x40
005d6cf2 : JZ 0x005d6e9f
005d6cf8 : MOV ECX,dword ptr [EDI + 0x20]
005d6cfb : LEA EAX,[ESI + 0x8]
005d6cfe : PUSH EAX
005d6cff : CALL 0x005d5b80
005d6d04 : XOR EBX,EBX
005d6d06 : CMP EAX,EBX
005d6d08 : JZ 0x005d6e9f
005d6d0e : MOV EDI,dword ptr [EAX + 0xc]
005d6d11 : CMP EDI,EBX
005d6d13 : JZ 0x005d6e9f
005d6d19 : MOV EDX,dword ptr [EDI]
005d6d1b : MOV EAX,dword ptr [EDX + 0xc]
005d6d1e : PUSH EBP
005d6d1f : MOV ECX,EDI
005d6d21 : CALL EAX
005d6d23 : MOV dword ptr [ESP + 0x10],EAX
005d6d27 : CMP EAX,EBX
005d6d29 : JZ 0x005d6e9f
005d6d2f : MOVZX EAX,byte ptr [ESI]
005d6d32 : ADD EAX,-0x40
005d6d35 : XOR EBP,EBP
005d6d37 : MOV ECX,0x1
005d6d3c : MOV dword ptr [ESP + 0x68],ECX
005d6d40 : CMP EAX,0x3
005d6d43 : JA 0x005d6d68
005d6d45 : JMP dword ptr [EAX*0x4 + 0x5d6eac]
005d6d4c : XOR EBP,EBP
005d6d4e : MOV dword ptr [ESP + 0x68],ECX
005d6d52 : JMP 0x005d6d68
005d6d54 : MOV dword ptr [ESP + 0x68],ECX
005d6d58 : JMP 0x005d6d66
005d6d5a : XOR EBP,EBP
005d6d5c : MOV dword ptr [ESP + 0x68],EBX
005d6d60 : JMP 0x005d6d68
005d6d62 : MOV dword ptr [ESP + 0x68],EBX
005d6d66 : MOV EBP,ECX
005d6d68 : FLD float ptr [ESI + 0x10]
005d6d6b : MOV EAX,dword ptr [ESP + 0x70]
005d6d6f : FSTP float ptr [ESP + 0x30]
005d6d73 : FLD float ptr [ESI + 0x14]
005d6d76 : FSTP float ptr [ESP + 0x34]
005d6d7a : FLD float ptr [ESI + 0x18]
005d6d7d : FSTP float ptr [ESP + 0x38]
005d6d81 : FLD float ptr [ESI + 0x1c]
005d6d84 : FSTP float ptr [ESP + 0x3c]
005d6d88 : FLD float ptr [ESI + 0x20]
005d6d8b : FSTP float ptr [ESP + 0x40]
005d6d8f : FLD float ptr [ESI + 0x24]
005d6d92 : FSTP float ptr [ESP + 0x44]
005d6d96 : CMP EAX,EBX
005d6d98 : JZ 0x005d6da4
005d6d9a : PUSH EAX
005d6d9b : LEA ECX,[ESP + 0x34]
005d6d9f : CALL 0x00522ee0
005d6da4 : MOV EDX,dword ptr [EDI]
005d6da6 : MOV EDX,dword ptr [EDX + 0x14]
005d6da9 : LEA EAX,[ESP + 0x18]
005d6dad : PUSH EAX
005d6dae : MOV ECX,EDI
005d6db0 : CALL EDX
005d6db2 : MOV EBX,dword ptr [ESP + 0x64]
005d6db6 : MOV EAX,dword ptr [ESP + 0x10]
005d6dba : LEA ECX,[ESP + 0x30]
005d6dbe : LEA ESI,[EBX + 0x4]
005d6dc1 : PUSH ECX
005d6dc2 : MOV ECX,ESI
005d6dc4 : MOV dword ptr [EBX],EAX
005d6dc6 : CALL 0x00522cb0
005d6dcb : FLD float ptr [ESP + 0x6c]
005d6dcf : FST float ptr [ESP + 0x48]
005d6dd3 : LEA EDX,[ESP + 0x48]
005d6dd7 : FLDZ
005d6dd9 : PUSH EDX
005d6dda : FST float ptr [ESP + 0x50]
005d6dde : MOV ECX,ESI
005d6de0 : FST float ptr [ESP + 0x54]
005d6de4 : FST float ptr [ESP + 0x58]
005d6de8 : FSTP float ptr [ESP + 0x60]
005d6dec : FSTP float ptr [ESP + 0x5c]
005d6df0 : CALL 0x00522e20
005d6df5 : FILD dword ptr [ESP + 0x18]
005d6df9 : MOV EAX,dword ptr [EDI]
005d6dfb : MOV EDX,dword ptr [EAX + 0x4]
005d6dfe : MOV ECX,EDI
005d6e00 : FADD float ptr [ESI + 0x8]
005d6e03 : FSTP float ptr [ESI + 0x8]
005d6e06 : FILD dword ptr [ESP + 0x1c]
005d6e0a : FADD float ptr [ESI + 0x14]
005d6e0d : FSTP float ptr [ESI + 0x14]
005d6e10 : CALL EDX
005d6e12 : MOV dword ptr [ESP + 0x70],EAX
005d6e16 : FILD dword ptr [ESP + 0x70]
005d6e1a : TEST EAX,EAX
005d6e1c : JGE 0x005d6e24
005d6e1e : FADD float ptr [0x00cdf0e0]
005d6e24 : FLD1
005d6e26 : MOV EAX,dword ptr [EDI]
005d6e28 : FDIVRP
005d6e2a : MOV EDX,dword ptr [EAX + 0x8]
005d6e2d : MOV ECX,EDI
005d6e2f : FSTP float ptr [ESP + 0x70]
005d6e33 : CALL EDX
005d6e35 : MOV dword ptr [ESP + 0x64],EAX
005d6e39 : FILD dword ptr [ESP + 0x64]
005d6e3d : TEST EAX,EAX
005d6e3f : JGE 0x005d6e47
005d6e41 : FADD float ptr [0x00cdf0e0]
005d6e47 : FLD1
005d6e49 : MOV EAX,dword ptr [ESP + 0x68]
005d6e4d : FDIVRP
005d6e4f : POP EDI
005d6e50 : FSTP float ptr [ESP + 0x60]
005d6e54 : FLD float ptr [ESI]
005d6e56 : FLD float ptr [ESP + 0x6c]
005d6e5a : FLD ST0
005d6e5c : FMULP ST2
005d6e5e : FXCH
005d6e60 : FSTP float ptr [ESI]
005d6e62 : FLD float ptr [ESI + 0x4]
005d6e65 : FMUL ST1
005d6e67 : FSTP float ptr [ESI + 0x4]
005d6e6a : FMUL float ptr [ESI + 0x8]
005d6e6d : FSTP float ptr [ESI + 0x8]
005d6e70 : FLD float ptr [ESI + 0xc]
005d6e73 : FLD float ptr [ESP + 0x60]
005d6e77 : FLD ST0
005d6e79 : FMULP ST2
005d6e7b : FXCH
005d6e7d : FSTP float ptr [ESI + 0xc]
005d6e80 : FLD ST0
005d6e82 : FMUL float ptr [ESI + 0x10]
005d6e85 : FSTP float ptr [ESI + 0x10]
005d6e88 : FMUL float ptr [ESI + 0x14]
005d6e8b : FSTP float ptr [ESI + 0x14]
005d6e8e : POP ESI
005d6e8f : MOV dword ptr [EBX + 0x1c],EBP
005d6e92 : MOV dword ptr [EBX + 0x20],EAX
005d6e95 : POP EBP
005d6e96 : MOV AL,0x1
005d6e98 : POP EBX
005d6e99 : ADD ESP,0x50
005d6e9c : RET 0x10
005d6e9f : POP EDI
005d6ea0 : POP ESI
005d6ea1 : POP EBP
005d6ea2 : XOR AL,AL
005d6ea4 : POP EBX
005d6ea5 : ADD ESP,0x50
005d6ea8 : RET 0x10
