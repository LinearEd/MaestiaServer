PROGRAM  : Maestia.exe
FUNCTION : FUN_006aef70
ENTRY    : 006aef70
BODY     : [[006aef70, 006af191]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006aef70(int param_1,int *param_2)

{
  byte bVar1;
  undefined4 uVar2;
  uint *puVar3;
  byte *pbVar4;
  int iVar5;
  byte *pbVar6;
  int iVar7;
  byte *pbVar8;
  char *pcVar9;
  uint uVar10;
  int *piVar11;
  int iVar12;
  bool bVar13;
  int local_54;
  uint local_50;
  int *local_4c;
  uint local_38;
  uint local_34;
  int local_2c [11];
  
  uVar2 = *(undefined4 *)(param_1 + 100);
  piVar11 = *(int **)(param_1 + 0x210);
  local_4c = piVar11;
  local_54 = FUN_006aedc0(param_1,&local_38);
  uVar10 = local_38;
  if ((local_54 == 0) &&
     (puVar3 = (uint *)FUN_00688c00(uVar2,local_38 * 0x18 + 0x14,&local_54), local_54 == 0)) {
    *puVar3 = uVar10;
    puVar3[1] = local_34;
    puVar3[2] = 0xffffffff;
    puVar3[3] = (uint)(puVar3 + 5);
    puVar3[4] = 0;
    if (uVar10 != 0) {
      iVar12 = 0;
      piVar11 = local_2c;
      local_50 = uVar10;
      do {
        iVar7 = *piVar11;
        *(int *)(iVar12 + puVar3[3]) = piVar11[-1];
        iVar5 = piVar11[1];
        *(int *)(puVar3[3] + 4 + iVar12) = iVar7 << 0x10;
        *(int *)(puVar3[3] + 0xc + iVar12) = iVar5 << 0x10;
        uVar10 = puVar3[3];
        *(int *)(uVar10 + iVar12 + 8) =
             (*(int *)(uVar10 + 0xc + iVar12) + *(int *)(uVar10 + 4 + iVar12)) / 2;
        *(undefined4 *)(puVar3[3] + 0x14 + iVar12) = 0xffffffff;
        *(undefined4 *)(puVar3[3] + 0x10 + iVar12) = 0xffffffff;
        pbVar6 = *(byte **)(puVar3[3] + iVar12);
        iVar7 = puVar3[3] + iVar12;
        pbVar8 = &DAT_00be87fc;
        pbVar4 = pbVar6;
        do {
          bVar1 = *pbVar4;
          bVar13 = bVar1 < *pbVar8;
          if (bVar1 != *pbVar8) {
LAB_006af080:
            iVar5 = (1 - (uint)bVar13) - (uint)(bVar13 != 0);
            goto LAB_006af085;
          }
          if (bVar1 == 0) break;
          bVar1 = pbVar4[1];
          bVar13 = bVar1 < pbVar8[1];
          if (bVar1 != pbVar8[1]) goto LAB_006af080;
          pbVar4 = pbVar4 + 2;
          pbVar8 = pbVar8 + 2;
        } while (bVar1 != 0);
        iVar5 = 0;
LAB_006af085:
        if (iVar5 == 0) {
          *(undefined4 *)(iVar7 + 0x10) = 0x77676874;
        }
        else {
          pcVar9 = "Width";
          pbVar4 = pbVar6;
          do {
            bVar1 = *pbVar4;
            bVar13 = bVar1 < (byte)*pcVar9;
            if (bVar1 != *pcVar9) {
LAB_006af0c0:
              iVar5 = (1 - (uint)bVar13) - (uint)(bVar13 != 0);
              goto LAB_006af0c5;
            }
            if (bVar1 == 0) break;
            bVar1 = pbVar4[1];
            bVar13 = bVar1 < ((byte *)pcVar9)[1];
            if (bVar1 != ((byte *)pcVar9)[1]) goto LAB_006af0c0;
            pbVar4 = pbVar4 + 2;
            pcVar9 = (char *)((byte *)pcVar9 + 2);
          } while (bVar1 != 0);
          iVar5 = 0;
LAB_006af0c5:
          if (iVar5 == 0) {
            *(undefined4 *)(iVar7 + 0x10) = 0x77647468;
          }
          else {
            pcVar9 = "OpticalSize";
            do {
              bVar1 = *pbVar6;
              bVar13 = bVar1 < (byte)*pcVar9;
              if (bVar1 != *pcVar9) {
LAB_006af100:
                iVar5 = (1 - (uint)bVar13) - (uint)(bVar13 != 0);
                goto LAB_006af105;
              }
              if (bVar1 == 0) break;
              bVar1 = pbVar6[1];
              bVar13 = bVar1 < ((byte *)pcVar9)[1];
              if (bVar1 != ((byte *)pcVar9)[1]) goto LAB_006af100;
              pbVar6 = pbVar6 + 2;
              pcVar9 = (char *)((byte *)pcVar9 + 2);
            } while (bVar1 != 0);
            iVar5 = 0;
LAB_006af105:
            if (iVar5 == 0) {
              *(undefined4 *)(iVar7 + 0x10) = 0x6f70737a;
            }
          }
        }
        piVar11 = piVar11 + 3;
        iVar12 = iVar12 + 0x18;
        local_50 = local_50 - 1;
      } while (local_50 != 0);
      local_50 = 0;
      piVar11 = local_4c;
    }
    if (*piVar11 == 1 << ((byte)piVar11[1] & 0x1f)) {
      FUN_006aeeb0();
      uVar10 = 0;
      if (local_38 != 0) {
        iVar12 = 0;
        do {
          iVar7 = FUN_006aee30();
          *(int *)(puVar3[3] + 8 + iVar12) = iVar7 << 0x10;
          uVar10 = uVar10 + 1;
          iVar12 = iVar12 + 0x18;
        } while (uVar10 < local_38);
      }
    }
    *param_2 = (int)puVar3;
  }
  return local_54;
}



============================================================
DISASSEMBLY
============================================================
006aef70 : SUB ESP,0x54
006aef73 : MOV EAX,dword ptr [ESP + 0x58]
006aef77 : PUSH ESI
006aef78 : MOV ESI,dword ptr [EAX + 0x64]
006aef7b : PUSH EDI
006aef7c : MOV EDI,dword ptr [EAX + 0x210]
006aef82 : LEA ECX,[ESP + 0x24]
006aef86 : PUSH ECX
006aef87 : PUSH EAX
006aef88 : MOV dword ptr [ESP + 0x18],EDI
006aef8c : CALL 0x006aedc0
006aef91 : ADD ESP,0x8
006aef94 : MOV dword ptr [ESP + 0x8],EAX
006aef98 : TEST EAX,EAX
006aef9a : JNZ 0x006af18c
006aefa0 : PUSH EBX
006aefa1 : MOV EBX,dword ptr [ESP + 0x28]
006aefa5 : LEA EDX,[ESP + 0xc]
006aefa9 : LEA EAX,[EBX + EBX*0x2]
006aefac : PUSH EDX
006aefad : LEA ECX,[EAX*0x8 + 0x14]
006aefb4 : PUSH ECX
006aefb5 : PUSH ESI
006aefb6 : CALL 0x00688c00
006aefbb : MOV ESI,EAX
006aefbd : MOV EAX,dword ptr [ESP + 0x18]
006aefc1 : ADD ESP,0xc
006aefc4 : TEST EAX,EAX
006aefc6 : JNZ 0x006af18b
006aefcc : MOV EDX,dword ptr [ESP + 0x2c]
006aefd0 : LEA EAX,[ESI + 0x14]
006aefd3 : PUSH EBP
006aefd4 : MOV dword ptr [ESI],EBX
006aefd6 : MOV dword ptr [ESI + 0x4],EDX
006aefd9 : MOV dword ptr [ESI + 0x8],0xffffffff
006aefe0 : MOV dword ptr [ESI + 0xc],EAX
006aefe3 : MOV dword ptr [ESI + 0x10],0x0
006aefea : TEST EBX,EBX
006aefec : JBE 0x006af129
006aeff2 : XOR EDI,EDI
006aeff4 : LEA EBP,[ESP + 0x38]
006aeff8 : MOV dword ptr [ESP + 0x14],EBX
006aeffc : LEA ESP,[ESP]
006af000 : MOV ECX,dword ptr [ESI + 0xc]
006af003 : MOV EDX,dword ptr [EBP + -0x4]
006af006 : MOV EAX,dword ptr [EBP]
006af009 : MOV dword ptr [EDI + ECX*0x1],EDX
006af00c : MOV ECX,dword ptr [ESI + 0xc]
006af00f : MOV EDX,dword ptr [EBP + 0x4]
006af012 : SHL EAX,0x10
006af015 : MOV dword ptr [ECX + EDI*0x1 + 0x4],EAX
006af019 : MOV EAX,dword ptr [ESI + 0xc]
006af01c : SHL EDX,0x10
006af01f : MOV dword ptr [EAX + EDI*0x1 + 0xc],EDX
006af023 : MOV ECX,dword ptr [ESI + 0xc]
006af026 : MOV EAX,dword ptr [ECX + EDI*0x1 + 0xc]
006af02a : ADD EAX,dword ptr [ECX + EDI*0x1 + 0x4]
006af02e : ADD ECX,EDI
006af030 : CDQ
006af031 : SUB EAX,EDX
006af033 : SAR EAX,0x1
006af035 : MOV dword ptr [ECX + 0x8],EAX
006af038 : MOV EDX,dword ptr [ESI + 0xc]
006af03b : OR EAX,0xffffffff
006af03e : MOV dword ptr [EDX + EDI*0x1 + 0x14],EAX
006af042 : MOV ECX,dword ptr [ESI + 0xc]
006af045 : MOV dword ptr [ECX + EDI*0x1 + 0x10],EAX
006af049 : MOV EDX,dword ptr [ESI + 0xc]
006af04c : MOV EBX,dword ptr [EDX + EDI*0x1]
006af04f : LEA EAX,[EDX + EDI*0x1]
006af052 : MOV dword ptr [ESP + 0x68],EAX
006af056 : MOV ECX,0xbe87fc
006af05b : MOV EAX,EBX
006af05d : LEA ECX,[ECX]
006af060 : MOV DL,byte ptr [EAX]
006af062 : CMP DL,byte ptr [ECX]
006af064 : JNZ 0x006af080
006af066 : TEST DL,DL
006af068 : JZ 0x006af07c
006af06a : MOV DL,byte ptr [EAX + 0x1]
006af06d : CMP DL,byte ptr [ECX + 0x1]
006af070 : JNZ 0x006af080
006af072 : ADD EAX,0x2
006af075 : ADD ECX,0x2
006af078 : TEST DL,DL
006af07a : JNZ 0x006af060
006af07c : XOR EAX,EAX
006af07e : JMP 0x006af085
006af080 : SBB EAX,EAX
006af082 : SBB EAX,-0x1
006af085 : TEST EAX,EAX
006af087 : JNZ 0x006af096
006af089 : MOV EAX,dword ptr [ESP + 0x68]
006af08d : MOV dword ptr [EAX + 0x10],0x77676874
006af094 : JMP 0x006af114
006af096 : MOV ECX,0xbeb870
006af09b : MOV EAX,EBX
006af09d : LEA ECX,[ECX]
006af0a0 : MOV DL,byte ptr [EAX]
006af0a2 : CMP DL,byte ptr [ECX]
006af0a4 : JNZ 0x006af0c0
006af0a6 : TEST DL,DL
006af0a8 : JZ 0x006af0bc
006af0aa : MOV DL,byte ptr [EAX + 0x1]
006af0ad : CMP DL,byte ptr [ECX + 0x1]
006af0b0 : JNZ 0x006af0c0
006af0b2 : ADD EAX,0x2
006af0b5 : ADD ECX,0x2
006af0b8 : TEST DL,DL
006af0ba : JNZ 0x006af0a0
006af0bc : XOR EAX,EAX
006af0be : JMP 0x006af0c5
006af0c0 : SBB EAX,EAX
006af0c2 : SBB EAX,-0x1
006af0c5 : TEST EAX,EAX
006af0c7 : JNZ 0x006af0d6
006af0c9 : MOV ECX,dword ptr [ESP + 0x68]
006af0cd : MOV dword ptr [ECX + 0x10],0x77647468
006af0d4 : JMP 0x006af114
006af0d6 : MOV ECX,0xbeb864
006af0db : MOV EAX,EBX
006af0dd : LEA ECX,[ECX]
006af0e0 : MOV DL,byte ptr [EAX]
006af0e2 : CMP DL,byte ptr [ECX]
006af0e4 : JNZ 0x006af100
006af0e6 : TEST DL,DL
006af0e8 : JZ 0x006af0fc
006af0ea : MOV DL,byte ptr [EAX + 0x1]
006af0ed : CMP DL,byte ptr [ECX + 0x1]
006af0f0 : JNZ 0x006af100
006af0f2 : ADD EAX,0x2
006af0f5 : ADD ECX,0x2
006af0f8 : TEST DL,DL
006af0fa : JNZ 0x006af0e0
006af0fc : XOR EAX,EAX
006af0fe : JMP 0x006af105
006af100 : SBB EAX,EAX
006af102 : SBB EAX,-0x1
006af105 : TEST EAX,EAX
006af107 : JNZ 0x006af114
006af109 : MOV EDX,dword ptr [ESP + 0x68]
006af10d : MOV dword ptr [EDX + 0x10],0x6f70737a
006af114 : ADD EBP,0xc
006af117 : ADD EDI,0x18
006af11a : SUB dword ptr [ESP + 0x14],0x1
006af11f : JNZ 0x006af000
006af125 : MOV EDI,dword ptr [ESP + 0x18]
006af129 : MOV ECX,dword ptr [EDI + 0x4]
006af12c : MOV EAX,0x1
006af131 : SHL EAX,CL
006af133 : CMP dword ptr [EDI],EAX
006af135 : JNZ 0x006af180
006af137 : MOV EAX,dword ptr [EDI + 0x8c]
006af13d : MOV EDX,ECX
006af13f : LEA ECX,[ESP + 0x1c]
006af143 : CALL 0x006aeeb0
006af148 : XOR EBX,EBX
006af14a : CMP dword ptr [ESP + 0x2c],EBX
006af14e : JBE 0x006af180
006af150 : MOV EDI,dword ptr [ESP + 0x18]
006af154 : XOR EBP,EBP
006af156 : ADD EDI,0x58
006af159 : LEA ESP,[ESP]
006af160 : MOV EDX,dword ptr [ESP + EBX*0x4 + 0x1c]
006af164 : CALL 0x006aee30
006af169 : MOV ECX,dword ptr [ESI + 0xc]
006af16c : SHL EAX,0x10
006af16f : MOV dword ptr [ECX + EBP*0x1 + 0x8],EAX
006af173 : INC EBX
006af174 : ADD EDI,0xc
006af177 : ADD EBP,0x18
006af17a : CMP EBX,dword ptr [ESP + 0x2c]
006af17e : JC 0x006af160
006af180 : MOV EDX,dword ptr [ESP + 0x6c]
006af184 : MOV EAX,dword ptr [ESP + 0x10]
006af188 : MOV dword ptr [EDX],ESI
006af18a : POP EBP
006af18b : POP EBX
006af18c : POP EDI
006af18d : POP ESI
006af18e : ADD ESP,0x54
006af191 : RET
