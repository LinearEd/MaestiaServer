PROGRAM  : Maestia.exe
FUNCTION : FUN_004be440
ENTRY    : 004be440
BODY     : [[004be440, 004be575] [004be587, 004be63e]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_004be440(uint param_1,undefined4 *param_2)

{
  int iVar1;
  uint *puVar2;
  undefined4 *puVar3;
  undefined4 uVar4;
  undefined4 *in_ECX;
  uint uVar5;
  uint extraout_ECX;
  int iVar6;
  uint uVar7;
  undefined4 *puVar8;
  undefined4 *puVar9;
  undefined4 *puVar10;
  undefined8 uVar11;
  uint uStack_74;
  undefined4 local_64 [17];
  int local_20;
  undefined4 local_1c;
  int local_18;
  undefined1 *local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  iVar1 = param_1;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b7a350;
  local_10 = ExceptionList;
  uStack_74 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  local_14 = (undefined1 *)&uStack_74;
  ExceptionList = &local_10;
  iVar6 = *(int *)(param_1 + 4);
  if (iVar6 == 0) {
    uVar5 = 0;
  }
  else {
    uVar5 = *(int *)(param_1 + 0xc) - iVar6 >> 6;
  }
  iVar6 = *(int *)(param_1 + 8) - iVar6 >> 6;
  uVar11 = CONCAT44(iVar6,*(int *)(param_1 + 8));
  puVar2 = &uStack_74;
  if (iVar6 == 0x3ffffff) {
    uVar11 = FUN_00452880();
    uVar5 = extraout_ECX;
    puVar2 = (uint *)local_14;
  }
  local_14 = (undefined1 *)puVar2;
  puVar3 = (undefined4 *)uVar11;
  uVar7 = (int)((ulonglong)uVar11 >> 0x20) + 1;
  if (uVar7 <= uVar5) {
    puVar9 = local_64;
    for (iVar6 = 0x10; iVar6 != 0; iVar6 = iVar6 + -1) {
      *puVar9 = *in_ECX;
      in_ECX = in_ECX + 1;
      puVar9 = puVar9 + 1;
    }
    if ((int)puVar3 - (int)param_2 >> 6 == 0) {
      FUN_004be640(param_2,puVar3);
      local_8 = 2;
      FUN_004be410();
      local_8 = 0xffffffff;
      *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + 0x40;
    }
    else {
      puVar9 = puVar3 + -0x10;
      uVar4 = FUN_004be640(puVar9,puVar3);
      *(undefined4 *)(param_1 + 8) = uVar4;
      while (param_2 != puVar9) {
        puVar9 = puVar9 + -0x10;
        puVar3 = puVar3 + -0x10;
        puVar8 = puVar9;
        puVar10 = puVar3;
        for (iVar6 = 0x10; iVar6 != 0; iVar6 = iVar6 + -1) {
          *puVar10 = *puVar8;
          puVar8 = puVar8 + 1;
          puVar10 = puVar10 + 1;
        }
      }
    }
    FUN_004be670(local_64);
    ExceptionList = local_10;
    return;
  }
  if (0x3ffffff - (uVar5 >> 1) < uVar5) {
    param_1 = 0;
  }
  else {
    param_1 = uVar5 + (uVar5 >> 1);
  }
  if (param_1 < uVar7) {
    param_1 = uVar7;
  }
  local_18 = FUN_0044ec30();
  local_20 = (int)param_2 - *(int *)(iVar1 + 4) >> 6;
  local_8 = 0;
  FUN_004be410();
  iVar6 = local_18;
  local_1c = 1;
  FUN_004be640(*(undefined4 *)(iVar1 + 4),param_2);
  local_1c = 2;
  FUN_004be640(param_2,*(undefined4 *)(iVar1 + 8));
  local_8 = 0xffffffff;
  if (*(int *)(iVar1 + 4) == 0) {
    *(uint *)(iVar1 + 0xc) = param_1 * 0x40 + iVar6;
    *(int *)(iVar1 + 8) = ((*(int *)(iVar1 + 8) - *(int *)(iVar1 + 4) >> 6) + 1) * 0x40 + iVar6;
    *(int *)(iVar1 + 4) = iVar6;
    ExceptionList = local_10;
    return;
  }
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
004be440 : PUSH EBP
004be441 : MOV EBP,ESP
004be443 : PUSH -0x1
004be445 : PUSH 0xb7a350
004be44a : MOV EAX,FS:[0x0]
004be450 : PUSH EAX
004be451 : SUB ESP,0x54
004be454 : PUSH EBX
004be455 : PUSH ESI
004be456 : PUSH EDI
004be457 : MOV EAX,[0x00d66fa0]
004be45c : XOR EAX,EBP
004be45e : PUSH EAX
004be45f : LEA EAX,[EBP + -0xc]
004be462 : MOV FS:[0x0],EAX
004be468 : MOV dword ptr [EBP + -0x10],ESP
004be46b : MOV ESI,ECX
004be46d : MOV EBX,dword ptr [EBP + 0x8]
004be470 : MOV EDI,dword ptr [EBX + 0x4]
004be473 : TEST EDI,EDI
004be475 : JNZ 0x004be47b
004be477 : XOR ECX,ECX
004be479 : JMP 0x004be485
004be47b : MOV EAX,dword ptr [EBX + 0xc]
004be47e : SUB EAX,EDI
004be480 : SAR EAX,0x6
004be483 : MOV ECX,EAX
004be485 : MOV EAX,dword ptr [EBX + 0x8]
004be488 : MOV EDX,EAX
004be48a : SUB EDX,EDI
004be48c : SAR EDX,0x6
004be48f : MOV EDI,0x3ffffff
004be494 : SUB EDI,EDX
004be496 : CMP EDI,0x1
004be499 : JNC 0x004be4a0
004be49b : CALL 0x00452880
004be4a0 : INC EDX
004be4a1 : CMP ECX,EDX
004be4a3 : JNC 0x004be587
004be4a9 : MOV EAX,ECX
004be4ab : SHR EAX,0x1
004be4ad : MOV EDI,0x3ffffff
004be4b2 : SUB EDI,EAX
004be4b4 : CMP EDI,ECX
004be4b6 : JNC 0x004be4c4
004be4b8 : MOV dword ptr [EBP + 0x8],0x0
004be4bf : MOV ECX,dword ptr [EBP + 0x8]
004be4c2 : JMP 0x004be4c9
004be4c4 : ADD ECX,EAX
004be4c6 : MOV dword ptr [EBP + 0x8],ECX
004be4c9 : CMP ECX,EDX
004be4cb : JNC 0x004be4d2
004be4cd : MOV dword ptr [EBP + 0x8],EDX
004be4d0 : MOV ECX,EDX
004be4d2 : CALL 0x0044ec30
004be4d7 : MOV dword ptr [EBP + -0x14],EAX
004be4da : MOV EDI,dword ptr [EBP + 0xc]
004be4dd : SUB EDI,dword ptr [EBX + 0x4]
004be4e0 : SAR EDI,0x6
004be4e3 : MOV dword ptr [EBP + -0x1c],EDI
004be4e6 : MOV dword ptr [EBP + -0x4],0x0
004be4ed : SHL EDI,0x6
004be4f0 : ADD EDI,EAX
004be4f2 : MOV EDX,ESI
004be4f4 : MOV ESI,0x1
004be4f9 : CALL 0x004be410
004be4fe : MOV dword ptr [EBP + -0x18],ESI
004be501 : MOV EAX,dword ptr [EBP + 0xc]
004be504 : PUSH EAX
004be505 : MOV ECX,dword ptr [EBX + 0x4]
004be508 : PUSH ECX
004be509 : MOV EDI,dword ptr [EBP + -0x14]
004be50c : MOV EDX,EDI
004be50e : CALL 0x004be640
004be513 : MOV dword ptr [EBP + -0x18],0x2
004be51a : MOV EDX,dword ptr [EBP + -0x1c]
004be51d : INC EDX
004be51e : SHL EDX,0x6
004be521 : ADD EDX,EDI
004be523 : MOV EAX,dword ptr [EBX + 0x8]
004be526 : PUSH EAX
004be527 : MOV ECX,dword ptr [EBP + 0xc]
004be52a : PUSH ECX
004be52b : CALL 0x004be640
004be530 : MOV dword ptr [EBP + -0x4],0xffffffff
004be537 : MOV ECX,dword ptr [EBX + 0x4]
004be53a : MOV ESI,dword ptr [EBX + 0x8]
004be53d : SUB ESI,ECX
004be53f : SAR ESI,0x6
004be542 : INC ESI
004be543 : TEST ECX,ECX
004be545 : JZ 0x004be54c
004be547 : CALL 0x006f04e0
004be54c : MOV EAX,dword ptr [EBP + 0x8]
004be54f : SHL EAX,0x6
004be552 : ADD EAX,EDI
004be554 : MOV dword ptr [EBX + 0xc],EAX
004be557 : SHL ESI,0x6
004be55a : ADD ESI,EDI
004be55c : MOV dword ptr [EBX + 0x8],ESI
004be55f : MOV dword ptr [EBX + 0x4],EDI
004be562 : MOV ECX,dword ptr [EBP + -0xc]
004be565 : MOV dword ptr FS:[0x0],ECX
004be56c : POP ECX
004be56d : POP EDI
004be56e : POP ESI
004be56f : POP EBX
004be570 : MOV ESP,EBP
004be572 : POP EBP
004be573 : RET 0x8
004be587 : MOV ECX,EAX
004be589 : MOV EDX,dword ptr [EBP + 0xc]
004be58c : SUB ECX,EDX
004be58e : SAR ECX,0x6
004be591 : LEA EDI,[EBP + -0x60]
004be594 : PUSH EAX
004be595 : CMP ECX,0x1
004be598 : MOV ECX,0x10
004be59d : MOVSD.REP ES:EDI,ESI
004be59f : JNC 0x004be5e8
004be5a1 : ADD EDX,0x40
004be5a4 : MOV EAX,dword ptr [EBP + 0xc]
004be5a7 : PUSH EAX
004be5a8 : CALL 0x004be640
004be5ad : MOV dword ptr [EBP + -0x4],0x2
004be5b4 : MOV EDI,dword ptr [EBX + 0x8]
004be5b7 : MOV ECX,EDI
004be5b9 : SUB ECX,dword ptr [EBP + 0xc]
004be5bc : SAR ECX,0x6
004be5bf : MOV ESI,0x1
004be5c4 : SUB ESI,ECX
004be5c6 : LEA EDX,[EBP + -0x60]
004be5c9 : CALL 0x004be410
004be5ce : MOV dword ptr [EBP + -0x4],0xffffffff
004be5d5 : ADD dword ptr [EBX + 0x8],0x40
004be5d9 : MOV EBX,dword ptr [EBX + 0x8]
004be5dc : LEA EDX,[EBP + -0x60]
004be5df : PUSH EDX
004be5e0 : LEA EDX,[EBX + -0x40]
004be5e3 : MOV EAX,dword ptr [EBP + 0xc]
004be5e6 : JMP 0x004be623
004be5e8 : LEA ESI,[EAX + -0x40]
004be5eb : PUSH ESI
004be5ec : MOV EDX,EAX
004be5ee : CALL 0x004be640
004be5f3 : MOV dword ptr [EBX + 0x8],EAX
004be5f6 : MOV EDX,ESI
004be5f8 : MOV EAX,dword ptr [EBP + 0xc]
004be5fb : MOV EBX,EAX
004be5fd : CMP EAX,EDX
004be5ff : JZ 0x004be61c
004be601 : LEA EAX,[EDX + 0x40]
004be604 : SUB EDX,0x40
004be607 : SUB EAX,0x40
004be60a : MOV ECX,0x10
004be60f : MOV ESI,EDX
004be611 : MOV EDI,EAX
004be613 : MOVSD.REP ES:EDI,ESI
004be615 : CMP EDX,EBX
004be617 : JNZ 0x004be604
004be619 : MOV EAX,dword ptr [EBP + 0xc]
004be61c : LEA ECX,[EBP + -0x60]
004be61f : PUSH ECX
004be620 : LEA EDX,[EAX + 0x40]
004be623 : CALL 0x004be670
004be628 : ADD ESP,0x4
004be62b : MOV ECX,dword ptr [EBP + -0xc]
004be62e : MOV dword ptr FS:[0x0],ECX
004be635 : POP ECX
004be636 : POP EDI
004be637 : POP ESI
004be638 : POP EBX
004be639 : MOV ESP,EBP
004be63b : POP EBP
004be63c : RET 0x8
