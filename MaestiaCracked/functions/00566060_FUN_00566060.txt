PROGRAM  : Maestia.exe
FUNCTION : FUN_00566060
ENTRY    : 00566060
BODY     : [[00566060, 00566202]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00566060(void)

{
  int iVar1;
  LONG LVar2;
  GRefCountImplCore *in_ECX;
  GRefCountImplCore *pGVar3;
  uint uVar4;
  
  *(undefined ***)in_ECX = &PTR_FUN_00b8cbf8;
  pGVar3 = (GRefCountImplCore *)0x0;
  if (*(int *)(in_ECX + 0x74) < 2) {
    EnterCriticalSection((LPCRITICAL_SECTION)(in_ECX + 0xac));
    pGVar3 = in_ECX;
  }
  uVar4 = 0;
  if (*(int *)(in_ECX + 0xec) != 0) {
    do {
      FUN_00568240();
      uVar4 = uVar4 + 1;
    } while (uVar4 < *(uint *)(in_ECX + 0xec));
  }
  uVar4 = 0;
  if (*(int *)(in_ECX + 0xf8) != 0) {
    do {
      FUN_00568240();
      uVar4 = uVar4 + 1;
    } while (uVar4 < *(uint *)(in_ECX + 0xf8));
  }
  iVar1 = *(int *)(in_ECX + 0x18);
  if (iVar1 != 0) {
    FUN_005550b0();
    FUN_00515cf0(iVar1);
  }
  if (*(int *)(in_ECX + 0x6c) != 0) {
    FUN_00515cf0(*(int *)(in_ECX + 0x6c));
    *(undefined4 *)(in_ECX + 0x6c) = 0;
  }
  if (*(GRefCountNTSImpl **)(in_ECX + 0x10c) != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(in_ECX + 0x10c));
  }
  if (pGVar3 != (GRefCountImplCore *)0x0) {
    LeaveCriticalSection((LPCRITICAL_SECTION)(pGVar3 + 0xac));
  }
  FUN_00563c60();
  FUN_00515cf0(*(undefined4 *)(in_ECX + 0xf4));
  FUN_00515cf0(*(undefined4 *)(in_ECX + 0xe8));
  FUN_005a20f0();
  FUN_005631e0();
  FUN_00563ce0();
  FUN_00562af0();
  FUN_005a20f0();
  FUN_00565db0();
  if (*(GRefCountImpl **)(in_ECX + 0x84) != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release(*(GRefCountImpl **)(in_ECX + 0x84));
  }
  uVar4 = *(uint *)(in_ECX + 100);
  LVar2 = InterlockedExchangeAdd((LONG *)((uVar4 & 0xfffffffc) + 4),-1);
  if (LVar2 == 1) {
    FUN_00515cf0(uVar4 & 0xfffffffc);
  }
  uVar4 = *(uint *)(in_ECX + 0x60);
  LVar2 = InterlockedExchangeAdd((LONG *)((uVar4 & 0xfffffffc) + 4),-1);
  if (LVar2 == 1) {
    FUN_00515cf0(uVar4 & 0xfffffffc);
  }
  uVar4 = *(uint *)(in_ECX + 0x24);
  LVar2 = InterlockedExchangeAdd((LONG *)((uVar4 & 0xfffffffc) + 4),-1);
  if (LVar2 == 1) {
    FUN_00515cf0(uVar4 & 0xfffffffc);
  }
  if (*(int *)(in_ECX + 0x20) != 0) {
    FUN_00515b80();
  }
  iVar1 = *(int *)(in_ECX + 0x10);
  while (iVar1 != 0) {
    iVar1 = **(int **)(in_ECX + 0x10);
    FUN_00515cf0(*(int **)(in_ECX + 0x10));
    *(int *)(in_ECX + 0x10) = iVar1;
  }
  GRefCountImplCore::~GRefCountImplCore(in_ECX);
  return;
}



============================================================
DISASSEMBLY
============================================================
00566060 : PUSH EBX
00566061 : PUSH ESI
00566062 : MOV ESI,ECX
00566064 : XOR EBX,EBX
00566066 : CMP dword ptr [ESI + 0x74],0x2
0056606a : PUSH EDI
0056606b : MOV dword ptr [ESI],0xb8cbf8
00566071 : JGE 0x00566082
00566073 : LEA EAX,[ESI + 0xac]
00566079 : PUSH EAX
0056607a : MOV EBX,ESI
0056607c : CALL dword ptr [0x00b85118]
00566082 : XOR EDI,EDI
00566084 : CMP dword ptr [ESI + 0xec],EDI
0056608a : JBE 0x005660a7
0056608c : LEA ESP,[ESP]
00566090 : MOV ECX,dword ptr [ESI + 0xe8]
00566096 : LEA ECX,[ECX + EDI*0x8]
00566099 : CALL 0x00568240
0056609e : INC EDI
0056609f : CMP EDI,dword ptr [ESI + 0xec]
005660a5 : JC 0x00566090
005660a7 : XOR EDI,EDI
005660a9 : CMP dword ptr [ESI + 0xf8],EDI
005660af : JBE 0x005660c8
005660b1 : MOV EDX,dword ptr [ESI + 0xf4]
005660b7 : LEA ECX,[EDX + EDI*0x8]
005660ba : CALL 0x00568240
005660bf : INC EDI
005660c0 : CMP EDI,dword ptr [ESI + 0xf8]
005660c6 : JC 0x005660b1
005660c8 : MOV EDI,dword ptr [ESI + 0x18]
005660cb : TEST EDI,EDI
005660cd : JZ 0x005660dc
005660cf : MOV ECX,EDI
005660d1 : CALL 0x005550b0
005660d6 : PUSH EDI
005660d7 : CALL 0x00515cf0
005660dc : MOV EAX,dword ptr [ESI + 0x6c]
005660df : TEST EAX,EAX
005660e1 : JZ 0x005660f0
005660e3 : PUSH EAX
005660e4 : CALL 0x00515cf0
005660e9 : MOV dword ptr [ESI + 0x6c],0x0
005660f0 : MOV ECX,dword ptr [ESI + 0x10c]
005660f6 : TEST ECX,ECX
005660f8 : JZ 0x005660ff
005660fa : CALL 0x004ff7c0
005660ff : TEST EBX,EBX
00566101 : JZ 0x00566110
00566103 : ADD EBX,0xac
00566109 : PUSH EBX
0056610a : CALL dword ptr [0x00b8511c]
00566110 : LEA ECX,[ESI + 0x104]
00566116 : CALL 0x00563c60
0056611b : MOV EAX,dword ptr [ESI + 0xf4]
00566121 : PUSH EAX
00566122 : CALL 0x00515cf0
00566127 : MOV ECX,dword ptr [ESI + 0xe8]
0056612d : PUSH ECX
0056612e : CALL 0x00515cf0
00566133 : LEA ECX,[ESI + 0xd0]
00566139 : CALL 0x005a20f0
0056613e : LEA ECX,[ESI + 0xcc]
00566144 : CALL 0x005631e0
00566149 : LEA ECX,[ESI + 0xc8]
0056614f : CALL 0x00563ce0
00566154 : LEA ECX,[ESI + 0xc4]
0056615a : CALL 0x00562af0
0056615f : LEA ECX,[ESI + 0xac]
00566165 : CALL 0x005a20f0
0056616a : LEA ECX,[ESI + 0x88]
00566170 : CALL 0x00565db0
00566175 : MOV ECX,dword ptr [ESI + 0x84]
0056617b : TEST ECX,ECX
0056617d : JZ 0x00566184
0056617f : CALL 0x004ff7e0
00566184 : MOV EDI,dword ptr [ESI + 0x64]
00566187 : MOV EBX,dword ptr [0x00b851cc]
0056618d : AND EDI,0xfffffffc
00566190 : PUSH -0x1
00566192 : LEA EDX,[EDI + 0x4]
00566195 : PUSH EDX
00566196 : CALL EBX
00566198 : SUB EAX,0x1
0056619b : JNZ 0x005661a3
0056619d : PUSH EDI
0056619e : CALL 0x00515cf0
005661a3 : MOV EDI,dword ptr [ESI + 0x60]
005661a6 : AND EDI,0xfffffffc
005661a9 : PUSH -0x1
005661ab : LEA EAX,[EDI + 0x4]
005661ae : PUSH EAX
005661af : CALL EBX
005661b1 : SUB EAX,0x1
005661b4 : JNZ 0x005661bc
005661b6 : PUSH EDI
005661b7 : CALL 0x00515cf0
005661bc : MOV EDI,dword ptr [ESI + 0x24]
005661bf : AND EDI,0xfffffffc
005661c2 : PUSH -0x1
005661c4 : LEA ECX,[EDI + 0x4]
005661c7 : PUSH ECX
005661c8 : CALL EBX
005661ca : SUB EAX,0x1
005661cd : JNZ 0x005661d5
005661cf : PUSH EDI
005661d0 : CALL 0x00515cf0
005661d5 : MOV ECX,dword ptr [ESI + 0x20]
005661d8 : TEST ECX,ECX
005661da : JZ 0x005661e1
005661dc : CALL 0x00515b80
005661e1 : CMP dword ptr [ESI + 0x10],0x0
005661e5 : JZ 0x005661f9
005661e7 : MOV EAX,dword ptr [ESI + 0x10]
005661ea : MOV EDI,dword ptr [EAX]
005661ec : PUSH EAX
005661ed : CALL 0x00515cf0
005661f2 : MOV dword ptr [ESI + 0x10],EDI
005661f5 : TEST EDI,EDI
005661f7 : JNZ 0x005661e7
005661f9 : POP EDI
005661fa : MOV ECX,ESI
005661fc : POP ESI
005661fd : POP EBX
005661fe : JMP 0x004ff7b0
