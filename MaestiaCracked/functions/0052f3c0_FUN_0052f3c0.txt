PROGRAM  : Maestia.exe
FUNCTION : FUN_0052f3c0
ENTRY    : 0052f3c0
BODY     : [[0052f3c0, 0052f555]]

============================================================
DECOMPILED C CODE
============================================================

char FUN_0052f3c0(GRefCountNTSImpl *param_1,undefined4 param_2,char *param_3)

{
  uint *puVar1;
  int *piVar2;
  undefined1 *puVar3;
  int iVar4;
  char cVar5;
  GRefCountNTSImpl *pGVar6;
  int in_ECX;
  uint unaff_EBX;
  int unaff_EBP;
  int *unaff_ESI;
  undefined **ppuStack_30;
  char *pcStack_2c;
  GRefCountNTSImpl *pGStack_28;
  undefined4 uStack_24;
  undefined4 uStack_20;
  undefined1 uStack_1c;
  undefined4 uStack_14;
  int iStack_10;
  GRefCountNTSImpl *pGStack_8;
  int *piStack_4;
  
  cVar5 = (**(code **)(*(int *)param_1 + 0x10))();
  if ((cVar5 == '\0') || (*param_3 != '\t')) {
    if (*param_3 == '\f') {
      FUN_00526bf0(&stack0xffffffc4);
      if (unaff_ESI == (int *)0x0) {
        cVar5 = '\0';
      }
      else {
        *(int *)(in_ECX + 8) = *(int *)(in_ECX + 8) + 0x10;
        puVar1 = (uint *)(in_ECX + 8);
        if (*(uint *)(in_ECX + 0x10) <= *(uint *)(in_ECX + 8)) {
          FUN_00504050();
        }
        puVar3 = (undefined1 *)*puVar1;
        if (puVar3 != (undefined1 *)0x0) {
          *puVar3 = 5;
          iVar4 = *piStack_4;
          *(int *)(puVar3 + 4) = iVar4;
          piVar2 = (int *)(iVar4 + 8);
          *piVar2 = *piVar2 + 1;
        }
        pGVar6 = (GRefCountNTSImpl *)FUN_0054ecd0();
        if (pGVar6 != (GRefCountNTSImpl *)0x0) {
          *(int *)(pGVar6 + 4) = *(int *)(pGVar6 + 4) + 1;
        }
        FUN_00526400();
        *param_3 = '\0';
        pGStack_28 = pGVar6 + 0x68;
        if (pGVar6 == (GRefCountNTSImpl *)0x0) {
          pGStack_28 = pGStack_8;
        }
        iStack_10 = ((int)(*puVar1 - *(int *)(in_ECX + 0xc)) >> 4) + -0x20 +
                    *(int *)(in_ECX + 0x1c) * 0x20;
        pcStack_2c = param_3;
        ppuStack_30 = &PTR_FUN_00b8ab5c;
        uStack_1c = 0;
        uStack_24 = 0;
        uStack_20 = 0;
        uStack_14 = 1;
        (**(code **)(*unaff_ESI + 0x28))(&ppuStack_30,unaff_EBP,0);
        FUN_0051fbd0();
        FUN_00526bc0();
        *puVar1 = *puVar1 - 0x10;
        if (*puVar1 < *(uint *)(in_ECX + 0xc)) {
          FUN_00504f30();
        }
        cVar5 = '\x01';
        if (pGVar6 != (GRefCountNTSImpl *)0x0) {
          GRefCountNTSImpl::Release(pGVar6);
        }
      }
      if (((unaff_EBX & 2) == 0) && (unaff_ESI != (int *)0x0)) {
        FUN_00503db0();
      }
      if (((unaff_EBX & 1) == 0) && (unaff_EBP != 0)) {
        FUN_00503db0();
      }
      return cVar5;
    }
  }
  else {
    pGVar6 = (GRefCountNTSImpl *)FUN_0054ecd0();
    if (pGVar6 != (GRefCountNTSImpl *)0x0) {
      *(int *)(pGVar6 + 4) = *(int *)(pGVar6 + 4) + 1;
      param_1 = pGVar6 + 0x68;
    }
    FUN_00526d80(in_ECX,param_1,param_3);
    if (pGVar6 != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(pGVar6);
    }
  }
  return cVar5;
}



============================================================
DISASSEMBLY
============================================================
0052f3c0 : SUB ESP,0x30
0052f3c3 : PUSH EBX
0052f3c4 : PUSH EBP
0052f3c5 : MOV EBP,dword ptr [ESP + 0x3c]
0052f3c9 : MOV EAX,dword ptr [EBP]
0052f3cc : MOV EDX,dword ptr [EAX + 0x10]
0052f3cf : PUSH ESI
0052f3d0 : PUSH EDI
0052f3d1 : MOV EDI,dword ptr [ESP + 0x4c]
0052f3d5 : MOV EBX,ECX
0052f3d7 : MOV ECX,dword ptr [ESP + 0x48]
0052f3db : PUSH EDI
0052f3dc : PUSH ECX
0052f3dd : PUSH EBX
0052f3de : MOV ECX,EBP
0052f3e0 : CALL EDX
0052f3e2 : MOV byte ptr [ESP + 0x4c],AL
0052f3e6 : TEST AL,AL
0052f3e8 : JZ 0x0052f425
0052f3ea : CMP byte ptr [EDI],0x9
0052f3ed : JNZ 0x0052f425
0052f3ef : MOV ECX,EBP
0052f3f1 : CALL 0x0054ecd0
0052f3f6 : MOV ESI,EAX
0052f3f8 : TEST ESI,ESI
0052f3fa : JZ 0x0052f402
0052f3fc : INC dword ptr [ESI + 0x4]
0052f3ff : LEA EBP,[ESI + 0x68]
0052f402 : PUSH EDI
0052f403 : PUSH EBP
0052f404 : PUSH EBX
0052f405 : MOV ECX,EDI
0052f407 : CALL 0x00526d80
0052f40c : TEST ESI,ESI
0052f40e : JZ 0x0052f417
0052f410 : MOV ECX,ESI
0052f412 : CALL 0x004ff7c0
0052f417 : MOV AL,byte ptr [ESP + 0x4c]
0052f41b : POP EDI
0052f41c : POP ESI
0052f41d : POP EBP
0052f41e : POP EBX
0052f41f : ADD ESP,0x30
0052f422 : RET 0xc
0052f425 : CMP byte ptr [EDI],0xc
0052f428 : JNZ 0x0052f41b
0052f42a : LEA EAX,[ESP + 0x10]
0052f42e : PUSH EAX
0052f42f : MOV ECX,EDI
0052f431 : CALL 0x00526bf0
0052f436 : CMP dword ptr [ESP + 0x10],0x0
0052f43b : JZ 0x0052f518
0052f441 : ADD dword ptr [EBX + 0x8],0x10
0052f445 : MOV EAX,dword ptr [EBX + 0x8]
0052f448 : CMP EAX,dword ptr [EBX + 0x10]
0052f44b : LEA ESI,[EBX + 0x8]
0052f44e : JC 0x0052f457
0052f450 : MOV ECX,ESI
0052f452 : CALL 0x00504050
0052f457 : MOV ECX,dword ptr [ESI]
0052f459 : TEST ECX,ECX
0052f45b : JZ 0x0052f46c
0052f45d : MOV EDX,dword ptr [ESP + 0x48]
0052f461 : MOV byte ptr [ECX],0x5
0052f464 : MOV EAX,dword ptr [EDX]
0052f466 : MOV dword ptr [ECX + 0x4],EAX
0052f469 : INC dword ptr [EAX + 0x8]
0052f46c : MOV ECX,EBP
0052f46e : CALL 0x0054ecd0
0052f473 : MOV EBP,EAX
0052f475 : TEST EBP,EBP
0052f477 : JZ 0x0052f47c
0052f479 : INC dword ptr [EBP + 0x4]
0052f47c : MOV ECX,EDI
0052f47e : CALL 0x00526400
0052f483 : MOV byte ptr [EDI],0x0
0052f486 : LEA ECX,[EBP + 0x68]
0052f489 : TEST EBP,EBP
0052f48b : JNZ 0x0052f491
0052f48d : MOV ECX,dword ptr [ESP + 0x44]
0052f491 : MOV EAX,dword ptr [ESI]
0052f493 : SUB EAX,dword ptr [ESI + 0x4]
0052f496 : MOV EDX,dword ptr [ESI + 0x14]
0052f499 : SAR EAX,0x4
0052f49c : SHL EDX,0x5
0052f49f : LEA EAX,[EAX + EDX*0x1 + -0x20]
0052f4a3 : MOV EDX,dword ptr [ESP + 0x14]
0052f4a7 : MOV dword ptr [ESP + 0x20],EDI
0052f4ab : XOR EDI,EDI
0052f4ad : MOV dword ptr [ESP + 0x24],ECX
0052f4b1 : MOV ECX,dword ptr [ESP + 0x10]
0052f4b5 : PUSH EDI
0052f4b6 : MOV dword ptr [ESP + 0x40],EAX
0052f4ba : PUSH EDX
0052f4bb : MOV dword ptr [ESP + 0x24],0xb8ab5c
0052f4c3 : MOV byte ptr [ESP + 0x38],0x0
0052f4c8 : MOV dword ptr [ESP + 0x30],EDI
0052f4cc : MOV dword ptr [ESP + 0x34],EDI
0052f4d0 : MOV dword ptr [ESP + 0x3c],EBX
0052f4d4 : MOV dword ptr [ESP + 0x40],0x1
0052f4dc : MOV EAX,dword ptr [ECX]
0052f4de : MOV EAX,dword ptr [EAX + 0x28]
0052f4e1 : LEA EDX,[ESP + 0x24]
0052f4e5 : PUSH EDX
0052f4e6 : CALL EAX
0052f4e8 : LEA ECX,[ESP + 0x1c]
0052f4ec : CALL 0x0051fbd0
0052f4f1 : MOV ECX,dword ptr [ESI]
0052f4f3 : CALL 0x00526bc0
0052f4f8 : ADD dword ptr [ESI],-0x10
0052f4fb : MOV EAX,dword ptr [ESI]
0052f4fd : CMP EAX,dword ptr [ESI + 0x4]
0052f500 : JNC 0x0052f509
0052f502 : MOV ECX,ESI
0052f504 : CALL 0x00504f30
0052f509 : MOV BL,0x1
0052f50b : CMP EBP,EDI
0052f50d : JZ 0x0052f51a
0052f50f : MOV ECX,EBP
0052f511 : CALL 0x004ff7c0
0052f516 : JMP 0x0052f51a
0052f518 : XOR BL,BL
0052f51a : TEST byte ptr [ESP + 0x18],0x2
0052f51f : JNZ 0x0052f52e
0052f521 : MOV ECX,dword ptr [ESP + 0x10]
0052f525 : TEST ECX,ECX
0052f527 : JZ 0x0052f52e
0052f529 : CALL 0x00503db0
0052f52e : TEST byte ptr [ESP + 0x18],0x1
0052f533 : MOV dword ptr [ESP + 0x10],0x0
0052f53b : JNZ 0x0052f54a
0052f53d : MOV ECX,dword ptr [ESP + 0x14]
0052f541 : TEST ECX,ECX
0052f543 : JZ 0x0052f54a
0052f545 : CALL 0x00503db0
0052f54a : POP EDI
0052f54b : POP ESI
0052f54c : POP EBP
0052f54d : MOV AL,BL
0052f54f : POP EBX
0052f550 : ADD ESP,0x30
0052f553 : RET 0xc
