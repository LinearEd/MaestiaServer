PROGRAM  : Maestia.exe
FUNCTION : FUN_00a10300
ENTRY    : 00a10300
BODY     : [[00a10300, 00a1038a] [00a10394, 00a104ac] [00a104f3, 00a1056b]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a10300(int param_1,undefined4 param_2,int param_3,int param_4)

{
  int *piVar1;
  uint *puVar2;
  char cVar3;
  LONG LVar4;
  uint uVar5;
  int iVar6;
  int iVar7;
  undefined1 local_30 [4];
  undefined2 local_2c;
  undefined4 local_1c;
  uint local_18;
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b70977;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  iVar7 = 0;
  if ((DAT_0172491c == 0) || (*(int *)(DAT_0172491c + 0x17c) == 0)) {
    local_18 = 7;
    local_1c = 0;
    local_2c = 0;
    FUN_00406360(L"ProcessOtherQueue-",0x12);
    local_8 = 0;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                (L"AvaActionQueue::ProcessOtherQueue",0x499,local_30);
    }
    local_8 = 0xffffffff;
    if (local_18 < 8) {
      ExceptionList = local_10;
      return;
    }
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  if (*(int *)(*(int *)(DAT_0172491c + 0x17c) + 4) == *(int *)(param_1 + 0x44)) {
    local_14 = 1;
  }
  else {
    local_14 = 0;
    if ((*(int *)(param_1 + 0x40) != 0) &&
       ((**(code **)(**(int **)(param_1 + 0x40) + 0x1e4))(DAT_00d66fa0 ^ (uint)&stack0xfffffffc),
       *(int *)(param_1 + 0x40) != 0)) {
      (**(code **)(**(int **)(param_1 + 0x40) + 0x1e4))();
    }
  }
  if (*(int *)(param_1 + 0x3c) == 0) {
    ExceptionList = local_10;
    return;
  }
  piVar1 = *(int **)(param_1 + 0x20);
  uVar5 = *(uint *)(param_1 + 0x38) >> 2;
  if (piVar1 == (int *)0x0) {
    iVar6 = 0;
  }
  else {
    iVar6 = *piVar1;
  }
  if (*(uint *)(iVar6 + 0x14) <= uVar5) {
    if (piVar1 == (int *)0x0) {
      iVar6 = 0;
    }
    else {
      iVar6 = *piVar1;
    }
    uVar5 = uVar5 - *(int *)(iVar6 + 0x14);
  }
  if (piVar1 == (int *)0x0) {
    iVar6 = 0;
  }
  else {
    iVar6 = *piVar1;
  }
  puVar2 = *(uint **)(*(int *)(*(int *)(iVar6 + 0x10) + uVar5 * 4) +
                     (*(uint *)(param_1 + 0x38) & 3) * 4);
  iVar6 = *(int *)(puVar2[1] + 8);
  if (*(char *)(iVar6 + 2) == '4') {
    if (*(char *)(iVar6 + 3) == '\f') {
      iVar7 = DAT_00d70814;
    }
  }
  else {
    if (local_14 == 0) goto LAB_00a1045b;
    if (((((DAT_0172491c != 0) && (*(char *)(DAT_0172491c + 0xc2) != '\0')) &&
         (*(char *)(*(int *)(DAT_0172491c + 0x17c) + 0x15ae) == '\0')) &&
        ((iVar7 = DAT_00d70814, DAT_00d70814 != 0 && (*(char *)(iVar6 + 2) == 'A')))) &&
       ((*(char *)(iVar6 + 3) == '\x01' && (*(short *)(iVar6 + 0x16) == 0x140b)))) {
      iVar7 = 0;
    }
  }
  if (((local_14 != 0) && (DAT_0172491c != 0)) &&
     ((*(char *)(DAT_0172491c + 0xc2) != '\0' && (cVar3 = FUN_00a0f880(), cVar3 != '\0')))) {
    iVar7 = 0;
  }
LAB_00a1045b:
  if ((param_4 != 0) && ((uint)(iVar7 + param_3) < *puVar2)) {
    ExceptionList = local_10;
    return;
  }
  FUN_00b01d30();
  uVar5 = puVar2[1];
  LVar4 = InterlockedDecrement((LONG *)(uVar5 + 4));
  if ((LVar4 == 0) && (uVar5 != 0)) {
    if (*(int *)(uVar5 + 8) != 0) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    *(undefined4 *)(uVar5 + 8) = 0;
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  puVar2[1] = 0;
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
00a10300 : PUSH EBP
00a10301 : MOV EBP,ESP
00a10303 : PUSH -0x1
00a10305 : PUSH 0xb70977
00a1030a : MOV EAX,FS:[0x0]
00a10310 : PUSH EAX
00a10311 : SUB ESP,0x20
00a10314 : PUSH EBX
00a10315 : PUSH ESI
00a10316 : PUSH EDI
00a10317 : MOV EAX,[0x00d66fa0]
00a1031c : XOR EAX,EBP
00a1031e : PUSH EAX
00a1031f : LEA EAX,[EBP + -0xc]
00a10322 : MOV FS:[0x0],EAX
00a10328 : MOV EAX,[0x0172491c]
00a1032d : XOR EDI,EDI
00a1032f : CMP EAX,EDI
00a10331 : JZ 0x00a104f3
00a10337 : MOV EAX,dword ptr [EAX + 0x17c]
00a1033d : CMP EAX,EDI
00a1033f : JZ 0x00a104f3
00a10345 : MOV EAX,dword ptr [EAX + 0x4]
00a10348 : MOV ESI,dword ptr [EBP + 0x8]
00a1034b : CMP EAX,dword ptr [ESI + 0x44]
00a1034e : JNZ 0x00a10359
00a10350 : MOV dword ptr [EBP + -0x10],0x1
00a10357 : JMP 0x00a10380
00a10359 : MOV dword ptr [EBP + -0x10],EDI
00a1035c : CMP dword ptr [ESI + 0x40],EDI
00a1035f : JZ 0x00a10380
00a10361 : MOV ECX,dword ptr [ESI + 0x40]
00a10364 : MOV EDX,dword ptr [ECX]
00a10366 : MOV EAX,dword ptr [EDX + 0x1e4]
00a1036c : CALL EAX
00a1036e : CMP dword ptr [ESI + 0x40],EDI
00a10371 : JZ 0x00a10380
00a10373 : MOV ECX,dword ptr [ESI + 0x40]
00a10376 : MOV EDX,dword ptr [ECX]
00a10378 : MOV EAX,dword ptr [EDX + 0x1e4]
00a1037e : CALL EAX
00a10380 : CMP dword ptr [ESI + 0x3c],EDI
00a10383 : JZ 0x00a10558
00a10389 : JMP 0x00a10394
00a10394 : MOV EAX,dword ptr [ESI + 0x38]
00a10397 : MOV EDX,dword ptr [ESI + 0x20]
00a1039a : MOV ECX,EAX
00a1039c : SHR ECX,0x2
00a1039f : AND EAX,0x3
00a103a2 : CMP EDX,EDI
00a103a4 : JZ 0x00a103aa
00a103a6 : MOV ESI,dword ptr [EDX]
00a103a8 : JMP 0x00a103ac
00a103aa : XOR ESI,ESI
00a103ac : CMP dword ptr [ESI + 0x14],ECX
00a103af : JA 0x00a103be
00a103b1 : CMP EDX,EDI
00a103b3 : JZ 0x00a103b9
00a103b5 : MOV ESI,dword ptr [EDX]
00a103b7 : JMP 0x00a103bb
00a103b9 : XOR ESI,ESI
00a103bb : SUB ECX,dword ptr [ESI + 0x14]
00a103be : CMP EDX,EDI
00a103c0 : JZ 0x00a103c6
00a103c2 : MOV EDX,dword ptr [EDX]
00a103c4 : JMP 0x00a103c8
00a103c6 : XOR EDX,EDX
00a103c8 : MOV EDX,dword ptr [EDX + 0x10]
00a103cb : MOV ECX,dword ptr [EDX + ECX*0x4]
00a103ce : MOV EBX,dword ptr [ECX + EAX*0x4]
00a103d1 : MOV EDX,dword ptr [EBX + 0x4]
00a103d4 : MOV ESI,dword ptr [EDX + 0x8]
00a103d7 : MOV AL,byte ptr [ESI + 0x2]
00a103da : CMP AL,0x34
00a103dc : JNZ 0x00a103f2
00a103de : CMP byte ptr [ESI + 0x3],0xc
00a103e2 : MOV ECX,dword ptr [0x0172491c]
00a103e8 : JNZ 0x00a1043b
00a103ea : MOV EDI,dword ptr [0x00d70814]
00a103f0 : JMP 0x00a1043b
00a103f2 : CMP dword ptr [EBP + -0x10],0x0
00a103f6 : JZ 0x00a1045b
00a103f8 : MOV ECX,dword ptr [0x0172491c]
00a103fe : TEST ECX,ECX
00a10400 : JZ 0x00a1043b
00a10402 : CMP byte ptr [ECX + 0xc2],0x0
00a10409 : JZ 0x00a1043b
00a1040b : MOV EDX,dword ptr [ECX + 0x17c]
00a10411 : CMP byte ptr [EDX + 0x15ae],0x0
00a10418 : JNZ 0x00a1043b
00a1041a : MOV EDI,dword ptr [0x00d70814]
00a10420 : TEST EDI,EDI
00a10422 : JBE 0x00a1043b
00a10424 : CMP AL,0x41
00a10426 : JNZ 0x00a1043b
00a10428 : CMP byte ptr [ESI + 0x3],0x1
00a1042c : JNZ 0x00a1043b
00a1042e : MOV EAX,0x140b
00a10433 : CMP word ptr [ESI + 0x16],AX
00a10437 : JNZ 0x00a1043b
00a10439 : XOR EDI,EDI
00a1043b : CMP dword ptr [EBP + -0x10],0x0
00a1043f : JZ 0x00a1045b
00a10441 : TEST ECX,ECX
00a10443 : JZ 0x00a1045b
00a10445 : CMP byte ptr [ECX + 0xc2],0x0
00a1044c : JZ 0x00a1045b
00a1044e : MOV EAX,ESI
00a10450 : CALL 0x00a0f880
00a10455 : TEST AL,AL
00a10457 : JZ 0x00a1045b
00a10459 : XOR EDI,EDI
00a1045b : CMP dword ptr [EBP + 0x14],0x0
00a1045f : JZ 0x00a1046e
00a10461 : MOV ECX,dword ptr [EBP + 0x10]
00a10464 : ADD EDI,ECX
00a10466 : CMP dword ptr [EBX],EDI
00a10468 : JA 0x00a10558
00a1046e : MOV EDI,dword ptr [EBP + 0xc]
00a10471 : CALL 0x00b01d30
00a10476 : MOV ESI,dword ptr [EBX + 0x4]
00a10479 : LEA EDX,[ESI + 0x4]
00a1047c : PUSH EDX
00a1047d : CALL dword ptr [0x00b851b0]
00a10483 : XOR EDI,EDI
00a10485 : TEST EAX,EAX
00a10487 : JNZ 0x00a104a3
00a10489 : CMP ESI,EDI
00a1048b : JZ 0x00a104a3
00a1048d : MOV ECX,dword ptr [ESI + 0x8]
00a10490 : CMP ECX,EDI
00a10492 : JZ 0x00a10499
00a10494 : CALL 0x006f04e0
00a10499 : MOV ECX,ESI
00a1049b : MOV dword ptr [ESI + 0x8],EDI
00a1049e : CALL 0x006f04e0
00a104a3 : MOV ECX,EBX
00a104a5 : MOV dword ptr [EBX + 0x4],EDI
00a104a8 : CALL 0x006f04e0
00a104f3 : PUSH 0x12
00a104f5 : XOR EAX,EAX
00a104f7 : MOV ESI,0x7
00a104fc : PUSH 0xcbdec4
00a10501 : LEA ECX,[EBP + -0x2c]
00a10504 : MOV dword ptr [EBP + -0x14],ESI
00a10507 : MOV dword ptr [EBP + -0x18],EDI
00a1050a : MOV word ptr [EBP + -0x28],AX
00a1050e : CALL 0x00406360
00a10513 : MOV dword ptr [EBP + -0x4],EDI
00a10516 : MOV ECX,dword ptr [0x00da98e8]
00a1051c : MOV ECX,dword ptr [ECX]
00a1051e : CMP ECX,EDI
00a10520 : JZ 0x00a10537
00a10522 : MOV EDX,dword ptr [ECX]
00a10524 : MOV EDX,dword ptr [EDX + 0x14]
00a10527 : LEA EAX,[EBP + -0x2c]
00a1052a : PUSH EAX
00a1052b : PUSH 0x499
00a10530 : PUSH 0xcbdef0
00a10535 : CALL EDX
00a10537 : MOV dword ptr [EBP + -0x4],0xffffffff
00a1053e : CMP dword ptr [EBP + -0x14],0x8
00a10542 : JC 0x00a1054c
00a10544 : MOV ECX,dword ptr [EBP + -0x28]
00a10547 : CALL 0x006f04e0
00a1054c : XOR EAX,EAX
00a1054e : MOV dword ptr [EBP + -0x14],ESI
00a10551 : MOV dword ptr [EBP + -0x18],EDI
00a10554 : MOV word ptr [EBP + -0x28],AX
00a10558 : MOV ECX,dword ptr [EBP + -0xc]
00a1055b : MOV dword ptr FS:[0x0],ECX
00a10562 : POP ECX
00a10563 : POP EDI
00a10564 : POP ESI
00a10565 : POP EBX
00a10566 : MOV ESP,EBP
00a10568 : POP EBP
00a10569 : RET 0x10
