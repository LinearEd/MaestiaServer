PROGRAM  : Maestia.exe
FUNCTION : FUN_00856070
ENTRY    : 00856070
BODY     : [[00856070, 00856301]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00856070(void)

{
  float *pfVar1;
  float fVar2;
  DWORD DVar3;
  int iVar4;
  float *pfVar5;
  int unaff_ESI;
  double dVar6;
  undefined8 local_30;
  float local_28;
  float local_24;
  float fStack_20;
  float local_1c;
  undefined4 local_18;
  undefined4 local_14;
  undefined4 local_10;
  undefined4 local_c;
  
  if (((*(char *)(unaff_ESI + 0x1a78) != '\0') && (*(int *)(unaff_ESI + 0x18a8) != 0)) &&
     (*(int *)(*(int *)(unaff_ESI + 0x18a8) + 0x30) != 0)) {
    pfVar1 = (float *)(unaff_ESI + 0x1a94);
    local_c = 0x3f800000;
    local_30 = 0;
    local_28 = 0.0;
    local_18 = 0;
    local_14 = 0;
    local_10 = 0;
    if (((*pfVar1 != *(float *)(unaff_ESI + 0x1a7c)) ||
        (*(float *)(unaff_ESI + 0x1a98) != *(float *)(unaff_ESI + 0x1a80))) ||
       (*(float *)(unaff_ESI + 0x1a9c) != *(float *)(unaff_ESI + 0x1a84))) {
      DVar3 = timeGetTime();
      iVar4 = DVar3 - *(int *)(unaff_ESI + 0x1aa0);
      fVar2 = (float)iVar4;
      if (iVar4 < 0) {
        fVar2 = fVar2 + 4.2949673e+09;
      }
      fVar2 = fVar2 * 0.005;
      if (fVar2 < 1.0) {
        *pfVar1 = *(float *)(unaff_ESI + 0x1a88) +
                  (*(float *)(unaff_ESI + 0x1a7c) - *(float *)(unaff_ESI + 0x1a88)) * fVar2;
        *(float *)(unaff_ESI + 0x1a98) =
             *(float *)(unaff_ESI + 0x1a8c) +
             (*(float *)(unaff_ESI + 0x1a80) - *(float *)(unaff_ESI + 0x1a8c)) * fVar2;
        *(float *)(unaff_ESI + 0x1a9c) =
             *(float *)(unaff_ESI + 0x1a90) +
             (*(float *)(unaff_ESI + 0x1a84) - *(float *)(unaff_ESI + 0x1a90)) * fVar2;
        D3DXVec3Normalize(pfVar1,pfVar1);
        pfVar5 = (float *)FUN_00855280(pfVar1);
        *pfVar1 = *pfVar5;
        *(float *)(unaff_ESI + 0x1a98) = pfVar5[1];
        *(float *)(unaff_ESI + 0x1a9c) = pfVar5[2];
      }
      else {
        *(undefined4 *)(unaff_ESI + 0x1a88) = *(undefined4 *)(unaff_ESI + 0x1a7c);
        *(undefined4 *)(unaff_ESI + 0x1a8c) = *(undefined4 *)(unaff_ESI + 0x1a80);
        *(undefined4 *)(unaff_ESI + 0x1a90) = *(undefined4 *)(unaff_ESI + 0x1a84);
        *pfVar1 = *(float *)(unaff_ESI + 0x1a88);
        *(undefined4 *)(unaff_ESI + 0x1a98) = *(undefined4 *)(unaff_ESI + 0x1a8c);
        *(undefined4 *)(unaff_ESI + 0x1a9c) = *(undefined4 *)(unaff_ESI + 0x1a90);
        *(undefined1 *)(unaff_ESI + 0x1a78) = 0;
      }
    }
    local_28 = *(float *)(unaff_ESI + 0x1a98) * 0.0;
    local_24 = *(float *)(unaff_ESI + 0x1a9c) - local_28;
    fVar2 = *pfVar1;
    local_28 = local_28 - fVar2;
    fStack_20 = fVar2 * 0.0 - *(float *)(unaff_ESI + 0x1a9c) * 0.0;
    local_30 = CONCAT44(fStack_20,local_24);
    dVar6 = (double)((*(float *)(unaff_ESI + 0x1a9c) + fVar2) * 0.0 + *(float *)(unaff_ESI + 0x1a98)
                    );
    local_1c = local_28;
    FUN_00b0abbf();
    D3DXQuaternionRotationAxis(&local_18,&local_30,(float)dVar6);
    iVar4 = *(int *)(*(int *)(unaff_ESI + 0x18a8) + 0x30);
    *(ulonglong *)(iVar4 + 0xe0) = CONCAT44(fStack_20,local_24);
    *(ulonglong *)(iVar4 + 0xe8) = CONCAT44(local_18,local_1c);
    iVar4 = *(int *)(*(int *)(unaff_ESI + 0x18a8) + 0x30);
    *(undefined1 *)(iVar4 + 0x5d) = 1;
    *(undefined1 *)(iVar4 + 0x134) = 1;
    *(undefined1 *)(iVar4 + 0x5c) = 1;
    if (*(int **)(iVar4 + 0x2c) != (int *)0x0) {
      (**(code **)(**(int **)(iVar4 + 0x2c) + 0x60))(iVar4);
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00856070 : PUSH EBP
00856071 : MOV EBP,ESP
00856073 : AND ESP,0xfffffff8
00856076 : SUB ESP,0x30
00856079 : CMP byte ptr [ESI + 0x1a78],0x0
00856080 : PUSH EBX
00856081 : PUSH EDI
00856082 : JZ 0x008562fc
00856088 : MOV EAX,dword ptr [ESI + 0x18a8]
0085608e : TEST EAX,EAX
00856090 : JZ 0x008562fc
00856096 : CMP dword ptr [EAX + 0x30],0x0
0085609a : JZ 0x008562fc
008560a0 : MOVSS XMM0,dword ptr [0x00c10fc4]
008560a8 : XORPS XMM1,XMM1
008560ab : LEA EBX,[ESI + 0x1a94]
008560b1 : MOVSS dword ptr [ESP + 0x34],XMM0
008560b7 : MOVSS XMM0,dword ptr [EBX]
008560bb : UCOMISS XMM0,dword ptr [ESI + 0x1a7c]
008560c2 : LAHF
008560c3 : MOVSS dword ptr [ESP + 0x10],XMM1
008560c9 : MOVSS dword ptr [ESP + 0x14],XMM1
008560cf : MOVSS dword ptr [ESP + 0x18],XMM1
008560d5 : MOVSS dword ptr [ESP + 0x28],XMM1
008560db : MOVSS dword ptr [ESP + 0x2c],XMM1
008560e1 : MOVSS dword ptr [ESP + 0x30],XMM1
008560e7 : TEST AH,0x44
008560ea : JP 0x00856114
008560ec : MOVSS XMM0,dword ptr [EBX + 0x4]
008560f1 : UCOMISS XMM0,dword ptr [ESI + 0x1a80]
008560f8 : LAHF
008560f9 : TEST AH,0x44
008560fc : JP 0x00856114
008560fe : MOVSS XMM0,dword ptr [EBX + 0x8]
00856103 : UCOMISS XMM0,dword ptr [ESI + 0x1a84]
0085610a : LAHF
0085610b : TEST AH,0x44
0085610e : JNP 0x0085622a
00856114 : CALL dword ptr [0x00b85598]
0085611a : SUB EAX,dword ptr [ESI + 0x1aa0]
00856120 : MOV dword ptr [ESP + 0xc],EAX
00856124 : FILD dword ptr [ESP + 0xc]
00856128 : TEST EAX,EAX
0085612a : JGE 0x00856132
0085612c : FADD float ptr [0x00cdf0e0]
00856132 : FMUL float ptr [0x00cdf2e4]
00856138 : FST float ptr [ESP + 0xc]
0085613c : FLD1
0085613e : FXCH
00856140 : FCOMIP ST0,ST1
00856142 : FSTP ST0
00856144 : JC 0x00856190
00856146 : FLD float ptr [ESI + 0x1a7c]
0085614c : FSTP float ptr [ESI + 0x1a88]
00856152 : FLD float ptr [ESI + 0x1a80]
00856158 : FSTP float ptr [ESI + 0x1a8c]
0085615e : FLD float ptr [ESI + 0x1a84]
00856164 : FSTP float ptr [ESI + 0x1a90]
0085616a : FLD float ptr [ESI + 0x1a88]
00856170 : FSTP float ptr [EBX]
00856172 : FLD float ptr [ESI + 0x1a8c]
00856178 : FSTP float ptr [EBX + 0x4]
0085617b : FLD float ptr [ESI + 0x1a90]
00856181 : FSTP float ptr [EBX + 0x8]
00856184 : MOV byte ptr [ESI + 0x1a78],0x0
0085618b : JMP 0x00856227
00856190 : MOVSS XMM0,dword ptr [ESI + 0x1a7c]
00856198 : SUBSS XMM0,dword ptr [ESI + 0x1a88]
008561a0 : MOVSS XMM1,dword ptr [ESI + 0x1a80]
008561a8 : SUBSS XMM1,dword ptr [ESI + 0x1a8c]
008561b0 : MOVSS XMM2,dword ptr [ESI + 0x1a84]
008561b8 : SUBSS XMM2,dword ptr [ESI + 0x1a90]
008561c0 : MOVSS XMM3,dword ptr [ESP + 0xc]
008561c6 : MULSS XMM1,XMM3
008561ca : MULSS XMM0,XMM3
008561ce : MULSS XMM2,XMM3
008561d2 : MOVSS XMM3,dword ptr [ESI + 0x1a88]
008561da : ADDSS XMM3,XMM0
008561de : MOVSS XMM0,dword ptr [ESI + 0x1a8c]
008561e6 : ADDSS XMM0,XMM1
008561ea : MOVSS XMM1,dword ptr [ESI + 0x1a90]
008561f2 : PUSH EBX
008561f3 : ADDSS XMM1,XMM2
008561f7 : PUSH EBX
008561f8 : MOVSS dword ptr [EBX],XMM3
008561fc : MOVSS dword ptr [EBX + 0x4],XMM0
00856201 : MOVSS dword ptr [EBX + 0x8],XMM1
00856206 : CALL 0x004ff722
0085620b : PUSH EBX
0085620c : LEA EDI,[ESP + 0x20]
00856210 : MOV EAX,ESI
00856212 : CALL 0x00855280
00856217 : FLD float ptr [EAX]
00856219 : FSTP float ptr [EBX]
0085621b : FLD float ptr [EAX + 0x4]
0085621e : FSTP float ptr [EBX + 0x4]
00856221 : FLD float ptr [EAX + 0x8]
00856224 : FSTP float ptr [EBX + 0x8]
00856227 : XORPS XMM1,XMM1
0085622a : MOVSS XMM2,dword ptr [EBX + 0x8]
0085622f : MOVSS XMM0,dword ptr [EBX + 0x4]
00856234 : MULSS XMM0,XMM1
00856238 : MOVAPS XMM3,XMM2
0085623b : SUBSS XMM3,XMM0
0085623f : MOVSS dword ptr [ESP + 0x1c],XMM3
00856245 : MOVSS XMM3,dword ptr [EBX]
00856249 : SUBSS XMM0,XMM3
0085624d : MOVSS dword ptr [ESP + 0x24],XMM0
00856253 : MOV EAX,dword ptr [ESP + 0x24]
00856257 : MOVAPS XMM4,XMM3
0085625a : MULSS XMM4,XMM1
0085625e : MULSS XMM2,XMM1
00856262 : SUBSS XMM4,XMM2
00856266 : MOVSS dword ptr [ESP + 0x20],XMM4
0085626c : MOVQ XMM0,qword ptr [ESP + 0x1c]
00856272 : MOVQ qword ptr [ESP + 0x10],XMM0
00856278 : MOVSS XMM0,dword ptr [EBX + 0x8]
0085627d : ADDSS XMM0,XMM3
00856281 : MULSS XMM0,XMM1
00856285 : ADDSS XMM0,dword ptr [EBX + 0x4]
0085628a : MOV dword ptr [ESP + 0x18],EAX
0085628e : CVTPS2PD XMM0,XMM0
00856291 : CALL 0x00b0abbf
00856296 : PUSH ECX
00856297 : CVTSD2SS XMM0,XMM0
0085629b : MOVSS dword ptr [ESP],XMM0
008562a0 : LEA ECX,[ESP + 0x14]
008562a4 : PUSH ECX
008562a5 : LEA EDX,[ESP + 0x30]
008562a9 : PUSH EDX
008562aa : CALL 0x004ff710
008562af : MOV EAX,dword ptr [ESI + 0x18a8]
008562b5 : MOV EAX,dword ptr [EAX + 0x30]
008562b8 : MOVQ XMM0,qword ptr [ESP + 0x28]
008562be : MOVQ qword ptr [EAX + 0xe0],XMM0
008562c6 : MOVQ XMM0,qword ptr [ESP + 0x30]
008562cc : ADD EAX,0xe0
008562d1 : MOVQ qword ptr [EAX + 0x8],XMM0
008562d6 : MOV ECX,dword ptr [ESI + 0x18a8]
008562dc : MOV EAX,dword ptr [ECX + 0x30]
008562df : MOV CL,0x1
008562e1 : MOV byte ptr [EAX + 0x5d],CL
008562e4 : MOV byte ptr [EAX + 0x134],CL
008562ea : MOV byte ptr [EAX + 0x5c],CL
008562ed : MOV ECX,dword ptr [EAX + 0x2c]
008562f0 : TEST ECX,ECX
008562f2 : JZ 0x008562fc
008562f4 : MOV EDX,dword ptr [ECX]
008562f6 : PUSH EAX
008562f7 : MOV EAX,dword ptr [EDX + 0x60]
008562fa : CALL EAX
008562fc : POP EDI
008562fd : POP EBX
008562fe : MOV ESP,EBP
00856300 : POP EBP
00856301 : RET
