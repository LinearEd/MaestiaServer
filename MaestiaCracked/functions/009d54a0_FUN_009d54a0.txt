PROGRAM  : Maestia.exe
FUNCTION : FUN_009d54a0
ENTRY    : 009d54a0
BODY     : [[009d54a0, 009d54f8] [009d5500, 009d5689]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_009d54a0(int param_1,ushort *param_2)

{
  undefined4 *puVar1;
  char cVar2;
  uint uVar3;
  undefined4 *puVar4;
  uint uVar5;
  int iVar6;
  __time64_t _Var7;
  undefined4 *local_20;
  int local_1c;
  ushort *local_18;
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b60f1a;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_18 = param_2 + 0x32;
  local_1c = (*param_2 & 0x1fff) - 100;
  FUN_009d0760(param_1);
  local_14 = 0;
  if (*(char *)((int)param_2 + 99) != '\0') {
    do {
      puVar4 = (undefined4 *)FUN_006f0760(0xa8,"",0,(DAT_01725270 >> 3 & 1) == 0,uVar3);
      if (puVar4 == (undefined4 *)0x0) {
        puVar4 = (undefined4 *)0x0;
      }
      else {
        *puVar4 = 0;
        puVar4[1] = 0;
        puVar4[2] = 0;
        puVar4[3] = 0;
        puVar4[4] = 0;
        puVar4[6] = 0;
        puVar4[7] = 0;
        *(undefined1 *)(puVar4 + 8) = 0;
        puVar4[9] = 0;
        puVar4[10] = 0;
        puVar4[0xb] = 0;
        puVar4[0xc] = 0;
        puVar4[0xd] = 0;
        *(undefined2 *)(puVar4 + 0xe) = 0;
        *(undefined1 *)((int)puVar4 + 0x3a) = 0;
        *(undefined2 *)(puVar4 + 0xf) = 0;
        puVar4[0x24] = 0;
        puVar4[0x25] = 0;
        puVar4[0x26] = 0;
        *(undefined2 *)(puVar4 + 0x27) = 0;
        puVar4[0x28] = 0;
      }
      local_8 = 0xffffffff;
      local_20 = puVar4;
      FUN_0041b650(puVar4,&local_18);
      if (*(char *)(puVar4 + 8) == '\x01') {
LAB_009d55be:
        cVar2 = FUN_009d0370(*puVar4,puVar4[1]);
        if ((cVar2 != '\0') && (0 < (int)puVar4[10])) {
          puVar4[10] = -puVar4[10];
        }
        iVar6 = *(int *)(param_1 + 0xe4);
        if (iVar6 == 0) {
          uVar5 = 0;
        }
        else {
          uVar5 = *(int *)(param_1 + 0xec) - iVar6 >> 2;
        }
        puVar1 = *(undefined4 **)(param_1 + 0xe8);
        if ((uint)((int)puVar1 - iVar6 >> 2) < uVar5) {
          *puVar1 = puVar4;
          *(undefined4 **)(param_1 + 0xe8) = puVar1 + 1;
        }
        else {
          FUN_0042fe80(param_1 + 0xe0,puVar1,&local_20);
        }
        FUN_009d39e0(param_1);
      }
      else {
        _Var7 = __time64((__time64_t *)0x0);
        iVar6 = (int)((ulonglong)_Var7 >> 0x20);
        if ((iVar6 <= (int)puVar4[7]) &&
           ((iVar6 < (int)puVar4[7] || ((uint)_Var7 <= (uint)puVar4[6])))) goto LAB_009d55be;
      }
      local_14 = local_14 + 1;
    } while (local_14 < (int)(uint)*(byte *)((int)param_2 + 99));
  }
  *(uint *)(param_1 + 0xf4) = (uint)param_2[0x2f];
  *(char *)(param_1 + 0xf8) = (char)param_2[0x30];
  *(undefined2 *)(param_1 + 0xfa) = *(undefined2 *)((int)param_2 + 0x61);
  if (*(int *)(param_1 + 0x138) == 0) {
    FUN_009d4fe0(param_1);
  }
  *(undefined4 *)(param_1 + 0xcc) = 0;
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
009d54a0 : PUSH EBP
009d54a1 : MOV EBP,ESP
009d54a3 : PUSH -0x1
009d54a5 : PUSH 0xb60f1a
009d54aa : MOV EAX,FS:[0x0]
009d54b0 : PUSH EAX
009d54b1 : SUB ESP,0x14
009d54b4 : PUSH EBX
009d54b5 : PUSH ESI
009d54b6 : PUSH EDI
009d54b7 : MOV EAX,[0x00d66fa0]
009d54bc : XOR EAX,EBP
009d54be : PUSH EAX
009d54bf : LEA EAX,[EBP + -0xc]
009d54c2 : MOV FS:[0x0],EAX
009d54c8 : MOV EDI,dword ptr [EBP + 0xc]
009d54cb : MOVZX ECX,word ptr [EDI]
009d54ce : MOV ESI,dword ptr [EBP + 0x8]
009d54d1 : AND ECX,0x1fff
009d54d7 : LEA EAX,[EDI + 0x64]
009d54da : SUB ECX,0x64
009d54dd : PUSH ESI
009d54de : MOV dword ptr [EBP + -0x14],EAX
009d54e1 : MOV dword ptr [EBP + -0x18],ECX
009d54e4 : CALL 0x009d0760
009d54e9 : XOR EBX,EBX
009d54eb : MOV dword ptr [EBP + -0x10],EBX
009d54ee : CMP byte ptr [EDI + 0x63],BL
009d54f1 : JBE 0x009d5644
009d54f7 : JMP 0x009d5500
009d5500 : MOV EDX,dword ptr [0x01725270]
009d5506 : SHR EDX,0x3
009d5509 : MOV EAX,0x0
009d550e : AND EDX,0x1
009d5511 : SETZ AL
009d5514 : PUSH EAX
009d5515 : PUSH EBX
009d5516 : PUSH 0xbf1a4a
009d551b : PUSH 0xa8
009d5520 : CALL 0x006f0760
009d5525 : ADD ESP,0x10
009d5528 : MOV dword ptr [EBP + -0x1c],EAX
009d552b : MOV dword ptr [EBP + -0x4],EBX
009d552e : CMP EAX,EBX
009d5530 : JZ 0x009d558a
009d5532 : XOR ECX,ECX
009d5534 : XOR EDX,EDX
009d5536 : MOV dword ptr [EAX],EBX
009d5538 : MOV dword ptr [EAX + 0x4],EBX
009d553b : MOV dword ptr [EAX + 0x8],EBX
009d553e : MOV dword ptr [EAX + 0xc],EBX
009d5541 : MOV dword ptr [EAX + 0x10],EBX
009d5544 : MOV dword ptr [EAX + 0x18],EBX
009d5547 : MOV dword ptr [EAX + 0x1c],EBX
009d554a : MOV byte ptr [EAX + 0x20],BL
009d554d : MOV dword ptr [EAX + 0x24],EBX
009d5550 : MOV dword ptr [EAX + 0x28],EBX
009d5553 : MOV dword ptr [EAX + 0x2c],EBX
009d5556 : MOV dword ptr [EAX + 0x30],EBX
009d5559 : MOV dword ptr [EAX + 0x34],EBX
009d555c : MOV word ptr [EAX + 0x38],CX
009d5560 : MOV byte ptr [EAX + 0x3a],BL
009d5563 : MOV word ptr [EAX + 0x3c],DX
009d5567 : MOV dword ptr [EAX + 0x90],EBX
009d556d : MOV dword ptr [EAX + 0x94],EBX
009d5573 : MOV dword ptr [EAX + 0x98],EBX
009d5579 : MOV word ptr [EAX + 0x9c],CX
009d5580 : MOV dword ptr [EAX + 0xa0],EBX
009d5586 : MOV EDI,EAX
009d5588 : JMP 0x009d558c
009d558a : XOR EDI,EDI
009d558c : MOV dword ptr [EBP + -0x4],0xffffffff
009d5593 : LEA EDX,[EBP + -0x14]
009d5596 : PUSH EDX
009d5597 : PUSH EDI
009d5598 : LEA ESI,[EBP + -0x18]
009d559b : MOV dword ptr [EBP + -0x1c],EDI
009d559e : CALL 0x0041b650
009d55a3 : CMP byte ptr [EDI + 0x20],0x1
009d55a7 : JZ 0x009d55be
009d55a9 : PUSH EBX
009d55aa : CALL 0x006381ab
009d55af : ADD ESP,0x4
009d55b2 : CMP EDX,dword ptr [EDI + 0x1c]
009d55b5 : JG 0x009d5629
009d55b7 : JL 0x009d55be
009d55b9 : CMP EAX,dword ptr [EDI + 0x18]
009d55bc : JA 0x009d5629
009d55be : MOV EAX,dword ptr [EDI + 0x4]
009d55c1 : MOV ECX,dword ptr [EDI]
009d55c3 : MOV ESI,dword ptr [EBP + 0x8]
009d55c6 : PUSH EAX
009d55c7 : PUSH ECX
009d55c8 : MOV EAX,ESI
009d55ca : CALL 0x009d0370
009d55cf : TEST AL,AL
009d55d1 : JZ 0x009d55e0
009d55d3 : CMP dword ptr [EDI + 0x28],EBX
009d55d6 : JLE 0x009d55e0
009d55d8 : MOV EDX,dword ptr [EDI + 0x28]
009d55db : NEG EDX
009d55dd : MOV dword ptr [EDI + 0x28],EDX
009d55e0 : LEA EAX,[ESI + 0xe0]
009d55e6 : MOV ESI,dword ptr [EAX + 0x4]
009d55e9 : CMP ESI,EBX
009d55eb : JNZ 0x009d55f1
009d55ed : XOR ECX,ECX
009d55ef : JMP 0x009d55f9
009d55f1 : MOV ECX,dword ptr [EAX + 0xc]
009d55f4 : SUB ECX,ESI
009d55f6 : SAR ECX,0x2
009d55f9 : MOV EDX,dword ptr [EAX + 0x8]
009d55fc : MOV EBX,EDX
009d55fe : SUB EBX,ESI
009d5600 : SAR EBX,0x2
009d5603 : CMP EBX,ECX
009d5605 : JNC 0x009d5611
009d5607 : MOV dword ptr [EDX],EDI
009d5609 : ADD EDX,0x4
009d560c : MOV dword ptr [EAX + 0x8],EDX
009d560f : JMP 0x009d561c
009d5611 : LEA ECX,[EBP + -0x1c]
009d5614 : PUSH ECX
009d5615 : PUSH EDX
009d5616 : PUSH EAX
009d5617 : CALL 0x0042fe80
009d561c : MOV EDX,dword ptr [EBP + 0x8]
009d561f : PUSH EDX
009d5620 : MOV ECX,EDI
009d5622 : CALL 0x009d39e0
009d5627 : XOR EBX,EBX
009d5629 : MOV ECX,dword ptr [EBP + 0xc]
009d562c : MOV EAX,dword ptr [EBP + -0x10]
009d562f : MOVZX EDX,byte ptr [ECX + 0x63]
009d5633 : INC EAX
009d5634 : CMP EAX,EDX
009d5636 : MOV dword ptr [EBP + -0x10],EAX
009d5639 : JL 0x009d5500
009d563f : MOV ESI,dword ptr [EBP + 0x8]
009d5642 : MOV EDI,ECX
009d5644 : MOVZX EAX,word ptr [EDI + 0x5e]
009d5648 : MOV dword ptr [ESI + 0xf4],EAX
009d564e : MOV CL,byte ptr [EDI + 0x60]
009d5651 : MOV byte ptr [ESI + 0xf8],CL
009d5657 : MOV DX,word ptr [EDI + 0x61]
009d565b : MOV word ptr [ESI + 0xfa],DX
009d5662 : CMP dword ptr [ESI + 0x138],EBX
009d5668 : JNZ 0x009d5670
009d566a : PUSH ESI
009d566b : CALL 0x009d4fe0
009d5670 : MOV dword ptr [ESI + 0xcc],EBX
009d5676 : MOV ECX,dword ptr [EBP + -0xc]
009d5679 : MOV dword ptr FS:[0x0],ECX
009d5680 : POP ECX
009d5681 : POP EDI
009d5682 : POP ESI
009d5683 : POP EBX
009d5684 : MOV ESP,EBP
009d5686 : POP EBP
009d5687 : RET 0x8
