PROGRAM  : Maestia.exe
FUNCTION : FUN_00a4d850
ENTRY    : 00a4d850
BODY     : [[00a4d850, 00a4d90c] [00a4d910, 00a4da20]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a4d850(void)

{
  char cVar1;
  ulonglong uVar2;
  uint uVar3;
  char *pcVar4;
  undefined4 uVar5;
  int in_ECX;
  int iVar6;
  char *pcVar7;
  uint8_t *puVar8;
  uint8_t *puVar9;
  char *local_a0;
  uint8_t *local_9c;
  uint local_98;
  char local_94 [128];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b3b240;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_98 = (uint)*(ushort *)(in_ECX + 0x15c);
  local_14 = uVar3;
  FUN_00413b60(&local_98);
  if ((local_9c != *(uint8_t **)(in_ECX + 0x128)) && (*(int *)(*(int *)(local_9c + 0x10) + 4) != -1)
     ) {
    local_94[0] = '\0';
    _memset(local_94 + 1,0,0x7f);
    local_98 = in_ECX + 0x1f8;
    if (*(uint *)(in_ECX + 0x210) < 8) {
      iVar6 = in_ECX + 0x1fc;
    }
    else {
      iVar6 = *(int *)(in_ECX + 0x1fc);
    }
    pcVar4 = (char *)FUN_0070cf00(iVar6,uVar3);
    pcVar7 = local_94;
    do {
      cVar1 = *pcVar4;
      *pcVar7 = cVar1;
      pcVar4 = pcVar4 + 1;
      pcVar7 = pcVar7 + 1;
    } while (cVar1 != '\0');
    local_a0 = local_94;
    do {
      cVar1 = *local_a0;
      local_a0 = local_a0 + 1;
    } while (cVar1 != '\0');
    local_a0 = local_a0 + (1 - (int)(local_94 + 1));
    FUN_006f00e0(local_94,&local_a0,0x80);
    iVar6 = *(int *)ThreadLocalStoragePointer;
    uVar2 = (ulonglong)(*(byte *)(iVar6 + 0x18) + 1) % 3;
    puVar8 = (uint8_t *)((int)uVar2 * 0x2000 + 0x122cb8 + iVar6);
    *(char *)(iVar6 + 0x18) = (char)uVar2;
    local_8 = 0;
    local_9c = puVar8;
    if (puVar8 == (uint8_t *)0x0) {
      puVar8 = (uint8_t *)0x0;
    }
    else {
      uVar5 = FUN_00a49c90();
      puVar8[0] = '\0';
      puVar8[1] = '\0';
      pcVar7 = local_94;
      puVar9 = puVar8 + 8;
      for (iVar6 = 0x20; iVar6 != 0; iVar6 = iVar6 + -1) {
        *(undefined4 *)puVar9 = *(undefined4 *)pcVar7;
        pcVar7 = pcVar7 + 4;
        puVar9 = puVar9 + 4;
      }
      puVar8[2] = '3';
      puVar8[3] = '!';
      *(undefined4 *)(puVar8 + 4) = uVar5;
    }
    local_8 = 0xffffffff;
    if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
      FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),0x88,puVar8);
    }
    FUN_008018d0(L"Send to Server SPKUZ_USER_RQ_CHARDEL");
    FUN_00406360(&DAT_00cc748c,0);
  }
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00a4d850 : PUSH EBP
00a4d851 : MOV EBP,ESP
00a4d853 : PUSH -0x1
00a4d855 : PUSH 0xb3b240
00a4d85a : MOV EAX,FS:[0x0]
00a4d860 : PUSH EAX
00a4d861 : SUB ESP,0x94
00a4d867 : MOV EAX,[0x00d66fa0]
00a4d86c : XOR EAX,EBP
00a4d86e : MOV dword ptr [EBP + -0x10],EAX
00a4d871 : PUSH EBX
00a4d872 : PUSH ESI
00a4d873 : PUSH EDI
00a4d874 : PUSH EAX
00a4d875 : LEA EAX,[EBP + -0xc]
00a4d878 : MOV FS:[0x0],EAX
00a4d87e : MOV ESI,ECX
00a4d880 : MOVZX EAX,word ptr [ESI + 0x15c]
00a4d887 : LEA ECX,[EBP + 0xffffff6c]
00a4d88d : MOV dword ptr [EBP + 0xffffff6c],EAX
00a4d893 : PUSH ECX
00a4d894 : LEA ECX,[ESI + 0x124]
00a4d89a : LEA EAX,[EBP + 0xffffff68]
00a4d8a0 : CALL 0x00413b60
00a4d8a5 : MOV EAX,dword ptr [ESI + 0x128]
00a4d8ab : MOV ECX,dword ptr [EBP + 0xffffff68]
00a4d8b1 : CMP ECX,EAX
00a4d8b3 : JZ 0x00a4da05
00a4d8b9 : MOV EAX,dword ptr [ECX + 0x10]
00a4d8bc : MOV EAX,dword ptr [EAX + 0x4]
00a4d8bf : CMP EAX,-0x1
00a4d8c2 : JZ 0x00a4da05
00a4d8c8 : PUSH 0x7f
00a4d8ca : LEA EDX,[EBP + 0xffffff71]
00a4d8d0 : PUSH 0x0
00a4d8d2 : PUSH EDX
00a4d8d3 : MOV byte ptr [EBP + 0xffffff70],0x0
00a4d8da : CALL 0x0063b700
00a4d8df : LEA EDI,[ESI + 0x1f8]
00a4d8e5 : ADD ESP,0xc
00a4d8e8 : CMP dword ptr [EDI + 0x18],0x8
00a4d8ec : MOV dword ptr [EBP + 0xffffff6c],EDI
00a4d8f2 : JC 0x00a4d8f9
00a4d8f4 : MOV EAX,dword ptr [EDI + 0x4]
00a4d8f7 : JMP 0x00a4d8fc
00a4d8f9 : LEA EAX,[EDI + 0x4]
00a4d8fc : PUSH EAX
00a4d8fd : CALL 0x0070cf00
00a4d902 : ADD ESP,0x4
00a4d905 : LEA EDX,[EBP + 0xffffff70]
00a4d90b : JMP 0x00a4d910
00a4d910 : MOV CL,byte ptr [EAX]
00a4d912 : MOV byte ptr [EDX],CL
00a4d914 : INC EAX
00a4d915 : INC EDX
00a4d916 : TEST CL,CL
00a4d918 : JNZ 0x00a4d910
00a4d91a : LEA EAX,[EBP + 0xffffff70]
00a4d920 : LEA EDX,[EAX + 0x1]
00a4d923 : MOV CL,byte ptr [EAX]
00a4d925 : INC EAX
00a4d926 : TEST CL,CL
00a4d928 : JNZ 0x00a4d923
00a4d92a : SUB EAX,EDX
00a4d92c : INC EAX
00a4d92d : MOV dword ptr [EBP + 0xffffff64],EAX
00a4d933 : PUSH 0x80
00a4d938 : LEA EAX,[EBP + 0xffffff64]
00a4d93e : PUSH EAX
00a4d93f : LEA ECX,[EBP + 0xffffff70]
00a4d945 : PUSH ECX
00a4d946 : LEA ECX,[ESI + 0x2dc]
00a4d94c : CALL 0x006f00e0
00a4d951 : MOV EDX,dword ptr FS:[0x2c]
00a4d958 : MOV ECX,dword ptr [EDX]
00a4d95a : MOVZX EAX,byte ptr [ECX + 0x18]
00a4d95e : INC EAX
00a4d95f : CDQ
00a4d960 : MOV EBX,0x3
00a4d965 : IDIV EBX
00a4d967 : MOVZX EAX,DL
00a4d96a : SHL EAX,0xd
00a4d96d : LEA EBX,[EAX + ECX*0x1 + 0x122cb8]
00a4d974 : MOV byte ptr [ECX + 0x18],DL
00a4d977 : MOV dword ptr [EBP + 0xffffff68],EBX
00a4d97d : MOV dword ptr [EBP + -0x4],0x0
00a4d984 : TEST EBX,EBX
00a4d986 : JZ 0x00a4d9b5
00a4d988 : CALL 0x00a49c90
00a4d98d : XOR ECX,ECX
00a4d98f : MOV word ptr [EBX],CX
00a4d992 : LEA EDI,[EBX + 0x8]
00a4d995 : MOV ECX,0x20
00a4d99a : LEA ESI,[EBP + 0xffffff70]
00a4d9a0 : MOVSD.REP ES:EDI,ESI
00a4d9a2 : MOV EDI,dword ptr [EBP + 0xffffff6c]
00a4d9a8 : MOV byte ptr [EBX + 0x2],0x33
00a4d9ac : MOV byte ptr [EBX + 0x3],0x21
00a4d9b0 : MOV dword ptr [EBX + 0x4],EAX
00a4d9b3 : JMP 0x00a4d9b7
00a4d9b5 : XOR EBX,EBX
00a4d9b7 : MOV dword ptr [EBP + -0x4],0xffffffff
00a4d9be : MOV ECX,dword ptr [0x017247d4]
00a4d9c4 : MOV EAX,dword ptr [ECX + 0x4]
00a4d9c7 : TEST EAX,EAX
00a4d9c9 : JZ 0x00a4d9e4
00a4d9cb : CMP byte ptr [ECX + 0x8],0x0
00a4d9cf : JZ 0x00a4d9e4
00a4d9d1 : PUSH 0x88
00a4d9d6 : PUSH EAX
00a4d9d7 : MOV EDI,EBX
00a4d9d9 : CALL 0x00a0dd40
00a4d9de : MOV EDI,dword ptr [EBP + 0xffffff6c]
00a4d9e4 : MOV ESI,dword ptr [0x00da98e8]
00a4d9ea : PUSH 0xcc7440
00a4d9ef : CALL 0x008018d0
00a4d9f4 : ADD ESP,0x4
00a4d9f7 : PUSH 0x0
00a4d9f9 : PUSH 0xcc748c
00a4d9fe : MOV ECX,EDI
00a4da00 : CALL 0x00406360
00a4da05 : MOV ECX,dword ptr [EBP + -0xc]
00a4da08 : MOV dword ptr FS:[0x0],ECX
00a4da0f : POP ECX
00a4da10 : POP EDI
00a4da11 : POP ESI
00a4da12 : POP EBX
00a4da13 : MOV ECX,dword ptr [EBP + -0x10]
00a4da16 : XOR ECX,EBP
00a4da18 : CALL 0x00633e6b
00a4da1d : MOV ESP,EBP
00a4da1f : POP EBP
00a4da20 : RET
