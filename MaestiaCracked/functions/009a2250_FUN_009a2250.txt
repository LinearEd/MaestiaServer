PROGRAM  : Maestia.exe
FUNCTION : FUN_009a2250
ENTRY    : 009a2250
BODY     : [[009a2250, 009a2437]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_009a2250(undefined4 ***param_1,undefined4 param_2,undefined4 param_3,byte param_4)

{
  int iVar1;
  uint uVar2;
  undefined4 *puVar3;
  int *in_ECX;
  undefined4 uStack_84;
  int *piStack_80;
  int *piStack_7c;
  char *pcStack_78;
  undefined4 **ppuStack_74;
  undefined4 **ppuStack_70;
  undefined4 *puStack_6c;
  uint uStack_68;
  uint local_40;
  undefined4 local_3c;
  int local_38;
  undefined1 *local_34;
  undefined1 local_30 [4];
  undefined4 **local_2c [4];
  undefined4 local_1c;
  uint local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  uint local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b4af5a;
  local_10 = ExceptionList;
  uStack_68 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_14 = uStack_68;
  if (((ushort)param_1 < 0xe) || (0x13 < (ushort)param_1)) {
    puStack_6c = (undefined4 *)0x0;
    ppuStack_70 = param_1;
    ppuStack_74 = (undefined4 ***)0x9a229b;
    local_38 = (**(code **)(*in_ECX + 0x74))();
    iVar1 = DAT_00d7c54c;
    if (local_38 != 0) {
      puStack_6c = &local_3c;
      local_3c = param_3;
      ppuStack_70 = (undefined4 ***)0x9a22c1;
      FUN_004437f0();
      if ((local_34 != *(undefined1 **)(iVar1 + 0x44)) &&
         (iVar1 = *(int *)(local_34 + 0x10), iVar1 != 0)) {
        local_18 = 7;
        local_1c = 0;
        local_2c[0] = (undefined4 **)((uint)local_2c[0] & 0xffff0000);
        local_8 = 0;
        puStack_6c = (undefined4 *)local_30;
        ppuStack_70 = (undefined4 **)CONCAT22(*(undefined2 *)(iVar1 + 4),*(undefined2 *)(iVar1 + 6))
        ;
        ppuStack_74 = (undefined4 **)0x9a2309;
        (**(code **)(*in_ECX + 0x58))();
        local_34 = (undefined1 *)&uStack_84;
        puStack_6c = (undefined4 *)0x7;
        ppuStack_70 = (undefined4 **)0x0;
        piStack_80 = (int *)((uint)piStack_80 & 0xffff0000);
        FUN_00405eb0(local_30,0,0xffffffff);
        local_8 = local_8 & 0xffffff00;
        ppuStack_74 = (undefined4 **)FUN_008f75f0();
        local_8._0_1_ = 2;
        puStack_6c = (undefined4 *)0xffffffff;
        ppuStack_70 = (undefined4 ***)0x0;
        pcStack_78 = (char *)0x9a234b;
        FUN_00405eb0();
        local_8 = (uint)local_8._1_3_ << 8;
        if (7 < local_40) {
                    /* WARNING: Subroutine does not return */
          puStack_6c = (undefined4 *)0x9a235c;
          FUN_006f04e0();
        }
        puStack_6c = (undefined4 *)0x9a2370;
        uVar2 = FUN_009a01c0();
        iVar1 = *DAT_00da9894;
        if ((iVar1 != 0) && (*(int *)(iVar1 + 0x114) != 0)) {
          piStack_80 = *(int **)(iVar1 + 0x114);
          ppuStack_70 = local_2c[0];
          if (local_18 < 8) {
            ppuStack_70 = local_2c;
          }
          puStack_6c = (undefined4 *)(uint)param_4;
          pcStack_78 = "%d,%ls,%d";
          piStack_7c = (int *)0xc89538;
          uStack_84 = 0x9a23b5;
          ppuStack_74 = (undefined4 ***)(uVar2 & 0xffff);
          (**(code **)(*piStack_80 + 4))();
        }
        puStack_6c = (undefined4 *)0x9a23c5;
        puVar3 = (undefined4 *)FUN_00a08b70();
        iVar1 = *DAT_00da9894;
        if ((iVar1 != 0) && (*(int *)(iVar1 + 0x114) != 0)) {
          piStack_7c = *(int **)(iVar1 + 0x114);
          ppuStack_74 = (undefined4 **)0xc89548;
          pcStack_78 = "SetEquipItemQuality";
          piStack_80 = (int *)0x9a23f6;
          ppuStack_70 = (undefined4 ***)(uVar2 & 0xffff);
          puStack_6c = puVar3;
          (**(code **)(*piStack_7c + 4))();
        }
        local_8 = 0xffffffff;
        if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
          puStack_6c = (undefined4 *)0x9a240e;
          FUN_006f04e0();
        }
        local_18 = 7;
        local_1c = 0;
        local_2c[0] = (undefined4 **)((uint)local_2c[0] & 0xffff0000);
      }
    }
  }
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
009a2250 : PUSH EBP
009a2251 : MOV EBP,ESP
009a2253 : PUSH -0x1
009a2255 : PUSH 0xb4af5a
009a225a : MOV EAX,FS:[0x0]
009a2260 : PUSH EAX
009a2261 : SUB ESP,0x48
009a2264 : MOV EAX,[0x00d66fa0]
009a2269 : XOR EAX,EBP
009a226b : MOV dword ptr [EBP + -0x10],EAX
009a226e : PUSH EBX
009a226f : PUSH ESI
009a2270 : PUSH EDI
009a2271 : PUSH EAX
009a2272 : LEA EAX,[EBP + -0xc]
009a2275 : MOV FS:[0x0],EAX
009a227b : MOV EAX,dword ptr [EBP + 0x8]
009a227e : MOV ESI,ECX
009a2280 : CMP AX,0xe
009a2284 : JC 0x009a2290
009a2286 : CMP AX,0x13
009a228a : JBE 0x009a241a
009a2290 : MOV EDX,dword ptr [ESI]
009a2292 : XOR EBX,EBX
009a2294 : PUSH EBX
009a2295 : PUSH EAX
009a2296 : MOV EAX,dword ptr [EDX + 0x74]
009a2299 : CALL EAX
009a229b : MOV dword ptr [EBP + -0x34],EAX
009a229e : CMP EAX,EBX
009a22a0 : JZ 0x009a241a
009a22a6 : MOV ECX,dword ptr [EBP + 0x10]
009a22a9 : MOV EDI,dword ptr [0x00d7c54c]
009a22af : LEA EDX,[EBP + -0x38]
009a22b2 : MOV dword ptr [EBP + -0x38],ECX
009a22b5 : PUSH EDX
009a22b6 : LEA ECX,[EDI + 0x40]
009a22b9 : LEA EAX,[EBP + -0x30]
009a22bc : CALL 0x004437f0
009a22c1 : MOV EDI,dword ptr [EDI + 0x44]
009a22c4 : MOV EAX,dword ptr [EBP + -0x30]
009a22c7 : CMP EAX,EDI
009a22c9 : JZ 0x009a241a
009a22cf : MOV EAX,dword ptr [EAX + 0x10]
009a22d2 : CMP EAX,EBX
009a22d4 : JZ 0x009a241a
009a22da : MOV EDI,0x7
009a22df : XOR ECX,ECX
009a22e1 : MOV dword ptr [EBP + -0x14],EDI
009a22e4 : MOV dword ptr [EBP + -0x18],EBX
009a22e7 : MOV word ptr [EBP + -0x28],CX
009a22eb : MOV dword ptr [EBP + -0x4],EBX
009a22ee : MOV EDX,dword ptr [ESI]
009a22f0 : MOV EDX,dword ptr [EDX + 0x58]
009a22f3 : LEA ECX,[EBP + -0x2c]
009a22f6 : PUSH ECX
009a22f7 : MOVZX ECX,word ptr [EAX + 0x4]
009a22fb : MOVZX EAX,word ptr [EAX + 0x6]
009a22ff : SHL ECX,0x10
009a2302 : OR ECX,EAX
009a2304 : PUSH ECX
009a2305 : MOV ECX,ESI
009a2307 : CALL EDX
009a2309 : SUB ESP,0x1c
009a230c : MOV ECX,ESP
009a230e : MOV dword ptr [EBP + -0x30],ESP
009a2311 : PUSH -0x1
009a2313 : PUSH EBX
009a2314 : LEA EDX,[EBP + -0x2c]
009a2317 : XOR EAX,EAX
009a2319 : MOV dword ptr [ECX + 0x18],EDI
009a231c : MOV dword ptr [ECX + 0x14],EBX
009a231f : PUSH EDX
009a2320 : MOV word ptr [ECX + 0x4],AX
009a2324 : CALL 0x00405eb0
009a2329 : MOV byte ptr [EBP + -0x4],0x1
009a232d : MOV byte ptr [EBP + -0x4],BL
009a2330 : LEA ECX,[EBP + -0x54]
009a2333 : CALL 0x008f75f0
009a2338 : ADD ESP,0x1c
009a233b : MOV byte ptr [EBP + -0x4],0x2
009a233f : PUSH -0x1
009a2341 : PUSH EBX
009a2342 : PUSH EAX
009a2343 : LEA ECX,[EBP + -0x2c]
009a2346 : CALL 0x00405eb0
009a234b : MOV byte ptr [EBP + -0x4],BL
009a234e : CMP dword ptr [EBP + -0x3c],0x8
009a2352 : JC 0x009a235c
009a2354 : MOV ECX,dword ptr [EBP + -0x50]
009a2357 : CALL 0x006f04e0
009a235c : MOV ECX,dword ptr [EBP + 0x8]
009a235f : XOR EAX,EAX
009a2361 : MOV dword ptr [EBP + -0x3c],EDI
009a2364 : MOV dword ptr [EBP + -0x40],EBX
009a2367 : MOV word ptr [EBP + -0x50],AX
009a236b : CALL 0x009a01c0
009a2370 : MOV ECX,dword ptr [0x00da9894]
009a2376 : MOVZX ESI,AX
009a2379 : MOV EAX,dword ptr [ECX]
009a237b : CMP EAX,EBX
009a237d : JZ 0x009a23bd
009a237f : CMP dword ptr [EAX + 0x114],EBX
009a2385 : JZ 0x009a23bd
009a2387 : CMP dword ptr [EBP + -0x14],0x8
009a238b : MOV EAX,dword ptr [EAX + 0x114]
009a2391 : MOV ECX,dword ptr [EBP + -0x28]
009a2394 : JNC 0x009a2399
009a2396 : LEA ECX,[EBP + -0x28]
009a2399 : MOVZX EDI,byte ptr [EBP + 0x14]
009a239d : MOV EDX,dword ptr [EAX]
009a239f : MOV EDX,dword ptr [EDX + 0x4]
009a23a2 : PUSH EDI
009a23a3 : PUSH ECX
009a23a4 : MOVZX ECX,SI
009a23a7 : PUSH ECX
009a23a8 : PUSH 0xc8952c
009a23ad : PUSH 0xc89538
009a23b2 : PUSH EAX
009a23b3 : CALL EDX
009a23b5 : ADD ESP,0x18
009a23b8 : MOV EDI,0x7
009a23bd : MOV ECX,dword ptr [EBP + -0x34]
009a23c0 : CALL 0x00a08b70
009a23c5 : MOV ECX,dword ptr [0x00da9894]
009a23cb : MOV ECX,dword ptr [ECX]
009a23cd : CMP ECX,EBX
009a23cf : JZ 0x009a23f9
009a23d1 : CMP dword ptr [ECX + 0x114],EBX
009a23d7 : JZ 0x009a23f9
009a23d9 : MOV ECX,dword ptr [ECX + 0x114]
009a23df : MOV EDX,dword ptr [ECX]
009a23e1 : PUSH EAX
009a23e2 : MOVZX EAX,SI
009a23e5 : PUSH EAX
009a23e6 : PUSH 0xc89548
009a23eb : PUSH 0xc89550
009a23f0 : PUSH ECX
009a23f1 : MOV ECX,dword ptr [EDX + 0x4]
009a23f4 : CALL ECX
009a23f6 : ADD ESP,0x14
009a23f9 : MOV dword ptr [EBP + -0x4],0xffffffff
009a2400 : CMP dword ptr [EBP + -0x14],0x8
009a2404 : JC 0x009a240e
009a2406 : MOV ECX,dword ptr [EBP + -0x28]
009a2409 : CALL 0x006f04e0
009a240e : XOR EDX,EDX
009a2410 : MOV dword ptr [EBP + -0x14],EDI
009a2413 : MOV dword ptr [EBP + -0x18],EBX
009a2416 : MOV word ptr [EBP + -0x28],DX
009a241a : MOV ECX,dword ptr [EBP + -0xc]
009a241d : MOV dword ptr FS:[0x0],ECX
009a2424 : POP ECX
009a2425 : POP EDI
009a2426 : POP ESI
009a2427 : POP EBX
009a2428 : MOV ECX,dword ptr [EBP + -0x10]
009a242b : XOR ECX,EBP
009a242d : CALL 0x00633e6b
009a2432 : MOV ESP,EBP
009a2434 : POP EBP
009a2435 : RET 0x10
