PROGRAM  : Maestia.exe
FUNCTION : FUN_008de000
ENTRY    : 008de000
BODY     : [[008de000, 008de444]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008de000(uint param_1)

{
  uint *puVar1;
  uint *puVar2;
  int iVar3;
  int *piVar4;
  int iVar5;
  uint uVar6;
  undefined4 uVar7;
  uint8_t *puVar8;
  byte bVar9;
  int iVar10;
  undefined1 local_34 [28];
  uint8_t *local_18;
  undefined4 local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  iVar5 = param_1;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b3eda1;
  local_10 = ExceptionList;
  if (*(int *)(param_1 + 0x8c) == 0) {
    ExceptionList = &local_10;
    FUN_008018d0(L"AvaGuiPremiumShop::CheckOnBuyEvent  find Item NULL");
    ExceptionList = local_10;
    return;
  }
  if (*(int *)(param_1 + 0x1bc) == 0) {
    uVar6 = *(int *)(param_1 + 0xf0) - *(int *)(param_1 + 0x1c8);
    local_14 = CONCAT31(local_14._1_3_,1);
    puVar1 = (uint *)(param_1 + 0x1b4);
    param_1 = uVar6;
    if (*puVar1 < uVar6) {
      ExceptionList = &local_10;
      FUN_008dcc20(DAT_00d66fa0 ^ (uint)&stack0xfffffffc);
      ExceptionList = local_10;
      return;
    }
  }
  else if (*(int *)(param_1 + 0x1bc) == 1) {
    puVar1 = (uint *)(param_1 + 0xf8);
    local_14 = CONCAT31(local_14._1_3_,2);
    puVar2 = (uint *)(param_1 + 0x1b8);
    param_1 = *puVar1;
    if (*puVar2 < *puVar1) {
      if (DAT_0172491c == 0) {
        return;
      }
      if (*DAT_00da9894 == 0) {
        return;
      }
      if (*(int *)(*DAT_00da9894 + 0x1a8) == 0) {
        return;
      }
      ExceptionList = &local_10;
      FUN_00406460(L"IDS_NOT_ENOUGH_MILEAGE");
      local_8 = 0;
      piVar4 = *(int **)(*DAT_00da9894 + 0x1a8);
      uVar7 = FUN_0081d120(local_34);
      local_8._0_1_ = 1;
      (**(code **)(*piVar4 + 0x44))(uVar7,3);
      local_8 = (uint)local_8._1_3_ << 8;
      goto LAB_008de136;
    }
  }
  else {
    param_1 = *(uint *)(param_1 + 0x104);
    local_14 = CONCAT31(local_14._1_3_,3);
    if ((*(int *)(DAT_0172491c + 0x17c) != 0) &&
       (*(uint *)(*(int *)(DAT_0172491c + 0x17c) + 0x1ed0) < param_1)) {
      if (*DAT_00da9894 == 0) {
        return;
      }
      if (*(int *)(*DAT_00da9894 + 0x1a8) == 0) {
        return;
      }
      ExceptionList = &local_10;
      FUN_00406460(L"IDS_NOT_ENOUGH_GOLD");
      local_8 = 2;
      piVar4 = *(int **)(*DAT_00da9894 + 0x1a8);
      uVar7 = FUN_0081d120(local_34);
      local_8._0_1_ = 3;
      (**(code **)(*piVar4 + 0x44))(uVar7,3);
      local_8 = CONCAT31(local_8._1_3_,2);
      goto LAB_008de136;
    }
  }
  iVar3 = *(int *)(DAT_0172491c + 0x17c);
  if (iVar3 == 0) {
LAB_008de2f3:
    iVar3 = *(int *)ThreadLocalStoragePointer;
    bVar9 = (byte)((ulonglong)(*(byte *)(iVar3 + 0x18) + 1) % 3);
    ExceptionList = &local_10;
    *(byte *)(iVar3 + 0x18) = bVar9;
    local_18 = (uint8_t *)((uint)bVar9 * 0x2000 + 0x122cb8 + iVar3);
    if (local_18 == (uint8_t *)0x0) {
      puVar8 = (uint8_t *)0x0;
    }
    else {
      local_18[0] = '\0';
      local_18[1] = '\0';
      local_18[2] = ';';
      local_18[3] = '-';
      local_18[4] = '\x01';
      local_18[5] = '\0';
      puVar8 = local_18;
    }
    local_8 = 0xffffffff;
    if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
      FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),6,puVar8);
    }
    iVar10 = DAT_017247d4;
    bVar9 = (byte)((ulonglong)(*(byte *)(iVar3 + 0x18) + 1) % 3);
    *(byte *)(iVar3 + 0x18) = bVar9;
    local_18 = (uint8_t *)((uint)bVar9 * 0x2000 + 0x122cb8 + iVar3);
    local_8 = 9;
    if (local_18 == (uint8_t *)0x0) {
      puVar8 = (uint8_t *)0x0;
    }
    else {
      puVar8 = (uint8_t *)FUN_0042daa0(*(undefined4 *)(iVar5 + 0x1c4),param_1,local_14);
    }
    local_8 = 0xffffffff;
    if ((*(int *)(iVar10 + 4) != 0) && (*(char *)(iVar10 + 8) != '\0')) {
      FUN_00a0dd40(*(int *)(iVar10 + 4),0x13,puVar8);
      iVar10 = DAT_017247d4;
    }
    bVar9 = (byte)((ulonglong)(*(byte *)(iVar3 + 0x18) + 1) % 3);
    *(byte *)(iVar3 + 0x18) = bVar9;
    puVar8 = (uint8_t *)((uint)bVar9 * 0x2000 + 0x122cb8 + iVar3);
    if (puVar8 == (uint8_t *)0x0) {
      puVar8 = (uint8_t *)0x0;
    }
    else {
      puVar8[0] = '\0';
      puVar8[1] = '\0';
      puVar8[2] = ';';
      puVar8[3] = '/';
    }
    local_8 = 0xffffffff;
    if ((*(int *)(iVar10 + 4) != 0) && (*(char *)(iVar10 + 8) != '\0')) {
      FUN_00a0dd40(*(int *)(iVar10 + 4),4,puVar8);
    }
    ExceptionList = local_10;
    return;
  }
  if (*(uint *)(iVar3 + 0xa0) < (uint)*(ushort *)(iVar5 + 0x150)) {
    if (*DAT_00da9894 == 0) {
      return;
    }
    if (*(int *)(*DAT_00da9894 + 0x1a8) == 0) {
      return;
    }
    ExceptionList = &local_10;
    FUN_00406460(L"IDS_PREMIUM_BUY_LEVEL_LIMIT");
    local_8 = 4;
    piVar4 = *(int **)(*DAT_00da9894 + 0x1a8);
    uVar7 = FUN_0081d120(local_34);
    local_8._0_1_ = 5;
    (**(code **)(*piVar4 + 0x44))(uVar7,3);
    local_8 = CONCAT31(local_8._1_3_,4);
  }
  else {
    if ((*(ushort *)(iVar5 + 0x152) == 0) ||
       (*(uint *)(iVar3 + 0xa0) <= (uint)*(ushort *)(iVar5 + 0x152))) goto LAB_008de2f3;
    if (*DAT_00da9894 == 0) {
      return;
    }
    if (*(int *)(*DAT_00da9894 + 0x1a8) == 0) {
      return;
    }
    ExceptionList = &local_10;
    FUN_00406460(L"IDS_PREMIUM_BUY_LEVEL_LIMIT");
    local_8 = 6;
    piVar4 = *(int **)(*DAT_00da9894 + 0x1a8);
    uVar7 = FUN_0081d120(local_34);
    local_8._0_1_ = 7;
    (**(code **)(*piVar4 + 0x44))(uVar7,3);
    local_8 = CONCAT31(local_8._1_3_,6);
  }
LAB_008de136:
  FUN_00406560();
  local_8 = 0xffffffff;
  FUN_00406560();
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
008de000 : PUSH EBP
008de001 : MOV EBP,ESP
008de003 : PUSH -0x1
008de005 : PUSH 0xb3eda1
008de00a : MOV EAX,FS:[0x0]
008de010 : PUSH EAX
008de011 : SUB ESP,0x40
008de014 : PUSH EBX
008de015 : PUSH ESI
008de016 : PUSH EDI
008de017 : MOV EAX,[0x00d66fa0]
008de01c : XOR EAX,EBP
008de01e : PUSH EAX
008de01f : LEA EAX,[EBP + -0xc]
008de022 : MOV FS:[0x0],EAX
008de028 : MOV EBX,dword ptr [EBP + 0x8]
008de02b : CMP dword ptr [EBX + 0x8c],0x0
008de032 : JNZ 0x008de05b
008de034 : MOV ESI,dword ptr [0x00da98e8]
008de03a : PUSH 0xc57230
008de03f : CALL 0x008018d0
008de044 : ADD ESP,0x4
008de047 : MOV ECX,dword ptr [EBP + -0xc]
008de04a : MOV dword ptr FS:[0x0],ECX
008de051 : POP ECX
008de052 : POP EDI
008de053 : POP ESI
008de054 : POP EBX
008de055 : MOV ESP,EBP
008de057 : POP EBP
008de058 : RET 0x4
008de05b : MOV EAX,dword ptr [EBX + 0x1bc]
008de061 : MOV ECX,dword ptr [0x0172491c]
008de067 : TEST EAX,EAX
008de069 : JNZ 0x008de0a3
008de06b : MOV EAX,dword ptr [EBX + 0xf0]
008de071 : SUB EAX,dword ptr [EBX + 0x1c8]
008de077 : MOV byte ptr [EBP + -0x10],0x1
008de07b : MOV dword ptr [EBP + 0x8],EAX
008de07e : CMP EAX,dword ptr [EBX + 0x1b4]
008de084 : JBE 0x008de1e9
008de08a : CALL 0x008dcc20
008de08f : MOV ECX,dword ptr [EBP + -0xc]
008de092 : MOV dword ptr FS:[0x0],ECX
008de099 : POP ECX
008de09a : POP EDI
008de09b : POP ESI
008de09c : POP EBX
008de09d : MOV ESP,EBP
008de09f : POP EBP
008de0a0 : RET 0x4
008de0a3 : CMP EAX,0x1
008de0a6 : JNZ 0x008de161
008de0ac : MOV EAX,dword ptr [EBX + 0xf8]
008de0b2 : MOV dword ptr [EBP + 0x8],EAX
008de0b5 : MOV byte ptr [EBP + -0x10],0x2
008de0b9 : CMP EAX,dword ptr [EBX + 0x1b8]
008de0bf : JBE 0x008de1e9
008de0c5 : CMP dword ptr [0x0172491c],0x0
008de0cc : JZ 0x008de431
008de0d2 : MOV EAX,[0x00da9894]
008de0d7 : MOV EAX,dword ptr [EAX]
008de0d9 : TEST EAX,EAX
008de0db : JZ 0x008de431
008de0e1 : CMP dword ptr [EAX + 0x1a8],0x0
008de0e8 : JZ 0x008de431
008de0ee : PUSH 0xc57298
008de0f3 : LEA ECX,[EBP + -0x30]
008de0f6 : CALL 0x00406460
008de0fb : MOV dword ptr [EBP + -0x4],0x0
008de102 : MOV ECX,dword ptr [0x00da9894]
008de108 : MOV EAX,dword ptr [ECX]
008de10a : MOV ECX,dword ptr [0x0172491c]
008de110 : MOV ESI,dword ptr [EAX + 0x1a8]
008de116 : LEA EDX,[EBP + -0x30]
008de119 : PUSH EDX
008de11a : LEA EDI,[EBP + -0x4c]
008de11d : CALL 0x0081d120
008de122 : MOV byte ptr [EBP + -0x4],0x1
008de126 : MOV EDX,dword ptr [ESI]
008de128 : PUSH 0x3
008de12a : PUSH EAX
008de12b : MOV EAX,dword ptr [EDX + 0x44]
008de12e : MOV ECX,ESI
008de130 : CALL EAX
008de132 : MOV byte ptr [EBP + -0x4],0x0
008de136 : LEA ECX,[EBP + -0x4c]
008de139 : CALL 0x00406560
008de13e : MOV dword ptr [EBP + -0x4],0xffffffff
008de145 : LEA ECX,[EBP + -0x30]
008de148 : CALL 0x00406560
008de14d : MOV ECX,dword ptr [EBP + -0xc]
008de150 : MOV dword ptr FS:[0x0],ECX
008de157 : POP ECX
008de158 : POP EDI
008de159 : POP ESI
008de15a : POP EBX
008de15b : MOV ESP,EBP
008de15d : POP EBP
008de15e : RET 0x4
008de161 : MOV EAX,dword ptr [ECX + 0x17c]
008de167 : MOV EDX,dword ptr [EBX + 0x104]
008de16d : MOV dword ptr [EBP + 0x8],EDX
008de170 : MOV byte ptr [EBP + -0x10],0x3
008de174 : TEST EAX,EAX
008de176 : JZ 0x008de1e9
008de178 : CMP EDX,dword ptr [EAX + 0x1ed0]
008de17e : JBE 0x008de1e9
008de180 : MOV EAX,[0x00da9894]
008de185 : MOV EAX,dword ptr [EAX]
008de187 : TEST EAX,EAX
008de189 : JZ 0x008de431
008de18f : CMP dword ptr [EAX + 0x1a8],0x0
008de196 : JZ 0x008de431
008de19c : PUSH 0xc572c8
008de1a1 : LEA ECX,[EBP + -0x30]
008de1a4 : CALL 0x00406460
008de1a9 : MOV EBX,0x2
008de1ae : MOV dword ptr [EBP + -0x4],EBX
008de1b1 : MOV ECX,dword ptr [0x00da9894]
008de1b7 : MOV EAX,dword ptr [ECX]
008de1b9 : MOV ECX,dword ptr [0x0172491c]
008de1bf : MOV ESI,dword ptr [EAX + 0x1a8]
008de1c5 : LEA EDX,[EBP + -0x30]
008de1c8 : PUSH EDX
008de1c9 : LEA EDI,[EBP + -0x4c]
008de1cc : CALL 0x0081d120
008de1d1 : MOV byte ptr [EBP + -0x4],0x3
008de1d5 : MOV EDX,dword ptr [ESI]
008de1d7 : PUSH 0x3
008de1d9 : PUSH EAX
008de1da : MOV EAX,dword ptr [EDX + 0x44]
008de1dd : MOV ECX,ESI
008de1df : CALL EAX
008de1e1 : MOV byte ptr [EBP + -0x4],BL
008de1e4 : JMP 0x008de136
008de1e9 : MOV EAX,dword ptr [ECX + 0x17c]
008de1ef : TEST EAX,EAX
008de1f1 : JZ 0x008de2f3
008de1f7 : MOVZX EDX,word ptr [EBX + 0x150]
008de1fe : MOV ECX,dword ptr [EAX + 0xa0]
008de204 : CMP EDX,ECX
008de206 : JBE 0x008de271
008de208 : MOV EAX,[0x00da9894]
008de20d : MOV EAX,dword ptr [EAX]
008de20f : TEST EAX,EAX
008de211 : JZ 0x008de431
008de217 : CMP dword ptr [EAX + 0x1a8],0x0
008de21e : JZ 0x008de431
008de224 : PUSH 0xc572f0
008de229 : LEA ECX,[EBP + -0x30]
008de22c : CALL 0x00406460
008de231 : MOV EBX,0x4
008de236 : MOV dword ptr [EBP + -0x4],EBX
008de239 : MOV ECX,dword ptr [0x00da9894]
008de23f : MOV EAX,dword ptr [ECX]
008de241 : MOV ECX,dword ptr [0x0172491c]
008de247 : MOV ESI,dword ptr [EAX + 0x1a8]
008de24d : LEA EDX,[EBP + -0x30]
008de250 : PUSH EDX
008de251 : LEA EDI,[EBP + -0x4c]
008de254 : CALL 0x0081d120
008de259 : MOV byte ptr [EBP + -0x4],0x5
008de25d : MOV EDX,dword ptr [ESI]
008de25f : PUSH 0x3
008de261 : PUSH EAX
008de262 : MOV EAX,dword ptr [EDX + 0x44]
008de265 : MOV ECX,ESI
008de267 : CALL EAX
008de269 : MOV byte ptr [EBP + -0x4],BL
008de26c : JMP 0x008de136
008de271 : MOVZX ECX,word ptr [EBX + 0x152]
008de278 : TEST CX,CX
008de27b : JZ 0x008de2f3
008de27d : MOV EAX,dword ptr [EAX + 0xa0]
008de283 : MOVZX ECX,CX
008de286 : CMP ECX,EAX
008de288 : JNC 0x008de2f3
008de28a : MOV EDX,dword ptr [0x00da9894]
008de290 : MOV EAX,dword ptr [EDX]
008de292 : TEST EAX,EAX
008de294 : JZ 0x008de431
008de29a : CMP dword ptr [EAX + 0x1a8],0x0
008de2a1 : JZ 0x008de431
008de2a7 : PUSH 0xc57328
008de2ac : LEA ECX,[EBP + -0x30]
008de2af : CALL 0x00406460
008de2b4 : MOV EBX,0x6
008de2b9 : MOV dword ptr [EBP + -0x4],EBX
008de2bc : MOV EAX,[0x00da9894]
008de2c1 : MOV EAX,dword ptr [EAX]
008de2c3 : MOV ESI,dword ptr [EAX + 0x1a8]
008de2c9 : LEA ECX,[EBP + -0x30]
008de2cc : PUSH ECX
008de2cd : MOV ECX,dword ptr [0x0172491c]
008de2d3 : LEA EDI,[EBP + -0x4c]
008de2d6 : CALL 0x0081d120
008de2db : MOV byte ptr [EBP + -0x4],0x7
008de2df : MOV EDX,dword ptr [ESI]
008de2e1 : PUSH 0x3
008de2e3 : PUSH EAX
008de2e4 : MOV EAX,dword ptr [EDX + 0x44]
008de2e7 : MOV ECX,ESI
008de2e9 : CALL EAX
008de2eb : MOV byte ptr [EBP + -0x4],BL
008de2ee : JMP 0x008de136
008de2f3 : MOV ECX,dword ptr FS:[0x2c]
008de2fa : MOV ESI,dword ptr [ECX]
008de2fc : MOVZX EAX,byte ptr [ESI + 0x18]
008de300 : INC EAX
008de301 : CDQ
008de302 : MOV ECX,0x3
008de307 : IDIV ECX
008de309 : MOV byte ptr [ESI + 0x18],DL
008de30c : MOVZX EDX,DL
008de30f : SHL EDX,0xd
008de312 : LEA EAX,[EDX + ESI*0x1 + 0x122cb8]
008de319 : MOV dword ptr [EBP + -0x14],EAX
008de31c : MOV dword ptr [EBP + -0x4],0x8
008de323 : TEST EAX,EAX
008de325 : JZ 0x008de33d
008de327 : XOR ECX,ECX
008de329 : MOV word ptr [EAX],CX
008de32c : MOV byte ptr [EAX + 0x2],0x3b
008de330 : MOV byte ptr [EAX + 0x3],0x2d
008de334 : MOV byte ptr [EAX + 0x4],0x1
008de338 : MOV byte ptr [EAX + 0x5],CL
008de33b : JMP 0x008de33f
008de33d : XOR EAX,EAX
008de33f : MOV dword ptr [EBP + -0x4],0xffffffff
008de346 : MOV EDI,dword ptr [0x017247d4]
008de34c : MOV ECX,dword ptr [EDI + 0x4]
008de34f : TEST ECX,ECX
008de351 : JZ 0x008de369
008de353 : CMP byte ptr [EDI + 0x8],0x0
008de357 : JZ 0x008de369
008de359 : PUSH 0x6
008de35b : PUSH ECX
008de35c : MOV EDI,EAX
008de35e : CALL 0x00a0dd40
008de363 : MOV EDI,dword ptr [0x017247d4]
008de369 : MOVZX EAX,byte ptr [ESI + 0x18]
008de36d : INC EAX
008de36e : CDQ
008de36f : MOV ECX,0x3
008de374 : IDIV ECX
008de376 : MOV byte ptr [ESI + 0x18],DL
008de379 : MOVZX EDX,DL
008de37c : SHL EDX,0xd
008de37f : LEA EAX,[EDX + ESI*0x1 + 0x122cb8]
008de386 : MOV dword ptr [EBP + -0x14],EAX
008de389 : MOV dword ptr [EBP + -0x4],0x9
008de390 : TEST EAX,EAX
008de392 : JZ 0x008de3b1
008de394 : MOV ECX,dword ptr [EBP + -0x10]
008de397 : MOV EDX,dword ptr [EBP + 0x8]
008de39a : PUSH ECX
008de39b : MOV ECX,dword ptr [EBX + 0x1c4]
008de3a1 : PUSH EDX
008de3a2 : MOV DX,word ptr [EBX + 0x15c]
008de3a9 : PUSH ECX
008de3aa : CALL 0x0042daa0
008de3af : JMP 0x008de3b3
008de3b1 : XOR EAX,EAX
008de3b3 : MOV dword ptr [EBP + -0x4],0xffffffff
008de3ba : MOV ECX,dword ptr [EDI + 0x4]
008de3bd : TEST ECX,ECX
008de3bf : JZ 0x008de3d7
008de3c1 : CMP byte ptr [EDI + 0x8],0x0
008de3c5 : JZ 0x008de3d7
008de3c7 : PUSH 0x13
008de3c9 : PUSH ECX
008de3ca : MOV EDI,EAX
008de3cc : CALL 0x00a0dd40
008de3d1 : MOV EDI,dword ptr [0x017247d4]
008de3d7 : MOVZX EAX,byte ptr [ESI + 0x18]
008de3db : INC EAX
008de3dc : CDQ
008de3dd : MOV ECX,0x3
008de3e2 : IDIV ECX
008de3e4 : MOV byte ptr [ESI + 0x18],DL
008de3e7 : MOVZX EDX,DL
008de3ea : SHL EDX,0xd
008de3ed : LEA ESI,[EDX + ESI*0x1 + 0x122cb8]
008de3f4 : MOV dword ptr [EBP + 0x8],ESI
008de3f7 : MOV dword ptr [EBP + -0x4],0xa
008de3fe : TEST ESI,ESI
008de400 : JZ 0x008de411
008de402 : XOR EAX,EAX
008de404 : MOV word ptr [ESI],AX
008de407 : MOV byte ptr [ESI + 0x2],0x3b
008de40b : MOV byte ptr [ESI + 0x3],0x2f
008de40f : JMP 0x008de413
008de411 : XOR ESI,ESI
008de413 : MOV dword ptr [EBP + -0x4],0xffffffff
008de41a : MOV EAX,dword ptr [EDI + 0x4]
008de41d : TEST EAX,EAX
008de41f : JZ 0x008de431
008de421 : CMP byte ptr [EDI + 0x8],0x0
008de425 : JZ 0x008de431
008de427 : PUSH 0x4
008de429 : PUSH EAX
008de42a : MOV EDI,ESI
008de42c : CALL 0x00a0dd40
008de431 : MOV ECX,dword ptr [EBP + -0xc]
008de434 : MOV dword ptr FS:[0x0],ECX
008de43b : POP ECX
008de43c : POP EDI
008de43d : POP ESI
008de43e : POP EBX
008de43f : MOV ESP,EBP
008de441 : POP EBP
008de442 : RET 0x4
