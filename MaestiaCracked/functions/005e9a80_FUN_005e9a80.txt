PROGRAM  : Maestia.exe
FUNCTION : FUN_005e9a80
ENTRY    : 005e9a80
BODY     : [[005e9a80, 005e9cdb]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005e9a80(undefined4 *param_1,int *param_2)

{
  undefined4 *puVar1;
  int *piVar2;
  int iVar3;
  ushort uVar4;
  uint uVar5;
  int *piVar6;
  int iVar7;
  LONG LVar8;
  char *this;
  GThread *this_00;
  undefined2 uVar9;
  int iVar10;
  uint uVar11;
  uint uVar12;
  uint local_c;
  int local_8;
  int local_4;
  
  uVar5 = (uint)param_1;
  iVar10 = *(int *)((int)param_1 + 0x314);
  if (iVar10 == 0) {
    iVar10 = (int)param_1 + 0x28;
  }
  FUN_0051b6e0();
  FUN_0053b190(&local_c);
  *(undefined1 *)(iVar10 + 0x15) = 0;
  if (*(int *)(iVar10 + 0x30) - *(int *)(iVar10 + 0x2c) < 2) {
    FUN_00539fb0(2);
  }
  piVar2 = param_2;
  uVar4 = *(ushort *)(*(int *)(iVar10 + 0x3c) + *(int *)(iVar10 + 0x2c));
  *(int *)(iVar10 + 0x2c) = *(int *)(iVar10 + 0x2c) + 2;
  this = "  importAssets: SourceUrl = %s, count = %d\n";
  if (*param_2 == 0x47) {
    this = "  importAssets2: SourceUrl = %s, count = %d\n";
  }
  GThread::OnExit((GThread *)this);
  if (*piVar2 == 0x47) {
    FUN_00500140();
  }
  iVar7 = FUN_005e9a00();
  *(undefined4 *)(iVar7 + 0x10) = *(undefined4 *)(*(int *)(uVar5 + 0x20) + 0x78);
  FUN_0051bc20(&local_c);
  piVar6 = (int *)(uint)uVar4;
  piVar2 = param_2;
  while (param_2 = piVar6, param_2 != (int *)0x0) {
    FUN_0051b6e0();
    *(undefined1 *)(iVar10 + 0x15) = 0;
    if (*(int *)(iVar10 + 0x30) - *(int *)(iVar10 + 0x2c) < 2) {
      FUN_00539fb0(2);
    }
    iVar3 = *(int *)(iVar10 + 0x2c);
    uVar9 = CONCAT11(*(undefined1 *)(*(int *)(iVar10 + 0x3c) + 1 + iVar3),
                     *(undefined1 *)(*(int *)(iVar10 + 0x3c) + iVar3));
    *(int *)(iVar10 + 0x2c) = iVar3 + 2;
    FUN_0053b190(&param_1);
    GThread::OnExit(this_00);
    FUN_00566c30(&local_8,uVar9);
    FUN_005e9030(((uint)param_1 & 0xfffffffc) + 8,uVar9,local_4);
    if ((local_8 == 0) && (local_4 != 0)) {
      FUN_00524240();
    }
    uVar11 = (uint)param_1 & 0xfffffffc;
    LVar8 = InterlockedExchangeAdd((LONG *)(uVar11 + 4),-1);
    if (LVar8 == 1) {
      FUN_00515cf0(uVar11);
    }
    piVar2 = (int *)((int)param_2 + -1);
    piVar6 = piVar2;
  }
  param_2 = piVar2;
  FUN_005a17f0(iVar7);
  iVar10 = *(int *)(uVar5 + 0x20);
  if (*(uint *)(iVar10 + 0xc) < 8) {
    param_1 = (undefined4 *)FUN_00561460(8);
  }
  else {
    param_1 = *(undefined4 **)(iVar10 + 8);
    *(undefined4 **)(iVar10 + 8) = param_1 + 2;
    *(uint *)(iVar10 + 0xc) = *(uint *)(iVar10 + 0xc) - 8;
  }
  if (param_1 == (undefined4 *)0x0) {
    param_1 = (undefined4 *)0x0;
  }
  else {
    *param_1 = &PTR_LAB_00b93dfc;
    param_1[1] = 0;
  }
  param_1[1] = *(undefined4 *)(iVar7 + 0x14);
  uVar11 = *(int *)(uVar5 + 0x30c) + 1;
  if (uVar11 < *(uint *)(uVar5 + 0x30c)) {
    uVar12 = uVar11;
    if (*(uint *)(uVar5 + 0x310) >> 1 <= uVar11) goto LAB_005e9ca1;
  }
  else {
    if (uVar11 < *(uint *)(uVar5 + 0x310)) goto LAB_005e9ca1;
    uVar12 = (uVar11 >> 2) + uVar11;
  }
  FUN_0052aa10((int *)(uVar5 + 0x308),uVar12);
LAB_005e9ca1:
  *(uint *)(uVar5 + 0x30c) = uVar11;
  puVar1 = (undefined4 *)(*(int *)(uVar5 + 0x308) + -4 + uVar11 * 4);
  if (puVar1 != (undefined4 *)0x0) {
    *puVar1 = param_1;
  }
  LVar8 = InterlockedExchangeAdd((LONG *)((local_c & 0xfffffffc) + 4),-1);
  if (LVar8 == 1) {
    FUN_00515cf0(local_c & 0xfffffffc);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005e9a80 : SUB ESP,0xc
005e9a83 : PUSH EBX
005e9a84 : PUSH EBP
005e9a85 : MOV EBP,dword ptr [ESP + 0x18]
005e9a89 : PUSH ESI
005e9a8a : MOV ESI,dword ptr [EBP + 0x314]
005e9a90 : PUSH EDI
005e9a91 : TEST ESI,ESI
005e9a93 : JNZ 0x005e9a98
005e9a95 : LEA ESI,[EBP + 0x28]
005e9a98 : LEA ECX,[ESP + 0x10]
005e9a9c : CALL 0x0051b6e0
005e9aa1 : LEA EAX,[ESP + 0x10]
005e9aa5 : PUSH EAX
005e9aa6 : MOV ECX,ESI
005e9aa8 : CALL 0x0053b190
005e9aad : MOV ECX,dword ptr [ESI + 0x30]
005e9ab0 : SUB ECX,dword ptr [ESI + 0x2c]
005e9ab3 : MOV byte ptr [ESI + 0x15],0x0
005e9ab7 : CMP ECX,0x2
005e9aba : JGE 0x005e9ac5
005e9abc : PUSH 0x2
005e9abe : MOV ECX,ESI
005e9ac0 : CALL 0x00539fb0
005e9ac5 : MOV EAX,dword ptr [ESI + 0x2c]
005e9ac8 : MOV EDX,dword ptr [ESI + 0x3c]
005e9acb : MOV EBX,dword ptr [ESP + 0x24]
005e9acf : LEA ECX,[EDX + EAX*0x1]
005e9ad2 : MOVZX DX,byte ptr [ECX + 0x1]
005e9ad7 : MOVZX CX,byte ptr [ECX]
005e9adb : SHL DX,0x8
005e9adf : OR DX,CX
005e9ae2 : MOVZX ECX,DX
005e9ae5 : ADD EAX,0x2
005e9ae8 : MOV dword ptr [ESI + 0x2c],EAX
005e9aeb : CMP dword ptr [EBX],0x47
005e9aee : MOVZX EDI,CX
005e9af1 : MOV ECX,0xb947cc
005e9af6 : JNZ 0x005e9afd
005e9af8 : MOV ECX,0xb9479c
005e9afd : MOV EDX,dword ptr [ESP + 0x10]
005e9b01 : AND EDX,0xfffffffc
005e9b04 : PUSH EDI
005e9b05 : ADD EDX,0x8
005e9b08 : PUSH EDX
005e9b09 : LEA EAX,[EBP + 0x14]
005e9b0c : PUSH ECX
005e9b0d : PUSH EAX
005e9b0e : CALL 0x0051d420
005e9b13 : ADD ESP,0x10
005e9b16 : CMP dword ptr [EBX],0x47
005e9b19 : JNZ 0x005e9b22
005e9b1b : MOV ECX,EBP
005e9b1d : CALL 0x00500140
005e9b22 : MOV ECX,EBP
005e9b24 : CALL 0x005e9a00
005e9b29 : MOV EBX,EAX
005e9b2b : MOV EAX,dword ptr [EBP + 0x20]
005e9b2e : MOV ECX,dword ptr [EAX + 0x78]
005e9b31 : LEA EDX,[ESP + 0x10]
005e9b35 : MOV dword ptr [EBX + 0x10],ECX
005e9b38 : PUSH EDX
005e9b39 : LEA ECX,[EBX + 0xc]
005e9b3c : CALL 0x0051bc20
005e9b41 : TEST EDI,EDI
005e9b43 : JLE 0x005e9c22
005e9b49 : MOV dword ptr [ESP + 0x24],EDI
005e9b4d : LEA ECX,[ESP + 0x20]
005e9b51 : CALL 0x0051b6e0
005e9b56 : MOV EAX,dword ptr [ESI + 0x30]
005e9b59 : SUB EAX,dword ptr [ESI + 0x2c]
005e9b5c : MOV byte ptr [ESI + 0x15],0x0
005e9b60 : CMP EAX,0x2
005e9b63 : JGE 0x005e9b6e
005e9b65 : PUSH 0x2
005e9b67 : MOV ECX,ESI
005e9b69 : CALL 0x00539fb0
005e9b6e : MOV EAX,dword ptr [ESI + 0x2c]
005e9b71 : MOV ECX,dword ptr [ESI + 0x3c]
005e9b74 : MOVZX DX,byte ptr [ECX + EAX*0x1 + 0x1]
005e9b7a : ADD ECX,EAX
005e9b7c : MOVZX CX,byte ptr [ECX]
005e9b80 : SHL DX,0x8
005e9b84 : OR DX,CX
005e9b87 : MOVZX EDI,DX
005e9b8a : LEA EDX,[ESP + 0x20]
005e9b8e : ADD EAX,0x2
005e9b91 : PUSH EDX
005e9b92 : MOV ECX,ESI
005e9b94 : MOV dword ptr [ESI + 0x2c],EAX
005e9b97 : CALL 0x0053b190
005e9b9c : MOV EAX,dword ptr [ESP + 0x20]
005e9ba0 : AND EAX,0xfffffffc
005e9ba3 : ADD EAX,0x8
005e9ba6 : PUSH EAX
005e9ba7 : MOVZX EDI,DI
005e9baa : PUSH EDI
005e9bab : LEA EAX,[EBP + 0x14]
005e9bae : PUSH 0xb9477c
005e9bb3 : PUSH EAX
005e9bb4 : CALL 0x0051d420
005e9bb9 : ADD ESP,0xc
005e9bbc : MOV EAX,ESP
005e9bbe : LEA EDX,[ESP + 0x18]
005e9bc2 : MOV dword ptr [EAX],EDI
005e9bc4 : MOV ECX,dword ptr [EBP + 0x20]
005e9bc7 : PUSH EDX
005e9bc8 : CALL 0x00566c30
005e9bcd : MOV EAX,dword ptr [ESP + 0x18]
005e9bd1 : MOV ECX,dword ptr [ESP + 0x20]
005e9bd5 : PUSH EAX
005e9bd6 : AND ECX,0xfffffffc
005e9bd9 : ADD ECX,0x8
005e9bdc : PUSH EDI
005e9bdd : PUSH ECX
005e9bde : MOV ECX,EBX
005e9be0 : CALL 0x005e9030
005e9be5 : CMP dword ptr [ESP + 0x14],0x0
005e9bea : JNZ 0x005e9bf9
005e9bec : MOV ECX,dword ptr [ESP + 0x18]
005e9bf0 : TEST ECX,ECX
005e9bf2 : JZ 0x005e9bf9
005e9bf4 : CALL 0x00524240
005e9bf9 : MOV EDI,dword ptr [ESP + 0x20]
005e9bfd : AND EDI,0xfffffffc
005e9c00 : PUSH -0x1
005e9c02 : LEA EDX,[EDI + 0x4]
005e9c05 : PUSH EDX
005e9c06 : CALL dword ptr [0x00b851cc]
005e9c0c : SUB EAX,0x1
005e9c0f : JNZ 0x005e9c17
005e9c11 : PUSH EDI
005e9c12 : CALL 0x00515cf0
005e9c17 : SUB dword ptr [ESP + 0x24],0x1
005e9c1c : JNZ 0x005e9b4d
005e9c22 : PUSH EBX
005e9c23 : MOV ECX,EBP
005e9c25 : CALL 0x005a17f0
005e9c2a : MOV ECX,dword ptr [EBP + 0x20]
005e9c2d : MOV EDX,dword ptr [ECX + 0xc]
005e9c30 : ADD ECX,0x8
005e9c33 : CMP EDX,0x8
005e9c36 : JC 0x005e9c47
005e9c38 : MOV EAX,dword ptr [ECX]
005e9c3a : LEA ESI,[EAX + 0x8]
005e9c3d : ADD EDX,-0x8
005e9c40 : MOV dword ptr [ECX],ESI
005e9c42 : MOV dword ptr [ECX + 0x4],EDX
005e9c45 : JMP 0x005e9c4e
005e9c47 : PUSH 0x8
005e9c49 : CALL 0x00561460
005e9c4e : XOR ECX,ECX
005e9c50 : CMP EAX,ECX
005e9c52 : JZ 0x005e9c63
005e9c54 : MOV dword ptr [EAX],0xb93dfc
005e9c5a : MOV dword ptr [EAX + 0x4],ECX
005e9c5d : MOV dword ptr [ESP + 0x20],EAX
005e9c61 : JMP 0x005e9c67
005e9c63 : MOV dword ptr [ESP + 0x20],ECX
005e9c67 : MOV EAX,dword ptr [EBX + 0x14]
005e9c6a : MOV ECX,dword ptr [ESP + 0x20]
005e9c6e : LEA EDI,[EBP + 0x308]
005e9c74 : MOV dword ptr [ECX + 0x4],EAX
005e9c77 : MOV ESI,dword ptr [EDI + 0x4]
005e9c7a : INC ESI
005e9c7b : CMP ESI,dword ptr [EDI + 0x4]
005e9c7e : JNC 0x005e9c8c
005e9c80 : MOV EDX,dword ptr [EDI + 0x8]
005e9c83 : SHR EDX,0x1
005e9c85 : CMP ESI,EDX
005e9c87 : JNC 0x005e9ca1
005e9c89 : PUSH ESI
005e9c8a : JMP 0x005e9c99
005e9c8c : CMP ESI,dword ptr [EDI + 0x8]
005e9c8f : JC 0x005e9ca1
005e9c91 : MOV EAX,ESI
005e9c93 : SHR EAX,0x2
005e9c96 : ADD EAX,ESI
005e9c98 : PUSH EAX
005e9c99 : PUSH EDI
005e9c9a : MOV ECX,EDI
005e9c9c : CALL 0x0052aa10
005e9ca1 : MOV ECX,dword ptr [EDI]
005e9ca3 : MOV dword ptr [EDI + 0x4],ESI
005e9ca6 : LEA ESI,[ECX + ESI*0x4 + -0x4]
005e9caa : TEST ESI,ESI
005e9cac : JZ 0x005e9cb4
005e9cae : MOV EDX,dword ptr [ESP + 0x20]
005e9cb2 : MOV dword ptr [ESI],EDX
005e9cb4 : MOV ESI,dword ptr [ESP + 0x10]
005e9cb8 : AND ESI,0xfffffffc
005e9cbb : PUSH -0x1
005e9cbd : LEA EAX,[ESI + 0x4]
005e9cc0 : PUSH EAX
005e9cc1 : CALL dword ptr [0x00b851cc]
005e9cc7 : SUB EAX,0x1
005e9cca : JNZ 0x005e9cd2
005e9ccc : PUSH ESI
005e9ccd : CALL 0x00515cf0
005e9cd2 : POP EDI
005e9cd3 : POP ESI
005e9cd4 : POP EBP
005e9cd5 : POP EBX
005e9cd6 : ADD ESP,0xc
005e9cd9 : RET 0x8
