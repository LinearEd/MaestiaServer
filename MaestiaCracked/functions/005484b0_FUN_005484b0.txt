PROGRAM  : Maestia.exe
FUNCTION : FUN_005484b0
ENTRY    : 005484b0
BODY     : [[005484b0, 005487e9]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_005484b0(int *param_1,undefined1 *param_2)

{
  byte bVar1;
  ushort uVar2;
  undefined2 uVar3;
  int *piVar4;
  char cVar5;
  int iVar6;
  int *piVar7;
  uint *puVar8;
  int iVar9;
  undefined4 uVar10;
  int in_ECX;
  int *piVar11;
  uint local_24;
  uint local_20;
  undefined1 local_1c [4];
  undefined1 *puStack_18;
  
  if (param_1[1] == 0) {
    return 0;
  }
  piVar7 = param_1 + 3;
  if (((param_1[3] != 0) && (param_1[2] != 0)) && (cVar5 = FUN_0055eb40(param_1[2]), cVar5 != '\0'))
  goto LAB_005487d9;
  if ((((int *)*param_1 != (int *)0x0) && (iVar9 = *(int *)*param_1, iVar9 != 0)) &&
     ((iVar6 = FUN_005458c0(param_1 + 1,*(uint *)(iVar9 + 4) & param_1[1]), -1 < iVar6 &&
      ((iVar9 = iVar9 + (iVar6 * 3 + 3) * 4, iVar9 != 0 &&
       (piVar11 = (int *)(iVar9 + 4), piVar11 != (int *)0x0)))))) {
    piVar4 = (int *)*piVar11;
    if (piVar4 != (int *)0x0) {
      *piVar4 = *piVar4 + 1;
    }
    piVar4 = (int *)*piVar7;
    if ((piVar4 != (int *)0x0) && (*piVar4 = *piVar4 + -1, *piVar4 == 0)) {
      FUN_00500860();
      FUN_00515cf0(piVar4);
    }
    *piVar7 = *piVar11;
    param_1[2] = param_1[1];
    return *piVar7;
  }
  uVar2 = *(ushort *)(param_1[1] + 0x2a);
  if ((uVar2 >> 0xb & 1) == 0) {
    if (((byte)uVar2 >> 2 & 1) != 0) {
      local_24 = CONCAT31(local_24._1_3_,*(byte *)(in_ECX + 0x141) >> 5) & 0xffffff01;
      bVar1 = *(byte *)(param_1[1] + 0x28);
      local_20 = CONCAT31(local_20._1_3_,bVar1) & 0xffffff01;
      puVar8 = (uint *)FUN_0055ef50();
      iVar9 = FUN_00544230((*puVar8 & 0xfffffffc) + 8,local_20,bVar1 >> 1 & 1,local_24,
                           ((byte)(uVar2 >> 0xc) & 1) == 0,0);
      piVar7 = (int *)*piVar7;
      if ((piVar7 != (int *)0x0) && (*piVar7 = *piVar7 + -1, *piVar7 == 0)) {
        FUN_00500860();
        FUN_00515cf0(piVar7);
      }
      param_1[3] = iVar9;
    }
    if (param_1[3] == 0) {
      if ((((char)param_2 == '\0') && ((*(byte *)(in_ECX + 0x143) & 0x10) == 0)) &&
         (*(int *)(in_ECX + 0x138) != 0)) {
        FUN_00544210(1);
        bVar1 = *(byte *)(param_1[1] + 0x28);
        uVar3 = *(undefined2 *)(param_1[1] + 0x2a);
        local_20 = CONCAT31(local_20._1_3_,bVar1 >> 1) & 0xffffff01;
        param_2 = (undefined1 *)
                  (CONCAT31(param_2._1_3_,*(byte *)(in_ECX + 0x141) >> 5) & 0xffffff01);
        puVar8 = (uint *)FUN_0055ef50();
        piVar11 = (int *)FUN_00544230((*puVar8 & 0xfffffffc) + 8,bVar1 & 1,local_20,param_2,
                                      ((byte)((ushort)uVar3 >> 0xc) & 1) == 0,local_1c);
        piVar7 = *(int **)(in_ECX + 0x14);
        if (piVar7 == (int *)0x0) {
          uVar10 = FUN_0051b6e0();
        }
        else {
          uVar10 = (**(code **)(*piVar7 + 0x24))(&local_20);
        }
        FUN_0051c600(uVar10);
        if (piVar7 == (int *)0x0) {
          FUN_0045b730();
        }
        else {
          FUN_0045b730();
        }
        param_2 = puStack_18;
        if (puStack_18 == (undefined1 *)0x0) {
          param_2 = &DAT_00cca874;
        }
        puVar8 = (uint *)FUN_0055ef50();
        FUN_00500460(*(int *)(in_ECX + 0x138) + 0xc,"Missing font \"%s\" in \"%s\". Search log:\n%s"
                     ,(*puVar8 & 0xfffffffc) + 8,(local_24 & 0xfffffffc) + 8,param_2);
        *(byte *)(in_ECX + 0x143) = *(byte *)(in_ECX + 0x143) | 0x10;
        FUN_0045b730();
        if ((piVar11 != (int *)0x0) && (*piVar11 = *piVar11 + -1, *piVar11 == 0)) {
          FUN_00500860();
          FUN_00515cf0(piVar11);
        }
        FUN_0051b3d0();
      }
      piVar7 = (int *)FUN_0055c8f0();
      goto LAB_005487ae;
    }
  }
  else {
    piVar7 = (int *)FUN_005459d0();
    if (piVar7 != (int *)0x0) {
      *piVar7 = *piVar7 + 1;
    }
LAB_005487ae:
    piVar11 = (int *)param_1[3];
    if ((piVar11 != (int *)0x0) && (*piVar11 = *piVar11 + -1, *piVar11 == 0)) {
      FUN_00500860();
      FUN_00515cf0(piVar11);
    }
    param_1[3] = (int)piVar7;
  }
  if (*param_1 != 0) {
    FUN_00548440(param_1 + 1,param_1 + 3);
  }
LAB_005487d9:
  param_1[2] = param_1[1];
  return param_1[3];
}



============================================================
DISASSEMBLY
============================================================
005484b0 : SUB ESP,0x28
005484b3 : PUSH EBX
005484b4 : MOV EBX,dword ptr [ESP + 0x30]
005484b8 : PUSH EDI
005484b9 : MOV EDI,ECX
005484bb : MOV ECX,dword ptr [EBX + 0x4]
005484be : MOV dword ptr [ESP + 0x8],0x0
005484c6 : TEST ECX,ECX
005484c8 : JNZ 0x005484d4
005484ca : POP EDI
005484cb : XOR EAX,EAX
005484cd : POP EBX
005484ce : ADD ESP,0x28
005484d1 : RET 0x8
005484d4 : CMP dword ptr [EBX + 0xc],0x0
005484d8 : PUSH ESI
005484d9 : LEA ESI,[EBX + 0xc]
005484dc : JZ 0x005484f3
005484de : MOV EAX,dword ptr [EBX + 0x8]
005484e1 : TEST EAX,EAX
005484e3 : JZ 0x005484f3
005484e5 : PUSH EAX
005484e6 : CALL 0x0055eb40
005484eb : TEST AL,AL
005484ed : JNZ 0x005487d9
005484f3 : MOV ECX,dword ptr [EBX]
005484f5 : PUSH EBP
005484f6 : TEST ECX,ECX
005484f8 : JZ 0x0054855d
005484fa : MOV EBP,dword ptr [ECX]
005484fc : TEST EBP,EBP
005484fe : JZ 0x0054855d
00548500 : MOV EDX,dword ptr [EBP + 0x4]
00548503 : AND EDX,dword ptr [EBX + 0x4]
00548506 : LEA EAX,[EBX + 0x4]
00548509 : PUSH EDX
0054850a : PUSH EAX
0054850b : CALL 0x005458c0
00548510 : TEST EAX,EAX
00548512 : JL 0x0054855d
00548514 : LEA EAX,[EAX + EAX*0x2 + 0x3]
00548518 : LEA EBP,[EBP + EAX*0x4]
0054851c : TEST EBP,EBP
0054851e : JZ 0x0054855d
00548520 : ADD EBP,0x4
00548523 : JZ 0x0054855d
00548525 : MOV EAX,dword ptr [EBP]
00548528 : TEST EAX,EAX
0054852a : JZ 0x0054852e
0054852c : INC dword ptr [EAX]
0054852e : MOV EDI,dword ptr [ESI]
00548530 : TEST EDI,EDI
00548532 : JZ 0x00548546
00548534 : ADD dword ptr [EDI],-0x1
00548537 : JNZ 0x00548546
00548539 : MOV ECX,EDI
0054853b : CALL 0x00500860
00548540 : PUSH EDI
00548541 : CALL 0x00515cf0
00548546 : MOV ECX,dword ptr [EBP]
00548549 : MOV dword ptr [ESI],ECX
0054854b : MOV EAX,dword ptr [ESI]
0054854d : MOV ECX,dword ptr [EBX + 0x4]
00548550 : POP EBP
00548551 : POP ESI
00548552 : POP EDI
00548553 : MOV dword ptr [EBX + 0x8],ECX
00548556 : POP EBX
00548557 : ADD ESP,0x28
0054855a : RET 0x8
0054855d : MOV ECX,dword ptr [EBX + 0x4]
00548560 : MOVZX EAX,word ptr [ECX + 0x2a]
00548564 : MOV EDX,EAX
00548566 : SHR EDX,0xb
00548569 : TEST DL,0x1
0054856c : JZ 0x00548585
0054856e : CALL 0x005459d0
00548573 : MOV EBP,EAX
00548575 : TEST EBP,EBP
00548577 : JZ 0x005487ae
0054857d : INC dword ptr [EBP]
00548580 : JMP 0x005487ae
00548585 : MOV EBP,dword ptr [EDI + 0x10]
00548588 : MOV DL,AL
0054858a : SHR DL,0x2
0054858d : TEST DL,0x1
00548590 : JZ 0x00548617
00548596 : SHR EAX,0xc
00548599 : AND AL,0x1
0054859b : MOV BL,AL
0054859d : MOVZX EAX,byte ptr [EDI + 0x141]
005485a4 : SHR AL,0x5
005485a7 : AND AL,0x1
005485a9 : MOV byte ptr [ESP + 0x14],AL
005485ad : MOV AL,byte ptr [ECX + 0x28]
005485b0 : MOV DL,AL
005485b2 : SHR DL,0x1
005485b4 : AND DL,0x1
005485b7 : AND AL,0x1
005485b9 : MOV byte ptr [ESP + 0x10],DL
005485bd : MOV byte ptr [ESP + 0x18],AL
005485c1 : CALL 0x0055ef50
005485c6 : MOV EAX,dword ptr [EAX]
005485c8 : AND EAX,0xfffffffc
005485cb : TEST BL,BL
005485cd : SETZ CL
005485d0 : MOVZX EDX,CL
005485d3 : MOV ECX,dword ptr [ESP + 0x14]
005485d7 : PUSH 0x0
005485d9 : PUSH EDX
005485da : MOV EDX,dword ptr [ESP + 0x18]
005485de : PUSH ECX
005485df : MOV ECX,dword ptr [ESP + 0x24]
005485e3 : PUSH EDX
005485e4 : PUSH ECX
005485e5 : ADD EAX,0x8
005485e8 : PUSH EAX
005485e9 : MOV ECX,EBP
005485eb : CALL 0x00544230
005485f0 : MOV ESI,dword ptr [ESI]
005485f2 : MOV EBX,EAX
005485f4 : TEST ESI,ESI
005485f6 : JZ 0x0054860a
005485f8 : ADD dword ptr [ESI],-0x1
005485fb : JNZ 0x0054860a
005485fd : MOV ECX,ESI
005485ff : CALL 0x00500860
00548604 : PUSH ESI
00548605 : CALL 0x00515cf0
0054860a : MOV EAX,dword ptr [ESP + 0x3c]
0054860e : ADD EAX,0xc
00548611 : MOV dword ptr [EAX],EBX
00548613 : MOV EBX,dword ptr [ESP + 0x3c]
00548617 : CMP dword ptr [EBX + 0xc],0x0
0054861b : LEA ESI,[EBX + 0xc]
0054861e : JNZ 0x005487c8
00548624 : CMP byte ptr [ESP + 0x40],0x0
00548629 : JNZ 0x005487a2
0054862f : TEST byte ptr [EDI + 0x143],0x10
00548636 : JNZ 0x005487a2
0054863c : CMP dword ptr [EDI + 0x138],0x0
00548643 : JZ 0x005487a2
00548649 : PUSH 0x1
0054864b : LEA ECX,[ESP + 0x20]
0054864f : CALL 0x00544210
00548654 : MOV ESI,dword ptr [EBX + 0x4]
00548657 : MOV DL,byte ptr [EDI + 0x141]
0054865d : LEA EAX,[EBX + 0x4]
00548660 : MOV AL,byte ptr [ESI + 0x28]
00548663 : MOV BX,word ptr [ESI + 0x2a]
00548667 : MOV CL,AL
00548669 : SHR CL,0x1
0054866b : AND CL,0x1
0054866e : SHR DL,0x5
00548671 : AND DL,0x1
00548674 : MOV byte ptr [ESP + 0x18],CL
00548678 : AND AL,0x1
0054867a : SHR BX,0xc
0054867e : MOV ECX,ESI
00548680 : AND BL,0x1
00548683 : MOV byte ptr [ESP + 0x40],DL
00548687 : MOV byte ptr [ESP + 0x10],AL
0054868b : CALL 0x0055ef50
00548690 : MOV EAX,dword ptr [EAX]
00548692 : AND EAX,0xfffffffc
00548695 : LEA EDX,[ESP + 0x1c]
00548699 : PUSH EDX
0054869a : TEST BL,BL
0054869c : SETZ CL
0054869f : MOVZX EDX,CL
005486a2 : MOV ECX,dword ptr [ESP + 0x44]
005486a6 : PUSH EDX
005486a7 : MOV EDX,dword ptr [ESP + 0x20]
005486ab : PUSH ECX
005486ac : MOV ECX,dword ptr [ESP + 0x1c]
005486b0 : PUSH EDX
005486b1 : PUSH ECX
005486b2 : ADD EAX,0x8
005486b5 : PUSH EAX
005486b6 : MOV ECX,EBP
005486b8 : CALL 0x00544230
005486bd : MOV ECX,dword ptr [EDI + 0x14]
005486c0 : MOV EBX,EAX
005486c2 : TEST ECX,ECX
005486c4 : JZ 0x005486dc
005486c6 : MOV EDX,dword ptr [ECX]
005486c8 : MOV EDX,dword ptr [EDX + 0x24]
005486cb : LEA EAX,[ESP + 0x18]
005486cf : PUSH EAX
005486d0 : MOV dword ptr [ESP + 0x14],0x1
005486d8 : CALL EDX
005486da : JMP 0x005486ed
005486dc : LEA ECX,[ESP + 0x40]
005486e0 : MOV dword ptr [ESP + 0x10],0x2
005486e8 : CALL 0x0051b6e0
005486ed : PUSH EAX
005486ee : LEA ECX,[ESP + 0x18]
005486f2 : CALL 0x0051c600
005486f7 : TEST byte ptr [ESP + 0x10],0x2
005486fc : JZ 0x0054870c
005486fe : AND dword ptr [ESP + 0x10],0xfffffffd
00548703 : LEA ECX,[ESP + 0x40]
00548707 : CALL 0x0045b730
0054870c : TEST byte ptr [ESP + 0x10],0x1
00548711 : JZ 0x0054871c
00548713 : LEA ECX,[ESP + 0x18]
00548717 : CALL 0x0045b730
0054871c : MOV EAX,dword ptr [ESP + 0x20]
00548720 : MOV dword ptr [ESP + 0x40],EAX
00548724 : TEST EAX,EAX
00548726 : JNZ 0x00548730
00548728 : MOV dword ptr [ESP + 0x40],0xcca874
00548730 : MOV EAX,dword ptr [ESP + 0x3c]
00548734 : MOV ESI,dword ptr [ESP + 0x14]
00548738 : MOV ECX,dword ptr [EAX + 0x4]
0054873b : ADD EAX,0x4
0054873e : AND ESI,0xfffffffc
00548741 : CALL 0x0055ef50
00548746 : MOV EDX,dword ptr [EAX]
00548748 : MOV ECX,dword ptr [ESP + 0x40]
0054874c : MOV EAX,dword ptr [EDI + 0x138]
00548752 : PUSH ECX
00548753 : AND EDX,0xfffffffc
00548756 : ADD ESI,0x8
00548759 : PUSH ESI
0054875a : ADD EDX,0x8
0054875d : PUSH EDX
0054875e : ADD EAX,0xc
00548761 : PUSH 0xb8be48
00548766 : PUSH EAX
00548767 : CALL 0x00500460
0054876c : OR byte ptr [EDI + 0x143],0x10
00548773 : ADD ESP,0x14
00548776 : LEA ECX,[ESP + 0x14]
0054877a : CALL 0x0045b730
0054877f : TEST EBX,EBX
00548781 : JZ 0x00548795
00548783 : ADD dword ptr [EBX],-0x1
00548786 : JNZ 0x00548795
00548788 : MOV ECX,EBX
0054878a : CALL 0x00500860
0054878f : PUSH EBX
00548790 : CALL 0x00515cf0
00548795 : LEA ECX,[ESP + 0x20]
00548799 : CALL 0x0051b3d0
0054879e : MOV EBX,dword ptr [ESP + 0x3c]
005487a2 : MOV ECX,EBP
005487a4 : CALL 0x0055c8f0
005487a9 : MOV EBP,EAX
005487ab : LEA ESI,[EBX + 0xc]
005487ae : MOV EDI,dword ptr [ESI]
005487b0 : TEST EDI,EDI
005487b2 : JZ 0x005487c6
005487b4 : ADD dword ptr [EDI],-0x1
005487b7 : JNZ 0x005487c6
005487b9 : MOV ECX,EDI
005487bb : CALL 0x00500860
005487c0 : PUSH EDI
005487c1 : CALL 0x00515cf0
005487c6 : MOV dword ptr [ESI],EBP
005487c8 : MOV ECX,dword ptr [EBX]
005487ca : TEST ECX,ECX
005487cc : JZ 0x005487d8
005487ce : PUSH ESI
005487cf : LEA EAX,[EBX + 0x4]
005487d2 : PUSH EAX
005487d3 : CALL 0x00548440
005487d8 : POP EBP
005487d9 : MOV EAX,dword ptr [ESI]
005487db : MOV ECX,dword ptr [EBX + 0x4]
005487de : POP ESI
005487df : POP EDI
005487e0 : MOV dword ptr [EBX + 0x8],ECX
005487e3 : POP EBX
005487e4 : ADD ESP,0x28
005487e7 : RET 0x8
