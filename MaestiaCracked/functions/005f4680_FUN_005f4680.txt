PROGRAM  : Maestia.exe
FUNCTION : FUN_005f4680
ENTRY    : 005f4680
BODY     : [[005f4680, 005f4799]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_005f4680(uint param_1,undefined4 param_2)

{
  int *piVar1;
  ulonglong uVar2;
  short sVar3;
  uint uVar4;
  undefined4 *puVar5;
  undefined4 uVar6;
  int in_ECX;
  short *psVar7;
  int iVar8;
  uint uVar9;
  
  uVar4 = *(uint *)(in_ECX + 0x88);
  if (((uVar4 == 0) || (*(ushort *)(uVar4 * 0x30 + -0x2a + *(int *)(in_ECX + 0x78)) < param_1)) &&
     (uVar4 < *(uint *)(in_ECX + 0x7c))) {
    uVar2 = (ulonglong)uVar4 % (ulonglong)*(uint *)(in_ECX + 0x18);
    psVar7 = (short *)(uVar4 * 0x30 + *(int *)(in_ECX + 0x78));
    *psVar7 = *(short *)(in_ECX + 4) + (short)(uVar4 / *(uint *)(in_ECX + 0x18));
    sVar3 = *(short *)(in_ECX + 0x14) * (short)uVar2;
    psVar7[1] = sVar3;
    if ((int)uVar2 + 1 == *(int *)(in_ECX + 0x18)) {
      sVar3 = (short)*(undefined4 *)(in_ECX + 0x10) - sVar3;
    }
    else {
      sVar3 = (short)*(undefined4 *)(in_ECX + 0x14);
    }
    psVar7[2] = sVar3;
    psVar7[3] = *(short *)(in_ECX + 0xc);
    *(short **)(psVar7 + 10) = psVar7 + 4;
    *(short **)(psVar7 + 0xc) = psVar7 + 4;
    *(int *)(in_ECX + 0x88) = *(int *)(in_ECX + 0x88) + 1;
  }
  iVar8 = *(int *)(in_ECX + 0x88) * 0x30;
  uVar4 = (uint)*(ushort *)(*(int *)(in_ECX + 0x78) + -0x2a + iVar8);
  iVar8 = *(int *)(in_ECX + 0x78) + -0x30 + iVar8;
  if (param_1 <= uVar4) {
    uVar9 = uVar4;
    if (param_1 <= uVar4 - param_1) {
      uVar9 = param_1;
    }
    puVar5 = (undefined4 *)FUN_005f2b40(iVar8,*(int *)(in_ECX + 0xc) - uVar4,uVar9);
    *(short *)(iVar8 + 6) = *(short *)(iVar8 + 6) - *(short *)(puVar5 + 9);
    *puVar5 = *(undefined4 *)(in_ECX + 0x30);
    piVar1 = (int *)(in_ECX + 0x30);
    puVar5[1] = piVar1;
    *(undefined4 **)(*piVar1 + 4) = puVar5;
    *piVar1 = (int)puVar5;
    *(int *)(in_ECX + 0x38) = *(int *)(in_ECX + 0x38) + 1;
    uVar6 = *(undefined4 *)(iVar8 + 0x14);
    puVar5[4] = iVar8 + 8;
    puVar5[3] = uVar6;
    *(undefined4 **)(*(int *)(iVar8 + 0x14) + 0x10) = puVar5;
    *(undefined4 **)(iVar8 + 0x14) = puVar5;
    uVar6 = *(undefined4 *)(in_ECX + 0x54);
    puVar5[5] = in_ECX + 0x3c;
    puVar5[6] = uVar6;
    *(undefined4 **)(*(int *)(in_ECX + 0x54) + 0x14) = puVar5;
    *(undefined4 **)(in_ECX + 0x54) = puVar5;
    uVar6 = FUN_005f4550(param_1,param_2,puVar5);
    return uVar6;
  }
  return 0;
}



============================================================
DISASSEMBLY
============================================================
005f4680 : PUSH EBX
005f4681 : MOV EBX,dword ptr [ESP + 0x8]
005f4685 : PUSH ESI
005f4686 : MOV ESI,ECX
005f4688 : MOV ECX,dword ptr [ESI + 0x88]
005f468e : PUSH EDI
005f468f : TEST ECX,ECX
005f4691 : JZ 0x005f46a5
005f4693 : MOV EDX,dword ptr [ESI + 0x78]
005f4696 : LEA EAX,[ECX + ECX*0x2]
005f4699 : SHL EAX,0x4
005f469c : MOVZX EAX,word ptr [EAX + EDX*0x1 + -0x2a]
005f46a1 : CMP EAX,EBX
005f46a3 : JNC 0x005f4700
005f46a5 : CMP ECX,dword ptr [ESI + 0x7c]
005f46a8 : JNC 0x005f4700
005f46aa : MOV EDI,dword ptr [ESI + 0x18]
005f46ad : MOV EAX,ECX
005f46af : XOR EDX,EDX
005f46b1 : DIV EDI
005f46b3 : MOV DI,word ptr [ESI + 0x4]
005f46b7 : LEA ECX,[ECX + ECX*0x2]
005f46ba : SHL ECX,0x4
005f46bd : ADD ECX,dword ptr [ESI + 0x78]
005f46c0 : ADD DI,AX
005f46c3 : MOV word ptr [ECX],DI
005f46c6 : MOV AX,word ptr [ESI + 0x14]
005f46ca : IMUL AX,DX
005f46ce : INC EDX
005f46cf : MOV word ptr [ECX + 0x2],AX
005f46d3 : CMP EDX,dword ptr [ESI + 0x18]
005f46d6 : JNZ 0x005f46e2
005f46d8 : MOVZX EDX,AX
005f46db : MOV EAX,dword ptr [ESI + 0x10]
005f46de : SUB EAX,EDX
005f46e0 : JMP 0x005f46e5
005f46e2 : MOV EAX,dword ptr [ESI + 0x14]
005f46e5 : MOV word ptr [ECX + 0x4],AX
005f46e9 : MOV AX,word ptr [ESI + 0xc]
005f46ed : MOV word ptr [ECX + 0x6],AX
005f46f1 : LEA EAX,[ECX + 0x8]
005f46f4 : MOV dword ptr [EAX + 0xc],EAX
005f46f7 : MOV dword ptr [EAX + 0x10],EAX
005f46fa : INC dword ptr [ESI + 0x88]
005f4700 : MOV EAX,dword ptr [ESI + 0x88]
005f4706 : MOV EDX,dword ptr [ESI + 0x78]
005f4709 : LEA ECX,[EAX + EAX*0x2]
005f470c : SHL ECX,0x4
005f470f : MOVZX EAX,word ptr [EDX + ECX*0x1 + -0x2a]
005f4714 : LEA EDI,[EDX + ECX*0x1 + -0x30]
005f4718 : CMP EBX,EAX
005f471a : JA 0x005f4792
005f471c : MOV ECX,EAX
005f471e : SUB ECX,EBX
005f4720 : CMP ECX,EBX
005f4722 : MOV ECX,EAX
005f4724 : JC 0x005f4728
005f4726 : MOV ECX,EBX
005f4728 : MOV EDX,dword ptr [ESI + 0xc]
005f472b : PUSH ECX
005f472c : SUB EDX,EAX
005f472e : PUSH EDX
005f472f : PUSH EDI
005f4730 : MOV ECX,ESI
005f4732 : CALL 0x005f2b40
005f4737 : MOV CX,word ptr [EAX + 0x24]
005f473b : SUB word ptr [EDI + 0x6],CX
005f473f : MOV EDX,dword ptr [ESI + 0x30]
005f4742 : MOV dword ptr [EAX],EDX
005f4744 : LEA ECX,[ESI + 0x30]
005f4747 : MOV dword ptr [EAX + 0x4],ECX
005f474a : MOV EDX,dword ptr [ECX]
005f474c : MOV dword ptr [EDX + 0x4],EAX
005f474f : MOV dword ptr [ECX],EAX
005f4751 : INC dword ptr [ESI + 0x38]
005f4754 : MOV EDX,dword ptr [EDI + 0x14]
005f4757 : LEA ECX,[EDI + 0x8]
005f475a : MOV dword ptr [EAX + 0x10],ECX
005f475d : MOV dword ptr [EAX + 0xc],EDX
005f4760 : MOV EDX,dword ptr [ECX + 0xc]
005f4763 : MOV dword ptr [EDX + 0x10],EAX
005f4766 : MOV dword ptr [ECX + 0xc],EAX
005f4769 : MOV EDX,dword ptr [ESI + 0x54]
005f476c : LEA ECX,[ESI + 0x3c]
005f476f : MOV dword ptr [EAX + 0x14],ECX
005f4772 : MOV dword ptr [EAX + 0x18],EDX
005f4775 : MOV EDX,dword ptr [ECX + 0x18]
005f4778 : MOV dword ptr [EDX + 0x14],EAX
005f477b : PUSH EAX
005f477c : MOV dword ptr [ECX + 0x18],EAX
005f477f : MOV EAX,dword ptr [ESP + 0x18]
005f4783 : PUSH EAX
005f4784 : PUSH EBX
005f4785 : MOV ECX,ESI
005f4787 : CALL 0x005f4550
005f478c : POP EDI
005f478d : POP ESI
005f478e : POP EBX
005f478f : RET 0x8
005f4792 : POP EDI
005f4793 : POP ESI
005f4794 : XOR EAX,EAX
005f4796 : POP EBX
005f4797 : RET 0x8
