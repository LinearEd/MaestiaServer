PROGRAM  : Maestia.exe
FUNCTION : FUN_005519d0
ENTRY    : 005519d0
BODY     : [[005519d0, 00551c05]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_005519d0(int param_1,int *param_2)

{
  uint *puVar1;
  int iVar2;
  undefined4 *puVar3;
  GRefCountNTSImpl *this;
  int in_ECX;
  GRefCountNTSImpl *unaff_EBX;
  int *unaff_EBP;
  int iVar4;
  undefined4 unaff_retaddr;
  undefined1 auStack_60 [8];
  int local_58;
  undefined1 auStack_50 [12];
  undefined1 local_44 [4];
  undefined1 auStack_40 [4];
  int iStack_3c;
  undefined **ppuStack_30;
  undefined1 *puStack_2c;
  GRefCountNTSImpl *pGStack_28;
  undefined4 uStack_24;
  undefined4 uStack_20;
  undefined1 uStack_1c;
  undefined4 uStack_18;
  undefined4 uStack_14;
  int iStack_10;
  undefined4 uStack_8;
  undefined1 uStack_4;
  
  local_58 = in_ECX + 0x10;
  local_44[0] = 0;
  (**(code **)(*(int *)(in_ECX + 0x10) + 0x10))(param_1,param_2,local_44);
  auStack_60[0] = 0;
  if (*(byte *)(param_1 + 0x7c) < 7) {
    puVar3 = (undefined4 *)FUN_00550e90(param_2);
  }
  else {
    iVar4 = **(int **)(in_ECX + 0x28);
    if (iVar4 == 0) goto LAB_00551be8;
    uStack_4 = 0;
    iVar2 = FUN_0054f420(param_2,*(uint *)(*param_2 + 0xc) & *(uint *)(iVar4 + 4));
    if ((iVar2 < 0) || (iVar4 = iVar4 + 0xc + iVar2 * 0x24, iVar4 == 0)) goto LAB_00551be8;
    puVar3 = (undefined4 *)(iVar4 + 4);
  }
  if ((puVar3 != (undefined4 *)0x0) && (unaff_EBP[10] != 0)) {
    *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + 0x10;
    puVar1 = (uint *)(param_1 + 8);
    if (*(uint *)(param_1 + 0x10) <= *(uint *)(param_1 + 8)) {
      FUN_00504050();
    }
    if (*puVar1 != 0) {
      FUN_005266c0(puVar3 + 3);
    }
    *puVar1 = *puVar1 + 0x10;
    if (*(uint *)(param_1 + 0x10) <= *puVar1) {
      FUN_00504050();
    }
    if (*puVar1 != 0) {
      FUN_005266c0(unaff_retaddr);
    }
    *puVar1 = *puVar1 + 0x10;
    if (*(uint *)(param_1 + 0x10) <= *puVar1) {
      FUN_00504050();
    }
    if (*puVar1 != 0) {
      FUN_005266c0(auStack_50);
    }
    iStack_3c = *param_2;
    auStack_40[0] = 5;
    *(int *)(iStack_3c + 8) = *(int *)(iStack_3c + 8) + 1;
    *puVar1 = *puVar1 + 0x10;
    if (*(uint *)(param_1 + 0x10) <= *puVar1) {
      FUN_00504050();
    }
    if (*puVar1 != 0) {
      FUN_005266c0(auStack_40);
    }
    FUN_00526bc0();
    this = (GRefCountNTSImpl *)(**(code **)(*unaff_EBP + 0x1c))();
    if (this != (GRefCountNTSImpl *)0x0) {
      *(int *)(this + 4) = *(int *)(this + 4) + 1;
      unaff_EBX = this + 0x68;
    }
    iStack_10 = ((int)(*puVar1 - *(int *)(param_1 + 0xc)) >> 4) + -0x20 +
                *(int *)(param_1 + 0x1c) * 0x20;
    puStack_2c = auStack_60;
    uStack_1c = 0;
    uStack_24 = 0;
    uStack_20 = 0;
    uStack_18 = uStack_8;
    iVar4 = 4;
    ppuStack_30 = &PTR_FUN_00b8ab5c;
    uStack_14 = 4;
    pGStack_28 = unaff_EBX;
    (**(code **)(*(int *)*puVar3 + 0x28))(&ppuStack_30,puVar3[1],0);
    FUN_0051fbd0();
    do {
      FUN_00526bc0();
      *puVar1 = *puVar1 - 0x10;
      if (*puVar1 < *(uint *)(param_1 + 0xc)) {
        FUN_00504f30();
      }
      iVar4 = iVar4 + -1;
    } while (iVar4 != 0);
    FUN_005268b0(&stack0xffffff94);
    if (this != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(this);
    }
    FUN_00526bc0();
    FUN_00526bc0();
    return 1;
  }
LAB_00551be8:
  FUN_00526bc0();
  FUN_00526bc0();
  return 0;
}



============================================================
DISASSEMBLY
============================================================
005519d0 : SUB ESP,0x60
005519d3 : PUSH EBX
005519d4 : PUSH EBP
005519d5 : MOV EBP,dword ptr [ESP + 0x6c]
005519d9 : PUSH ESI
005519da : PUSH EDI
005519db : MOV EDI,dword ptr [ESP + 0x78]
005519df : MOV ESI,ECX
005519e1 : MOV EAX,dword ptr [ESI + 0x10]
005519e4 : MOV EAX,dword ptr [EAX + 0x10]
005519e7 : LEA EDX,[ESP + 0x2c]
005519eb : LEA ECX,[ESI + 0x10]
005519ee : PUSH EDX
005519ef : PUSH EDI
005519f0 : PUSH EBP
005519f1 : MOV dword ptr [ESP + 0x20],ESI
005519f5 : MOV byte ptr [ESP + 0x38],0x0
005519fa : MOV dword ptr [ESP + 0x24],ECX
005519fe : CALL EAX
00551a00 : CMP byte ptr [EBP + 0x7c],0x6
00551a04 : MOV ECX,dword ptr [ESI + 0x28]
00551a07 : MOV byte ptr [ESP + 0x1c],0x0
00551a0c : JBE 0x00551a4d
00551a0e : MOV ESI,dword ptr [ECX]
00551a10 : TEST ESI,ESI
00551a12 : JZ 0x00551be8
00551a18 : MOV EDX,dword ptr [EDI]
00551a1a : MOV EAX,dword ptr [EDX + 0xc]
00551a1d : AND EAX,dword ptr [ESI + 0x4]
00551a20 : MOV byte ptr [ESP + 0x78],0x0
00551a25 : PUSH EAX
00551a26 : PUSH EDI
00551a27 : MOV byte ptr [ESP + 0x1b],0x0
00551a2c : CALL 0x0054f420
00551a31 : TEST EAX,EAX
00551a33 : JL 0x00551be8
00551a39 : LEA ECX,[EAX + EAX*0x8]
00551a3c : LEA EAX,[ESI + ECX*0x4 + 0xc]
00551a40 : TEST EAX,EAX
00551a42 : JZ 0x00551be8
00551a48 : LEA EBX,[EAX + 0x4]
00551a4b : JMP 0x00551a55
00551a4d : PUSH EDI
00551a4e : CALL 0x00550e90
00551a53 : MOV EBX,EAX
00551a55 : TEST EBX,EBX
00551a57 : JZ 0x00551be8
00551a5d : MOV EDX,dword ptr [ESP + 0x14]
00551a61 : CMP dword ptr [EDX + 0x28],0x0
00551a65 : JZ 0x00551be8
00551a6b : ADD dword ptr [EBP + 0x8],0x10
00551a6f : MOV EAX,dword ptr [EBP + 0x8]
00551a72 : CMP EAX,dword ptr [EBP + 0x10]
00551a75 : LEA ESI,[EBP + 0x8]
00551a78 : JC 0x00551a81
00551a7a : MOV ECX,ESI
00551a7c : CALL 0x00504050
00551a81 : MOV ECX,dword ptr [ESI]
00551a83 : TEST ECX,ECX
00551a85 : JZ 0x00551a90
00551a87 : LEA EAX,[EBX + 0xc]
00551a8a : PUSH EAX
00551a8b : CALL 0x005266c0
00551a90 : ADD dword ptr [ESI],0x10
00551a93 : MOV EAX,dword ptr [ESI]
00551a95 : CMP EAX,dword ptr [ESI + 0x8]
00551a98 : JC 0x00551aa1
00551a9a : MOV ECX,ESI
00551a9c : CALL 0x00504050
00551aa1 : MOV ECX,dword ptr [ESI]
00551aa3 : TEST ECX,ECX
00551aa5 : JZ 0x00551ab1
00551aa7 : MOV EDX,dword ptr [ESP + 0x7c]
00551aab : PUSH EDX
00551aac : CALL 0x005266c0
00551ab1 : ADD dword ptr [ESI],0x10
00551ab4 : MOV EAX,dword ptr [ESI]
00551ab6 : CMP EAX,dword ptr [ESI + 0x8]
00551ab9 : JC 0x00551ac2
00551abb : MOV ECX,ESI
00551abd : CALL 0x00504050
00551ac2 : MOV ECX,dword ptr [ESI]
00551ac4 : TEST ECX,ECX
00551ac6 : JZ 0x00551ad2
00551ac8 : LEA EAX,[ESP + 0x2c]
00551acc : PUSH EAX
00551acd : CALL 0x005266c0
00551ad2 : MOV EAX,dword ptr [EDI]
00551ad4 : MOV dword ptr [ESP + 0x40],EAX
00551ad8 : MOV EDI,0x1
00551add : MOV byte ptr [ESP + 0x3c],0x5
00551ae2 : ADD dword ptr [EAX + 0x8],EDI
00551ae5 : ADD dword ptr [ESI],0x10
00551ae8 : MOV EAX,dword ptr [ESI]
00551aea : CMP EAX,dword ptr [ESI + 0x8]
00551aed : JC 0x00551af6
00551aef : MOV ECX,ESI
00551af1 : CALL 0x00504050
00551af6 : MOV ECX,dword ptr [ESI]
00551af8 : TEST ECX,ECX
00551afa : JZ 0x00551b06
00551afc : LEA EDX,[ESP + 0x3c]
00551b00 : PUSH EDX
00551b01 : CALL 0x005266c0
00551b06 : LEA ECX,[ESP + 0x3c]
00551b0a : CALL 0x00526bc0
00551b0f : MOV ECX,dword ptr [ESP + 0x14]
00551b13 : MOV EAX,dword ptr [ECX]
00551b15 : MOV EDX,dword ptr [EAX + 0x1c]
00551b18 : CALL EDX
00551b1a : MOV EBP,EAX
00551b1c : XOR EDX,EDX
00551b1e : CMP EBP,EDX
00551b20 : JZ 0x00551b2a
00551b22 : ADD dword ptr [EBP + 0x4],EDI
00551b25 : LEA ECX,[EBP + 0x68]
00551b28 : JMP 0x00551b2e
00551b2a : MOV ECX,dword ptr [ESP + 0x18]
00551b2e : MOV EAX,dword ptr [ESI]
00551b30 : SUB EAX,dword ptr [ESI + 0x4]
00551b33 : MOV EDI,dword ptr [ESI + 0x14]
00551b36 : SAR EAX,0x4
00551b39 : SHL EDI,0x5
00551b3c : LEA EAX,[EAX + EDI*0x1 + -0x20]
00551b40 : MOV dword ptr [ESP + 0x54],ECX
00551b44 : MOV ECX,dword ptr [ESP + 0x74]
00551b48 : PUSH EDX
00551b49 : LEA EDI,[ESP + 0x20]
00551b4d : MOV byte ptr [ESP + 0x64],DL
00551b51 : MOV dword ptr [ESP + 0x5c],EDX
00551b55 : MOV dword ptr [ESP + 0x60],EDX
00551b59 : MOV EDX,dword ptr [EBX + 0x4]
00551b5c : MOV dword ptr [ESP + 0x54],EDI
00551b60 : MOV dword ptr [ESP + 0x68],ECX
00551b64 : MOV ECX,dword ptr [EBX]
00551b66 : MOV EDI,0x4
00551b6b : MOV dword ptr [ESP + 0x70],EAX
00551b6f : PUSH EDX
00551b70 : MOV dword ptr [ESP + 0x54],0xb8ab5c
00551b78 : MOV dword ptr [ESP + 0x70],EDI
00551b7c : MOV EAX,dword ptr [ECX]
00551b7e : MOV EAX,dword ptr [EAX + 0x28]
00551b81 : LEA EDX,[ESP + 0x54]
00551b85 : PUSH EDX
00551b86 : CALL EAX
00551b88 : LEA ECX,[ESP + 0x4c]
00551b8c : CALL 0x0051fbd0
00551b91 : MOV ECX,dword ptr [ESI]
00551b93 : CALL 0x00526bc0
00551b98 : ADD dword ptr [ESI],-0x10
00551b9b : MOV EAX,dword ptr [ESI]
00551b9d : CMP EAX,dword ptr [ESI + 0x4]
00551ba0 : JNC 0x00551ba9
00551ba2 : MOV ECX,ESI
00551ba4 : CALL 0x00504f30
00551ba9 : SUB EDI,0x1
00551bac : JNZ 0x00551b91
00551bae : LEA ECX,[ESP + 0x1c]
00551bb2 : PUSH ECX
00551bb3 : MOV ECX,dword ptr [ESP + 0x84]
00551bba : CALL 0x005268b0
00551bbf : TEST EBP,EBP
00551bc1 : JZ 0x00551bca
00551bc3 : MOV ECX,EBP
00551bc5 : CALL 0x004ff7c0
00551bca : LEA ECX,[ESP + 0x1c]
00551bce : CALL 0x00526bc0
00551bd3 : LEA ECX,[ESP + 0x2c]
00551bd7 : CALL 0x00526bc0
00551bdc : POP EDI
00551bdd : POP ESI
00551bde : POP EBP
00551bdf : MOV AL,0x1
00551be1 : POP EBX
00551be2 : ADD ESP,0x60
00551be5 : RET 0x10
00551be8 : LEA ECX,[ESP + 0x1c]
00551bec : CALL 0x00526bc0
00551bf1 : LEA ECX,[ESP + 0x2c]
00551bf5 : CALL 0x00526bc0
00551bfa : POP EDI
00551bfb : POP ESI
00551bfc : POP EBP
00551bfd : XOR AL,AL
00551bff : POP EBX
00551c00 : ADD ESP,0x60
00551c03 : RET 0x10
