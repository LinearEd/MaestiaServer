PROGRAM  : Maestia.exe
FUNCTION : FUN_00704ce0
ENTRY    : 00704ce0
BODY     : [[00704ce0, 00704f40] [00704f4b, 00704f95]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void FUN_00704ce0(wchar_t *param_1)

{
  uint uVar1;
  int iVar2;
  FILE *_File;
  char *pcVar3;
  int iVar4;
  int local_f50;
  short local_f4c;
  WCHAR local_f38 [256];
  char local_d38;
  undefined1 local_d37 [1023];
  CHAR local_938 [1024];
  wchar_t local_538;
  undefined1 local_536 [1022];
  wchar_t local_138;
  undefined1 local_136 [254];
  wchar_t local_38 [16];
  uint local_18;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b47687;
  local_10 = ExceptionList;
  uVar1 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_38[9] = L'\0';
  local_38[10] = L'\0';
  local_38[0xb] = L'\0';
  local_38[0xc] = L'\0';
  local_38[0xd] = L'\0';
  local_38[0xe] = L'\0';
  local_38[0xf] = 0;
  local_18 = uVar1;
  _memset(local_536,0,0x3fe);
  _memset(local_136,0,0xfe);
  local_38[1] = L'\0';
  local_38[2] = L'\0';
  local_38[3] = L'\0';
  local_38[4] = L'\0';
  local_38[5] = L'\0';
  local_38[6] = L'\0';
  local_38[7] = 0;
  local_38[0] = L'\0';
  local_138 = L'\0';
  local_538 = L'\0';
  local_38[8] = 0;
  if (param_1 == (wchar_t *)0x0) {
    iVar2 = FUN_006f0760(0x58,"",0,(DAT_01725270 >> 3 & 1) == 0,uVar1);
    local_8 = 0;
    if (iVar2 == 0) {
      local_8 = 0xffffffff;
      uRam00000050 = 1;
    }
    else {
      iVar2 = FUN_00704070(iVar2,1);
      local_8 = 0xffffffff;
      *(undefined4 *)(iVar2 + 0x50) = 1;
    }
  }
  else {
    __wsplitpath(param_1,local_38 + 8,&local_538,&local_138,local_38);
    GetCurrentDirectoryW(0x100,local_f38);
    _File = __wfopen(param_1,(wchar_t *)&PTR_LAB_00bfbc90);
    if (_File != (FILE *)0x0) {
      local_d38 = '\0';
      _memset(local_d37,0,0x3ff);
      pcVar3 = _fgets(&local_d38,0x400,_File);
      if (pcVar3 != (char *)0x0) {
        iVar2 = FUN_00703b70();
        if (iVar2 != 0) {
          if (local_f50 == 0x3040207) {
            iVar2 = FUN_006f0300(0x58);
            local_8 = 1;
            if (iVar2 == 0) {
              iVar2 = 0;
            }
            else {
              iVar2 = FUN_00704070(iVar2,local_f4c == 1);
            }
            local_8 = 0xffffffff;
            if (iVar2 != 0) {
              iVar4 = FUN_00704400(iVar2);
              if (iVar4 == 0) {
                FUN_006ee470(L"[GBD] GBD file is invalid, GBD engine version mismatch");
                FUN_00703d80(iVar2);
                    /* WARNING: Subroutine does not return */
                FUN_006f04e0();
              }
              _wcscpy_s((wchar_t *)&DAT_00d8ad08,0x104,param_1);
              _DAT_00da9b44 = GetTickCount();
            }
          }
          else {
            _memset(local_938,0,0x400);
            FUN_00411b70("GBD engine is invalid version [ Engine Version=0x%08x ][ File Version=0x%08x ]\n\nYou must update three projects ( AvNet, JlUtil, AvBaseData ) \nin Avatars Server source from visual source safe\n\nOR\n\nYou must download three files ( GbdVersion.txt, mytholoy.gbd, mytholoy_debug.gbd )\nFrom \\192.168.10.6\\TS Project Team\\Share Program\\GBD \n"
                         ,0x3040207,local_f50);
            MessageBoxA((HWND)0x0,local_938,"Engine version Mismatch",0x10);
          }
        }
        _fclose(_File);
      }
    }
  }
  ExceptionList = local_10;
  __security_check_cookie(local_18 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00704ce0 : PUSH EBP
00704ce1 : MOV EBP,ESP
00704ce3 : PUSH -0x1
00704ce5 : PUSH 0xb47687
00704cea : MOV EAX,FS:[0x0]
00704cf0 : PUSH EAX
00704cf1 : SUB ESP,0xf48
00704cf7 : MOV EAX,[0x00d66fa0]
00704cfc : XOR EAX,EBP
00704cfe : MOV dword ptr [EBP + -0x14],EAX
00704d01 : PUSH EBX
00704d02 : PUSH ESI
00704d03 : PUSH EDI
00704d04 : PUSH EAX
00704d05 : LEA EAX,[EBP + -0xc]
00704d08 : MOV FS:[0x0],EAX
00704d0e : MOV EBX,dword ptr [EBP + 0x8]
00704d11 : XOR ESI,ESI
00704d13 : PUSH 0x3fe
00704d18 : LEA EAX,[EBP + 0xffffface]
00704d1e : PUSH ESI
00704d1f : PXOR XMM0,XMM0
00704d23 : PUSH EAX
00704d24 : MOVQ qword ptr [EBP + -0x22],XMM0
00704d29 : MOV dword ptr [EBP + -0x1a],ESI
00704d2c : MOV word ptr [EBP + -0x16],SI
00704d30 : CALL 0x0063b700
00704d35 : ADD ESP,0xc
00704d38 : PUSH 0xfe
00704d3d : LEA ECX,[EBP + 0xfffffece]
00704d43 : PUSH ESI
00704d44 : PUSH ECX
00704d45 : CALL 0x0063b700
00704d4a : XOR EDX,EDX
00704d4c : XOR EAX,EAX
00704d4e : XOR ECX,ECX
00704d50 : ADD ESP,0xc
00704d53 : PXOR XMM0,XMM0
00704d57 : MOVQ qword ptr [EBP + -0x32],XMM0
00704d5c : MOV dword ptr [EBP + -0x2a],ESI
00704d5f : MOV word ptr [EBP + -0x26],SI
00704d63 : MOV word ptr [EBP + -0x34],DX
00704d67 : MOV word ptr [EBP + 0xfffffecc],AX
00704d6e : MOV word ptr [EBP + 0xfffffacc],CX
00704d75 : MOV word ptr [EBP + -0x24],DX
00704d79 : CMP EBX,ESI
00704d7b : JZ 0x00704d9c
00704d7d : LEA EAX,[EBP + -0x34]
00704d80 : PUSH EAX
00704d81 : LEA ECX,[EBP + 0xfffffecc]
00704d87 : PUSH ECX
00704d88 : LEA EDX,[EBP + 0xfffffacc]
00704d8e : PUSH EDX
00704d8f : LEA EAX,[EBP + -0x24]
00704d92 : PUSH EAX
00704d93 : PUSH EBX
00704d94 : CALL 0x00636e00
00704d99 : ADD ESP,0x14
00704d9c : MOV dword ptr [EBP + 0xfffff0c8],ESI
00704da2 : CMP EBX,ESI
00704da4 : JNZ 0x00704e05
00704da6 : MOV ECX,dword ptr [0x01725270]
00704dac : SHR ECX,0x3
00704daf : MOV EDX,ESI
00704db1 : AND ECX,0x1
00704db4 : SETZ DL
00704db7 : PUSH EDX
00704db8 : PUSH ESI
00704db9 : PUSH 0xbf1a4a
00704dbe : PUSH 0x58
00704dc0 : CALL 0x006f0760
00704dc5 : ADD ESP,0x10
00704dc8 : MOV dword ptr [EBP + 0xfffff0c8],EAX
00704dce : MOV dword ptr [EBP + -0x4],ESI
00704dd1 : CMP EAX,ESI
00704dd3 : JZ 0x00704df0
00704dd5 : PUSH 0x1
00704dd7 : PUSH EAX
00704dd8 : CALL 0x00704070
00704ddd : MOV dword ptr [EBP + -0x4],0xffffffff
00704de4 : MOV dword ptr [EAX + 0x50],0x1
00704deb : JMP 0x00704f5a
00704df0 : XOR EAX,EAX
00704df2 : MOV dword ptr [EBP + -0x4],0xffffffff
00704df9 : MOV dword ptr [EAX + 0x50],0x1
00704e00 : JMP 0x00704f5a
00704e05 : LEA EAX,[EBP + 0xfffff0cc]
00704e0b : PUSH EAX
00704e0c : PUSH 0x100
00704e11 : CALL dword ptr [0x00b851d4]
00704e17 : PUSH 0xbfbc90
00704e1c : PUSH EBX
00704e1d : CALL 0x00636404
00704e22 : MOV EDI,EAX
00704e24 : ADD ESP,0x8
00704e27 : CMP EDI,ESI
00704e29 : JNZ 0x00704e32
00704e2b : XOR EAX,EAX
00704e2d : JMP 0x00704f5a
00704e32 : PUSH 0x3ff
00704e37 : LEA ECX,[EBP + 0xfffff2cd]
00704e3d : PUSH ESI
00704e3e : PUSH ECX
00704e3f : MOV byte ptr [EBP + 0xfffff2cc],0x0
00704e46 : CALL 0x0063b700
00704e4b : ADD ESP,0xc
00704e4e : PUSH EDI
00704e4f : LEA EDX,[EBP + 0xfffff2cc]
00704e55 : PUSH 0x400
00704e5a : PUSH EDX
00704e5b : CALL 0x0063646e
00704e60 : ADD ESP,0xc
00704e63 : TEST EAX,EAX
00704e65 : JZ 0x00704e2b
00704e67 : LEA EAX,[EBP + 0xfffff0ac]
00704e6d : CALL 0x00703b70
00704e72 : TEST EAX,EAX
00704e74 : JZ 0x00704f4b
00704e7a : MOV ESI,dword ptr [EBP + 0xfffff0b4]
00704e80 : CMP ESI,0x3040207
00704e86 : JZ 0x00704ecf
00704e88 : PUSH 0x400
00704e8d : LEA EAX,[EBP + 0xfffff6cc]
00704e93 : PUSH 0x0
00704e95 : PUSH EAX
00704e96 : CALL 0x0063b700
00704e9b : ADD ESP,0xc
00704e9e : PUSH ESI
00704e9f : PUSH 0x3040207
00704ea4 : PUSH 0xbfbc98
00704ea9 : LEA EDX,[EBP + 0xfffff6cc]
00704eaf : CALL 0x00411b70
00704eb4 : ADD ESP,0xc
00704eb7 : PUSH 0x10
00704eb9 : PUSH 0xbfbde8
00704ebe : LEA ECX,[EBP + 0xfffff6cc]
00704ec4 : PUSH ECX
00704ec5 : PUSH 0x0
00704ec7 : CALL dword ptr [0x00b854c8]
00704ecd : JMP 0x00704f4b
00704ecf : PUSH 0x58
00704ed1 : CALL 0x006f0300
00704ed6 : ADD ESP,0x4
00704ed9 : MOV dword ptr [EBP + 0xfffff0c8],EAX
00704edf : MOV ESI,0x1
00704ee4 : MOV dword ptr [EBP + -0x4],ESI
00704ee7 : TEST EAX,EAX
00704ee9 : JZ 0x00704f02
00704eeb : XOR EDX,EDX
00704eed : CMP word ptr [EBP + 0xfffff0b8],SI
00704ef4 : SETZ DL
00704ef7 : PUSH EDX
00704ef8 : PUSH EAX
00704ef9 : CALL 0x00704070
00704efe : MOV ESI,EAX
00704f00 : JMP 0x00704f04
00704f02 : XOR ESI,ESI
00704f04 : MOV dword ptr [EBP + -0x4],0xffffffff
00704f0b : MOV dword ptr [EBP + 0xfffff0c8],ESI
00704f11 : TEST ESI,ESI
00704f13 : JZ 0x00704f4b
00704f15 : PUSH ESI
00704f16 : LEA ECX,[EBP + 0xfffff0ac]
00704f1c : MOV EDX,EDI
00704f1e : CALL 0x00704400
00704f23 : TEST EAX,EAX
00704f25 : JNZ 0x00704f76
00704f27 : PUSH 0xbfbfa0
00704f2c : CALL 0x006ee470
00704f31 : ADD ESP,0x4
00704f34 : PUSH ESI
00704f35 : CALL 0x00703d80
00704f3a : MOV ECX,ESI
00704f3c : CALL 0x006f04e0
00704f4b : PUSH EDI
00704f4c : CALL 0x006366db
00704f51 : MOV EAX,dword ptr [EBP + 0xfffff0c8]
00704f57 : ADD ESP,0x4
00704f5a : MOV ECX,dword ptr [EBP + -0xc]
00704f5d : MOV dword ptr FS:[0x0],ECX
00704f64 : POP ECX
00704f65 : POP EDI
00704f66 : POP ESI
00704f67 : POP EBX
00704f68 : MOV ECX,dword ptr [EBP + -0x14]
00704f6b : XOR ECX,EBP
00704f6d : CALL 0x00633e6b
00704f72 : MOV ESP,EBP
00704f74 : POP EBP
00704f75 : RET
00704f76 : PUSH EBX
00704f77 : PUSH 0x104
00704f7c : PUSH 0xd8ad08
00704f81 : CALL 0x0063481b
00704f86 : ADD ESP,0xc
00704f89 : CALL dword ptr [0x00b850d8]
00704f8f : MOV [0x00da9b44],EAX
00704f94 : JMP 0x00704f4b
