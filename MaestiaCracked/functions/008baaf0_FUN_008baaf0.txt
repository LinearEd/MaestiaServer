PROGRAM  : Maestia.exe
FUNCTION : FUN_008baaf0
ENTRY    : 008baaf0
BODY     : [[008baaf0, 008bac7c] [008bac80, 008bafa8]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008baaf0(int param_1)

{
  uint *puVar1;
  char cVar2;
  uint uVar3;
  wchar_t *_Filename;
  size_t _ElementSize;
  void *_DstBuf;
  int iVar4;
  undefined4 uVar5;
  int iVar6;
  int iVar7;
  uint local_198;
  uint local_17c;
  FILE *local_16c [2];
  undefined2 local_164;
  undefined4 local_154;
  uint local_150;
  undefined2 local_148;
  undefined4 local_138;
  uint local_134;
  undefined4 local_12c;
  undefined4 local_11c;
  uint local_118;
  char local_114 [256];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b3e5e8;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_14 = uVar3;
  FUN_008b7050(param_1);
  local_8 = 0;
  FUN_00404870(L"shipinfo.dat",0xc);
  _Filename = local_12c;
  if (local_118 < 8) {
    _Filename = (wchar_t *)&local_12c;
  }
  __wfopen_s(local_16c,_Filename,(wchar_t *)&PTR_LAB_00c4d4bc);
  if (local_16c[0] == (FILE *)0x0) {
    local_8 = 0xffffffff;
    if (7 < local_118) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0(uVar3);
    }
    uVar3 = (uint)local_12c >> 0x10;
  }
  else {
    _fseek(local_16c[0],0,2);
    _ElementSize = _ftell(local_16c[0]);
    _fseek(local_16c[0],0,0);
    _DstBuf = (void *)FUN_006f0760(_ElementSize,"",0,(DAT_01725270 >> 3 & 1) == 0);
    _fread(_DstBuf,_ElementSize,1,local_16c[0]);
    _fclose(local_16c[0]);
    iVar4 = (int)(_ElementSize + ((int)_ElementSize >> 0x1f & 3U)) >> 2;
    iVar7 = 0;
    if (0 < iVar4) {
      do {
        puVar1 = (uint *)((int)_DstBuf + iVar7 * 4);
        *puVar1 = *puVar1 ^ 0x93c684e7;
        iVar7 = iVar7 + 1;
      } while (iVar7 < iVar4);
    }
    local_134 = 7;
    local_138 = 0;
    local_148 = 0;
    local_8._1_3_ = (uint3)((uint)local_8 >> 8);
    local_150 = 7;
    iVar4 = 0;
    local_154 = 0;
    local_164 = 0;
    if (0 < (int)_ElementSize) {
      do {
        local_8._0_1_ = 2;
        iVar7 = iVar4 + 5;
        if (iVar7 < (int)_ElementSize) {
          if ((((*(char *)(iVar4 + (int)_DstBuf) == 'S') &&
               (*(char *)(iVar4 + 1 + (int)_DstBuf) == 'H')) &&
              (*(char *)(iVar4 + 2 + (int)_DstBuf) == 'I')) &&
             ((*(char *)(iVar4 + 3 + (int)_DstBuf) == 'P' &&
              (*(char *)(iVar4 + 4 + (int)_DstBuf) == ':')))) {
            _memset(local_114,0,0x100);
            iVar4 = iVar7;
            do {
              cVar2 = *(char *)(iVar4 + (int)_DstBuf);
              if ((cVar2 == '\0') || (cVar2 == '\n')) break;
              local_114[iVar4 - iVar7] = cVar2;
              iVar4 = iVar4 + 1;
            } while (iVar4 < (int)_ElementSize);
            uVar5 = FUN_00404350(local_114);
            local_8._0_1_ = 3;
            FUN_00405eb0(uVar5,0,0xffffffff);
            local_8._0_1_ = 2;
            if (7 < local_198) {
                    /* WARNING: Subroutine does not return */
              FUN_006f04e0();
            }
            local_198 = 7;
          }
          else {
            if (((((int)_ElementSize <= iVar7) ||
                 ((*(char *)(iVar4 + (int)_DstBuf) != 'T' ||
                  (*(char *)(iVar4 + 1 + (int)_DstBuf) != 'A')))) ||
                (*(char *)(iVar4 + 2 + (int)_DstBuf) != 'R')) ||
               ((*(char *)(iVar4 + 3 + (int)_DstBuf) != 'G' ||
                (*(char *)(iVar4 + 4 + (int)_DstBuf) != ':')))) goto LAB_008bae3b;
            _memset(local_114,0,0x100);
            iVar4 = iVar7;
            do {
              cVar2 = *(char *)(iVar4 + (int)_DstBuf);
              if ((cVar2 == '\0') || (cVar2 == '\n')) break;
              local_114[iVar4 - iVar7] = cVar2;
              iVar4 = iVar4 + 1;
            } while (iVar4 < (int)_ElementSize);
            uVar5 = FUN_00404350(local_114);
            local_8._0_1_ = 4;
            FUN_00405eb0(uVar5,0,0xffffffff);
            local_8._0_1_ = 2;
            if (7 < local_17c) {
                    /* WARNING: Subroutine does not return */
              FUN_006f04e0();
            }
            local_17c = 7;
          }
        }
        else {
LAB_008bae3b:
          iVar4 = iVar4 + 1;
        }
      } while (iVar4 < (int)_ElementSize);
    }
    local_8._0_1_ = 2;
    iVar4 = FUN_00407c10(&DAT_00c4d4c4,3);
    iVar7 = FUN_00407c10(&DAT_00c4d4cc,3);
    iVar6 = FUN_00407c10(&DAT_00c4d4d4,3);
    if (iVar4 == -1) {
      if (iVar7 == -1) {
        *(uint *)(param_1 + 0x148) = -(uint)(iVar6 != -1) & 3;
      }
      else {
        *(undefined4 *)(param_1 + 0x148) = 2;
      }
    }
    else {
      *(undefined4 *)(param_1 + 0x148) = 1;
    }
    iVar4 = FUN_00407c10(&PTR_DAT_00c4d4dc,2);
    *(uint *)(param_1 + 0x14c) = (uint)(iVar4 != -1);
    if (_DstBuf != (void *)0x0) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_8 = CONCAT31(local_8._1_3_,1);
    if (7 < local_150) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_150 = 7;
    local_154 = 0;
    local_164 = 0;
    local_8 = (uint)local_8._1_3_ << 8;
    if (7 < local_134) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_134 = 7;
    local_138 = 0;
    local_148 = 0;
    local_8 = 0xffffffff;
    if (7 < local_118) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    uVar3 = (uint)local_12c._2_2_;
  }
  local_12c = (wchar_t *)(uVar3 << 0x10);
  local_8 = 0xffffffff;
  local_118 = 7;
  local_11c = 0;
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
008baaf0 : PUSH EBP
008baaf1 : MOV EBP,ESP
008baaf3 : PUSH -0x1
008baaf5 : PUSH 0xb3e5e8
008baafa : MOV EAX,FS:[0x0]
008bab00 : PUSH EAX
008bab01 : SUB ESP,0x1a0
008bab07 : MOV EAX,[0x00d66fa0]
008bab0c : XOR EAX,EBP
008bab0e : MOV dword ptr [EBP + -0x10],EAX
008bab11 : PUSH EBX
008bab12 : PUSH ESI
008bab13 : PUSH EDI
008bab14 : PUSH EAX
008bab15 : LEA EAX,[EBP + -0xc]
008bab18 : MOV FS:[0x0],EAX
008bab1e : MOV EAX,dword ptr [EBP + 0x8]
008bab21 : PUSH EAX
008bab22 : LEA ESI,[EBP + 0xfffffed4]
008bab28 : MOV dword ptr [EBP + 0xfffffe94],EAX
008bab2e : CALL 0x008b7050
008bab33 : XOR EDI,EDI
008bab35 : MOV dword ptr [EBP + -0x4],EDI
008bab38 : PUSH 0xc
008bab3a : PUSH 0xc4d4a0
008bab3f : CALL 0x00404870
008bab44 : MOV EAX,dword ptr [EBP + 0xfffffed8]
008bab4a : MOV ESI,0x8
008bab4f : CMP dword ptr [EBP + 0xfffffeec],ESI
008bab55 : JNC 0x008bab5d
008bab57 : LEA EAX,[EBP + 0xfffffed8]
008bab5d : PUSH 0xc4d4bc
008bab62 : PUSH EAX
008bab63 : LEA EAX,[EBP + 0xfffffe98]
008bab69 : PUSH EAX
008bab6a : CALL 0x0063641b
008bab6f : MOV EAX,dword ptr [EBP + 0xfffffe98]
008bab75 : ADD ESP,0xc
008bab78 : CMP EAX,EDI
008bab7a : JNZ 0x008babae
008bab7c : MOV dword ptr [EBP + -0x4],0xffffffff
008bab83 : CMP dword ptr [EBP + 0xfffffeec],ESI
008bab89 : JC 0x008bab96
008bab8b : MOV ECX,dword ptr [EBP + 0xfffffed8]
008bab91 : CALL 0x006f04e0
008bab96 : XOR ECX,ECX
008bab98 : MOV dword ptr [EBP + 0xfffffeec],0x7
008baba2 : MOV word ptr [EBP + 0xfffffed8],CX
008baba9 : JMP 0x008baf85
008babae : PUSH 0x2
008babb0 : PUSH EDI
008babb1 : PUSH EAX
008babb2 : CALL 0x006377fb
008babb7 : MOV EDX,dword ptr [EBP + 0xfffffe98]
008babbd : PUSH EDX
008babbe : CALL 0x0063751f
008babc3 : MOV ESI,EAX
008babc5 : MOV EAX,dword ptr [EBP + 0xfffffe98]
008babcb : PUSH EDI
008babcc : PUSH EDI
008babcd : PUSH EAX
008babce : MOV dword ptr [EBP + 0xfffffe90],ESI
008babd4 : CALL 0x006377fb
008babd9 : MOV ECX,dword ptr [0x01725270]
008babdf : SHR ECX,0x3
008babe2 : MOV EDX,EDI
008babe4 : AND ECX,0x1
008babe7 : SETZ DL
008babea : PUSH EDX
008babeb : PUSH EDI
008babec : PUSH 0xbf1a4b
008babf1 : PUSH ESI
008babf2 : CALL 0x006f0760
008babf7 : MOV EBX,EAX
008babf9 : MOV EAX,dword ptr [EBP + 0xfffffe98]
008babff : PUSH EAX
008bac00 : PUSH 0x1
008bac02 : PUSH ESI
008bac03 : PUSH EBX
008bac04 : CALL 0x00638b7b
008bac09 : MOV ECX,dword ptr [EBP + 0xfffffe98]
008bac0f : PUSH ECX
008bac10 : CALL 0x006366db
008bac15 : MOV EAX,ESI
008bac17 : CDQ
008bac18 : AND EDX,0x3
008bac1b : ADD EAX,EDX
008bac1d : SAR EAX,0x2
008bac20 : ADD ESP,0x40
008bac23 : XOR ECX,ECX
008bac25 : CMP EAX,EDI
008bac27 : JLE 0x008bac3c
008bac29 : LEA ESP,[ESP]
008bac30 : XOR dword ptr [EBX + ECX*0x4],0x93c684e7
008bac37 : INC ECX
008bac38 : CMP ECX,EAX
008bac3a : JL 0x008bac30
008bac3c : MOV EAX,0x7
008bac41 : XOR EDX,EDX
008bac43 : MOV dword ptr [EBP + 0xfffffed0],EAX
008bac49 : MOV dword ptr [EBP + 0xfffffecc],EDI
008bac4f : MOV word ptr [EBP + 0xfffffebc],DX
008bac56 : MOV byte ptr [EBP + -0x4],0x1
008bac5a : MOV dword ptr [EBP + 0xfffffeb4],EAX
008bac60 : XOR EAX,EAX
008bac62 : MOV dword ptr [EBP + 0xfffffeb0],EDI
008bac68 : MOV word ptr [EBP + 0xfffffea0],AX
008bac6f : MOV byte ptr [EBP + -0x4],0x2
008bac73 : CMP ESI,EDI
008bac75 : JLE 0x008bae44
008bac7b : JMP 0x008bac80
008bac80 : LEA EDI,[EAX + 0x5]
008bac83 : CMP EDI,ESI
008bac85 : JGE 0x008bae3b
008bac8b : CMP byte ptr [EAX + EBX*0x1],0x53
008bac8f : JNZ 0x008bad5e
008bac95 : CMP byte ptr [EAX + EBX*0x1 + 0x1],0x48
008bac9a : JNZ 0x008bad5e
008baca0 : CMP byte ptr [EAX + EBX*0x1 + 0x2],0x49
008baca5 : JNZ 0x008bad5e
008bacab : CMP byte ptr [EAX + EBX*0x1 + 0x3],0x50
008bacb0 : JNZ 0x008bad5e
008bacb6 : CMP byte ptr [EAX + EBX*0x1 + 0x4],0x3a
008bacbb : JNZ 0x008bad5e
008bacc1 : PUSH 0x100
008bacc6 : LEA ECX,[EBP + 0xfffffef0]
008baccc : PUSH 0x0
008bacce : PUSH ECX
008baccf : CALL 0x0063b700
008bacd4 : LEA ECX,[EBP + 0xfffffef0]
008bacda : ADD ESP,0xc
008bacdd : SUB ECX,EDI
008bacdf : NOP
008bace0 : MOV AL,byte ptr [EDI + EBX*0x1]
008bace3 : TEST AL,AL
008bace5 : JZ 0x008bacf3
008bace7 : CMP AL,0xa
008bace9 : JZ 0x008bacf3
008baceb : MOV byte ptr [ECX + EDI*0x1],AL
008bacee : INC EDI
008bacef : CMP EDI,ESI
008bacf1 : JL 0x008bace0
008bacf3 : LEA EDX,[EBP + 0xfffffef0]
008bacf9 : PUSH EDX
008bacfa : LEA ESI,[EBP + 0xfffffe54]
008bad00 : CALL 0x00404350
008bad05 : ADD ESP,0x4
008bad08 : MOV byte ptr [EBP + -0x4],0x3
008bad0c : PUSH -0x1
008bad0e : PUSH 0x0
008bad10 : PUSH EAX
008bad11 : LEA ECX,[EBP + 0xfffffeb8]
008bad17 : CALL 0x00405eb0
008bad1c : MOV byte ptr [EBP + -0x4],0x2
008bad20 : CMP dword ptr [EBP + 0xfffffe6c],0x8
008bad27 : JC 0x008bad34
008bad29 : MOV ECX,dword ptr [EBP + 0xfffffe58]
008bad2f : CALL 0x006f04e0
008bad34 : MOV ESI,dword ptr [EBP + 0xfffffe90]
008bad3a : XOR EAX,EAX
008bad3c : MOV word ptr [EBP + 0xfffffe58],AX
008bad43 : MOV dword ptr [EBP + 0xfffffe6c],0x7
008bad4d : MOV dword ptr [EBP + 0xfffffe68],0x0
008bad57 : MOV EAX,EDI
008bad59 : JMP 0x008bae3c
008bad5e : CMP EDI,ESI
008bad60 : JGE 0x008bae3b
008bad66 : CMP byte ptr [EAX + EBX*0x1],0x54
008bad6a : JNZ 0x008bae3b
008bad70 : CMP byte ptr [EAX + EBX*0x1 + 0x1],0x41
008bad75 : JNZ 0x008bae3b
008bad7b : CMP byte ptr [EAX + EBX*0x1 + 0x2],0x52
008bad80 : JNZ 0x008bae3b
008bad86 : CMP byte ptr [EAX + EBX*0x1 + 0x3],0x47
008bad8b : JNZ 0x008bae3b
008bad91 : CMP byte ptr [EAX + EBX*0x1 + 0x4],0x3a
008bad96 : JNZ 0x008bae3b
008bad9c : PUSH 0x100
008bada1 : LEA ECX,[EBP + 0xfffffef0]
008bada7 : PUSH 0x0
008bada9 : PUSH ECX
008badaa : CALL 0x0063b700
008badaf : LEA ECX,[EBP + 0xfffffef0]
008badb5 : ADD ESP,0xc
008badb8 : SUB ECX,EDI
008badba : LEA EBX,[EBX]
008badc0 : MOV AL,byte ptr [EDI + EBX*0x1]
008badc3 : TEST AL,AL
008badc5 : JZ 0x008badd3
008badc7 : CMP AL,0xa
008badc9 : JZ 0x008badd3
008badcb : MOV byte ptr [ECX + EDI*0x1],AL
008badce : INC EDI
008badcf : CMP EDI,ESI
008badd1 : JL 0x008badc0
008badd3 : LEA EDX,[EBP + 0xfffffef0]
008badd9 : PUSH EDX
008badda : LEA ESI,[EBP + 0xfffffe70]
008bade0 : CALL 0x00404350
008bade5 : ADD ESP,0x4
008bade8 : MOV byte ptr [EBP + -0x4],0x4
008badec : PUSH -0x1
008badee : PUSH 0x0
008badf0 : PUSH EAX
008badf1 : LEA ECX,[EBP + 0xfffffe9c]
008badf7 : CALL 0x00405eb0
008badfc : MOV byte ptr [EBP + -0x4],0x2
008bae00 : CMP dword ptr [EBP + 0xfffffe88],0x8
008bae07 : JC 0x008bae14
008bae09 : MOV ECX,dword ptr [EBP + 0xfffffe74]
008bae0f : CALL 0x006f04e0
008bae14 : MOV ESI,dword ptr [EBP + 0xfffffe90]
008bae1a : XOR EAX,EAX
008bae1c : MOV word ptr [EBP + 0xfffffe74],AX
008bae23 : MOV dword ptr [EBP + 0xfffffe88],0x7
008bae2d : MOV dword ptr [EBP + 0xfffffe84],0x0
008bae37 : MOV EAX,EDI
008bae39 : JMP 0x008bae3c
008bae3b : INC EAX
008bae3c : CMP EAX,ESI
008bae3e : JL 0x008bac80
008bae44 : PUSH 0x3
008bae46 : PUSH 0xc4d4c4
008bae4b : XOR EAX,EAX
008bae4d : LEA EDX,[EBP + 0xfffffeb8]
008bae53 : CALL 0x00407c10
008bae58 : PUSH 0x3
008bae5a : MOV ESI,EAX
008bae5c : PUSH 0xc4d4cc
008bae61 : XOR EAX,EAX
008bae63 : LEA EDX,[EBP + 0xfffffeb8]
008bae69 : CALL 0x00407c10
008bae6e : PUSH 0x3
008bae70 : MOV EDI,EAX
008bae72 : PUSH 0xc4d4d4
008bae77 : XOR EAX,EAX
008bae79 : LEA EDX,[EBP + 0xfffffeb8]
008bae7f : CALL 0x00407c10
008bae84 : CMP ESI,-0x1
008bae87 : JZ 0x008bae9b
008bae89 : MOV ECX,dword ptr [EBP + 0xfffffe94]
008bae8f : MOV dword ptr [ECX + 0x148],0x1
008bae99 : JMP 0x008baec6
008bae9b : CMP EDI,-0x1
008bae9e : JZ 0x008baeb2
008baea0 : MOV EDX,dword ptr [EBP + 0xfffffe94]
008baea6 : MOV dword ptr [EDX + 0x148],0x2
008baeb0 : JMP 0x008baec6
008baeb2 : MOV ECX,dword ptr [EBP + 0xfffffe94]
008baeb8 : INC EAX
008baeb9 : NEG EAX
008baebb : SBB EAX,EAX
008baebd : AND EAX,0x3
008baec0 : MOV dword ptr [ECX + 0x148],EAX
008baec6 : PUSH 0x2
008baec8 : PUSH 0xc4d4dc
008baecd : XOR EAX,EAX
008baecf : LEA EDX,[EBP + 0xfffffe9c]
008baed5 : CALL 0x00407c10
008baeda : XOR EDX,EDX
008baedc : CMP EAX,-0x1
008baedf : MOV EAX,dword ptr [EBP + 0xfffffe94]
008baee5 : SETNZ DL
008baee8 : XOR EDI,EDI
008baeea : MOV dword ptr [EAX + 0x14c],EDX
008baef0 : CMP EBX,EDI
008baef2 : JZ 0x008baefb
008baef4 : MOV ECX,EBX
008baef6 : CALL 0x006f04e0
008baefb : MOV byte ptr [EBP + -0x4],0x1
008baeff : MOV EBX,0x8
008baf04 : CMP dword ptr [EBP + 0xfffffeb4],EBX
008baf0a : JC 0x008baf17
008baf0c : MOV ECX,dword ptr [EBP + 0xfffffea0]
008baf12 : CALL 0x006f04e0
008baf17 : XOR ECX,ECX
008baf19 : MOV ESI,0x7
008baf1e : MOV dword ptr [EBP + 0xfffffeb4],ESI
008baf24 : MOV dword ptr [EBP + 0xfffffeb0],EDI
008baf2a : MOV word ptr [EBP + 0xfffffea0],CX
008baf31 : MOV byte ptr [EBP + -0x4],CL
008baf34 : CMP dword ptr [EBP + 0xfffffed0],EBX
008baf3a : JC 0x008baf47
008baf3c : MOV ECX,dword ptr [EBP + 0xfffffebc]
008baf42 : CALL 0x006f04e0
008baf47 : XOR EDX,EDX
008baf49 : MOV dword ptr [EBP + 0xfffffed0],ESI
008baf4f : MOV dword ptr [EBP + 0xfffffecc],EDI
008baf55 : MOV word ptr [EBP + 0xfffffebc],DX
008baf5c : MOV dword ptr [EBP + -0x4],0xffffffff
008baf63 : CMP dword ptr [EBP + 0xfffffeec],EBX
008baf69 : JC 0x008baf76
008baf6b : MOV ECX,dword ptr [EBP + 0xfffffed8]
008baf71 : CALL 0x006f04e0
008baf76 : XOR EAX,EAX
008baf78 : MOV dword ptr [EBP + 0xfffffeec],ESI
008baf7e : MOV word ptr [EBP + 0xfffffed8],AX
008baf85 : MOV dword ptr [EBP + 0xfffffee8],EDI
008baf8b : MOV ECX,dword ptr [EBP + -0xc]
008baf8e : MOV dword ptr FS:[0x0],ECX
008baf95 : POP ECX
008baf96 : POP EDI
008baf97 : POP ESI
008baf98 : POP EBX
008baf99 : MOV ECX,dword ptr [EBP + -0x10]
008baf9c : XOR ECX,EBP
008baf9e : CALL 0x00633e6b
008bafa3 : MOV ESP,EBP
008bafa5 : POP EBP
008bafa6 : RET 0x4
