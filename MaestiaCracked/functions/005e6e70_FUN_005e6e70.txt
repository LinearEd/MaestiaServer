PROGRAM  : Maestia.exe
FUNCTION : FUN_005e6e70
ENTRY    : 005e6e70
BODY     : [[005e6e70, 005e7007]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005e6e70(int param_1)

{
  undefined1 uVar1;
  undefined1 uVar2;
  int iVar3;
  char cVar4;
  LONG LVar5;
  GThread *this;
  GThread *this_00;
  undefined2 uVar6;
  int iVar7;
  uint uVar8;
  uint *puVar9;
  int local_18;
  int local_14;
  uint local_10 [3];
  
  iVar7 = *(int *)(param_1 + 0x314);
  if (iVar7 == 0) {
    iVar7 = param_1 + 0x28;
  }
  *(undefined1 *)(iVar7 + 0x15) = 0;
  if (*(int *)(iVar7 + 0x30) - *(int *)(iVar7 + 0x2c) < 2) {
    FUN_00539fb0(2);
  }
  iVar3 = *(int *)(iVar7 + 0x2c);
  this = (GThread *)
         (uint)CONCAT11(*(undefined1 *)(*(int *)(iVar7 + 0x3c) + 1 + iVar3),
                        *(undefined1 *)(*(int *)(iVar7 + 0x3c) + iVar3));
  *(int *)(iVar7 + 0x2c) = iVar3 + 2;
  GThread::OnExit(this);
  for (; this != (GThread *)0x0; this = this + -1) {
    iVar7 = *(int *)(param_1 + 0x314);
    if (iVar7 == 0) {
      iVar7 = param_1 + 0x28;
    }
    *(undefined1 *)(iVar7 + 0x15) = 0;
    if (*(int *)(iVar7 + 0x30) - *(int *)(iVar7 + 0x2c) < 2) {
      FUN_00539fb0(2);
    }
    iVar3 = *(int *)(iVar7 + 0x2c);
    uVar1 = *(undefined1 *)(*(int *)(iVar7 + 0x3c) + 1 + iVar3);
    uVar2 = *(undefined1 *)(*(int *)(iVar7 + 0x3c) + iVar3);
    *(int *)(iVar7 + 0x2c) = iVar3 + 2;
    uVar6 = CONCAT11(uVar1,uVar2);
    FUN_0051c350(*(undefined4 *)(*(int *)(param_1 + 0x20) + 0x1c));
    puVar9 = local_10;
    FUN_00500130(puVar9);
    FUN_0053b190(puVar9);
    GThread::OnExit(this_00);
    local_18 = 0;
    local_14 = 0;
    cVar4 = FUN_00565560(&local_18,uVar6);
    if (cVar4 == '\0') {
      FUN_00555e50(param_1 + 0x14,"Export error: don\'t know how to export GFxResource \'%s\'\n",
                   (local_10[0] & 0xfffffffc) + 8);
    }
    else {
      FUN_00567ff0(local_10,uVar6,&local_18);
    }
    if ((local_18 == 0) && (local_14 != 0)) {
      FUN_00524240();
    }
    uVar8 = local_10[0] & 0xfffffffc;
    LVar5 = InterlockedExchangeAdd((LONG *)(uVar8 + 4),-1);
    if (LVar5 == 1) {
      FUN_00515cf0(uVar8);
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005e6e70 : PUSH EBP
005e6e71 : MOV EBP,ESP
005e6e73 : AND ESP,0xfffffff8
005e6e76 : SUB ESP,0x14
005e6e79 : PUSH EBX
005e6e7a : PUSH ESI
005e6e7b : PUSH EDI
005e6e7c : MOV EDI,dword ptr [EBP + 0x8]
005e6e7f : MOV ESI,dword ptr [EDI + 0x314]
005e6e85 : TEST ESI,ESI
005e6e87 : JNZ 0x005e6e8c
005e6e89 : LEA ESI,[EDI + 0x28]
005e6e8c : MOV EAX,dword ptr [ESI + 0x30]
005e6e8f : SUB EAX,dword ptr [ESI + 0x2c]
005e6e92 : MOV byte ptr [ESI + 0x15],0x0
005e6e96 : CMP EAX,0x2
005e6e99 : JGE 0x005e6ea4
005e6e9b : PUSH 0x2
005e6e9d : MOV ECX,ESI
005e6e9f : CALL 0x00539fb0
005e6ea4 : MOV EAX,dword ptr [ESI + 0x2c]
005e6ea7 : MOV ECX,dword ptr [ESI + 0x3c]
005e6eaa : MOVZX DX,byte ptr [ECX + EAX*0x1 + 0x1]
005e6eb0 : ADD ECX,EAX
005e6eb2 : MOVZX CX,byte ptr [ECX]
005e6eb6 : SHL DX,0x8
005e6eba : OR DX,CX
005e6ebd : MOVZX ECX,DX
005e6ec0 : ADD EAX,0x2
005e6ec3 : MOV dword ptr [ESI + 0x2c],EAX
005e6ec6 : MOVZX ESI,CX
005e6ec9 : PUSH ESI
005e6eca : LEA EAX,[EDI + 0x14]
005e6ecd : PUSH 0xb9412c
005e6ed2 : PUSH EAX
005e6ed3 : CALL 0x0051d420
005e6ed8 : ADD ESP,0xc
005e6edb : TEST ESI,ESI
005e6edd : JBE 0x005e6fff
005e6ee3 : MOV dword ptr [ESP + 0xc],ESI
005e6ee7 : MOV ESI,dword ptr [EDI + 0x314]
005e6eed : TEST ESI,ESI
005e6eef : JNZ 0x005e6ef4
005e6ef1 : LEA ESI,[EDI + 0x28]
005e6ef4 : MOV EDX,dword ptr [ESI + 0x30]
005e6ef7 : SUB EDX,dword ptr [ESI + 0x2c]
005e6efa : MOV byte ptr [ESI + 0x15],0x0
005e6efe : CMP EDX,0x2
005e6f01 : JGE 0x005e6f0c
005e6f03 : PUSH 0x2
005e6f05 : MOV ECX,ESI
005e6f07 : CALL 0x00539fb0
005e6f0c : MOV EAX,dword ptr [ESI + 0x2c]
005e6f0f : MOV ECX,dword ptr [ESI + 0x3c]
005e6f12 : MOVZX DX,byte ptr [ECX + EAX*0x1 + 0x1]
005e6f18 : ADD ECX,EAX
005e6f1a : MOVZX CX,byte ptr [ECX]
005e6f1e : ADD EAX,0x2
005e6f21 : MOV dword ptr [ESI + 0x2c],EAX
005e6f24 : MOV EAX,dword ptr [EDI + 0x20]
005e6f27 : MOV EAX,dword ptr [EAX + 0x1c]
005e6f2a : SHL DX,0x8
005e6f2e : OR DX,CX
005e6f31 : PUSH EAX
005e6f32 : LEA ECX,[ESP + 0x1c]
005e6f36 : MOVZX EBX,DX
005e6f39 : CALL 0x0051c350
005e6f3e : LEA EDX,[ESP + 0x18]
005e6f42 : PUSH EDX
005e6f43 : MOV ECX,EDI
005e6f45 : CALL 0x00500130
005e6f4a : MOV ECX,EAX
005e6f4c : CALL 0x0053b190
005e6f51 : MOV EAX,dword ptr [ESP + 0x18]
005e6f55 : AND EAX,0xfffffffc
005e6f58 : MOVZX ESI,BX
005e6f5b : ADD EAX,0x8
005e6f5e : PUSH EAX
005e6f5f : PUSH ESI
005e6f60 : PUSH 0xb9410c
005e6f65 : LEA EBX,[EDI + 0x14]
005e6f68 : PUSH EBX
005e6f69 : CALL 0x0051d420
005e6f6e : XOR EAX,EAX
005e6f70 : MOV dword ptr [ESP + 0x20],EAX
005e6f74 : MOV dword ptr [ESP + 0x24],EAX
005e6f78 : ADD ESP,0xc
005e6f7b : MOV EAX,ESP
005e6f7d : MOV dword ptr [EAX],ESI
005e6f7f : MOV ECX,dword ptr [EDI + 0x20]
005e6f82 : LEA EAX,[ESP + 0x14]
005e6f86 : PUSH EAX
005e6f87 : CALL 0x00565560
005e6f8c : TEST AL,AL
005e6f8e : JZ 0x005e6fa9
005e6f90 : LEA ECX,[ESP + 0x10]
005e6f94 : PUSH ECX
005e6f95 : PUSH ECX
005e6f96 : MOV EAX,ESP
005e6f98 : LEA EDX,[ESP + 0x20]
005e6f9c : MOV dword ptr [EAX],ESI
005e6f9e : MOV ECX,dword ptr [EDI + 0x20]
005e6fa1 : PUSH EDX
005e6fa2 : CALL 0x00567ff0
005e6fa7 : JMP 0x005e6fc2
005e6fa9 : MOV EAX,dword ptr [ESP + 0x18]
005e6fad : AND EAX,0xfffffffc
005e6fb0 : ADD EAX,0x8
005e6fb3 : PUSH EAX
005e6fb4 : PUSH 0xb940d0
005e6fb9 : PUSH EBX
005e6fba : CALL 0x00555e50
005e6fbf : ADD ESP,0xc
005e6fc2 : CMP dword ptr [ESP + 0x10],0x0
005e6fc7 : JNZ 0x005e6fd6
005e6fc9 : MOV ECX,dword ptr [ESP + 0x14]
005e6fcd : TEST ECX,ECX
005e6fcf : JZ 0x005e6fd6
005e6fd1 : CALL 0x00524240
005e6fd6 : MOV ESI,dword ptr [ESP + 0x18]
005e6fda : AND ESI,0xfffffffc
005e6fdd : PUSH -0x1
005e6fdf : LEA ECX,[ESI + 0x4]
005e6fe2 : PUSH ECX
005e6fe3 : CALL dword ptr [0x00b851cc]
005e6fe9 : SUB EAX,0x1
005e6fec : JNZ 0x005e6ff4
005e6fee : PUSH ESI
005e6fef : CALL 0x00515cf0
005e6ff4 : SUB dword ptr [ESP + 0xc],0x1
005e6ff9 : JNZ 0x005e6ee7
005e6fff : POP EDI
005e7000 : POP ESI
005e7001 : POP EBX
005e7002 : MOV ESP,EBP
005e7004 : POP EBP
005e7005 : RET 0x8
