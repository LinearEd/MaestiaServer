PROGRAM  : Maestia.exe
FUNCTION : FUN_0046f8a0
ENTRY    : 0046f8a0
BODY     : [[0046f8a0, 0046f9a0]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0046f8a0(int param_1,undefined4 param_2,undefined4 param_3,char param_4)

{
  uint _Size;
  size_t _Size_00;
  char *pcVar1;
  char cVar2;
  undefined4 *unaff_ESI;
  undefined1 *puVar3;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  puStack_c = &LAB_00b72181;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  local_8 = 1;
  *unaff_ESI = &PTR_FUN_00cd3f48;
  _Size_00 = *(size_t *)(param_1 + 4);
  unaff_ESI[1] = _Size_00;
  if (*(int *)(param_1 + 4) != 0) {
    _memmove(unaff_ESI + 2,(void *)(param_1 + 8),_Size_00);
  }
  *(undefined1 *)(unaff_ESI[1] + 8 + (int)unaff_ESI) = 0;
  pcVar1 = (char *)(*(int *)(param_1 + 4) + 7 + param_1);
  if ((char *)(param_1 + 8U) <= pcVar1) {
    do {
      puVar3 = &param_4;
      if (param_4 != '\0') {
        cVar2 = param_4;
        do {
          if (*pcVar1 == cVar2) {
            _Size = (*(int *)(param_1 + 4) - (int)(pcVar1 + 1)) + 8 + param_1;
            if (_Size < 0xff) {
              unaff_ESI[1] = _Size;
              *(undefined1 *)((int)unaff_ESI + _Size + 8) = 0;
            }
            else {
              unaff_ESI[1] = 0xff;
              *(undefined1 *)((int)unaff_ESI + 0x107) = 0;
            }
            _memmove(unaff_ESI + 2,pcVar1 + 1,_Size);
            pcVar1 = (char *)(param_1 + 8);
            break;
          }
          cVar2 = puVar3[1];
          puVar3 = puVar3 + 1;
        } while (cVar2 != '\0');
      }
      pcVar1 = pcVar1 + -1;
    } while ((char *)(param_1 + 8U) <= pcVar1);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
0046f8a0 : PUSH EBP
0046f8a1 : MOV EBP,ESP
0046f8a3 : PUSH -0x1
0046f8a5 : PUSH 0xb72181
0046f8aa : MOV EAX,FS:[0x0]
0046f8b0 : PUSH EAX
0046f8b1 : SUB ESP,0x8
0046f8b4 : PUSH EBX
0046f8b5 : PUSH EDI
0046f8b6 : MOV EAX,[0x00d66fa0]
0046f8bb : XOR EAX,EBP
0046f8bd : PUSH EAX
0046f8be : LEA EAX,[EBP + -0xc]
0046f8c1 : MOV FS:[0x0],EAX
0046f8c7 : XOR EAX,EAX
0046f8c9 : MOV dword ptr [EBP + -0x4],EAX
0046f8cc : MOV EBX,dword ptr [EBP + 0x8]
0046f8cf : MOV dword ptr [EBP + -0x14],ESI
0046f8d2 : MOV dword ptr [EBP + -0x10],EAX
0046f8d5 : MOV EDI,0x1
0046f8da : MOV dword ptr [EBP + -0x4],EDI
0046f8dd : MOV dword ptr [ESI],0xcd3f48
0046f8e3 : MOV ECX,dword ptr [EBX + 0x4]
0046f8e6 : MOV dword ptr [ESI + 0x4],ECX
0046f8e9 : CMP dword ptr [EBX + 0x4],EAX
0046f8ec : JBE 0x0046f901
0046f8ee : MOV EDX,ECX
0046f8f0 : PUSH EDX
0046f8f1 : LEA EAX,[EBX + 0x8]
0046f8f4 : PUSH EAX
0046f8f5 : LEA ECX,[ESI + 0x8]
0046f8f8 : PUSH ECX
0046f8f9 : CALL 0x00636880
0046f8fe : ADD ESP,0xc
0046f901 : MOV EDX,dword ptr [ESI + 0x4]
0046f904 : MOV byte ptr [EDX + ESI*0x1 + 0x8],0x0
0046f909 : MOV EAX,dword ptr [EBX + 0x4]
0046f90c : LEA EAX,[EAX + EBX*0x1 + 0x7]
0046f910 : LEA ECX,[EBX + 0x8]
0046f913 : MOV dword ptr [EBP + -0x10],EDI
0046f916 : CMP EAX,ECX
0046f918 : JC 0x0046f981
0046f91a : LEA EBX,[EBX]
0046f920 : MOV CL,byte ptr [EBP + 0x14]
0046f923 : LEA EDI,[EBP + 0x14]
0046f926 : TEST CL,CL
0046f928 : JZ 0x0046f979
0046f92a : MOV DL,byte ptr [EAX]
0046f92c : LEA ESP,[ESP]
0046f930 : CMP DL,CL
0046f932 : JZ 0x0046f93e
0046f934 : MOV CL,byte ptr [EDI + 0x1]
0046f937 : INC EDI
0046f938 : TEST CL,CL
0046f93a : JNZ 0x0046f930
0046f93c : JMP 0x0046f979
0046f93e : MOV ECX,dword ptr [EBX + 0x4]
0046f941 : INC EAX
0046f942 : SUB ECX,EAX
0046f944 : LEA ECX,[ECX + EBX*0x1 + 0x8]
0046f948 : CMP ECX,0xff
0046f94e : JNC 0x0046f95a
0046f950 : MOV dword ptr [ESI + 0x4],ECX
0046f953 : MOV byte ptr [ESI + ECX*0x1 + 0x8],0x0
0046f958 : JMP 0x0046f968
0046f95a : MOV dword ptr [ESI + 0x4],0xff
0046f961 : MOV byte ptr [ESI + 0x107],0x0
0046f968 : PUSH ECX
0046f969 : PUSH EAX
0046f96a : LEA EDX,[ESI + 0x8]
0046f96d : PUSH EDX
0046f96e : CALL 0x00636880
0046f973 : ADD ESP,0xc
0046f976 : LEA EAX,[EBX + 0x8]
0046f979 : DEC EAX
0046f97a : LEA ECX,[EBX + 0x8]
0046f97d : CMP EAX,ECX
0046f97f : JNC 0x0046f920
0046f981 : MOV byte ptr [EBP + -0x4],0x0
0046f985 : MOV dword ptr [EBP + 0xc],0xcd3f48
0046f98c : MOV EAX,ESI
0046f98e : MOV ECX,dword ptr [EBP + -0xc]
0046f991 : MOV dword ptr FS:[0x0],ECX
0046f998 : POP ECX
0046f999 : POP EDI
0046f99a : POP EBX
0046f99b : MOV ESP,EBP
0046f99d : POP EBP
0046f99e : RET 0x10c
