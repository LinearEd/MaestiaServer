PROGRAM  : Maestia.exe
FUNCTION : __read
ENTRY    : 00653be6
BODY     : [[00653be6, 00653cd8]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    __read
   
   Library: Visual Studio 2008 Release */

int __cdecl __read(int _FileHandle,void *_DstBuf,uint _MaxCharCount)

{
  ulong *puVar1;
  int *piVar2;
  int iVar3;
  int local_20;
  
  if (_FileHandle == -2) {
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
    return -1;
  }
  if ((-1 < _FileHandle) && ((uint)_FileHandle < DAT_01728c30)) {
    iVar3 = (_FileHandle & 0x1fU) * 0x40;
    if ((*(byte *)((&DAT_01728c40)[_FileHandle >> 5] + 4 + iVar3) & 1) != 0) {
      if (_MaxCharCount < 0x80000000) {
        ___lock_fhandle(_FileHandle);
        if ((*(byte *)((&DAT_01728c40)[_FileHandle >> 5] + 4 + iVar3) & 1) == 0) {
          piVar2 = __errno();
          *piVar2 = 9;
          puVar1 = ___doserrno();
          *puVar1 = 0;
          local_20 = -1;
        }
        else {
          local_20 = __read_nolock(_FileHandle,_DstBuf,_MaxCharCount);
        }
        FUN_00653cd9();
        return local_20;
      }
      puVar1 = ___doserrno();
      *puVar1 = 0;
      piVar2 = __errno();
      *piVar2 = 0x16;
      goto LAB_00653c35;
    }
  }
  puVar1 = ___doserrno();
  *puVar1 = 0;
  piVar2 = __errno();
  *piVar2 = 9;
LAB_00653c35:
  __invalid_parameter(0,0,0,0,0);
  return -1;
}



============================================================
DISASSEMBLY
============================================================
00653be6 : PUSH 0x10
00653be8 : PUSH 0xced2d8
00653bed : CALL 0x0064c228
00653bf2 : MOV EAX,dword ptr [EBP + 0x8]
00653bf5 : CMP EAX,-0x2
00653bf8 : JNZ 0x00653c15
00653bfa : CALL 0x0063ab95
00653bff : AND dword ptr [EAX],0x0
00653c02 : CALL 0x0063ab82
00653c07 : MOV dword ptr [EAX],0x9
00653c0d : OR EAX,0xffffffff
00653c10 : JMP 0x00653cd3
00653c15 : XOR ESI,ESI
00653c17 : CMP EAX,ESI
00653c19 : JL 0x00653c23
00653c1b : CMP EAX,dword ptr [0x01728c30]
00653c21 : JC 0x00653c44
00653c23 : CALL 0x0063ab95
00653c28 : MOV dword ptr [EAX],ESI
00653c2a : CALL 0x0063ab82
00653c2f : MOV dword ptr [EAX],0x9
00653c35 : PUSH ESI
00653c36 : PUSH ESI
00653c37 : PUSH ESI
00653c38 : PUSH ESI
00653c39 : PUSH ESI
00653c3a : CALL 0x006372b8
00653c3f : ADD ESP,0x14
00653c42 : JMP 0x00653c0d
00653c44 : MOV ECX,EAX
00653c46 : SAR ECX,0x5
00653c49 : LEA EBX,[ECX*0x4 + 0x1728c40]
00653c50 : MOV EDI,EAX
00653c52 : AND EDI,0x1f
00653c55 : SHL EDI,0x6
00653c58 : MOV ECX,dword ptr [EBX]
00653c5a : MOVSX ECX,byte ptr [ECX + EDI*0x1 + 0x4]
00653c5f : AND ECX,0x1
00653c62 : JZ 0x00653c23
00653c64 : MOV ECX,0x7fffffff
00653c69 : CMP ECX,dword ptr [EBP + 0x10]
00653c6c : SBB ECX,ECX
00653c6e : INC ECX
00653c6f : JNZ 0x00653c85
00653c71 : CALL 0x0063ab95
00653c76 : MOV dword ptr [EAX],ESI
00653c78 : CALL 0x0063ab82
00653c7d : MOV dword ptr [EAX],0x16
00653c83 : JMP 0x00653c35
00653c85 : PUSH EAX
00653c86 : CALL 0x0065cc82
00653c8b : POP ECX
00653c8c : MOV dword ptr [EBP + -0x4],ESI
00653c8f : MOV EAX,dword ptr [EBX]
00653c91 : TEST byte ptr [EAX + EDI*0x1 + 0x4],0x1
00653c96 : JZ 0x00653cae
00653c98 : PUSH dword ptr [EBP + 0x10]
00653c9b : PUSH dword ptr [EBP + 0xc]
00653c9e : PUSH dword ptr [EBP + 0x8]
00653ca1 : CALL 0x00653624
00653ca6 : ADD ESP,0xc
00653ca9 : MOV dword ptr [EBP + -0x1c],EAX
00653cac : JMP 0x00653cc4
00653cae : CALL 0x0063ab82
00653cb3 : MOV dword ptr [EAX],0x9
00653cb9 : CALL 0x0063ab95
00653cbe : MOV dword ptr [EAX],ESI
00653cc0 : OR dword ptr [EBP + -0x1c],0xffffffff
00653cc4 : MOV dword ptr [EBP + -0x4],0xfffffffe
00653ccb : CALL 0x00653cd9
00653cd0 : MOV EAX,dword ptr [EBP + -0x1c]
00653cd3 : CALL 0x0064c26d
00653cd8 : RET
