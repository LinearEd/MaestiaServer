PROGRAM  : Maestia.exe
FUNCTION : FUN_00508600
ENTRY    : 00508600
BODY     : [[00508600, 0050873c]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00508600(undefined4 param_1,undefined4 *param_2,uint param_3)

{
  uint *puVar1;
  int iVar2;
  int *piVar3;
  uint uVar4;
  uint *puVar5;
  int *in_ECX;
  int iVar6;
  uint uVar7;
  int iVar8;
  
  piVar3 = (int *)*in_ECX;
  if (piVar3 == (int *)0x0) {
    iVar8 = 8;
  }
  else {
    if ((uint)(*piVar3 * 5) <= piVar3[1] * 4 + 4U) goto LAB_0050863c;
    iVar8 = piVar3[1] * 2 + 2;
  }
  FUN_005074a0(param_1,iVar8);
LAB_0050863c:
  piVar3 = (int *)*in_ECX;
  param_3 = param_3 & piVar3[1];
  *piVar3 = *piVar3 + 1;
  iVar8 = *in_ECX;
  puVar1 = (uint *)(param_3 * 0x10 + 8 + iVar8);
  if (*puVar1 == 0xfffffffe) {
    *puVar1 = 0xffffffff;
    FUN_0051c600(*param_2);
    FUN_0051c600(param_2[1]);
    puVar1[1] = param_3;
    return;
  }
  uVar7 = param_3;
  do {
    uVar7 = uVar7 + 1 & *(uint *)(iVar8 + 4);
  } while (*(int *)(iVar8 + 8 + uVar7 * 0x10) != -2);
  iVar2 = uVar7 * 0x10 + 8 + iVar8;
  if (puVar1[1] != param_3) {
    iVar6 = puVar1[1] * 0x10;
    uVar4 = *(uint *)(iVar6 + 8 + iVar8);
    while (puVar5 = (uint *)(iVar6 + 8 + iVar8), uVar4 != param_3) {
      iVar6 = *puVar5 * 0x10;
      uVar4 = *(uint *)(iVar6 + 8 + iVar8);
    }
    if (iVar2 != 0) {
      FUN_00503700(puVar1);
    }
    *puVar5 = uVar7;
    FUN_0051bc20(*param_2);
    FUN_0051bc20(param_2[1]);
    puVar1[1] = param_3;
    *puVar1 = 0xffffffff;
    return;
  }
  if (iVar2 != 0) {
    FUN_00503700(puVar1);
  }
  FUN_0051bc20(*param_2);
  FUN_0051bc20(param_2[1]);
  puVar1[1] = param_3;
  *puVar1 = uVar7;
  return;
}



============================================================
DISASSEMBLY
============================================================
00508600 : PUSH EBX
00508601 : PUSH EBP
00508602 : PUSH ESI
00508603 : MOV ESI,ECX
00508605 : MOV EAX,dword ptr [ESI]
00508607 : PUSH EDI
00508608 : TEST EAX,EAX
0050860a : JNZ 0x00508615
0050860c : MOV EAX,dword ptr [ESP + 0x14]
00508610 : PUSH 0x8
00508612 : PUSH EAX
00508613 : JMP 0x00508637
00508615 : MOV ECX,dword ptr [EAX + 0x4]
00508618 : LEA EDX,[ECX*0x4 + 0x4]
0050861f : MOV ECX,dword ptr [EAX]
00508621 : LEA ECX,[ECX + ECX*0x4]
00508624 : CMP ECX,EDX
00508626 : JBE 0x0050863c
00508628 : MOV EDX,dword ptr [EAX + 0x4]
0050862b : MOV ECX,dword ptr [ESP + 0x14]
0050862f : LEA EAX,[EDX + EDX*0x1 + 0x2]
00508633 : PUSH EAX
00508634 : PUSH ECX
00508635 : MOV ECX,ESI
00508637 : CALL 0x005074a0
0050863c : MOV EAX,dword ptr [ESI]
0050863e : MOV EDI,dword ptr [ESP + 0x1c]
00508642 : AND EDI,dword ptr [EAX + 0x4]
00508645 : INC dword ptr [EAX]
00508647 : MOV EAX,dword ptr [ESI]
00508649 : MOV EDX,EDI
0050864b : SHL EDX,0x4
0050864e : LEA ESI,[EDX + EAX*0x1 + 0x8]
00508652 : MOV EDX,0xfffffffe
00508657 : CMP dword ptr [ESI],EDX
00508659 : JNZ 0x00508689
0050865b : MOV EBP,dword ptr [ESP + 0x18]
0050865f : MOV dword ptr [ESI],0xffffffff
00508665 : MOV EAX,dword ptr [EBP]
00508668 : LEA EBX,[ESI + 0x8]
0050866b : PUSH EAX
0050866c : MOV ECX,EBX
0050866e : CALL 0x0051c600
00508673 : MOV ECX,dword ptr [EBP + 0x4]
00508676 : PUSH ECX
00508677 : LEA ECX,[EBX + 0x4]
0050867a : CALL 0x0051c600
0050867f : MOV dword ptr [ESI + 0x4],EDI
00508682 : POP EDI
00508683 : POP ESI
00508684 : POP EBP
00508685 : POP EBX
00508686 : RET 0xc
00508689 : MOV ECX,dword ptr [EAX + 0x4]
0050868c : MOV EBX,EDI
0050868e : MOV EDI,EDI
00508690 : INC EBX
00508691 : AND EBX,ECX
00508693 : MOV EBP,EBX
00508695 : SHL EBP,0x4
00508698 : CMP dword ptr [EAX + EBP*0x1 + 0x8],EDX
0050869c : JNZ 0x00508690
0050869e : MOV EDX,EBX
005086a0 : SHL EDX,0x4
005086a3 : LEA ECX,[EDX + EAX*0x1 + 0x8]
005086a7 : MOV EDX,dword ptr [ESI + 0x4]
005086aa : CMP EDX,EDI
005086ac : JNZ 0x005086e5
005086ae : TEST ECX,ECX
005086b0 : JZ 0x005086b8
005086b2 : PUSH ESI
005086b3 : CALL 0x00503700
005086b8 : MOV EAX,dword ptr [ESP + 0x18]
005086bc : MOV ECX,dword ptr [EAX]
005086be : LEA EBP,[ESI + 0x8]
005086c1 : PUSH ECX
005086c2 : MOV ECX,EBP
005086c4 : CALL 0x0051bc20
005086c9 : MOV EDX,dword ptr [ESP + 0x18]
005086cd : MOV EAX,dword ptr [EDX + 0x4]
005086d0 : PUSH EAX
005086d1 : LEA ECX,[EBP + 0x4]
005086d4 : CALL 0x0051bc20
005086d9 : MOV dword ptr [ESI + 0x4],EDI
005086dc : POP EDI
005086dd : MOV dword ptr [ESI],EBX
005086df : POP ESI
005086e0 : POP EBP
005086e1 : POP EBX
005086e2 : RET 0xc
005086e5 : SHL EDX,0x4
005086e8 : CMP dword ptr [EDX + EAX*0x1 + 0x8],EDI
005086ec : LEA EBP,[EDX + EAX*0x1 + 0x8]
005086f0 : JZ 0x00508702
005086f2 : MOV EDX,dword ptr [EBP]
005086f5 : SHL EDX,0x4
005086f8 : CMP dword ptr [EDX + EAX*0x1 + 0x8],EDI
005086fc : LEA EBP,[EDX + EAX*0x1 + 0x8]
00508700 : JNZ 0x005086f2
00508702 : TEST ECX,ECX
00508704 : JZ 0x0050870c
00508706 : PUSH ESI
00508707 : CALL 0x00503700
0050870c : MOV dword ptr [EBP],EBX
0050870f : MOV EBP,dword ptr [ESP + 0x18]
00508713 : MOV EAX,dword ptr [EBP]
00508716 : LEA EBX,[ESI + 0x8]
00508719 : PUSH EAX
0050871a : MOV ECX,EBX
0050871c : CALL 0x0051bc20
00508721 : MOV ECX,dword ptr [EBP + 0x4]
00508724 : PUSH ECX
00508725 : LEA ECX,[EBX + 0x4]
00508728 : CALL 0x0051bc20
0050872d : MOV dword ptr [ESI + 0x4],EDI
00508730 : POP EDI
00508731 : MOV dword ptr [ESI],0xffffffff
00508737 : POP ESI
00508738 : POP EBP
00508739 : POP EBX
0050873a : RET 0xc
