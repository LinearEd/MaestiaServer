PROGRAM  : Maestia.exe
FUNCTION : FUN_00583ff0
ENTRY    : 00583ff0
BODY     : [[00583ff0, 005842f6]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00583ff0(uint param_1,undefined4 *param_2)

{
  byte bVar1;
  bool bVar2;
  uint uVar3;
  undefined4 *puVar4;
  char cVar5;
  GRefCountImpl *pGVar6;
  undefined4 *puVar7;
  byte *pbVar8;
  int iVar9;
  GRefCountImpl *this;
  int iVar10;
  undefined4 uVar11;
  LONG LVar12;
  byte *pbVar13;
  undefined4 unaff_EBX;
  int *piVar14;
  uint uVar15;
  bool bVar16;
  undefined1 *puVar17;
  undefined4 local_18;
  int iStack_14;
  char *pcStack_10;
  GRefCountImpl *pGStack_c;
  int *piStack_8;
  undefined4 uStack_4;
  
  uVar3 = param_1;
  local_18 = 0;
  pGVar6 = (GRefCountImpl *)(**(code **)(**(int **)(param_1 + 0x74) + 0x48))();
  if (pGVar6 == (GRefCountImpl *)0x0) {
    return 0;
  }
  pGStack_c = pGVar6;
  GRefCountImpl::AddRef(pGVar6);
  puVar4 = param_2;
  pcStack_10 = *(char **)*param_2;
  bVar2 = false;
  if ((*pcStack_10 != 'i') && (*pcStack_10 != 'I')) goto LAB_005841f8;
  FUN_00525d70(&iStack_14);
  puVar7 = (undefined4 *)FUN_005257b0(&piStack_8,0,6);
  pbVar8 = *(byte **)*puVar7;
  pbVar13 = &DAT_00b86600;
  do {
    bVar1 = *pbVar8;
    bVar16 = bVar1 < *pbVar13;
    if (bVar1 != *pbVar13) {
LAB_00584084:
      iVar9 = (1 - (uint)bVar16) - (uint)(bVar16 != 0);
      goto LAB_00584089;
    }
    if (bVar1 == 0) break;
    bVar1 = pbVar8[1];
    bVar16 = bVar1 < pbVar13[1];
    if (bVar1 != pbVar13[1]) goto LAB_00584084;
    pbVar8 = pbVar8 + 2;
    pbVar13 = pbVar13 + 2;
  } while (bVar1 != 0);
  iVar9 = 0;
LAB_00584089:
  piStack_8[2] = piStack_8[2] + -1;
  if (piStack_8[2] == 0) {
    FUN_00525340();
  }
  if (iVar9 == 0) {
LAB_005840e2:
    bVar2 = true;
  }
  else {
    puVar17 = &DAT_00b865f4;
    FUN_005257b0(&piStack_8,0,8);
    cVar5 = FUN_004ffc90(puVar17);
    piStack_8[2] = piStack_8[2] + -1;
    if (piStack_8[2] == 0) {
      FUN_00525340();
    }
    if (cVar5 != '\0') goto LAB_005840e2;
  }
  *(int *)(iStack_14 + 8) = *(int *)(iStack_14 + 8) + -1;
  if (*(int *)(iStack_14 + 8) == 0) {
    FUN_00525340();
  }
  if (bVar2) {
    iVar9 = FUN_005296a0();
    if (*(int *)(iVar9 + 0x100) == 0) {
      piVar14 = (int *)0x0;
    }
    else {
      piVar14 = (int *)(*(int *)(iVar9 + 0x100) + 8);
    }
    uVar11 = *(undefined4 *)(*(int *)(uVar3 + 0x78) + 0x288);
    pGVar6 = (GRefCountImpl *)(**(code **)(*piVar14 + 0xc))(4);
    this = (GRefCountImpl *)(**(code **)(*piVar14 + 0xc))(5);
    iVar9 = FUN_00513f20(0,this,pGVar6,uVar11);
    if (this != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(this);
    }
    if (pGVar6 != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(pGVar6);
    }
    if (iVar9 != 0) {
      iVar10 = FUN_00515840(0x38,0);
      if (iVar10 == 0) {
        uVar11 = 0;
      }
      else {
        uVar11 = FUN_00583780(uStack_4);
      }
      FUN_00583a00(uStack_4,iVar9,0);
      FUN_00524240();
      FUN_00524240();
      return uVar11;
    }
    FUN_0052e570(uStack_4,
                 "GASBitmapData::LoadBitmap: LoadMovieImageCallback failed to load image \"%s\"\n",0
                );
    FUN_00524240();
    return unaff_EBX;
  }
LAB_005841f8:
  piStack_8 = (int *)0x0;
  uStack_4 = 0;
  FUN_0051c480(*(undefined4 *)*puVar4);
  cVar5 = FUN_005649d0(&piStack_8,&param_1);
  uVar15 = param_1 & 0xfffffffc;
  LVar12 = InterlockedExchangeAdd((LONG *)(uVar15 + 4),-1);
  if (LVar12 == 1) {
    FUN_00515cf0(uVar15);
  }
  if (cVar5 != '\0') {
    uVar15 = (**(code **)(*piStack_8 + 8))();
    piVar14 = piStack_8;
    if ((uVar15 & 0xff00) == 0x100) {
      if (piStack_8 != (int *)0x0) {
        iVar9 = FUN_00515840(0x38,0);
        if (iVar9 == 0) {
          local_18 = 0;
        }
        else {
          local_18 = FUN_00583780(uVar3);
        }
        FUN_00583a00(uVar3,piVar14,pGVar6);
        if (piStack_8 != (int *)0x0) {
          FUN_00524240();
        }
      }
      FUN_00524240();
      return local_18;
    }
    if (piStack_8 != (int *)0x0) {
      FUN_00524240();
    }
    FUN_00524240();
    return 0;
  }
  if (piStack_8 != (int *)0x0) {
    FUN_00524240();
  }
  FUN_00524240();
  return 0;
}



============================================================
DISASSEMBLY
============================================================
00583ff0 : SUB ESP,0x1c
00583ff3 : PUSH EBX
00583ff4 : PUSH EBP
00583ff5 : MOV EBP,dword ptr [ESP + 0x28]
00583ff9 : MOV ECX,dword ptr [EBP + 0x74]
00583ffc : MOV EAX,dword ptr [ECX]
00583ffe : MOV EDX,dword ptr [EAX + 0x48]
00584001 : PUSH ESI
00584002 : XOR EBX,EBX
00584004 : PUSH EDI
00584005 : MOV dword ptr [ESP + 0x14],EBX
00584009 : CALL EDX
0058400b : MOV EDI,EAX
0058400d : MOV dword ptr [ESP + 0x20],EDI
00584011 : CMP EDI,EBX
00584013 : JZ 0x005842eb
00584019 : MOV ECX,EDI
0058401b : CALL 0x00523dd0
00584020 : MOV ESI,dword ptr [ESP + 0x34]
00584024 : MOV EAX,dword ptr [ESI]
00584026 : MOV EAX,dword ptr [EAX]
00584028 : MOV dword ptr [ESP + 0x1c],EAX
0058402c : MOV AL,byte ptr [EAX]
0058402e : MOV byte ptr [ESP + 0x13],BL
00584032 : CMP AL,0x69
00584034 : JZ 0x0058403e
00584036 : CMP AL,0x49
00584038 : JNZ 0x005841f8
0058403e : LEA ECX,[ESP + 0x18]
00584042 : PUSH ECX
00584043 : MOV ECX,ESI
00584045 : CALL 0x00525d70
0058404a : PUSH 0x6
0058404c : PUSH EBX
0058404d : LEA EDX,[ESP + 0x2c]
00584051 : PUSH EDX
00584052 : LEA ECX,[ESP + 0x24]
00584056 : CALL 0x005257b0
0058405b : MOV EAX,dword ptr [EAX]
0058405d : MOV EAX,dword ptr [EAX]
0058405f : MOV ECX,0xb86600
00584064 : MOV DL,byte ptr [EAX]
00584066 : CMP DL,byte ptr [ECX]
00584068 : JNZ 0x00584084
0058406a : TEST DL,DL
0058406c : JZ 0x00584080
0058406e : MOV DL,byte ptr [EAX + 0x1]
00584071 : CMP DL,byte ptr [ECX + 0x1]
00584074 : JNZ 0x00584084
00584076 : ADD EAX,0x2
00584079 : ADD ECX,0x2
0058407c : TEST DL,DL
0058407e : JNZ 0x00584064
00584080 : XOR EAX,EAX
00584082 : JMP 0x00584089
00584084 : SBB EAX,EAX
00584086 : SBB EAX,-0x1
00584089 : CMP EAX,EBX
0058408b : MOV EAX,dword ptr [ESP + 0x24]
0058408f : SETZ BL
00584092 : DEC dword ptr [EAX + 0x8]
00584095 : MOV ECX,EAX
00584097 : ADD EAX,0x8
0058409a : CMP dword ptr [EAX],0x0
0058409d : JNZ 0x005840a4
0058409f : CALL 0x00525340
005840a4 : TEST BL,BL
005840a6 : JNZ 0x005840e2
005840a8 : PUSH 0xb865f4
005840ad : PUSH 0x8
005840af : PUSH 0x0
005840b1 : LEA ECX,[ESP + 0x30]
005840b5 : PUSH ECX
005840b6 : LEA ECX,[ESP + 0x28]
005840ba : CALL 0x005257b0
005840bf : MOV ECX,EAX
005840c1 : CALL 0x004ffc90
005840c6 : MOV BL,AL
005840c8 : MOV EAX,dword ptr [ESP + 0x24]
005840cc : DEC dword ptr [EAX + 0x8]
005840cf : MOV ECX,EAX
005840d1 : ADD EAX,0x8
005840d4 : CMP dword ptr [EAX],0x0
005840d7 : JNZ 0x005840de
005840d9 : CALL 0x00525340
005840de : TEST BL,BL
005840e0 : JZ 0x005840e7
005840e2 : MOV byte ptr [ESP + 0x13],0x1
005840e7 : MOV EAX,dword ptr [ESP + 0x18]
005840eb : DEC dword ptr [EAX + 0x8]
005840ee : MOV ECX,EAX
005840f0 : ADD EAX,0x8
005840f3 : CMP dword ptr [EAX],0x0
005840f6 : JNZ 0x005840fd
005840f8 : CALL 0x00525340
005840fd : CMP byte ptr [ESP + 0x13],0x0
00584102 : JZ 0x005841f6
00584108 : MOV ECX,EBP
0058410a : CALL 0x005296a0
0058410f : ADD EAX,0x100
00584114 : MOV EAX,dword ptr [EAX]
00584116 : TEST EAX,EAX
00584118 : JZ 0x0058411f
0058411a : LEA ESI,[EAX + 0x8]
0058411d : JMP 0x00584121
0058411f : XOR ESI,ESI
00584121 : MOV EDX,dword ptr [EBP + 0x78]
00584124 : MOV EAX,dword ptr [ESI]
00584126 : MOV EBP,dword ptr [EDX + 0x288]
0058412c : MOV EDX,dword ptr [EAX + 0xc]
0058412f : PUSH 0x4
00584131 : MOV ECX,ESI
00584133 : CALL EDX
00584135 : MOV EDI,EAX
00584137 : MOV EAX,dword ptr [ESI]
00584139 : MOV EDX,dword ptr [EAX + 0xc]
0058413c : PUSH 0x5
0058413e : MOV ECX,ESI
00584140 : CALL EDX
00584142 : PUSH EBP
00584143 : MOV ESI,EAX
00584145 : MOV EAX,dword ptr [ESP + 0x20]
00584149 : PUSH EDI
0058414a : PUSH ESI
0058414b : PUSH EAX
0058414c : CALL 0x00513f20
00584151 : ADD ESP,0x10
00584154 : MOV EBX,EAX
00584156 : TEST ESI,ESI
00584158 : JZ 0x00584161
0058415a : MOV ECX,ESI
0058415c : CALL 0x004ff7e0
00584161 : TEST EDI,EDI
00584163 : JZ 0x0058416c
00584165 : MOV ECX,EDI
00584167 : CALL 0x004ff7e0
0058416c : TEST EBX,EBX
0058416e : JZ 0x005841c8
00584170 : PUSH 0x0
00584172 : PUSH 0x38
00584174 : MOV ECX,EBP
00584176 : CALL 0x00515840
0058417b : TEST EAX,EAX
0058417d : JZ 0x00584191
0058417f : MOV ECX,dword ptr [ESP + 0x30]
00584183 : PUSH ECX
00584184 : MOV ECX,EAX
00584186 : CALL 0x00583780
0058418b : MOV dword ptr [ESP + 0x14],EAX
0058418f : JMP 0x00584199
00584191 : MOV dword ptr [ESP + 0x14],0x0
00584199 : MOV EDX,dword ptr [ESP + 0x30]
0058419d : MOV ECX,dword ptr [ESP + 0x14]
005841a1 : PUSH 0x0
005841a3 : PUSH EBX
005841a4 : PUSH EDX
005841a5 : CALL 0x00583a00
005841aa : MOV ECX,EBX
005841ac : CALL 0x00524240
005841b1 : MOV EDI,dword ptr [ESP + 0x20]
005841b5 : MOV ECX,EDI
005841b7 : CALL 0x00524240
005841bc : MOV EAX,dword ptr [ESP + 0x14]
005841c0 : POP EDI
005841c1 : POP ESI
005841c2 : POP EBP
005841c3 : POP EBX
005841c4 : ADD ESP,0x1c
005841c7 : RET
005841c8 : MOV EAX,dword ptr [ESP + 0x1c]
005841cc : MOV ECX,dword ptr [ESP + 0x30]
005841d0 : PUSH EAX
005841d1 : PUSH 0xb8dd08
005841d6 : PUSH ECX
005841d7 : CALL 0x0052e570
005841dc : MOV EDI,dword ptr [ESP + 0x2c]
005841e0 : ADD ESP,0xc
005841e3 : MOV ECX,EDI
005841e5 : CALL 0x00524240
005841ea : MOV EAX,dword ptr [ESP + 0x14]
005841ee : POP EDI
005841ef : POP ESI
005841f0 : POP EBP
005841f1 : POP EBX
005841f2 : ADD ESP,0x1c
005841f5 : RET
005841f6 : XOR EBX,EBX
005841f8 : MOV EDX,dword ptr [ESI]
005841fa : MOV dword ptr [ESP + 0x24],EBX
005841fe : MOV dword ptr [ESP + 0x28],EBX
00584202 : MOV EAX,dword ptr [EDX]
00584204 : PUSH EAX
00584205 : LEA ECX,[ESP + 0x34]
00584209 : CALL 0x0051c480
0058420e : LEA ECX,[ESP + 0x30]
00584212 : PUSH ECX
00584213 : LEA EDX,[ESP + 0x28]
00584217 : PUSH EDX
00584218 : MOV ECX,EDI
0058421a : CALL 0x005649d0
0058421f : MOV ESI,dword ptr [ESP + 0x30]
00584223 : TEST AL,AL
00584225 : SETZ BL
00584228 : AND ESI,0xfffffffc
0058422b : PUSH -0x1
0058422d : LEA EAX,[ESI + 0x4]
00584230 : PUSH EAX
00584231 : CALL dword ptr [0x00b851cc]
00584237 : SUB EAX,0x1
0058423a : JNZ 0x00584242
0058423c : PUSH ESI
0058423d : CALL 0x00515cf0
00584242 : MOV ECX,dword ptr [ESP + 0x24]
00584246 : TEST BL,BL
00584248 : JZ 0x00584264
0058424a : TEST ECX,ECX
0058424c : JZ 0x00584253
0058424e : CALL 0x00524240
00584253 : MOV ECX,EDI
00584255 : CALL 0x00524240
0058425a : POP EDI
0058425b : POP ESI
0058425c : POP EBP
0058425d : XOR EAX,EAX
0058425f : POP EBX
00584260 : ADD ESP,0x1c
00584263 : RET
00584264 : MOV EDX,dword ptr [ECX]
00584266 : MOV EAX,dword ptr [EDX + 0x8]
00584269 : CALL EAX
0058426b : AND EAX,0xff00
00584270 : CMP EAX,0x100
00584275 : JZ 0x00584295
00584277 : MOV ECX,dword ptr [ESP + 0x24]
0058427b : TEST ECX,ECX
0058427d : JZ 0x00584284
0058427f : CALL 0x00524240
00584284 : MOV ECX,EDI
00584286 : CALL 0x00524240
0058428b : POP EDI
0058428c : POP ESI
0058428d : POP EBP
0058428e : XOR EAX,EAX
00584290 : POP EBX
00584291 : ADD ESP,0x1c
00584294 : RET
00584295 : MOV EAX,dword ptr [ESP + 0x24]
00584299 : MOV ESI,EAX
0058429b : TEST EAX,EAX
0058429d : JZ 0x005842e4
0058429f : MOV ECX,dword ptr [EBP + 0x78]
005842a2 : MOV ECX,dword ptr [ECX + 0x288]
005842a8 : PUSH 0x0
005842aa : PUSH 0x38
005842ac : CALL 0x00515840
005842b1 : TEST EAX,EAX
005842b3 : JZ 0x005842c3
005842b5 : PUSH EBP
005842b6 : MOV ECX,EAX
005842b8 : CALL 0x00583780
005842bd : MOV dword ptr [ESP + 0x14],EAX
005842c1 : JMP 0x005842cb
005842c3 : MOV dword ptr [ESP + 0x14],0x0
005842cb : MOV ECX,dword ptr [ESP + 0x14]
005842cf : PUSH EDI
005842d0 : PUSH ESI
005842d1 : PUSH EBP
005842d2 : CALL 0x00583a00
005842d7 : MOV ECX,dword ptr [ESP + 0x24]
005842db : TEST ECX,ECX
005842dd : JZ 0x005842e4
005842df : CALL 0x00524240
005842e4 : MOV ECX,EDI
005842e6 : CALL 0x00524240
005842eb : MOV EAX,dword ptr [ESP + 0x14]
005842ef : POP EDI
005842f0 : POP ESI
005842f1 : POP EBP
005842f2 : POP EBX
005842f3 : ADD ESP,0x1c
005842f6 : RET
