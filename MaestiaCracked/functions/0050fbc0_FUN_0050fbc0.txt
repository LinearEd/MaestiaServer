PROGRAM  : Maestia.exe
FUNCTION : FUN_0050fbc0
ENTRY    : 0050fbc0
BODY     : [[0050fbc0, 0050fe97]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0050fbc0(void)

{
  byte bVar1;
  int iVar2;
  uint uVar3;
  int iVar4;
  byte *pbVar5;
  GRefCountNTSImpl *pGVar6;
  LONG LVar7;
  int in_ECX;
  byte *pbVar8;
  int iVar9;
  int iVar10;
  int iVar11;
  bool bVar12;
  uint local_60;
  int local_5c;
  uint local_54;
  GRefCountNTSImpl *local_44;
  undefined4 local_40;
  undefined4 local_3c;
  int local_38;
  int local_34;
  GRefCountNTSImpl *local_30;
  undefined4 local_2c;
  undefined4 local_28;
  undefined1 local_24 [12];
  GRefCountImpl *local_18;
  int local_8;
  uint local_4;
  
  iVar2 = *(int *)(in_ECX + 0xd0);
  if (iVar2 != 0) {
    *(undefined4 *)(iVar2 + 0x10) = 0;
    *(undefined4 *)(iVar2 + 0x14) = 0;
    *(undefined4 *)(iVar2 + 0x18) = 0;
    *(undefined4 *)(iVar2 + 0x1c) = 0;
    *(undefined4 *)(iVar2 + 0x20) = 0;
    *(undefined4 *)(iVar2 + 0x24) = 0;
    *(undefined4 *)(iVar2 + 0x28) = 0;
    *(undefined4 *)(iVar2 + 0x2c) = 0;
    FUN_0050f050(*(int *)(in_ECX + 0xd0) + 4,0);
    iVar2 = *(int *)(*(int *)(in_ECX + 0xa0) + 0xc);
    FUN_0051b6e0();
    uVar3 = *(uint *)(iVar2 + 0x10);
    iVar10 = 0;
    iVar9 = 0;
    local_54 = 0;
    if (uVar3 != 0) {
      do {
        if (local_54 < *(uint *)(iVar2 + 0x10)) {
          local_5c = *(int *)(*(int *)(iVar2 + 0xc) + local_54 * 4);
        }
        else {
          local_5c = 0;
        }
        FUN_0053cca0(local_24);
        if (local_4 < *(uint *)(local_8 + 4)) {
          do {
            iVar4 = FUN_0053cdb0();
            iVar11 = *(int *)(iVar4 + 4) + *(int *)(local_5c + 0x1c);
            iVar4 = FUN_0053cdb0();
            if (((*(ushort *)(*(int *)(iVar4 + 0xc) + 0x2a) & 0x100) != 0) &&
               (iVar4 = FUN_0051b1a0(), iVar4 != 0)) {
              if ((*(uint *)(local_60 & 0xfffffffc) & 0x7fffffff) != 0) {
                if (iVar11 == iVar9 + iVar10) {
                  iVar4 = FUN_0053cdb0();
                  pbVar8 = (byte *)((*(uint *)(*(int *)(iVar4 + 0xc) + 0x10) & 0xfffffffc) + 8);
                  pbVar5 = (byte *)((local_60 & 0xfffffffc) + 8);
                  do {
                    bVar1 = *pbVar5;
                    bVar12 = bVar1 < *pbVar8;
                    if (bVar1 != *pbVar8) {
LAB_0050fd10:
                      iVar4 = (1 - (uint)bVar12) - (uint)(bVar12 != 0);
                      goto LAB_0050fd15;
                    }
                    if (bVar1 == 0) break;
                    bVar1 = pbVar5[1];
                    bVar12 = bVar1 < pbVar8[1];
                    if (bVar1 != pbVar8[1]) goto LAB_0050fd10;
                    pbVar5 = pbVar5 + 2;
                    pbVar8 = pbVar8 + 2;
                  } while (bVar1 != 0);
                  iVar4 = 0;
LAB_0050fd15:
                  if (iVar4 == 0) {
                    iVar4 = FUN_0053cdb0();
                    iVar9 = iVar9 + *(int *)(iVar4 + 8);
                    goto LAB_0050fda4;
                  }
                }
                pGVar6 = (GRefCountNTSImpl *)FUN_00544000(iVar10,iVar9 + iVar10);
                FUN_0050e5b0(iVar10,iVar9);
                if (pGVar6 != (GRefCountNTSImpl *)0x0) {
                  *(int *)(pGVar6 + 4) = *(int *)(pGVar6 + 4) + 1;
                }
                local_2c = 0;
                local_28 = 0;
                local_38 = iVar10;
                local_34 = iVar9;
                local_30 = pGVar6;
                FUN_0050f5a0(&local_38);
                if (local_30 != (GRefCountNTSImpl *)0x0) {
                  GRefCountNTSImpl::Release(local_30);
                }
                FUN_0051bf30();
                if (pGVar6 != (GRefCountNTSImpl *)0x0) {
                  GRefCountNTSImpl::Release(pGVar6);
                }
              }
LAB_0050fda4:
              if ((*(uint *)(local_60 & 0xfffffffc) & 0x7fffffff) == 0) {
                iVar9 = FUN_0053cdb0();
                iVar9 = *(int *)(iVar9 + 8);
                iVar10 = FUN_0053cdb0();
                FUN_0051bc20(*(int *)(iVar10 + 0xc) + 0x10);
                iVar10 = iVar11;
              }
            }
            FUN_0053ce50();
          } while (local_4 < *(uint *)(local_8 + 4));
        }
        if (local_18 != (GRefCountImpl *)0x0) {
          GRefCountImpl::Release(local_18);
        }
        local_54 = local_54 + 1;
      } while (local_54 < uVar3);
    }
    if ((*(uint *)(local_60 & 0xfffffffc) & 0x7fffffff) != 0) {
      local_40 = 0;
      local_3c = 0;
      pGVar6 = (GRefCountNTSImpl *)FUN_00544000(iVar10,iVar9 + iVar10);
      local_44 = pGVar6;
      FUN_0050f9e0(iVar10,iVar9,&local_44);
      if (pGVar6 != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release(pGVar6);
      }
    }
    LVar7 = InterlockedExchangeAdd((LONG *)((local_60 & 0xfffffffc) + 4),-1);
    if (LVar7 == 1) {
      FUN_00515cf0(local_60 & 0xfffffffc);
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
0050fbc0 : SUB ESP,0x60
0050fbc3 : PUSH EDI
0050fbc4 : MOV EDI,ECX
0050fbc6 : MOV ECX,dword ptr [EDI + 0xd0]
0050fbcc : MOV dword ptr [ESP + 0xc],EDI
0050fbd0 : TEST ECX,ECX
0050fbd2 : JZ 0x0050fe93
0050fbd8 : XOR EAX,EAX
0050fbda : MOV dword ptr [ECX + 0x10],EAX
0050fbdd : MOV dword ptr [ECX + 0x14],EAX
0050fbe0 : MOV dword ptr [ECX + 0x18],EAX
0050fbe3 : MOV dword ptr [ECX + 0x1c],EAX
0050fbe6 : MOV dword ptr [ECX + 0x20],EAX
0050fbe9 : PUSH EBX
0050fbea : MOV dword ptr [ECX + 0x24],EAX
0050fbed : PUSH EBP
0050fbee : MOV dword ptr [ECX + 0x28],EAX
0050fbf1 : MOV dword ptr [ECX + 0x2c],EAX
0050fbf4 : MOV ECX,dword ptr [EDI + 0xd0]
0050fbfa : PUSH ESI
0050fbfb : ADD ECX,0x4
0050fbfe : PUSH EAX
0050fbff : PUSH ECX
0050fc00 : CALL 0x0050f050
0050fc05 : MOV EAX,dword ptr [EDI + 0xa0]
0050fc0b : MOV ESI,dword ptr [EAX + 0xc]
0050fc0e : LEA ECX,[ESP + 0x10]
0050fc12 : MOV dword ptr [ESP + 0x24],ESI
0050fc16 : CALL 0x0051b6e0
0050fc1b : MOV EAX,dword ptr [ESI + 0x10]
0050fc1e : XOR ECX,ECX
0050fc20 : XOR EBP,EBP
0050fc22 : XOR EBX,EBX
0050fc24 : MOV dword ptr [ESP + 0x28],EAX
0050fc28 : MOV dword ptr [ESP + 0x1c],ECX
0050fc2c : TEST EAX,EAX
0050fc2e : JBE 0x0050fe1c
0050fc34 : JMP 0x0050fc3a
0050fc36 : MOV ECX,dword ptr [ESP + 0x1c]
0050fc3a : CMP ECX,dword ptr [ESI + 0x10]
0050fc3d : JNC 0x0050fc4b
0050fc3f : MOV EDX,dword ptr [ESI + 0xc]
0050fc42 : MOV EAX,dword ptr [EDX + ECX*0x4]
0050fc45 : MOV dword ptr [ESP + 0x14],EAX
0050fc49 : JMP 0x0050fc53
0050fc4b : MOV dword ptr [ESP + 0x14],0x0
0050fc53 : LEA ECX,[ESP + 0x4c]
0050fc57 : PUSH ECX
0050fc58 : MOV ECX,dword ptr [ESP + 0x18]
0050fc5c : CALL 0x0053cca0
0050fc61 : MOV EDX,dword ptr [ESP + 0x6c]
0050fc65 : MOV EAX,dword ptr [ESP + 0x68]
0050fc69 : CMP EDX,dword ptr [EAX + 0x4]
0050fc6c : JNC 0x0050fdfc
0050fc72 : LEA ECX,[ESP + 0x4c]
0050fc76 : CALL 0x0053cdb0
0050fc7b : MOV ESI,dword ptr [EAX + 0x4]
0050fc7e : MOV ECX,dword ptr [ESP + 0x14]
0050fc82 : ADD ESI,dword ptr [ECX + 0x1c]
0050fc85 : LEA ECX,[ESP + 0x4c]
0050fc89 : MOV dword ptr [ESP + 0x20],ESI
0050fc8d : CALL 0x0053cdb0
0050fc92 : MOV EAX,dword ptr [EAX + 0xc]
0050fc95 : MOV EDX,0x100
0050fc9a : TEST word ptr [EAX + 0x2a],DX
0050fc9e : JZ 0x0050fdda
0050fca4 : LEA ECX,[EAX + 0x10]
0050fca7 : CALL 0x0051b1a0
0050fcac : TEST EAX,EAX
0050fcae : JZ 0x0050fdda
0050fcb4 : MOV EAX,dword ptr [ESP + 0x10]
0050fcb8 : AND EAX,0xfffffffc
0050fcbb : TEST dword ptr [EAX],0x7fffffff
0050fcc1 : JZ 0x0050fda4
0050fcc7 : LEA EDI,[EBX + EBP*0x1]
0050fcca : CMP ESI,EDI
0050fccc : JNZ 0x0050fd2a
0050fcce : LEA ECX,[ESP + 0x4c]
0050fcd2 : CALL 0x0053cdb0
0050fcd7 : MOV ECX,dword ptr [EAX + 0xc]
0050fcda : MOV ECX,dword ptr [ECX + 0x10]
0050fcdd : MOV EAX,dword ptr [ESP + 0x10]
0050fce1 : AND ECX,0xfffffffc
0050fce4 : AND EAX,0xfffffffc
0050fce7 : ADD ECX,0x8
0050fcea : ADD EAX,0x8
0050fced : LEA ECX,[ECX]
0050fcf0 : MOV DL,byte ptr [EAX]
0050fcf2 : CMP DL,byte ptr [ECX]
0050fcf4 : JNZ 0x0050fd10
0050fcf6 : TEST DL,DL
0050fcf8 : JZ 0x0050fd0c
0050fcfa : MOV DL,byte ptr [EAX + 0x1]
0050fcfd : CMP DL,byte ptr [ECX + 0x1]
0050fd00 : JNZ 0x0050fd10
0050fd02 : ADD EAX,0x2
0050fd05 : ADD ECX,0x2
0050fd08 : TEST DL,DL
0050fd0a : JNZ 0x0050fcf0
0050fd0c : XOR EAX,EAX
0050fd0e : JMP 0x0050fd15
0050fd10 : SBB EAX,EAX
0050fd12 : SBB EAX,-0x1
0050fd15 : TEST EAX,EAX
0050fd17 : JNZ 0x0050fd2a
0050fd19 : LEA ECX,[ESP + 0x4c]
0050fd1d : CALL 0x0053cdb0
0050fd22 : ADD EBX,dword ptr [EAX + 0x8]
0050fd25 : JMP 0x0050fda4
0050fd2a : MOV EDX,dword ptr [ESP + 0x18]
0050fd2e : MOV EAX,dword ptr [EDX + 0xa0]
0050fd34 : MOV ECX,dword ptr [EAX + 0xc]
0050fd37 : PUSH EDI
0050fd38 : PUSH EBP
0050fd39 : CALL 0x00544000
0050fd3e : MOV ECX,dword ptr [ESP + 0x18]
0050fd42 : MOV ESI,dword ptr [ECX + 0xd0]
0050fd48 : PUSH EBX
0050fd49 : ADD ESI,0x4
0050fd4c : PUSH EBP
0050fd4d : MOV ECX,ESI
0050fd4f : MOV EDI,EAX
0050fd51 : CALL 0x0050e5b0
0050fd56 : XOR EAX,EAX
0050fd58 : MOV dword ptr [ESP + 0x38],EBP
0050fd5c : MOV dword ptr [ESP + 0x3c],EBX
0050fd60 : CMP EDI,EAX
0050fd62 : JZ 0x0050fd67
0050fd64 : INC dword ptr [EDI + 0x4]
0050fd67 : LEA EDX,[ESP + 0x38]
0050fd6b : PUSH EDX
0050fd6c : MOV ECX,ESI
0050fd6e : MOV dword ptr [ESP + 0x44],EDI
0050fd72 : MOV dword ptr [ESP + 0x48],EAX
0050fd76 : MOV dword ptr [ESP + 0x4c],EAX
0050fd7a : CALL 0x0050f5a0
0050fd7f : MOV ECX,dword ptr [ESP + 0x40]
0050fd83 : TEST ECX,ECX
0050fd85 : JZ 0x0050fd8c
0050fd87 : CALL 0x004ff7c0
0050fd8c : LEA ECX,[ESP + 0x10]
0050fd90 : CALL 0x0051bf30
0050fd95 : TEST EDI,EDI
0050fd97 : JZ 0x0050fda0
0050fd99 : MOV ECX,EDI
0050fd9b : CALL 0x004ff7c0
0050fda0 : MOV ESI,dword ptr [ESP + 0x20]
0050fda4 : MOV EAX,dword ptr [ESP + 0x10]
0050fda8 : AND EAX,0xfffffffc
0050fdab : TEST dword ptr [EAX],0x7fffffff
0050fdb1 : JNZ 0x0050fdda
0050fdb3 : LEA ECX,[ESP + 0x4c]
0050fdb7 : MOV EBP,ESI
0050fdb9 : CALL 0x0053cdb0
0050fdbe : MOV EBX,dword ptr [EAX + 0x8]
0050fdc1 : LEA ECX,[ESP + 0x4c]
0050fdc5 : CALL 0x0053cdb0
0050fdca : MOV EAX,dword ptr [EAX + 0xc]
0050fdcd : ADD EAX,0x10
0050fdd0 : PUSH EAX
0050fdd1 : LEA ECX,[ESP + 0x14]
0050fdd5 : CALL 0x0051bc20
0050fdda : LEA ECX,[ESP + 0x4c]
0050fdde : CALL 0x0053ce50
0050fde3 : MOV ECX,dword ptr [ESP + 0x6c]
0050fde7 : MOV EDX,dword ptr [ESP + 0x68]
0050fdeb : CMP ECX,dword ptr [EDX + 0x4]
0050fdee : JC 0x0050fc72
0050fdf4 : MOV EDI,dword ptr [ESP + 0x18]
0050fdf8 : MOV ESI,dword ptr [ESP + 0x24]
0050fdfc : MOV ECX,dword ptr [ESP + 0x58]
0050fe00 : TEST ECX,ECX
0050fe02 : JZ 0x0050fe09
0050fe04 : CALL 0x004ff7e0
0050fe09 : MOV EAX,dword ptr [ESP + 0x1c]
0050fe0d : INC EAX
0050fe0e : MOV dword ptr [ESP + 0x1c],EAX
0050fe12 : CMP EAX,dword ptr [ESP + 0x28]
0050fe16 : JC 0x0050fc36
0050fe1c : MOV EAX,dword ptr [ESP + 0x10]
0050fe20 : MOV ECX,EAX
0050fe22 : AND ECX,0xfffffffc
0050fe25 : TEST dword ptr [ECX],0x7fffffff
0050fe2b : JZ 0x0050fe74
0050fe2d : MOV EDX,dword ptr [EDI + 0xa0]
0050fe33 : MOV ECX,dword ptr [EDX + 0xc]
0050fe36 : XOR EAX,EAX
0050fe38 : MOV dword ptr [ESP + 0x30],EAX
0050fe3c : MOV dword ptr [ESP + 0x34],EAX
0050fe40 : LEA EAX,[EBX + EBP*0x1]
0050fe43 : PUSH EAX
0050fe44 : PUSH EBP
0050fe45 : CALL 0x00544000
0050fe4a : LEA ECX,[ESP + 0x2c]
0050fe4e : PUSH ECX
0050fe4f : MOV ECX,dword ptr [EDI + 0xd0]
0050fe55 : PUSH EBX
0050fe56 : MOV ESI,EAX
0050fe58 : PUSH EBP
0050fe59 : ADD ECX,0x4
0050fe5c : MOV dword ptr [ESP + 0x38],ESI
0050fe60 : CALL 0x0050f9e0
0050fe65 : TEST ESI,ESI
0050fe67 : JZ 0x0050fe70
0050fe69 : MOV ECX,ESI
0050fe6b : CALL 0x004ff7c0
0050fe70 : MOV EAX,dword ptr [ESP + 0x10]
0050fe74 : AND EAX,0xfffffffc
0050fe77 : MOV ESI,EAX
0050fe79 : PUSH -0x1
0050fe7b : LEA EDX,[ESI + 0x4]
0050fe7e : PUSH EDX
0050fe7f : CALL dword ptr [0x00b851cc]
0050fe85 : SUB EAX,0x1
0050fe88 : JNZ 0x0050fe90
0050fe8a : PUSH ESI
0050fe8b : CALL 0x00515cf0
0050fe90 : POP ESI
0050fe91 : POP EBP
0050fe92 : POP EBX
0050fe93 : POP EDI
0050fe94 : ADD ESP,0x60
0050fe97 : RET
