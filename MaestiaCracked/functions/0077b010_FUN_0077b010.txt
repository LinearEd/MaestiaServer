PROGRAM  : Maestia.exe
FUNCTION : FUN_0077b010
ENTRY    : 0077b010
BODY     : [[0077b010, 0077b2d7]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_0077b010(int param_1)

{
  int iVar1;
  int iVar2;
  int iVar3;
  int *piVar4;
  char cVar5;
  uint uVar6;
  int iVar7;
  DWORD DVar8;
  int iVar9;
  int *piVar10;
  int *piVar11;
  wchar_t *pwVar12;
  LPCRITICAL_SECTION local_4c;
  char *local_48;
  undefined4 local_44;
  int local_40;
  undefined4 local_3c;
  undefined4 local_38;
  float local_34;
  undefined4 local_30;
  undefined4 local_2c;
  undefined4 local_28;
  int *local_24;
  int *local_20;
  int local_1c;
  int local_18;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b3985d;
  local_10 = ExceptionList;
  uVar6 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_4c = (LPCRITICAL_SECTION)(param_1 + 0x2eef0);
  local_40 = 0;
  local_48 = ".\\Terrain\\AvaPathFinder.cpp";
  local_44 = 0x469;
  local_3c = 1;
  FUN_006ef1a0(&local_4c);
  local_8 = 0;
  cVar5 = FUN_00486300(uVar6);
  if (cVar5 == '\0') {
    piVar11 = *(int **)(param_1 + 0x24);
    local_18 = param_1 + 0x30;
    local_2c = 0;
    local_28 = 0;
    FUN_00406ea0(param_1 + 0xb4);
    if (piVar11 != *(int **)(param_1 + 0x28)) {
      do {
        cVar5 = FUN_00486300(uVar6);
        if (cVar5 != '\0') {
          FUN_00476f00();
          break;
        }
        local_1c = *piVar11;
        piVar10 = piVar11 + 1;
        local_24 = piVar10;
        local_20 = piVar11;
        if (piVar10 == *(int **)(param_1 + 0x28)) {
LAB_0077b1f4:
          FUN_00486150(param_1 + 0xa8);
          FUN_004858e0(param_1);
          FUN_0077ad60(param_1);
          if (*(char *)(param_1 + 0x2eee9) == '\0') {
            DVar8 = GetTickCount();
            uVar6 = DVar8 - *(int *)(param_1 + 0x2eecc);
            *(uint *)(param_1 + 0x2eed0) = uVar6;
            if (uVar6 <= *(uint *)(param_1 + 0x2eed4)) {
              local_8 = 0xffffffff;
              if (local_40 != 0) {
                LeaveCriticalSection(local_4c);
              }
              ExceptionList = local_10;
              return 1;
            }
            pwVar12 = L"====== Path Find Time Over ======";
          }
          else {
            pwVar12 = L"====== Path Find Force Abort ======";
          }
          FUN_008018d0(pwVar12);
          FUN_00476f00();
          local_8 = 0xffffffff;
          if (local_40 == 0) {
            ExceptionList = local_10;
            return 0;
          }
          LeaveCriticalSection(local_4c);
          ExceptionList = local_10;
          return 0;
        }
LAB_0077b0d0:
        piVar4 = local_20;
        iVar1 = *piVar10;
        iVar2 = *(int *)(local_1c + 0x10);
        iVar3 = *(int *)(iVar1 + 0x10);
        iVar9 = *(int *)(local_1c + 0xc) - *(int *)(iVar1 + 0xc);
        iVar7 = iVar2 - iVar3;
        if (iVar9 < 1) {
LAB_0077b0f2:
          if (*(int *)(local_1c + 0xc) == *(int *)(iVar1 + 0xc)) {
            if ((-1 < iVar7) && (iVar7 < 1)) goto LAB_0077b135;
          }
          else if ((-1 < iVar9) || (iVar2 != iVar3)) goto LAB_0077b135;
LAB_0077b0fa:
          cVar5 = FUN_0077aba0(iVar1);
          if (cVar5 != '\0') {
            local_20 = piVar10;
          }
          cVar5 = FUN_00486300();
          if (cVar5 != '\0') {
            FUN_00476f00();
            local_8 = 0xffffffff;
            if (local_40 == 0) {
              ExceptionList = local_10;
              return 0;
            }
            LeaveCriticalSection(local_4c);
            ExceptionList = local_10;
            return 0;
          }
          piVar10 = piVar10 + 1;
          if (piVar10 == *(int **)(param_1 + 0x28)) goto LAB_0077b1f4;
          goto LAB_0077b0d0;
        }
        if (0 < iVar7) goto LAB_0077b135;
        if (iVar2 == iVar3) goto LAB_0077b0fa;
        if (-1 < iVar7) goto LAB_0077b0f2;
LAB_0077b135:
        iVar1 = *local_20;
        piVar11 = local_24;
        if (local_1c != iVar1) {
          FUN_007df950(*(undefined4 *)(iVar1 + 0xc),*(undefined4 *)(iVar1 + 0x10));
          local_34 = (float)(int)(*(ushort *)(iVar1 + 0x14) - 0x7fff);
          local_38 = local_2c;
          local_30 = local_28;
          FUN_00486150(&local_38);
          piVar11 = piVar4;
        }
      } while (piVar11 != *(int **)(param_1 + 0x28));
    }
  }
  if (local_40 != 0) {
    local_8 = 0xffffffff;
    LeaveCriticalSection(local_4c);
  }
  ExceptionList = local_10;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
0077b010 : PUSH EBP
0077b011 : MOV EBP,ESP
0077b013 : PUSH -0x1
0077b015 : PUSH 0xb3985d
0077b01a : MOV EAX,FS:[0x0]
0077b020 : PUSH EAX
0077b021 : SUB ESP,0x40
0077b024 : PUSH EBX
0077b025 : PUSH ESI
0077b026 : PUSH EDI
0077b027 : MOV EAX,[0x00d66fa0]
0077b02c : XOR EAX,EBP
0077b02e : PUSH EAX
0077b02f : LEA EAX,[EBP + -0xc]
0077b032 : MOV FS:[0x0],EAX
0077b038 : MOV EDI,dword ptr [EBP + 0x8]
0077b03b : LEA ECX,[EBP + -0x48]
0077b03e : LEA EAX,[EDI + 0x2eef0]
0077b044 : XOR EBX,EBX
0077b046 : PUSH ECX
0077b047 : MOV dword ptr [EBP + -0x3c],EBX
0077b04a : MOV dword ptr [EBP + -0x48],EAX
0077b04d : MOV dword ptr [EBP + -0x44],0xc105a4
0077b054 : MOV dword ptr [EBP + -0x40],0x469
0077b05b : MOV dword ptr [EBP + -0x38],0x1
0077b062 : CALL 0x006ef1a0
0077b067 : MOV dword ptr [EBP + -0x4],EBX
0077b06a : MOV EAX,EDI
0077b06c : CALL 0x00486300
0077b071 : TEST AL,AL
0077b073 : JNZ 0x0077b2a9
0077b079 : XORPS XMM0,XMM0
0077b07c : MOV ESI,dword ptr [EDI + 0x24]
0077b07f : LEA ECX,[EDI + 0xb4]
0077b085 : LEA EAX,[EDI + 0x30]
0077b088 : PUSH ECX
0077b089 : MOVSS dword ptr [EBP + -0x28],XMM0
0077b08e : MOVSS dword ptr [EBP + -0x24],XMM0
0077b093 : MOV dword ptr [EBP + -0x14],EAX
0077b096 : CALL 0x00406ea0
0077b09b : CMP ESI,dword ptr [EDI + 0x28]
0077b09e : JZ 0x0077b2a9
0077b0a4 : MOV EAX,EDI
0077b0a6 : CALL 0x00486300
0077b0ab : TEST AL,AL
0077b0ad : JNZ 0x0077b1a2
0077b0b3 : MOV ECX,dword ptr [ESI]
0077b0b5 : MOV dword ptr [EBP + -0x1c],ESI
0077b0b8 : ADD ESI,0x4
0077b0bb : MOV EBX,ESI
0077b0bd : MOV dword ptr [EBP + -0x18],ECX
0077b0c0 : MOV dword ptr [EBP + -0x20],ESI
0077b0c3 : CMP EBX,dword ptr [EDI + 0x28]
0077b0c6 : JZ 0x0077b1f4
0077b0cc : LEA ESP,[ESP]
0077b0d0 : MOV EDX,dword ptr [EBX]
0077b0d2 : MOV EAX,dword ptr [ECX + 0x10]
0077b0d5 : MOV ESI,dword ptr [EDX + 0xc]
0077b0d8 : MOV ECX,dword ptr [ECX + 0xc]
0077b0db : MOV EDI,dword ptr [EDX + 0x10]
0077b0de : SUB ECX,ESI
0077b0e0 : SUB EAX,EDI
0077b0e2 : TEST ECX,ECX
0077b0e4 : JLE 0x0077b0f2
0077b0e6 : TEST EAX,EAX
0077b0e8 : JG 0x0077b135
0077b0ea : JZ 0x0077b0fa
0077b0ec : TEST EAX,EAX
0077b0ee : JL 0x0077b135
0077b0f0 : TEST ECX,ECX
0077b0f2 : JNZ 0x0077b12d
0077b0f4 : TEST EAX,EAX
0077b0f6 : JL 0x0077b0fa
0077b0f8 : JLE 0x0077b135
0077b0fa : MOV EAX,dword ptr [EBP + -0x18]
0077b0fd : MOV ESI,dword ptr [EBP + 0x8]
0077b100 : PUSH EDX
0077b101 : CALL 0x0077aba0
0077b106 : TEST AL,AL
0077b108 : JZ 0x0077b10d
0077b10a : MOV dword ptr [EBP + -0x1c],EBX
0077b10d : MOV EAX,ESI
0077b10f : CALL 0x00486300
0077b114 : TEST AL,AL
0077b116 : JNZ 0x0077b1c3
0077b11c : ADD EBX,0x4
0077b11f : CMP EBX,dword ptr [ESI + 0x28]
0077b122 : JZ 0x0077b1f2
0077b128 : MOV ECX,dword ptr [EBP + -0x18]
0077b12b : JMP 0x0077b0d0
0077b12d : TEST ECX,ECX
0077b12f : JGE 0x0077b135
0077b131 : TEST EAX,EAX
0077b133 : JZ 0x0077b0fa
0077b135 : MOV EDI,dword ptr [EBP + -0x1c]
0077b138 : MOV ESI,dword ptr [EDI]
0077b13a : CMP dword ptr [EBP + -0x18],ESI
0077b13d : JNZ 0x0077b144
0077b13f : MOV ESI,dword ptr [EBP + -0x20]
0077b142 : JMP 0x0077b18d
0077b144 : MOV EAX,dword ptr [ESI + 0x10]
0077b147 : MOV ECX,dword ptr [ESI + 0xc]
0077b14a : MOV EDX,dword ptr [EBP + 0x8]
0077b14d : PUSH EAX
0077b14e : MOV EAX,dword ptr [EDX]
0077b150 : PUSH ECX
0077b151 : LEA ECX,[EBP + -0x28]
0077b154 : CALL 0x007df950
0077b159 : MOVZX EAX,word ptr [ESI + 0x14]
0077b15d : MOVSS XMM1,dword ptr [EBP + -0x28]
0077b162 : SUB EAX,0x7fff
0077b167 : CVTSI2SS XMM0,EAX
0077b16b : MOV EAX,dword ptr [EBP + -0x14]
0077b16e : LEA ECX,[EBP + -0x34]
0077b171 : MOVSS dword ptr [EBP + -0x30],XMM0
0077b176 : MOVSS XMM0,dword ptr [EBP + -0x24]
0077b17b : PUSH ECX
0077b17c : MOVSS dword ptr [EBP + -0x34],XMM1
0077b181 : MOVSS dword ptr [EBP + -0x2c],XMM0
0077b186 : CALL 0x00486150
0077b18b : MOV ESI,EDI
0077b18d : MOV EDX,dword ptr [EBP + 0x8]
0077b190 : XOR EBX,EBX
0077b192 : CMP ESI,dword ptr [EDX + 0x28]
0077b195 : JZ 0x0077b2a9
0077b19b : MOV EDI,EDX
0077b19d : JMP 0x0077b0a4
0077b1a2 : MOV ESI,dword ptr [EBP + -0x14]
0077b1a5 : CALL 0x00476f00
0077b1aa : MOV dword ptr [EBP + -0x4],0xffffffff
0077b1b1 : CMP dword ptr [EBP + -0x3c],EBX
0077b1b4 : JZ 0x0077b2c2
0077b1ba : MOV EAX,dword ptr [EBP + -0x48]
0077b1bd : PUSH EAX
0077b1be : JMP 0x0077b2b9
0077b1c3 : MOV ESI,dword ptr [EBP + -0x14]
0077b1c6 : CALL 0x00476f00
0077b1cb : MOV dword ptr [EBP + -0x4],0xffffffff
0077b1d2 : CMP dword ptr [EBP + -0x3c],0x0
0077b1d6 : JZ 0x0077b2c2
0077b1dc : MOV ECX,dword ptr [EBP + -0x48]
0077b1df : PUSH ECX
0077b1e0 : CALL dword ptr [0x00b8511c]
0077b1e6 : MOV dword ptr [EBP + -0x3c],0x0
0077b1ed : JMP 0x0077b2c2
0077b1f2 : MOV EDI,ESI
0077b1f4 : MOV EBX,dword ptr [EBP + -0x14]
0077b1f7 : LEA EDX,[EDI + 0xa8]
0077b1fd : PUSH EDX
0077b1fe : MOV EAX,EBX
0077b200 : CALL 0x00486150
0077b205 : PUSH EDI
0077b206 : CALL 0x004858e0
0077b20b : PUSH EDI
0077b20c : CALL 0x0077ad60
0077b211 : CMP byte ptr [EDI + 0x2eee9],0x0
0077b218 : JZ 0x0077b221
0077b21a : PUSH 0xcd7d58
0077b21f : JMP 0x0077b240
0077b221 : CALL dword ptr [0x00b850d8]
0077b227 : SUB EAX,dword ptr [EDI + 0x2eecc]
0077b22d : MOV dword ptr [EDI + 0x2eed0],EAX
0077b233 : CMP EAX,dword ptr [EDI + 0x2eed4]
0077b239 : JBE 0x0077b275
0077b23b : PUSH 0xcd7da0
0077b240 : MOV ESI,dword ptr [0x00da98e8]
0077b246 : CALL 0x008018d0
0077b24b : ADD ESP,0x4
0077b24e : MOV ESI,EBX
0077b250 : CALL 0x00476f00
0077b255 : MOV dword ptr [EBP + -0x4],0xffffffff
0077b25c : CMP dword ptr [EBP + -0x3c],0x0
0077b260 : JZ 0x0077b2c2
0077b262 : MOV EAX,dword ptr [EBP + -0x48]
0077b265 : PUSH EAX
0077b266 : CALL dword ptr [0x00b8511c]
0077b26c : MOV dword ptr [EBP + -0x3c],0x0
0077b273 : JMP 0x0077b2c2
0077b275 : MOV dword ptr [EBP + -0x4],0xffffffff
0077b27c : CMP dword ptr [EBP + -0x3c],0x0
0077b280 : JZ 0x0077b293
0077b282 : MOV ECX,dword ptr [EBP + -0x48]
0077b285 : PUSH ECX
0077b286 : CALL dword ptr [0x00b8511c]
0077b28c : MOV dword ptr [EBP + -0x3c],0x0
0077b293 : MOV AL,0x1
0077b295 : MOV ECX,dword ptr [EBP + -0xc]
0077b298 : MOV dword ptr FS:[0x0],ECX
0077b29f : POP ECX
0077b2a0 : POP EDI
0077b2a1 : POP ESI
0077b2a2 : POP EBX
0077b2a3 : MOV ESP,EBP
0077b2a5 : POP EBP
0077b2a6 : RET 0x4
0077b2a9 : MOV dword ptr [EBP + -0x4],0xffffffff
0077b2b0 : CMP dword ptr [EBP + -0x3c],EBX
0077b2b3 : JZ 0x0077b2c2
0077b2b5 : MOV EDX,dword ptr [EBP + -0x48]
0077b2b8 : PUSH EDX
0077b2b9 : CALL dword ptr [0x00b8511c]
0077b2bf : MOV dword ptr [EBP + -0x3c],EBX
0077b2c2 : XOR AL,AL
0077b2c4 : MOV ECX,dword ptr [EBP + -0xc]
0077b2c7 : MOV dword ptr FS:[0x0],ECX
0077b2ce : POP ECX
0077b2cf : POP EDI
0077b2d0 : POP ESI
0077b2d1 : POP EBX
0077b2d2 : MOV ESP,EBP
0077b2d4 : POP EBP
0077b2d5 : RET 0x4
