PROGRAM  : Maestia.exe
FUNCTION : FUN_00a30820
ENTRY    : 00a30820
BODY     : [[00a30820, 00a30a8f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a30820(void)

{
  undefined4 uVar1;
  int iVar2;
  int in_EAX;
  float *pfVar3;
  float *pfVar4;
  DWORD DVar5;
  int iVar6;
  undefined2 in_FPUControlWord;
  float10 fVar7;
  float in_XMM0_Da;
  float fVar8;
  float fVar9;
  undefined4 uStack_38;
  int local_30;
  undefined1 local_20 [8];
  undefined1 auStack_18 [20];
  
  if ((((*(char *)(DAT_017248cc + 0x60) != '\0') && (iVar6 = *(int *)(in_EAX + 0xac), iVar6 != 0))
      && (iVar2 = *(int *)(in_EAX + 600), iVar2 != 0)) &&
     ((*(int *)(in_EAX + 0x74) != 0 && (iVar6 != iVar2)))) {
    if ((*(int *)(iVar6 + 1000) != 0) && (*(int *)(iVar2 + 1000) != 0)) {
      pfVar3 = (float *)FUN_007cc270();
      pfVar4 = (float *)FUN_007cc270();
      in_XMM0_Da = *pfVar4;
      if (((in_XMM0_Da == *pfVar3) && (in_XMM0_Da = pfVar4[1], in_XMM0_Da == pfVar3[1])) &&
         (in_XMM0_Da = pfVar4[2], in_XMM0_Da == pfVar3[2])) {
        return;
      }
    }
    FUN_00a17fa0();
    iVar6 = *(int *)(in_EAX + 0xac);
    fVar8 = *(float *)(*(int *)(in_EAX + 600) + 0x1a4) - *(float *)(iVar6 + 0x1a4);
    fVar9 = *(float *)(*(int *)(in_EAX + 600) + 0x1ac) - *(float *)(iVar6 + 0x1ac);
    if (*(char *)(iVar6 + 0x1fa4) == '\0') {
      FUN_0085f980(fVar8,fVar9);
    }
    else {
      *(float *)(iVar6 + 0x1fb4) = fVar8;
      *(float *)(iVar6 + 0x1fb8) = fVar9;
    }
    fVar7 = (float10)FUN_0040e8d0(in_XMM0_Da);
    uStack_38 = CONCAT22(in_FPUControlWord,(undefined2)uStack_38);
    local_30 = (int)(longlong)ROUND((float10)254.6479 * fVar7);
    if (((float10)0.001 <= fVar7) && (local_30 != 0)) {
      DVar5 = timeGetTime();
      if (*(int *)(in_EAX + 0x524) == 0) {
        *(DWORD *)(in_EAX + 0x524) = DVar5 - 10;
      }
      iVar6 = DVar5 - *(int *)(in_EAX + 0x524);
      *(DWORD *)(in_EAX + 0x524) = DVar5;
      fVar8 = (float)iVar6;
      if (iVar6 < 0) {
        fVar8 = fVar8 + 4.2949673e+09;
      }
      fVar9 = (float)local_30;
      if (local_30 < 0) {
        fVar9 = fVar9 + 4.2949673e+09;
      }
      fVar8 = fVar8 / fVar9;
      if (1.0 < fVar8) {
        fVar8 = 1.0;
      }
      FUN_007f1540(fVar8 * in_XMM0_Da);
      (**(code **)(**(int **)(in_EAX + 0x74) + 8))(local_20);
      iVar6 = (**(code **)(**(int **)(in_EAX + 0x74) + 8))(auStack_18);
      uVar1 = *(undefined4 *)(iVar6 + 8);
      iVar6 = *(int *)(in_EAX + 0xac);
      *(undefined4 *)(iVar6 + 0x3b8) = uStack_38;
      *(undefined4 *)(iVar6 + 0x3bc) = uVar1;
      return;
    }
    *(undefined4 *)(in_EAX + 0x524) = 0;
    *(undefined1 *)(in_EAX + 0x515) = 0;
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00a30820 : PUSH EBP
00a30821 : MOV EBP,ESP
00a30823 : AND ESP,0xfffffff8
00a30826 : SUB ESP,0x34
00a30829 : PUSH EBX
00a3082a : PUSH ESI
00a3082b : PUSH EDI
00a3082c : MOV EDI,EAX
00a3082e : MOV EAX,[0x017248cc]
00a30833 : CMP byte ptr [EAX + 0x60],0x0
00a30837 : JZ 0x00a30a89
00a3083d : MOV ECX,dword ptr [EDI + 0xac]
00a30843 : TEST ECX,ECX
00a30845 : JZ 0x00a30a89
00a3084b : MOV EAX,dword ptr [EDI + 0x258]
00a30851 : TEST EAX,EAX
00a30853 : JZ 0x00a30a89
00a30859 : CMP dword ptr [EDI + 0x74],0x0
00a3085d : JZ 0x00a30a89
00a30863 : CMP ECX,EAX
00a30865 : JZ 0x00a30a89
00a3086b : MOV ECX,dword ptr [ECX + 0x3e8]
00a30871 : MOV dword ptr [ESP + 0x14],ECX
00a30875 : TEST ECX,ECX
00a30877 : JZ 0x00a308c4
00a30879 : MOV ESI,dword ptr [EAX + 0x3e8]
00a3087f : TEST ESI,ESI
00a30881 : JZ 0x00a308c4
00a30883 : CALL 0x007cc270
00a30888 : MOV ESI,dword ptr [ESP + 0x14]
00a3088c : MOV EBX,EAX
00a3088e : CALL 0x007cc270
00a30893 : MOV ECX,EAX
00a30895 : MOVSS XMM0,dword ptr [ECX]
00a30899 : UCOMISS XMM0,dword ptr [EBX]
00a3089c : LAHF
00a3089d : TEST AH,0x44
00a308a0 : JP 0x00a308c4
00a308a2 : MOVSS XMM0,dword ptr [ECX + 0x4]
00a308a7 : UCOMISS XMM0,dword ptr [EBX + 0x4]
00a308ab : LAHF
00a308ac : TEST AH,0x44
00a308af : JP 0x00a308c4
00a308b1 : MOVSS XMM0,dword ptr [ECX + 0x8]
00a308b6 : UCOMISS XMM0,dword ptr [EBX + 0x8]
00a308ba : LAHF
00a308bb : TEST AH,0x44
00a308be : JNP 0x00a30a89
00a308c4 : MOV ESI,EDI
00a308c6 : CALL 0x00a17fa0
00a308cb : MOV ECX,dword ptr [EDI + 0xac]
00a308d1 : MOV EAX,dword ptr [EDI + 0x258]
00a308d7 : MOVSS XMM2,dword ptr [ECX + 0x1a4]
00a308df : MOVSS XMM3,dword ptr [ECX + 0x1ac]
00a308e7 : MOVSS XMM1,dword ptr [EAX + 0x1ac]
00a308ef : ADD EAX,0x1a4
00a308f4 : CMP byte ptr [ECX + 0x1fa4],0x0
00a308fb : MOVSS dword ptr [ESP + 0x14],XMM0
00a30901 : MOVSS XMM0,dword ptr [EAX]
00a30905 : SUBSS XMM0,XMM2
00a30909 : SUBSS XMM1,XMM3
00a3090d : MOVSS dword ptr [ESP + 0x18],XMM0
00a30913 : MOVSS dword ptr [ESP + 0x20],XMM1
00a30919 : JZ 0x00a3093d
00a3091b : MOVSS dword ptr [ESP + 0x18],XMM0
00a30921 : MOV EDX,dword ptr [ESP + 0x18]
00a30925 : MOVSS dword ptr [ESP + 0x1c],XMM1
00a3092b : MOV EAX,dword ptr [ESP + 0x1c]
00a3092f : MOV dword ptr [ECX + 0x1fb4],EDX
00a30935 : MOV dword ptr [ECX + 0x1fb8],EAX
00a3093b : JMP 0x00a30954
00a3093d : FLD float ptr [ESP + 0x20]
00a30941 : SUB ESP,0x8
00a30944 : FSTP float ptr [ESP + 0x4]
00a30948 : FLD float ptr [ESP + 0x20]
00a3094c : FSTP float ptr [ESP]
00a3094f : CALL 0x0085f980
00a30954 : FLD float ptr [ESP + 0x14]
00a30958 : PUSH ECX
00a30959 : FSTP float ptr [ESP]
00a3095c : CALL 0x0040e8d0
00a30961 : FLD float ptr [0x00cdf824]
00a30967 : ADD ESP,0x4
00a3096a : FNSTCW word ptr [ESP + 0x12]
00a3096e : MOVZX EAX,word ptr [ESP + 0x12]
00a30973 : FMUL ST1
00a30975 : OR EAX,0xc00
00a3097a : MOV dword ptr [ESP + 0x18],EAX
00a3097e : FLDCW word ptr [ESP + 0x18]
00a30982 : FISTP qword ptr [ESP + 0x18]
00a30986 : MOV ESI,dword ptr [ESP + 0x18]
00a3098a : FLDCW word ptr [ESP + 0x12]
00a3098e : FLD float ptr [0x00cdf128]
00a30994 : FCOMIP ST0,ST1
00a30996 : FSTP ST0
00a30998 : JA 0x00a30a78
00a3099e : TEST ESI,ESI
00a309a0 : JZ 0x00a30a78
00a309a6 : CALL dword ptr [0x00b85598]
00a309ac : CMP dword ptr [EDI + 0x524],0x0
00a309b3 : JNZ 0x00a309be
00a309b5 : LEA ECX,[EAX + -0xa]
00a309b8 : MOV dword ptr [EDI + 0x524],ECX
00a309be : MOV ECX,EAX
00a309c0 : SUB ECX,dword ptr [EDI + 0x524]
00a309c6 : MOV dword ptr [EDI + 0x524],EAX
00a309cc : MOV dword ptr [ESP + 0x18],ECX
00a309d0 : FILD dword ptr [ESP + 0x18]
00a309d4 : TEST ECX,ECX
00a309d6 : JGE 0x00a309de
00a309d8 : FADD float ptr [0x00cdf0e0]
00a309de : MOV dword ptr [ESP + 0x18],ESI
00a309e2 : FILD dword ptr [ESP + 0x18]
00a309e6 : TEST ESI,ESI
00a309e8 : JGE 0x00a309f0
00a309ea : FADD float ptr [0x00cdf0e0]
00a309f0 : FDIVP
00a309f2 : FST float ptr [ESP + 0x18]
00a309f6 : FLD1
00a309f8 : FXCH
00a309fa : FCOMIP ST0,ST1
00a309fc : FSTP ST0
00a309fe : JBE 0x00a30a0a
00a30a00 : MOVSS XMM0,dword ptr [0x00c10fc4]
00a30a08 : JMP 0x00a30a10
00a30a0a : MOVSS XMM0,dword ptr [ESP + 0x18]
00a30a10 : MULSS XMM0,dword ptr [ESP + 0x14]
00a30a16 : MOV EAX,dword ptr [EDI + 0x74]
00a30a19 : PUSH ECX
00a30a1a : MOVSS dword ptr [ESP],XMM0
00a30a1f : CALL 0x007f1540
00a30a24 : MOV ECX,dword ptr [EDI + 0x74]
00a30a27 : MOV EDX,dword ptr [ECX]
00a30a29 : MOV EDX,dword ptr [EDX + 0x8]
00a30a2c : LEA EAX,[ESP + 0x28]
00a30a30 : PUSH EAX
00a30a31 : CALL EDX
00a30a33 : MOVSS XMM0,dword ptr [EAX]
00a30a37 : MOV ECX,dword ptr [EDI + 0x74]
00a30a3a : MOV EAX,dword ptr [ECX]
00a30a3c : MOV EAX,dword ptr [EAX + 0x8]
00a30a3f : LEA EDX,[ESP + 0x34]
00a30a43 : PUSH EDX
00a30a44 : MOVSS dword ptr [ESP + 0x1c],XMM0
00a30a4a : CALL EAX
00a30a4c : MOVSS XMM0,dword ptr [EAX + 0x8]
00a30a51 : MOV EDI,dword ptr [EDI + 0xac]
00a30a57 : MOV ECX,dword ptr [ESP + 0x18]
00a30a5b : MOVSS dword ptr [ESP + 0x1c],XMM0
00a30a61 : MOV EDX,dword ptr [ESP + 0x1c]
00a30a65 : MOV dword ptr [EDI + 0x3b8],ECX
00a30a6b : MOV dword ptr [EDI + 0x3bc],EDX
00a30a71 : POP EDI
00a30a72 : POP ESI
00a30a73 : POP EBX
00a30a74 : MOV ESP,EBP
00a30a76 : POP EBP
00a30a77 : RET
00a30a78 : MOV dword ptr [EDI + 0x524],0x0
00a30a82 : MOV byte ptr [EDI + 0x515],0x0
00a30a89 : POP EDI
00a30a8a : POP ESI
00a30a8b : POP EBX
00a30a8c : MOV ESP,EBP
00a30a8e : POP EBP
00a30a8f : RET
