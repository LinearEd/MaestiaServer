PROGRAM  : Maestia.exe
FUNCTION : FUN_00b021c0
ENTRY    : 00b021c0
BODY     : [[00b021c0, 00b02255] [00b02258, 00b0230c]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

undefined4 FUN_00b021c0(void)

{
  void **ppvVar1;
  uint uVar2;
  int iVar3;
  int iVar4;
  LONG LVar5;
  DWORD DVar6;
  int in_ECX;
  uint uVar7;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b70a14;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  iVar3 = *(int *)(in_ECX + 0x28);
  ppvVar1 = &local_10;
  local_10 = ExceptionList;
  while ((ExceptionList = ppvVar1, iVar3 != 0 && (*(char *)(DAT_0172491c + 0x343) == '\0'))) {
    iVar3 = FUN_006f2640(uVar2);
    if (iVar3 == 0) {
      FUN_00a0f720();
      FUN_00a11440(*(undefined4 *)(in_ECX + 100),in_ECX);
      if (DAT_00da9410 != 0) {
        if ((DAT_01727924 & 1) == 0) {
          DAT_01727924 = DAT_01727924 | 1;
          local_8 = 0;
          _DAT_01727920 = timeGetTime();
          local_8 = 0xffffffff;
        }
        DVar6 = timeGetTime();
        if (1000 < DVar6 - _DAT_01727920) {
          _DAT_00da9418 = _DAT_00da9418 + DAT_00da9410;
          _DAT_00da941c = _DAT_00da941c + DAT_00da9414;
          DAT_00da9410 = 0;
          DAT_00da9414 = 0;
          _DAT_01727920 = DVar6;
        }
      }
      ExceptionList = local_10;
      return 1;
    }
    uVar7 = **(ushort **)(iVar3 + 8) & 0x1fff;
    DAT_00da9410 = DAT_00da9410 + uVar7;
    iVar4 = FUN_00a100b0(*(undefined4 *)(in_ECX + 100));
    if (iVar4 == 0) {
      FUN_00b01d30();
      LVar5 = InterlockedDecrement((LONG *)(iVar3 + 4));
      if (LVar5 == 0) {
        if (*(int *)(iVar3 + 8) == 0) {
          *(undefined4 *)(iVar3 + 8) = 0;
                    /* WARNING: Subroutine does not return */
          FUN_006f04e0();
        }
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
    }
    else {
      DAT_00da9414 = DAT_00da9414 + uVar7;
    }
    iVar3 = *(int *)(in_ECX + 0x28);
    ppvVar1 = ExceptionList;
  }
  ExceptionList = local_10;
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00b021c0 : PUSH EBP
00b021c1 : MOV EBP,ESP
00b021c3 : PUSH -0x1
00b021c5 : PUSH 0xb70a14
00b021ca : MOV EAX,FS:[0x0]
00b021d0 : PUSH EAX
00b021d1 : PUSH EBX
00b021d2 : PUSH ESI
00b021d3 : PUSH EDI
00b021d4 : MOV EAX,[0x00d66fa0]
00b021d9 : XOR EAX,EBP
00b021db : PUSH EAX
00b021dc : LEA EAX,[EBP + -0xc]
00b021df : MOV FS:[0x0],EAX
00b021e5 : MOV EDI,ECX
00b021e7 : MOV ECX,dword ptr [EDI + 0x28]
00b021ea : TEST ECX,ECX
00b021ec : JZ 0x00b02265
00b021ee : MOV EAX,[0x0172491c]
00b021f3 : CMP byte ptr [EAX + 0x343],0x0
00b021fa : JNZ 0x00b02265
00b021fc : CALL 0x006f2640
00b02201 : MOV EBX,EAX
00b02203 : TEST EBX,EBX
00b02205 : JZ 0x00b02279
00b02207 : MOV ECX,dword ptr [EBX + 0x8]
00b0220a : MOVZX ESI,word ptr [ECX]
00b0220d : MOV EDX,dword ptr [EDI + 0x64]
00b02210 : AND ESI,0x1fff
00b02216 : ADD dword ptr [0x00da9410],ESI
00b0221c : PUSH EDX
00b0221d : CALL 0x00a100b0
00b02222 : TEST EAX,EAX
00b02224 : JNZ 0x00b02258
00b02226 : MOV ESI,dword ptr [EBX + 0x8]
00b02229 : CALL 0x00b01d30
00b0222e : LEA EAX,[EBX + 0x4]
00b02231 : PUSH EAX
00b02232 : CALL dword ptr [0x00b851b0]
00b02238 : TEST EAX,EAX
00b0223a : JNZ 0x00b0225e
00b0223c : MOV ECX,dword ptr [EBX + 0x8]
00b0223f : TEST ECX,ECX
00b02241 : JZ 0x00b02248
00b02243 : CALL 0x006f04e0
00b02248 : MOV ECX,EBX
00b0224a : MOV dword ptr [EBX + 0x8],0x0
00b02251 : CALL 0x006f04e0
00b02258 : ADD dword ptr [0x00da9414],ESI
00b0225e : MOV ECX,dword ptr [EDI + 0x28]
00b02261 : TEST ECX,ECX
00b02263 : JNZ 0x00b021ee
00b02265 : MOV AL,0x1
00b02267 : MOV ECX,dword ptr [EBP + -0xc]
00b0226a : MOV dword ptr FS:[0x0],ECX
00b02271 : POP ECX
00b02272 : POP EDI
00b02273 : POP ESI
00b02274 : POP EBX
00b02275 : MOV ESP,EBP
00b02277 : POP EBP
00b02278 : RET
00b02279 : MOV ESI,dword ptr [EDI + 0x64]
00b0227c : CALL 0x00a0f720
00b02281 : MOV ECX,dword ptr [EDI + 0x64]
00b02284 : PUSH EDI
00b02285 : PUSH ECX
00b02286 : CALL 0x00a11440
00b0228b : XOR EDI,EDI
00b0228d : MOV EBX,0x1
00b02292 : CMP dword ptr [0x00da9410],EDI
00b02298 : JZ 0x00b022f9
00b0229a : MOV ESI,dword ptr [0x00b85598]
00b022a0 : TEST byte ptr [0x01727924],BL
00b022a6 : JNZ 0x00b022bf
00b022a8 : OR dword ptr [0x01727924],EBX
00b022ae : MOV dword ptr [EBP + -0x4],EDI
00b022b1 : CALL ESI
00b022b3 : MOV [0x01727920],EAX
00b022b8 : MOV dword ptr [EBP + -0x4],0xffffffff
00b022bf : CALL ESI
00b022c1 : MOV EDX,EAX
00b022c3 : SUB EDX,dword ptr [0x01727920]
00b022c9 : CMP EDX,0x3e8
00b022cf : JBE 0x00b022f9
00b022d1 : MOV ECX,dword ptr [0x00da9414]
00b022d7 : MOV [0x01727920],EAX
00b022dc : MOV EAX,[0x00da9410]
00b022e1 : ADD dword ptr [0x00da9418],EAX
00b022e7 : ADD dword ptr [0x00da941c],ECX
00b022ed : MOV dword ptr [0x00da9410],EDI
00b022f3 : MOV dword ptr [0x00da9414],EDI
00b022f9 : MOV AL,BL
00b022fb : MOV ECX,dword ptr [EBP + -0xc]
00b022fe : MOV dword ptr FS:[0x0],ECX
00b02305 : POP ECX
00b02306 : POP EDI
00b02307 : POP ESI
00b02308 : POP EBX
00b02309 : MOV ESP,EBP
00b0230b : POP EBP
00b0230c : RET
