PROGRAM  : Maestia.exe
FUNCTION : FUN_00540fa0
ENTRY    : 00540fa0
BODY     : [[00540fa0, 0054122e]]

============================================================
DECOMPILED C CODE
============================================================

int * FUN_00540fa0(char *param_1,int param_2)

{
  char cVar1;
  char *pcVar2;
  int iVar3;
  undefined2 *puVar4;
  int *in_ECX;
  short *psVar5;
  uint unaff_EBX;
  int iVar6;
  int unaff_EBP;
  int iVar7;
  int unaff_ESI;
  int iVar8;
  int iVar9;
  int *piVar10;
  bool bVar11;
  int unaff_retaddr;
  int *local_18;
  uint local_14;
  uint uStack_8;
  uint uStack_4;
  
  iVar3 = param_2;
  if (param_2 == -1) {
    pcVar2 = param_1;
    do {
      cVar1 = *pcVar2;
      pcVar2 = pcVar2 + 1;
    } while (cVar1 != '\0');
    iVar3 = (int)pcVar2 - (int)(param_1 + 1);
  }
  piVar10 = (int *)0x0;
  iVar7 = in_ECX[4] + -1;
  if (((iVar7 < 0) || (in_ECX[4] <= iVar7)) ||
     (piVar10 = *(int **)(in_ECX[3] + iVar7 * 4), piVar10 == (int *)0x0)) {
    local_14 = 0;
  }
  else {
    local_14 = piVar10[7];
  }
  (**(code **)(*in_ECX + 4))(local_14,iVar3,param_1);
  iVar3 = 0;
  iVar7 = 0;
  local_18 = in_ECX;
  while( true ) {
    if ((iVar3 == 0) && (piVar10 != (int *)0x0)) {
      FUN_00540100();
      local_14 = piVar10[1];
      if (local_14 != 0) {
        if ((*piVar10 == 0) || (local_14 <= local_14 - 1)) {
          psVar5 = (short *)0x0;
        }
        else {
          psVar5 = (short *)(*piVar10 + (local_14 - 1) * 2);
        }
        if (*psVar5 == 0) {
          local_14 = local_14 - 1;
        }
      }
    }
    else {
      piVar10 = (int *)FUN_00540b60(param_2);
      local_14 = 0;
      piVar10[7] = unaff_EBP;
    }
    iVar6 = 0;
    iVar8 = -1;
    uStack_4 = uStack_8;
    iVar9 = iVar8;
    if (unaff_EBX <= uStack_8) break;
    do {
      iVar8 = iVar9;
      if (iVar9 == 0) break;
      iVar8 = FUN_0051aa70(&uStack_4);
      if ((((unaff_retaddr == 0) && (iVar7 == 0xd)) && (iVar6 == 0)) && (iVar7 = -1, iVar8 == 10)) {
        uStack_8 = uStack_8 + 1;
        iVar8 = iVar9;
      }
      else {
        if (iVar8 == 10) goto LAB_005410e0;
        if (iVar8 == 0xd) break;
        iVar6 = iVar6 + 1;
      }
      iVar9 = iVar8;
    } while (uStack_4 < unaff_EBX);
    if ((iVar8 == 10) || (iVar8 == 0xd)) {
LAB_005410e0:
      iVar6 = iVar6 + 1;
    }
    if (iVar6 != 0) {
      puVar4 = (undefined2 *)FUN_0053b400(*(undefined4 *)(unaff_ESI + 8),local_14,iVar6);
      FUN_0053d280(local_14,iVar6);
      *(short *)(piVar10 + 9) = (short)piVar10[9] + 1;
      iVar8 = -1;
      uStack_4 = uStack_8;
      if (uStack_8 < unaff_EBX) {
        while (bVar11 = iVar8 != 0, iVar8 = 0, bVar11) {
          iVar8 = FUN_0051aa70(&uStack_4);
          if ((iVar8 == 0xd) || (iVar8 == 10)) {
            iVar8 = (-(uint)((*(byte *)(unaff_ESI + 0x20) & 2) != 0) & 3) + 10;
          }
          *puVar4 = (short)iVar8;
          puVar4 = puVar4 + 1;
          if ((iVar8 == (-(uint)((*(byte *)(unaff_ESI + 0x20) & 2) != 0) & 3) + 10) ||
             (unaff_EBX <= uStack_4)) break;
        }
      }
      FUN_00540450(*(undefined4 *)(unaff_ESI + 8),param_1,local_14,0xffffffff);
      unaff_EBP = unaff_EBP + iVar6 + local_14;
      local_18 = (int *)((int)local_18 + iVar6);
      uStack_8 = uStack_4;
    }
    if ((unaff_EBX <= uStack_8) || (iVar3 = iVar3 + 1, iVar7 = iVar8, iVar8 == 0)) break;
  }
  if (iVar8 == (-(uint)((*(byte *)(unaff_ESI + 0x20) & 2) != 0) & 3) + 10) {
    FUN_00540b60(param_2);
  }
  FUN_005406c0(*(undefined4 *)(unaff_ESI + 8),param_1);
  if ((*(ushort *)(param_1 + 0x2a) & 0x100) != 0) {
    iVar3 = FUN_0051b1a0();
    if (iVar3 != 0) {
      *(byte *)(unaff_ESI + 0x20) = *(byte *)(unaff_ESI + 0x20) | 1;
      return local_18;
    }
  }
  return local_18;
}



============================================================
DISASSEMBLY
============================================================
00540fa0 : SUB ESP,0x18
00540fa3 : MOV EAX,dword ptr [ESP + 0x20]
00540fa7 : PUSH EBX
00540fa8 : MOV EBX,dword ptr [ESP + 0x20]
00540fac : PUSH EBP
00540fad : MOV EBP,ECX
00540faf : PUSH ESI
00540fb0 : MOV dword ptr [ESP + 0xc],EBP
00540fb4 : MOV dword ptr [ESP + 0x28],EBX
00540fb8 : CMP EAX,-0x1
00540fbb : JNZ 0x00540fcb
00540fbd : MOV EAX,EBX
00540fbf : LEA EDX,[EAX + 0x1]
00540fc2 : MOV CL,byte ptr [EAX]
00540fc4 : INC EAX
00540fc5 : TEST CL,CL
00540fc7 : JNZ 0x00540fc2
00540fc9 : SUB EAX,EDX
00540fcb : MOV EDX,dword ptr [EBP + 0x10]
00540fce : LEA ECX,[EBX + EAX*0x1]
00540fd1 : PUSH EDI
00540fd2 : MOV dword ptr [ESP + 0x18],ECX
00540fd6 : XOR EDI,EDI
00540fd8 : LEA ECX,[EDX + -0x1]
00540fdb : XOR ESI,ESI
00540fdd : CMP ECX,EDI
00540fdf : MOV dword ptr [ESP + 0x1c],EDI
00540fe3 : JL 0x00540ff3
00540fe5 : CMP ECX,EDX
00540fe7 : JGE 0x00540ff3
00540fe9 : MOV EDX,dword ptr [EBP + 0xc]
00540fec : MOV EDI,dword ptr [EDX + ECX*0x4]
00540fef : TEST EDI,EDI
00540ff1 : JNZ 0x00540ff9
00540ff3 : MOV dword ptr [ESP + 0x14],ESI
00540ff7 : JMP 0x00541000
00540ff9 : MOV ECX,dword ptr [EDI + 0x1c]
00540ffc : MOV dword ptr [ESP + 0x14],ECX
00541000 : MOV EDX,dword ptr [EBP]
00541003 : MOV EDX,dword ptr [EDX + 0x4]
00541006 : PUSH EBX
00541007 : PUSH EAX
00541008 : MOV EAX,dword ptr [ESP + 0x1c]
0054100c : PUSH EAX
0054100d : MOV ECX,EBP
0054100f : CALL EDX
00541011 : XOR EAX,EAX
00541013 : JMP 0x0054101d
00541015 : MOV EAX,dword ptr [ESP + 0x24]
00541019 : MOV EBP,dword ptr [ESP + 0x10]
0054101d : MOV ECX,EAX
0054101f : INC EAX
00541020 : MOV dword ptr [ESP + 0x24],EAX
00541024 : TEST ECX,ECX
00541026 : JA 0x0054105b
00541028 : TEST EDI,EDI
0054102a : JZ 0x0054105b
0054102c : MOV ECX,EDI
0054102e : CALL 0x00540100
00541033 : MOV EAX,dword ptr [EDI + 0x4]
00541036 : TEST EAX,EAX
00541038 : JBE 0x00541055
0054103a : MOV ECX,dword ptr [EDI]
0054103c : LEA EDX,[EAX + -0x1]
0054103f : TEST ECX,ECX
00541041 : JZ 0x0054104c
00541043 : CMP EDX,EAX
00541045 : JNC 0x0054104c
00541047 : LEA ECX,[ECX + EDX*0x2]
0054104a : JMP 0x0054104e
0054104c : XOR ECX,ECX
0054104e : CMP word ptr [ECX],0x0
00541052 : JNZ 0x00541055
00541054 : DEC EAX
00541055 : MOV dword ptr [ESP + 0x20],EAX
00541059 : JMP 0x00541078
0054105b : MOV EDX,dword ptr [ESP + 0x3c]
0054105f : PUSH EDX
00541060 : MOV ECX,EBP
00541062 : CALL 0x00540b60
00541067 : MOV EDI,EAX
00541069 : MOV EAX,dword ptr [ESP + 0x14]
0054106d : MOV dword ptr [ESP + 0x20],0x0
00541075 : MOV dword ptr [EDI + 0x1c],EAX
00541078 : MOV ECX,dword ptr [ESP + 0x2c]
0054107c : MOV EBP,ESI
0054107e : MOV EDX,ECX
00541080 : XOR EBX,EBX
00541082 : OR ESI,0xffffffff
00541085 : MOV dword ptr [ESP + 0x30],ECX
00541089 : CMP EDX,dword ptr [ESP + 0x18]
0054108d : JNC 0x005411c0
00541093 : TEST ESI,ESI
00541095 : JZ 0x005410d6
00541097 : LEA EAX,[ESP + 0x30]
0054109b : PUSH EAX
0054109c : CALL 0x0051aa70
005410a1 : CMP dword ptr [ESP + 0x34],0x0
005410a6 : JNZ 0x005410bf
005410a8 : CMP EBP,0xd
005410ab : JNZ 0x005410bf
005410ad : TEST EBX,EBX
005410af : JNZ 0x005410bf
005410b1 : OR EBP,0xffffffff
005410b4 : CMP EAX,0xa
005410b7 : JNZ 0x005410bf
005410b9 : INC dword ptr [ESP + 0x2c]
005410bd : JMP 0x005410cc
005410bf : MOV ESI,EAX
005410c1 : CMP EAX,0xa
005410c4 : JZ 0x005410e0
005410c6 : CMP EAX,0xd
005410c9 : JZ 0x005410d6
005410cb : INC EBX
005410cc : MOV ECX,dword ptr [ESP + 0x18]
005410d0 : CMP dword ptr [ESP + 0x30],ECX
005410d4 : JC 0x00541093
005410d6 : CMP ESI,0xa
005410d9 : JZ 0x005410e0
005410db : CMP ESI,0xd
005410de : JNZ 0x005410e1
005410e0 : INC EBX
005410e1 : TEST EBX,EBX
005410e3 : JBE 0x005411ae
005410e9 : MOV EDX,dword ptr [ESP + 0x10]
005410ed : MOV ECX,dword ptr [ESP + 0x20]
005410f1 : MOV EAX,dword ptr [EDX + 0x8]
005410f4 : PUSH EBX
005410f5 : PUSH ECX
005410f6 : PUSH EAX
005410f7 : MOV ECX,EDI
005410f9 : CALL 0x0053b400
005410fe : MOV EDX,dword ptr [ESP + 0x20]
00541102 : PUSH EBX
00541103 : PUSH EDX
00541104 : LEA ECX,[EDI + 0x10]
00541107 : MOV EBP,EAX
00541109 : CALL 0x0053d280
0054110e : MOV EAX,dword ptr [ESP + 0x2c]
00541112 : INC word ptr [EDI + 0x24]
00541116 : OR ESI,0xffffffff
00541119 : MOV dword ptr [ESP + 0x30],EAX
0054111d : CMP EAX,dword ptr [ESP + 0x18]
00541121 : JNC 0x00541180
00541123 : TEST ESI,ESI
00541125 : JZ 0x00541180
00541127 : LEA EAX,[ESP + 0x30]
0054112b : PUSH EAX
0054112c : CALL 0x0051aa70
00541131 : MOV ESI,EAX
00541133 : CMP ESI,0xd
00541136 : JZ 0x0054113d
00541138 : CMP ESI,0xa
0054113b : JNZ 0x00541154
0054113d : MOV ECX,dword ptr [ESP + 0x10]
00541141 : MOV DL,byte ptr [ECX + 0x20]
00541144 : AND DL,0x2
00541147 : MOVZX ESI,DL
0054114a : NEG ESI
0054114c : SBB ESI,ESI
0054114e : AND ESI,0x3
00541151 : ADD ESI,0xa
00541154 : MOV EAX,dword ptr [ESP + 0x10]
00541158 : MOV word ptr [EBP],SI
0054115c : MOV CL,byte ptr [EAX + 0x20]
0054115f : AND CL,0x2
00541162 : MOVZX EDX,CL
00541165 : ADD EBP,0x2
00541168 : NEG EDX
0054116a : SBB EDX,EDX
0054116c : AND EDX,0x3
0054116f : ADD EDX,0xa
00541172 : CMP ESI,EDX
00541174 : JZ 0x00541180
00541176 : MOV EAX,dword ptr [ESP + 0x18]
0054117a : CMP dword ptr [ESP + 0x30],EAX
0054117e : JC 0x00541123
00541180 : MOV EBP,dword ptr [ESP + 0x20]
00541184 : MOV ECX,dword ptr [ESP + 0x38]
00541188 : MOV EDX,dword ptr [ESP + 0x10]
0054118c : MOV EAX,dword ptr [EDX + 0x8]
0054118f : PUSH -0x1
00541191 : PUSH EBP
00541192 : PUSH ECX
00541193 : PUSH EAX
00541194 : MOV ECX,EDI
00541196 : CALL 0x00540450
0054119b : MOV ECX,dword ptr [ESP + 0x30]
0054119f : LEA EDX,[EBX + EBP*0x1]
005411a2 : ADD dword ptr [ESP + 0x14],EDX
005411a6 : ADD dword ptr [ESP + 0x1c],EBX
005411aa : MOV dword ptr [ESP + 0x2c],ECX
005411ae : MOV EAX,dword ptr [ESP + 0x18]
005411b2 : CMP dword ptr [ESP + 0x2c],EAX
005411b6 : JNC 0x005411c0
005411b8 : TEST ESI,ESI
005411ba : JNZ 0x00541015
005411c0 : MOV EBX,dword ptr [ESP + 0x10]
005411c4 : MOV CL,byte ptr [EBX + 0x20]
005411c7 : AND CL,0x2
005411ca : MOVZX EDX,CL
005411cd : NEG EDX
005411cf : SBB EDX,EDX
005411d1 : AND EDX,0x3
005411d4 : ADD EDX,0xa
005411d7 : CMP ESI,EDX
005411d9 : JNZ 0x005411e9
005411db : MOV EAX,dword ptr [ESP + 0x3c]
005411df : PUSH EAX
005411e0 : MOV ECX,EBX
005411e2 : CALL 0x00540b60
005411e7 : MOV EDI,EAX
005411e9 : MOV ESI,dword ptr [ESP + 0x38]
005411ed : MOV ECX,dword ptr [EBX + 0x8]
005411f0 : PUSH ESI
005411f1 : PUSH ECX
005411f2 : MOV ECX,EDI
005411f4 : CALL 0x005406c0
005411f9 : MOV EDX,0x100
005411fe : POP EDI
005411ff : TEST word ptr [ESI + 0x2a],DX
00541203 : JZ 0x00541222
00541205 : LEA ECX,[ESI + 0x10]
00541208 : CALL 0x0051b1a0
0054120d : TEST EAX,EAX
0054120f : MOV EAX,dword ptr [ESP + 0x18]
00541213 : JZ 0x00541226
00541215 : OR byte ptr [EBX + 0x20],0x1
00541219 : POP ESI
0054121a : POP EBP
0054121b : POP EBX
0054121c : ADD ESP,0x18
0054121f : RET 0x14
00541222 : MOV EAX,dword ptr [ESP + 0x18]
00541226 : POP ESI
00541227 : POP EBP
00541228 : POP EBX
00541229 : ADD ESP,0x18
0054122c : RET 0x14
