PROGRAM  : Maestia.exe
FUNCTION : FUN_006b6180
ENTRY    : 006b6180
BODY     : [[006b6180, 006b6366]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_006b6180(void)

{
  int *piVar1;
  ushort uVar2;
  ushort *in_EAX;
  undefined4 uVar3;
  int unaff_ESI;
  int *piVar4;
  
  uVar2 = *in_EAX;
  if ((uVar2 < *(ushort *)(unaff_ESI + 0x50)) &&
     (*(ushort *)(unaff_ESI + 0x11c) < *(ushort *)(unaff_ESI + 0x2c))) {
    if ((*(short *)(unaff_ESI + 0x158) == 0) || (*(short *)(unaff_ESI + 0x15a) == 0)) {
      (**(code **)(unaff_ESI + 0x240))();
    }
    else {
      piVar4 = (int *)(*(int *)(unaff_ESI + 0x5c) + (uint)uVar2 * 8);
      piVar1 = (int *)(*(int *)(unaff_ESI + 0x38) + (uint)*(ushort *)(unaff_ESI + 0x11c) * 8);
      if (*(int *)(unaff_ESI + 0xdc) == *(int *)(unaff_ESI + 0xe0)) {
        uVar3 = (**(code **)(unaff_ESI + 0x240))();
        FUN_00685ea0(uVar3,*(undefined4 *)(unaff_ESI + 0xdc));
      }
      else {
        FUN_00685ea0(*piVar4 - *piVar1,*(int *)(unaff_ESI + 0xdc));
        FUN_00685ea0(piVar4[1] - piVar1[1],*(undefined4 *)(unaff_ESI + 0xe0));
        (**(code **)(unaff_ESI + 0x240))();
      }
    }
    if ((*(byte *)(unaff_ESI + 0x170) & 4) == 0) {
      FUN_006b4420();
    }
    else {
      (**(code **)(unaff_ESI + 0x238))();
    }
    (**(code **)(unaff_ESI + 0x23c))();
    (**(code **)(unaff_ESI + 0x248))();
    *(undefined2 *)(unaff_ESI + 0x11e) = *(undefined2 *)(unaff_ESI + 0x11c);
    *(ushort *)(unaff_ESI + 0x120) = uVar2;
    if ((*(byte *)(unaff_ESI + 0x170) & 0x10) != 0) {
      *(ushort *)(unaff_ESI + 0x11c) = uVar2;
    }
  }
  else if (*(char *)(unaff_ESI + 0x231) != '\0') {
    *(undefined4 *)(unaff_ESI + 0xc) = 0x86;
    return;
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
006b6180 : SUB ESP,0xc
006b6183 : MOVZX EAX,word ptr [EAX]
006b6186 : MOV dword ptr [ESP],EAX
006b6189 : CMP AX,word ptr [ESI + 0x50]
006b618d : JNC 0x006b6353
006b6193 : MOVZX ECX,word ptr [ESI + 0x11c]
006b619a : CMP CX,word ptr [ESI + 0x2c]
006b619e : JNC 0x006b6353
006b61a4 : CMP word ptr [ESI + 0x158],0x0
006b61ac : PUSH EBX
006b61ad : PUSH EBP
006b61ae : PUSH EDI
006b61af : JZ 0x006b6245
006b61b5 : CMP word ptr [ESI + 0x15a],0x0
006b61bd : JZ 0x006b6245
006b61c3 : MOV EDI,dword ptr [ESI + 0x5c]
006b61c6 : MOV EDX,dword ptr [ESI + 0x38]
006b61c9 : MOVZX EBP,AX
006b61cc : MOV EAX,dword ptr [ESI + 0xdc]
006b61d2 : ADD EBP,EBP
006b61d4 : ADD EBP,EBP
006b61d6 : ADD EBP,EBP
006b61d8 : MOVZX ECX,CX
006b61db : ADD EDI,EBP
006b61dd : LEA EBX,[EDX + ECX*0x8]
006b61e0 : CMP EAX,dword ptr [ESI + 0xe0]
006b61e6 : JNZ 0x006b620f
006b61e8 : MOV EAX,dword ptr [EDI + 0x4]
006b61eb : SUB EAX,dword ptr [EBX + 0x4]
006b61ee : MOV ECX,dword ptr [EDI]
006b61f0 : SUB ECX,dword ptr [EBX]
006b61f2 : MOV EDX,dword ptr [ESI + 0x240]
006b61f8 : PUSH EAX
006b61f9 : PUSH ECX
006b61fa : PUSH ESI
006b61fb : CALL EDX
006b61fd : MOV ECX,dword ptr [ESI + 0xdc]
006b6203 : PUSH ECX
006b6204 : PUSH EAX
006b6205 : CALL 0x00685ea0
006b620a : ADD ESP,0x14
006b620d : JMP 0x006b6275
006b620f : MOV EDX,dword ptr [EDI]
006b6211 : SUB EDX,dword ptr [EBX]
006b6213 : PUSH EAX
006b6214 : PUSH EDX
006b6215 : CALL 0x00685ea0
006b621a : MOV ECX,dword ptr [EDI + 0x4]
006b621d : SUB ECX,dword ptr [EBX + 0x4]
006b6220 : MOV dword ptr [ESP + 0x18],EAX
006b6224 : MOV EAX,dword ptr [ESI + 0xe0]
006b622a : PUSH EAX
006b622b : PUSH ECX
006b622c : CALL 0x00685ea0
006b6231 : MOV EDX,dword ptr [ESP + 0x20]
006b6235 : PUSH EAX
006b6236 : MOV EAX,dword ptr [ESI + 0x240]
006b623c : PUSH EDX
006b623d : PUSH ESI
006b623e : CALL EAX
006b6240 : ADD ESP,0x1c
006b6243 : JMP 0x006b6275
006b6245 : MOV EDX,dword ptr [ESI + 0x30]
006b6248 : MOVZX EBP,AX
006b624b : MOV EAX,dword ptr [ESI + 0x54]
006b624e : ADD EBP,EBP
006b6250 : MOVZX ECX,CX
006b6253 : ADD EBP,EBP
006b6255 : LEA ECX,[EDX + ECX*0x8]
006b6258 : ADD EBP,EBP
006b625a : MOV EDX,dword ptr [EAX + EBP*0x1 + 0x4]
006b625e : SUB EDX,dword ptr [ECX + 0x4]
006b6261 : ADD EAX,EBP
006b6263 : MOV EAX,dword ptr [EAX]
006b6265 : SUB EAX,dword ptr [ECX]
006b6267 : MOV ECX,dword ptr [ESI + 0x240]
006b626d : PUSH EDX
006b626e : PUSH EAX
006b626f : PUSH ESI
006b6270 : CALL ECX
006b6272 : ADD ESP,0xc
006b6275 : MOV EDI,EAX
006b6277 : MOV EAX,dword ptr [ESI + 0x148]
006b627d : MOV ECX,EDI
006b627f : SUB ECX,EAX
006b6281 : JNS 0x006b6287
006b6283 : MOV ECX,EAX
006b6285 : SUB ECX,EDI
006b6287 : CMP ECX,dword ptr [ESI + 0x144]
006b628d : JGE 0x006b6297
006b628f : TEST EDI,EDI
006b6291 : JGE 0x006b6295
006b6293 : NEG EAX
006b6295 : MOV EDI,EAX
006b6297 : MOV AL,byte ptr [ESI + 0x170]
006b629d : MOVZX EDX,AL
006b62a0 : AND EDX,0x3
006b62a3 : TEST AL,0x4
006b62a5 : MOV EAX,dword ptr [ESI + EDX*0x4 + 0x108]
006b62ac : PUSH EAX
006b62ad : PUSH EDI
006b62ae : PUSH ESI
006b62af : JZ 0x006b62bb
006b62b1 : MOV ECX,dword ptr [ESI + 0x238]
006b62b7 : CALL ECX
006b62b9 : JMP 0x006b62c0
006b62bb : CALL 0x006b4420
006b62c0 : ADD ESP,0xc
006b62c3 : TEST byte ptr [ESI + 0x170],0x8
006b62ca : MOV EBX,EAX
006b62cc : JZ 0x006b62e6
006b62ce : MOV EAX,dword ptr [ESI + 0x134]
006b62d4 : TEST EDI,EDI
006b62d6 : JL 0x006b62de
006b62d8 : CMP EBX,EAX
006b62da : JGE 0x006b62e6
006b62dc : JMP 0x006b62e4
006b62de : NEG EAX
006b62e0 : CMP EBX,EAX
006b62e2 : JLE 0x006b62e6
006b62e4 : MOV EBX,EAX
006b62e6 : MOVZX ECX,word ptr [ESI + 0x11c]
006b62ed : MOV EDX,dword ptr [ESI + 0x34]
006b62f0 : LEA EAX,[EDX + ECX*0x8]
006b62f3 : MOV ECX,dword ptr [ESI + 0x58]
006b62f6 : MOV EDX,dword ptr [EBP + ECX*0x1 + 0x4]
006b62fa : SUB EDX,dword ptr [EAX + 0x4]
006b62fd : ADD EBP,ECX
006b62ff : MOV ECX,dword ptr [EBP]
006b6302 : SUB ECX,dword ptr [EAX]
006b6304 : PUSH EDX
006b6305 : MOV EDX,dword ptr [ESI + 0x23c]
006b630b : PUSH ECX
006b630c : PUSH ESI
006b630d : CALL EDX
006b630f : MOV EDI,dword ptr [ESP + 0x18]
006b6313 : MOV ECX,dword ptr [ESI + 0x248]
006b6319 : SUB EBX,EAX
006b631b : PUSH EBX
006b631c : PUSH EDI
006b631d : LEA EAX,[ESI + 0x48]
006b6320 : PUSH EAX
006b6321 : PUSH ESI
006b6322 : CALL ECX
006b6324 : MOV DX,word ptr [ESI + 0x11c]
006b632b : ADD ESP,0x1c
006b632e : TEST byte ptr [ESI + 0x170],0x10
006b6335 : MOV word ptr [ESI + 0x11e],DX
006b633c : MOV word ptr [ESI + 0x120],DI
006b6343 : JZ 0x006b634c
006b6345 : MOV word ptr [ESI + 0x11c],DI
006b634c : POP EDI
006b634d : POP EBP
006b634e : POP EBX
006b634f : ADD ESP,0xc
006b6352 : RET
006b6353 : CMP byte ptr [ESI + 0x231],0x0
006b635a : JZ 0x006b634f
006b635c : MOV dword ptr [ESI + 0xc],0x86
006b6363 : ADD ESP,0xc
006b6366 : RET
