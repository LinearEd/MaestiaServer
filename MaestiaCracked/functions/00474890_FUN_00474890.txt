PROGRAM  : Maestia.exe
FUNCTION : FUN_00474890
ENTRY    : 00474890
BODY     : [[00474890, 00474aa9] [00474ab0, 00474cbf]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Removing unreachable block (ram,0x00474b3f) */
/* WARNING: Removing unreachable block (ram,0x00474b6c) */
/* WARNING: Removing unreachable block (ram,0x00474b7f) */
/* WARNING: Removing unreachable block (ram,0x00474b91) */
/* WARNING: Removing unreachable block (ram,0x00474b95) */
/* WARNING: Removing unreachable block (ram,0x00474bbd) */
/* WARNING: Removing unreachable block (ram,0x00474bc1) */
/* WARNING: Removing unreachable block (ram,0x00474bc4) */
/* WARNING: Removing unreachable block (ram,0x00474ba1) */
/* WARNING: Removing unreachable block (ram,0x00474bac) */
/* WARNING: Removing unreachable block (ram,0x00474bb0) */
/* WARNING: Removing unreachable block (ram,0x00474bbb) */
/* WARNING: Removing unreachable block (ram,0x00474bf3) */
/* WARNING: Removing unreachable block (ram,0x00474bf9) */
/* WARNING: Removing unreachable block (ram,0x00474c22) */
/* WARNING: Removing unreachable block (ram,0x00474c42) */
/* WARNING: Removing unreachable block (ram,0x00474c54) */
/* WARNING: Removing unreachable block (ram,0x00474c59) */
/* WARNING: Removing unreachable block (ram,0x00474c5c) */

undefined4 FUN_00474890(int param_1,int param_2)

{
  int iVar1;
  bool bVar2;
  void **ppvVar3;
  byte bVar4;
  byte bVar5;
  int iVar6;
  int *piVar7;
  int iVar8;
  byte local_8f;
  int local_78;
  int local_74;
  int local_70;
  int local_6c;
  int local_5c;
  int local_58;
  int local_54;
  undefined1 local_50 [28];
  undefined1 local_34 [4];
  undefined4 local_30;
  void *local_14;
  undefined1 *puStack_10;
  undefined4 local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b82a94;
  local_14 = ExceptionList;
  local_8f = 1;
  local_74 = 0;
  ppvVar3 = &local_14;
  if (0 < *(int *)(param_1 + 0xc)) {
    do {
      ExceptionList = ppvVar3;
      iVar1 = *(int *)(*(int *)(param_1 + 8) + local_74 * 4);
      if ((*(char *)(iVar1 + 0x1f9) == '\0') || (bVar2 = true, *(char *)(param_1 + 0xd14) == '\0'))
      {
        bVar2 = false;
      }
      if ((*(char *)(iVar1 + 0x1f8) != '\0') || (bVar2)) {
        local_78 = iVar1;
        FUN_00473b50(param_2 + 0x6c);
        if (local_6c == 0) {
          local_78 = iVar1;
          iVar6 = FUN_004742f0(&local_78);
          *(undefined4 *)(iVar6 + 0x58) = 4;
          iVar8 = 1;
          *(undefined4 *)(iVar6 + 0x14) = 1;
          if ((*(char *)(iVar1 + 0x1f9) == '\0') || (*(char *)(iVar1 + 0x10ec) == '\0')) {
            iVar8 = 0;
          }
          iVar6 = *(int *)(iVar1 + 0x10e4) * *(int *)(iVar1 + 0x10e8) *
                  ((uint)(*(char *)(iVar1 + 0x1078) == '\0') * 2 + 4) *
                  ((uint)(*(char *)(iVar1 + 0x1f8) != '\0') + iVar8);
          FUN_00474550(local_34,iVar6,"UpdateBillboardIbos, indices",1);
          local_c = 0;
          bVar4 = FUN_004743b0(local_30,iVar6);
          bVar5 = FUN_004744b0();
          local_8f = local_8f & bVar4 & bVar5;
          local_c = 0xffffffff;
          FUN_00474620(local_34);
        }
        if ((*(char *)(iVar1 + 0x1f9) == '\0') || (*(char *)(iVar1 + 0x10ec) == '\0')) {
          iVar6 = 0;
        }
        else {
          iVar6 = 1;
        }
        FUN_00474550(local_50,*(int *)(iVar1 + 0x10e4) *
                              ((uint)(*(char *)(iVar1 + 0x1078) == '\0') * 2 + 4) *
                              *(int *)(iVar1 + 0x10e8) *
                              ((uint)(*(char *)(iVar1 + 0x1f8) != '\0') + iVar6),
                     "UpdateBillboardIbos",1);
        local_c = 1;
        local_78 = 0;
        if (0 < *(int *)(param_2 + 0x10)) {
          do {
            local_70 = *(int *)(*(int *)(param_2 + 0xc) + local_78 * 4);
            if (*(int *)(local_70 + 0x84) != -1) {
              iVar1 = local_70 + 0x38;
              local_5c = 0;
              local_58 = 0;
              local_54 = iVar1;
              piVar7 = (int *)FUN_004746d0(iVar1);
              iVar6 = piVar7[1];
              iVar8 = *piVar7;
              if (iVar8 != 0) {
                if (iVar6 == 0) {
                  piVar7 = (int *)0x0;
                }
                else {
                  piVar7 = (int *)(*(int *)(iVar6 + 4) + iVar8);
                }
                local_5c = iVar8;
                local_58 = iVar6;
                if (*piVar7 != 0) {
                  FUN_00474740(iVar1);
                }
              }
            }
            local_78 = local_78 + 1;
          } while (local_78 < *(int *)(param_2 + 0x10));
        }
        local_c = 0xffffffff;
        FUN_00474620(local_50);
      }
      local_74 = local_74 + 1;
      ppvVar3 = ExceptionList;
    } while (local_74 < *(int *)(param_1 + 0xc));
    ExceptionList = local_14;
    return CONCAT31((int3)((uint)local_74 >> 8),local_8f);
  }
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00474890 : PUSH EBP
00474891 : MOV EBP,ESP
00474893 : AND ESP,0xfffffff8
00474896 : PUSH -0x1
00474898 : PUSH 0xb82a94
0047489d : MOV EAX,FS:[0x0]
004748a3 : PUSH EAX
004748a4 : SUB ESP,0x80
004748aa : PUSH EBX
004748ab : PUSH ESI
004748ac : PUSH EDI
004748ad : MOV EAX,[0x00d66fa0]
004748b2 : XOR EAX,ESP
004748b4 : PUSH EAX
004748b5 : LEA EAX,[ESP + 0x90]
004748bc : MOV FS:[0x0],EAX
004748c2 : MOV ESI,dword ptr [EBP + 0x8]
004748c5 : XOR EAX,EAX
004748c7 : CMP dword ptr [ESI + 0xc],EAX
004748ca : MOV CL,0x1
004748cc : MOV byte ptr [ESP + 0x15],CL
004748d0 : MOV dword ptr [ESP + 0x30],EAX
004748d4 : JLE 0x00474ca6
004748da : MOV ECX,dword ptr [ESI + 0x8]
004748dd : MOV EBX,dword ptr [ECX + EAX*0x4]
004748e0 : CMP byte ptr [EBX + 0x1f9],0x0
004748e7 : MOV CL,byte ptr [EBX + 0x1f8]
004748ed : MOV byte ptr [ESP + 0x17],CL
004748f1 : JZ 0x00474901
004748f3 : CMP byte ptr [ESI + 0xd14],0x0
004748fa : MOV byte ptr [ESP + 0x16],0x1
004748ff : JNZ 0x00474906
00474901 : MOV byte ptr [ESP + 0x16],0x0
00474906 : TEST CL,CL
00474908 : JNZ 0x00474914
0047490a : CMP byte ptr [ESP + 0x16],CL
0047490e : JZ 0x00474c7c
00474914 : MOV ESI,dword ptr [EBP + 0xc]
00474917 : ADD ESI,0x6c
0047491a : PUSH ESI
0047491b : LEA EDX,[ESP + 0x30]
0047491f : LEA EAX,[ESP + 0x3c]
00474923 : MOV dword ptr [ESP + 0x30],EBX
00474927 : CALL 0x00473b50
0047492c : MOV ECX,dword ptr [ESP + 0x38]
00474930 : TEST ECX,ECX
00474932 : JNZ 0x004749fd
00474938 : LEA EDX,[ESP + 0x2c]
0047493c : PUSH EDX
0047493d : MOV EAX,ESI
0047493f : MOV dword ptr [ESP + 0x30],EBX
00474943 : CALL 0x004742f0
00474948 : AND byte ptr [ESP + 0x15],0x1
0047494d : MOV ESI,EAX
0047494f : MOV dword ptr [ESI + 0x58],0x4
00474956 : MOV EDI,0x1
0047495b : MOV dword ptr [ESI + 0x14],EDI
0047495e : CMP byte ptr [EBX + 0x1f9],0x0
00474965 : MOV dword ptr [ESP + 0x18],ESI
00474969 : JZ 0x00474974
0047496b : CMP byte ptr [EBX + 0x10ec],0x0
00474972 : JNZ 0x00474976
00474974 : XOR EDI,EDI
00474976 : MOV AL,byte ptr [EBX + 0x1f8]
0047497c : XOR ECX,ECX
0047497e : TEST AL,AL
00474980 : MOV EAX,dword ptr [EBX + 0x10e4]
00474986 : SETNZ CL
00474989 : XOR EDX,EDX
0047498b : PUSH 0x1
0047498d : PUSH 0xcd5f20
00474992 : ADD ECX,EDI
00474994 : CMP byte ptr [EBX + 0x1078],DL
0047499a : MOV EDI,dword ptr [EBX + 0x10e8]
004749a0 : SETZ DL
004749a3 : IMUL EAX,EDI
004749a6 : LEA EDX,[EDX + EDX*0x1 + 0x4]
004749aa : IMUL EAX,EDX
004749ad : IMUL EAX,ECX
004749b0 : MOV EDI,EAX
004749b2 : PUSH EDI
004749b3 : LEA EAX,[ESP + 0x7c]
004749b7 : PUSH EAX
004749b8 : CALL 0x00474550
004749bd : MOV dword ptr [ESP + 0x98],0x0
004749c8 : MOV ECX,dword ptr [ESP + 0x74]
004749cc : PUSH EDI
004749cd : PUSH ECX
004749ce : CALL 0x004743b0
004749d3 : AND byte ptr [ESP + 0x15],AL
004749d7 : MOV EDI,ESI
004749d9 : CALL 0x004744b0
004749de : AND byte ptr [ESP + 0x15],AL
004749e2 : MOV dword ptr [ESP + 0x98],0xffffffff
004749ed : LEA EDX,[ESP + 0x70]
004749f1 : PUSH EDX
004749f2 : CALL 0x00474620
004749f7 : MOV EDI,dword ptr [ESP + 0x18]
004749fb : JMP 0x00474a15
004749fd : MOV EAX,dword ptr [ESP + 0x3c]
00474a01 : TEST EAX,EAX
00474a03 : JZ 0x00474a0c
00474a05 : MOV EAX,dword ptr [EAX + 0x4]
00474a08 : ADD EAX,ECX
00474a0a : JMP 0x00474a0e
00474a0c : XOR EAX,EAX
00474a0e : LEA EDI,[EAX + 0x4]
00474a11 : MOV dword ptr [ESP + 0x18],EDI
00474a15 : CMP byte ptr [EBX + 0x1f9],0x0
00474a1c : MOV EAX,dword ptr [EBX + 0x10e4]
00474a22 : MOV dword ptr [ESP + 0x28],EAX
00474a26 : JZ 0x00474a38
00474a28 : CMP byte ptr [EBX + 0x10ec],0x0
00474a2f : JZ 0x00474a38
00474a31 : MOV ESI,0x1
00474a36 : JMP 0x00474a3a
00474a38 : XOR ESI,ESI
00474a3a : MOV CL,byte ptr [EBX + 0x1f8]
00474a40 : XOR EDX,EDX
00474a42 : TEST CL,CL
00474a44 : SETNZ DL
00474a47 : PUSH 0x1
00474a49 : PUSH 0xcd615c
00474a4e : ADD EDX,ESI
00474a50 : MOV ESI,dword ptr [EBX + 0x10e8]
00474a56 : MOV ECX,EDX
00474a58 : XOR EDX,EDX
00474a5a : CMP byte ptr [EBX + 0x1078],DL
00474a60 : SETZ DL
00474a63 : LEA EDX,[EDX + EDX*0x1 + 0x4]
00474a67 : IMUL EAX,EDX
00474a6a : IMUL EAX,ESI
00474a6d : IMUL EAX,ECX
00474a70 : PUSH EAX
00474a71 : LEA EAX,[ESP + 0x60]
00474a75 : PUSH EAX
00474a76 : CALL 0x00474550
00474a7b : MOV dword ptr [ESP + 0x98],0x1
00474a86 : MOV ECX,dword ptr [EBP + 0xc]
00474a89 : MOV ESI,dword ptr [ESP + 0x58]
00474a8d : XOR EAX,EAX
00474a8f : CMP dword ptr [ECX + 0x10],EAX
00474a92 : MOV dword ptr [ESP + 0x1c],0x7fffffff
00474a9a : MOV dword ptr [ESP + 0x20],EAX
00474a9e : MOV dword ptr [ESP + 0x2c],EAX
00474aa2 : JLE 0x00474c60
00474aa8 : JMP 0x00474ab0
00474ab0 : MOV ECX,dword ptr [ECX + 0xc]
00474ab3 : MOV EAX,dword ptr [ECX + EAX*0x4]
00474ab6 : CMP dword ptr [EAX + 0x84],-0x1
00474abd : MOV dword ptr [ESP + 0x34],EAX
00474ac1 : JZ 0x00474c01
00474ac7 : LEA EDI,[EAX + 0x38]
00474aca : XOR EAX,EAX
00474acc : MOV dword ptr [ESP + 0x48],EAX
00474ad0 : MOV dword ptr [ESP + 0x4c],EAX
00474ad4 : PUSH EDI
00474ad5 : LEA EDX,[ESP + 0x28]
00474ad9 : LEA EAX,[ESP + 0x44]
00474add : MOV dword ptr [ESP + 0x28],EBX
00474ae1 : MOV dword ptr [ESP + 0x54],EDI
00474ae5 : CALL 0x004746d0
00474aea : MOV ECX,dword ptr [EAX + 0x4]
00474aed : MOV EAX,dword ptr [EAX]
00474aef : TEST EAX,EAX
00474af1 : JZ 0x00474bfd
00474af7 : MOV dword ptr [ESP + 0x48],EAX
00474afb : MOV dword ptr [ESP + 0x4c],ECX
00474aff : TEST ECX,ECX
00474b01 : JZ 0x00474b0a
00474b03 : MOV ECX,dword ptr [ECX + 0x4]
00474b06 : ADD ECX,EAX
00474b08 : JMP 0x00474b0c
00474b0a : XOR ECX,ECX
00474b0c : CMP dword ptr [ECX],0x0
00474b0f : JZ 0x00474bfd
00474b15 : PUSH EDI
00474b16 : LEA EDI,[ESP + 0x28]
00474b1a : LEA EAX,[ESP + 0x4c]
00474b1e : MOV dword ptr [ESP + 0x28],0x0
00474b26 : CALL 0x00474740
00474b2b : TEST EAX,EAX
00474b2d : JZ 0x00474bfd
00474b33 : MOV EDI,dword ptr [ESP + 0x24]
00474b37 : TEST EDI,EDI
00474b39 : JLE 0x00474bfd
00474b3f : MOV EDX,dword ptr [ESP + 0x34]
00474b43 : MOV EAX,dword ptr [EDX + 0x84]
00474b49 : XOR ECX,ECX
00474b4b : CMP byte ptr [ESP + 0x16],CL
00474b4f : MOV dword ptr [ESP + 0x34],EAX
00474b53 : MOV EAX,dword ptr [ESP + 0x28]
00474b57 : SETNZ CL
00474b5a : XOR EDX,EDX
00474b5c : CMP byte ptr [ESP + 0x17],DL
00474b60 : SETNZ DL
00474b63 : ADD ECX,EDX
00474b65 : IMUL EDI,ECX
00474b68 : CMP EDI,EAX
00474b6a : JLE 0x00474b7f
00474b6c : PUSH EAX
00474b6d : PUSH EDI
00474b6e : PUSH 0xcd6170
00474b73 : CALL 0x00807d70
00474b78 : MOV EDI,dword ptr [ESP + 0x34]
00474b7c : ADD ESP,0xc
00474b7f : MOV EAX,EBX
00474b81 : CALL 0x004747c0
00474b86 : IMUL EAX,dword ptr [ESP + 0x34]
00474b8b : CMP dword ptr [ESP + 0x1c],EAX
00474b8f : JC 0x00474b95
00474b91 : MOV dword ptr [ESP + 0x1c],EAX
00474b95 : MOV ECX,dword ptr [EBP + 0x8]
00474b98 : CMP byte ptr [ECX + 0x7658],0x0
00474b9f : JZ 0x00474bbd
00474ba1 : LEA ECX,[EDI*0x4 + 0x0]
00474ba8 : TEST ECX,ECX
00474baa : JLE 0x00474bf3
00474bac : LEA ESP,[ESP]
00474bb0 : MOV dword ptr [ESI],EAX
00474bb2 : ADD ESI,0x4
00474bb5 : INC EAX
00474bb6 : SUB ECX,0x1
00474bb9 : JNZ 0x00474bb0
00474bbb : JMP 0x00474bf3
00474bbd : TEST EDI,EDI
00474bbf : JLE 0x00474bf3
00474bc1 : LEA ECX,[EAX + 0x2]
00474bc4 : MOV dword ptr [ESI],EAX
00474bc6 : ADD ESI,0x4
00474bc9 : LEA EDX,[ECX + -0x1]
00474bcc : MOV dword ptr [ESI],EDX
00474bce : ADD ESI,0x4
00474bd1 : MOV dword ptr [ESI],ECX
00474bd3 : ADD ESI,0x4
00474bd6 : MOV dword ptr [ESI],EAX
00474bd8 : ADD ESI,0x4
00474bdb : MOV dword ptr [ESI],ECX
00474bdd : ADD ESI,0x4
00474be0 : LEA EDX,[ECX + 0x1]
00474be3 : MOV dword ptr [ESI],EDX
00474be5 : ADD ESI,0x4
00474be8 : ADD EAX,0x4
00474beb : ADD ECX,0x4
00474bee : SUB EDI,0x1
00474bf1 : JNZ 0x00474bc4
00474bf3 : CMP dword ptr [ESP + 0x20],EAX
00474bf7 : JA 0x00474bfd
00474bf9 : MOV dword ptr [ESP + 0x20],EAX
00474bfd : MOV EDI,dword ptr [ESP + 0x18]
00474c01 : MOV EAX,dword ptr [ESP + 0x2c]
00474c05 : MOV ECX,dword ptr [EBP + 0xc]
00474c08 : INC EAX
00474c09 : CMP EAX,dword ptr [ECX + 0x10]
00474c0c : MOV dword ptr [ESP + 0x2c],EAX
00474c10 : JL 0x00474ab0
00474c16 : MOV ECX,dword ptr [ESP + 0x1c]
00474c1a : CMP ECX,0x7fffffff
00474c20 : JNC 0x00474c60
00474c22 : SUB ESI,dword ptr [ESP + 0x58]
00474c26 : MOV EAX,dword ptr [ESP + 0x20]
00474c2a : SUB EAX,ECX
00474c2c : SAR ESI,0x2
00474c2f : MOV dword ptr [EDI + 0x70],EAX
00474c32 : XOR AL,AL
00474c34 : CMP dword ptr [EDI + 0x10],0x0
00474c38 : MOV dword ptr [EDI + 0x68],ESI
00474c3b : MOV dword ptr [EDI + 0x6c],ECX
00474c3e : MOV EBX,ESI
00474c40 : JZ 0x00474c5c
00474c42 : MOV EAX,dword ptr [ESP + 0x58]
00474c46 : PUSH EBX
00474c47 : PUSH EAX
00474c48 : LEA ESI,[EDI + 0x4]
00474c4b : CALL 0x00474800
00474c50 : TEST AL,AL
00474c52 : JZ 0x00474c5c
00474c54 : CMP EBX,dword ptr [EDI + 0x5c]
00474c57 : JBE 0x00474c5c
00474c59 : MOV dword ptr [EDI + 0x5c],EBX
00474c5c : AND byte ptr [ESP + 0x15],AL
00474c60 : MOV dword ptr [ESP + 0x98],0xffffffff
00474c6b : LEA ECX,[ESP + 0x54]
00474c6f : PUSH ECX
00474c70 : CALL 0x00474620
00474c75 : MOV EAX,dword ptr [ESP + 0x30]
00474c79 : MOV ESI,dword ptr [EBP + 0x8]
00474c7c : INC EAX
00474c7d : CMP EAX,dword ptr [ESI + 0xc]
00474c80 : MOV dword ptr [ESP + 0x30],EAX
00474c84 : JL 0x004748da
00474c8a : MOV AL,byte ptr [ESP + 0x15]
00474c8e : MOV ECX,dword ptr [ESP + 0x90]
00474c95 : MOV dword ptr FS:[0x0],ECX
00474c9c : POP ECX
00474c9d : POP EDI
00474c9e : POP ESI
00474c9f : POP EBX
00474ca0 : MOV ESP,EBP
00474ca2 : POP EBP
00474ca3 : RET 0x8
00474ca6 : MOV AL,CL
00474ca8 : MOV ECX,dword ptr [ESP + 0x90]
00474caf : MOV dword ptr FS:[0x0],ECX
00474cb6 : POP ECX
00474cb7 : POP EDI
00474cb8 : POP ESI
00474cb9 : POP EBX
00474cba : MOV ESP,EBP
00474cbc : POP EBP
00474cbd : RET 0x8
