PROGRAM  : Maestia.exe
FUNCTION : FUN_005aab40
ENTRY    : 005aab40
BODY     : [[005aab40, 005aabec] [005aabf0, 005aad40]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_005aab40(uint param_1)

{
  int iVar1;
  uint *puVar2;
  int *piVar3;
  int iVar4;
  uint uVar5;
  int iVar6;
  void *_Dst;
  byte bVar7;
  int in_ECX;
  uint uVar8;
  
  if (*(uint *)(in_ECX + 0x19c) < 0x20) {
    iVar6 = *(int *)(in_ECX + 8);
    uVar8 = *(uint *)(in_ECX + 0x10);
    bVar7 = (char)*(undefined4 *)(in_ECX + 0xc) + 3;
    uVar5 = ~(iVar6 - 1U);
    if (uVar8 - ((((uVar8 - 1) + iVar6 * 8 >> (bVar7 & 0x1f)) - 1) + iVar6 & uVar5) < param_1) {
      uVar8 = ((((((param_1 - 1) + iVar6 * 8 >> (bVar7 & 0x1f)) - 1) + iVar6 & uVar5) +
                *(uint *)(in_ECX + 0x14) + -1 + param_1) / *(uint *)(in_ECX + 0x14)) *
              *(int *)(in_ECX + 0x14);
    }
    if (uVar8 - ((((uVar8 - 1) + iVar6 * 8 >> (bVar7 & 0x1f)) - 1) + iVar6 & uVar5) < param_1) {
      do {
        uVar8 = uVar8 + *(int *)(in_ECX + 0x14);
      } while (uVar8 - (iVar6 + -1 +
                        ((uVar8 - 1) + iVar6 * 8 >>
                        ((char)*(undefined4 *)(in_ECX + 0xc) + 3U & 0x1f)) & ~(iVar6 - 1U)) <
               param_1);
    }
    do {
      iVar6 = (**(code **)(**(int **)(in_ECX + 4) + 4))(uVar8);
      if (iVar6 != 0) {
        iVar4 = *(int *)(in_ECX + 8);
        iVar1 = ((uVar8 - 1) + iVar4 * 8 >> ((char)*(undefined4 *)(in_ECX + 0xc) + 3U & 0x1f)) +
                iVar4;
        uVar5 = ~(iVar4 - 1U) & iVar1 - 1U;
        _Dst = (void *)(**(code **)(**(int **)(in_ECX + 4) + 0xc))
                                 ((iVar6 - (~(iVar4 - 1U) & iVar1 - 1U)) + uVar8,uVar5);
        if (_Dst != (void *)0x0) {
          _memset(_Dst,0,uVar5 & 0xfffffffc);
          iVar1 = *(int *)(in_ECX + 8);
          bVar7 = (byte)*(undefined4 *)(in_ECX + 0xc);
          uVar5 = uVar8 - ((((uVar8 - 1) + iVar1 * 8 >> (bVar7 + 3 & 0x1f)) - 1) + iVar1 &
                          ~(iVar1 - 1U)) >> (bVar7 & 0x1f);
          puVar2 = (uint *)((int)_Dst + (uVar5 >> 5) * 4);
          *puVar2 = *puVar2 | 1 << ((byte)uVar5 & 0x1f);
          uVar5 = FUN_005aaaa0(iVar6);
          if (uVar5 < *(uint *)(in_ECX + 0x19c)) {
            iVar1 = in_ECX + uVar5 * 0xc;
            _memmove((void *)(iVar1 + 0x28),(void *)(iVar1 + 0x1c),
                     (*(uint *)(in_ECX + 0x19c) - uVar5) * 0xc);
          }
          *(int *)(in_ECX + 0x19c) = *(int *)(in_ECX + 0x19c) + 1;
          piVar3 = (int *)(in_ECX + 0x1c + uVar5 * 0xc);
          piVar3[1] = uVar8;
          *piVar3 = iVar6;
          piVar3[2] = 0;
          return 1;
        }
        (**(code **)(**(int **)(in_ECX + 4) + 8))(iVar6,uVar8);
        return 0;
      }
      uVar5 = *(uint *)(in_ECX + 0x14);
      uVar8 = ((((uVar8 >> 1) - 1) + uVar5) / uVar5) * uVar5;
    } while ((uVar5 * 2 <= uVar8) &&
            (iVar6 = *(int *)(in_ECX + 8),
            param_1 <=
            uVar8 - ((((uVar8 - 1) + iVar6 * 8 >> ((char)*(undefined4 *)(in_ECX + 0xc) + 3U & 0x1f))
                     - 1) + iVar6 & ~(iVar6 - 1U))));
  }
  return 0;
}



============================================================
DISASSEMBLY
============================================================
005aab40 : SUB ESP,0x8
005aab43 : PUSH EBX
005aab44 : PUSH EBP
005aab45 : PUSH ESI
005aab46 : MOV ESI,ECX
005aab48 : CMP dword ptr [ESI + 0x19c],0x20
005aab4f : PUSH EDI
005aab50 : JNC 0x005aac39
005aab56 : MOV EBP,dword ptr [ESI + 0x8]
005aab59 : MOV EDI,dword ptr [ESI + 0x10]
005aab5c : MOV EAX,dword ptr [ESI + 0xc]
005aab5f : LEA ECX,[EAX + 0x3]
005aab62 : LEA EDX,[EDI + EBP*0x8 + -0x1]
005aab66 : SHR EDX,CL
005aab68 : LEA EAX,[EBP + -0x1]
005aab6b : NOT EAX
005aab6d : MOV EBX,EDI
005aab6f : LEA EDX,[EDX + EBP*0x1 + -0x1]
005aab73 : AND EDX,EAX
005aab75 : SUB EBX,EDX
005aab77 : MOV EDX,EBX
005aab79 : MOV EBX,dword ptr [ESP + 0x1c]
005aab7d : MOV dword ptr [ESP + 0x14],EAX
005aab81 : CMP EDX,EBX
005aab83 : JNC 0x005aaba8
005aab85 : MOV EDI,dword ptr [ESI + 0x14]
005aab88 : LEA EDX,[EBX + EBP*0x8 + -0x1]
005aab8c : SHR EDX,CL
005aab8e : LEA EDX,[EDX + EBP*0x1 + -0x1]
005aab92 : AND EDX,EAX
005aab94 : ADD EDX,EDI
005aab96 : LEA EAX,[EDX + EBX*0x1 + -0x1]
005aab9a : XOR EDX,EDX
005aab9c : DIV EDI
005aab9e : MOV EDI,EAX
005aaba0 : IMUL EDI,dword ptr [ESI + 0x14]
005aaba4 : MOV EAX,dword ptr [ESP + 0x14]
005aaba8 : LEA EDX,[EDI + EBP*0x8 + -0x1]
005aabac : SHR EDX,CL
005aabae : LEA ECX,[EDX + EBP*0x1 + -0x1]
005aabb2 : AND ECX,EAX
005aabb4 : MOV EDX,EDI
005aabb6 : SUB EDX,ECX
005aabb8 : CMP EDX,EBX
005aabba : JNC 0x005aabf0
005aabbc : MOV ECX,dword ptr [ESI + 0xc]
005aabbf : MOV EAX,EBP
005aabc1 : ADD ECX,0x3
005aabc4 : LEA EDX,[EAX + -0x1]
005aabc7 : MOV dword ptr [ESP + 0x1c],ECX
005aabcb : NOT EDX
005aabcd : LEA ECX,[ECX]
005aabd0 : ADD EDI,dword ptr [ESI + 0x14]
005aabd3 : MOV ECX,dword ptr [ESP + 0x1c]
005aabd7 : LEA EBP,[EDI + EAX*0x8 + -0x1]
005aabdb : SHR EBP,CL
005aabdd : LEA ECX,[EAX + EBP*0x1 + -0x1]
005aabe1 : AND ECX,EDX
005aabe3 : MOV EBP,EDI
005aabe5 : SUB EBP,ECX
005aabe7 : CMP EBP,EBX
005aabe9 : JC 0x005aabd0
005aabeb : JMP 0x005aabf0
005aabf0 : MOV ECX,dword ptr [ESI + 0x4]
005aabf3 : MOV EDX,dword ptr [ECX]
005aabf5 : MOV EAX,dword ptr [EDX + 0x4]
005aabf8 : PUSH EDI
005aabf9 : CALL EAX
005aabfb : MOV EBP,EAX
005aabfd : TEST EBP,EBP
005aabff : JNZ 0x005aac45
005aac01 : MOV ECX,dword ptr [ESI + 0x14]
005aac04 : SHR EDI,0x1
005aac06 : LEA EAX,[EDI + ECX*0x1 + -0x1]
005aac0a : XOR EDX,EDX
005aac0c : DIV ECX
005aac0e : IMUL EAX,ECX
005aac11 : MOV EDI,EAX
005aac13 : ADD ECX,ECX
005aac15 : CMP EDI,ECX
005aac17 : JC 0x005aac39
005aac19 : MOV EAX,dword ptr [ESI + 0x8]
005aac1c : MOV ECX,dword ptr [ESI + 0xc]
005aac1f : ADD ECX,0x3
005aac22 : LEA EDX,[EDI + EAX*0x8 + -0x1]
005aac26 : SHR EDX,CL
005aac28 : LEA ECX,[EDX + EAX*0x1 + -0x1]
005aac2c : DEC EAX
005aac2d : NOT EAX
005aac2f : AND ECX,EAX
005aac31 : MOV EDX,EDI
005aac33 : SUB EDX,ECX
005aac35 : CMP EDX,EBX
005aac37 : JNC 0x005aabf0
005aac39 : POP EDI
005aac3a : POP ESI
005aac3b : POP EBP
005aac3c : XOR AL,AL
005aac3e : POP EBX
005aac3f : ADD ESP,0x8
005aac42 : RET 0x4
005aac45 : MOV EAX,dword ptr [ESI + 0x8]
005aac48 : MOV ECX,dword ptr [ESI + 0xc]
005aac4b : ADD ECX,0x3
005aac4e : LEA EDX,[EDI + EAX*0x8 + -0x1]
005aac52 : SHR EDX,CL
005aac54 : LEA EBX,[EAX + -0x1]
005aac57 : NOT EBX
005aac59 : LEA ECX,[EDX + EAX*0x1]
005aac5c : LEA EDX,[ECX + -0x1]
005aac5f : AND EBX,EDX
005aac61 : MOV EDX,EBP
005aac63 : SUB EDX,EBX
005aac65 : LEA EBX,[EAX + -0x1]
005aac68 : DEC ECX
005aac69 : NOT EBX
005aac6b : AND EBX,ECX
005aac6d : MOV ECX,dword ptr [ESI + 0x4]
005aac70 : MOV EAX,dword ptr [ECX]
005aac72 : ADD EDX,EDI
005aac74 : PUSH EBX
005aac75 : PUSH EDX
005aac76 : MOV EDX,dword ptr [EAX + 0xc]
005aac79 : CALL EDX
005aac7b : MOV dword ptr [ESP + 0x1c],EAX
005aac7f : TEST EAX,EAX
005aac81 : JNZ 0x005aac9b
005aac83 : MOV ECX,dword ptr [ESI + 0x4]
005aac86 : MOV EAX,dword ptr [ECX]
005aac88 : MOV EDX,dword ptr [EAX + 0x8]
005aac8b : PUSH EDI
005aac8c : PUSH EBP
005aac8d : CALL EDX
005aac8f : POP EDI
005aac90 : POP ESI
005aac91 : POP EBP
005aac92 : XOR AL,AL
005aac94 : POP EBX
005aac95 : ADD ESP,0x8
005aac98 : RET 0x4
005aac9b : SHR EBX,0x2
005aac9e : ADD EBX,EBX
005aaca0 : ADD EBX,EBX
005aaca2 : PUSH EBX
005aaca3 : PUSH 0x0
005aaca5 : PUSH EAX
005aaca6 : CALL 0x0063b700
005aacab : MOV EAX,dword ptr [ESI + 0x8]
005aacae : MOV EDX,dword ptr [ESI + 0xc]
005aacb1 : LEA EBX,[EDI + EAX*0x8 + -0x1]
005aacb5 : LEA ECX,[EDX + 0x3]
005aacb8 : SHR EBX,CL
005aacba : ADD ESP,0xc
005aacbd : PUSH EBP
005aacbe : LEA ECX,[EBX + EAX*0x1 + -0x1]
005aacc2 : DEC EAX
005aacc3 : NOT EAX
005aacc5 : AND ECX,EAX
005aacc7 : MOV EAX,EDI
005aacc9 : SUB EAX,ECX
005aaccb : MOV ECX,EDX
005aaccd : SHR EAX,CL
005aaccf : MOV ECX,dword ptr [ESP + 0x20]
005aacd3 : MOV EDX,EAX
005aacd5 : SHR EDX,0x5
005aacd8 : LEA EDX,[ECX + EDX*0x4]
005aacdb : MOV ECX,EAX
005aacdd : AND ECX,0x1f
005aace0 : MOV EAX,0x1
005aace5 : SHL EAX,CL
005aace7 : MOV ECX,ESI
005aace9 : OR dword ptr [EDX],EAX
005aaceb : CALL 0x005aaaa0
005aacf0 : MOV EBX,EAX
005aacf2 : MOV EAX,dword ptr [ESI + 0x19c]
005aacf8 : CMP EBX,EAX
005aacfa : JNC 0x005aad1c
005aacfc : SUB EAX,EBX
005aacfe : LEA EDX,[EAX + EAX*0x2]
005aad01 : ADD EDX,EDX
005aad03 : LEA ECX,[EBX + EBX*0x2]
005aad06 : LEA ECX,[ESI + ECX*0x4]
005aad09 : ADD EDX,EDX
005aad0b : PUSH EDX
005aad0c : LEA EAX,[ECX + 0x1c]
005aad0f : PUSH EAX
005aad10 : ADD ECX,0x28
005aad13 : PUSH ECX
005aad14 : CALL 0x00636880
005aad19 : ADD ESP,0xc
005aad1c : INC dword ptr [ESI + 0x19c]
005aad22 : LEA ECX,[EBX + EBX*0x2]
005aad25 : LEA ESI,[ESI + ECX*0x4 + 0x1c]
005aad29 : MOV dword ptr [ESI + 0x4],EDI
005aad2c : POP EDI
005aad2d : MOV dword ptr [ESI],EBP
005aad2f : MOV dword ptr [ESI + 0x8],0x0
005aad36 : POP ESI
005aad37 : POP EBP
005aad38 : MOV AL,0x1
005aad3a : POP EBX
005aad3b : ADD ESP,0x8
005aad3e : RET 0x4
