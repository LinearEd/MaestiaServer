PROGRAM  : Maestia.exe
FUNCTION : FUN_004670a0
ENTRY    : 004670a0
BODY     : [[004670a0, 00467522]]

============================================================
DECOMPILED C CODE
============================================================

byte FUN_004670a0(int param_1,int param_2,int param_3)

{
  float fVar1;
  undefined4 uVar2;
  bool bVar3;
  bool bVar4;
  char cVar5;
  int iVar6;
  int *piVar7;
  int iVar8;
  int iVar9;
  float fVar10;
  double dVar11;
  undefined4 uVar12;
  byte bVar14;
  int *piVar13;
  int iStack_2c;
  
  if (*(int *)(param_2 + 0x10) == 0) {
    return 1;
  }
  cVar5 = FUN_0046c730();
  if (cVar5 == '\0') {
    return 0;
  }
  piVar13 = DAT_01720efc;
  (**(code **)(*DAT_01720efc + 0xe4))(DAT_01720efc,0x16,1);
  fVar1 = *(float *)(param_3 + 0x17c);
  dVar11 = (double)-fVar1;
  FUN_0063ef0d();
  uVar12 = 0;
  fVar10 = -(float)dVar11;
  dVar11 = (double)fVar1;
  FUN_0063ed62(fVar10,0);
  FUN_0046c3b0((float)dVar11,fVar10,uVar12);
  FUN_0046a520(param_1,fVar1);
  FUN_0046c360();
  FUN_0046c360();
  if (*(char *)(param_1 + 0xd14) == '\0') {
    uVar12 = 0;
  }
  else {
    uVar12 = *(undefined4 *)(param_3 + 0x2a4);
  }
  FUN_0046c5e0(uVar12);
  bVar14 = (byte)((uint)piVar13 >> 8);
  iVar6 = *(int *)(param_2 + 4);
  bVar4 = false;
  iStack_2c = 0;
  if (0 < *(int *)(iVar6 + 8)) {
    do {
      iVar6 = *(int *)(*(int *)(iVar6 + 4) + iStack_2c * 4);
      if ((*(char *)(iVar6 + 0x1f9) == '\0') || (bVar3 = true, *(char *)(param_1 + 0xd14) == '\0'))
      {
        bVar3 = false;
      }
      if ((*(char *)(iVar6 + 0x1f8) != '\0') || (bVar3)) {
        piVar7 = (int *)FUN_00473b50(param_2 + 0x6c);
        if (*piVar7 != 0) {
          if (piVar7[1] == 0) {
            iVar9 = 0;
          }
          else {
            iVar9 = *(int *)(piVar7[1] + 4) + *piVar7;
          }
          FUN_0046a470(param_1);
          iVar8 = FUN_0046a050(param_1,*(int *)(iVar6 + 0x138) * 0x1128 + *(int *)(iVar6 + 0xda8),1)
          ;
          if (0 < iVar8) {
            *(int *)(param_1 + 0x7564) = *(int *)(param_1 + 0x7564) + iVar8;
          }
          iVar8 = *(int *)(iVar6 + 0x13c);
          if (0 < iVar8) {
            FUN_0046c5e0((float)iVar8);
            FUN_0046c3b0(*(float *)(iVar6 + 0x140) * -0.5,*(undefined4 *)(iVar6 + 0x144),
                         *(undefined4 *)(iVar6 + 0x148));
            if (*(int *)(param_1 + 0xd20) < iVar8) {
              FUN_00807d70("CForestRI::RenderBillboards, tried to upload %d billboards for a base tree, but %d was the max set in CForestRI:SetRenderInfo(); truncating"
                           ,*(undefined4 *)(iVar6 + 0x13c),*(int *)(param_1 + 0xd20));
            }
            FUN_0046c300(*(undefined4 *)(iVar6 + 0x14c));
            FUN_00467530(param_1);
          }
          if (bVar3) {
            cVar5 = (**(code **)(*(int *)PTR_DAT_00d6df20 + 8))();
            if (cVar5 == '\0') {
              uVar12 = *(undefined4 *)(iVar6 + 0x15c);
              uVar2 = *(undefined4 *)(iVar6 + 0x174);
            }
            else {
              uVar12 = *(undefined4 *)(iVar6 + 0x160);
              uVar2 = *(undefined4 *)(iVar6 + 0x178);
            }
            FUN_0046c3b0(*(undefined4 *)(iVar6 + 0x164),uVar12,uVar2);
            FUN_0046c360();
          }
          if ((*(int *)(iVar9 + 0x60) != 0) && (*(int *)(iVar9 + 0x6c) != 0)) {
            if (!bVar4) {
              FUN_0046ab70();
              bVar4 = true;
            }
            cVar5 = FUN_0046ab90();
            if ((cVar5 != '\0') && (cVar5 = FUN_0046abe0(), cVar5 != '\0')) {
              *(int *)(param_1 + 0x756c) = *(int *)(param_1 + 0x756c) + 1;
              if (*(char *)(param_1 + 0x7658) == '\0') {
                FUN_0046ac20(6,0,*(undefined4 *)(iVar9 + 0x70));
                *(int *)(param_1 + 0x7570) =
                     *(int *)(param_1 + 0x7570) + *(uint *)(iVar9 + 0x6c) / 3;
                *(int *)(param_1 + 0x7560) =
                     *(int *)(param_1 + 0x7560) + *(uint *)(iVar9 + 0x6c) / 6;
              }
              else {
                FUN_0046ac20(8,0,*(undefined4 *)(iVar9 + 0x70));
                *(int *)(param_1 + 0x7570) =
                     *(int *)(param_1 + 0x7570) + (*(uint *)(iVar9 + 0x6c) >> 1);
                *(int *)(param_1 + 0x7560) =
                     *(int *)(param_1 + 0x7560) + (*(uint *)(iVar9 + 0x6c) >> 2);
              }
              FUN_0046ac00();
              FUN_0046abc0();
              *(int *)(param_1 + 0x7568) = *(int *)(param_1 + 0x7568) + 1;
            }
          }
        }
      }
      bVar14 = (byte)((uint)piVar13 >> 8);
      iVar6 = *(int *)(param_2 + 4);
      iStack_2c = iStack_2c + 1;
    } while (iStack_2c < *(int *)(iVar6 + 8));
  }
  (**(code **)(*DAT_01720efc + 0x170))(DAT_01720efc,0);
  (**(code **)(*DAT_01720efc + 0x1ac))(DAT_01720efc,0);
  return bVar14 & 1;
}



============================================================
DISASSEMBLY
============================================================
004670a0 : PUSH EBP
004670a1 : MOV EBP,ESP
004670a3 : AND ESP,0xfffffff0
004670a6 : MOV EAX,dword ptr [EBP + 0xc]
004670a9 : SUB ESP,0x24
004670ac : CMP dword ptr [EAX + 0x10],0x0
004670b0 : PUSH EBX
004670b1 : MOV EBX,dword ptr [EBP + 0x8]
004670b4 : PUSH ESI
004670b5 : PUSH EDI
004670b6 : JNZ 0x004670c3
004670b8 : MOV AL,0x1
004670ba : POP EDI
004670bb : POP ESI
004670bc : POP EBX
004670bd : MOV ESP,EBP
004670bf : POP EBP
004670c0 : RET 0xc
004670c3 : LEA EAX,[EBX + 0x2288]
004670c9 : CALL 0x0046c730
004670ce : TEST AL,AL
004670d0 : JZ 0x00467511
004670d6 : MOV EAX,[0x01720efc]
004670db : MOV ECX,dword ptr [EAX]
004670dd : MOV EDX,dword ptr [ECX + 0xe4]
004670e3 : PUSH 0x1
004670e5 : PUSH 0x16
004670e7 : PUSH EAX
004670e8 : CALL EDX
004670ea : MOV EAX,dword ptr [EBP + 0x10]
004670ed : MOVSS XMM0,dword ptr [EAX + 0x17c]
004670f5 : MOVSS dword ptr [ESP + 0x18],XMM0
004670fb : XORPS XMM0,xmmword ptr [0x00cdf0c0]
00467102 : CVTPS2PD XMM0,XMM0
00467105 : CALL 0x0063ef0d
0046710a : FLDZ
0046710c : CVTSD2SS XMM0,XMM0
00467110 : SUB ESP,0x8
00467113 : MOVSS dword ptr [ESP + 0x28],XMM0
00467119 : FSTP float ptr [ESP + 0x4]
0046711d : XORPS XMM0,xmmword ptr [0x00cdf0c0]
00467124 : MOVSS dword ptr [ESP],XMM0
00467129 : CVTSS2SD XMM0,dword ptr [ESP + 0x20]
0046712f : CALL 0x0063ed62
00467134 : CVTSD2SS XMM0,XMM0
00467138 : PUSH ECX
00467139 : MOVSS dword ptr [ESP],XMM0
0046713e : MOVSS XMM0,dword ptr [ESP + 0x2c]
00467144 : LEA EAX,[EBX + 0x549c]
0046714a : CALL 0x0046c3b0
0046714f : FLD float ptr [ESP + 0x18]
00467153 : PUSH ECX
00467154 : FSTP float ptr [ESP]
00467157 : AND AL,0x1
00467159 : PUSH EBX
0046715a : MOV byte ptr [ESP + 0x19],AL
0046715e : CALL 0x0046a520
00467163 : AND byte ptr [ESP + 0x11],AL
00467167 : LEA EDI,[EBX + 0xd2c]
0046716d : LEA ESI,[EBX + 0x35fc]
00467173 : CALL 0x0046c360
00467178 : AND byte ptr [ESP + 0x11],AL
0046717c : LEA EDI,[EBX + 0xd3c]
00467182 : LEA ESI,[EBX + 0x3714]
00467188 : CALL 0x0046c360
0046718d : AND byte ptr [ESP + 0x11],AL
00467191 : CMP byte ptr [EBX + 0xd14],0x0
00467198 : JZ 0x004671a7
0046719a : MOV ECX,dword ptr [EBP + 0x10]
0046719d : MOVSS XMM0,dword ptr [ECX + 0x2a4]
004671a5 : JMP 0x004671aa
004671a7 : XORPS XMM0,XMM0
004671aa : MOVSS dword ptr [ESP + 0x18],XMM0
004671b0 : FLD float ptr [ESP + 0x18]
004671b4 : PUSH ECX
004671b5 : LEA ESI,[EBX + 0x5a14]
004671bb : FSTP float ptr [ESP]
004671be : CALL 0x0046c5e0
004671c3 : AND byte ptr [ESP + 0x11],AL
004671c7 : MOV EDX,dword ptr [EBP + 0xc]
004671ca : MOV EAX,dword ptr [EDX + 0x4]
004671cd : XOR ECX,ECX
004671cf : CMP dword ptr [EAX + 0x8],ECX
004671d2 : MOV byte ptr [ESP + 0x13],0x0
004671d7 : MOV dword ptr [ESP + 0x20],ECX
004671db : JLE 0x004674db
004671e1 : MOV EAX,dword ptr [EAX + 0x4]
004671e4 : MOV EDI,dword ptr [EAX + ECX*0x4]
004671e7 : CMP byte ptr [EDI + 0x1f9],0x0
004671ee : MOV AL,byte ptr [EDI + 0x1f8]
004671f4 : MOV dword ptr [ESP + 0x18],EDI
004671f8 : JZ 0x00467208
004671fa : CMP byte ptr [EBX + 0xd14],0x0
00467201 : MOV byte ptr [ESP + 0x12],0x1
00467206 : JNZ 0x0046720d
00467208 : MOV byte ptr [ESP + 0x12],0x0
0046720d : TEST AL,AL
0046720f : JNZ 0x0046721b
00467211 : CMP byte ptr [ESP + 0x12],AL
00467215 : JZ 0x004674b7
0046721b : ADD EDX,0x6c
0046721e : PUSH EDX
0046721f : LEA EDX,[ESP + 0x20]
00467223 : LEA EAX,[ESP + 0x2c]
00467227 : MOV dword ptr [ESP + 0x20],EDI
0046722b : CALL 0x00473b50
00467230 : MOV ECX,dword ptr [EAX]
00467232 : MOV EAX,dword ptr [EAX + 0x4]
00467235 : TEST ECX,ECX
00467237 : JZ 0x004674b7
0046723d : TEST EAX,EAX
0046723f : JZ 0x00467248
00467241 : MOV ESI,dword ptr [EAX + 0x4]
00467244 : ADD ESI,ECX
00467246 : JMP 0x0046724a
00467248 : XOR ESI,ESI
0046724a : ADD ESI,0x4
0046724d : LEA ECX,[EDI + 0x1bc]
00467253 : PUSH EBX
00467254 : MOV dword ptr [ESP + 0x20],ESI
00467258 : CALL 0x0046a470
0046725d : AND byte ptr [ESP + 0x11],AL
00467261 : MOV EAX,dword ptr [EDI + 0x138]
00467267 : IMUL EAX,EAX,0x1128
0046726d : ADD EAX,dword ptr [EDI + 0xda8]
00467273 : PUSH 0x1
00467275 : PUSH EAX
00467276 : PUSH EBX
00467277 : CALL 0x0046a050
0046727c : TEST EAX,EAX
0046727e : JLE 0x0046728b
00467280 : AND byte ptr [ESP + 0x11],0x1
00467285 : ADD dword ptr [EBX + 0x7564],EAX
0046728b : MOV EAX,dword ptr [EDI + 0x13c]
00467291 : MOV dword ptr [ESP + 0x14],EAX
00467295 : TEST EAX,EAX
00467297 : JLE 0x0046735f
0046729d : PUSH ECX
0046729e : CVTSI2SS XMM0,EAX
004672a2 : LEA ESI,[EBX + 0x5384]
004672a8 : MOVSS dword ptr [ESP],XMM0
004672ad : CALL 0x0046c5e0
004672b2 : FLD float ptr [EDI + 0x144]
004672b8 : MOVSS XMM1,dword ptr [EDI + 0x140]
004672c0 : FLD float ptr [EDI + 0x148]
004672c6 : AND byte ptr [ESP + 0x11],AL
004672ca : SUB ESP,0xc
004672cd : FSTP float ptr [ESP + 0x8]
004672d1 : MOVAPS XMM0,XMM1
004672d4 : MULSS XMM1,dword ptr [0x00cdf160]
004672dc : MULSS XMM0,dword ptr [0x00d72c24]
004672e4 : FSTP float ptr [ESP + 0x4]
004672e8 : MOVSS dword ptr [ESP + 0x30],XMM1
004672ee : FLD float ptr [ESP + 0x30]
004672f2 : LEA EAX,[EBX + 0x56cc]
004672f8 : FSTP float ptr [ESP]
004672fb : CALL 0x0046c3b0
00467300 : AND byte ptr [ESP + 0x11],AL
00467304 : MOV EAX,dword ptr [EBX + 0xd20]
0046730a : CMP dword ptr [ESP + 0x14],EAX
0046730e : JLE 0x00467329
00467310 : MOV ECX,dword ptr [EDI + 0x13c]
00467316 : PUSH EAX
00467317 : PUSH ECX
00467318 : PUSH 0xcd50c8
0046731d : MOV dword ptr [ESP + 0x20],EAX
00467321 : CALL 0x00807d70
00467326 : ADD ESP,0xc
00467329 : MOV EDI,dword ptr [EDI + 0x14c]
0046732f : PUSH EDI
00467330 : MOV EDI,dword ptr [ESP + 0x18]
00467334 : LEA ESI,[EBX + 0x55b4]
0046733a : CALL 0x0046c300
0046733f : MOV ECX,dword ptr [ESP + 0x18]
00467343 : AND byte ptr [ESP + 0x11],AL
00467347 : ADD ECX,0x1fc
0046734d : PUSH EBX
0046734e : CALL 0x00467530
00467353 : AND byte ptr [ESP + 0x11],AL
00467357 : MOV EDI,dword ptr [ESP + 0x18]
0046735b : MOV ESI,dword ptr [ESP + 0x1c]
0046735f : CMP byte ptr [ESP + 0x12],0x0
00467364 : JZ 0x004673d9
00467366 : MOV ECX,dword ptr [0x00d6df20]
0046736c : MOV EDX,dword ptr [ECX]
0046736e : MOV EAX,dword ptr [EDX + 0x8]
00467371 : CALL EAX
00467373 : FLD float ptr [EDI + 0x164]
00467379 : MOVSS XMM0,dword ptr [EDI + 0x158]
00467381 : SUB ESP,0xc
00467384 : TEST AL,AL
00467386 : LEA EAX,[EBX + 0x57e4]
0046738c : JZ 0x0046739c
0046738e : FLD float ptr [EDI + 0x160]
00467394 : FLD float ptr [EDI + 0x178]
0046739a : JMP 0x004673a8
0046739c : FLD float ptr [EDI + 0x15c]
004673a2 : FLD float ptr [EDI + 0x174]
004673a8 : FSTP float ptr [ESP + 0x8]
004673ac : FSTP float ptr [ESP + 0x4]
004673b0 : FSTP float ptr [ESP]
004673b3 : CALL 0x0046c3b0
004673b8 : AND byte ptr [ESP + 0x11],AL
004673bc : ADD EDI,0x1a8
004673c2 : LEA ESI,[EBX + 0x5b2c]
004673c8 : CALL 0x0046c360
004673cd : AND byte ptr [ESP + 0x11],AL
004673d1 : MOV EDI,dword ptr [ESP + 0x18]
004673d5 : MOV ESI,dword ptr [ESP + 0x1c]
004673d9 : ADD EDI,0x107c
004673df : CMP dword ptr [ESI + 0x5c],0x0
004673e3 : JBE 0x004674b7
004673e9 : CMP dword ptr [ESI + 0x68],0x0
004673ed : JBE 0x004674b7
004673f3 : CMP byte ptr [ESP + 0x13],0x0
004673f8 : JNZ 0x0046740a
004673fa : MOV EDX,EDI
004673fc : CALL 0x0046ab70
00467401 : AND byte ptr [ESP + 0x11],AL
00467405 : MOV byte ptr [ESP + 0x13],0x1
0046740a : MOV ECX,EDI
0046740c : CALL 0x0046ab90
00467411 : TEST AL,AL
00467413 : JZ 0x004674b2
00467419 : MOV EDX,ESI
0046741b : CALL 0x0046abe0
00467420 : TEST AL,AL
00467422 : JZ 0x004674b2
00467428 : MOV EDI,0x1
0046742d : ADD dword ptr [EBX + 0x756c],EDI
00467433 : CMP byte ptr [EBX + 0x7658],0x0
0046743a : MOV ECX,dword ptr [ESI + 0x6c]
0046743d : MOV EAX,dword ptr [ESI + 0x70]
00467440 : PUSH ECX
00467441 : MOV ECX,dword ptr [ESI + 0x68]
00467444 : PUSH 0x0
00467446 : JZ 0x0046746c
00467448 : PUSH 0x8
0046744a : CALL 0x0046ac20
0046744f : MOV EDX,dword ptr [ESI + 0x68]
00467452 : AND byte ptr [ESP + 0x11],AL
00467456 : SHR EDX,0x1
00467458 : ADD dword ptr [EBX + 0x7570],EDX
0046745e : MOV EAX,dword ptr [ESI + 0x68]
00467461 : SHR EAX,0x2
00467464 : ADD dword ptr [EBX + 0x7560],EAX
0046746a : JMP 0x00467498
0046746c : PUSH 0x6
0046746e : CALL 0x0046ac20
00467473 : AND byte ptr [ESP + 0x11],AL
00467477 : MOV EAX,0xaaaaaaab
0046747c : MUL dword ptr [ESI + 0x68]
0046747f : SHR EDX,0x1
00467481 : ADD dword ptr [EBX + 0x7570],EDX
00467487 : MOV EAX,0xaaaaaaab
0046748c : MUL dword ptr [ESI + 0x68]
0046748f : SHR EDX,0x2
00467492 : ADD dword ptr [EBX + 0x7560],EDX
00467498 : CALL 0x0046ac00
0046749d : AND byte ptr [ESP + 0x11],AL
004674a1 : CALL 0x0046abc0
004674a6 : AND byte ptr [ESP + 0x11],AL
004674aa : ADD dword ptr [EBX + 0x7568],EDI
004674b0 : JMP 0x004674b7
004674b2 : MOV byte ptr [ESP + 0x11],0x0
004674b7 : MOV ECX,dword ptr [ESP + 0x20]
004674bb : MOV EDX,dword ptr [EBP + 0xc]
004674be : MOV EAX,dword ptr [EDX + 0x4]
004674c1 : INC ECX
004674c2 : CMP ECX,dword ptr [EAX + 0x8]
004674c5 : MOV dword ptr [ESP + 0x20],ECX
004674c9 : JL 0x004671e1
004674cf : CMP byte ptr [ESP + 0x13],0x0
004674d4 : JZ 0x004674db
004674d6 : AND byte ptr [ESP + 0x11],0x1
004674db : MOV EAX,[0x01720efc]
004674e0 : MOV EDX,dword ptr [EAX]
004674e2 : PUSH 0x0
004674e4 : PUSH EAX
004674e5 : MOV EAX,dword ptr [EDX + 0x170]
004674eb : CALL EAX
004674ed : MOV EAX,[0x01720efc]
004674f2 : MOV ECX,dword ptr [EAX]
004674f4 : MOV EDX,dword ptr [ECX + 0x1ac]
004674fa : PUSH 0x0
004674fc : PUSH EAX
004674fd : CALL EDX
004674ff : AND byte ptr [ESP + 0x11],0x1
00467504 : MOV AL,byte ptr [ESP + 0x11]
00467508 : POP EDI
00467509 : POP ESI
0046750a : POP EBX
0046750b : MOV ESP,EBP
0046750d : POP EBP
0046750e : RET 0xc
00467511 : POP EDI
00467512 : MOV byte ptr [ESP + 0xd],0x0
00467517 : MOV AL,byte ptr [ESP + 0xd]
0046751b : POP ESI
0046751c : POP EBX
0046751d : MOV ESP,EBP
0046751f : POP EBP
00467520 : RET 0xc
