PROGRAM  : Maestia.exe
FUNCTION : FUN_00acbe80
ENTRY    : 00acbe80
BODY     : [[00acbe80, 00acbfe9]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00acbe80(void)

{
  int iVar1;
  wchar_t *_Src;
  byte bVar2;
  int unaff_ESI;
  uint8_t *packet;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  puStack_c = &LAB_00b40954;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  iVar1 = *(int *)ThreadLocalStoragePointer;
  bVar2 = (byte)((ulonglong)(*(byte *)(iVar1 + 0x18) + 1) % 3);
  *(byte *)(iVar1 + 0x18) = bVar2;
  packet = (uint8_t *)((uint)bVar2 * 0x2000 + 0x122cb8 + iVar1);
  if (packet == (uint8_t *)0x0) {
    packet = (uint8_t *)0x0;
  }
  else {
    packet[0] = '\0';
    packet[1] = '\0';
    packet[2] = 0x8f;
    packet[3] = '\x02';
    packet[0x21] = '\0';
    packet[0x22] = '\0';
    packet[0x23] = '\0';
    packet[0x24] = '\0';
    packet[0x33] = '\0';
    packet[0x38] = '\0';
    packet[0x39] = '\0';
    packet[0x3a] = '\0';
    packet[0x3b] = '\0';
    packet[0x34] = '\0';
    packet[0x35] = '\0';
    packet[0x36] = '\0';
    packet[0x37] = '\0';
    packet[0x25] = '\0';
    packet[0x26] = '\0';
    packet[0x27] = '\0';
    packet[0x28] = '\0';
    packet[0x29] = '\0';
    packet[0x2a] = '\0';
    packet[0x2b] = '\0';
    packet[0x2c] = '\0';
    packet[0x2d] = '\0';
    packet[0x2e] = '\0';
    packet[0x2f] = '\0';
    packet[0x30] = '\0';
    packet[0x31] = '\0';
    packet[0x32] = '\0';
  }
  local_8 = 0xffffffff;
  *(undefined2 *)(packet + 4) = *(undefined2 *)(unaff_ESI + 0x38);
  packet[6] = *(uint8_t *)(unaff_ESI + 0x3a);
  *(undefined2 *)(packet + 7) = *(undefined2 *)(unaff_ESI + 0x3c);
  *(undefined2 *)(packet + 9) = *(undefined2 *)(unaff_ESI + 0x3e);
  *(int *)(packet + 0x10) = *(int *)(unaff_ESI + 0x44) * 60000;
  *(undefined2 *)(packet + 0x18) = *(undefined2 *)(unaff_ESI + 0x50);
  *(undefined2 *)(packet + 0x1a) = *(undefined2 *)(unaff_ESI + 0x52);
  *(undefined2 *)(packet + 0x1c) = *(undefined2 *)(unaff_ESI + 0x54);
  *(int *)(packet + 0xc) = *(int *)(unaff_ESI + 0x48) * 60000;
  *(undefined4 *)(packet + 0x14) = *(undefined4 *)(unaff_ESI + 0x4c);
  packet[0xb] = *(uint8_t *)(unaff_ESI + 0x40);
  *(undefined2 *)(packet + 0x1e) = *(undefined2 *)(unaff_ESI + 0x84);
  packet[0x20] = *(uint8_t *)(unaff_ESI + 0x7c);
  *(uint *)(packet + 0x21) = (uint)(*(int *)(unaff_ESI + 0x9c) != 0);
  if (*(uint *)(unaff_ESI + 0x9c) < 7) {
    if (*(uint *)(unaff_ESI + 0xa0) < 8) {
      _Src = (wchar_t *)(unaff_ESI + 0x8c);
    }
    else {
      _Src = *(wchar_t **)(unaff_ESI + 0x8c);
    }
    _wcscpy_s((wchar_t *)(packet + 0x25),7,_Src);
  }
  packet[0x33] = *(uint8_t *)(unaff_ESI + 0xb4);
  if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
    FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),0x3c,packet);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00acbe80 : PUSH EBP
00acbe81 : MOV EBP,ESP
00acbe83 : PUSH -0x1
00acbe85 : PUSH 0xb40954
00acbe8a : MOV EAX,FS:[0x0]
00acbe90 : PUSH EAX
00acbe91 : SUB ESP,0x8
00acbe94 : PUSH EBX
00acbe95 : PUSH EDI
00acbe96 : MOV EAX,[0x00d66fa0]
00acbe9b : XOR EAX,EBP
00acbe9d : PUSH EAX
00acbe9e : LEA EAX,[EBP + -0xc]
00acbea1 : MOV FS:[0x0],EAX
00acbea7 : MOV EAX,FS:[0x2c]
00acbead : MOV ECX,dword ptr [EAX]
00acbeaf : MOVZX EAX,byte ptr [ECX + 0x18]
00acbeb3 : INC EAX
00acbeb4 : CDQ
00acbeb5 : MOV EDI,0x3
00acbeba : IDIV EDI
00acbebc : MOV byte ptr [ECX + 0x18],DL
00acbebf : MOVZX EDX,DL
00acbec2 : SHL EDX,0xd
00acbec5 : LEA EDI,[EDX + ECX*0x1 + 0x122cb8]
00acbecc : MOV dword ptr [EBP + -0x10],EDI
00acbecf : XOR EBX,EBX
00acbed1 : MOV dword ptr [EBP + -0x4],EBX
00acbed4 : CMP EDI,EBX
00acbed6 : JZ 0x00acbf03
00acbed8 : XOR EAX,EAX
00acbeda : MOV word ptr [EDI],AX
00acbedd : MOV byte ptr [EDI + 0x2],0x8f
00acbee1 : MOV byte ptr [EDI + 0x3],0x2
00acbee5 : MOV dword ptr [EDI + 0x21],EBX
00acbee8 : MOV byte ptr [EDI + 0x33],BL
00acbeeb : MOV dword ptr [EDI + 0x38],EBX
00acbeee : MOV dword ptr [EDI + 0x34],EBX
00acbef1 : PXOR XMM0,XMM0
00acbef5 : MOVQ qword ptr [EDI + 0x25],XMM0
00acbefa : MOV dword ptr [EDI + 0x2d],EBX
00acbefd : MOV word ptr [EDI + 0x31],BX
00acbf01 : JMP 0x00acbf05
00acbf03 : XOR EDI,EDI
00acbf05 : MOV dword ptr [EBP + -0x4],0xffffffff
00acbf0c : MOVZX ECX,word ptr [ESI + 0x38]
00acbf10 : MOV word ptr [EDI + 0x4],CX
00acbf14 : MOVZX EDX,byte ptr [ESI + 0x3a]
00acbf18 : MOV byte ptr [EDI + 0x6],DL
00acbf1b : MOVZX EAX,word ptr [ESI + 0x3c]
00acbf1f : MOV word ptr [EDI + 0x7],AX
00acbf23 : MOVZX ECX,word ptr [ESI + 0x3e]
00acbf27 : MOV word ptr [EDI + 0x9],CX
00acbf2b : MOV EDX,dword ptr [ESI + 0x44]
00acbf2e : IMUL EDX,EDX,0xea60
00acbf34 : MOV dword ptr [EDI + 0x10],EDX
00acbf37 : MOVZX EAX,word ptr [ESI + 0x50]
00acbf3b : MOV word ptr [EDI + 0x18],AX
00acbf3f : MOVZX ECX,word ptr [ESI + 0x52]
00acbf43 : MOV word ptr [EDI + 0x1a],CX
00acbf47 : MOV DX,word ptr [ESI + 0x54]
00acbf4b : MOV word ptr [EDI + 0x1c],DX
00acbf4f : MOV EAX,dword ptr [ESI + 0x48]
00acbf52 : IMUL EAX,EAX,0xea60
00acbf58 : MOV dword ptr [EDI + 0xc],EAX
00acbf5b : MOV ECX,dword ptr [ESI + 0x4c]
00acbf5e : MOV dword ptr [EDI + 0x14],ECX
00acbf61 : MOVZX EDX,byte ptr [ESI + 0x40]
00acbf65 : MOV byte ptr [EDI + 0xb],DL
00acbf68 : MOVZX EAX,word ptr [ESI + 0x84]
00acbf6f : MOV word ptr [EDI + 0x1e],AX
00acbf73 : MOV CL,byte ptr [ESI + 0x7c]
00acbf76 : XOR EDX,EDX
00acbf78 : MOV byte ptr [EDI + 0x20],CL
00acbf7b : CMP dword ptr [ESI + 0x9c],EBX
00acbf81 : SETNZ DL
00acbf84 : MOV dword ptr [EDI + 0x21],EDX
00acbf87 : CMP dword ptr [ESI + 0x9c],0x7
00acbf8e : JNC 0x00acbfb6
00acbf90 : CMP dword ptr [ESI + 0xa0],0x8
00acbf97 : JC 0x00acbfa1
00acbf99 : MOV EAX,dword ptr [ESI + 0x8c]
00acbf9f : JMP 0x00acbfa7
00acbfa1 : LEA EAX,[ESI + 0x8c]
00acbfa7 : PUSH EAX
00acbfa8 : LEA EAX,[EDI + 0x25]
00acbfab : PUSH 0x7
00acbfad : PUSH EAX
00acbfae : CALL 0x0063481b
00acbfb3 : ADD ESP,0xc
00acbfb6 : MOV CL,byte ptr [ESI + 0xb4]
00acbfbc : MOV byte ptr [EDI + 0x33],CL
00acbfbf : MOV ECX,dword ptr [0x017247d4]
00acbfc5 : MOV EAX,dword ptr [ECX + 0x4]
00acbfc8 : CMP EAX,EBX
00acbfca : JZ 0x00acbfd9
00acbfcc : CMP byte ptr [ECX + 0x8],BL
00acbfcf : JZ 0x00acbfd9
00acbfd1 : PUSH 0x3c
00acbfd3 : PUSH EAX
00acbfd4 : CALL 0x00a0dd40
00acbfd9 : MOV ECX,dword ptr [EBP + -0xc]
00acbfdc : MOV dword ptr FS:[0x0],ECX
00acbfe3 : POP ECX
00acbfe4 : POP EDI
00acbfe5 : POP EBX
00acbfe6 : MOV ESP,EBP
00acbfe8 : POP EBP
00acbfe9 : RET
