PROGRAM  : Maestia.exe
FUNCTION : FUN_005221a0
ENTRY    : 005221a0
BODY     : [[005221a0, 00522298] [005222a0, 0052233b]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005221a0(undefined4 param_1,uint param_2)

{
  undefined4 *puVar1;
  undefined4 *puVar2;
  int iVar3;
  int *in_ECX;
  uint uVar4;
  int iVar5;
  int iVar6;
  float10 fVar7;
  undefined8 local_c;
  int *local_4;
  
  iVar5 = 0;
  if (param_2 == 0) {
    FUN_00521f10();
    return;
  }
  local_4 = in_ECX;
  if (param_2 < 8) {
    iVar6 = 8;
  }
  else {
    fVar7 = (float10)FUN_0063b270();
    local_c = (longlong)ROUND((float)fVar7 / 0.6931472 + 1.0);
    iVar6 = 1 << ((byte)local_c & 0x1f);
  }
  local_c._0_4_ = 0x143;
  puVar2 = (undefined4 *)FUN_00515d60(param_1,iVar6 * 0x24 + 8,&local_c);
  *puVar2 = 0;
  puVar2[1] = iVar6 + -1;
  if (iVar6 != 0) {
    iVar3 = 0;
    do {
      *(undefined4 *)(iVar3 + 8 + (int)puVar2) = 0xfffffffe;
      iVar3 = iVar3 + 0x24;
      iVar6 = iVar6 + -1;
    } while (iVar6 != 0);
  }
  if (*in_ECX != 0) {
    local_c._0_4_ = *(int *)(*in_ECX + 4) + 1;
    do {
      puVar1 = (undefined4 *)(*in_ECX + 8 + iVar5);
      if (*(int *)(*in_ECX + 8 + iVar5) != -2) {
        uVar4 = puVar1[3];
        if ((puVar1[2] & 0x20000) != 0) {
          uVar4 = uVar4 ^ (int)*(short *)(puVar1 + 4);
        }
        FUN_00522070(param_1,puVar1 + 2,uVar4);
        for (iVar6 = puVar1[7]; iVar6 != 0; iVar6 = iVar6 + -1) {
          FUN_00526bc0();
          in_ECX = local_4;
        }
        FUN_00515cf0(puVar1[6]);
        *puVar1 = 0xfffffffe;
      }
      iVar5 = iVar5 + 0x24;
      local_c._0_4_ = (int)local_c + -1;
    } while ((int)local_c != 0);
    FUN_00515cf0(*in_ECX);
  }
  *in_ECX = (int)puVar2;
  FUN_00521f10();
  return;
}



============================================================
DISASSEMBLY
============================================================
005221a0 : SUB ESP,0xc
005221a3 : MOV EAX,dword ptr [ESP + 0x14]
005221a7 : PUSH EBX
005221a8 : PUSH EBP
005221a9 : XOR EBP,EBP
005221ab : MOV EBX,ECX
005221ad : MOV dword ptr [ESP + 0x10],EBX
005221b1 : CMP EAX,EBP
005221b3 : JNZ 0x005221c2
005221b5 : CALL 0x00521f10
005221ba : POP EBP
005221bb : POP EBX
005221bc : ADD ESP,0xc
005221bf : RET 0x8
005221c2 : PUSH ESI
005221c3 : CMP EAX,0x8
005221c6 : JNC 0x005221cf
005221c8 : MOV ESI,0x8
005221cd : JMP 0x00522234
005221cf : DEC EAX
005221d0 : MOV dword ptr [ESP + 0x20],EAX
005221d4 : FILD dword ptr [ESP + 0x20]
005221d8 : TEST EAX,EAX
005221da : JGE 0x005221e2
005221dc : FADD float ptr [0x00cdf0e0]
005221e2 : CALL 0x0063b270
005221e7 : FSTP float ptr [ESP + 0x20]
005221eb : FLD float ptr [ESP + 0x20]
005221ef : MOV ESI,0x1
005221f4 : FDIV double ptr [0x00b85fe0]
005221fa : FSTP float ptr [ESP + 0x20]
005221fe : FLD float ptr [ESP + 0x20]
00522202 : FADD double ptr [0x00cdf108]
00522208 : FSTP float ptr [ESP + 0x20]
0052220c : FLD float ptr [ESP + 0x20]
00522210 : FNSTCW word ptr [ESP + 0x20]
00522214 : MOVZX EAX,word ptr [ESP + 0x20]
00522219 : OR EAX,0xc00
0052221e : MOV dword ptr [ESP + 0xc],EAX
00522222 : FLDCW word ptr [ESP + 0xc]
00522226 : FISTP qword ptr [ESP + 0xc]
0052222a : MOV CL,byte ptr [ESP + 0xc]
0052222e : SHL ESI,CL
00522230 : FLDCW word ptr [ESP + 0x20]
00522234 : LEA EAX,[ESP + 0xc]
00522238 : PUSH EAX
00522239 : MOV EAX,dword ptr [ESP + 0x20]
0052223d : LEA ECX,[ESI + ESI*0x8]
00522240 : LEA EDX,[ECX*0x4 + 0x8]
00522247 : PUSH EDX
00522248 : PUSH EAX
00522249 : MOV dword ptr [ESP + 0x2c],EBP
0052224d : MOV dword ptr [ESP + 0x18],0x143
00522255 : CALL 0x00515d60
0052225a : MOV dword ptr [ESP + 0x20],EAX
0052225e : MOV dword ptr [EAX],EBP
00522260 : MOV EDX,dword ptr [ESP + 0x20]
00522264 : LEA ECX,[ESI + -0x1]
00522267 : MOV dword ptr [EDX + 0x4],ECX
0052226a : CMP ESI,EBP
0052226c : JBE 0x00522284
0052226e : XOR EAX,EAX
00522270 : MOV ECX,dword ptr [ESP + 0x20]
00522274 : MOV dword ptr [EAX + ECX*0x1 + 0x8],0xfffffffe
0052227c : ADD EAX,0x24
0052227f : SUB ESI,0x1
00522282 : JNZ 0x00522270
00522284 : MOV EAX,dword ptr [EBX]
00522286 : CMP EAX,EBP
00522288 : JZ 0x0052231c
0052228e : MOV EAX,dword ptr [EAX + 0x4]
00522291 : INC EAX
00522292 : MOV dword ptr [ESP + 0xc],EAX
00522296 : PUSH EDI
00522297 : JMP 0x005222a0
005222a0 : MOV EDX,dword ptr [EBX]
005222a2 : CMP dword ptr [EDX + EBP*0x1 + 0x8],-0x2
005222a7 : LEA ESI,[EDX + EBP*0x1 + 0x8]
005222ab : JZ 0x00522309
005222ad : TEST dword ptr [ESI + 0x8],0x20000
005222b4 : MOV ECX,dword ptr [ESI + 0xc]
005222b7 : LEA EAX,[ESI + 0x8]
005222ba : JZ 0x005222c2
005222bc : MOVSX EDX,word ptr [EAX + 0x8]
005222c0 : XOR ECX,EDX
005222c2 : PUSH ECX
005222c3 : PUSH EAX
005222c4 : MOV EAX,dword ptr [ESP + 0x28]
005222c8 : PUSH EAX
005222c9 : LEA ECX,[ESP + 0x30]
005222cd : CALL 0x00522070
005222d2 : MOV EAX,dword ptr [ESI + 0x1c]
005222d5 : MOV EDX,dword ptr [ESI + 0x18]
005222d8 : MOV ECX,EAX
005222da : SHL ECX,0x4
005222dd : LEA EDI,[ECX + EDX*0x1 + -0x10]
005222e1 : TEST EAX,EAX
005222e3 : JBE 0x005222fa
005222e5 : MOV EBX,EAX
005222e7 : MOV ECX,EDI
005222e9 : CALL 0x00526bc0
005222ee : SUB EDI,0x10
005222f1 : SUB EBX,0x1
005222f4 : JNZ 0x005222e7
005222f6 : MOV EBX,dword ptr [ESP + 0x18]
005222fa : MOV EAX,dword ptr [ESI + 0x18]
005222fd : PUSH EAX
005222fe : CALL 0x00515cf0
00522303 : MOV dword ptr [ESI],0xfffffffe
00522309 : ADD EBP,0x24
0052230c : SUB dword ptr [ESP + 0x10],0x1
00522311 : JNZ 0x005222a0
00522313 : MOV ECX,dword ptr [EBX]
00522315 : PUSH ECX
00522316 : CALL 0x00515cf0
0052231b : POP EDI
0052231c : MOV EDX,dword ptr [ESP + 0x20]
00522320 : LEA ECX,[ESP + 0x20]
00522324 : MOV dword ptr [EBX],EDX
00522326 : MOV dword ptr [ESP + 0x20],0x0
0052232e : CALL 0x00521f10
00522333 : POP ESI
00522334 : POP EBP
00522335 : POP EBX
00522336 : ADD ESP,0xc
00522339 : RET 0x8
