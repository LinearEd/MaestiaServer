PROGRAM  : Maestia.exe
FUNCTION : FUN_00a37010
ENTRY    : 00a37010
BODY     : [[00a37010, 00a3735d]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a37010(int param_1,int param_2,undefined4 param_3,int param_4)

{
  char cVar1;
  uint uVar2;
  int iVar3;
  int *piVar4;
  DWORD DVar5;
  int *piVar6;
  WCHAR *pWVar7;
  LPCRITICAL_SECTION lpCriticalSection;
  undefined1 local_158 [4];
  undefined2 local_154;
  undefined4 local_144;
  uint local_140;
  int local_13c;
  LPCRITICAL_SECTION local_138;
  int *local_134 [2];
  undefined2 local_12c;
  undefined4 local_11c;
  uint local_118;
  WCHAR local_114 [128];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  uint local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b62835;
  local_10 = ExceptionList;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if (param_1 == 0) {
    local_13c = 0;
  }
  else {
    local_13c = param_1 + 0x18;
  }
  lpCriticalSection = (LPCRITICAL_SECTION)(local_13c + 4);
  local_138 = lpCriticalSection;
  local_14 = uVar2;
  EnterCriticalSection(lpCriticalSection);
  local_8 = 0;
  iVar3 = FUN_00a1a840(param_2);
  if (iVar3 == 0) {
    iVar3 = FUN_00a1a6d0(param_2);
    if (iVar3 == 0) {
      iVar3 = FUN_00a1a780(param_2);
      if (iVar3 == 0) {
        FUN_00406460(L"Invalid Owner key");
        local_8._0_1_ = 1;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                    (L"AvaGameZone::ReceiveSummonPetDisappear",0x2bec,local_158);
        }
        local_8 = (uint)local_8._1_3_ << 8;
        if (7 < local_140) {
                    /* WARNING: Subroutine does not return */
          FUN_006f04e0();
        }
        local_140 = 7;
        local_144 = 0;
        local_154 = 0;
        goto LAB_00a3733a;
      }
    }
  }
  piVar4 = (int *)FUN_00a1a780(param_3);
  if (piVar4 == (int *)0x0) {
    FUN_008018d0(L"[ERROR] Invalid Summonpet charkey",uVar2);
  }
  else {
    if ((char)piVar4[0x5c9] == '\0') {
      if (piVar4[1] != -1) {
        if (DAT_00da93ec != 0) {
          FUN_00a379a0(piVar4[0x5b4],0x105,piVar4[1]);
        }
        if (piVar4[0x5cd] != 0) {
          cVar1 = (**(code **)(*piVar4 + 0x214))();
          if (cVar1 != '\0') {
            GetTickCount();
            piVar4[0x5ca] = 0xfb;
            (**(code **)(*(int *)(*(int *)(piVar4[0x4e] + 4) + 0x138 + (int)piVar4) + 0x10))
                      (piVar4 + 0x4c6,1,1,0);
          }
        }
      }
    }
    else {
      DVar5 = GetTickCount();
      piVar4[0x5cb] = DVar5;
    }
    *(undefined1 *)((int)piVar4 + 0x38a) = 3;
    pWVar7 = local_114;
    for (iVar3 = 0x40; iVar3 != 0; iVar3 = iVar3 + -1) {
      pWVar7[0] = L'\0';
      pWVar7[1] = L'\0';
      pWVar7 = pWVar7 + 2;
    }
    if ((uint)piVar4[9] < 8) {
      piVar6 = piVar4 + 4;
    }
    else {
      piVar6 = (int *)piVar4[4];
    }
    wsprintfW(local_114,L"%s_%u_%d",piVar6,piVar4[1],DAT_00d72a98);
    FUN_00406460(local_114);
    local_8 = CONCAT31(local_8._1_3_,2);
    DAT_00d72a98 = DAT_00d72a98 + 1;
    FUN_00a27080(param_1,3,piVar4[0xfa] + 0x68);
    FUN_004437f0(&param_3);
    if (local_134[0] != *(int **)(param_1 + 0xe4)) {
      FUN_0042b2c0(param_1 + 0xe0,local_134,local_134[0]);
    }
    piVar4[0x5c8] = param_4;
    (**(code **)(*piVar4 + 0x2cc))();
    local_134[0] = piVar4;
    FUN_00443d70(local_134);
    FUN_00a1b300(piVar4[0x5b4]);
    iVar3 = *DAT_00da9894;
    if ((((iVar3 != 0) && (*(int *)(iVar3 + 0x290) != 0)) && (*(int *)(param_1 + 0xac) != 0)) &&
       (*(int *)(*(int *)(param_1 + 0xac) + 4) == param_2)) {
      FUN_00945c90(*(undefined4 *)(iVar3 + 0x290),param_3);
    }
    local_8 = local_8 & 0xffffff00;
    if (7 < local_118) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_118 = 7;
    local_11c = 0;
    local_12c = 0;
    lpCriticalSection = local_138;
  }
LAB_00a3733a:
  local_8 = 0xffffffff;
  LeaveCriticalSection(lpCriticalSection);
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00a37010 : PUSH EBP
00a37011 : MOV EBP,ESP
00a37013 : PUSH -0x1
00a37015 : PUSH 0xb62835
00a3701a : MOV EAX,FS:[0x0]
00a37020 : PUSH EAX
00a37021 : SUB ESP,0x14c
00a37027 : MOV EAX,[0x00d66fa0]
00a3702c : XOR EAX,EBP
00a3702e : MOV dword ptr [EBP + -0x10],EAX
00a37031 : PUSH EBX
00a37032 : PUSH ESI
00a37033 : PUSH EDI
00a37034 : PUSH EAX
00a37035 : LEA EAX,[EBP + -0xc]
00a37038 : MOV FS:[0x0],EAX
00a3703e : MOV EBX,dword ptr [EBP + 0x8]
00a37041 : TEST EBX,EBX
00a37043 : JZ 0x00a3704a
00a37045 : LEA EAX,[EBX + 0x18]
00a37048 : JMP 0x00a3704c
00a3704a : XOR EAX,EAX
00a3704c : LEA EDI,[EAX + 0x4]
00a3704f : PUSH EDI
00a37050 : MOV dword ptr [EBP + 0xfffffec8],EAX
00a37056 : MOV dword ptr [EBP + 0xfffffecc],EDI
00a3705c : CALL dword ptr [0x00b85118]
00a37062 : MOV dword ptr [EBP + -0x4],0x0
00a37069 : MOV ESI,dword ptr [EBP + 0xc]
00a3706c : PUSH ESI
00a3706d : MOV ECX,EBX
00a3706f : CALL 0x00a1a840
00a37074 : TEST EAX,EAX
00a37076 : JNZ 0x00a37111
00a3707c : PUSH ESI
00a3707d : MOV ECX,EBX
00a3707f : CALL 0x00a1a6d0
00a37084 : TEST EAX,EAX
00a37086 : JNZ 0x00a37111
00a3708c : PUSH ESI
00a3708d : MOV ECX,EBX
00a3708f : CALL 0x00a1a780
00a37094 : TEST EAX,EAX
00a37096 : JNZ 0x00a37111
00a37098 : PUSH 0xcc2e8c
00a3709d : LEA ECX,[EBP + 0xfffffeac]
00a370a3 : CALL 0x00406460
00a370a8 : MOV byte ptr [EBP + -0x4],0x1
00a370ac : MOV EAX,[0x00da98e8]
00a370b1 : MOV ECX,dword ptr [EAX]
00a370b3 : TEST ECX,ECX
00a370b5 : JZ 0x00a370cf
00a370b7 : MOV EDX,dword ptr [ECX]
00a370b9 : MOV EDX,dword ptr [EDX + 0x14]
00a370bc : LEA EAX,[EBP + 0xfffffeac]
00a370c2 : PUSH EAX
00a370c3 : PUSH 0x2bec
00a370c8 : PUSH 0xcc3040
00a370cd : CALL EDX
00a370cf : MOV byte ptr [EBP + -0x4],0x0
00a370d3 : CMP dword ptr [EBP + 0xfffffec4],0x8
00a370da : JC 0x00a370e7
00a370dc : MOV ECX,dword ptr [EBP + 0xfffffeb0]
00a370e2 : CALL 0x006f04e0
00a370e7 : XOR EAX,EAX
00a370e9 : MOV dword ptr [EBP + 0xfffffec4],0x7
00a370f3 : MOV dword ptr [EBP + 0xfffffec0],0x0
00a370fd : MOV word ptr [EBP + 0xfffffeb0],AX
00a37104 : MOV dword ptr [EBP + -0x4],0xffffffff
00a3710b : PUSH EDI
00a3710c : JMP 0x00a3733a
00a37111 : MOV ECX,dword ptr [EBP + 0x10]
00a37114 : PUSH ECX
00a37115 : MOV ECX,EBX
00a37117 : CALL 0x00a1a780
00a3711c : MOV ESI,EAX
00a3711e : TEST ESI,ESI
00a37120 : JNZ 0x00a37142
00a37122 : MOV ESI,dword ptr [0x00da98e8]
00a37128 : PUSH 0xcc3090
00a3712d : CALL 0x008018d0
00a37132 : ADD ESP,0x4
00a37135 : MOV dword ptr [EBP + -0x4],0xffffffff
00a3713c : PUSH EDI
00a3713d : JMP 0x00a3733a
00a37142 : MOV AL,byte ptr [ESI + 0x1724]
00a37148 : TEST AL,AL
00a3714a : JZ 0x00a3715a
00a3714c : CALL dword ptr [0x00b850d8]
00a37152 : MOV dword ptr [ESI + 0x172c],EAX
00a37158 : JMP 0x00a371d0
00a3715a : MOV EAX,dword ptr [ESI + 0x4]
00a3715d : CMP EAX,-0x1
00a37160 : JZ 0x00a371d0
00a37162 : MOV ECX,dword ptr [0x00da93ec]
00a37168 : TEST ECX,ECX
00a3716a : JZ 0x00a3717e
00a3716c : MOV EDX,dword ptr [ESI + 0x16d0]
00a37172 : PUSH EAX
00a37173 : PUSH 0x105
00a37178 : PUSH EDX
00a37179 : CALL 0x00a379a0
00a3717e : CMP dword ptr [ESI + 0x1734],0x0
00a37185 : JZ 0x00a371d0
00a37187 : MOV EAX,dword ptr [ESI]
00a37189 : MOV EDX,dword ptr [EAX + 0x214]
00a3718f : MOV ECX,ESI
00a37191 : CALL EDX
00a37193 : TEST AL,AL
00a37195 : JZ 0x00a371d0
00a37197 : CALL dword ptr [0x00b850d8]
00a3719d : MOV EAX,dword ptr [ESI + 0x138]
00a371a3 : MOV dword ptr [ESI + 0x1728],0xfb
00a371ad : MOV ECX,dword ptr [EAX + 0x4]
00a371b0 : MOV EDX,dword ptr [ECX + ESI*0x1 + 0x138]
00a371b7 : MOV EDX,dword ptr [EDX + 0x10]
00a371ba : PUSH 0x0
00a371bc : PUSH 0x1
00a371be : LEA ECX,[ECX + ESI*0x1 + 0x138]
00a371c5 : PUSH 0x1
00a371c7 : LEA EAX,[ESI + 0x1318]
00a371cd : PUSH EAX
00a371ce : CALL EDX
00a371d0 : XOR EAX,EAX
00a371d2 : MOVZX EDX,AX
00a371d5 : MOV EAX,EDX
00a371d7 : SHL EDX,0x10
00a371da : OR EAX,EDX
00a371dc : MOV byte ptr [ESI + 0x38a],0x3
00a371e3 : MOV ECX,0x40
00a371e8 : LEA EDI,[EBP + 0xfffffef0]
00a371ee : STOSD.REP ES:EDI
00a371f0 : CMP dword ptr [ESI + 0x24],0x8
00a371f4 : MOV ECX,dword ptr [ESI + 0x4]
00a371f7 : JC 0x00a371fe
00a371f9 : MOV EAX,dword ptr [ESI + 0x10]
00a371fc : JMP 0x00a37201
00a371fe : LEA EAX,[ESI + 0x10]
00a37201 : MOV EDX,dword ptr [0x00d72a98]
00a37207 : PUSH EDX
00a37208 : PUSH ECX
00a37209 : PUSH EAX
00a3720a : LEA EAX,[EBP + 0xfffffef0]
00a37210 : PUSH 0xcc30d4
00a37215 : PUSH EAX
00a37216 : CALL dword ptr [0x00b85434]
00a3721c : ADD ESP,0x14
00a3721f : LEA ECX,[EBP + 0xfffffef0]
00a37225 : PUSH ECX
00a37226 : LEA ECX,[EBP + 0xfffffed4]
00a3722c : CALL 0x00406460
00a37231 : MOV byte ptr [EBP + -0x4],0x2
00a37235 : MOV EDX,dword ptr [ESI + 0x3e8]
00a3723b : INC dword ptr [0x00d72a98]
00a37241 : ADD EDX,0x68
00a37244 : PUSH EDX
00a37245 : PUSH 0x3
00a37247 : PUSH EBX
00a37248 : LEA ECX,[EBP + 0xfffffed4]
00a3724e : CALL 0x00a27080
00a37253 : LEA EAX,[EBP + 0x10]
00a37256 : LEA EDI,[EBX + 0xe0]
00a3725c : PUSH EAX
00a3725d : LEA EAX,[EBP + 0xfffffed0]
00a37263 : MOV ECX,EDI
00a37265 : CALL 0x004437f0
00a3726a : MOV EAX,dword ptr [EBX + 0xe4]
00a37270 : MOV ECX,dword ptr [EBP + 0xfffffed0]
00a37276 : CMP ECX,EAX
00a37278 : JZ 0x00a37288
00a3727a : PUSH ECX
00a3727b : LEA ECX,[EBP + 0xfffffed0]
00a37281 : PUSH ECX
00a37282 : PUSH EDI
00a37283 : CALL 0x0042b2c0
00a37288 : MOV EDX,dword ptr [EBP + 0x14]
00a3728b : MOV EAX,dword ptr [ESI]
00a3728d : MOV dword ptr [ESI + 0x1720],EDX
00a37293 : MOV EDX,dword ptr [EAX + 0x2cc]
00a37299 : MOV ECX,ESI
00a3729b : CALL EDX
00a3729d : LEA EAX,[EBP + 0xfffffed0]
00a372a3 : PUSH EAX
00a372a4 : LEA EAX,[EBX + 0x34]
00a372a7 : MOV dword ptr [EBP + 0xfffffed0],ESI
00a372ad : CALL 0x00443d70
00a372b2 : MOV ESI,dword ptr [ESI + 0x16d0]
00a372b8 : PUSH ESI
00a372b9 : MOV EAX,EBX
00a372bb : CALL 0x00a1b300
00a372c0 : MOV ECX,dword ptr [0x00da9894]
00a372c6 : MOV EAX,dword ptr [ECX]
00a372c8 : TEST EAX,EAX
00a372ca : JZ 0x00a372f7
00a372cc : CMP dword ptr [EAX + 0x290],0x0
00a372d3 : JZ 0x00a372f7
00a372d5 : MOV EBX,dword ptr [EBX + 0xac]
00a372db : TEST EBX,EBX
00a372dd : JZ 0x00a372f7
00a372df : MOV EDX,dword ptr [EBP + 0xc]
00a372e2 : CMP dword ptr [EBX + 0x4],EDX
00a372e5 : JNZ 0x00a372f7
00a372e7 : MOV ECX,dword ptr [EBP + 0x10]
00a372ea : MOV EAX,dword ptr [EAX + 0x290]
00a372f0 : PUSH ECX
00a372f1 : PUSH EAX
00a372f2 : CALL 0x00945c90
00a372f7 : MOV byte ptr [EBP + -0x4],0x0
00a372fb : CMP dword ptr [EBP + 0xfffffeec],0x8
00a37302 : JC 0x00a3730f
00a37304 : MOV ECX,dword ptr [EBP + 0xfffffed8]
00a3730a : CALL 0x006f04e0
00a3730f : XOR EDX,EDX
00a37311 : MOV dword ptr [EBP + 0xfffffeec],0x7
00a3731b : MOV dword ptr [EBP + 0xfffffee8],0x0
00a37325 : MOV word ptr [EBP + 0xfffffed8],DX
00a3732c : MOV dword ptr [EBP + -0x4],0xffffffff
00a37333 : MOV EAX,dword ptr [EBP + 0xfffffecc]
00a37339 : PUSH EAX
00a3733a : CALL dword ptr [0x00b8511c]
00a37340 : MOV ECX,dword ptr [EBP + -0xc]
00a37343 : MOV dword ptr FS:[0x0],ECX
00a3734a : POP ECX
00a3734b : POP EDI
00a3734c : POP ESI
00a3734d : POP EBX
00a3734e : MOV ECX,dword ptr [EBP + -0x10]
00a37351 : XOR ECX,EBP
00a37353 : CALL 0x00633e6b
00a37358 : MOV ESP,EBP
00a3735a : POP EBP
00a3735b : RET 0x10
