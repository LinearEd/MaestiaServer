PROGRAM  : Maestia.exe
FUNCTION : FUN_005f3370
ENTRY    : 005f3370
BODY     : [[005f3370, 005f34e3]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005f3370(undefined4 param_1,uint param_2)

{
  undefined4 *puVar1;
  uint uVar2;
  undefined4 *puVar3;
  int iVar4;
  int *in_ECX;
  int iVar5;
  int iVar6;
  float10 fVar7;
  longlong local_c;
  int *local_4;
  
  iVar6 = 0;
  if (param_2 == 0) {
    FUN_005f1b00();
    return;
  }
  local_4 = in_ECX;
  if (param_2 < 8) {
    iVar5 = 8;
  }
  else {
    fVar7 = (float10)FUN_0063b270();
    local_c = (longlong)ROUND((float)fVar7 / 0.6931472 + 1.0);
    iVar5 = 1 << ((byte)local_c & 0x1f);
  }
  local_c = CONCAT44(local_c._4_4_,0xc3);
  puVar3 = (undefined4 *)FUN_00515d60(param_1,iVar5 * 0x18 + 8,&local_c);
  *puVar3 = 0;
  puVar3[1] = iVar5 + -1;
  if (iVar5 != 0) {
    iVar4 = 0;
    do {
      *(undefined4 *)(iVar4 + 8 + (int)puVar3) = 0xfffffffe;
      iVar4 = iVar4 + 0x18;
      iVar5 = iVar5 + -1;
    } while (iVar5 != 0);
  }
  if (*in_ECX != 0) {
    iVar5 = *(int *)(*in_ECX + 4) + 1;
    do {
      puVar1 = (undefined4 *)(iVar6 + 8 + *in_ECX);
      if (*(int *)(iVar6 + 8 + *in_ECX) != -2) {
        uVar2 = puVar1[2];
        FUN_005f3cf0(param_1,puVar1 + 2,
                     (uint)*(byte *)((int)puVar1 + 0x11) * 2 ^ (uint)*(byte *)((int)puVar1 + 0x13) ^
                     (uint)*(byte *)((int)puVar1 + 0x12) ^ (uint)*(byte *)(puVar1 + 4) ^
                     (uint)*(byte *)((int)puVar1 + 0xf) ^ (uint)*(byte *)((int)puVar1 + 0xe) ^
                     (uint)*(ushort *)(puVar1 + 3) ^ uVar2 >> 6 ^ uVar2);
        *puVar1 = 0xfffffffe;
        in_ECX = local_4;
      }
      iVar6 = iVar6 + 0x18;
      iVar5 = iVar5 + -1;
    } while (iVar5 != 0);
    FUN_00515cf0(*in_ECX);
  }
  *in_ECX = (int)puVar3;
  return;
}



============================================================
DISASSEMBLY
============================================================
005f3370 : SUB ESP,0xc
005f3373 : MOV EAX,dword ptr [ESP + 0x14]
005f3377 : PUSH EBP
005f3378 : PUSH EDI
005f3379 : XOR EDI,EDI
005f337b : MOV EBP,ECX
005f337d : MOV dword ptr [ESP + 0x10],EBP
005f3381 : CMP EAX,EDI
005f3383 : JNZ 0x005f3392
005f3385 : CALL 0x005f1b00
005f338a : POP EDI
005f338b : POP EBP
005f338c : ADD ESP,0xc
005f338f : RET 0x8
005f3392 : PUSH ESI
005f3393 : CMP EAX,0x8
005f3396 : JNC 0x005f339f
005f3398 : MOV ESI,0x8
005f339d : JMP 0x005f3404
005f339f : DEC EAX
005f33a0 : MOV dword ptr [ESP + 0x20],EAX
005f33a4 : FILD dword ptr [ESP + 0x20]
005f33a8 : TEST EAX,EAX
005f33aa : JGE 0x005f33b2
005f33ac : FADD float ptr [0x00cdf0e0]
005f33b2 : CALL 0x0063b270
005f33b7 : FSTP float ptr [ESP + 0x20]
005f33bb : FLD float ptr [ESP + 0x20]
005f33bf : MOV ESI,0x1
005f33c4 : FDIV double ptr [0x00b85fe0]
005f33ca : FSTP float ptr [ESP + 0x20]
005f33ce : FLD float ptr [ESP + 0x20]
005f33d2 : FADD double ptr [0x00cdf108]
005f33d8 : FSTP float ptr [ESP + 0x20]
005f33dc : FLD float ptr [ESP + 0x20]
005f33e0 : FNSTCW word ptr [ESP + 0x20]
005f33e4 : MOVZX EAX,word ptr [ESP + 0x20]
005f33e9 : OR EAX,0xc00
005f33ee : MOV dword ptr [ESP + 0xc],EAX
005f33f2 : FLDCW word ptr [ESP + 0xc]
005f33f6 : FISTP qword ptr [ESP + 0xc]
005f33fa : MOV CL,byte ptr [ESP + 0xc]
005f33fe : SHL ESI,CL
005f3400 : FLDCW word ptr [ESP + 0x20]
005f3404 : LEA EAX,[ESP + 0xc]
005f3408 : PUSH EAX
005f3409 : MOV EAX,dword ptr [ESP + 0x20]
005f340d : LEA ECX,[ESI + ESI*0x2]
005f3410 : LEA EDX,[ECX*0x8 + 0x8]
005f3417 : PUSH EDX
005f3418 : PUSH EAX
005f3419 : MOV dword ptr [ESP + 0x2c],EDI
005f341d : MOV dword ptr [ESP + 0x18],0xc3
005f3425 : CALL 0x00515d60
005f342a : MOV dword ptr [ESP + 0x20],EAX
005f342e : MOV dword ptr [EAX],EDI
005f3430 : MOV EDX,dword ptr [ESP + 0x20]
005f3434 : LEA ECX,[ESI + -0x1]
005f3437 : MOV dword ptr [EDX + 0x4],ECX
005f343a : CMP ESI,EDI
005f343c : JBE 0x005f3454
005f343e : XOR EAX,EAX
005f3440 : MOV ECX,dword ptr [ESP + 0x20]
005f3444 : MOV dword ptr [EAX + ECX*0x1 + 0x8],0xfffffffe
005f344c : ADD EAX,0x18
005f344f : SUB ESI,0x1
005f3452 : JNZ 0x005f3440
005f3454 : MOV EAX,dword ptr [EBP]
005f3457 : CMP EAX,EDI
005f3459 : JZ 0x005f34d4
005f345b : MOV EAX,dword ptr [EAX + 0x4]
005f345e : PUSH EBX
005f345f : LEA EBX,[EAX + 0x1]
005f3462 : MOV EDX,dword ptr [EBP]
005f3465 : CMP dword ptr [EDI + EDX*0x1 + 0x8],-0x2
005f346a : LEA ESI,[EDI + EDX*0x1 + 0x8]
005f346e : JZ 0x005f34c2
005f3470 : MOVZX EDX,byte ptr [ESI + 0x11]
005f3474 : MOVZX EBP,byte ptr [ESI + 0x13]
005f3478 : LEA EAX,[ESI + 0x8]
005f347b : MOV ECX,dword ptr [EAX]
005f347d : ADD EDX,EDX
005f347f : XOR EDX,EBP
005f3481 : MOVZX EBP,byte ptr [EAX + 0xa]
005f3485 : XOR EDX,EBP
005f3487 : MOVZX EBP,byte ptr [EAX + 0x8]
005f348b : XOR EDX,EBP
005f348d : MOVZX EBP,byte ptr [EAX + 0x7]
005f3491 : XOR EDX,EBP
005f3493 : MOVZX EBP,byte ptr [EAX + 0x6]
005f3497 : XOR EDX,EBP
005f3499 : MOVZX EBP,word ptr [EAX + 0x4]
005f349d : XOR EDX,EBP
005f349f : MOV EBP,ECX
005f34a1 : SHR EBP,0x6
005f34a4 : XOR EDX,EBP
005f34a6 : XOR EDX,ECX
005f34a8 : PUSH EDX
005f34a9 : PUSH EAX
005f34aa : MOV EAX,dword ptr [ESP + 0x28]
005f34ae : PUSH EAX
005f34af : LEA ECX,[ESP + 0x30]
005f34b3 : CALL 0x005f3cf0
005f34b8 : MOV EBP,dword ptr [ESP + 0x18]
005f34bc : MOV dword ptr [ESI],0xfffffffe
005f34c2 : ADD EDI,0x18
005f34c5 : SUB EBX,0x1
005f34c8 : JNZ 0x005f3462
005f34ca : MOV ECX,dword ptr [EBP]
005f34cd : PUSH ECX
005f34ce : CALL 0x00515cf0
005f34d3 : POP EBX
005f34d4 : MOV EDX,dword ptr [ESP + 0x20]
005f34d8 : POP ESI
005f34d9 : POP EDI
005f34da : MOV dword ptr [EBP],EDX
005f34dd : POP EBP
005f34de : ADD ESP,0xc
005f34e1 : RET 0x8
