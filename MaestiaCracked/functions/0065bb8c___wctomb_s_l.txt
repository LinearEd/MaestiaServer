PROGRAM  : Maestia.exe
FUNCTION : __wctomb_s_l
ENTRY    : 0065bb8c
BODY     : [[0065bb8c, 0065bcf7]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    __wctomb_s_l
   
   Library: Visual Studio 2008 Release */

errno_t __cdecl
__wctomb_s_l(int *_SizeConverted,char *_MbCh,size_t _SizeInBytes,wchar_t _WCh,_locale_t _Locale)

{
  char *lpMultiByteStr;
  size_t _Size;
  int iVar1;
  int *piVar2;
  DWORD DVar3;
  int local_14 [2];
  int local_c;
  char local_8;
  
  _Size = _SizeInBytes;
  lpMultiByteStr = _MbCh;
  if ((_MbCh == (char *)0x0) && (_SizeInBytes != 0)) {
    if (_SizeConverted != (int *)0x0) {
      *_SizeConverted = 0;
    }
LAB_0065bbb0:
    iVar1 = 0;
  }
  else {
    if (_SizeConverted != (int *)0x0) {
      *_SizeConverted = -1;
    }
    if (0x7fffffff < _SizeInBytes) {
      piVar2 = __errno();
      *piVar2 = 0x16;
      __invalid_parameter(0,0,0,0,0);
      return 0x16;
    }
    _LocaleUpdate::_LocaleUpdate((_LocaleUpdate *)local_14,_Locale);
    if (*(int *)(local_14[0] + 0x14) == 0) {
      if ((ushort)_WCh < 0x100) {
        if (lpMultiByteStr != (char *)0x0) {
          if (_Size == 0) goto LAB_0065bc47;
          *lpMultiByteStr = (char)_WCh;
        }
        if (_SizeConverted != (int *)0x0) {
          *_SizeConverted = 1;
        }
LAB_0065bc82:
        if (local_8 != '\0') {
          *(uint *)(local_c + 0x70) = *(uint *)(local_c + 0x70) & 0xfffffffd;
        }
        goto LAB_0065bbb0;
      }
      if ((lpMultiByteStr != (char *)0x0) && (_Size != 0)) {
        _memset(lpMultiByteStr,0,_Size);
      }
    }
    else {
      _MbCh = (char *)0x0;
      iVar1 = WideCharToMultiByte(*(UINT *)(local_14[0] + 4),0,&_WCh,1,lpMultiByteStr,_Size,
                                  (LPCSTR)0x0,(LPBOOL)&_MbCh);
      if (iVar1 == 0) {
        DVar3 = GetLastError();
        if (DVar3 == 0x7a) {
          if ((lpMultiByteStr != (char *)0x0) && (_Size != 0)) {
            _memset(lpMultiByteStr,0,_Size);
          }
LAB_0065bc47:
          piVar2 = __errno();
          *piVar2 = 0x22;
          __invalid_parameter(0,0,0,0,0);
          if (local_8 == '\0') {
            return 0x22;
          }
          *(uint *)(local_c + 0x70) = *(uint *)(local_c + 0x70) & 0xfffffffd;
          return 0x22;
        }
      }
      else if (_MbCh == (char *)0x0) {
        if (_SizeConverted != (int *)0x0) {
          *_SizeConverted = iVar1;
        }
        goto LAB_0065bc82;
      }
    }
    piVar2 = __errno();
    *piVar2 = 0x2a;
    piVar2 = __errno();
    iVar1 = *piVar2;
    if (local_8 != '\0') {
      *(uint *)(local_c + 0x70) = *(uint *)(local_c + 0x70) & 0xfffffffd;
    }
  }
  return iVar1;
}



============================================================
DISASSEMBLY
============================================================
0065bb8c : MOV EDI,EDI
0065bb8e : PUSH EBP
0065bb8f : MOV EBP,ESP
0065bb91 : SUB ESP,0x10
0065bb94 : PUSH EBX
0065bb95 : PUSH ESI
0065bb96 : MOV ESI,dword ptr [EBP + 0xc]
0065bb99 : XOR EBX,EBX
0065bb9b : PUSH EDI
0065bb9c : MOV EDI,dword ptr [EBP + 0x10]
0065bb9f : CMP ESI,EBX
0065bba1 : JNZ 0x0065bbb7
0065bba3 : CMP EDI,EBX
0065bba5 : JBE 0x0065bbb7
0065bba7 : MOV EAX,dword ptr [EBP + 0x8]
0065bbaa : CMP EAX,EBX
0065bbac : JZ 0x0065bbb0
0065bbae : MOV dword ptr [EAX],EBX
0065bbb0 : XOR EAX,EAX
0065bbb2 : JMP 0x0065bc3a
0065bbb7 : MOV EAX,dword ptr [EBP + 0x8]
0065bbba : CMP EAX,EBX
0065bbbc : JZ 0x0065bbc1
0065bbbe : OR dword ptr [EAX],0xffffffff
0065bbc1 : CMP EDI,0x7fffffff
0065bbc7 : JBE 0x0065bbe4
0065bbc9 : CALL 0x0063ab82
0065bbce : PUSH 0x16
0065bbd0 : POP ESI
0065bbd1 : PUSH EBX
0065bbd2 : PUSH EBX
0065bbd3 : PUSH EBX
0065bbd4 : PUSH EBX
0065bbd5 : PUSH EBX
0065bbd6 : MOV dword ptr [EAX],ESI
0065bbd8 : CALL 0x006372b8
0065bbdd : ADD ESP,0x14
0065bbe0 : MOV EAX,ESI
0065bbe2 : JMP 0x0065bc3a
0065bbe4 : PUSH dword ptr [EBP + 0x18]
0065bbe7 : LEA ECX,[EBP + -0x10]
0065bbea : CALL 0x00637880
0065bbef : MOV EAX,dword ptr [EBP + -0x10]
0065bbf2 : CMP dword ptr [EAX + 0x14],EBX
0065bbf5 : JNZ 0x0065bc97
0065bbfb : MOV AX,word ptr [EBP + 0x14]
0065bbff : MOV ECX,0xff
0065bc04 : CMP AX,CX
0065bc07 : JBE 0x0065bc3f
0065bc09 : CMP ESI,EBX
0065bc0b : JZ 0x0065bc1c
0065bc0d : CMP EDI,EBX
0065bc0f : JBE 0x0065bc1c
0065bc11 : PUSH EDI
0065bc12 : PUSH EBX
0065bc13 : PUSH ESI
0065bc14 : CALL 0x0063b700
0065bc19 : ADD ESP,0xc
0065bc1c : CALL 0x0063ab82
0065bc21 : MOV dword ptr [EAX],0x2a
0065bc27 : CALL 0x0063ab82
0065bc2c : MOV EAX,dword ptr [EAX]
0065bc2e : CMP byte ptr [EBP + -0x4],BL
0065bc31 : JZ 0x0065bc3a
0065bc33 : MOV ECX,dword ptr [EBP + -0x8]
0065bc36 : AND dword ptr [ECX + 0x70],0xfffffffd
0065bc3a : POP EDI
0065bc3b : POP ESI
0065bc3c : POP EBX
0065bc3d : LEAVE
0065bc3e : RET
0065bc3f : CMP ESI,EBX
0065bc41 : JZ 0x0065bc75
0065bc43 : CMP EDI,EBX
0065bc45 : JA 0x0065bc73
0065bc47 : CALL 0x0063ab82
0065bc4c : PUSH 0x22
0065bc4e : POP ESI
0065bc4f : PUSH EBX
0065bc50 : PUSH EBX
0065bc51 : PUSH EBX
0065bc52 : PUSH EBX
0065bc53 : PUSH EBX
0065bc54 : MOV dword ptr [EAX],ESI
0065bc56 : CALL 0x006372b8
0065bc5b : ADD ESP,0x14
0065bc5e : CMP byte ptr [EBP + -0x4],BL
0065bc61 : JZ 0x0065bbe0
0065bc67 : MOV EAX,dword ptr [EBP + -0x8]
0065bc6a : AND dword ptr [EAX + 0x70],0xfffffffd
0065bc6e : JMP 0x0065bbe0
0065bc73 : MOV byte ptr [ESI],AL
0065bc75 : MOV EAX,dword ptr [EBP + 0x8]
0065bc78 : CMP EAX,EBX
0065bc7a : JZ 0x0065bc82
0065bc7c : MOV dword ptr [EAX],0x1
0065bc82 : CMP byte ptr [EBP + -0x4],BL
0065bc85 : JZ 0x0065bbb0
0065bc8b : MOV EAX,dword ptr [EBP + -0x8]
0065bc8e : AND dword ptr [EAX + 0x70],0xfffffffd
0065bc92 : JMP 0x0065bbb0
0065bc97 : LEA ECX,[EBP + 0xc]
0065bc9a : PUSH ECX
0065bc9b : PUSH EBX
0065bc9c : PUSH EDI
0065bc9d : PUSH ESI
0065bc9e : PUSH 0x1
0065bca0 : LEA ECX,[EBP + 0x14]
0065bca3 : PUSH ECX
0065bca4 : PUSH EBX
0065bca5 : MOV dword ptr [EBP + 0xc],EBX
0065bca8 : PUSH dword ptr [EAX + 0x4]
0065bcab : CALL dword ptr [0x00b85130]
0065bcb1 : CMP EAX,EBX
0065bcb3 : JZ 0x0065bcc9
0065bcb5 : CMP dword ptr [EBP + 0xc],EBX
0065bcb8 : JNZ 0x0065bc1c
0065bcbe : MOV ECX,dword ptr [EBP + 0x8]
0065bcc1 : CMP ECX,EBX
0065bcc3 : JZ 0x0065bc82
0065bcc5 : MOV dword ptr [ECX],EAX
0065bcc7 : JMP 0x0065bc82
0065bcc9 : CALL dword ptr [0x00b85128]
0065bccf : CMP EAX,0x7a
0065bcd2 : JNZ 0x0065bc1c
0065bcd8 : CMP ESI,EBX
0065bcda : JZ 0x0065bc47
0065bce0 : CMP EDI,EBX
0065bce2 : JBE 0x0065bc47
0065bce8 : PUSH EDI
0065bce9 : PUSH EBX
0065bcea : PUSH ESI
0065bceb : CALL 0x0063b700
0065bcf0 : ADD ESP,0xc
0065bcf3 : JMP 0x0065bc47
