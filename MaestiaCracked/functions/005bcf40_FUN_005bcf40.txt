PROGRAM  : Maestia.exe
FUNCTION : FUN_005bcf40
ENTRY    : 005bcf40
BODY     : [[005bcf40, 005bd0a3]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005bcf40(int param_1)

{
  undefined1 *puVar1;
  char cVar2;
  char *pcVar3;
  GRefCountNTSImpl *this;
  GRefCountNTSImpl *pGVar4;
  undefined4 uVar5;
  int local_2c;
  char local_28 [16];
  int *local_18;
  char *local_14;
  undefined4 local_10;
  undefined4 local_c;
  undefined4 local_8;
  undefined4 local_4;
  
  puVar1 = *(undefined1 **)(param_1 + 4);
  FUN_00526400();
  *puVar1 = 2;
  puVar1[4] = 0;
  if ((0 < *(int *)(param_1 + 0x1c)) && (*(int *)(param_1 + 0x18) != 0)) {
    this = (GRefCountNTSImpl *)0x0;
    pcVar3 = (char *)FUN_00526260(0);
    if (*pcVar3 == '\x05') {
      uVar5 = *(undefined4 *)(param_1 + 0x18);
      local_28[0] = '\0';
      FUN_00526260(0);
      FUN_005272e0(&local_2c,uVar5,0xffffffff,0);
      local_18 = &local_2c;
      local_14 = local_28;
      local_10 = 0;
      local_c = 0;
      local_8 = 0;
      local_4 = 0;
      cVar2 = FUN_00532cf0(&local_18,0,0);
      *(int *)(local_2c + 8) = *(int *)(local_2c + 8) + -1;
      if (*(int *)(local_2c + 8) == 0) {
        FUN_00525340();
      }
      if (((cVar2 != '\0') && (local_28[0] == '\a')) &&
         (this = (GRefCountNTSImpl *)FUN_00525fa0(*(undefined4 *)(param_1 + 0x18)),
         this != (GRefCountNTSImpl *)0x0)) {
        *(int *)(this + 4) = *(int *)(this + 4) + 1;
      }
      FUN_00526bc0();
    }
    else {
      uVar5 = *(undefined4 *)(param_1 + 0x18);
      FUN_00526260(0);
      this = (GRefCountNTSImpl *)FUN_00525fa0(uVar5);
      if (this != (GRefCountNTSImpl *)0x0) {
        *(int *)(this + 4) = *(int *)(this + 4) + 1;
      }
    }
    if (this == (GRefCountNTSImpl *)0x0) {
      uVar5 = 0;
      FUN_005296a0(0);
      FUN_005709c0(uVar5);
      puVar1 = *(undefined1 **)(param_1 + 4);
      FUN_00526400();
      *puVar1 = 2;
      puVar1[4] = 1;
      return;
    }
    cVar2 = (**(code **)(*(int *)this + 0xbc))();
    if (cVar2 != '\0') {
      pGVar4 = this;
      FUN_005296a0(this);
      FUN_005709c0(pGVar4);
      puVar1 = *(undefined1 **)(param_1 + 4);
      FUN_00526400();
      *puVar1 = 2;
      puVar1[4] = 1;
    }
    GRefCountNTSImpl::Release(this);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005bcf40 : SUB ESP,0x2c
005bcf43 : PUSH EBX
005bcf44 : PUSH ESI
005bcf45 : MOV ESI,dword ptr [ESP + 0x38]
005bcf49 : PUSH EDI
005bcf4a : MOV EDI,dword ptr [ESI + 0x4]
005bcf4d : MOV ECX,EDI
005bcf4f : CALL 0x00526400
005bcf54 : XOR EBX,EBX
005bcf56 : MOV byte ptr [EDI],0x2
005bcf59 : MOV byte ptr [EDI + 0x4],BL
005bcf5c : MOV EDI,0x1
005bcf61 : CMP dword ptr [ESI + 0x1c],EDI
005bcf64 : JL 0x005bd074
005bcf6a : CMP dword ptr [ESI + 0x18],EBX
005bcf6d : JZ 0x005bd074
005bcf73 : PUSH EBP
005bcf74 : PUSH EBX
005bcf75 : MOV ECX,ESI
005bcf77 : XOR EBP,EBP
005bcf79 : CALL 0x00526260
005bcf7e : CMP byte ptr [EAX],0x5
005bcf81 : MOV ECX,ESI
005bcf83 : JNZ 0x005bd01c
005bcf89 : MOV EDI,dword ptr [ESI + 0x18]
005bcf8c : PUSH EBX
005bcf8d : MOV byte ptr [ESP + 0x18],BL
005bcf91 : CALL 0x00526260
005bcf96 : PUSH EBX
005bcf97 : PUSH -0x1
005bcf99 : PUSH EDI
005bcf9a : LEA ECX,[ESP + 0x1c]
005bcf9e : PUSH ECX
005bcf9f : MOV ECX,EAX
005bcfa1 : CALL 0x005272e0
005bcfa6 : PUSH EBX
005bcfa7 : PUSH EBX
005bcfa8 : LEA ECX,[ESP + 0x2c]
005bcfac : LEA EDX,[ESP + 0x18]
005bcfb0 : LEA EAX,[ESP + 0x1c]
005bcfb4 : PUSH ECX
005bcfb5 : MOV ECX,dword ptr [ESI + 0x18]
005bcfb8 : MOV dword ptr [ESP + 0x30],EDX
005bcfbc : MOV dword ptr [ESP + 0x34],EAX
005bcfc0 : MOV dword ptr [ESP + 0x38],EBX
005bcfc4 : MOV dword ptr [ESP + 0x3c],EBX
005bcfc8 : MOV dword ptr [ESP + 0x40],EBX
005bcfcc : MOV dword ptr [ESP + 0x44],EBX
005bcfd0 : CALL 0x00532cf0
005bcfd5 : MOV byte ptr [ESP + 0x40],AL
005bcfd9 : MOV EAX,dword ptr [ESP + 0x10]
005bcfdd : DEC dword ptr [EAX + 0x8]
005bcfe0 : MOV ECX,EAX
005bcfe2 : ADD EAX,0x8
005bcfe5 : CMP dword ptr [EAX],EBX
005bcfe7 : JNZ 0x005bcfee
005bcfe9 : CALL 0x00525340
005bcfee : CMP byte ptr [ESP + 0x40],BL
005bcff2 : JZ 0x005bd011
005bcff4 : CMP byte ptr [ESP + 0x14],0x7
005bcff9 : JNZ 0x005bd011
005bcffb : MOV EDX,dword ptr [ESI + 0x18]
005bcffe : PUSH EDX
005bcfff : LEA ECX,[ESP + 0x18]
005bd003 : CALL 0x00525fa0
005bd008 : CMP EAX,EBX
005bd00a : JZ 0x005bd00f
005bd00c : INC dword ptr [EAX + 0x4]
005bd00f : MOV EBP,EAX
005bd011 : LEA ECX,[ESP + 0x14]
005bd015 : CALL 0x00526bc0
005bd01a : JMP 0x005bd036
005bd01c : MOV EAX,dword ptr [ESI + 0x18]
005bd01f : PUSH EAX
005bd020 : PUSH EBX
005bd021 : CALL 0x00526260
005bd026 : MOV ECX,EAX
005bd028 : CALL 0x00525fa0
005bd02d : CMP EAX,EBX
005bd02f : JZ 0x005bd034
005bd031 : ADD dword ptr [EAX + 0x4],EDI
005bd034 : MOV EBP,EAX
005bd036 : CMP EBP,EBX
005bd038 : JZ 0x005bd07b
005bd03a : MOV EDX,dword ptr [EBP]
005bd03d : MOV EAX,dword ptr [EDX + 0xbc]
005bd043 : MOV ECX,EBP
005bd045 : CALL EAX
005bd047 : TEST AL,AL
005bd049 : JZ 0x005bd06c
005bd04b : MOV ECX,dword ptr [ESI + 0x18]
005bd04e : PUSH EBP
005bd04f : CALL 0x005296a0
005bd054 : MOV ECX,EAX
005bd056 : CALL 0x005709c0
005bd05b : MOV ESI,dword ptr [ESI + 0x4]
005bd05e : MOV ECX,ESI
005bd060 : CALL 0x00526400
005bd065 : MOV byte ptr [ESI],0x2
005bd068 : MOV byte ptr [ESI + 0x4],0x1
005bd06c : MOV ECX,EBP
005bd06e : CALL 0x004ff7c0
005bd073 : POP EBP
005bd074 : POP EDI
005bd075 : POP ESI
005bd076 : POP EBX
005bd077 : ADD ESP,0x2c
005bd07a : RET
005bd07b : MOV ECX,dword ptr [ESI + 0x18]
005bd07e : PUSH EBX
005bd07f : CALL 0x005296a0
005bd084 : MOV ECX,EAX
005bd086 : CALL 0x005709c0
005bd08b : MOV ESI,dword ptr [ESI + 0x4]
005bd08e : MOV ECX,ESI
005bd090 : CALL 0x00526400
005bd095 : POP EBP
005bd096 : POP EDI
005bd097 : MOV byte ptr [ESI],0x2
005bd09a : MOV byte ptr [ESI + 0x4],0x1
005bd09e : POP ESI
005bd09f : POP EBX
005bd0a0 : ADD ESP,0x2c
005bd0a3 : RET
