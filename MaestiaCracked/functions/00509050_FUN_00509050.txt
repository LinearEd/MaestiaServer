PROGRAM  : Maestia.exe
FUNCTION : FUN_00509050
ENTRY    : 00509050
BODY     : [[00509050, 0050922b]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00509050(int param_1)

{
  uint uVar1;
  int *piVar2;
  int *piVar3;
  GRefCountImpl *pGVar4;
  int iVar5;
  int iVar6;
  uint uVar7;
  undefined **ppuStack_18;
  undefined4 *puStack_14;
  int iStack_c;
  undefined1 auStack_8 [8];
  
  iVar6 = param_1;
  piVar2 = (int *)FUN_005296a0();
  piVar3 = (int *)(**(code **)(*piVar2 + 4))();
  puStack_14 = &param_1;
  param_1 = 0;
  ppuStack_18 = &PTR_LAB_00b860dc;
  (**(code **)(*piVar3 + 0x5c))(&ppuStack_18,1);
  pGVar4 = (GRefCountImpl *)(**(code **)(piVar2[2] + 0xc))(0x13);
  if (pGVar4 != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release(pGVar4);
    FUN_005887b0(auStack_8);
  }
  pGVar4 = (GRefCountImpl *)(**(code **)(piVar2[2] + 0xc))(0x14);
  if (pGVar4 != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release(pGVar4);
    (**(code **)(*(int *)pGVar4 + 8))(&iStack_c);
  }
  iVar5 = FUN_00515840(0x48,0);
  if (iVar5 == 0) {
    iVar6 = 0;
  }
  else {
    iVar6 = FUN_00585130(*(undefined4 *)(iVar6 + 0x18));
  }
  if (iStack_c == 0) {
    uVar7 = 0;
    piVar2 = (int *)0x0;
  }
  else {
    uVar7 = 0;
    piVar2 = (int *)(iStack_c + 8);
    do {
      if (*piVar2 != -2) break;
      uVar7 = uVar7 + 1;
      piVar2 = piVar2 + 4;
    } while (uVar7 <= *(uint *)(iStack_c + 4));
    piVar2 = &iStack_c;
  }
  do {
    do {
      if (((piVar2 == (int *)0x0) || (iVar5 = *piVar2, iVar5 == 0)) ||
         (*(int *)(iVar5 + 4) < (int)uVar7)) {
        FUN_005271c0(iVar6);
        if (iVar6 != 0) {
          FUN_00503db0();
        }
        FUN_00507230();
        return;
      }
      uVar1 = *(uint *)((uVar7 + 1) * 0x10 + iVar5);
      iVar5 = FUN_00525450((uVar1 & 0xfffffffc) + 8,*(uint *)(uVar1 & 0xfffffffc) & 0x7fffffff);
      *(int *)(iVar5 + 8) = *(int *)(iVar5 + 8) + 1;
      *(int *)(iVar5 + 8) = *(int *)(iVar5 + 8) + 1;
      piVar3 = (int *)(iVar5 + 8);
      *piVar3 = *piVar3 + -1;
      if (*piVar3 == 0) {
        FUN_00525340();
      }
      FUN_00585540(&stack0xffffffe0);
      FUN_00526bc0();
      uVar1 = *(uint *)(*piVar2 + 4);
    } while (((int)uVar1 < (int)uVar7) || (uVar7 = uVar7 + 1, uVar1 < uVar7));
    piVar3 = (int *)(uVar7 * 0x10 + 8 + *piVar2);
    do {
      if (*piVar3 != -2) break;
      uVar7 = uVar7 + 1;
      piVar3 = piVar3 + 4;
    } while (uVar7 <= uVar1);
  } while( true );
}



============================================================
DISASSEMBLY
============================================================
00509050 : SUB ESP,0x1c
00509053 : PUSH EBX
00509054 : PUSH EBP
00509055 : MOV EBP,dword ptr [ESP + 0x28]
00509059 : MOV ECX,dword ptr [EBP + 0x18]
0050905c : PUSH ESI
0050905d : PUSH EDI
0050905e : CALL 0x005296a0
00509063 : MOV ESI,EAX
00509065 : MOV EAX,dword ptr [ESI]
00509067 : MOV EDX,dword ptr [EAX + 0x4]
0050906a : MOV ECX,ESI
0050906c : CALL EDX
0050906e : LEA ECX,[ESP + 0x30]
00509072 : MOV dword ptr [ESP + 0x18],ECX
00509076 : MOV EBX,0x1
0050907b : MOV dword ptr [ESP + 0x30],0x0
00509083 : MOV dword ptr [ESP + 0x14],0xb860dc
0050908b : MOV EDX,dword ptr [EAX]
0050908d : MOV EDX,dword ptr [EDX + 0x5c]
00509090 : PUSH EBX
00509091 : LEA ECX,[ESP + 0x18]
00509095 : PUSH ECX
00509096 : MOV ECX,EAX
00509098 : CALL EDX
0050909a : MOV EAX,dword ptr [ESI + 0x8]
0050909d : MOV EDX,dword ptr [EAX + 0xc]
005090a0 : ADD ESI,0x8
005090a3 : PUSH 0x13
005090a5 : MOV ECX,ESI
005090a7 : CALL EDX
005090a9 : MOV EDI,EAX
005090ab : TEST EDI,EDI
005090ad : JZ 0x005090c2
005090af : MOV ECX,EDI
005090b1 : CALL 0x004ff7e0
005090b6 : LEA EAX,[ESP + 0x30]
005090ba : PUSH EAX
005090bb : MOV ECX,EDI
005090bd : CALL 0x005887b0
005090c2 : MOV EDX,dword ptr [ESI]
005090c4 : MOV EAX,dword ptr [EDX + 0xc]
005090c7 : PUSH 0x14
005090c9 : MOV ECX,ESI
005090cb : CALL EAX
005090cd : MOV ESI,EAX
005090cf : TEST ESI,ESI
005090d1 : JZ 0x005090e8
005090d3 : MOV ECX,ESI
005090d5 : CALL 0x004ff7e0
005090da : MOV EDX,dword ptr [ESI]
005090dc : MOV EDX,dword ptr [EDX + 0x8]
005090df : LEA EAX,[ESP + 0x30]
005090e3 : PUSH EAX
005090e4 : MOV ECX,ESI
005090e6 : CALL EDX
005090e8 : MOV EAX,dword ptr [EBP + 0x18]
005090eb : MOV ECX,dword ptr [EAX + 0x78]
005090ee : MOV ECX,dword ptr [ECX + 0x288]
005090f4 : PUSH 0x0
005090f6 : PUSH 0x48
005090f8 : CALL 0x00515840
005090fd : TEST EAX,EAX
005090ff : JZ 0x00509112
00509101 : MOV EDX,dword ptr [EBP + 0x18]
00509104 : PUSH EDX
00509105 : MOV ECX,EAX
00509107 : CALL 0x00585130
0050910c : MOV dword ptr [ESP + 0x10],EAX
00509110 : JMP 0x0050911a
00509112 : MOV dword ptr [ESP + 0x10],0x0
0050911a : MOV ECX,dword ptr [ESP + 0x30]
0050911e : TEST ECX,ECX
00509120 : JNZ 0x00509126
00509122 : XOR EAX,EAX
00509124 : JMP 0x00509142
00509126 : MOV EDX,dword ptr [ECX + 0x4]
00509129 : XOR EAX,EAX
0050912b : ADD ECX,0x8
0050912e : MOV EDI,EDI
00509130 : CMP dword ptr [ECX],-0x2
00509133 : JNZ 0x0050913e
00509135 : ADD EAX,EBX
00509137 : ADD ECX,0x10
0050913a : CMP EAX,EDX
0050913c : JBE 0x00509130
0050913e : LEA ECX,[ESP + 0x30]
00509142 : MOV EDI,ECX
00509144 : MOV ESI,EAX
00509146 : TEST EDI,EDI
00509148 : JZ 0x005091fb
0050914e : MOV ECX,dword ptr [EDI]
00509150 : TEST ECX,ECX
00509152 : JZ 0x005091fb
00509158 : CMP ESI,dword ptr [ECX + 0x4]
0050915b : JG 0x005091fb
00509161 : LEA EAX,[ESI + 0x1]
00509164 : SHL EAX,0x4
00509167 : ADD EAX,ECX
00509169 : MOV ECX,dword ptr [EBP + 0x18]
0050916c : MOV EDX,dword ptr [ECX + 0x78]
0050916f : MOV EAX,dword ptr [EAX]
00509171 : MOV ECX,EAX
00509173 : AND ECX,0xfffffffc
00509176 : MOV ECX,dword ptr [ECX]
00509178 : AND ECX,0x7fffffff
0050917e : AND EAX,0xfffffffc
00509181 : PUSH ECX
00509182 : ADD EAX,0x8
00509185 : PUSH EAX
00509186 : LEA ECX,[EDX + 0x254]
0050918c : CALL 0x00525450
00509191 : ADD dword ptr [EAX + 0x8],EBX
00509194 : MOV byte ptr [ESP + 0x1c],0x5
00509199 : MOV dword ptr [ESP + 0x20],EAX
0050919d : ADD dword ptr [EAX + 0x8],EBX
005091a0 : ADD dword ptr [EAX + 0x8],-0x1
005091a4 : JNZ 0x005091ad
005091a6 : MOV ECX,EAX
005091a8 : CALL 0x00525340
005091ad : MOV ECX,dword ptr [ESP + 0x10]
005091b1 : LEA EDX,[ESP + 0x1c]
005091b5 : PUSH EDX
005091b6 : CALL 0x00585540
005091bb : LEA ECX,[ESP + 0x1c]
005091bf : CALL 0x00526bc0
005091c4 : MOV ECX,dword ptr [EDI]
005091c6 : MOV EAX,dword ptr [ECX + 0x4]
005091c9 : CMP ESI,EAX
005091cb : JG 0x00509146
005091d1 : ADD ESI,EBX
005091d3 : CMP ESI,EAX
005091d5 : JA 0x00509146
005091db : MOV EDX,ESI
005091dd : SHL EDX,0x4
005091e0 : LEA ECX,[EDX + ECX*0x1 + 0x8]
005091e4 : CMP dword ptr [ECX],-0x2
005091e7 : JNZ 0x00509146
005091ed : ADD ESI,EBX
005091ef : ADD ECX,0x10
005091f2 : CMP ESI,EAX
005091f4 : JBE 0x005091e4
005091f6 : JMP 0x00509146
005091fb : MOV ESI,dword ptr [ESP + 0x10]
005091ff : MOV ECX,dword ptr [EBP + 0x4]
00509202 : PUSH ESI
00509203 : CALL 0x005271c0
00509208 : TEST ESI,ESI
0050920a : JZ 0x00509213
0050920c : MOV ECX,ESI
0050920e : CALL 0x00503db0
00509213 : LEA ECX,[ESP + 0x30]
00509217 : MOV dword ptr [ESP + 0x14],0xb85ff8
0050921f : CALL 0x00507230
00509224 : POP EDI
00509225 : POP ESI
00509226 : POP EBP
00509227 : POP EBX
00509228 : ADD ESP,0x1c
0050922b : RET
