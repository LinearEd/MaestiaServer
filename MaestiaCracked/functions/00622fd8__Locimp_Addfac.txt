PROGRAM  : Maestia.exe
FUNCTION : _Locimp_Addfac
ENTRY    : 00622fd8
BODY     : [[00622fd8, 006230b5]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __EH_prolog3 replaced with injection: EH_prolog3 */
/* WARNING: Function: __EH_epilog3 replaced with injection: EH_epilog3 */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */
/* Library Function - Single Match
    private: static void __cdecl std::locale::_Locimp::_Locimp_Addfac(class std::locale::_Locimp
   *,class std::locale::facet *,unsigned int)
   
   Library: Visual Studio 2008 Release */

void __cdecl std::locale::_Locimp::_Locimp_Addfac(_Locimp *param_1,facet *param_2,uint param_3)

{
  void *pvVar1;
  undefined4 *puVar2;
  uint uVar3;
  undefined1 local_20 [12];
  _Lockit local_14 [12];
  undefined4 local_8;
  undefined4 uStack_4;
  
  uStack_4 = 0x10;
  local_8 = 0x622fe4;
  _Lockit::_Lockit(local_14,0);
  local_8 = 0;
  if (*(uint *)(param_1 + 0xc) <= param_3) {
    uVar3 = param_3 + 1;
    if (uVar3 < 0x28) {
      uVar3 = 0x28;
    }
    pvVar1 = __realloc_crt(*(void **)(param_1 + 8),uVar3 << 2);
    if (pvVar1 == (void *)0x0) {
      if ((_DAT_00d7b4d0 & 1) == 0) {
        _DAT_00d7b4d0 = _DAT_00d7b4d0 | 1;
        FUN_004f7950();
        _atexit((_func_4879 *)&LAB_00b84dc5);
      }
      FUN_00406090(&DAT_00d7b4c4);
                    /* WARNING: Subroutine does not return */
      __CxxThrowException_8(local_20,&DAT_00ced904);
    }
    *(void **)(param_1 + 8) = pvVar1;
    while (*(uint *)(param_1 + 0xc) < uVar3) {
      *(undefined4 *)(*(int *)(param_1 + 8) + *(int *)(param_1 + 0xc) * 4) = 0;
      *(int *)(param_1 + 0xc) = *(int *)(param_1 + 0xc) + 1;
    }
  }
  FUN_004d0450();
  if (*(int *)(*(int *)(param_1 + 8) + param_3 * 4) != 0) {
    puVar2 = (undefined4 *)FUN_00451810();
    if (puVar2 != (undefined4 *)0x0) {
      (**(code **)*puVar2)(1);
    }
  }
  local_8 = 0xffffffff;
  *(facet **)(param_3 * 4 + *(int *)(param_1 + 8)) = param_2;
  FUN_00622fc1();
  return;
}



============================================================
DISASSEMBLY
============================================================
00622fd8 : PUSH 0x10
00622fda : MOV EAX,0xb0b5b8
00622fdf : CALL 0x00640e1d
00622fe4 : PUSH 0x0
00622fe6 : LEA ECX,[EBP + -0x10]
00622fe9 : CALL 0x00622f99
00622fee : MOV ESI,dword ptr [EBP + 0x8]
00622ff1 : MOV EBX,dword ptr [EBP + 0x10]
00622ff4 : AND dword ptr [EBP + -0x4],0x0
00622ff8 : CMP dword ptr [ESI + 0xc],EBX
00622ffb : JA 0x00623071
00622ffd : LEA EDI,[EBX + 0x1]
00623000 : CMP EDI,0x28
00623003 : JNC 0x00623008
00623005 : PUSH 0x28
00623007 : POP EDI
00623008 : MOV EAX,EDI
0062300a : SHL EAX,0x2
0062300d : PUSH EAX
0062300e : PUSH dword ptr [ESI + 0x8]
00623011 : CALL 0x006425f0
00623016 : POP ECX
00623017 : POP ECX
00623018 : TEST EAX,EAX
0062301a : JNZ 0x0062305a
0062301c : TEST byte ptr [0x00d7b4d0],0x1
00623023 : MOV ESI,0xd7b4c4
00623028 : JNZ 0x00623043
0062302a : OR dword ptr [0x00d7b4d0],0x1
00623031 : MOV ECX,ESI
00623033 : CALL 0x004f7950
00623038 : PUSH 0xb84dc5
0062303d : CALL 0x006356bc
00623042 : POP ECX
00623043 : PUSH ESI
00623044 : LEA ECX,[EBP + -0x1c]
00623047 : CALL 0x00406090
0062304c : PUSH 0xced904
00623051 : LEA EAX,[EBP + -0x1c]
00623054 : PUSH EAX
00623055 : CALL 0x006409eb
0062305a : MOV dword ptr [ESI + 0x8],EAX
0062305d : JMP 0x0062306c
0062305f : MOV EAX,dword ptr [ESI + 0xc]
00623062 : MOV ECX,dword ptr [ESI + 0x8]
00623065 : AND dword ptr [ECX + EAX*0x4],0x0
00623069 : INC dword ptr [ESI + 0xc]
0062306c : CMP dword ptr [ESI + 0xc],EDI
0062306f : JC 0x0062305f
00623071 : MOV ECX,dword ptr [EBP + 0xc]
00623074 : CALL 0x004d0450
00623079 : MOV EAX,dword ptr [ESI + 0x8]
0062307c : MOV EDI,EBX
0062307e : SHL EDI,0x2
00623081 : ADD EAX,EDI
00623083 : CMP dword ptr [EAX],0x0
00623086 : JZ 0x0062309b
00623088 : MOV ECX,dword ptr [EAX]
0062308a : CALL 0x00451810
0062308f : TEST EAX,EAX
00623091 : JZ 0x0062309b
00623093 : MOV EDX,dword ptr [EAX]
00623095 : PUSH 0x1
00623097 : MOV ECX,EAX
00623099 : CALL dword ptr [EDX]
0062309b : MOV EAX,dword ptr [ESI + 0x8]
0062309e : MOV ECX,dword ptr [EBP + 0xc]
006230a1 : OR dword ptr [EBP + -0x4],0xffffffff
006230a5 : MOV dword ptr [EDI + EAX*0x1],ECX
006230a8 : LEA ECX,[EBP + -0x10]
006230ab : CALL 0x00622fc1
006230b0 : CALL 0x00640ebc
006230b5 : RET
