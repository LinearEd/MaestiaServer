PROGRAM  : Maestia.exe
FUNCTION : FUN_005ef4f0
ENTRY    : 005ef4f0
BODY     : [[005ef4f0, 005ef817]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_005ef4f0(undefined4 param_1,undefined4 param_2,float param_3)

{
  float fVar1;
  int *piVar2;
  undefined4 uVar3;
  int *in_ECX;
  uint uVar4;
  int iVar5;
  int iVar6;
  float10 fVar7;
  float local_b0;
  float local_ac;
  float local_a8;
  int local_a4;
  int local_a0;
  int local_9c;
  float local_98;
  float local_94;
  float local_90;
  float local_8c;
  float local_88;
  undefined4 local_84;
  undefined4 local_80;
  int *local_7c [2];
  uint local_74;
  uint local_68;
  uint local_64;
  int *local_1c;
  GRefCountNTSImpl *local_18;
  
  local_b0 = 3.4028235e+38;
  local_a8 = 0.0;
  uVar4 = 0;
  local_ac = 0.0;
  local_a4 = 0;
  local_84 = param_1;
  local_a0 = 0;
  local_9c = 0;
  local_80 = param_2;
  if (in_ECX[1] != 0) {
    do {
      iVar6 = *(int *)(*in_ECX + uVar4 * 8);
      GMatrix2D::TransformByInverse
                ((GMatrix2D *)(iVar6 + 0x44),(GPoint<float> *)&local_90,(GPoint<float> *)&local_84);
      if ((((local_90 <= *(float *)(iVar6 + 0x8c)) &&
           (fVar1 = *(float *)(iVar6 + 0x84), fVar1 < local_90 != (fVar1 == local_90))) &&
          (local_8c <= *(float *)(iVar6 + 0x90))) &&
         (*(float *)(iVar6 + 0x88) < local_8c != (*(float *)(iVar6 + 0x88) == local_8c))) {
        local_a8 = local_90;
        local_9c = local_a0;
        local_ac = local_8c;
        local_a4 = iVar6;
        break;
      }
      FUN_005edd70(&local_98,(float *)(iVar6 + 0x84),&local_90);
      local_88 = local_94 - local_8c;
      fVar7 = (float10)FUN_0063bdc0();
      fVar1 = (float)fVar7;
      if ((fVar1 < param_3) && (fVar1 < local_b0)) {
        local_a8 = local_98;
        local_9c = local_a0;
        local_ac = local_94;
        local_b0 = fVar1;
        local_a4 = iVar6;
      }
      local_a0 = local_a0 + *(int *)(*in_ECX + 4 + uVar4 * 8);
      uVar4 = uVar4 + 1;
    } while (uVar4 < (uint)in_ECX[1]);
    if (local_a4 != 0) {
      local_a8 = local_a8 - *(float *)(local_a4 + 0x84);
      local_94 = local_ac - *(float *)(local_a4 + 0x88);
      local_98 = local_a8;
      FUN_0059a0c0(local_7c,&local_98);
      if (((local_7c[0] != (int *)0x0) && (local_74 < (uint)local_7c[0][1])) && (-1 < (int)local_74)
         ) {
        piVar2 = *(int **)(*local_7c[0] + local_74 * 4);
        iVar6 = *piVar2;
        if (iVar6 < 0) {
          local_b0 = (float)piVar2[3];
        }
        else {
          local_b0 = (float)piVar2[3];
        }
        fVar1 = (float)(int)local_b0;
        if (fVar1 < local_a8 != (fVar1 == local_a8)) {
          if (iVar6 < 0) {
            local_b0 = (float)(uint)*(ushort *)(piVar2 + 5);
          }
          else {
            local_b0 = (float)piVar2[5];
          }
          if (local_a8 <= (float)(int)local_b0 + fVar1) {
            local_ac = 0.0;
            iVar5 = (int)piVar2 + 0x1e;
            if (iVar6 < 0) {
              uVar4 = (uint)*(byte *)(piVar2 + 7);
            }
            else {
              uVar4 = piVar2[1];
              iVar5 = (int)piVar2 + 0x2a;
            }
            uVar3 = FUN_00599240();
            FUN_00545960(iVar5,uVar4,uVar3);
            iVar6 = 0;
            while ((local_68 != 0 && (local_68 < local_64))) {
              uVar4 = (uint)*(ushort *)(local_68 + 2);
              if ((*(byte *)(local_68 + 6) >> 6 & 1) != 0) {
                uVar4 = -uVar4;
              }
              local_ac = (float)((int)local_ac + uVar4);
              if (local_a8 - fVar1 < (float)(int)local_ac) break;
              iVar6 = iVar6 + (uint)(*(ushort *)(local_68 + 4) >> 0xc);
              FUN_005443b0();
            }
            uVar4 = piVar2[2];
            if ((*piVar2 < 0) && (uVar4 = uVar4 & 0xffffff, uVar4 == 0xffffff)) {
              uVar4 = 0xffffffff;
            }
            if (local_18 != (GRefCountNTSImpl *)0x0) {
              GRefCountNTSImpl::Release(local_18);
            }
            if ((local_1c != (int *)0x0) && (*local_1c = *local_1c + -1, *local_1c == 0)) {
              FUN_00500860();
              FUN_00515cf0(local_1c);
            }
            return uVar4 + iVar6 + local_9c;
          }
        }
      }
    }
  }
  return -1;
}



============================================================
DISASSEMBLY
============================================================
005ef4f0 : PUSH EBP
005ef4f1 : MOV EBP,ESP
005ef4f3 : AND ESP,0xfffffff8
005ef4f6 : SUB ESP,0xac
005ef4fc : FLD float ptr [0x00cdf0d8]
005ef502 : PUSH EBX
005ef503 : FSTP float ptr [ESP + 0x8]
005ef507 : PUSH ESI
005ef508 : FLDZ
005ef50a : PUSH EDI
005ef50b : FST float ptr [ESP + 0x18]
005ef50f : XOR EDI,EDI
005ef511 : FSTP float ptr [ESP + 0x14]
005ef515 : MOV EBX,ECX
005ef517 : FLD float ptr [EBP + 0x8]
005ef51a : MOV dword ptr [ESP + 0x1c],EDI
005ef51e : FSTP float ptr [ESP + 0x3c]
005ef522 : MOV dword ptr [ESP + 0x20],EDI
005ef526 : FLD float ptr [EBP + 0xc]
005ef529 : MOV dword ptr [ESP + 0x24],EDI
005ef52d : FSTP float ptr [ESP + 0x40]
005ef531 : CMP dword ptr [EBX + 0x4],EDI
005ef534 : JBE 0x005ef80c
005ef53a : LEA EBX,[EBX]
005ef540 : MOV EAX,dword ptr [EBX]
005ef542 : MOV ESI,dword ptr [EAX + EDI*0x8]
005ef545 : LEA ECX,[ESP + 0x3c]
005ef549 : PUSH ECX
005ef54a : LEA EDX,[ESP + 0x34]
005ef54e : PUSH EDX
005ef54f : LEA ECX,[ESI + 0x44]
005ef552 : CALL 0x00522fa0
005ef557 : FLD float ptr [ESP + 0x30]
005ef55b : FLD float ptr [ESI + 0x8c]
005ef561 : LEA ECX,[ESI + 0x84]
005ef567 : FCOMP
005ef569 : FNSTSW AX
005ef56b : FLD float ptr [ESP + 0x34]
005ef56f : TEST AH,0x1
005ef572 : JNZ 0x005ef59b
005ef574 : FLD float ptr [ECX]
005ef576 : FCOMP ST2
005ef578 : FNSTSW AX
005ef57a : TEST AH,0x41
005ef57d : JP 0x005ef59b
005ef57f : FLD float ptr [ECX + 0xc]
005ef582 : FCOMP
005ef584 : FNSTSW AX
005ef586 : TEST AH,0x1
005ef589 : JNZ 0x005ef59b
005ef58b : FLD float ptr [ECX + 0x4]
005ef58e : FCOMP
005ef590 : FNSTSW AX
005ef592 : TEST AH,0x41
005ef595 : JNP 0x005ef64e
005ef59b : LEA EAX,[ESP + 0x30]
005ef59f : FSTP ST1
005ef5a1 : PUSH EAX
005ef5a2 : FSTP ST0
005ef5a4 : PUSH ECX
005ef5a5 : LEA ECX,[ESP + 0x30]
005ef5a9 : PUSH ECX
005ef5aa : CALL 0x005edd70
005ef5af : FLD float ptr [ESP + 0x34]
005ef5b3 : FSUB float ptr [ESP + 0x3c]
005ef5b7 : ADD ESP,0xc
005ef5ba : FSTP float ptr [ESP + 0xc]
005ef5be : FLD float ptr [ESP + 0x2c]
005ef5c2 : FSUB float ptr [ESP + 0x34]
005ef5c6 : FSTP float ptr [ESP + 0x38]
005ef5ca : FLD float ptr [ESP + 0x38]
005ef5ce : FLD float ptr [ESP + 0xc]
005ef5d2 : FMUL ST0
005ef5d4 : FLD ST1
005ef5d6 : FMULP ST2
005ef5d8 : FADDP
005ef5da : FSTP float ptr [ESP + 0xc]
005ef5de : FLD float ptr [ESP + 0xc]
005ef5e2 : CALL 0x0063bdc0
005ef5e7 : FSTP float ptr [ESP + 0xc]
005ef5eb : FLD float ptr [ESP + 0xc]
005ef5ef : FSTP float ptr [ESP + 0xc]
005ef5f3 : FLD float ptr [ESP + 0xc]
005ef5f7 : FLD float ptr [EBP + 0x10]
005ef5fa : FCOMP
005ef5fc : FNSTSW AX
005ef5fe : TEST AH,0x41
005ef601 : JNZ 0x005ef632
005ef603 : FLD float ptr [ESP + 0x10]
005ef607 : FCOMP
005ef609 : FNSTSW AX
005ef60b : TEST AH,0x41
005ef60e : JNZ 0x005ef632
005ef610 : MOV EDX,dword ptr [ESP + 0x20]
005ef614 : FSTP float ptr [ESP + 0x10]
005ef618 : FLD float ptr [ESP + 0x28]
005ef61c : MOV dword ptr [ESP + 0x1c],ESI
005ef620 : FSTP float ptr [ESP + 0x18]
005ef624 : MOV dword ptr [ESP + 0x24],EDX
005ef628 : FLD float ptr [ESP + 0x2c]
005ef62c : FSTP float ptr [ESP + 0x14]
005ef630 : JMP 0x005ef638
005ef632 : MOV ESI,dword ptr [ESP + 0x1c]
005ef636 : FSTP ST0
005ef638 : MOV EAX,dword ptr [EBX]
005ef63a : MOV ECX,dword ptr [EAX + EDI*0x8 + 0x4]
005ef63e : ADD dword ptr [ESP + 0x20],ECX
005ef642 : INC EDI
005ef643 : CMP EDI,dword ptr [EBX + 0x4]
005ef646 : JC 0x005ef540
005ef64c : JMP 0x005ef664
005ef64e : MOV EDX,dword ptr [ESP + 0x20]
005ef652 : FXCH
005ef654 : FSTP float ptr [ESP + 0x18]
005ef658 : MOV dword ptr [ESP + 0x1c],ESI
005ef65c : MOV dword ptr [ESP + 0x24],EDX
005ef660 : FSTP float ptr [ESP + 0x14]
005ef664 : TEST ESI,ESI
005ef666 : JZ 0x005ef80c
005ef66c : FLD float ptr [ESP + 0x18]
005ef670 : LEA EAX,[ESP + 0x28]
005ef674 : FSUB float ptr [ESI + 0x84]
005ef67a : PUSH EAX
005ef67b : LEA ECX,[ESP + 0x48]
005ef67f : PUSH ECX
005ef680 : FSTP float ptr [ESP + 0x20]
005ef684 : LEA ECX,[ESI + 0x6c]
005ef687 : FLD float ptr [ESP + 0x20]
005ef68b : FSTP float ptr [ESP + 0x30]
005ef68f : FLD float ptr [ESP + 0x1c]
005ef693 : FSUB float ptr [ESI + 0x88]
005ef699 : FSTP float ptr [ESP + 0x34]
005ef69d : CALL 0x0059a0c0
005ef6a2 : MOV ECX,dword ptr [ESP + 0x44]
005ef6a6 : TEST ECX,ECX
005ef6a8 : JZ 0x005ef80c
005ef6ae : MOV EAX,dword ptr [ESP + 0x4c]
005ef6b2 : CMP EAX,dword ptr [ECX + 0x4]
005ef6b5 : JNC 0x005ef80c
005ef6bb : TEST EAX,EAX
005ef6bd : JL 0x005ef80c
005ef6c3 : MOV EDX,dword ptr [ECX]
005ef6c5 : MOV ESI,dword ptr [EDX + EAX*0x4]
005ef6c8 : MOV ECX,dword ptr [ESI]
005ef6ca : SHR ECX,0x1f
005ef6cd : AND CL,0x1
005ef6d0 : JZ 0x005ef6db
005ef6d2 : MOV EAX,dword ptr [ESI + 0xc]
005ef6d5 : MOV dword ptr [ESP + 0x10],EAX
005ef6d9 : JMP 0x005ef6e2
005ef6db : MOV EDX,dword ptr [ESI + 0xc]
005ef6de : MOV dword ptr [ESP + 0x10],EDX
005ef6e2 : FILD dword ptr [ESP + 0x10]
005ef6e6 : FSTP float ptr [ESP + 0xc]
005ef6ea : FLD float ptr [ESP + 0x18]
005ef6ee : FLD float ptr [ESP + 0xc]
005ef6f2 : FCOM
005ef6f4 : FNSTSW AX
005ef6f6 : TEST AH,0x41
005ef6f9 : JP 0x005ef808
005ef6ff : TEST CL,CL
005ef701 : JZ 0x005ef70d
005ef703 : MOVZX EAX,word ptr [ESI + 0x14]
005ef707 : MOV dword ptr [ESP + 0x10],EAX
005ef70b : JMP 0x005ef714
005ef70d : MOV EDX,dword ptr [ESI + 0x14]
005ef710 : MOV dword ptr [ESP + 0x10],EDX
005ef714 : FILD dword ptr [ESP + 0x10]
005ef718 : FADD ST0,ST1
005ef71a : FCOMP ST2
005ef71c : FNSTSW AX
005ef71e : TEST AH,0x1
005ef721 : JNZ 0x005ef808
005ef727 : FSUBP
005ef729 : MOV dword ptr [ESP + 0x14],0x0
005ef731 : FSTP float ptr [ESP + 0xc]
005ef735 : TEST CL,CL
005ef737 : JZ 0x005ef73f
005ef739 : MOVZX EBX,byte ptr [ESI + 0x1c]
005ef73d : JMP 0x005ef742
005ef73f : MOV EBX,dword ptr [ESI + 0x4]
005ef742 : LEA EDI,[ESI + 0x1e]
005ef745 : TEST CL,CL
005ef747 : JNZ 0x005ef74c
005ef749 : LEA EDI,[ESI + 0x2a]
005ef74c : MOV ECX,ESI
005ef74e : CALL 0x00599240
005ef753 : PUSH EAX
005ef754 : PUSH EBX
005ef755 : PUSH EDI
005ef756 : LEA ECX,[ESP + 0x64]
005ef75a : CALL 0x00545960
005ef75f : XOR EDI,EDI
005ef761 : MOV ECX,dword ptr [ESP + 0x58]
005ef765 : TEST ECX,ECX
005ef767 : JZ 0x005ef7a8
005ef769 : CMP ECX,dword ptr [ESP + 0x5c]
005ef76d : JNC 0x005ef7a8
005ef76f : MOV AL,byte ptr [ECX + 0x6]
005ef772 : SHR AL,0x6
005ef775 : TEST AL,0x1
005ef777 : MOVZX EAX,word ptr [ECX + 0x2]
005ef77b : JZ 0x005ef77f
005ef77d : NEG EAX
005ef77f : ADD dword ptr [ESP + 0x14],EAX
005ef783 : FILD dword ptr [ESP + 0x14]
005ef787 : FLD float ptr [ESP + 0xc]
005ef78b : FCOMPP
005ef78d : FNSTSW AX
005ef78f : TEST AH,0x5
005ef792 : JNP 0x005ef7a8
005ef794 : MOVZX ECX,word ptr [ECX + 0x4]
005ef798 : SHR ECX,0xc
005ef79b : ADD EDI,ECX
005ef79d : LEA ECX,[ESP + 0x58]
005ef7a1 : CALL 0x005443b0
005ef7a6 : JMP 0x005ef761
005ef7a8 : MOV EDX,dword ptr [ESI]
005ef7aa : MOV ESI,dword ptr [ESI + 0x8]
005ef7ad : SHR EDX,0x1f
005ef7b0 : TEST DL,0x1
005ef7b3 : JZ 0x005ef7c6
005ef7b5 : AND ESI,0xffffff
005ef7bb : CMP ESI,0xffffff
005ef7c1 : JNZ 0x005ef7c6
005ef7c3 : OR ESI,0xffffffff
005ef7c6 : MOV ECX,dword ptr [ESP + 0xa8]
005ef7cd : ADD ESI,EDI
005ef7cf : ADD ESI,dword ptr [ESP + 0x24]
005ef7d3 : TEST ECX,ECX
005ef7d5 : JZ 0x005ef7dc
005ef7d7 : CALL 0x004ff7c0
005ef7dc : MOV EAX,dword ptr [ESP + 0xa4]
005ef7e3 : TEST EAX,EAX
005ef7e5 : JZ 0x005ef7fd
005ef7e7 : DEC dword ptr [EAX]
005ef7e9 : MOV EDI,EAX
005ef7eb : CMP dword ptr [EDI],0x0
005ef7ee : JNZ 0x005ef7fd
005ef7f0 : MOV ECX,EDI
005ef7f2 : CALL 0x00500860
005ef7f7 : PUSH EDI
005ef7f8 : CALL 0x00515cf0
005ef7fd : MOV EAX,ESI
005ef7ff : POP EDI
005ef800 : POP ESI
005ef801 : POP EBX
005ef802 : MOV ESP,EBP
005ef804 : POP EBP
005ef805 : RET 0xc
005ef808 : FSTP ST0
005ef80a : FSTP ST0
005ef80c : POP EDI
005ef80d : POP ESI
005ef80e : OR EAX,0xffffffff
005ef811 : POP EBX
005ef812 : MOV ESP,EBP
005ef814 : POP EBP
005ef815 : RET 0xc
