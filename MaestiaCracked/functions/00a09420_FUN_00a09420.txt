PROGRAM  : Maestia.exe
FUNCTION : FUN_00a09420
ENTRY    : 00a09420
BODY     : [[00a09420, 00a096bc]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a09420(int param_1)

{
  uint8_t uVar1;
  uint8_t uVar2;
  void *pvVar3;
  uint8_t *packet;
  int iVar4;
  int in_ECX;
  int iVar5;
  byte bVar6;
  int iVar7;
  undefined1 local_30 [28];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b61f5c;
  local_10 = ExceptionList;
  local_14 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if ((*(int *)(in_ECX + 0x28) == 0) ||
     (iVar5 = *(int *)(*(int *)(in_ECX + 0x28) + 0x2c), iVar5 == -1)) goto LAB_00a0969f;
  DAT_00d7cd58 = *(undefined2 *)(in_ECX + 0x2c);
  DAT_00d7cc34 = *(undefined2 *)(in_ECX + 0x2e);
  DAT_00d7cd5c = iVar5;
  if ((param_1 == 0) || (param_1 == -1)) {
    if (*(uint *)(in_ECX + 0x10) >> 0x10 == 0x68e) {
      iVar7 = FUN_004049b0(*(uint *)(in_ECX + 0x10),local_14);
      if (iVar7 == 0) {
        FUN_00404750(L"[%s] Failed - Get RandomBox Data (Index %x)",L"AvaItem::_OnUse",
                     *(undefined2 *)(in_ECX + 0x10));
        local_8 = 1;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaItem::_OnUse",0x266,local_30);
        }
        local_8 = 0xffffffff;
        FUN_00406560();
        goto LAB_00a0969f;
      }
      iVar4 = FUN_00411f70();
      if (iVar4 != 0) {
        FUN_008018d0(L"[%d][%s] Req Gacha Open~!\n",0x26d,L"AvaItem::_OnUse");
        if (((*DAT_00da9894 != 0) && (iVar5 = *(int *)(*DAT_00da9894 + 0x2c4), iVar5 != 0)) &&
           (*(char *)(iVar5 + 0x32) == '\0')) {
          *(uint *)(iVar5 + 0x4c) = (uint)*(byte *)(iVar7 + 0x7e8);
          FUN_00996f80(in_ECX);
        }
        goto LAB_00a0969f;
      }
    }
    pvVar3 = ThreadLocalStoragePointer;
    *(undefined2 *)(DAT_00da93ec + 0x770) = 0;
    iVar7 = *(int *)pvVar3;
    bVar6 = (byte)((ulonglong)(*(byte *)(iVar7 + 0x18) + 1) % 3);
    *(byte *)(iVar7 + 0x18) = bVar6;
    packet = (uint8_t *)((uint)bVar6 * 0x2000 + 0x122cb8 + iVar7);
    if (packet == (uint8_t *)0x0) {
      packet = (uint8_t *)0x0;
    }
    else {
      uVar1 = *(uint8_t *)(in_ECX + 0x2e);
      uVar2 = *(uint8_t *)(in_ECX + 0x2c);
      packet[0] = '\0';
      packet[1] = '\0';
      packet[2] = '6';
      packet[3] = ')';
      *(int *)(packet + 4) = iVar5;
      packet[8] = uVar2;
      packet[9] = uVar1;
    }
    local_8 = 0xffffffff;
    iVar5 = *(int *)(DAT_017247d4 + 4);
    if ((iVar5 == 0) || (*(char *)(DAT_017247d4 + 8) == '\0')) goto LAB_00a0969f;
    iVar7 = 10;
  }
  else {
    bVar6 = *(byte *)(in_ECX + 0x12);
    if (((bVar6 < 0x3c) || (0x45 < bVar6)) && (bVar6 != 0x49)) {
      FUN_009adfc0(*(undefined4 *)(*DAT_00da9894 + 0x1a8),3);
      FUN_008a1050(0xca);
      goto LAB_00a0969f;
    }
    packet = (uint8_t *)FUN_006f4590();
    if (packet == (uint8_t *)0x0) {
      packet = (uint8_t *)0x0;
    }
    else {
      uVar1 = *(uint8_t *)(in_ECX + 0x2e);
      uVar2 = *(uint8_t *)(in_ECX + 0x2c);
      packet[0] = '\0';
      packet[1] = '\0';
      packet[2] = '6';
      packet[3] = '+';
      *(int *)(packet + 4) = param_1;
      *(int *)(packet + 8) = iVar5;
      packet[0xc] = uVar2;
      packet[0xd] = uVar1;
    }
    local_8 = 0xffffffff;
    iVar5 = *(int *)(DAT_017247d4 + 4);
    if ((iVar5 == 0) || (*(char *)(DAT_017247d4 + 8) == '\0')) goto LAB_00a0969f;
    iVar7 = 0xe;
  }
  local_8 = 0xffffffff;
  FUN_00a0dd40(iVar5,iVar7,packet);
LAB_00a0969f:
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00a09420 : PUSH EBP
00a09421 : MOV EBP,ESP
00a09423 : PUSH -0x1
00a09425 : PUSH 0xb61f5c
00a0942a : MOV EAX,FS:[0x0]
00a09430 : PUSH EAX
00a09431 : SUB ESP,0x24
00a09434 : MOV EAX,[0x00d66fa0]
00a09439 : XOR EAX,EBP
00a0943b : MOV dword ptr [EBP + -0x10],EAX
00a0943e : PUSH EBX
00a0943f : PUSH ESI
00a09440 : PUSH EDI
00a09441 : PUSH EAX
00a09442 : LEA EAX,[EBP + -0xc]
00a09445 : MOV FS:[0x0],EAX
00a0944b : MOV EDI,ECX
00a0944d : MOV EAX,dword ptr [EDI + 0x28]
00a09450 : TEST EAX,EAX
00a09452 : JZ 0x00a0969f
00a09458 : MOV ESI,dword ptr [EAX + 0x2c]
00a0945b : CMP ESI,-0x1
00a0945e : JZ 0x00a0969f
00a09464 : MOV EBX,dword ptr [EBP + 0x8]
00a09467 : MOV AX,word ptr [EDI + 0x2c]
00a0946b : MOV CX,word ptr [EDI + 0x2e]
00a0946f : MOV dword ptr [0x00d7cd5c],ESI
00a09475 : MOV [0x00d7cd58],AX
00a0947b : MOV word ptr [0x00d7cc34],CX
00a09482 : TEST EBX,EBX
00a09484 : JZ 0x00a09534
00a0948a : CMP EBX,-0x1
00a0948d : JZ 0x00a09534
00a09493 : MOV AL,byte ptr [EDI + 0x12]
00a09496 : CMP AL,0x3c
00a09498 : JC 0x00a0949e
00a0949a : CMP AL,0x46
00a0949c : JC 0x00a094a2
00a0949e : CMP AL,0x49
00a094a0 : JNZ 0x00a09501
00a094a2 : CALL 0x006f4590
00a094a7 : MOV dword ptr [EBP + -0x30],EAX
00a094aa : MOV dword ptr [EBP + -0x4],0x0
00a094b1 : TEST EAX,EAX
00a094b3 : JZ 0x00a094d6
00a094b5 : MOV CL,byte ptr [EDI + 0x2e]
00a094b8 : MOV DL,byte ptr [EDI + 0x2c]
00a094bb : XOR EDI,EDI
00a094bd : MOV word ptr [EAX],DI
00a094c0 : MOV byte ptr [EAX + 0x2],0x36
00a094c4 : MOV byte ptr [EAX + 0x3],0x2b
00a094c8 : MOV dword ptr [EAX + 0x4],EBX
00a094cb : MOV dword ptr [EAX + 0x8],ESI
00a094ce : MOV byte ptr [EAX + 0xc],DL
00a094d1 : MOV byte ptr [EAX + 0xd],CL
00a094d4 : JMP 0x00a094d8
00a094d6 : XOR EAX,EAX
00a094d8 : MOV dword ptr [EBP + -0x4],0xffffffff
00a094df : MOV EDX,dword ptr [0x017247d4]
00a094e5 : MOV ECX,dword ptr [EDX + 0x4]
00a094e8 : TEST ECX,ECX
00a094ea : JZ 0x00a0969f
00a094f0 : CMP byte ptr [EDX + 0x8],0x0
00a094f4 : JZ 0x00a0969f
00a094fa : PUSH 0xe
00a094fc : JMP 0x00a09697
00a09501 : MOV EDX,dword ptr [0x00da9894]
00a09507 : MOV EAX,dword ptr [EDX]
00a09509 : MOV ECX,dword ptr [EAX + 0x1a8]
00a0950f : PUSH 0x3
00a09511 : PUSH ECX
00a09512 : MOV ECX,0xcaa648
00a09517 : CALL 0x009adfc0
00a0951c : MOV ECX,dword ptr [0x017248dc]
00a09522 : ADD ESP,0x8
00a09525 : PUSH 0xca
00a0952a : CALL 0x008a1050
00a0952f : JMP 0x00a0969f
00a09534 : MOV EAX,dword ptr [EDI + 0x10]
00a09537 : MOV EDX,EAX
00a09539 : SHR EDX,0x10
00a0953c : CMP EDX,0x68e
00a09542 : JNZ 0x00a09619
00a09548 : PUSH EAX
00a09549 : CALL 0x004049b0
00a0954e : MOV EBX,EAX
00a09550 : ADD ESP,0x4
00a09553 : TEST EBX,EBX
00a09555 : JNZ 0x00a095ac
00a09557 : MOVZX EAX,word ptr [EDI + 0x10]
00a0955b : PUSH EAX
00a0955c : PUSH 0xcaa690
00a09561 : PUSH 0xcaa6b0
00a09566 : LEA ESI,[EBP + -0x2c]
00a09569 : CALL 0x00404750
00a0956e : ADD ESP,0xc
00a09571 : MOV dword ptr [EBP + -0x4],0x1
00a09578 : MOV ECX,dword ptr [0x00da98e8]
00a0957e : MOV ECX,dword ptr [ECX]
00a09580 : TEST ECX,ECX
00a09582 : JZ 0x00a09598
00a09584 : MOV EDX,dword ptr [ECX]
00a09586 : MOV EDX,dword ptr [EDX + 0x14]
00a09589 : MOV EAX,ESI
00a0958b : PUSH EAX
00a0958c : PUSH 0x266
00a09591 : PUSH 0xcaa708
00a09596 : CALL EDX
00a09598 : MOV dword ptr [EBP + -0x4],0xffffffff
00a0959f : LEA ECX,[EBP + -0x2c]
00a095a2 : CALL 0x00406560
00a095a7 : JMP 0x00a0969f
00a095ac : CALL 0x00411f70
00a095b1 : TEST EAX,EAX
00a095b3 : JZ 0x00a09619
00a095b5 : MOV ESI,dword ptr [0x00da98e8]
00a095bb : PUSH 0xcaa728
00a095c0 : PUSH 0x26d
00a095c5 : PUSH 0xcaa748
00a095ca : CALL 0x008018d0
00a095cf : MOV ECX,dword ptr [0x00da9894]
00a095d5 : MOV EAX,dword ptr [ECX]
00a095d7 : ADD ESP,0xc
00a095da : TEST EAX,EAX
00a095dc : JZ 0x00a0969f
00a095e2 : MOV EAX,dword ptr [EAX + 0x2c4]
00a095e8 : TEST EAX,EAX
00a095ea : JZ 0x00a0969f
00a095f0 : CMP byte ptr [EAX + 0x32],0x0
00a095f4 : JNZ 0x00a0969f
00a095fa : MOVZX EDX,byte ptr [EBX + 0x7e8]
00a09601 : MOV dword ptr [EAX + 0x4c],EDX
00a09604 : MOV EAX,dword ptr [ECX]
00a09606 : MOV ECX,dword ptr [EAX + 0x2c4]
00a0960c : PUSH EDI
00a0960d : XOR EDX,EDX
00a0960f : CALL 0x00996f80
00a09614 : JMP 0x00a0969f
00a09619 : MOV EDX,dword ptr [0x00da93ec]
00a0961f : MOV EAX,FS:[0x2c]
00a09625 : XOR ECX,ECX
00a09627 : MOV word ptr [EDX + 0x770],CX
00a0962e : MOV ECX,dword ptr [EAX]
00a09630 : MOVZX EAX,byte ptr [ECX + 0x18]
00a09634 : INC EAX
00a09635 : CDQ
00a09636 : MOV EBX,0x3
00a0963b : IDIV EBX
00a0963d : MOV byte ptr [ECX + 0x18],DL
00a09640 : MOVZX EDX,DL
00a09643 : SHL EDX,0xd
00a09646 : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
00a0964d : MOV dword ptr [EBP + -0x30],EAX
00a09650 : MOV dword ptr [EBP + -0x4],0x2
00a09657 : TEST EAX,EAX
00a09659 : JZ 0x00a09679
00a0965b : MOV CL,byte ptr [EDI + 0x2e]
00a0965e : MOV DL,byte ptr [EDI + 0x2c]
00a09661 : XOR EDI,EDI
00a09663 : MOV word ptr [EAX],DI
00a09666 : MOV byte ptr [EAX + 0x2],0x36
00a0966a : MOV byte ptr [EAX + 0x3],0x29
00a0966e : MOV dword ptr [EAX + 0x4],ESI
00a09671 : MOV byte ptr [EAX + 0x8],DL
00a09674 : MOV byte ptr [EAX + 0x9],CL
00a09677 : JMP 0x00a0967b
00a09679 : XOR EAX,EAX
00a0967b : MOV dword ptr [EBP + -0x4],0xffffffff
00a09682 : MOV EDX,dword ptr [0x017247d4]
00a09688 : MOV ECX,dword ptr [EDX + 0x4]
00a0968b : TEST ECX,ECX
00a0968d : JZ 0x00a0969f
00a0968f : CMP byte ptr [EDX + 0x8],0x0
00a09693 : JZ 0x00a0969f
00a09695 : PUSH 0xa
00a09697 : PUSH ECX
00a09698 : MOV EDI,EAX
00a0969a : CALL 0x00a0dd40
00a0969f : MOV ECX,dword ptr [EBP + -0xc]
00a096a2 : MOV dword ptr FS:[0x0],ECX
00a096a9 : POP ECX
00a096aa : POP EDI
00a096ab : POP ESI
00a096ac : POP EBX
00a096ad : MOV ECX,dword ptr [EBP + -0x10]
00a096b0 : XOR ECX,EBP
00a096b2 : CALL 0x00633e6b
00a096b7 : MOV ESP,EBP
00a096b9 : POP EBP
00a096ba : RET 0x4
