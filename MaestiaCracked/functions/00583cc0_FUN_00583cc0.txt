PROGRAM  : Maestia.exe
FUNCTION : FUN_00583cc0
ENTRY    : 00583cc0
BODY     : [[00583cc0, 00583fe0]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00583cc0(int param_1,uint *param_2)

{
  byte bVar1;
  undefined4 uVar2;
  bool bVar3;
  char cVar4;
  GRefCountImpl *pGVar5;
  uint *puVar6;
  byte *pbVar7;
  int iVar8;
  LONG LVar9;
  GRefCountImpl *this;
  byte *pbVar10;
  uint uVar11;
  int *piVar12;
  int iVar13;
  bool bVar14;
  undefined1 *puVar15;
  undefined4 local_14;
  uint uStack_c;
  int *piStack_8;
  undefined4 uStack_4;
  
  local_14 = 0;
  pGVar5 = (GRefCountImpl *)(**(code **)(**(int **)(param_1 + 0x74) + 0x48))();
  if (pGVar5 == (GRefCountImpl *)0x0) {
    return 0;
  }
  GRefCountImpl::AddRef(pGVar5);
  cVar4 = *(char *)((*param_2 & 0xfffffffc) + 8);
  iVar13 = (*param_2 & 0xfffffffc) + 8;
  bVar3 = false;
  if ((cVar4 == 'i') || (cVar4 == 'I')) {
    FUN_0051c8c0(&uStack_c);
    puVar6 = (uint *)FUN_0051c730(&piStack_8,0,6);
    pbVar7 = (byte *)((*puVar6 & 0xfffffffc) + 8);
    pbVar10 = &DAT_00b86600;
    do {
      bVar1 = *pbVar7;
      bVar14 = bVar1 < *pbVar10;
      if (bVar1 != *pbVar10) {
LAB_00583d60:
        iVar8 = (1 - (uint)bVar14) - (uint)(bVar14 != 0);
        goto LAB_00583d65;
      }
      if (bVar1 == 0) break;
      bVar1 = pbVar7[1];
      bVar14 = bVar1 < pbVar10[1];
      if (bVar1 != pbVar10[1]) goto LAB_00583d60;
      pbVar7 = pbVar7 + 2;
      pbVar10 = pbVar10 + 2;
    } while (bVar1 != 0);
    iVar8 = 0;
LAB_00583d65:
    uVar11 = (uint)piStack_8 & 0xfffffffc;
    LVar9 = InterlockedExchangeAdd((LONG *)(uVar11 + 4),-1);
    if (LVar9 == 1) {
      FUN_00515cf0(uVar11);
    }
    if (iVar8 == 0) {
LAB_00583dc6:
      bVar3 = true;
    }
    else {
      puVar15 = &DAT_00b865f4;
      FUN_0051c730(&piStack_8,0,8);
      cVar4 = FUN_004ffbc0(puVar15);
      uVar11 = (uint)piStack_8 & 0xfffffffc;
      LVar9 = InterlockedExchangeAdd((LONG *)(uVar11 + 4),-1);
      if (LVar9 == 1) {
        FUN_00515cf0(uVar11);
      }
      if (cVar4 != '\0') goto LAB_00583dc6;
    }
    uVar11 = uStack_c & 0xfffffffc;
    LVar9 = InterlockedExchangeAdd((LONG *)(uVar11 + 4),-1);
    if (LVar9 == 1) {
      FUN_00515cf0(uVar11);
    }
    if (!bVar3) goto LAB_00583ed4;
    iVar8 = FUN_005296a0();
    if (*(int *)(iVar8 + 0x100) == 0) {
      piVar12 = (int *)0x0;
    }
    else {
      piVar12 = (int *)(*(int *)(iVar8 + 0x100) + 8);
    }
    uVar2 = *(undefined4 *)(*(int *)(param_1 + 0x78) + 0x288);
    pGVar5 = (GRefCountImpl *)(**(code **)(*piVar12 + 0xc))(4);
    this = (GRefCountImpl *)(**(code **)(*piVar12 + 0xc))(5);
    uStack_c = FUN_00513f20(iVar13,this,pGVar5,uVar2);
    if (this != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(this);
    }
    if (pGVar5 != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(pGVar5);
    }
    if (uStack_c == 0) {
      FUN_0052e570(param_1,
                   "GASBitmapData::LoadBitmap: LoadMovieImageCallback failed to load image \"%s\"\n"
                   ,iVar13);
      FUN_00524240();
      return 0;
    }
    iVar13 = FUN_00515840(0x38,0);
    if (iVar13 == 0) {
      local_14 = 0;
    }
    else {
      local_14 = FUN_00583780(param_1);
    }
    FUN_00583a00(param_1,uStack_c,0);
  }
  else {
LAB_00583ed4:
    piStack_8 = (int *)0x0;
    uStack_4 = 0;
    FUN_0051c480((*param_2 & 0xfffffffc) + 8);
    cVar4 = FUN_005649d0(&piStack_8,&uStack_c);
    uVar11 = uStack_c & 0xfffffffc;
    LVar9 = InterlockedExchangeAdd((LONG *)(uVar11 + 4),-1);
    if (LVar9 == 1) {
      FUN_00515cf0(uVar11);
    }
    if (cVar4 == '\0') {
      if (piStack_8 != (int *)0x0) {
        FUN_00524240();
      }
      FUN_00524240();
      return 0;
    }
    uVar11 = (**(code **)(*piStack_8 + 8))();
    piVar12 = piStack_8;
    if ((uVar11 & 0xff00) != 0x100) {
      if (piStack_8 != (int *)0x0) {
        FUN_00524240();
      }
      FUN_00524240();
      return 0;
    }
    if (piStack_8 == (int *)0x0) goto LAB_00583fcc;
    iVar13 = FUN_00515840(0x38,0);
    if (iVar13 == 0) {
      local_14 = 0;
    }
    else {
      local_14 = FUN_00583780(param_1);
    }
    FUN_00583a00(param_1,piVar12,pGVar5);
    if (piStack_8 == (int *)0x0) goto LAB_00583fcc;
  }
  FUN_00524240();
LAB_00583fcc:
  FUN_00524240();
  return local_14;
}



============================================================
DISASSEMBLY
============================================================
00583cc0 : SUB ESP,0x18
00583cc3 : MOV EAX,dword ptr [ESP + 0x1c]
00583cc7 : MOV ECX,dword ptr [EAX + 0x74]
00583cca : MOV EDX,dword ptr [ECX]
00583ccc : MOV EAX,dword ptr [EDX + 0x48]
00583ccf : PUSH EBX
00583cd0 : PUSH EBP
00583cd1 : PUSH ESI
00583cd2 : XOR EBX,EBX
00583cd4 : PUSH EDI
00583cd5 : MOV dword ptr [ESP + 0x14],EBX
00583cd9 : CALL EAX
00583cdb : MOV ESI,EAX
00583cdd : MOV dword ptr [ESP + 0x18],ESI
00583ce1 : CMP ESI,EBX
00583ce3 : JZ 0x00583fd5
00583ce9 : MOV ECX,ESI
00583ceb : CALL 0x00523dd0
00583cf0 : MOV ECX,dword ptr [ESP + 0x30]
00583cf4 : MOV EDI,dword ptr [ECX]
00583cf6 : MOV EBP,dword ptr [0x00b851cc]
00583cfc : AND EDI,0xfffffffc
00583cff : MOV AL,byte ptr [EDI + 0x8]
00583d02 : ADD EDI,0x8
00583d05 : MOV byte ptr [ESP + 0x13],BL
00583d09 : CMP AL,0x69
00583d0b : JZ 0x00583d15
00583d0d : CMP AL,0x49
00583d0f : JNZ 0x00583ed4
00583d15 : LEA EDX,[ESP + 0x1c]
00583d19 : PUSH EDX
00583d1a : CALL 0x0051c8c0
00583d1f : PUSH 0x6
00583d21 : PUSH EBX
00583d22 : LEA EAX,[ESP + 0x28]
00583d26 : PUSH EAX
00583d27 : LEA ECX,[ESP + 0x28]
00583d2b : CALL 0x0051c730
00583d30 : MOV EAX,dword ptr [EAX]
00583d32 : AND EAX,0xfffffffc
00583d35 : MOV ECX,0xb86600
00583d3a : ADD EAX,0x8
00583d3d : LEA ECX,[ECX]
00583d40 : MOV DL,byte ptr [EAX]
00583d42 : CMP DL,byte ptr [ECX]
00583d44 : JNZ 0x00583d60
00583d46 : TEST DL,DL
00583d48 : JZ 0x00583d5c
00583d4a : MOV DL,byte ptr [EAX + 0x1]
00583d4d : CMP DL,byte ptr [ECX + 0x1]
00583d50 : JNZ 0x00583d60
00583d52 : ADD EAX,0x2
00583d55 : ADD ECX,0x2
00583d58 : TEST DL,DL
00583d5a : JNZ 0x00583d40
00583d5c : XOR EAX,EAX
00583d5e : JMP 0x00583d65
00583d60 : SBB EAX,EAX
00583d62 : SBB EAX,-0x1
00583d65 : MOV ESI,dword ptr [ESP + 0x20]
00583d69 : CMP EAX,EBX
00583d6b : SETZ BL
00583d6e : AND ESI,0xfffffffc
00583d71 : PUSH -0x1
00583d73 : LEA ECX,[ESI + 0x4]
00583d76 : PUSH ECX
00583d77 : CALL EBP
00583d79 : SUB EAX,0x1
00583d7c : JNZ 0x00583d84
00583d7e : PUSH ESI
00583d7f : CALL 0x00515cf0
00583d84 : TEST BL,BL
00583d86 : JNZ 0x00583dc6
00583d88 : PUSH 0xb865f4
00583d8d : PUSH 0x8
00583d8f : PUSH 0x0
00583d91 : LEA EDX,[ESP + 0x2c]
00583d95 : PUSH EDX
00583d96 : LEA ECX,[ESP + 0x2c]
00583d9a : CALL 0x0051c730
00583d9f : MOV ECX,EAX
00583da1 : CALL 0x004ffbc0
00583da6 : MOV ESI,dword ptr [ESP + 0x20]
00583daa : MOV BL,AL
00583dac : AND ESI,0xfffffffc
00583daf : PUSH -0x1
00583db1 : LEA EAX,[ESI + 0x4]
00583db4 : PUSH EAX
00583db5 : CALL EBP
00583db7 : SUB EAX,0x1
00583dba : JNZ 0x00583dc2
00583dbc : PUSH ESI
00583dbd : CALL 0x00515cf0
00583dc2 : TEST BL,BL
00583dc4 : JZ 0x00583dcb
00583dc6 : MOV byte ptr [ESP + 0x13],0x1
00583dcb : MOV ESI,dword ptr [ESP + 0x1c]
00583dcf : AND ESI,0xfffffffc
00583dd2 : PUSH -0x1
00583dd4 : LEA ECX,[ESI + 0x4]
00583dd7 : PUSH ECX
00583dd8 : CALL EBP
00583dda : SUB EAX,0x1
00583ddd : JNZ 0x00583de5
00583ddf : PUSH ESI
00583de0 : CALL 0x00515cf0
00583de5 : CMP byte ptr [ESP + 0x13],0x0
00583dea : JZ 0x00583eca
00583df0 : MOV EBX,dword ptr [ESP + 0x2c]
00583df4 : MOV ECX,EBX
00583df6 : CALL 0x005296a0
00583dfb : ADD EAX,0x100
00583e00 : MOV EAX,dword ptr [EAX]
00583e02 : TEST EAX,EAX
00583e04 : JZ 0x00583e0b
00583e06 : LEA ESI,[EAX + 0x8]
00583e09 : JMP 0x00583e0d
00583e0b : XOR ESI,ESI
00583e0d : MOV EDX,dword ptr [EBX + 0x78]
00583e10 : MOV EAX,dword ptr [ESI]
00583e12 : MOV EBX,dword ptr [EDX + 0x288]
00583e18 : MOV EDX,dword ptr [EAX + 0xc]
00583e1b : PUSH 0x4
00583e1d : MOV ECX,ESI
00583e1f : CALL EDX
00583e21 : MOV EBP,EAX
00583e23 : MOV EAX,dword ptr [ESI]
00583e25 : MOV EDX,dword ptr [EAX + 0xc]
00583e28 : PUSH 0x5
00583e2a : MOV ECX,ESI
00583e2c : CALL EDX
00583e2e : PUSH EBX
00583e2f : MOV ESI,EAX
00583e31 : PUSH EBP
00583e32 : PUSH ESI
00583e33 : PUSH EDI
00583e34 : CALL 0x00513f20
00583e39 : ADD ESP,0x10
00583e3c : MOV dword ptr [ESP + 0x1c],EAX
00583e40 : TEST ESI,ESI
00583e42 : JZ 0x00583e4b
00583e44 : MOV ECX,ESI
00583e46 : CALL 0x004ff7e0
00583e4b : TEST EBP,EBP
00583e4d : JZ 0x00583e56
00583e4f : MOV ECX,EBP
00583e51 : CALL 0x004ff7e0
00583e56 : CMP dword ptr [ESP + 0x1c],0x0
00583e5b : JZ 0x00583ea2
00583e5d : PUSH 0x0
00583e5f : PUSH 0x38
00583e61 : MOV ECX,EBX
00583e63 : CALL 0x00515840
00583e68 : TEST EAX,EAX
00583e6a : JZ 0x00583e7e
00583e6c : MOV ECX,dword ptr [ESP + 0x2c]
00583e70 : PUSH ECX
00583e71 : MOV ECX,EAX
00583e73 : CALL 0x00583780
00583e78 : MOV dword ptr [ESP + 0x14],EAX
00583e7c : JMP 0x00583e86
00583e7e : MOV dword ptr [ESP + 0x14],0x0
00583e86 : MOV ESI,dword ptr [ESP + 0x1c]
00583e8a : MOV EDX,dword ptr [ESP + 0x2c]
00583e8e : MOV ECX,dword ptr [ESP + 0x14]
00583e92 : PUSH 0x0
00583e94 : PUSH ESI
00583e95 : PUSH EDX
00583e96 : CALL 0x00583a00
00583e9b : MOV ECX,ESI
00583e9d : JMP 0x00583fc7
00583ea2 : MOV EAX,dword ptr [ESP + 0x2c]
00583ea6 : PUSH EDI
00583ea7 : PUSH 0xb8dd08
00583eac : PUSH EAX
00583ead : CALL 0x0052e570
00583eb2 : MOV ECX,dword ptr [ESP + 0x24]
00583eb6 : ADD ESP,0xc
00583eb9 : CALL 0x00524240
00583ebe : MOV EAX,dword ptr [ESP + 0x14]
00583ec2 : POP EDI
00583ec3 : POP ESI
00583ec4 : POP EBP
00583ec5 : POP EBX
00583ec6 : ADD ESP,0x18
00583ec9 : RET
00583eca : MOV ECX,dword ptr [ESP + 0x30]
00583ece : MOV ESI,dword ptr [ESP + 0x18]
00583ed2 : XOR EBX,EBX
00583ed4 : MOV ECX,dword ptr [ECX]
00583ed6 : AND ECX,0xfffffffc
00583ed9 : ADD ECX,0x8
00583edc : PUSH ECX
00583edd : LEA ECX,[ESP + 0x20]
00583ee1 : MOV dword ptr [ESP + 0x24],EBX
00583ee5 : MOV dword ptr [ESP + 0x28],EBX
00583ee9 : CALL 0x0051c480
00583eee : LEA EDX,[ESP + 0x1c]
00583ef2 : PUSH EDX
00583ef3 : LEA EAX,[ESP + 0x24]
00583ef7 : PUSH EAX
00583ef8 : MOV ECX,ESI
00583efa : CALL 0x005649d0
00583eff : MOV ESI,dword ptr [ESP + 0x1c]
00583f03 : TEST AL,AL
00583f05 : SETZ BL
00583f08 : AND ESI,0xfffffffc
00583f0b : PUSH -0x1
00583f0d : LEA ECX,[ESI + 0x4]
00583f10 : PUSH ECX
00583f11 : CALL EBP
00583f13 : SUB EAX,0x1
00583f16 : JNZ 0x00583f1e
00583f18 : PUSH ESI
00583f19 : CALL 0x00515cf0
00583f1e : MOV ECX,dword ptr [ESP + 0x20]
00583f22 : TEST BL,BL
00583f24 : JZ 0x00583f42
00583f26 : TEST ECX,ECX
00583f28 : JZ 0x00583f2f
00583f2a : CALL 0x00524240
00583f2f : MOV ECX,dword ptr [ESP + 0x18]
00583f33 : CALL 0x00524240
00583f38 : POP EDI
00583f39 : POP ESI
00583f3a : POP EBP
00583f3b : XOR EAX,EAX
00583f3d : POP EBX
00583f3e : ADD ESP,0x18
00583f41 : RET
00583f42 : MOV EDX,dword ptr [ECX]
00583f44 : MOV EAX,dword ptr [EDX + 0x8]
00583f47 : CALL EAX
00583f49 : AND EAX,0xff00
00583f4e : CMP EAX,0x100
00583f53 : JZ 0x00583f75
00583f55 : MOV ECX,dword ptr [ESP + 0x20]
00583f59 : TEST ECX,ECX
00583f5b : JZ 0x00583f62
00583f5d : CALL 0x00524240
00583f62 : MOV ECX,dword ptr [ESP + 0x18]
00583f66 : CALL 0x00524240
00583f6b : POP EDI
00583f6c : POP ESI
00583f6d : POP EBP
00583f6e : XOR EAX,EAX
00583f70 : POP EBX
00583f71 : ADD ESP,0x18
00583f74 : RET
00583f75 : MOV EAX,dword ptr [ESP + 0x20]
00583f79 : MOV EDI,EAX
00583f7b : TEST EAX,EAX
00583f7d : JZ 0x00583fcc
00583f7f : MOV ESI,dword ptr [ESP + 0x2c]
00583f83 : MOV ECX,dword ptr [ESI + 0x78]
00583f86 : MOV ECX,dword ptr [ECX + 0x288]
00583f8c : PUSH 0x0
00583f8e : PUSH 0x38
00583f90 : CALL 0x00515840
00583f95 : TEST EAX,EAX
00583f97 : JZ 0x00583fa7
00583f99 : PUSH ESI
00583f9a : MOV ECX,EAX
00583f9c : CALL 0x00583780
00583fa1 : MOV dword ptr [ESP + 0x14],EAX
00583fa5 : JMP 0x00583faf
00583fa7 : MOV dword ptr [ESP + 0x14],0x0
00583faf : MOV EDX,dword ptr [ESP + 0x18]
00583fb3 : MOV ECX,dword ptr [ESP + 0x14]
00583fb7 : PUSH EDX
00583fb8 : PUSH EDI
00583fb9 : PUSH ESI
00583fba : CALL 0x00583a00
00583fbf : MOV ECX,dword ptr [ESP + 0x20]
00583fc3 : TEST ECX,ECX
00583fc5 : JZ 0x00583fcc
00583fc7 : CALL 0x00524240
00583fcc : MOV ECX,dword ptr [ESP + 0x18]
00583fd0 : CALL 0x00524240
00583fd5 : MOV EAX,dword ptr [ESP + 0x14]
00583fd9 : POP EDI
00583fda : POP ESI
00583fdb : POP EBP
00583fdc : POP EBX
00583fdd : ADD ESP,0x18
00583fe0 : RET
