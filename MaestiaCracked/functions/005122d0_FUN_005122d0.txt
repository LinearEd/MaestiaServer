PROGRAM  : Maestia.exe
FUNCTION : FUN_005122d0
ENTRY    : 005122d0
BODY     : [[005122d0, 00512324]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005122d0(undefined4 param_1,int param_2)

{
  undefined4 *puVar1;
  LONG LVar2;
  uint in_ECX;
  
  if ((*(int **)(in_ECX + 4) != (int *)0x0) && (param_2 == 2)) {
    (**(code **)(**(int **)(in_ECX + 4) + 0x30))(-(uint)(in_ECX != 8) & in_ECX);
    puVar1 = *(undefined4 **)(in_ECX + 4);
    if (puVar1 != (undefined4 *)0x0) {
      LVar2 = InterlockedExchangeAdd(puVar1 + 1,-1);
      if ((LVar2 == 1) && (puVar1 != (undefined4 *)0x0)) {
        (**(code **)*puVar1)(1);
      }
    }
    *(undefined4 *)(in_ECX + 4) = 0;
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005122d0 : PUSH ESI
005122d1 : MOV ESI,ECX
005122d3 : MOV ECX,dword ptr [ESI + 0x4]
005122d6 : TEST ECX,ECX
005122d8 : JZ 0x00512321
005122da : CMP dword ptr [ESP + 0xc],0x2
005122df : JNZ 0x00512321
005122e1 : MOV EDX,dword ptr [ECX]
005122e3 : LEA EAX,[ESI + -0x8]
005122e6 : NEG EAX
005122e8 : SBB EAX,EAX
005122ea : AND EAX,ESI
005122ec : PUSH EDI
005122ed : PUSH EAX
005122ee : MOV EAX,dword ptr [EDX + 0x30]
005122f1 : CALL EAX
005122f3 : MOV EDI,dword ptr [ESI + 0x4]
005122f6 : TEST EDI,EDI
005122f8 : JZ 0x00512319
005122fa : PUSH -0x1
005122fc : LEA ECX,[EDI + 0x4]
005122ff : PUSH ECX
00512300 : CALL dword ptr [0x00b851cc]
00512306 : SUB EAX,0x1
00512309 : JNZ 0x00512319
0051230b : TEST EDI,EDI
0051230d : JZ 0x00512319
0051230f : MOV EDX,dword ptr [EDI]
00512311 : MOV EAX,dword ptr [EDX]
00512313 : PUSH 0x1
00512315 : MOV ECX,EDI
00512317 : CALL EAX
00512319 : MOV dword ptr [ESI + 0x4],0x0
00512320 : POP EDI
00512321 : POP ESI
00512322 : RET 0x8
