PROGRAM  : Maestia.exe
FUNCTION : RemoveWaitHandler
ENTRY    : 00517db0
BODY     : [[00517db0, 00517e5c]]

============================================================
DECOMPILED C CODE
============================================================

/* public: bool __thiscall GWaitable::RemoveWaitHandler(void (__cdecl*)(void *),void *) */

bool __thiscall
GWaitable::RemoveWaitHandler(GWaitable *this,_func_void_void_ptr *param_1,void *param_2)

{
  LPCRITICAL_SECTION lpCriticalSection;
  void *_Dst;
  int iVar1;
  uint uVar2;
  int *piVar3;
  bool bVar4;
  
                    /* 0x117db0  134  ?RemoveWaitHandler@GWaitable@@QAE_NP6AXPAX@Z0@Z */
  if (*(int *)(this + 8) == 0) {
    return false;
  }
  lpCriticalSection = (LPCRITICAL_SECTION)(*(int *)(this + 8) + 0x10);
  bVar4 = false;
  EnterCriticalSection(lpCriticalSection);
  iVar1 = *(int *)(this + 8);
  uVar2 = 0;
  if (*(uint *)(iVar1 + 8) != 0) {
    piVar3 = *(int **)(iVar1 + 4);
    while (((_func_void_void_ptr *)*piVar3 != param_1 || ((void *)piVar3[1] != param_2))) {
      uVar2 = uVar2 + 1;
      piVar3 = piVar3 + 2;
      if (*(uint *)(iVar1 + 8) <= uVar2) {
        LeaveCriticalSection(lpCriticalSection);
        return false;
      }
    }
    if (*(int *)(iVar1 + 8) == 1) {
      FUN_00517bd0(0);
      LeaveCriticalSection(lpCriticalSection);
      return true;
    }
    _Dst = (void *)(*(int *)(iVar1 + 4) + uVar2 * 8);
    _memcpy(_Dst,(void *)((int)_Dst + 8),(*(int *)(iVar1 + 8) - uVar2) * 8 - 8);
    *(int *)(iVar1 + 8) = *(int *)(iVar1 + 8) + -1;
    bVar4 = true;
  }
  LeaveCriticalSection(lpCriticalSection);
  return bVar4;
}



============================================================
DISASSEMBLY
============================================================
00517db0 : PUSH ESI
00517db1 : MOV ESI,ECX
00517db3 : MOV EAX,dword ptr [ESI + 0x8]
00517db6 : TEST EAX,EAX
00517db8 : JNZ 0x00517dc0
00517dba : XOR AL,AL
00517dbc : POP ESI
00517dbd : RET 0x8
00517dc0 : PUSH EBX
00517dc1 : PUSH EDI
00517dc2 : LEA EDI,[EAX + 0x10]
00517dc5 : PUSH EDI
00517dc6 : XOR BL,BL
00517dc8 : CALL dword ptr [0x00b85118]
00517dce : MOV ECX,dword ptr [ESI + 0x8]
00517dd1 : MOV EDX,dword ptr [ECX + 0x8]
00517dd4 : XOR EAX,EAX
00517dd6 : TEST EDX,EDX
00517dd8 : JBE 0x00517e4e
00517dda : LEA ESI,[ECX + 0x4]
00517ddd : MOV ECX,dword ptr [ESI]
00517ddf : PUSH EBP
00517de0 : MOV EBP,dword ptr [ECX]
00517de2 : CMP EBP,dword ptr [ESP + 0x14]
00517de6 : JNZ 0x00517df1
00517de8 : MOV EBP,dword ptr [ESP + 0x18]
00517dec : CMP dword ptr [ECX + 0x4],EBP
00517def : JZ 0x00517e09
00517df1 : INC EAX
00517df2 : ADD ECX,0x8
00517df5 : CMP EAX,EDX
00517df7 : JC 0x00517de0
00517df9 : POP EBP
00517dfa : PUSH EDI
00517dfb : CALL dword ptr [0x00b8511c]
00517e01 : POP EDI
00517e02 : MOV AL,BL
00517e04 : POP EBX
00517e05 : POP ESI
00517e06 : RET 0x8
00517e09 : MOV ECX,dword ptr [ESI + 0x4]
00517e0c : CMP ECX,0x1
00517e0f : JNZ 0x00517e2c
00517e11 : PUSH 0x0
00517e13 : MOV ECX,ESI
00517e15 : CALL 0x00517bd0
00517e1a : POP EBP
00517e1b : PUSH EDI
00517e1c : MOV BL,0x1
00517e1e : CALL dword ptr [0x00b8511c]
00517e24 : POP EDI
00517e25 : MOV AL,BL
00517e27 : POP EBX
00517e28 : POP ESI
00517e29 : RET 0x8
00517e2c : MOV EDX,dword ptr [ESI]
00517e2e : LEA EDX,[EDX + EAX*0x8]
00517e31 : SUB ECX,EAX
00517e33 : LEA EAX,[ECX*0x8 + 0xfffffff8]
00517e3a : PUSH EAX
00517e3b : LEA ECX,[EDX + 0x8]
00517e3e : PUSH ECX
00517e3f : PUSH EDX
00517e40 : CALL 0x0063ae40
00517e45 : ADD ESP,0xc
00517e48 : DEC dword ptr [ESI + 0x4]
00517e4b : MOV BL,0x1
00517e4d : POP EBP
00517e4e : PUSH EDI
00517e4f : CALL dword ptr [0x00b8511c]
00517e55 : POP EDI
00517e56 : MOV AL,BL
00517e58 : POP EBX
00517e59 : POP ESI
00517e5a : RET 0x8
