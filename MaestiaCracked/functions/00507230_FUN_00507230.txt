PROGRAM  : Maestia.exe
FUNCTION : FUN_00507230
ENTRY    : 00507230
BODY     : [[00507230, 005072bb]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00507230(void)

{
  undefined4 *puVar1;
  uint uVar2;
  LONG LVar3;
  int *in_ECX;
  int iVar4;
  int local_8;
  
  if (*in_ECX != 0) {
    iVar4 = 0;
    local_8 = *(int *)(*in_ECX + 4) + 1;
    do {
      puVar1 = (undefined4 *)(*in_ECX + 8 + iVar4);
      if (*(int *)(*in_ECX + 8 + iVar4) != -2) {
        uVar2 = puVar1[3];
        LVar3 = InterlockedExchangeAdd((LONG *)((uVar2 & 0xfffffffc) + 4),-1);
        if (LVar3 == 1) {
          FUN_00515cf0(uVar2 & 0xfffffffc);
        }
        uVar2 = puVar1[2];
        LVar3 = InterlockedExchangeAdd((LONG *)((uVar2 & 0xfffffffc) + 4),-1);
        if (LVar3 == 1) {
          FUN_00515cf0(uVar2 & 0xfffffffc);
        }
        *puVar1 = 0xfffffffe;
      }
      iVar4 = iVar4 + 0x10;
      local_8 = local_8 + -1;
    } while (local_8 != 0);
    FUN_00515cf0(*in_ECX);
    *in_ECX = 0;
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00507230 : SUB ESP,0x8
00507233 : PUSH ESI
00507234 : MOV ESI,ECX
00507236 : MOV EAX,dword ptr [ESI]
00507238 : MOV dword ptr [ESP + 0x8],ESI
0050723c : TEST EAX,EAX
0050723e : JZ 0x005072b7
00507240 : MOV EAX,dword ptr [EAX + 0x4]
00507243 : PUSH EBX
00507244 : MOV EBX,dword ptr [0x00b851cc]
0050724a : PUSH EBP
0050724b : XOR EBP,EBP
0050724d : INC EAX
0050724e : PUSH EDI
0050724f : MOV dword ptr [ESP + 0x10],EAX
00507253 : MOV EAX,dword ptr [ESI]
00507255 : CMP dword ptr [EAX + EBP*0x1 + 0x8],-0x2
0050725a : LEA EDI,[EAX + EBP*0x1 + 0x8]
0050725e : JZ 0x0050729c
00507260 : MOV ESI,dword ptr [EDI + 0xc]
00507263 : AND ESI,0xfffffffc
00507266 : PUSH -0x1
00507268 : LEA ECX,[ESI + 0x4]
0050726b : PUSH ECX
0050726c : CALL EBX
0050726e : SUB EAX,0x1
00507271 : JNZ 0x00507279
00507273 : PUSH ESI
00507274 : CALL 0x00515cf0
00507279 : MOV ESI,dword ptr [EDI + 0x8]
0050727c : AND ESI,0xfffffffc
0050727f : PUSH -0x1
00507281 : LEA EDX,[ESI + 0x4]
00507284 : PUSH EDX
00507285 : CALL EBX
00507287 : SUB EAX,0x1
0050728a : JNZ 0x00507292
0050728c : PUSH ESI
0050728d : CALL 0x00515cf0
00507292 : MOV ESI,dword ptr [ESP + 0x14]
00507296 : MOV dword ptr [EDI],0xfffffffe
0050729c : ADD EBP,0x10
0050729f : SUB dword ptr [ESP + 0x10],0x1
005072a4 : JNZ 0x00507253
005072a6 : MOV EAX,dword ptr [ESI]
005072a8 : PUSH EAX
005072a9 : CALL 0x00515cf0
005072ae : POP EDI
005072af : POP EBP
005072b0 : MOV dword ptr [ESI],0x0
005072b6 : POP EBX
005072b7 : POP ESI
005072b8 : ADD ESP,0x8
005072bb : RET
