PROGRAM  : Maestia.exe
FUNCTION : FUN_008b0680
ENTRY    : 008b0680
BODY     : [[008b0680, 008b06f4] [008b0700, 008b097b]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008b0680(undefined2 param_1)

{
  int *piVar1;
  uint uVar2;
  int iVar3;
  undefined4 uVar4;
  int in_ECX;
  ushort *puVar5;
  ushort *puVar6;
  uint local_58;
  undefined1 local_54 [4];
  undefined2 local_50;
  undefined4 local_40;
  uint local_3c;
  int local_38;
  ushort *local_34;
  undefined1 local_30 [4];
  undefined2 local_2c;
  undefined4 local_1c;
  uint local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b4c6e0;
  local_10 = ExceptionList;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_14 = uVar2;
  FUN_00413b60(&param_1);
  if (local_34 == *(ushort **)(in_ECX + 0x5c)) {
    FUN_008018d0(L"[event] EventItem find failed  ( OnEntryEvent Index(%d) )",param_1);
  }
  else {
    puVar6 = *(ushort **)(local_34 + 8);
    local_38 = 0;
    puVar5 = puVar6 + 0x33;
    local_34 = puVar6;
    do {
      iVar3 = FUN_00703c00(0x600,uVar2);
      if (iVar3 != 0) {
        iVar3 = FUN_009f2740(CONCAT22(*(undefined2 *)(iVar3 + 4),*(undefined2 *)(iVar3 + 6)));
        if (iVar3 != 0) {
          if (*(char *)(iVar3 + 0x28) != '\0') {
            FUN_009eddb0(iVar3);
            *(undefined1 *)(iVar3 + 0x28) = 0;
          }
          puVar6 = local_34;
          if ((uint)*puVar5 <= *(uint *)(iVar3 + 0x2c)) goto LAB_008b0755;
        }
        if (((DAT_0172491c != 0) && (*DAT_00da9894 != 0)) && (*(int *)(*DAT_00da9894 + 0x1a8) != 0))
        {
          FUN_00406460(L"IDS_EVENT_NEED_MORE_ITEM");
          local_8 = 0;
          piVar1 = *(int **)(*DAT_00da9894 + 0x1a8);
          uVar4 = FUN_0081d120(local_54);
          local_8._0_1_ = 1;
          (**(code **)(*piVar1 + 0x44))(uVar4,3);
          local_8 = (uint)local_8._1_3_ << 8;
          if (7 < local_58) {
                    /* WARNING: Subroutine does not return */
            FUN_006f04e0();
          }
          local_8 = 0xffffffff;
          if (7 < local_3c) {
                    /* WARNING: Subroutine does not return */
            FUN_006f04e0();
          }
          local_3c = 7;
          local_40 = 0;
          local_50 = 0;
        }
        goto LAB_008b095e;
      }
LAB_008b0755:
      local_38 = local_38 + 1;
      puVar5 = puVar5 + 1;
    } while (local_38 < 5);
    local_3c = 7;
    local_40 = 0;
    local_50 = 0;
    FUN_00406360(L"IDS_COUPONEVENT_REQUEST_CHECKMSG",0x20);
    local_8 = 2;
    iVar3 = FUN_0081d120(local_54);
    local_8._0_1_ = 3;
    if (*(uint *)(puVar6 + 0x1e) < 8) {
      puVar5 = puVar6 + 0x14;
    }
    else {
      puVar5 = *(ushort **)(puVar6 + 0x14);
    }
    if (*(uint *)(puVar6 + 0x10) < 8) {
      puVar6 = puVar6 + 6;
    }
    else {
      puVar6 = *(ushort **)(puVar6 + 6);
    }
    if (*(uint *)(iVar3 + 0x18) < 8) {
      iVar3 = iVar3 + 4;
    }
    else {
      iVar3 = *(int *)(iVar3 + 4);
    }
    FUN_00404750(iVar3,puVar6,puVar5);
    local_8 = CONCAT31(local_8._1_3_,5);
    if (7 < local_58) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_8 = CONCAT31(local_8._1_3_,6);
    if (7 < local_3c) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_50 = 0;
    local_3c = 7;
    local_40 = 0;
    iVar3 = FUN_008ede80(local_30,2);
    if (iVar3 == 0) {
      local_8 = 0xffffffff;
      if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
    }
    else {
      *(uint *)(iVar3 + 0x6c) = (uint)*local_34;
      *(undefined4 *)(iVar3 + 0x70) = 4;
      if (*(code **)(iVar3 + 0x60) != (code *)0x0) {
        (**(code **)(iVar3 + 0x60))(1,iVar3);
      }
      *(code **)(iVar3 + 0x60) = FUN_008b05b0;
      local_8 = 0xffffffff;
      if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
    }
    local_8 = 0xffffffff;
    local_2c = 0;
    local_1c = 0;
    local_18 = 7;
  }
LAB_008b095e:
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
008b0680 : PUSH EBP
008b0681 : MOV EBP,ESP
008b0683 : PUSH -0x1
008b0685 : PUSH 0xb4c6e0
008b068a : MOV EAX,FS:[0x0]
008b0690 : PUSH EAX
008b0691 : SUB ESP,0x60
008b0694 : MOV EAX,[0x00d66fa0]
008b0699 : XOR EAX,EBP
008b069b : MOV dword ptr [EBP + -0x10],EAX
008b069e : PUSH EBX
008b069f : PUSH ESI
008b06a0 : PUSH EDI
008b06a1 : PUSH EAX
008b06a2 : LEA EAX,[EBP + -0xc]
008b06a5 : MOV FS:[0x0],EAX
008b06ab : LEA EAX,[EBP + 0x8]
008b06ae : MOV ESI,ECX
008b06b0 : PUSH EAX
008b06b1 : LEA ECX,[ESI + 0x58]
008b06b4 : LEA EAX,[EBP + -0x30]
008b06b7 : CALL 0x00413b60
008b06bc : MOV ESI,dword ptr [ESI + 0x5c]
008b06bf : MOV EAX,dword ptr [EBP + -0x30]
008b06c2 : CMP EAX,ESI
008b06c4 : JNZ 0x008b06e3
008b06c6 : MOVZX ECX,word ptr [EBP + 0x8]
008b06ca : MOV ESI,dword ptr [0x00da98e8]
008b06d0 : PUSH ECX
008b06d1 : PUSH 0xc4bfd8
008b06d6 : CALL 0x008018d0
008b06db : ADD ESP,0x8
008b06de : JMP 0x008b095e
008b06e3 : MOV ESI,dword ptr [EAX + 0x10]
008b06e6 : MOV dword ptr [EBP + -0x30],ESI
008b06e9 : MOV dword ptr [EBP + -0x34],0x0
008b06f0 : LEA EBX,[ESI + 0x66]
008b06f3 : JMP 0x008b0700
008b0700 : MOV DI,word ptr [EBX + -0xa]
008b0704 : PUSH 0x600
008b0709 : CALL 0x00703c00
008b070e : ADD ESP,0x4
008b0711 : TEST EAX,EAX
008b0713 : JZ 0x008b0755
008b0715 : MOVZX ECX,word ptr [EAX + 0x4]
008b0719 : MOVZX EDX,word ptr [EAX + 0x6]
008b071d : SHL ECX,0x10
008b0720 : OR ECX,EDX
008b0722 : PUSH ECX
008b0723 : MOV ECX,dword ptr [0x017247f0]
008b0729 : CALL 0x009f2740
008b072e : MOV ESI,EAX
008b0730 : TEST ESI,ESI
008b0732 : JZ 0x008b07ba
008b0738 : CMP byte ptr [ESI + 0x28],0x0
008b073c : JZ 0x008b0748
008b073e : PUSH ESI
008b073f : CALL 0x009eddb0
008b0744 : MOV byte ptr [ESI + 0x28],0x0
008b0748 : MOVZX EAX,word ptr [EBX]
008b074b : MOV ESI,dword ptr [ESI + 0x2c]
008b074e : CMP ESI,EAX
008b0750 : JC 0x008b07ba
008b0752 : MOV ESI,dword ptr [EBP + -0x30]
008b0755 : MOV EAX,dword ptr [EBP + -0x34]
008b0758 : INC EAX
008b0759 : ADD EBX,0x2
008b075c : CMP EAX,0x5
008b075f : MOV dword ptr [EBP + -0x34],EAX
008b0762 : JL 0x008b0700
008b0764 : PUSH 0x20
008b0766 : XOR EAX,EAX
008b0768 : PUSH 0xc4c080
008b076d : LEA ECX,[EBP + -0x50]
008b0770 : MOV dword ptr [EBP + -0x38],0x7
008b0777 : MOV dword ptr [EBP + -0x3c],0x0
008b077e : MOV word ptr [EBP + -0x4c],AX
008b0782 : CALL 0x00406360
008b0787 : MOV dword ptr [EBP + -0x4],0x2
008b078e : LEA ECX,[EBP + -0x50]
008b0791 : PUSH ECX
008b0792 : MOV ECX,dword ptr [0x0172491c]
008b0798 : LEA EDI,[EBP + -0x6c]
008b079b : CALL 0x0081d120
008b07a0 : MOV byte ptr [EBP + -0x4],0x3
008b07a4 : MOV EBX,0x8
008b07a9 : CMP dword ptr [ESI + 0x3c],EBX
008b07ac : JC 0x008b0876
008b07b2 : MOV ECX,dword ptr [ESI + 0x28]
008b07b5 : JMP 0x008b0879
008b07ba : CMP dword ptr [0x0172491c],0x0
008b07c1 : JZ 0x008b095e
008b07c7 : MOV ECX,dword ptr [0x00da9894]
008b07cd : MOV EAX,dword ptr [ECX]
008b07cf : TEST EAX,EAX
008b07d1 : JZ 0x008b095e
008b07d7 : CMP dword ptr [EAX + 0x1a8],0x0
008b07de : JZ 0x008b095e
008b07e4 : PUSH 0xc4c04c
008b07e9 : LEA ECX,[EBP + -0x50]
008b07ec : CALL 0x00406460
008b07f1 : MOV dword ptr [EBP + -0x4],0x0
008b07f8 : MOV EDX,dword ptr [0x00da9894]
008b07fe : MOV EAX,dword ptr [EDX]
008b0800 : MOV ESI,dword ptr [EAX + 0x1a8]
008b0806 : MOV ECX,dword ptr [0x0172491c]
008b080c : LEA EAX,[EBP + -0x50]
008b080f : PUSH EAX
008b0810 : LEA EDI,[EBP + -0x6c]
008b0813 : CALL 0x0081d120
008b0818 : MOV byte ptr [EBP + -0x4],0x1
008b081c : MOV EDX,dword ptr [ESI]
008b081e : PUSH 0x3
008b0820 : PUSH EAX
008b0821 : MOV EAX,dword ptr [EDX + 0x44]
008b0824 : MOV ECX,ESI
008b0826 : CALL EAX
008b0828 : MOV byte ptr [EBP + -0x4],0x0
008b082c : MOV EBX,0x8
008b0831 : CMP dword ptr [EBP + -0x54],EBX
008b0834 : JC 0x008b083e
008b0836 : MOV ECX,dword ptr [EBP + -0x68]
008b0839 : CALL 0x006f04e0
008b083e : MOV EDI,0x7
008b0843 : XOR ESI,ESI
008b0845 : XOR ECX,ECX
008b0847 : MOV dword ptr [EBP + -0x54],EDI
008b084a : MOV dword ptr [EBP + -0x58],ESI
008b084d : MOV word ptr [EBP + -0x68],CX
008b0851 : MOV dword ptr [EBP + -0x4],0xffffffff
008b0858 : CMP dword ptr [EBP + -0x38],EBX
008b085b : JC 0x008b0865
008b085d : MOV ECX,dword ptr [EBP + -0x4c]
008b0860 : CALL 0x006f04e0
008b0865 : XOR EDX,EDX
008b0867 : MOV dword ptr [EBP + -0x38],EDI
008b086a : MOV dword ptr [EBP + -0x3c],ESI
008b086d : MOV word ptr [EBP + -0x4c],DX
008b0871 : JMP 0x008b095e
008b0876 : LEA ECX,[ESI + 0x28]
008b0879 : CMP dword ptr [ESI + 0x20],EBX
008b087c : JC 0x008b0883
008b087e : MOV ESI,dword ptr [ESI + 0xc]
008b0881 : JMP 0x008b0886
008b0883 : ADD ESI,0xc
008b0886 : CMP dword ptr [EAX + 0x18],EBX
008b0889 : JC 0x008b0890
008b088b : MOV EAX,dword ptr [EAX + 0x4]
008b088e : JMP 0x008b0893
008b0890 : ADD EAX,0x4
008b0893 : PUSH ECX
008b0894 : PUSH ESI
008b0895 : PUSH EAX
008b0896 : LEA ESI,[EBP + -0x2c]
008b0899 : CALL 0x00404750
008b089e : ADD ESP,0xc
008b08a1 : MOV byte ptr [EBP + -0x4],0x5
008b08a5 : CMP dword ptr [EBP + -0x54],EBX
008b08a8 : JC 0x008b08b2
008b08aa : MOV ECX,dword ptr [EBP + -0x68]
008b08ad : CALL 0x006f04e0
008b08b2 : MOV ESI,0x7
008b08b7 : XOR EDI,EDI
008b08b9 : XOR EDX,EDX
008b08bb : MOV dword ptr [EBP + -0x54],ESI
008b08be : MOV dword ptr [EBP + -0x58],EDI
008b08c1 : MOV word ptr [EBP + -0x68],DX
008b08c5 : MOV byte ptr [EBP + -0x4],0x6
008b08c9 : CMP dword ptr [EBP + -0x38],EBX
008b08cc : JC 0x008b08d6
008b08ce : MOV ECX,dword ptr [EBP + -0x4c]
008b08d1 : CALL 0x006f04e0
008b08d6 : MOV ECX,dword ptr [0x00da9894]
008b08dc : XOR EAX,EAX
008b08de : PUSH 0x2
008b08e0 : LEA EDX,[EBP + -0x2c]
008b08e3 : MOV word ptr [EBP + -0x4c],AX
008b08e7 : MOV dword ptr [EBP + -0x38],ESI
008b08ea : MOV dword ptr [EBP + -0x3c],EDI
008b08ed : MOV ECX,dword ptr [ECX]
008b08ef : PUSH EDX
008b08f0 : CALL 0x008ede80
008b08f5 : MOV ESI,EAX
008b08f7 : CMP ESI,EDI
008b08f9 : JNZ 0x008b0917
008b08fb : MOV dword ptr [EBP + -0x4],0xffffffff
008b0902 : CMP dword ptr [EBP + -0x14],EBX
008b0905 : JC 0x008b090f
008b0907 : MOV ECX,dword ptr [EBP + -0x28]
008b090a : CALL 0x006f04e0
008b090f : XOR EAX,EAX
008b0911 : MOV word ptr [EBP + -0x28],AX
008b0915 : JMP 0x008b0954
008b0917 : MOV ECX,dword ptr [EBP + -0x30]
008b091a : MOVZX EAX,word ptr [ECX]
008b091d : MOV dword ptr [ESI + 0x6c],EAX
008b0920 : MOV EAX,dword ptr [ESI + 0x60]
008b0923 : MOV dword ptr [ESI + 0x70],0x4
008b092a : CMP EAX,EDI
008b092c : JZ 0x008b0933
008b092e : PUSH ESI
008b092f : PUSH 0x1
008b0931 : CALL EAX
008b0933 : MOV dword ptr [ESI + 0x60],0x8b05b0
008b093a : MOV dword ptr [EBP + -0x4],0xffffffff
008b0941 : CMP dword ptr [EBP + -0x14],EBX
008b0944 : JC 0x008b094e
008b0946 : MOV ECX,dword ptr [EBP + -0x28]
008b0949 : CALL 0x006f04e0
008b094e : XOR EDX,EDX
008b0950 : MOV word ptr [EBP + -0x28],DX
008b0954 : MOV dword ptr [EBP + -0x18],EDI
008b0957 : MOV dword ptr [EBP + -0x14],0x7
008b095e : MOV ECX,dword ptr [EBP + -0xc]
008b0961 : MOV dword ptr FS:[0x0],ECX
008b0968 : POP ECX
008b0969 : POP EDI
008b096a : POP ESI
008b096b : POP EBX
008b096c : MOV ECX,dword ptr [EBP + -0x10]
008b096f : XOR ECX,EBP
008b0971 : CALL 0x00633e6b
008b0976 : MOV ESP,EBP
008b0978 : POP EBP
008b0979 : RET 0x4
