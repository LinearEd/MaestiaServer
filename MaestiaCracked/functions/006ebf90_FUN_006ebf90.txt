PROGRAM  : Maestia.exe
FUNCTION : FUN_006ebf90
ENTRY    : 006ebf90
BODY     : [[006ebf90, 006ec233]]

============================================================
DECOMPILED C CODE
============================================================

bool FUN_006ebf90(int param_1)

{
  int *piVar1;
  char cVar2;
  uint uVar3;
  int iVar4;
  int *in_ECX;
  uint uVar5;
  bool bVar6;
  int local_38;
  int local_34;
  uint local_30;
  undefined **local_2c;
  int local_28;
  uint local_24;
  uint local_20;
  char local_1c;
  void *local_14;
  undefined1 *puStack_10;
  undefined4 local_c;
  
  puStack_10 = &LAB_00b47384;
  local_14 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xffffffb8;
  ExceptionList = &local_14;
  uVar5 = 0;
  bVar6 = false;
  local_24 = 0;
  local_38 = 0;
  local_2c = &PTR_LAB_00cdf068;
  local_28 = 0;
  local_20 = 0;
  local_1c = '\0';
  local_c = 0;
  if (in_ECX == (int *)0x0) {
    __wassert(L"pAttribDesc",L".\\Source\\GeometryBuffer.cpp",0xa5);
  }
  if (*in_ECX != 0x11) {
    do {
      if ((short)in_ECX[2] == 0) {
        __wassert(L"pAttrib->m_uiNumElements > 0",L".\\Source\\GeometryBuffer.cpp",0xa9);
      }
      iVar4 = FUN_006ebed0(uVar3);
      if (iVar4 == 0x11) {
        FUN_00807d70("CGeometryBufferDirectX9::SetFormat, vertex attribute not supported by DX9: (%s, # elements: %d, data type: %s)\n"
                     ,(&PTR_s_Position_00d72f18)[*in_ECX],(short)in_ECX[2],
                     (&PTR_s_Unsigned_Byte_00d72ee8)[in_ECX[1]]);
        bVar6 = false;
        goto LAB_006ec175;
      }
      local_30 = CONCAT31((int3)(local_30 >> 8),(char)iVar4) & 0xffff00ff;
      local_34 = local_38 << 0x10;
      cVar2 = FUN_006ebe40();
      if (cVar2 == '\0') {
        FUN_00807d70("CGeometryBufferDirectX9::SetFormat, cannot find matching DX9 semantic");
        bVar6 = false;
        goto LAB_006ec175;
      }
      if (local_1c == '\0') {
        if (uVar5 == local_20) {
          if (local_20 < 8) {
            local_20 = 8;
          }
          FUN_004f9d50(&local_2c);
          uVar5 = local_24;
        }
        *(int *)(local_28 + uVar5 * 8) = local_34;
        *(uint *)(local_28 + 4 + uVar5 * 8) = local_30;
LAB_006ec0bc:
        uVar5 = uVar5 + 1;
        local_24 = uVar5;
      }
      else if (uVar5 < local_20) {
        *(int *)(local_28 + uVar5 * 8) = local_34;
        *(uint *)(local_28 + 4 + uVar5 * 8) = local_30;
        goto LAB_006ec0bc;
      }
      local_38 = local_38 +
                 (uint)(ushort)((short)in_ECX[2] *
                               (short)*(undefined4 *)(&DAT_00d72c34 + in_ECX[1] * 4));
      in_ECX = in_ECX + 3;
    } while (*in_ECX != 0x11);
    FUN_004f9c90();
    if (DAT_01720efc == (int *)0x0) {
      __wassert(L"DX9::Device( )",L".\\Source\\GeometryBuffer.cpp",0xd8);
    }
    piVar1 = DAT_01720efc;
    if (local_24 == 0) {
      __wassert(L"uiIndex < m_uiSize",
                L"d:\\MaestiaProject\\MaestiaSrc\\Client\\Main\\include\\SpeedTree5.1.1\\Core/Array.inl"
                ,0x136);
    }
    iVar4 = (**(code **)(*piVar1 + 0x158))(piVar1,local_28,param_1 + 4);
    bVar6 = iVar4 == 0;
  }
LAB_006ec175:
  local_c = 0xffffffff;
  local_2c = &PTR_LAB_00cdf068;
  if (local_1c != '\0') {
    local_24 = 0;
    local_20 = 0;
    local_28 = 0;
    local_1c = '\0';
  }
  if (local_1c != '\0') {
    __wassert(L"!m_bExternalMemory",
              L"d:\\MaestiaProject\\MaestiaSrc\\Client\\Main\\include\\SpeedTree5.1.1\\Core/Array.inl"
              ,0x2eb);
  }
  FUN_00474f10();
  ExceptionList = local_14;
  return bVar6;
}



============================================================
DISASSEMBLY
============================================================
006ebf90 : PUSH EBP
006ebf91 : MOV EBP,ESP
006ebf93 : AND ESP,0xfffffff8
006ebf96 : PUSH -0x1
006ebf98 : PUSH 0xb47384
006ebf9d : MOV EAX,FS:[0x0]
006ebfa3 : PUSH EAX
006ebfa4 : SUB ESP,0x28
006ebfa7 : PUSH EBX
006ebfa8 : PUSH ESI
006ebfa9 : PUSH EDI
006ebfaa : MOV EAX,[0x00d66fa0]
006ebfaf : XOR EAX,ESP
006ebfb1 : PUSH EAX
006ebfb2 : LEA EAX,[ESP + 0x38]
006ebfb6 : MOV FS:[0x0],EAX
006ebfbc : MOV ESI,ECX
006ebfbe : XOR EDI,EDI
006ebfc0 : XOR BL,BL
006ebfc2 : MOV dword ptr [ESP + 0x28],EDI
006ebfc6 : MOV dword ptr [ESP + 0x14],EDI
006ebfca : MOV dword ptr [ESP + 0x20],0xcdf068
006ebfd2 : MOV dword ptr [ESP + 0x24],EDI
006ebfd6 : MOV dword ptr [ESP + 0x2c],EDI
006ebfda : MOV byte ptr [ESP + 0x30],BL
006ebfde : MOV dword ptr [ESP + 0x40],EDI
006ebfe2 : CMP ESI,EDI
006ebfe4 : JNZ 0x006ebffd
006ebfe6 : PUSH 0xa5
006ebfeb : PUSH 0xbf1e34
006ebff0 : PUSH 0xbf1e6c
006ebff5 : CALL 0x00640200
006ebffa : ADD ESP,0xc
006ebffd : CMP dword ptr [ESI],0x11
006ec000 : JZ 0x006ec175
006ec006 : MOV EBX,0x8
006ec00b : CMP word ptr [ESI + 0x8],0x0
006ec010 : JA 0x006ec029
006ec012 : PUSH 0xa9
006ec017 : PUSH 0xbf1e84
006ec01c : PUSH 0xbf1ebc
006ec021 : CALL 0x00640200
006ec026 : ADD ESP,0xc
006ec029 : MOV ECX,ESI
006ec02b : CALL 0x006ebed0
006ec030 : CMP EAX,0x11
006ec033 : JZ 0x006ec206
006ec039 : MOV DX,word ptr [ESP + 0x14]
006ec03e : XOR ECX,ECX
006ec040 : MOV word ptr [ESP + 0x18],CX
006ec045 : MOV byte ptr [ESP + 0x1d],CL
006ec049 : LEA ECX,[ESP + 0x18]
006ec04d : MOV byte ptr [ESP + 0x1c],AL
006ec051 : MOV word ptr [ESP + 0x1a],DX
006ec056 : CALL 0x006ebe40
006ec05b : TEST AL,AL
006ec05d : JZ 0x006ec1f2
006ec063 : CMP byte ptr [ESP + 0x30],0x0
006ec068 : JZ 0x006ec085
006ec06a : CMP EDI,dword ptr [ESP + 0x2c]
006ec06e : JNC 0x006ec0c1
006ec070 : MOV EAX,dword ptr [ESP + 0x24]
006ec074 : MOV ECX,dword ptr [ESP + 0x18]
006ec078 : MOV EDX,dword ptr [ESP + 0x1c]
006ec07c : MOV dword ptr [EAX + EDI*0x8],ECX
006ec07f : MOV dword ptr [EAX + EDI*0x8 + 0x4],EDX
006ec083 : JMP 0x006ec0bc
006ec085 : MOV EAX,dword ptr [ESP + 0x2c]
006ec089 : CMP EDI,EAX
006ec08b : JNZ 0x006ec0a9
006ec08d : CMP EAX,EBX
006ec08f : JNC 0x006ec097
006ec091 : MOV dword ptr [ESP + 0x2c],EBX
006ec095 : MOV EAX,EBX
006ec097 : LEA ECX,[ESP + 0x20]
006ec09b : LEA EAX,[EAX + EAX*0x1 + 0x1]
006ec09f : PUSH ECX
006ec0a0 : CALL 0x004f9d50
006ec0a5 : MOV EDI,dword ptr [ESP + 0x28]
006ec0a9 : MOV EAX,dword ptr [ESP + 0x24]
006ec0ad : MOV EDX,dword ptr [ESP + 0x18]
006ec0b1 : MOV ECX,dword ptr [ESP + 0x1c]
006ec0b5 : MOV dword ptr [EAX + EDI*0x8],EDX
006ec0b8 : MOV dword ptr [EAX + EDI*0x8 + 0x4],ECX
006ec0bc : INC EDI
006ec0bd : MOV dword ptr [ESP + 0x28],EDI
006ec0c1 : MOV EDX,dword ptr [ESI + 0x4]
006ec0c4 : MOV EAX,dword ptr [EDX*0x4 + 0xd72c34]
006ec0cb : MOV CX,word ptr [ESI + 0x8]
006ec0cf : IMUL CX,AX
006ec0d3 : MOVZX EDX,CX
006ec0d6 : ADD dword ptr [ESP + 0x14],EDX
006ec0da : ADD ESI,0xc
006ec0dd : CMP dword ptr [ESI],0x11
006ec0e0 : JNZ 0x006ec00b
006ec0e6 : XOR ECX,ECX
006ec0e8 : MOV EAX,0xff
006ec0ed : LEA EDI,[ESP + 0x18]
006ec0f1 : LEA ESI,[ESP + 0x20]
006ec0f5 : MOV word ptr [ESP + 0x18],AX
006ec0fa : MOV word ptr [ESP + 0x1a],CX
006ec0ff : MOV byte ptr [ESP + 0x1c],0x11
006ec104 : MOV byte ptr [ESP + 0x1d],CL
006ec108 : MOV byte ptr [ESP + 0x1e],CL
006ec10c : MOV byte ptr [ESP + 0x1f],CL
006ec110 : CALL 0x004f9c90
006ec115 : CMP dword ptr [0x01720efc],0x0
006ec11c : JNZ 0x006ec135
006ec11e : PUSH 0xd8
006ec123 : PUSH 0xbf1fb0
006ec128 : PUSH 0xbf1fe8
006ec12d : CALL 0x00640200
006ec132 : ADD ESP,0xc
006ec135 : CMP dword ptr [ESP + 0x28],0x0
006ec13a : MOV ESI,dword ptr [0x01720efc]
006ec140 : JA 0x006ec159
006ec142 : PUSH 0x136
006ec147 : PUSH 0xcded60
006ec14c : PUSH 0xcdee2c
006ec151 : CALL 0x00640200
006ec156 : ADD ESP,0xc
006ec159 : MOV EAX,dword ptr [EBP + 0x8]
006ec15c : MOV ECX,dword ptr [ESP + 0x24]
006ec160 : MOV EDX,dword ptr [ESI]
006ec162 : MOV EDX,dword ptr [EDX + 0x158]
006ec168 : ADD EAX,0x4
006ec16b : PUSH EAX
006ec16c : PUSH ECX
006ec16d : PUSH ESI
006ec16e : CALL EDX
006ec170 : TEST EAX,EAX
006ec172 : SETZ BL
006ec175 : MOV dword ptr [ESP + 0x40],0xffffffff
006ec17d : CMP byte ptr [ESP + 0x30],0x0
006ec182 : MOV dword ptr [ESP + 0x20],0xcdf068
006ec18a : JZ 0x006ec19e
006ec18c : XOR EAX,EAX
006ec18e : MOV dword ptr [ESP + 0x28],EAX
006ec192 : MOV dword ptr [ESP + 0x2c],EAX
006ec196 : MOV dword ptr [ESP + 0x24],EAX
006ec19a : MOV byte ptr [ESP + 0x30],AL
006ec19e : CMP byte ptr [ESP + 0x30],0x0
006ec1a3 : MOV EAX,dword ptr [ESP + 0x24]
006ec1a7 : MOV dword ptr [ESP + 0x14],EAX
006ec1ab : JZ 0x006ec1c4
006ec1ad : PUSH 0x2eb
006ec1b2 : PUSH 0xcded60
006ec1b7 : PUSH 0xcdee00
006ec1bc : CALL 0x00640200
006ec1c1 : ADD ESP,0xc
006ec1c4 : LEA ESI,[ESP + 0x14]
006ec1c8 : CALL 0x00474f10
006ec1cd : XOR EAX,EAX
006ec1cf : MOV dword ptr [ESP + 0x24],EAX
006ec1d3 : MOV dword ptr [ESP + 0x2c],EAX
006ec1d7 : MOV dword ptr [ESP + 0x28],EAX
006ec1db : MOV AL,BL
006ec1dd : MOV ECX,dword ptr [ESP + 0x38]
006ec1e1 : MOV dword ptr FS:[0x0],ECX
006ec1e8 : POP ECX
006ec1e9 : POP EDI
006ec1ea : POP ESI
006ec1eb : POP EBX
006ec1ec : MOV ESP,EBP
006ec1ee : POP EBP
006ec1ef : RET 0x4
006ec1f2 : PUSH 0xbf1ef8
006ec1f7 : CALL 0x00807d70
006ec1fc : ADD ESP,0x4
006ec1ff : XOR BL,BL
006ec201 : JMP 0x006ec175
006ec206 : MOV EAX,dword ptr [ESI + 0x4]
006ec209 : MOV EAX,dword ptr [EAX*0x4 + 0xd72ee8]
006ec210 : MOVZX EDX,word ptr [ESI + 0x8]
006ec214 : MOV ECX,dword ptr [ESI]
006ec216 : MOV ECX,dword ptr [ECX*0x4 + 0xd72f18]
006ec21d : PUSH EAX
006ec21e : PUSH EDX
006ec21f : PUSH ECX
006ec220 : PUSH 0xbf1f40
006ec225 : CALL 0x00807d70
006ec22a : ADD ESP,0x10
006ec22d : XOR BL,BL
006ec22f : JMP 0x006ec175
