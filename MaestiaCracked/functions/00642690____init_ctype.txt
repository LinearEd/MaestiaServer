PROGRAM  : Maestia.exe
FUNCTION : ___init_ctype
ENTRY    : 00642690
BODY     : [[00642690, 00642a31]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    ___init_ctype
   
   Library: Visual Studio 2008 Release */

int __cdecl ___init_ctype(threadlocinfo *_LocInfo)

{
  BYTE *pBVar1;
  byte bVar2;
  LONG *lpAddend;
  void *_Dst;
  int iVar3;
  BOOL BVar4;
  BYTE *pBVar5;
  LONG LVar6;
  BYTE *pBVar7;
  BYTE *pBVar8;
  uint uVar9;
  localeinfo_struct local_50;
  wchar_t *local_48;
  LPWORD local_44;
  byte *local_40;
  int *local_3c;
  BYTE *local_38;
  wchar_t *local_34;
  undefined4 *local_30;
  void *local_2c;
  LPCSTR local_28;
  void *local_24;
  BYTE *local_20;
  _cpinfo local_1c;
  uint local_8;
  
  local_8 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  local_30 = (undefined4 *)0x0;
  local_20 = (BYTE *)0x0;
  local_24 = (void *)0x0;
  local_2c = (void *)0x0;
  local_28 = (LPCSTR)0x0;
  local_50.locinfo = _LocInfo;
  local_50.mbcinfo = (pthreadmbcinfo)0x0;
  if (_LocInfo->lc_category[0].wlocale == (wchar_t *)0x0) {
    lpAddend = (LONG *)_LocInfo[1].lc_collate_cp;
    if (lpAddend != (LONG *)0x0) {
      InterlockedDecrement(lpAddend);
    }
    _LocInfo[1].lc_collate_cp = 0;
    _LocInfo[1].lc_time_cp = 0;
    _LocInfo[1].lc_category[0].locale = " ";
    _LocInfo[1].lc_category[0].wlocale = (wchar_t *)&DAT_00b9b640;
    _LocInfo[1].lc_category[0].refcount = (int *)&DAT_00b9b7c0;
    _LocInfo->locale_name[3] = (wchar_t *)0x1;
    goto LAB_00642a23;
  }
  if ((_LocInfo->lc_codepage == 0) &&
     (iVar3 = ___getlocaleinfo(&local_50,0,
                               (LPCWSTR)(uint)*(ushort *)&_LocInfo->lc_category[2].locale,0x1004,
                               &_LocInfo->lc_codepage), iVar3 != 0)) {
LAB_006429b6:
    _free(local_30);
    _free(local_20);
    _free(local_24);
    _free(local_2c);
  }
  else {
    local_30 = __malloc_crt(4);
    local_20 = __calloc_crt(0x180,2);
    local_24 = __calloc_crt(0x180,1);
    local_2c = __calloc_crt(0x180,1);
    local_28 = __calloc_crt(0x101,1);
    if ((local_30 == (undefined4 *)0x0) ||
       ((((local_20 == (BYTE *)0x0 || (local_28 == (LPCSTR)0x0)) || (local_24 == (void *)0x0)) ||
        (local_2c == (void *)0x0)))) goto LAB_006429b6;
    *local_30 = 0;
    iVar3 = 0;
    do {
      local_28[iVar3] = (CHAR)iVar3;
      iVar3 = iVar3 + 1;
    } while (iVar3 < 0x100);
    BVar4 = GetCPInfo(_LocInfo->lc_codepage,&local_1c);
    if ((BVar4 == 0) || (5 < local_1c.MaxCharSize)) goto LAB_006429b6;
    local_34 = (wchar_t *)(local_1c.MaxCharSize & 0xffff);
    if (((wchar_t *)0x1 < local_34) && (local_1c.LeadByte[0] != '\0')) {
      pBVar5 = local_1c.LeadByte + 1;
      do {
        bVar2 = *pBVar5;
        if (bVar2 == 0) break;
        for (uVar9 = (uint)pBVar5[-1]; (int)uVar9 <= (int)(uint)bVar2; uVar9 = uVar9 + 1) {
          local_28[uVar9] = ' ';
          bVar2 = *pBVar5;
        }
        pBVar7 = pBVar5 + 1;
        pBVar5 = pBVar5 + 2;
      } while (*pBVar7 != 0);
    }
    local_44 = (LPWORD)(local_20 + 0x100);
    BVar4 = ___crtGetStringTypeA((_locale_t)0x0,1,local_28,0x100,local_44,_LocInfo->lc_codepage,0);
    if (((BVar4 == 0) ||
        (iVar3 = ___crtLCMapStringA((_locale_t)0x0,_LocInfo->lc_category[0].wlocale,0x100,
                                    local_28 + 1,0xff,(LPSTR)((int)local_24 + 0x81),0xff,
                                    _LocInfo->lc_codepage,0), iVar3 == 0)) ||
       (iVar3 = ___crtLCMapStringA((_locale_t)0x0,_LocInfo->lc_category[0].wlocale,0x200,
                                   local_28 + 1,0xff,(LPSTR)((int)local_2c + 0x81),0xff,
                                   _LocInfo->lc_codepage,0), pBVar5 = local_20, _Dst = local_24,
       iVar3 == 0)) goto LAB_006429b6;
    local_40 = local_20 + 0xfe;
    local_40[0] = 0;
    local_40[1] = 0;
    local_48 = (wchar_t *)((int)local_24 + 0x80);
    *(undefined1 *)((int)local_24 + 0x7f) = 0;
    *(undefined1 *)((int)local_2c + 0x7f) = 0;
    *(undefined1 *)local_48 = 0;
    local_3c = (int *)((int)local_2c + 0x80);
    *(undefined1 *)local_3c = 0;
    pBVar7 = local_20;
    if ((1 < (int)local_34) && (local_1c.LeadByte[0] != '\0')) {
      pBVar7 = local_1c.LeadByte + 1;
      do {
        if (*pBVar7 == 0) break;
        local_24 = (void *)(uint)pBVar7[-1];
        if (local_24 <= (void *)(uint)*pBVar7) {
          local_38 = local_20 + (int)local_24 * 2 + 0x100;
          do {
            local_24 = (void *)((int)local_24 + 1);
            local_38[0] = '\0';
            local_38[1] = 0x80;
            local_38 = local_38 + 2;
          } while ((int)local_24 <= (int)(uint)*pBVar7);
        }
        pBVar8 = pBVar7 + 2;
        pBVar1 = pBVar7 + 1;
        pBVar7 = pBVar8;
      } while (*pBVar1 != 0);
    }
    local_20 = pBVar7;
    _memcpy(pBVar5,pBVar5 + 0x200,0xfe);
    _memcpy(_Dst,(void *)((int)_Dst + 0x100),0x7f);
    _memcpy(local_2c,(void *)((int)local_2c + 0x100),0x7f);
    if (((LONG *)_LocInfo[1].lc_collate_cp != (LONG *)0x0) &&
       (LVar6 = InterlockedDecrement((LONG *)_LocInfo[1].lc_collate_cp), LVar6 == 0)) {
      _free((void *)(_LocInfo[1].lc_time_cp - 0xfe));
      _free(_LocInfo[1].lc_category[0].wlocale + -0x40);
      _free(_LocInfo[1].lc_category[0].refcount + -0x20);
      _free((void *)_LocInfo[1].lc_collate_cp);
    }
    *local_30 = 1;
    _LocInfo[1].lc_collate_cp = (uint)local_30;
    _LocInfo[1].lc_category[0].locale = (char *)local_44;
    _LocInfo[1].lc_time_cp = (uint)local_40;
    _LocInfo[1].lc_category[0].wlocale = local_48;
    _LocInfo[1].lc_category[0].refcount = local_3c;
    _LocInfo->locale_name[3] = local_34;
  }
  _free(local_28);
LAB_00642a23:
  iVar3 = __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return iVar3;
}



============================================================
DISASSEMBLY
============================================================
00642690 : MOV EDI,EDI
00642692 : PUSH EBP
00642693 : MOV EBP,ESP
00642695 : SUB ESP,0x4c
00642698 : MOV EAX,[0x00d66fa0]
0064269d : XOR EAX,EBP
0064269f : MOV dword ptr [EBP + -0x4],EAX
006426a2 : PUSH EBX
006426a3 : XOR EBX,EBX
006426a5 : PUSH ESI
006426a6 : MOV ESI,dword ptr [EBP + 0x8]
006426a9 : PUSH EDI
006426aa : MOV dword ptr [EBP + -0x2c],EBX
006426ad : MOV dword ptr [EBP + -0x1c],EBX
006426b0 : MOV dword ptr [EBP + -0x20],EBX
006426b3 : MOV dword ptr [EBP + -0x28],EBX
006426b6 : MOV dword ptr [EBP + -0x24],EBX
006426b9 : MOV dword ptr [EBP + -0x4c],ESI
006426bc : MOV dword ptr [EBP + -0x48],EBX
006426bf : CMP dword ptr [ESI + 0x14],EBX
006426c2 : JZ 0x006429de
006426c8 : LEA EAX,[ESI + 0x4]
006426cb : CMP dword ptr [EAX],EBX
006426cd : JNZ 0x006426ef
006426cf : PUSH EAX
006426d0 : MOVZX EAX,word ptr [ESI + 0x30]
006426d4 : PUSH 0x1004
006426d9 : PUSH EAX
006426da : LEA EAX,[EBP + -0x4c]
006426dd : PUSH EBX
006426de : PUSH EAX
006426df : CALL 0x00645c3a
006426e4 : ADD ESP,0x14
006426e7 : TEST EAX,EAX
006426e9 : JNZ 0x006429b6
006426ef : PUSH 0x4
006426f1 : CALL 0x0064255f
006426f6 : PUSH 0x2
006426f8 : MOV EDI,0x180
006426fd : PUSH EDI
006426fe : MOV dword ptr [EBP + -0x2c],EAX
00642701 : CALL 0x006425a4
00642706 : PUSH 0x1
00642708 : PUSH EDI
00642709 : MOV dword ptr [EBP + -0x1c],EAX
0064270c : CALL 0x006425a4
00642711 : PUSH 0x1
00642713 : PUSH EDI
00642714 : MOV dword ptr [EBP + -0x20],EAX
00642717 : CALL 0x006425a4
0064271c : PUSH 0x1
0064271e : PUSH 0x101
00642723 : MOV dword ptr [EBP + -0x28],EAX
00642726 : CALL 0x006425a4
0064272b : ADD ESP,0x24
0064272e : MOV dword ptr [EBP + -0x24],EAX
00642731 : CMP dword ptr [EBP + -0x2c],EBX
00642734 : JZ 0x006429b6
0064273a : CMP dword ptr [EBP + -0x1c],EBX
0064273d : JZ 0x006429b6
00642743 : CMP EAX,EBX
00642745 : JZ 0x006429b6
0064274b : CMP dword ptr [EBP + -0x20],EBX
0064274e : JZ 0x006429b6
00642754 : CMP dword ptr [EBP + -0x28],EBX
00642757 : JZ 0x006429b6
0064275d : MOV EAX,dword ptr [EBP + -0x2c]
00642760 : MOV dword ptr [EAX],EBX
00642762 : XOR EAX,EAX
00642764 : MOV ECX,dword ptr [EBP + -0x24]
00642767 : MOV byte ptr [EAX + ECX*0x1],AL
0064276a : INC EAX
0064276b : CMP EAX,0x100
00642770 : JL 0x00642764
00642772 : LEA EAX,[EBP + -0x18]
00642775 : PUSH EAX
00642776 : PUSH dword ptr [ESI + 0x4]
00642779 : CALL dword ptr [0x00b8529c]
0064277f : TEST EAX,EAX
00642781 : JZ 0x006429b6
00642787 : CMP dword ptr [EBP + -0x18],0x5
0064278b : JA 0x006429b6
00642791 : MOVZX EAX,word ptr [EBP + -0x18]
00642795 : CMP EAX,0x1
00642798 : MOV dword ptr [EBP + -0x30],EAX
0064279b : JLE 0x006427ca
0064279d : CMP byte ptr [EBP + -0x12],BL
006427a0 : JZ 0x006427ca
006427a2 : LEA EAX,[EBP + -0x11]
006427a5 : MOV CL,byte ptr [EAX]
006427a7 : CMP CL,BL
006427a9 : JZ 0x006427ca
006427ab : MOVZX EDI,byte ptr [EAX + -0x1]
006427af : MOVZX ECX,CL
006427b2 : JMP 0x006427bf
006427b4 : MOV ECX,dword ptr [EBP + -0x24]
006427b7 : MOV byte ptr [EDI + ECX*0x1],0x20
006427bb : MOVZX ECX,byte ptr [EAX]
006427be : INC EDI
006427bf : CMP EDI,ECX
006427c1 : JLE 0x006427b4
006427c3 : INC EAX
006427c4 : INC EAX
006427c5 : CMP byte ptr [EAX + -0x1],BL
006427c8 : JNZ 0x006427a5
006427ca : MOV EAX,dword ptr [EBP + -0x1c]
006427cd : PUSH EBX
006427ce : PUSH EBX
006427cf : PUSH dword ptr [ESI + 0x4]
006427d2 : ADD EAX,0x100
006427d7 : PUSH EAX
006427d8 : PUSH 0x100
006427dd : PUSH dword ptr [EBP + -0x24]
006427e0 : MOV dword ptr [EBP + -0x40],EAX
006427e3 : PUSH 0x1
006427e5 : PUSH EBX
006427e6 : CALL 0x00655d21
006427eb : ADD ESP,0x20
006427ee : TEST EAX,EAX
006427f0 : JZ 0x006429b6
006427f6 : MOV ECX,dword ptr [EBP + -0x20]
006427f9 : MOV EAX,dword ptr [EBP + -0x24]
006427fc : PUSH EBX
006427fd : PUSH dword ptr [ESI + 0x4]
00642800 : MOV EDI,0xff
00642805 : PUSH EDI
00642806 : ADD ECX,0x81
0064280c : PUSH ECX
0064280d : PUSH EDI
0064280e : INC EAX
0064280f : PUSH EAX
00642810 : PUSH 0x100
00642815 : PUSH dword ptr [ESI + 0x14]
00642818 : PUSH EBX
00642819 : CALL 0x00643b47
0064281e : ADD ESP,0x24
00642821 : TEST EAX,EAX
00642823 : JZ 0x006429b6
00642829 : MOV EAX,dword ptr [EBP + -0x28]
0064282c : PUSH EBX
0064282d : PUSH dword ptr [ESI + 0x4]
00642830 : ADD EAX,0x81
00642835 : PUSH EDI
00642836 : PUSH EAX
00642837 : MOV EAX,dword ptr [EBP + -0x24]
0064283a : PUSH EDI
0064283b : INC EAX
0064283c : PUSH EAX
0064283d : PUSH 0x200
00642842 : PUSH dword ptr [ESI + 0x14]
00642845 : PUSH EBX
00642846 : CALL 0x00643b47
0064284b : ADD ESP,0x24
0064284e : TEST EAX,EAX
00642850 : JZ 0x006429b6
00642856 : MOV EAX,dword ptr [EBP + -0x1c]
00642859 : MOV EDI,dword ptr [EBP + -0x20]
0064285c : LEA ECX,[EAX + 0xfe]
00642862 : XOR EDX,EDX
00642864 : CMP dword ptr [EBP + -0x30],0x1
00642868 : MOV word ptr [ECX],DX
0064286b : MOV EDX,dword ptr [EBP + -0x28]
0064286e : MOV dword ptr [EBP + -0x3c],ECX
00642871 : LEA ECX,[EDI + 0x80]
00642877 : MOV byte ptr [EDI + 0x7f],BL
0064287a : MOV byte ptr [EDX + 0x7f],BL
0064287d : MOV byte ptr [ECX],BL
0064287f : MOV dword ptr [EBP + -0x44],ECX
00642882 : LEA ECX,[EDX + 0x80]
00642888 : MOV dword ptr [EBP + -0x38],ECX
0064288b : MOV byte ptr [ECX],BL
0064288d : JLE 0x006428e2
0064288f : CMP byte ptr [EBP + -0x12],BL
00642892 : JZ 0x006428e2
00642894 : LEA ECX,[EBP + -0x11]
00642897 : MOV dword ptr [EBP + -0x1c],ECX
0064289a : MOV DL,byte ptr [ECX]
0064289c : CMP DL,BL
0064289e : JZ 0x006428e2
006428a0 : MOVZX ECX,byte ptr [ECX + -0x1]
006428a4 : MOVZX EDX,DL
006428a7 : CMP ECX,EDX
006428a9 : MOV dword ptr [EBP + -0x20],ECX
006428ac : JG 0x006428d5
006428ae : LEA ECX,[EAX + ECX*0x2 + 0x100]
006428b5 : JMP 0x006428ba
006428b7 : MOV ECX,dword ptr [EBP + -0x34]
006428ba : INC dword ptr [EBP + -0x20]
006428bd : MOV EDX,0x8000
006428c2 : MOV word ptr [ECX],DX
006428c5 : INC ECX
006428c6 : INC ECX
006428c7 : MOV dword ptr [EBP + -0x34],ECX
006428ca : MOV ECX,dword ptr [EBP + -0x1c]
006428cd : MOVZX ECX,byte ptr [ECX]
006428d0 : CMP dword ptr [EBP + -0x20],ECX
006428d3 : JLE 0x006428b7
006428d5 : MOV ECX,dword ptr [EBP + -0x1c]
006428d8 : INC ECX
006428d9 : INC ECX
006428da : MOV dword ptr [EBP + -0x1c],ECX
006428dd : CMP byte ptr [ECX + -0x1],BL
006428e0 : JNZ 0x0064289a
006428e2 : PUSH 0xfe
006428e7 : LEA ECX,[EAX + 0x200]
006428ed : PUSH ECX
006428ee : PUSH EAX
006428ef : CALL 0x0063ae40
006428f4 : PUSH 0x7f
006428f6 : LEA EAX,[EDI + 0x100]
006428fc : PUSH EAX
006428fd : PUSH EDI
006428fe : CALL 0x0063ae40
00642903 : MOV EAX,dword ptr [EBP + -0x28]
00642906 : PUSH 0x7f
00642908 : LEA ECX,[EAX + 0x100]
0064290e : PUSH ECX
0064290f : PUSH EAX
00642910 : CALL 0x0063ae40
00642915 : MOV EAX,dword ptr [ESI + 0xc0]
0064291b : ADD ESP,0x24
0064291e : CMP EAX,EBX
00642920 : JZ 0x0064296d
00642922 : PUSH EAX
00642923 : CALL dword ptr [0x00b851b0]
00642929 : TEST EAX,EAX
0064292b : JNZ 0x0064296d
0064292d : MOV EAX,dword ptr [ESI + 0xc4]
00642933 : SUB EAX,0xfe
00642938 : PUSH EAX
00642939 : CALL 0x0063610d
0064293e : MOV EAX,dword ptr [ESI + 0xcc]
00642944 : MOV EDI,0x80
00642949 : SUB EAX,EDI
0064294b : PUSH EAX
0064294c : CALL 0x0063610d
00642951 : MOV EAX,dword ptr [ESI + 0xd0]
00642957 : SUB EAX,EDI
00642959 : PUSH EAX
0064295a : CALL 0x0063610d
0064295f : PUSH dword ptr [ESI + 0xc0]
00642965 : CALL 0x0063610d
0064296a : ADD ESP,0x10
0064296d : MOV EAX,dword ptr [EBP + -0x2c]
00642970 : MOV dword ptr [EAX],0x1
00642976 : MOV dword ptr [ESI + 0xc0],EAX
0064297c : MOV EAX,dword ptr [EBP + -0x40]
0064297f : MOV dword ptr [ESI + 0xc8],EAX
00642985 : MOV EAX,dword ptr [EBP + -0x3c]
00642988 : MOV dword ptr [ESI + 0xc4],EAX
0064298e : MOV EAX,dword ptr [EBP + -0x44]
00642991 : MOV dword ptr [ESI + 0xcc],EAX
00642997 : MOV EAX,dword ptr [EBP + -0x38]
0064299a : MOV dword ptr [ESI + 0xd0],EAX
006429a0 : MOV EAX,dword ptr [EBP + -0x30]
006429a3 : MOV dword ptr [ESI + 0xac],EAX
006429a9 : PUSH dword ptr [EBP + -0x24]
006429ac : CALL 0x0063610d
006429b1 : POP ECX
006429b2 : MOV EAX,EBX
006429b4 : JMP 0x00642a23
006429b6 : PUSH dword ptr [EBP + -0x2c]
006429b9 : CALL 0x0063610d
006429be : PUSH dword ptr [EBP + -0x1c]
006429c1 : CALL 0x0063610d
006429c6 : PUSH dword ptr [EBP + -0x20]
006429c9 : CALL 0x0063610d
006429ce : PUSH dword ptr [EBP + -0x28]
006429d1 : CALL 0x0063610d
006429d6 : XOR EBX,EBX
006429d8 : ADD ESP,0x10
006429db : INC EBX
006429dc : JMP 0x006429a9
006429de : LEA EDI,[ESI + 0xc0]
006429e4 : MOV EAX,dword ptr [EDI]
006429e6 : CMP EAX,EBX
006429e8 : JZ 0x006429f1
006429ea : PUSH EAX
006429eb : CALL dword ptr [0x00b851b0]
006429f1 : MOV dword ptr [EDI],EBX
006429f3 : MOV dword ptr [ESI + 0xc4],EBX
006429f9 : MOV dword ptr [ESI + 0xc8],0xb9b1b8
00642a03 : MOV dword ptr [ESI + 0xcc],0xb9b640
00642a0d : MOV dword ptr [ESI + 0xd0],0xb9b7c0
00642a17 : MOV dword ptr [ESI + 0xac],0x1
00642a21 : XOR EAX,EAX
00642a23 : MOV ECX,dword ptr [EBP + -0x4]
00642a26 : POP EDI
00642a27 : POP ESI
00642a28 : XOR ECX,EBP
00642a2a : POP EBX
00642a2b : CALL 0x00633e6b
00642a30 : LEAVE
00642a31 : RET
