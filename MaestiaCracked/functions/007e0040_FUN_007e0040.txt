PROGRAM  : Maestia.exe
FUNCTION : FUN_007e0040
ENTRY    : 007e0040
BODY     : [[007e0040, 007e032c] [007e0330, 007e03c0]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void FUN_007e0040(int param_1,int *param_2)

{
  uint uVar1;
  int *piVar2;
  int iVar3;
  code *pcVar4;
  undefined4 *puVar5;
  size_t _NumOfElements;
  undefined4 *puVar6;
  int local_10f4 [1024];
  undefined4 local_f4 [16];
  undefined4 local_b4 [17];
  undefined4 local_70 [16];
  float local_30;
  float local_2c;
  float local_28;
  float local_24;
  float local_20;
  float local_1c;
  int local_18;
  undefined4 local_14;
  int *local_10;
  undefined4 *local_c;
  int *local_8;
  
  local_8 = (int *)0x7e004d;
  local_10 = *(int **)(DAT_017251ac + 0x18);
  local_8 = (int *)FUN_007bfd60();
  puVar5 = *(undefined4 **)(param_1 + 0x6c);
  local_c = (undefined4 *)*puVar5;
  _NumOfElements = 0;
  while (local_c != puVar5) {
    if (local_c[3] == 0) {
      iVar3 = 0;
    }
    else {
      iVar3 = local_c[3] + -0x38;
    }
    local_10f4[_NumOfElements] = iVar3;
    _NumOfElements = _NumOfElements + 1;
    FUN_0045d060();
  }
  _qsort(local_10f4,_NumOfElements,4,FUN_007dfa50);
  piVar2 = local_8;
  if (*(int *)(param_1 + 0x70) != 0) {
    if (*(char *)(param_1 + 0x2ba8) == '\0') {
      uVar1 = *(uint *)(DAT_017251ac + 0x20c);
      local_30 = (float)(uVar1 >> 0x10 & 0xff) * 0.003921569;
      local_2c = (float)(uVar1 >> 8 & 0xff) * 0.003921569;
      local_28 = (float)(uVar1 & 0xff) * 0.003921569;
      local_24 = (float)(uVar1 >> 0x18) * 0.003921569;
      local_14 = 0;
      local_20 = 1.0 / (*(float *)(DAT_017251ac + 0x218) - *(float *)(DAT_017251ac + 0x214));
      local_1c = local_20 * -1.0;
      local_18 = param_2[0x16];
      local_20 = local_20 * *(float *)(DAT_017251ac + 0x218);
      (**(code **)(*local_8 + 0x50))(local_8,"vFogColor",&local_30,0x10);
      (**(code **)(*piVar2 + 0x50))(piVar2,"vFogParam",&local_20,0x10);
      FUN_007fb320();
      local_b4[0] = 0;
      if (*(char *)((int)param_2 + 0x157) == '\0') {
        pcVar4 = *(code **)(*param_2 + 0x30);
      }
      else {
        pcVar4 = *(code **)(*param_2 + 0x20);
      }
      (*pcVar4)();
      (**(code **)(*param_2 + 0x1c))();
      D3DXMatrixMultiply(local_70,param_2 + 0x2d,param_2 + 0x1d);
      piVar2 = local_8;
      puVar5 = local_70;
      puVar6 = local_b4;
      for (iVar3 = 0x10; iVar3 != 0; iVar3 = iVar3 + -1) {
        *puVar6 = *puVar5;
        puVar5 = puVar5 + 1;
        puVar6 = puVar6 + 1;
      }
      (**(code **)(*piVar2 + 0x98))(piVar2,"matWVP",local_b4);
      (**(code **)(*local_10 + 0x15c))(local_10,*(undefined4 *)(DAT_01725204 + 0x1c0));
      iVar3 = FUN_007f1e40();
      if (iVar3 != 0) {
        iVar3 = 0;
        if (0 < (int)_NumOfElements) {
          do {
            (**(code **)(*(int *)(local_10f4[iVar3] + 0x38) + 0x28))(param_2);
            iVar3 = iVar3 + 1;
          } while (iVar3 < (int)_NumOfElements);
        }
        iVar3 = param_2[4];
        if (iVar3 != 0) {
          if (param_2[6] != 0) {
            if (*(int *)(iVar3 + 0x1c) != 0) {
              (**(code **)(**(int **)(iVar3 + 0x1c) + 0x108))(*(int **)(iVar3 + 0x1c));
            }
            FUN_0077c620();
            if (*(int *)(param_2[4] + 0x1c) != 0) {
              piVar2 = *(int **)(param_2[4] + 0x1c);
              (**(code **)(*piVar2 + 0x10c))(piVar2);
            }
          }
          param_2[4] = 0;
        }
      }
      if ((*(char *)(param_1 + 0x2ab4) != '\0') && (iVar3 = 0, 0 < (int)_NumOfElements)) {
        do {
          (**(code **)(*(int *)(local_10f4[iVar3] + 0x38) + 0x44))();
          iVar3 = iVar3 + 1;
        } while (iVar3 < (int)_NumOfElements);
      }
    }
    else {
      local_f4[0] = 0;
      if (*(char *)((int)param_2 + 0x157) == '\0') {
        pcVar4 = *(code **)(*param_2 + 0x30);
      }
      else {
        pcVar4 = *(code **)(*param_2 + 0x20);
      }
      (*pcVar4)();
      (**(code **)(*param_2 + 0x1c))();
      D3DXMatrixMultiply(local_70,param_2 + 0x2d,param_2 + 0x1d);
      puVar5 = local_70;
      puVar6 = local_f4;
      for (iVar3 = 0x10; piVar2 = local_8, iVar3 != 0; iVar3 = iVar3 + -1) {
        *puVar6 = *puVar5;
        puVar5 = puVar5 + 1;
        puVar6 = puVar6 + 1;
      }
      (**(code **)(*local_8 + 0x98))(local_8,"matWVP",local_f4);
      (**(code **)(*param_2 + 0x1c))();
      (**(code **)(*piVar2 + 0x98))(piVar2,"matWV",param_2 + 0x2d);
      (**(code **)(*local_10 + 0x15c))(local_10,*(undefined4 *)(DAT_01725204 + 0x1c0));
      iVar3 = 0;
      if (0 < (int)_NumOfElements) {
        do {
          (**(code **)(*(int *)(local_10f4[iVar3] + 0x38) + 0x28))(param_2);
          iVar3 = iVar3 + 1;
        } while (iVar3 < (int)_NumOfElements);
        return;
      }
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
007e0040 : PUSH EBP
007e0041 : MOV EBP,ESP
007e0043 : MOV EAX,0x10f4
007e0048 : CALL 0x0063b780
007e004d : MOV EAX,[0x017251ac]
007e0052 : MOV ECX,dword ptr [EAX + 0x18]
007e0055 : PUSH EBX
007e0056 : MOV EBX,dword ptr [EBP + 0xc]
007e0059 : PUSH ESI
007e005a : MOV ESI,dword ptr [0x01725204]
007e0060 : PUSH EDI
007e0061 : XOR EAX,EAX
007e0063 : MOV dword ptr [EBP + -0xc],ECX
007e0066 : CALL 0x007bfd60
007e006b : MOV EDX,dword ptr [EBP + 0x8]
007e006e : MOV ESI,dword ptr [EDX + 0x6c]
007e0071 : MOV dword ptr [EBP + -0x4],EAX
007e0074 : MOV EAX,dword ptr [ESI]
007e0076 : XOR EDI,EDI
007e0078 : MOV dword ptr [EBP + 0xc],EDI
007e007b : MOV dword ptr [EBP + -0x8],EAX
007e007e : CMP EAX,ESI
007e0080 : JZ 0x007e00aa
007e0082 : MOV EAX,dword ptr [EAX + 0xc]
007e0085 : TEST EAX,EAX
007e0087 : JZ 0x007e008e
007e0089 : ADD EAX,-0x38
007e008c : JMP 0x007e0090
007e008e : XOR EAX,EAX
007e0090 : MOV dword ptr [EBP + EDI*0x4 + 0xffffef10],EAX
007e0097 : LEA EDX,[EBP + -0x8]
007e009a : INC EDI
007e009b : CALL 0x0045d060
007e00a0 : MOV EAX,dword ptr [EBP + -0x8]
007e00a3 : CMP EAX,ESI
007e00a5 : JNZ 0x007e0082
007e00a7 : MOV dword ptr [EBP + 0xc],EDI
007e00aa : PUSH 0x7dfa50
007e00af : PUSH 0x4
007e00b1 : LEA EAX,[EBP + 0xffffef10]
007e00b7 : PUSH EDI
007e00b8 : PUSH EAX
007e00b9 : CALL 0x00635ad0
007e00be : MOV EAX,dword ptr [EBP + 0x8]
007e00c1 : ADD ESP,0x10
007e00c4 : CMP dword ptr [EAX + 0x70],0x0
007e00c8 : JZ 0x007e03b8
007e00ce : CMP byte ptr [EAX + 0x2ba8],0x0
007e00d5 : JZ 0x007e01b1
007e00db : CMP byte ptr [EBX + 0x157],0x0
007e00e2 : XORPS XMM0,XMM0
007e00e5 : MOV EDX,dword ptr [EBX]
007e00e7 : MOVSS dword ptr [EBP + 0xffffff10],XMM0
007e00ef : MOV ECX,EBX
007e00f1 : JZ 0x007e00f8
007e00f3 : MOV EAX,dword ptr [EDX + 0x20]
007e00f6 : JMP 0x007e00fb
007e00f8 : MOV EAX,dword ptr [EDX + 0x30]
007e00fb : CALL EAX
007e00fd : MOV EDX,dword ptr [EBX]
007e00ff : MOV EAX,dword ptr [EDX + 0x1c]
007e0102 : MOV ECX,EBX
007e0104 : CALL EAX
007e0106 : LEA ECX,[EBX + 0x74]
007e0109 : PUSH ECX
007e010a : LEA EAX,[EBX + 0xb4]
007e0110 : PUSH EAX
007e0111 : LEA EDX,[EBP + -0x6c]
007e0114 : PUSH EDX
007e0115 : CALL 0x004ff752
007e011a : MOV ECX,0x10
007e011f : LEA ESI,[EBP + -0x6c]
007e0122 : LEA EDI,[EBP + 0xffffff10]
007e0128 : MOVSD.REP ES:EDI,ESI
007e012a : MOV ESI,dword ptr [EBP + -0x4]
007e012d : MOV EAX,dword ptr [ESI]
007e012f : MOV EDX,dword ptr [EAX + 0x98]
007e0135 : LEA ECX,[EBP + 0xffffff10]
007e013b : PUSH ECX
007e013c : PUSH 0xc22d54
007e0141 : PUSH ESI
007e0142 : CALL EDX
007e0144 : MOV EAX,dword ptr [EBX]
007e0146 : MOV EDX,dword ptr [EAX + 0x1c]
007e0149 : MOV ECX,EBX
007e014b : CALL EDX
007e014d : MOV ECX,dword ptr [ESI]
007e014f : MOV EDX,dword ptr [ECX + 0x98]
007e0155 : LEA EAX,[EBX + 0xb4]
007e015b : PUSH EAX
007e015c : PUSH 0xc22d5c
007e0161 : PUSH ESI
007e0162 : CALL EDX
007e0164 : MOV EDX,dword ptr [0x01725204]
007e016a : MOV EAX,dword ptr [EBP + -0xc]
007e016d : MOV EDX,dword ptr [EDX + 0x1c0]
007e0173 : MOV ECX,dword ptr [EAX]
007e0175 : PUSH EDX
007e0176 : PUSH EAX
007e0177 : MOV EAX,dword ptr [ECX + 0x15c]
007e017d : CALL EAX
007e017f : MOV EDI,dword ptr [EBP + 0xc]
007e0182 : XOR ESI,ESI
007e0184 : TEST EDI,EDI
007e0186 : JLE 0x007e03b8
007e018c : LEA ESP,[ESP]
007e0190 : MOV EAX,dword ptr [EBP + ESI*0x4 + 0xffffef10]
007e0197 : MOV EDX,dword ptr [EAX + 0x38]
007e019a : LEA ECX,[EAX + 0x38]
007e019d : MOV EAX,dword ptr [EDX + 0x28]
007e01a0 : PUSH EBX
007e01a1 : CALL EAX
007e01a3 : INC ESI
007e01a4 : CMP ESI,EDI
007e01a6 : JL 0x007e0190
007e01a8 : POP EDI
007e01a9 : POP ESI
007e01aa : POP EBX
007e01ab : MOV ESP,EBP
007e01ad : POP EBP
007e01ae : RET 0x8
007e01b1 : MOV ESI,dword ptr [0x017251ac]
007e01b7 : MOV EAX,dword ptr [ESI + 0x20c]
007e01bd : MOVSS XMM0,dword ptr [0x00cdf178]
007e01c5 : XORPS XMM2,XMM2
007e01c8 : MOV ECX,EAX
007e01ca : SHR ECX,0x10
007e01cd : MOVZX EDX,CL
007e01d0 : MOV ECX,EAX
007e01d2 : SHR ECX,0x8
007e01d5 : CVTSI2SS XMM1,EDX
007e01d9 : MULSS XMM1,XMM0
007e01dd : MOVSS dword ptr [EBP + -0x2c],XMM1
007e01e2 : MOVZX EDX,CL
007e01e5 : MOVZX ECX,AL
007e01e8 : CVTSI2SS XMM1,EDX
007e01ec : MULSS XMM1,XMM0
007e01f0 : MOVSS dword ptr [EBP + -0x28],XMM1
007e01f5 : CVTSI2SS XMM1,ECX
007e01f9 : MULSS XMM1,XMM0
007e01fd : MOVSS dword ptr [EBP + -0x24],XMM1
007e0202 : SHR EAX,0x18
007e0205 : CVTSI2SS XMM1,EAX
007e0209 : MULSS XMM1,XMM0
007e020d : MOVSS XMM0,dword ptr [ESI + 0x214]
007e0215 : MOVSS dword ptr [EBP + -0x10],XMM2
007e021a : MOVSS dword ptr [EBP + -0x20],XMM1
007e021f : MOVSS XMM1,dword ptr [ESI + 0x218]
007e0227 : MOV ESI,dword ptr [EBP + -0x4]
007e022a : MOV EDX,dword ptr [ESI]
007e022c : MOV ECX,dword ptr [EDX + 0x50]
007e022f : PUSH 0x10
007e0231 : MOVAPS XMM2,XMM1
007e0234 : SUBSS XMM2,XMM0
007e0238 : MOVSS XMM0,dword ptr [0x00c10fc4]
007e0240 : DIVSS XMM0,XMM2
007e0244 : LEA EAX,[EBP + -0x2c]
007e0247 : MOVAPS XMM2,XMM0
007e024a : MULSS XMM0,dword ptr [0x00cdf0d0]
007e0252 : PUSH EAX
007e0253 : PUSH 0xc22d64
007e0258 : MOVSS dword ptr [EBP + -0x18],XMM0
007e025d : MOVSS XMM0,dword ptr [EBX + 0x58]
007e0262 : MULSS XMM2,XMM1
007e0266 : PUSH ESI
007e0267 : MOVSS dword ptr [EBP + -0x1c],XMM2
007e026c : MOVSS dword ptr [EBP + -0x14],XMM0
007e0271 : CALL ECX
007e0273 : MOV EDX,dword ptr [ESI]
007e0275 : MOV ECX,dword ptr [EDX + 0x50]
007e0278 : PUSH 0x10
007e027a : LEA EAX,[EBP + -0x1c]
007e027d : PUSH EAX
007e027e : PUSH 0xc22d70
007e0283 : PUSH ESI
007e0284 : CALL ECX
007e0286 : MOV ECX,dword ptr [0x017251ac]
007e028c : XOR AL,AL
007e028e : CALL 0x007fb320
007e0293 : CMP byte ptr [EBX + 0x157],0x0
007e029a : XORPS XMM0,XMM0
007e029d : MOV EDX,dword ptr [EBX]
007e029f : MOVSS dword ptr [EBP + 0xffffff50],XMM0
007e02a7 : MOV ECX,EBX
007e02a9 : JZ 0x007e02b0
007e02ab : MOV EAX,dword ptr [EDX + 0x20]
007e02ae : JMP 0x007e02b3
007e02b0 : MOV EAX,dword ptr [EDX + 0x30]
007e02b3 : CALL EAX
007e02b5 : MOV EDX,dword ptr [EBX]
007e02b7 : MOV EAX,dword ptr [EDX + 0x1c]
007e02ba : MOV ECX,EBX
007e02bc : CALL EAX
007e02be : LEA ECX,[EBX + 0x74]
007e02c1 : PUSH ECX
007e02c2 : LEA EDX,[EBX + 0xb4]
007e02c8 : PUSH EDX
007e02c9 : LEA EAX,[EBP + -0x6c]
007e02cc : PUSH EAX
007e02cd : CALL 0x004ff752
007e02d2 : MOV EAX,dword ptr [EBP + -0x4]
007e02d5 : LEA EDX,[EBP + 0xffffff50]
007e02db : PUSH EDX
007e02dc : MOV ECX,0x10
007e02e1 : LEA ESI,[EBP + -0x6c]
007e02e4 : LEA EDI,[EBP + 0xffffff50]
007e02ea : MOVSD.REP ES:EDI,ESI
007e02ec : MOV ECX,dword ptr [EAX]
007e02ee : PUSH 0xc22d7c
007e02f3 : PUSH EAX
007e02f4 : MOV EAX,dword ptr [ECX + 0x98]
007e02fa : CALL EAX
007e02fc : MOV EDX,dword ptr [0x01725204]
007e0302 : MOV EAX,dword ptr [EBP + -0xc]
007e0305 : MOV EDX,dword ptr [EDX + 0x1c0]
007e030b : MOV ECX,dword ptr [EAX]
007e030d : PUSH EDX
007e030e : PUSH EAX
007e030f : MOV EAX,dword ptr [ECX + 0x15c]
007e0315 : CALL EAX
007e0317 : MOV EDI,EBX
007e0319 : CALL 0x007f1e40
007e031e : MOV EDI,dword ptr [EBP + 0xc]
007e0321 : TEST EAX,EAX
007e0323 : JZ 0x007e038f
007e0325 : XOR ESI,ESI
007e0327 : TEST EDI,EDI
007e0329 : JLE 0x007e0348
007e032b : JMP 0x007e0330
007e0330 : MOV EAX,dword ptr [EBP + ESI*0x4 + 0xffffef10]
007e0337 : MOV EDX,dword ptr [EAX + 0x38]
007e033a : LEA ECX,[EAX + 0x38]
007e033d : MOV EAX,dword ptr [EDX + 0x28]
007e0340 : PUSH EBX
007e0341 : CALL EAX
007e0343 : INC ESI
007e0344 : CMP ESI,EDI
007e0346 : JL 0x007e0330
007e0348 : MOV EAX,dword ptr [EBX + 0x10]
007e034b : TEST EAX,EAX
007e034d : JZ 0x007e038f
007e034f : CMP dword ptr [EBX + 0x18],0x0
007e0353 : JZ 0x007e0388
007e0355 : CMP dword ptr [EAX + 0x1c],0x0
007e0359 : JZ 0x007e0369
007e035b : MOV EAX,dword ptr [EAX + 0x1c]
007e035e : MOV ECX,dword ptr [EAX]
007e0360 : MOV EDX,dword ptr [ECX + 0x108]
007e0366 : PUSH EAX
007e0367 : CALL EDX
007e0369 : MOV EAX,dword ptr [EBX + 0x10]
007e036c : CALL 0x0077c620
007e0371 : MOV EAX,dword ptr [EBX + 0x10]
007e0374 : CMP dword ptr [EAX + 0x1c],0x0
007e0378 : JZ 0x007e0388
007e037a : MOV EAX,dword ptr [EAX + 0x1c]
007e037d : MOV ECX,dword ptr [EAX]
007e037f : MOV EDX,dword ptr [ECX + 0x10c]
007e0385 : PUSH EAX
007e0386 : CALL EDX
007e0388 : MOV dword ptr [EBX + 0x10],0x0
007e038f : MOV EAX,dword ptr [EBP + 0x8]
007e0392 : CMP byte ptr [EAX + 0x2ab4],0x0
007e0399 : JZ 0x007e03b8
007e039b : XOR ESI,ESI
007e039d : TEST EDI,EDI
007e039f : JLE 0x007e03b8
007e03a1 : MOV EAX,dword ptr [EBP + ESI*0x4 + 0xffffef10]
007e03a8 : MOV EDX,dword ptr [EAX + 0x38]
007e03ab : LEA ECX,[EAX + 0x38]
007e03ae : MOV EAX,dword ptr [EDX + 0x44]
007e03b1 : CALL EAX
007e03b3 : INC ESI
007e03b4 : CMP ESI,EDI
007e03b6 : JL 0x007e03a1
007e03b8 : POP EDI
007e03b9 : POP ESI
007e03ba : POP EBX
007e03bb : MOV ESP,EBP
007e03bd : POP EBP
007e03be : RET 0x8
