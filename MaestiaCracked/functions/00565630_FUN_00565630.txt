PROGRAM  : Maestia.exe
FUNCTION : FUN_00565630
ENTRY    : 00565630
BODY     : [[00565630, 005657e5]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00565630(int param_1,GRefCountImpl *param_2,GRefCountImpl *param_3,uint param_4,
                 undefined4 param_5,int param_6,undefined4 param_7,undefined4 param_8)

{
  undefined4 uVar1;
  int iVar2;
  LONG LVar3;
  int iVar4;
  undefined4 *in_ECX;
  undefined *puVar5;
  uint local_24;
  uint local_20 [8];
  
  *in_ECX = &PTR_LAB_00b85fe8;
  in_ECX[1] = 1;
  in_ECX[2] = 0;
  in_ECX[3] = &PTR_FUN_00b86ce4;
  *in_ECX = &PTR_FUN_00b8cb68;
  in_ECX[3] = &PTR_LAB_00b8cb50;
  in_ECX[4] = 0;
  in_ECX[5] = 0;
  in_ECX[6] = 0;
  in_ECX[7] = 0;
  iVar2 = param_6;
  if (param_6 == 0) {
    puVar5 = &DAT_00b8ba98;
    uVar1 = FUN_005e9ce0((*(uint *)(*(int *)(param_1 + 0x20) + 0x24) & 0xfffffffc) + 8,&DAT_00b8ba98
                        );
    FUN_0051c4c0("MovieDef  \"",uVar1,puVar5);
    local_20[2] = 0x1000;
    local_20[3] = 0x1000;
    local_20[0] = param_4 >> 0x10 & 0x1000;
    local_20[7] = param_8;
    local_20[1] = 0x10;
    local_20[4] = 0xffffffff;
    local_20[5] = 0;
    local_20[6] = 2;
    iVar2 = FUN_00516140((local_24 & 0xfffffffc) + 8,local_20);
    LVar3 = InterlockedExchangeAdd((LONG *)((local_24 & 0xfffffffc) + 4),-1);
    if (LVar3 == 1) {
      FUN_00515cf0(local_24 & 0xfffffffc);
    }
  }
  iVar4 = FUN_00515840(0x88,0);
  if (iVar4 == 0) {
    uVar1 = 0;
  }
  else {
    uVar1 = FUN_005648a0(iVar2,param_1,in_ECX,param_4,param_7);
  }
  if ((GRefCountImpl *)in_ECX[7] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)in_ECX[7]);
  }
  in_ECX[7] = uVar1;
  if (param_6 == 0) {
    FUN_0067df70(uVar1);
  }
  if (param_3 != (GRefCountImpl *)0x0) {
    GRefCountImpl::AddRef(param_3);
  }
  if ((GRefCountImpl *)in_ECX[5] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)in_ECX[5]);
  }
  in_ECX[5] = param_3;
  if (param_2 != (GRefCountImpl *)0x0) {
    GRefCountImpl::AddRef(param_2);
  }
  if ((GRefCountImpl *)in_ECX[6] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)in_ECX[6]);
  }
  in_ECX[6] = param_2;
  iVar2 = FUN_00515840(0x34,0);
  if (iVar2 == 0) {
    uVar1 = 0;
  }
  else {
    uVar1 = FUN_00514f10(param_5);
  }
  if ((GRefCountImpl *)in_ECX[4] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)in_ECX[4]);
  }
  in_ECX[4] = uVar1;
  return;
}



============================================================
DISASSEMBLY
============================================================
00565630 : SUB ESP,0x24
00565633 : PUSH EBX
00565634 : MOV EBX,dword ptr [ESP + 0x40]
00565638 : PUSH EBP
00565639 : MOV EBP,dword ptr [ESP + 0x3c]
0056563d : PUSH ESI
0056563e : MOV ESI,ECX
00565640 : MOV dword ptr [ESI],0xb85fe8
00565646 : MOV dword ptr [ESI + 0x4],0x1
0056564d : PUSH EDI
0056564e : XOR EDI,EDI
00565650 : MOV dword ptr [ESI + 0x8],EDI
00565653 : MOV dword ptr [ESI + 0xc],0xb86ce4
0056565a : MOV dword ptr [ESI],0xb8cb68
00565660 : MOV dword ptr [ESI + 0xc],0xb8cb50
00565667 : MOV dword ptr [ESI + 0x10],EDI
0056566a : MOV dword ptr [ESI + 0x14],EDI
0056566d : MOV dword ptr [ESI + 0x18],EDI
00565670 : MOV dword ptr [ESI + 0x1c],EDI
00565673 : CMP EBX,EDI
00565675 : JNZ 0x00565721
0056567b : MOV EAX,dword ptr [ESP + 0x38]
0056567f : MOV ECX,dword ptr [EAX + 0x20]
00565682 : MOV EAX,dword ptr [ECX + 0x24]
00565685 : AND EAX,0xfffffffc
00565688 : ADD EAX,0x8
0056568b : PUSH 0xb8ba98
00565690 : PUSH EAX
00565691 : CALL 0x005e9ce0
00565696 : ADD ESP,0x4
00565699 : PUSH EAX
0056569a : PUSH 0xb8cbec
0056569f : LEA ECX,[ESP + 0x1c]
005656a3 : CALL 0x0051c4c0
005656a8 : MOV EAX,0x1000
005656ad : MOV EDX,EBP
005656af : MOV dword ptr [ESP + 0x1c],EAX
005656b3 : MOV dword ptr [ESP + 0x20],EAX
005656b7 : SHR EDX,0x10
005656ba : AND EDX,EAX
005656bc : MOV EAX,dword ptr [ESP + 0x54]
005656c0 : MOV dword ptr [ESP + 0x30],EAX
005656c4 : MOV EAX,dword ptr [ESP + 0x10]
005656c8 : AND EAX,0xfffffffc
005656cb : LEA ECX,[ESP + 0x14]
005656cf : PUSH ECX
005656d0 : MOV ECX,dword ptr [0x00d73250]
005656d6 : ADD EAX,0x8
005656d9 : PUSH EAX
005656da : MOV dword ptr [ESP + 0x1c],EDX
005656de : MOV dword ptr [ESP + 0x20],0x10
005656e6 : MOV dword ptr [ESP + 0x2c],0xffffffff
005656ee : MOV dword ptr [ESP + 0x30],EDI
005656f2 : MOV dword ptr [ESP + 0x34],0x2
005656fa : CALL 0x00516140
005656ff : MOV EDI,dword ptr [ESP + 0x10]
00565703 : AND EDI,0xfffffffc
00565706 : PUSH -0x1
00565708 : LEA EDX,[EDI + 0x4]
0056570b : PUSH EDX
0056570c : MOV EBX,EAX
0056570e : CALL dword ptr [0x00b851cc]
00565714 : SUB EAX,0x1
00565717 : JNZ 0x0056571f
00565719 : PUSH EDI
0056571a : CALL 0x00515cf0
0056571f : XOR EDI,EDI
00565721 : PUSH EDI
00565722 : PUSH 0x88
00565727 : MOV ECX,EBX
00565729 : CALL 0x00515840
0056572e : CMP EAX,EDI
00565730 : JZ 0x0056574a
00565732 : MOV ECX,dword ptr [ESP + 0x50]
00565736 : MOV EDX,dword ptr [ESP + 0x38]
0056573a : PUSH ECX
0056573b : PUSH EBP
0056573c : PUSH ESI
0056573d : PUSH EDX
0056573e : PUSH EBX
0056573f : MOV ECX,EAX
00565741 : CALL 0x005648a0
00565746 : MOV EBP,EAX
00565748 : JMP 0x0056574c
0056574a : XOR EBP,EBP
0056574c : MOV ECX,dword ptr [ESI + 0x1c]
0056574f : CMP ECX,EDI
00565751 : JZ 0x00565758
00565753 : CALL 0x004ff7e0
00565758 : MOV dword ptr [ESI + 0x1c],EBP
0056575b : CMP dword ptr [ESP + 0x4c],EDI
0056575f : JNZ 0x0056576b
00565761 : MOV EAX,EBP
00565763 : PUSH EAX
00565764 : MOV ECX,EBX
00565766 : CALL 0x0067df70
0056576b : MOV EBX,dword ptr [ESP + 0x40]
0056576f : CMP EBX,EDI
00565771 : JZ 0x0056577a
00565773 : MOV ECX,EBX
00565775 : CALL 0x00523dd0
0056577a : MOV ECX,dword ptr [ESI + 0x14]
0056577d : CMP ECX,EDI
0056577f : JZ 0x00565786
00565781 : CALL 0x004ff7e0
00565786 : MOV dword ptr [ESI + 0x14],EBX
00565789 : MOV EBX,dword ptr [ESP + 0x3c]
0056578d : CMP EBX,EDI
0056578f : JZ 0x00565798
00565791 : MOV ECX,EBX
00565793 : CALL 0x00523dd0
00565798 : MOV ECX,dword ptr [ESI + 0x18]
0056579b : CMP ECX,EDI
0056579d : JZ 0x005657a4
0056579f : CALL 0x004ff7e0
005657a4 : PUSH EDI
005657a5 : MOV dword ptr [ESI + 0x18],EBX
005657a8 : MOV ECX,dword ptr [0x00d73250]
005657ae : PUSH 0x34
005657b0 : CALL 0x00515840
005657b5 : CMP EAX,EDI
005657b7 : JZ 0x005657c9
005657b9 : MOV ECX,dword ptr [ESP + 0x48]
005657bd : PUSH ECX
005657be : MOV ECX,EAX
005657c0 : CALL 0x00514f10
005657c5 : MOV EBX,EAX
005657c7 : JMP 0x005657cb
005657c9 : XOR EBX,EBX
005657cb : MOV ECX,dword ptr [ESI + 0x10]
005657ce : CMP ECX,EDI
005657d0 : JZ 0x005657d7
005657d2 : CALL 0x004ff7e0
005657d7 : POP EDI
005657d8 : MOV dword ptr [ESI + 0x10],EBX
005657db : MOV EAX,ESI
005657dd : POP ESI
005657de : POP EBP
005657df : POP EBX
005657e0 : ADD ESP,0x24
005657e3 : RET 0x20
