PROGRAM  : Maestia.exe
FUNCTION : __crtGetLocaleInfoA_stat
ENTRY    : 0065c5b1
BODY     : [[0065c5b1, 0065c6ef]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __alloca_probe_16 replaced with injection: alloca_probe */
/* Library Function - Single Match
    int __cdecl __crtGetLocaleInfoA_stat(struct localeinfo_struct *,unsigned long,unsigned long,char
   *,int,int)
   
   Library: Visual Studio 2008 Release */

int __cdecl
__crtGetLocaleInfoA_stat
          (localeinfo_struct *param_1,ulong param_2,ulong param_3,char *param_4,int param_5,
          int param_6)

{
  uint _Size;
  uint uVar1;
  int iVar2;
  DWORD DVar3;
  uint cchData;
  LPWSTR lpLCData;
  
  uVar1 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  if (DAT_00d7c324 == 0) {
    iVar2 = GetLocaleInfoW(0,1,(LPWSTR)0x0,0);
    if (iVar2 == 0) {
      DVar3 = GetLastError();
      if (DVar3 == 0x78) {
        DAT_00d7c324 = 2;
      }
      goto LAB_0065c605;
    }
    DAT_00d7c324 = 1;
  }
  else {
LAB_0065c605:
    if ((DAT_00d7c324 == 2) || (DAT_00d7c324 == 0)) {
      GetLocaleInfoA(param_2,param_3,param_4,param_5);
      goto LAB_0065c6de;
    }
    if (DAT_00d7c324 != 1) goto LAB_0065c6de;
  }
  if (param_6 == 0) {
    param_6 = param_1->locinfo->lc_codepage;
  }
  cchData = GetLocaleInfoW(param_2,param_3,(LPWSTR)0x0,0);
  if (cchData != 0) {
    if (((int)cchData < 1) || (0xffffffe0 / cchData < 2)) {
      lpLCData = (LPWSTR)0x0;
    }
    else {
      _Size = cchData * 2 + 8;
      if (_Size < 0x401) {
        if (&stack0x00000000 == &DAT_00000018) goto LAB_0065c6de;
        lpLCData = (LPWSTR)&stack0xfffffff0;
      }
      else {
        lpLCData = _malloc(_Size);
        if (lpLCData != (LPWSTR)0x0) {
          lpLCData[0] = L'\xdddd';
          lpLCData[1] = L'\0';
          lpLCData = lpLCData + 4;
        }
      }
    }
    if (lpLCData != (LPWSTR)0x0) {
      iVar2 = GetLocaleInfoW(param_2,param_3,lpLCData,cchData);
      if (iVar2 != 0) {
        if (param_5 == 0) {
          param_5 = 0;
          param_4 = (LPSTR)0x0;
        }
        WideCharToMultiByte(param_6,0,lpLCData,-1,param_4,param_5,(LPCSTR)0x0,(LPBOOL)0x0);
      }
      FUN_0040dc20(lpLCData);
    }
  }
LAB_0065c6de:
  iVar2 = __security_check_cookie(uVar1 ^ (uint)&stack0xfffffffc);
  return iVar2;
}



============================================================
DISASSEMBLY
============================================================
0065c5b1 : MOV EDI,EDI
0065c5b3 : PUSH EBP
0065c5b4 : MOV EBP,ESP
0065c5b6 : PUSH ECX
0065c5b7 : PUSH ECX
0065c5b8 : MOV EAX,[0x00d66fa0]
0065c5bd : XOR EAX,EBP
0065c5bf : MOV dword ptr [EBP + -0x4],EAX
0065c5c2 : MOV EAX,[0x00d7c324]
0065c5c7 : PUSH EBX
0065c5c8 : MOV EBX,dword ptr [0x00b851d8]
0065c5ce : PUSH ESI
0065c5cf : PUSH EDI
0065c5d0 : XOR EDI,EDI
0065c5d2 : XOR ESI,ESI
0065c5d4 : INC EDI
0065c5d5 : CMP EAX,ESI
0065c5d7 : JNZ 0x0065c605
0065c5d9 : PUSH ESI
0065c5da : PUSH ESI
0065c5db : PUSH EDI
0065c5dc : PUSH ESI
0065c5dd : CALL EBX
0065c5df : TEST EAX,EAX
0065c5e1 : JZ 0x0065c5eb
0065c5e3 : MOV dword ptr [0x00d7c324],EDI
0065c5e9 : JMP 0x0065c61a
0065c5eb : CALL dword ptr [0x00b85128]
0065c5f1 : CMP EAX,0x78
0065c5f4 : JNZ 0x0065c600
0065c5f6 : PUSH 0x2
0065c5f8 : POP EAX
0065c5f9 : MOV [0x00d7c324],EAX
0065c5fe : JMP 0x0065c605
0065c600 : MOV EAX,[0x00d7c324]
0065c605 : CMP EAX,0x2
0065c608 : JZ 0x0065c6cc
0065c60e : CMP EAX,ESI
0065c610 : JZ 0x0065c6cc
0065c616 : CMP EAX,EDI
0065c618 : JNZ 0x0065c63d
0065c61a : CMP dword ptr [EBP + 0x1c],ESI
0065c61d : JNZ 0x0065c62a
0065c61f : MOV EAX,dword ptr [EBP + 0x8]
0065c622 : MOV EAX,dword ptr [EAX]
0065c624 : MOV EAX,dword ptr [EAX + 0x4]
0065c627 : MOV dword ptr [EBP + 0x1c],EAX
0065c62a : PUSH ESI
0065c62b : PUSH ESI
0065c62c : PUSH dword ptr [EBP + 0x10]
0065c62f : PUSH dword ptr [EBP + 0xc]
0065c632 : CALL EBX
0065c634 : MOV ECX,EAX
0065c636 : MOV dword ptr [EBP + -0x8],ECX
0065c639 : CMP ECX,ESI
0065c63b : JNZ 0x0065c644
0065c63d : XOR EAX,EAX
0065c63f : JMP 0x0065c6de
0065c644 : JLE 0x0065c68b
0065c646 : PUSH -0x20
0065c648 : XOR EDX,EDX
0065c64a : POP EAX
0065c64b : DIV ECX
0065c64d : CMP EAX,0x2
0065c650 : JC 0x0065c68b
0065c652 : LEA EAX,[ECX + ECX*0x1 + 0x8]
0065c656 : CMP EAX,0x400
0065c65b : JA 0x0065c673
0065c65d : CALL 0x0065bd80
0065c662 : MOV EDI,ESP
0065c664 : CMP EDI,ESI
0065c666 : JZ 0x0065c63d
0065c668 : MOV dword ptr [EDI],0xcccc
0065c66e : ADD EDI,0x8
0065c671 : JMP 0x0065c68d
0065c673 : PUSH EAX
0065c674 : CALL 0x00636043
0065c679 : POP ECX
0065c67a : CMP EAX,ESI
0065c67c : JZ 0x0065c687
0065c67e : MOV dword ptr [EAX],0xdddd
0065c684 : ADD EAX,0x8
0065c687 : MOV EDI,EAX
0065c689 : JMP 0x0065c68d
0065c68b : XOR EDI,EDI
0065c68d : CMP EDI,ESI
0065c68f : JZ 0x0065c63d
0065c691 : PUSH dword ptr [EBP + -0x8]
0065c694 : PUSH EDI
0065c695 : PUSH dword ptr [EBP + 0x10]
0065c698 : PUSH dword ptr [EBP + 0xc]
0065c69b : CALL EBX
0065c69d : TEST EAX,EAX
0065c69f : JZ 0x0065c6c1
0065c6a1 : PUSH ESI
0065c6a2 : PUSH ESI
0065c6a3 : CMP dword ptr [EBP + 0x18],ESI
0065c6a6 : JNZ 0x0065c6ac
0065c6a8 : PUSH ESI
0065c6a9 : PUSH ESI
0065c6aa : JMP 0x0065c6b2
0065c6ac : PUSH dword ptr [EBP + 0x18]
0065c6af : PUSH dword ptr [EBP + 0x14]
0065c6b2 : PUSH -0x1
0065c6b4 : PUSH EDI
0065c6b5 : PUSH ESI
0065c6b6 : PUSH dword ptr [EBP + 0x1c]
0065c6b9 : CALL dword ptr [0x00b85130]
0065c6bf : MOV ESI,EAX
0065c6c1 : PUSH EDI
0065c6c2 : CALL 0x0040dc20
0065c6c7 : POP ECX
0065c6c8 : MOV EAX,ESI
0065c6ca : JMP 0x0065c6de
0065c6cc : PUSH dword ptr [EBP + 0x18]
0065c6cf : PUSH dword ptr [EBP + 0x14]
0065c6d2 : PUSH dword ptr [EBP + 0x10]
0065c6d5 : PUSH dword ptr [EBP + 0xc]
0065c6d8 : CALL dword ptr [0x00b852d4]
0065c6de : LEA ESP,[EBP + -0x14]
0065c6e1 : POP EDI
0065c6e2 : POP ESI
0065c6e3 : POP EBX
0065c6e4 : MOV ECX,dword ptr [EBP + -0x4]
0065c6e7 : XOR ECX,EBP
0065c6e9 : CALL 0x00633e6b
0065c6ee : LEAVE
0065c6ef : RET
