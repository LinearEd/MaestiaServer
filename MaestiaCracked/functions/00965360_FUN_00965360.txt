PROGRAM  : Maestia.exe
FUNCTION : FUN_00965360
ENTRY    : 00965360
BODY     : [[00965360, 009654b3]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00965360(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4)

{
  int *piVar1;
  int iVar2;
  uint uVar3;
  undefined4 uVar4;
  int in_ECX;
  undefined1 local_30 [28];
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  uVar4 = param_4;
  iVar2 = DAT_00d7c54c;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b53ead;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  *(undefined4 *)(in_ECX + 0x80) = param_1;
  *(undefined2 *)(in_ECX + 0x84) = (undefined2)param_2;
  *(undefined2 *)(in_ECX + 0x86) = (undefined2)param_3;
  *(short *)(in_ECX + 0x88) = (short)param_4;
  param_4 = *(undefined4 *)(in_ECX + 0x70);
  FUN_004437f0(&param_4);
  if (((local_14 == *(int *)(iVar2 + 0x44)) || (*(int *)(local_14 + 0x10) == 0)) ||
     (*(short *)(*(int *)(local_14 + 0x10) + 0x44) != 0)) {
    FUN_009640a0(in_ECX,param_1,param_2,param_3,uVar4);
  }
  else if (((DAT_0172491c != 0) && (*DAT_00da9894 != 0)) && (*(int *)(*DAT_00da9894 + 0x1a8) != 0))
  {
    FUN_00406460(L"IDS_CAN_NOT_SELL_ITEM_IN_STORE");
    local_8 = 0;
    piVar1 = *(int **)(*DAT_00da9894 + 0x1a8);
    uVar4 = FUN_0081d120(local_30);
    local_8._0_1_ = 1;
    (**(code **)(*piVar1 + 0x44))(uVar4,3,uVar3);
    local_8 = (uint)local_8._1_3_ << 8;
    FUN_00406560();
    local_8 = 0xffffffff;
    FUN_00406560();
    ExceptionList = local_10;
    return;
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00965360 : PUSH EBP
00965361 : MOV EBP,ESP
00965363 : PUSH -0x1
00965365 : PUSH 0xb53ead
0096536a : MOV EAX,FS:[0x0]
00965370 : PUSH EAX
00965371 : SUB ESP,0x3c
00965374 : PUSH EBX
00965375 : PUSH ESI
00965376 : PUSH EDI
00965377 : MOV EAX,[0x00d66fa0]
0096537c : XOR EAX,EBP
0096537e : PUSH EAX
0096537f : LEA EAX,[EBP + -0xc]
00965382 : MOV FS:[0x0],EAX
00965388 : MOV EBX,dword ptr [EBP + 0x14]
0096538b : MOV ESI,ECX
0096538d : MOV EAX,dword ptr [EBP + 0x8]
00965390 : MOV CX,word ptr [EBP + 0xc]
00965394 : MOV DX,word ptr [EBP + 0x10]
00965398 : MOV EDI,dword ptr [0x00d7c54c]
0096539e : MOV dword ptr [ESI + 0x80],EAX
009653a4 : MOV EAX,dword ptr [ESI + 0x70]
009653a7 : MOV word ptr [ESI + 0x84],CX
009653ae : LEA ECX,[EBP + 0x14]
009653b1 : MOV dword ptr [EBP + 0x14],EAX
009653b4 : PUSH ECX
009653b5 : LEA ECX,[EDI + 0x40]
009653b8 : LEA EAX,[EBP + -0x10]
009653bb : MOV word ptr [ESI + 0x86],DX
009653c2 : MOV word ptr [ESI + 0x88],BX
009653c9 : CALL 0x004437f0
009653ce : MOV EDI,dword ptr [EDI + 0x44]
009653d1 : MOV EAX,dword ptr [EBP + -0x10]
009653d4 : CMP EAX,EDI
009653d6 : JZ 0x0096548d
009653dc : MOV EAX,dword ptr [EAX + 0x10]
009653df : TEST EAX,EAX
009653e1 : JZ 0x0096548d
009653e7 : CMP word ptr [EAX + 0x44],0x0
009653ec : JA 0x0096548d
009653f2 : CMP dword ptr [0x0172491c],0x0
009653f9 : JZ 0x009654a0
009653ff : MOV EDX,dword ptr [0x00da9894]
00965405 : MOV EAX,dword ptr [EDX]
00965407 : TEST EAX,EAX
00965409 : JZ 0x009654a0
0096540f : CMP dword ptr [EAX + 0x1a8],0x0
00965416 : JZ 0x009654a0
0096541c : PUSH 0xc7a23c
00965421 : LEA ECX,[EBP + -0x2c]
00965424 : CALL 0x00406460
00965429 : MOV dword ptr [EBP + -0x4],0x0
00965430 : MOV EAX,[0x00da9894]
00965435 : MOV EAX,dword ptr [EAX]
00965437 : MOV ESI,dword ptr [EAX + 0x1a8]
0096543d : LEA ECX,[EBP + -0x2c]
00965440 : PUSH ECX
00965441 : MOV ECX,dword ptr [0x0172491c]
00965447 : LEA EDI,[EBP + -0x48]
0096544a : CALL 0x0081d120
0096544f : MOV byte ptr [EBP + -0x4],0x1
00965453 : MOV EDX,dword ptr [ESI]
00965455 : PUSH 0x3
00965457 : PUSH EAX
00965458 : MOV EAX,dword ptr [EDX + 0x44]
0096545b : MOV ECX,ESI
0096545d : CALL EAX
0096545f : MOV byte ptr [EBP + -0x4],0x0
00965463 : MOV ECX,EDI
00965465 : CALL 0x00406560
0096546a : MOV dword ptr [EBP + -0x4],0xffffffff
00965471 : LEA ECX,[EBP + -0x2c]
00965474 : CALL 0x00406560
00965479 : MOV ECX,dword ptr [EBP + -0xc]
0096547c : MOV dword ptr FS:[0x0],ECX
00965483 : POP ECX
00965484 : POP EDI
00965485 : POP ESI
00965486 : POP EBX
00965487 : MOV ESP,EBP
00965489 : POP EBP
0096548a : RET 0x10
0096548d : MOV ECX,dword ptr [EBP + 0x10]
00965490 : MOV EDX,dword ptr [EBP + 0xc]
00965493 : MOV EAX,dword ptr [EBP + 0x8]
00965496 : PUSH EBX
00965497 : PUSH ECX
00965498 : PUSH EDX
00965499 : PUSH EAX
0096549a : PUSH ESI
0096549b : CALL 0x009640a0
009654a0 : MOV ECX,dword ptr [EBP + -0xc]
009654a3 : MOV dword ptr FS:[0x0],ECX
009654aa : POP ECX
009654ab : POP EDI
009654ac : POP ESI
009654ad : POP EBX
009654ae : MOV ESP,EBP
009654b0 : POP EBP
009654b1 : RET 0x10
