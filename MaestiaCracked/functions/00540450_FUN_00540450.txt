PROGRAM  : Maestia.exe
FUNCTION : FUN_00540450
ENTRY    : 00540450
BODY     : [[00540450, 005404a3] [005404b0, 0054061c]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00540450(int param_1,undefined ***param_2,uint param_3,uint param_4)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  undefined4 uVar4;
  GRefCountImpl *this;
  uint uVar5;
  int in_ECX;
  uint uVar6;
  uint uVar7;
  undefined ***pppuVar8;
  uint local_94;
  uint local_88;
  uint local_84;
  GRefCountImpl *local_80;
  undefined **local_7c;
  undefined4 local_78;
  undefined4 local_64;
  undefined4 local_60;
  undefined4 local_5c;
  undefined2 local_58;
  undefined2 local_56;
  undefined1 local_54;
  undefined2 local_52;
  GRefCountImpl *local_44;
  int local_34;
  uint local_30;
  undefined1 local_2c [44];
  
  FUN_0053ccd0(in_ECX + 0x10,in_ECX,param_3);
  if (param_4 < param_3) {
    param_4 = param_3;
  }
  if (param_4 == 0xffffffff) {
    local_94 = 0x7fffffff;
  }
  else {
    local_94 = param_4 - param_3;
    if ((int)local_94 < 1) goto LAB_00540601;
  }
  do {
    if (*(uint *)(local_34 + 4) <= local_30) break;
    iVar3 = FUN_0053cdb0();
    uVar1 = *(uint *)(iVar3 + 4);
    iVar2 = *(int *)(iVar3 + 8);
    uVar6 = param_3;
    if (param_3 <= uVar1) {
      uVar6 = uVar1;
    }
    uVar4 = *(undefined4 *)(param_1 + 0x1c);
    local_78 = 1;
    local_7c = &PTR_FUN_00b86530;
    FUN_0051c350(uVar4);
    FUN_0051c350(uVar4);
    local_56 = 0;
    local_64 = 0;
    local_60 = 0;
    local_5c = 0xff000000;
    local_58 = 0;
    local_54 = 0;
    local_52 = 0;
    pppuVar8 = param_2;
    if (*(int *)(iVar3 + 0xc) != 0) {
      uVar4 = FUN_0055fca0(local_2c,param_2);
      FUN_00504700(uVar4);
      FUN_00504260();
      pppuVar8 = &local_7c;
    }
    this = (GRefCountImpl *)FUN_00560f80(pppuVar8);
    uVar5 = (iVar2 - uVar6) + uVar1;
    uVar7 = local_94;
    if (uVar5 < local_94) {
      uVar7 = uVar5;
    }
    local_88 = uVar6;
    local_84 = uVar7;
    if (this != (GRefCountImpl *)0x0) {
      GRefCountImpl::AddRef(this);
    }
    local_80 = this;
    FUN_0053fa10(&local_88);
    if (local_80 != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(local_80);
    }
    local_94 = local_94 - uVar7;
    FUN_0053cea0(iVar2 + uVar1);
    if (this != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(this);
    }
    FUN_00504260();
  } while (0 < (int)local_94);
LAB_00540601:
  *(short *)(in_ECX + 0x24) = *(short *)(in_ECX + 0x24) + 1;
  if (local_44 != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release(local_44);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00540450 : SUB ESP,0x94
00540456 : PUSH EBX
00540457 : MOV EBX,dword ptr [ESP + 0xa4]
0054045e : PUSH ESI
0054045f : MOV ESI,ECX
00540461 : PUSH EBX
00540462 : LEA EAX,[ESI + 0x10]
00540465 : PUSH ESI
00540466 : PUSH EAX
00540467 : LEA ECX,[ESP + 0x58]
0054046b : MOV dword ptr [ESP + 0x18],ESI
0054046f : CALL 0x0053ccd0
00540474 : MOV EAX,dword ptr [ESP + 0xac]
0054047b : CMP EAX,EBX
0054047d : JNC 0x00540481
0054047f : MOV EAX,EBX
00540481 : CMP EAX,-0x1
00540484 : JNZ 0x00540492
00540486 : PUSH EBP
00540487 : MOV dword ptr [ESP + 0xc],0x7fffffff
0054048f : PUSH EDI
00540490 : JMP 0x005404b7
00540492 : SUB EAX,EBX
00540494 : MOV dword ptr [ESP + 0x8],EAX
00540498 : TEST EAX,EAX
0054049a : JLE 0x00540601
005404a0 : PUSH EBP
005404a1 : PUSH EDI
005404a2 : JMP 0x005404b7
005404b0 : MOV EBX,dword ptr [ESP + 0xb0]
005404b7 : MOV EAX,dword ptr [ESP + 0x74]
005404bb : MOV ECX,dword ptr [ESP + 0x70]
005404bf : CMP EAX,dword ptr [ECX + 0x4]
005404c2 : JNC 0x005405ff
005404c8 : LEA ECX,[ESP + 0x54]
005404cc : CALL 0x0053cdb0
005404d1 : MOV EDI,EAX
005404d3 : MOV EBP,dword ptr [EDI + 0x4]
005404d6 : MOV EDX,dword ptr [EDI + 0x8]
005404d9 : MOV dword ptr [ESP + 0x18],EDX
005404dd : CMP EBX,EBP
005404df : JA 0x005404e3
005404e1 : MOV EBX,EBP
005404e3 : MOV EAX,dword ptr [ESP + 0xa8]
005404ea : MOV ESI,dword ptr [EAX + 0x1c]
005404ed : MOV dword ptr [ESP + 0x28],0xcd3f2c
005404f5 : PUSH ESI
005404f6 : LEA ECX,[ESP + 0x34]
005404fa : MOV dword ptr [ESP + 0x30],0x1
00540502 : MOV dword ptr [ESP + 0x2c],0xb86530
0054050a : CALL 0x0051c350
0054050f : PUSH ESI
00540510 : LEA ECX,[ESP + 0x3c]
00540514 : CALL 0x0051c350
00540519 : XOR EAX,EAX
0054051b : XOR ECX,ECX
0054051d : XOR EDX,EDX
0054051f : MOV word ptr [ESP + 0x4e],DX
00540524 : MOV EDX,dword ptr [ESP + 0xac]
0054052b : MOV dword ptr [ESP + 0x40],EAX
0054052f : MOV dword ptr [ESP + 0x44],EAX
00540533 : MOV dword ptr [ESP + 0x48],0xff000000
0054053b : MOV word ptr [ESP + 0x4c],CX
00540540 : MOV byte ptr [ESP + 0x50],AL
00540544 : MOV word ptr [ESP + 0x52],CX
00540549 : MOV ECX,dword ptr [EDI + 0xc]
0054054c : PUSH EDX
0054054d : CMP ECX,EAX
0054054f : JZ 0x00540573
00540551 : LEA EAX,[ESP + 0x7c]
00540555 : PUSH EAX
00540556 : CALL 0x0055fca0
0054055b : PUSH EAX
0054055c : LEA ECX,[ESP + 0x2c]
00540560 : CALL 0x00504700
00540565 : LEA ECX,[ESP + 0x78]
00540569 : CALL 0x00504260
0054056e : LEA ECX,[ESP + 0x28]
00540572 : PUSH ECX
00540573 : MOV ECX,dword ptr [ESP + 0xac]
0054057a : CALL 0x00560f80
0054057f : MOV EDI,dword ptr [ESP + 0x10]
00540583 : MOV ESI,EAX
00540585 : MOV EAX,dword ptr [ESP + 0x18]
00540589 : SUB EAX,EBX
0054058b : ADD EAX,EBP
0054058d : CMP EAX,EDI
0054058f : JNC 0x00540593
00540591 : MOV EDI,EAX
00540593 : MOV dword ptr [ESP + 0x1c],EBX
00540597 : MOV dword ptr [ESP + 0x20],EDI
0054059b : TEST ESI,ESI
0054059d : JZ 0x005405a6
0054059f : MOV ECX,ESI
005405a1 : CALL 0x00523dd0
005405a6 : MOV ECX,dword ptr [ESP + 0x14]
005405aa : LEA EAX,[ESP + 0x1c]
005405ae : PUSH EAX
005405af : ADD ECX,0x10
005405b2 : MOV dword ptr [ESP + 0x28],ESI
005405b6 : CALL 0x0053fa10
005405bb : MOV ECX,dword ptr [ESP + 0x24]
005405bf : TEST ECX,ECX
005405c1 : JZ 0x005405c8
005405c3 : CALL 0x004ff7e0
005405c8 : MOV ECX,dword ptr [ESP + 0x18]
005405cc : SUB dword ptr [ESP + 0x10],EDI
005405d0 : ADD ECX,EBP
005405d2 : PUSH ECX
005405d3 : LEA ECX,[ESP + 0x58]
005405d7 : CALL 0x0053cea0
005405dc : TEST ESI,ESI
005405de : JZ 0x005405e7
005405e0 : MOV ECX,ESI
005405e2 : CALL 0x004ff7e0
005405e7 : LEA ECX,[ESP + 0x28]
005405eb : CALL 0x00504260
005405f0 : CMP dword ptr [ESP + 0x10],0x0
005405f5 : MOV ESI,dword ptr [ESP + 0x14]
005405f9 : JG 0x005404b0
005405ff : POP EDI
00540600 : POP EBP
00540601 : INC word ptr [ESI + 0x24]
00540605 : MOV ECX,dword ptr [ESP + 0x58]
00540609 : POP ESI
0054060a : POP EBX
0054060b : TEST ECX,ECX
0054060d : JZ 0x00540614
0054060f : CALL 0x004ff7e0
00540614 : ADD ESP,0x94
0054061a : RET 0x10
