PROGRAM  : Maestia.exe
FUNCTION : FUN_008bd910
ENTRY    : 008bd910
BODY     : [[008bd910, 008bdce1]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008bd910(void)

{
  int *piVar1;
  char cVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  int iVar6;
  undefined4 uVar7;
  int *in_ECX;
  undefined1 local_68 [4];
  undefined2 local_64;
  undefined4 local_54;
  uint local_50;
  undefined1 local_4c [4];
  undefined2 local_48;
  undefined4 local_38;
  uint local_34;
  undefined1 local_30 [4];
  undefined2 local_2c;
  undefined4 local_1c;
  uint local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b44e92;
  local_10 = ExceptionList;
  local_14 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  iVar3 = (**(code **)(*in_ECX + 0x74))(0,0,local_14);
  iVar4 = (**(code **)(*in_ECX + 0x74))(1,0);
  iVar5 = (**(code **)(*in_ECX + 0x74))(2,0);
  iVar6 = (**(code **)(*in_ECX + 0x74))(3,0);
  piVar1 = DAT_00da9894;
  if (iVar3 == 0) {
    FUN_00406460(L"IDS_ENCHANT_TRANS_HAVE_NOT_STONE");
    local_8 = iVar3;
    iVar3 = FUN_0081d120(local_4c);
    local_8._0_1_ = 1;
    if (*(uint *)(iVar3 + 0x18) < 8) {
      iVar3 = iVar3 + 4;
    }
    else {
      iVar3 = *(int *)(iVar3 + 4);
    }
    FUN_00406460(iVar3);
    local_8._0_1_ = 2;
    (**(code **)(**(int **)(*DAT_00da9894 + 0x1a8) + 0x44))(local_68,3);
    local_8 = CONCAT31(local_8._1_3_,1);
    if (7 < local_50) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_50 = 7;
    local_54 = 0;
    local_64 = 0;
    local_8 = (uint)local_8._1_3_ << 8;
    if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_18 = 7;
    local_1c = 0;
    local_2c = 0;
    local_8 = 0xffffffff;
    if (7 < local_34) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_34 = 7;
    local_38 = 0;
    local_48 = 0;
  }
  else if ((iVar4 == 0) || (iVar5 == 0)) {
    FUN_00406460(L"IDS_ENCHANT_TRANS_NOT_ENOUGH_ITEM");
    local_8 = 3;
    iVar3 = FUN_0081d120(local_68);
    local_8._0_1_ = 4;
    if (*(uint *)(iVar3 + 0x18) < 8) {
      iVar3 = iVar3 + 4;
    }
    else {
      iVar3 = *(int *)(iVar3 + 4);
    }
    FUN_00406460(iVar3);
    local_8._0_1_ = 5;
    (**(code **)(**(int **)(*DAT_00da9894 + 0x1a8) + 0x44))(local_4c,3);
    local_8 = CONCAT31(local_8._1_3_,4);
    if (7 < local_34) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_34 = 7;
    local_38 = 0;
    local_48 = 0;
    local_8 = CONCAT31(local_8._1_3_,3);
    if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_18 = 7;
    local_1c = 0;
    local_2c = 0;
    local_8 = 0xffffffff;
    if (7 < local_50) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_50 = 7;
    local_54 = 0;
    local_64 = 0;
  }
  else if (*(short *)(iVar4 + 0xac) == 0) {
    FUN_00406460(L"IDS_ENCHANT_TRANS_NOT_ENOUGH_LEVEL");
    local_8 = 6;
    iVar3 = FUN_0081d120(local_4c);
    local_8._0_1_ = 7;
    if (*(uint *)(iVar3 + 0x18) < 8) {
      iVar3 = iVar3 + 4;
    }
    else {
      iVar3 = *(int *)(iVar3 + 4);
    }
    FUN_00406460(iVar3);
    local_8._0_1_ = 8;
    (**(code **)(**(int **)(*DAT_00da9894 + 0x1a8) + 0x44))(local_30,3);
    local_8._0_1_ = 7;
    FUN_00406560();
    local_8 = CONCAT31(local_8._1_3_,6);
    FUN_00406560();
    local_8 = 0xffffffff;
    FUN_00406560();
  }
  else {
    cVar2 = FUN_008eb3f0();
    if (cVar2 == '\0') {
      if (iVar6 == 0) {
        FUN_00406460(L"IDS_TRANSPER_WARNING_USE_SCROLL");
        local_8 = 0xb;
        FUN_0081d120(local_4c);
        local_8 = CONCAT31(local_8._1_3_,0xd);
        FUN_00406560();
        iVar3 = FUN_008ede80(local_30,2);
        if (iVar3 != 0) {
          if (*(code **)(iVar3 + 0x60) != (code *)0x0) {
            (**(code **)(iVar3 + 0x60))(1,iVar3);
          }
          *(code **)(iVar3 + 0x60) = FUN_008bd8f0;
        }
        local_8 = 0xffffffff;
        FUN_00406560();
      }
      else if (*piVar1 != 0) {
        FUN_008bd7b0();
      }
      goto LAB_008bdcc6;
    }
    FUN_00406460(L"IDS_POPUPOPENED_NOT_EVENT");
    local_8 = 9;
    piVar1 = *(int **)(*DAT_00da9894 + 0x1a8);
    uVar7 = FUN_0081d120(local_30);
    local_8._0_1_ = 10;
    (**(code **)(*piVar1 + 0x44))(uVar7,3);
    local_8 = CONCAT31(local_8._1_3_,9);
    FUN_00406560();
    local_8 = 0xffffffff;
    FUN_00406560();
  }
  FUN_008a1050(0xca);
LAB_008bdcc6:
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
008bd910 : PUSH EBP
008bd911 : MOV EBP,ESP
008bd913 : PUSH -0x1
008bd915 : PUSH 0xb44e92
008bd91a : MOV EAX,FS:[0x0]
008bd920 : PUSH EAX
008bd921 : SUB ESP,0x5c
008bd924 : MOV EAX,[0x00d66fa0]
008bd929 : XOR EAX,EBP
008bd92b : MOV dword ptr [EBP + -0x10],EAX
008bd92e : PUSH EBX
008bd92f : PUSH ESI
008bd930 : PUSH EDI
008bd931 : PUSH EAX
008bd932 : LEA EAX,[EBP + -0xc]
008bd935 : MOV FS:[0x0],EAX
008bd93b : MOV ESI,ECX
008bd93d : MOV EAX,dword ptr [ESI]
008bd93f : MOV EDX,dword ptr [EAX + 0x74]
008bd942 : PUSH 0x0
008bd944 : PUSH 0x0
008bd946 : CALL EDX
008bd948 : MOV EDI,EAX
008bd94a : MOV EAX,dword ptr [ESI]
008bd94c : MOV EDX,dword ptr [EAX + 0x74]
008bd94f : PUSH 0x0
008bd951 : PUSH 0x1
008bd953 : MOV ECX,ESI
008bd955 : CALL EDX
008bd957 : MOV EBX,EAX
008bd959 : MOV EAX,dword ptr [ESI]
008bd95b : MOV EDX,dword ptr [EAX + 0x74]
008bd95e : PUSH 0x0
008bd960 : PUSH 0x2
008bd962 : MOV ECX,ESI
008bd964 : CALL EDX
008bd966 : MOV dword ptr [EBP + -0x68],EAX
008bd969 : MOV EAX,dword ptr [ESI]
008bd96b : MOV EDX,dword ptr [EAX + 0x74]
008bd96e : PUSH 0x0
008bd970 : PUSH 0x3
008bd972 : MOV ECX,ESI
008bd974 : CALL EDX
008bd976 : MOV ESI,EAX
008bd978 : TEST EDI,EDI
008bd97a : JNZ 0x008bda45
008bd980 : PUSH 0xc4df18
008bd985 : LEA ECX,[EBP + -0x48]
008bd988 : CALL 0x00406460
008bd98d : MOV dword ptr [EBP + -0x4],EDI
008bd990 : MOV ECX,dword ptr [0x0172491c]
008bd996 : LEA EAX,[EBP + -0x48]
008bd999 : PUSH EAX
008bd99a : LEA EDI,[EBP + -0x2c]
008bd99d : CALL 0x0081d120
008bd9a2 : MOV byte ptr [EBP + -0x4],0x1
008bd9a6 : MOV EBX,0x8
008bd9ab : CMP dword ptr [EAX + 0x18],EBX
008bd9ae : JC 0x008bd9b5
008bd9b0 : MOV EAX,dword ptr [EAX + 0x4]
008bd9b3 : JMP 0x008bd9b8
008bd9b5 : ADD EAX,0x4
008bd9b8 : PUSH EAX
008bd9b9 : LEA ECX,[EBP + -0x64]
008bd9bc : CALL 0x00406460
008bd9c1 : MOV byte ptr [EBP + -0x4],0x2
008bd9c5 : MOV ECX,dword ptr [0x00da9894]
008bd9cb : MOV EAX,dword ptr [ECX]
008bd9cd : MOV ECX,dword ptr [EAX + 0x1a8]
008bd9d3 : MOV EDX,dword ptr [ECX]
008bd9d5 : MOV EDX,dword ptr [EDX + 0x44]
008bd9d8 : PUSH 0x3
008bd9da : LEA EAX,[EBP + -0x64]
008bd9dd : PUSH EAX
008bd9de : CALL EDX
008bd9e0 : MOV byte ptr [EBP + -0x4],0x1
008bd9e4 : CMP dword ptr [EBP + -0x4c],EBX
008bd9e7 : JC 0x008bd9f1
008bd9e9 : MOV ECX,dword ptr [EBP + -0x60]
008bd9ec : CALL 0x006f04e0
008bd9f1 : XOR EAX,EAX
008bd9f3 : MOV ESI,0x7
008bd9f8 : XOR EDI,EDI
008bd9fa : MOV dword ptr [EBP + -0x4c],ESI
008bd9fd : MOV dword ptr [EBP + -0x50],EDI
008bda00 : MOV word ptr [EBP + -0x60],AX
008bda04 : MOV byte ptr [EBP + -0x4],AL
008bda07 : CMP dword ptr [EBP + -0x14],EBX
008bda0a : JC 0x008bda14
008bda0c : MOV ECX,dword ptr [EBP + -0x28]
008bda0f : CALL 0x006f04e0
008bda14 : XOR ECX,ECX
008bda16 : MOV dword ptr [EBP + -0x14],ESI
008bda19 : MOV dword ptr [EBP + -0x18],EDI
008bda1c : MOV word ptr [EBP + -0x28],CX
008bda20 : MOV dword ptr [EBP + -0x4],0xffffffff
008bda27 : CMP dword ptr [EBP + -0x30],EBX
008bda2a : JC 0x008bda34
008bda2c : MOV ECX,dword ptr [EBP + -0x44]
008bda2f : CALL 0x006f04e0
008bda34 : XOR EDX,EDX
008bda36 : MOV dword ptr [EBP + -0x30],ESI
008bda39 : MOV dword ptr [EBP + -0x34],EDI
008bda3c : MOV word ptr [EBP + -0x44],DX
008bda40 : JMP 0x008bdcb6
008bda45 : TEST EBX,EBX
008bda47 : JZ 0x008bdbf1
008bda4d : CMP dword ptr [EBP + -0x68],0x0
008bda51 : JZ 0x008bdbf1
008bda57 : MOVZX EAX,word ptr [EBX + 0xac]
008bda5e : TEST AX,AX
008bda61 : JNZ 0x008bdaf6
008bda67 : PUSH 0xc4dfd8
008bda6c : LEA ECX,[EBP + -0x48]
008bda6f : CALL 0x00406460
008bda74 : MOV dword ptr [EBP + -0x4],0x6
008bda7b : MOV ECX,dword ptr [0x0172491c]
008bda81 : LEA EAX,[EBP + -0x48]
008bda84 : PUSH EAX
008bda85 : LEA EDI,[EBP + -0x64]
008bda88 : CALL 0x0081d120
008bda8d : MOV byte ptr [EBP + -0x4],0x7
008bda91 : MOV EBX,0x8
008bda96 : CMP dword ptr [EAX + 0x18],EBX
008bda99 : JC 0x008bdaa0
008bda9b : MOV EAX,dword ptr [EAX + 0x4]
008bda9e : JMP 0x008bdaa3
008bdaa0 : ADD EAX,0x4
008bdaa3 : PUSH EAX
008bdaa4 : LEA ECX,[EBP + -0x2c]
008bdaa7 : CALL 0x00406460
008bdaac : MOV byte ptr [EBP + -0x4],BL
008bdaaf : MOV ECX,dword ptr [0x00da9894]
008bdab5 : MOV EAX,dword ptr [ECX]
008bdab7 : MOV ECX,dword ptr [EAX + 0x1a8]
008bdabd : MOV EDX,dword ptr [ECX]
008bdabf : MOV EDX,dword ptr [EDX + 0x44]
008bdac2 : PUSH 0x3
008bdac4 : LEA EAX,[EBP + -0x2c]
008bdac7 : PUSH EAX
008bdac8 : CALL EDX
008bdaca : MOV byte ptr [EBP + -0x4],0x7
008bdace : LEA ECX,[EBP + -0x2c]
008bdad1 : CALL 0x00406560
008bdad6 : MOV byte ptr [EBP + -0x4],0x6
008bdada : LEA ECX,[EBP + -0x64]
008bdadd : CALL 0x00406560
008bdae2 : MOV dword ptr [EBP + -0x4],0xffffffff
008bdae9 : LEA ECX,[EBP + -0x48]
008bdaec : CALL 0x00406560
008bdaf1 : JMP 0x008bdcb6
008bdaf6 : MOV EDI,dword ptr [0x00da9894]
008bdafc : MOV EAX,dword ptr [EDI]
008bdafe : CALL 0x008eb3f0
008bdb03 : TEST AL,AL
008bdb05 : JZ 0x008bdb69
008bdb07 : PUSH 0xc4dfa4
008bdb0c : LEA ECX,[EBP + -0x2c]
008bdb0f : CALL 0x00406460
008bdb14 : MOV EBX,0x9
008bdb19 : MOV dword ptr [EBP + -0x4],EBX
008bdb1c : MOV EAX,[0x00da9894]
008bdb21 : MOV EAX,dword ptr [EAX]
008bdb23 : MOV ESI,dword ptr [EAX + 0x1a8]
008bdb29 : LEA ECX,[EBP + -0x2c]
008bdb2c : PUSH ECX
008bdb2d : MOV ECX,dword ptr [0x0172491c]
008bdb33 : LEA EDI,[EBP + -0x48]
008bdb36 : CALL 0x0081d120
008bdb3b : MOV byte ptr [EBP + -0x4],0xa
008bdb3f : MOV EDX,dword ptr [ESI]
008bdb41 : PUSH 0x3
008bdb43 : PUSH EAX
008bdb44 : MOV EAX,dword ptr [EDX + 0x44]
008bdb47 : MOV ECX,ESI
008bdb49 : CALL EAX
008bdb4b : MOV byte ptr [EBP + -0x4],BL
008bdb4e : MOV ECX,EDI
008bdb50 : CALL 0x00406560
008bdb55 : MOV dword ptr [EBP + -0x4],0xffffffff
008bdb5c : LEA ECX,[EBP + -0x2c]
008bdb5f : CALL 0x00406560
008bdb64 : JMP 0x008bdcb6
008bdb69 : TEST ESI,ESI
008bdb6b : JNZ 0x008bdbde
008bdb6d : PUSH 0xc4e020
008bdb72 : LEA ECX,[EBP + -0x48]
008bdb75 : CALL 0x00406460
008bdb7a : MOV dword ptr [EBP + -0x4],0xb
008bdb81 : LEA ECX,[EBP + -0x48]
008bdb84 : PUSH ECX
008bdb85 : MOV ECX,dword ptr [0x0172491c]
008bdb8b : LEA EDI,[EBP + -0x2c]
008bdb8e : CALL 0x0081d120
008bdb93 : MOV byte ptr [EBP + -0x4],0xd
008bdb97 : LEA ECX,[EBP + -0x48]
008bdb9a : CALL 0x00406560
008bdb9f : MOV EDX,dword ptr [0x00da9894]
008bdba5 : MOV ECX,dword ptr [EDX]
008bdba7 : PUSH 0x2
008bdba9 : MOV EAX,EDI
008bdbab : PUSH EAX
008bdbac : CALL 0x008ede80
008bdbb1 : MOV ESI,EAX
008bdbb3 : TEST ESI,ESI
008bdbb5 : JZ 0x008bdbca
008bdbb7 : MOV EAX,dword ptr [ESI + 0x60]
008bdbba : TEST EAX,EAX
008bdbbc : JZ 0x008bdbc3
008bdbbe : PUSH ESI
008bdbbf : PUSH 0x1
008bdbc1 : CALL EAX
008bdbc3 : MOV dword ptr [ESI + 0x60],0x8bd8f0
008bdbca : MOV dword ptr [EBP + -0x4],0xffffffff
008bdbd1 : LEA ECX,[EBP + -0x2c]
008bdbd4 : CALL 0x00406560
008bdbd9 : JMP 0x008bdcc6
008bdbde : CMP dword ptr [EDI],0x0
008bdbe1 : JZ 0x008bdcc6
008bdbe7 : CALL 0x008bd7b0
008bdbec : JMP 0x008bdcc6
008bdbf1 : PUSH 0xc4df60
008bdbf6 : LEA ECX,[EBP + -0x64]
008bdbf9 : CALL 0x00406460
008bdbfe : MOV dword ptr [EBP + -0x4],0x3
008bdc05 : LEA ECX,[EBP + -0x64]
008bdc08 : PUSH ECX
008bdc09 : MOV ECX,dword ptr [0x0172491c]
008bdc0f : LEA EDI,[EBP + -0x2c]
008bdc12 : CALL 0x0081d120
008bdc17 : MOV byte ptr [EBP + -0x4],0x4
008bdc1b : MOV EBX,0x8
008bdc20 : CMP dword ptr [EAX + 0x18],EBX
008bdc23 : JC 0x008bdc2a
008bdc25 : MOV EAX,dword ptr [EAX + 0x4]
008bdc28 : JMP 0x008bdc2d
008bdc2a : ADD EAX,0x4
008bdc2d : PUSH EAX
008bdc2e : LEA ECX,[EBP + -0x48]
008bdc31 : CALL 0x00406460
008bdc36 : MOV byte ptr [EBP + -0x4],0x5
008bdc3a : MOV EDX,dword ptr [0x00da9894]
008bdc40 : MOV EAX,dword ptr [EDX]
008bdc42 : MOV ECX,dword ptr [EAX + 0x1a8]
008bdc48 : MOV EAX,dword ptr [ECX]
008bdc4a : MOV EAX,dword ptr [EAX + 0x44]
008bdc4d : PUSH 0x3
008bdc4f : LEA EDX,[EBP + -0x48]
008bdc52 : PUSH EDX
008bdc53 : CALL EAX
008bdc55 : MOV byte ptr [EBP + -0x4],0x4
008bdc59 : CMP dword ptr [EBP + -0x30],EBX
008bdc5c : JC 0x008bdc66
008bdc5e : MOV ECX,dword ptr [EBP + -0x44]
008bdc61 : CALL 0x006f04e0
008bdc66 : MOV ESI,0x7
008bdc6b : XOR EDI,EDI
008bdc6d : XOR ECX,ECX
008bdc6f : MOV dword ptr [EBP + -0x30],ESI
008bdc72 : MOV dword ptr [EBP + -0x34],EDI
008bdc75 : MOV word ptr [EBP + -0x44],CX
008bdc79 : MOV byte ptr [EBP + -0x4],0x3
008bdc7d : CMP dword ptr [EBP + -0x14],EBX
008bdc80 : JC 0x008bdc8a
008bdc82 : MOV ECX,dword ptr [EBP + -0x28]
008bdc85 : CALL 0x006f04e0
008bdc8a : XOR EDX,EDX
008bdc8c : MOV dword ptr [EBP + -0x14],ESI
008bdc8f : MOV dword ptr [EBP + -0x18],EDI
008bdc92 : MOV word ptr [EBP + -0x28],DX
008bdc96 : MOV dword ptr [EBP + -0x4],0xffffffff
008bdc9d : CMP dword ptr [EBP + -0x4c],EBX
008bdca0 : JC 0x008bdcaa
008bdca2 : MOV ECX,dword ptr [EBP + -0x60]
008bdca5 : CALL 0x006f04e0
008bdcaa : XOR EAX,EAX
008bdcac : MOV dword ptr [EBP + -0x4c],ESI
008bdcaf : MOV dword ptr [EBP + -0x50],EDI
008bdcb2 : MOV word ptr [EBP + -0x60],AX
008bdcb6 : MOV ECX,dword ptr [0x017248dc]
008bdcbc : PUSH 0xca
008bdcc1 : CALL 0x008a1050
008bdcc6 : MOV ECX,dword ptr [EBP + -0xc]
008bdcc9 : MOV dword ptr FS:[0x0],ECX
008bdcd0 : POP ECX
008bdcd1 : POP EDI
008bdcd2 : POP ESI
008bdcd3 : POP EBX
008bdcd4 : MOV ECX,dword ptr [EBP + -0x10]
008bdcd7 : XOR ECX,EBP
008bdcd9 : CALL 0x00633e6b
008bdcde : MOV ESP,EBP
008bdce0 : POP EBP
008bdce1 : RET
