PROGRAM  : Maestia.exe
FUNCTION : FUN_00a3e680
ENTRY    : 00a3e680
BODY     : [[00a3e680, 00a3e958]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00a3e680(uint param_1,uint8_t *param_2)

{
  int *piVar1;
  int iVar2;
  char cVar3;
  uint uVar4;
  int iVar5;
  int iVar6;
  undefined4 uVar7;
  ushort in_CX;
  uint8_t *packet;
  undefined1 local_48 [28];
  undefined4 local_2c;
  undefined4 local_28;
  undefined4 local_24;
  float local_20;
  float local_1c;
  undefined4 local_18;
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  iVar2 = param_1;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b680b7;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  iVar6 = *(int *)(DAT_017248f8 + 0x1c);
  param_1 = (uint)in_CX;
  FUN_004437f0(&param_1);
  if ((local_14 != *(int *)(iVar6 + 4)) && (iVar6 = *(int *)(local_14 + 0x10), iVar6 != 0)) {
    local_2c = 0;
    local_28 = 0;
    local_24 = 0;
    local_20 = 0.0;
    local_1c = 0.0;
    local_18 = 0;
    iVar5 = FUN_0093b8f0(iVar6,*(undefined4 *)(DAT_00da93ec + 0x450),&local_2c);
    if (iVar5 != 0) {
      if ((char)param_2 != '\0') {
        if ((local_20 == 0.0) || (local_1c == 0.0)) {
          iVar6 = *DAT_00da9894;
        }
        else {
          iVar6 = FUN_009ef7f0(4,0x10006,1);
          if (iVar6 != 0) {
            param_2 = (uint8_t *)FUN_006f4590();
            if (param_2 == (uint8_t *)0x0) {
              packet = (uint8_t *)0x0;
            }
            else {
              param_2[0] = '\0';
              param_2[1] = '\0';
              param_2[2] = '6';
              param_2[3] = 0xa7;
              packet = param_2;
            }
            local_8 = 0xffffffff;
            *(undefined4 *)(packet + 4) = *(undefined4 *)(iVar6 + 0xc);
            *(undefined2 *)(packet + 8) = (undefined2)param_1;
            iVar2 = DAT_017247d4;
            *(short *)(packet + 10) = (short)(int)local_20;
            *(short *)(packet + 0xc) = (short)(int)local_1c;
            iVar6 = *(int *)(iVar2 + 4);
            if ((iVar6 != 0) && (*(char *)(iVar2 + 8) != '\0')) {
              FUN_00a0dd40(iVar6,0xe,packet);
            }
            ExceptionList = local_10;
            return 1;
          }
          iVar6 = *DAT_00da9894;
        }
        FUN_009adfc0(*(undefined4 *)(iVar6 + 0x1a8),3);
        ExceptionList = local_10;
        return 0;
      }
      cVar3 = FUN_00a30a90(iVar2,local_2c,local_24);
      iVar6 = DAT_00da93ec;
      if (cVar3 != '\0') {
        *(ushort *)(iVar2 + 0x770) = in_CX;
        *(bool *)(iVar2 + 0x772) = (param_1 & 0xffff) != *(uint *)(iVar6 + 0x450);
        ExceptionList = local_10;
        return 1;
      }
      if (DAT_0172491c == 0) {
        ExceptionList = local_10;
        return 0;
      }
      if (*DAT_00da9894 == 0) {
        ExceptionList = local_10;
        return 0;
      }
      if (*(int *)(*DAT_00da9894 + 0x1a8) == 0) {
        ExceptionList = local_10;
        return 0;
      }
      FUN_00406460(L"IDS_CHARACTER_NOT_MOVALBE");
      local_8 = 1;
      piVar1 = *(int **)(*DAT_00da9894 + 0x1a8);
      uVar7 = FUN_0081d120(local_48);
      local_8._0_1_ = 2;
      (**(code **)(*piVar1 + 0x44))(uVar7,3);
      local_8 = CONCAT31(local_8._1_3_,1);
      FUN_00406560();
      local_8 = 0xffffffff;
      FUN_00406560();
      ExceptionList = local_10;
      return 0;
    }
    if ((*(short *)(iVar6 + 8) == 7) && (*(char *)(iVar6 + 0x101) != '\0')) {
      FUN_009a4db0(uVar4);
      ExceptionList = local_10;
      return 1;
    }
  }
  *(undefined2 *)(iVar2 + 0x770) = 0;
  *(undefined1 *)(iVar2 + 0x772) = 0;
  ExceptionList = local_10;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
00a3e680 : PUSH EBP
00a3e681 : MOV EBP,ESP
00a3e683 : PUSH -0x1
00a3e685 : PUSH 0xb680b7
00a3e68a : MOV EAX,FS:[0x0]
00a3e690 : PUSH EAX
00a3e691 : SUB ESP,0x54
00a3e694 : PUSH EBX
00a3e695 : PUSH ESI
00a3e696 : PUSH EDI
00a3e697 : MOV EAX,[0x00d66fa0]
00a3e69c : XOR EAX,EBP
00a3e69e : PUSH EAX
00a3e69f : LEA EAX,[EBP + -0xc]
00a3e6a2 : MOV FS:[0x0],EAX
00a3e6a8 : MOV DI,CX
00a3e6ab : MOV EBX,dword ptr [EBP + 0x8]
00a3e6ae : MOV ECX,dword ptr [0x017248f8]
00a3e6b4 : MOV ESI,dword ptr [ECX + 0x1c]
00a3e6b7 : MOVZX EAX,DI
00a3e6ba : LEA EDX,[EBP + 0x8]
00a3e6bd : MOV dword ptr [EBP + 0x8],EAX
00a3e6c0 : PUSH EDX
00a3e6c1 : LEA EAX,[EBP + -0x10]
00a3e6c4 : MOV ECX,ESI
00a3e6c6 : CALL 0x004437f0
00a3e6cb : MOV ESI,dword ptr [ESI + 0x4]
00a3e6ce : MOV EAX,dword ptr [EBP + -0x10]
00a3e6d1 : CMP EAX,ESI
00a3e6d3 : JZ 0x00a3e934
00a3e6d9 : MOV ESI,dword ptr [EAX + 0x10]
00a3e6dc : TEST ESI,ESI
00a3e6de : JZ 0x00a3e934
00a3e6e4 : MOV EAX,[0x00da93ec]
00a3e6e9 : XORPS XMM0,XMM0
00a3e6ec : MOV EAX,dword ptr [EAX + 0x450]
00a3e6f2 : LEA ECX,[EBP + -0x28]
00a3e6f5 : PUSH ECX
00a3e6f6 : PUSH EAX
00a3e6f7 : PUSH ESI
00a3e6f8 : LEA EDX,[EBP + -0x1c]
00a3e6fb : LEA ECX,[EBP + 0x8]
00a3e6fe : MOVSS dword ptr [EBP + -0x28],XMM0
00a3e703 : MOVSS dword ptr [EBP + -0x24],XMM0
00a3e708 : MOVSS dword ptr [EBP + -0x20],XMM0
00a3e70d : MOVSS dword ptr [EBP + -0x1c],XMM0
00a3e712 : MOVSS dword ptr [EBP + -0x18],XMM0
00a3e717 : MOVSS dword ptr [EBP + -0x14],XMM0
00a3e71c : CALL 0x0093b8f0
00a3e721 : TEST EAX,EAX
00a3e723 : JZ 0x00a3e8fb
00a3e729 : CMP byte ptr [EBP + 0xc],0x0
00a3e72d : JZ 0x00a3e821
00a3e733 : XORPS XMM0,XMM0
00a3e736 : MOVSS XMM1,dword ptr [EBP + -0x1c]
00a3e73b : UCOMISS XMM1,XMM0
00a3e73e : LAHF
00a3e73f : TEST AH,0x44
00a3e742 : JNP 0x00a3e7fe
00a3e748 : MOVSS XMM1,dword ptr [EBP + -0x18]
00a3e74d : UCOMISS XMM1,XMM0
00a3e750 : LAHF
00a3e751 : TEST AH,0x44
00a3e754 : JNP 0x00a3e7fe
00a3e75a : PUSH 0x1
00a3e75c : PUSH 0x10006
00a3e761 : PUSH 0x4
00a3e763 : CALL 0x009ef7f0
00a3e768 : MOV ESI,EAX
00a3e76a : ADD ESP,0xc
00a3e76d : TEST ESI,ESI
00a3e76f : JZ 0x00a3e7ef
00a3e771 : CALL 0x006f4590
00a3e776 : MOV dword ptr [EBP + 0xc],EAX
00a3e779 : MOV dword ptr [EBP + -0x4],0x0
00a3e780 : TEST EAX,EAX
00a3e782 : JZ 0x00a3e795
00a3e784 : XOR EDX,EDX
00a3e786 : MOV word ptr [EAX],DX
00a3e789 : MOV byte ptr [EAX + 0x2],0x36
00a3e78d : MOV byte ptr [EAX + 0x3],0xa7
00a3e791 : MOV EDI,EAX
00a3e793 : JMP 0x00a3e797
00a3e795 : XOR EDI,EDI
00a3e797 : MOV dword ptr [EBP + -0x4],0xffffffff
00a3e79e : MOV EAX,dword ptr [ESI + 0xc]
00a3e7a1 : MOV CX,word ptr [EBP + 0x8]
00a3e7a5 : CVTTSS2SI EDX,dword ptr [EBP + -0x1c]
00a3e7aa : MOV dword ptr [EDI + 0x4],EAX
00a3e7ad : CVTTSS2SI EAX,dword ptr [EBP + -0x18]
00a3e7b2 : MOV word ptr [EDI + 0x8],CX
00a3e7b6 : MOV ECX,dword ptr [0x017247d4]
00a3e7bc : MOV word ptr [EDI + 0xa],DX
00a3e7c0 : MOV word ptr [EDI + 0xc],AX
00a3e7c4 : MOV EAX,dword ptr [ECX + 0x4]
00a3e7c7 : TEST EAX,EAX
00a3e7c9 : JZ 0x00a3e7d9
00a3e7cb : CMP byte ptr [ECX + 0x8],0x0
00a3e7cf : JZ 0x00a3e7d9
00a3e7d1 : PUSH 0xe
00a3e7d3 : PUSH EAX
00a3e7d4 : CALL 0x00a0dd40
00a3e7d9 : MOV AL,0x1
00a3e7db : MOV ECX,dword ptr [EBP + -0xc]
00a3e7de : MOV dword ptr FS:[0x0],ECX
00a3e7e5 : POP ECX
00a3e7e6 : POP EDI
00a3e7e7 : POP ESI
00a3e7e8 : POP EBX
00a3e7e9 : MOV ESP,EBP
00a3e7eb : POP EBP
00a3e7ec : RET 0x8
00a3e7ef : MOV ECX,dword ptr [0x00da9894]
00a3e7f5 : MOV EDX,dword ptr [ECX]
00a3e7f7 : MOV ECX,0xcc58e0
00a3e7fc : JMP 0x00a3e80b
00a3e7fe : MOV ECX,dword ptr [0x00da9894]
00a3e804 : MOV EDX,dword ptr [ECX]
00a3e806 : MOV ECX,0xcc5900
00a3e80b : MOV EAX,dword ptr [EDX + 0x1a8]
00a3e811 : PUSH 0x3
00a3e813 : PUSH EAX
00a3e814 : CALL 0x009adfc0
00a3e819 : ADD ESP,0x8
00a3e81c : JMP 0x00a3e943
00a3e821 : FLD float ptr [EBP + -0x20]
00a3e824 : SUB ESP,0x8
00a3e827 : FSTP float ptr [ESP + 0x4]
00a3e82b : FLD float ptr [EBP + -0x28]
00a3e82e : FSTP float ptr [ESP]
00a3e831 : PUSH EBX
00a3e832 : CALL 0x00a30a90
00a3e837 : TEST AL,AL
00a3e839 : JZ 0x00a3e871
00a3e83b : MOVZX ECX,word ptr [EBP + 0x8]
00a3e83f : MOV EDX,dword ptr [0x00da93ec]
00a3e845 : MOV word ptr [EBX + 0x770],DI
00a3e84c : CMP ECX,dword ptr [EDX + 0x450]
00a3e852 : SETNZ AL
00a3e855 : MOV byte ptr [EBX + 0x772],AL
00a3e85b : MOV AL,0x1
00a3e85d : MOV ECX,dword ptr [EBP + -0xc]
00a3e860 : MOV dword ptr FS:[0x0],ECX
00a3e867 : POP ECX
00a3e868 : POP EDI
00a3e869 : POP ESI
00a3e86a : POP EBX
00a3e86b : MOV ESP,EBP
00a3e86d : POP EBP
00a3e86e : RET 0x8
00a3e871 : CMP dword ptr [0x0172491c],0x0
00a3e878 : JZ 0x00a3e943
00a3e87e : MOV ECX,dword ptr [0x00da9894]
00a3e884 : MOV EAX,dword ptr [ECX]
00a3e886 : TEST EAX,EAX
00a3e888 : JZ 0x00a3e943
00a3e88e : CMP dword ptr [EAX + 0x1a8],0x0
00a3e895 : JZ 0x00a3e943
00a3e89b : PUSH 0xcc5920
00a3e8a0 : LEA ECX,[EBP + -0x44]
00a3e8a3 : CALL 0x00406460
00a3e8a8 : MOV dword ptr [EBP + -0x4],0x1
00a3e8af : MOV EDX,dword ptr [0x00da9894]
00a3e8b5 : MOV EAX,dword ptr [EDX]
00a3e8b7 : MOV ESI,dword ptr [EAX + 0x1a8]
00a3e8bd : MOV ECX,dword ptr [0x0172491c]
00a3e8c3 : LEA EAX,[EBP + -0x44]
00a3e8c6 : PUSH EAX
00a3e8c7 : LEA EDI,[EBP + -0x60]
00a3e8ca : CALL 0x0081d120
00a3e8cf : MOV byte ptr [EBP + -0x4],0x2
00a3e8d3 : MOV EDX,dword ptr [ESI]
00a3e8d5 : PUSH 0x3
00a3e8d7 : PUSH EAX
00a3e8d8 : MOV EAX,dword ptr [EDX + 0x44]
00a3e8db : MOV ECX,ESI
00a3e8dd : CALL EAX
00a3e8df : MOV byte ptr [EBP + -0x4],0x1
00a3e8e3 : MOV ECX,EDI
00a3e8e5 : CALL 0x00406560
00a3e8ea : MOV dword ptr [EBP + -0x4],0xffffffff
00a3e8f1 : LEA ECX,[EBP + -0x44]
00a3e8f4 : CALL 0x00406560
00a3e8f9 : JMP 0x00a3e943
00a3e8fb : CMP word ptr [ESI + 0x8],0x7
00a3e900 : JNZ 0x00a3e934
00a3e902 : CMP byte ptr [ESI + 0x101],0x0
00a3e909 : JZ 0x00a3e934
00a3e90b : MOV ECX,dword ptr [0x00da9894]
00a3e911 : MOV EDX,dword ptr [ECX]
00a3e913 : MOV ESI,dword ptr [EDX + 0x168]
00a3e919 : CALL 0x009a4db0
00a3e91e : MOV AL,0x1
00a3e920 : MOV ECX,dword ptr [EBP + -0xc]
00a3e923 : MOV dword ptr FS:[0x0],ECX
00a3e92a : POP ECX
00a3e92b : POP EDI
00a3e92c : POP ESI
00a3e92d : POP EBX
00a3e92e : MOV ESP,EBP
00a3e930 : POP EBP
00a3e931 : RET 0x8
00a3e934 : XOR EAX,EAX
00a3e936 : MOV word ptr [EBX + 0x770],AX
00a3e93d : MOV byte ptr [EBX + 0x772],AL
00a3e943 : XOR AL,AL
00a3e945 : MOV ECX,dword ptr [EBP + -0xc]
00a3e948 : MOV dword ptr FS:[0x0],ECX
00a3e94f : POP ECX
00a3e950 : POP EDI
00a3e951 : POP ESI
00a3e952 : POP EBX
00a3e953 : MOV ESP,EBP
00a3e955 : POP EBP
00a3e956 : RET 0x8
