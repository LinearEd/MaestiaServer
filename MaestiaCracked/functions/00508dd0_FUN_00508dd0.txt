PROGRAM  : Maestia.exe
FUNCTION : FUN_00508dd0
ENTRY    : 00508dd0
BODY     : [[00508dd0, 00508f13]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00508dd0(undefined4 param_1,uint *param_2,uint param_3)

{
  uint *puVar1;
  int iVar2;
  uint *puVar3;
  int *piVar4;
  int iVar5;
  int iVar6;
  int *in_ECX;
  uint uVar7;
  uint uVar8;
  int iVar9;
  
  piVar4 = (int *)*in_ECX;
  if (piVar4 == (int *)0x0) {
    iVar9 = 8;
  }
  else {
    if ((uint)(*piVar4 * 5) <= piVar4[1] * 4 + 4U) goto LAB_00508e0b;
    iVar9 = piVar4[1] * 2 + 2;
  }
  FUN_00508740(param_1,iVar9);
LAB_00508e0b:
  piVar4 = (int *)*in_ECX;
  param_3 = param_3 & piVar4[1];
  *piVar4 = *piVar4 + 1;
  iVar9 = *in_ECX;
  puVar1 = (uint *)(iVar9 + 8 + param_3 * 0xc);
  if (*puVar1 == 0xfffffffe) {
    *puVar1 = 0xffffffff;
    puVar1[1] = *param_2;
    uVar8 = param_2[1];
    if (uVar8 != 0) {
      *(uint *)(uVar8 + 8) = *(int *)(uVar8 + 8) + 1U & 0x8fffffff;
    }
    puVar1[2] = param_2[1];
    return;
  }
  uVar8 = param_3;
  do {
    uVar8 = uVar8 + 1 & *(uint *)(iVar9 + 4);
  } while (*(int *)(iVar9 + 8 + uVar8 * 0xc) != -2);
  iVar2 = iVar9 + 8 + uVar8 * 0xc;
  iVar6 = 4;
  uVar7 = 0x1505;
  do {
    iVar5 = iVar6 + 3;
    iVar6 = iVar6 + -1;
    uVar7 = uVar7 * 0x1003f + (uint)*(byte *)((int)puVar1 + iVar5);
  } while (iVar6 != 0);
  if ((uVar7 & *(uint *)(iVar9 + 4)) != param_3) {
    iVar6 = FUN_005040e0(*(uint *)(iVar9 + 4));
    puVar3 = (uint *)(iVar9 + 8 + iVar6 * 0xc);
    for (uVar7 = *(uint *)(iVar9 + 8 + iVar6 * 0xc); uVar7 != param_3;
        uVar7 = *(uint *)(iVar9 + 8 + uVar7 * 0xc)) {
      uVar7 = *puVar3;
      puVar3 = (uint *)(iVar9 + 8 + uVar7 * 0xc);
    }
    if (iVar2 != 0) {
      FUN_005072c0(puVar1);
    }
    *puVar3 = uVar8;
    FUN_005050e0(param_2);
    *puVar1 = 0xffffffff;
    return;
  }
  if (iVar2 != 0) {
    FUN_005072c0(puVar1);
  }
  FUN_005050e0(param_2);
  *puVar1 = uVar8;
  return;
}



============================================================
DISASSEMBLY
============================================================
00508dd0 : PUSH EBX
00508dd1 : PUSH EBP
00508dd2 : PUSH ESI
00508dd3 : MOV ESI,ECX
00508dd5 : MOV EAX,dword ptr [ESI]
00508dd7 : TEST EAX,EAX
00508dd9 : JNZ 0x00508de4
00508ddb : MOV EAX,dword ptr [ESP + 0x10]
00508ddf : PUSH 0x8
00508de1 : PUSH EAX
00508de2 : JMP 0x00508e06
00508de4 : MOV ECX,dword ptr [EAX + 0x4]
00508de7 : LEA EDX,[ECX*0x4 + 0x4]
00508dee : MOV ECX,dword ptr [EAX]
00508df0 : LEA ECX,[ECX + ECX*0x4]
00508df3 : CMP ECX,EDX
00508df5 : JBE 0x00508e0b
00508df7 : MOV EDX,dword ptr [EAX + 0x4]
00508dfa : MOV ECX,dword ptr [ESP + 0x10]
00508dfe : LEA EAX,[EDX + EDX*0x1 + 0x2]
00508e02 : PUSH EAX
00508e03 : PUSH ECX
00508e04 : MOV ECX,ESI
00508e06 : CALL 0x00508740
00508e0b : MOV EAX,dword ptr [ESI]
00508e0d : MOV EBP,dword ptr [ESP + 0x18]
00508e11 : AND EBP,dword ptr [EAX + 0x4]
00508e14 : INC dword ptr [EAX]
00508e16 : MOV ESI,dword ptr [ESI]
00508e18 : LEA EDX,[EBP + EBP*0x2]
00508e1c : LEA EBX,[ESI + EDX*0x4 + 0x8]
00508e20 : MOV ECX,0xfffffffe
00508e25 : MOV dword ptr [ESP + 0x18],EBX
00508e29 : CMP dword ptr [EBX],ECX
00508e2b : JNZ 0x00508e5c
00508e2d : MOV ECX,dword ptr [ESP + 0x14]
00508e31 : MOV dword ptr [EBX],0xffffffff
00508e37 : MOV EAX,dword ptr [ECX]
00508e39 : MOV dword ptr [EBX + 0x4],EAX
00508e3c : MOV EAX,dword ptr [ECX + 0x4]
00508e3f : TEST EAX,EAX
00508e41 : JZ 0x00508e50
00508e43 : MOV EDX,dword ptr [EAX + 0x8]
00508e46 : INC EDX
00508e47 : AND EDX,0x8fffffff
00508e4d : MOV dword ptr [EAX + 0x8],EDX
00508e50 : MOV EAX,dword ptr [ECX + 0x4]
00508e53 : POP ESI
00508e54 : POP EBP
00508e55 : MOV dword ptr [EBX + 0x8],EAX
00508e58 : POP EBX
00508e59 : RET 0xc
00508e5c : MOV EAX,dword ptr [ESI + 0x4]
00508e5f : PUSH EDI
00508e60 : MOV EDI,EBP
00508e62 : INC EDI
00508e63 : AND EDI,EAX
00508e65 : LEA EDX,[EDI + EDI*0x2]
00508e68 : CMP dword ptr [ESI + EDX*0x4 + 0x8],ECX
00508e6c : JNZ 0x00508e62
00508e6e : LEA EAX,[EDI + EDI*0x2]
00508e71 : LEA ECX,[ESI + EAX*0x4 + 0x8]
00508e75 : MOV dword ptr [ESP + 0x14],ECX
00508e79 : MOV EAX,0x4
00508e7e : MOV EDX,0x1505
00508e83 : MOVZX ECX,byte ptr [EBX + EAX*0x1 + 0x3]
00508e88 : IMUL EDX,EDX,0x1003f
00508e8e : DEC EAX
00508e8f : ADD EDX,ECX
00508e91 : TEST EAX,EAX
00508e93 : JA 0x00508e83
00508e95 : MOV EAX,dword ptr [ESI + 0x4]
00508e98 : AND EDX,EAX
00508e9a : CMP EDX,EBP
00508e9c : JNZ 0x00508ec2
00508e9e : MOV ECX,dword ptr [ESP + 0x14]
00508ea2 : TEST ECX,ECX
00508ea4 : JZ 0x00508eac
00508ea6 : PUSH EBX
00508ea7 : CALL 0x005072c0
00508eac : MOV EDX,dword ptr [ESP + 0x18]
00508eb0 : PUSH EDX
00508eb1 : LEA ECX,[EBX + 0x4]
00508eb4 : CALL 0x005050e0
00508eb9 : MOV dword ptr [EBX],EDI
00508ebb : POP EDI
00508ebc : POP ESI
00508ebd : POP EBP
00508ebe : POP EBX
00508ebf : RET 0xc
00508ec2 : PUSH EAX
00508ec3 : MOV ECX,EBX
00508ec5 : CALL 0x005040e0
00508eca : LEA EAX,[EAX + EAX*0x2]
00508ecd : CMP dword ptr [ESI + EAX*0x4 + 0x8],EBP
00508ed1 : LEA EBX,[ESI + EAX*0x4 + 0x8]
00508ed5 : JZ 0x00508ee6
00508ed7 : MOV EBX,dword ptr [EBX]
00508ed9 : LEA ECX,[EBX + EBX*0x2]
00508edc : CMP dword ptr [ESI + ECX*0x4 + 0x8],EBP
00508ee0 : LEA EBX,[ESI + ECX*0x4 + 0x8]
00508ee4 : JNZ 0x00508ed7
00508ee6 : MOV ECX,dword ptr [ESP + 0x14]
00508eea : MOV ESI,dword ptr [ESP + 0x1c]
00508eee : TEST ECX,ECX
00508ef0 : JZ 0x00508ef8
00508ef2 : PUSH ESI
00508ef3 : CALL 0x005072c0
00508ef8 : MOV EDX,dword ptr [ESP + 0x18]
00508efc : PUSH EDX
00508efd : LEA ECX,[ESI + 0x4]
00508f00 : MOV dword ptr [EBX],EDI
00508f02 : CALL 0x005050e0
00508f07 : POP EDI
00508f08 : MOV dword ptr [ESI],0xffffffff
00508f0e : POP ESI
00508f0f : POP EBP
00508f10 : POP EBX
00508f11 : RET 0xc
