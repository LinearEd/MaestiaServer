PROGRAM  : Maestia.exe
FUNCTION : FUN_00a380f0
ENTRY    : 00a380f0
BODY     : [[00a380f0, 00a38273]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00a380f0(void)

{
  int *piVar1;
  int iVar2;
  DWORD DVar3;
  int iVar4;
  uint uVar5;
  int iVar6;
  int unaff_ESI;
  int local_8;
  
  DVar3 = timeGetTime();
  local_8 = 0;
  if (*(int *)(unaff_ESI + 0x498) == 0) {
    *(undefined1 *)(unaff_ESI + 0x4a8) = 1;
    *(undefined1 *)(unaff_ESI + 0x4a9) = 1;
    FUN_00401c00(*(undefined4 *)(*(int *)(unaff_ESI + 0x4a0) + 4));
    *(int *)(*(int *)(unaff_ESI + 0x4a0) + 4) = *(int *)(unaff_ESI + 0x4a0);
    *(undefined4 *)(unaff_ESI + 0x4a4) = 0;
    *(undefined4 *)*(undefined4 *)(unaff_ESI + 0x4a0) = *(undefined4 *)(unaff_ESI + 0x4a0);
    *(int *)(*(int *)(unaff_ESI + 0x4a0) + 8) = *(int *)(unaff_ESI + 0x4a0);
    *(undefined4 *)(unaff_ESI + 0x254) = 0xffffffff;
    local_8 = 0;
  }
  else {
    do {
      piVar1 = *(int **)(unaff_ESI + 0x47c);
      uVar5 = *(uint *)(unaff_ESI + 0x494) >> 2;
      if (piVar1 == (int *)0x0) {
        iVar6 = 0;
      }
      else {
        iVar6 = *piVar1;
      }
      if (*(uint *)(iVar6 + 0x14) <= uVar5) {
        if (piVar1 == (int *)0x0) {
          iVar6 = 0;
        }
        else {
          iVar6 = *piVar1;
        }
        uVar5 = uVar5 - *(int *)(iVar6 + 0x14);
      }
      if (piVar1 == (int *)0x0) {
        iVar6 = 0;
      }
      else {
        iVar6 = *piVar1;
      }
      iVar6 = *(int *)(*(int *)(*(int *)(iVar6 + 0x10) + uVar5 * 4) +
                      (*(uint *)(unaff_ESI + 0x494) & 3) * 4);
      if (*(int *)(unaff_ESI + 0x498) != 0) {
        *(int *)(unaff_ESI + 0x494) = *(int *)(unaff_ESI + 0x494) + 1;
        if ((uint)(*(int *)(unaff_ESI + 0x490) * 4) <= *(uint *)(unaff_ESI + 0x494)) {
          *(undefined4 *)(unaff_ESI + 0x494) = 0;
        }
        iVar4 = *(int *)(unaff_ESI + 0x498) + -1;
        *(int *)(unaff_ESI + 0x498) = iVar4;
        if (iVar4 == 0) {
          *(undefined4 *)(unaff_ESI + 0x494) = 0;
        }
      }
      iVar4 = FUN_00a1a840(iVar6);
      if (((iVar4 != 0) || (iVar4 = FUN_00a1a6d0(iVar6), iVar4 != 0)) ||
         (iVar4 = FUN_00a1a780(iVar6), iVar4 != 0)) {
        iVar2 = iVar6;
        if ((iVar6 != *(int *)(unaff_ESI + 0x24c)) &&
           (iVar2 = local_8, 10 < DVar3 - *(int *)(unaff_ESI + 0x310))) {
          if (*(char *)(iVar4 + 0x3ad) != '\0') {
            FUN_00a364b0(iVar6,0);
            FUN_00a0d390(DAT_017247d4,5);
            local_8 = iVar6;
          }
          *(DWORD *)(unaff_ESI + 0x310) = DVar3;
          iVar2 = local_8;
        }
        break;
      }
      iVar2 = local_8;
    } while (*(int *)(unaff_ESI + 0x498) != 0);
    local_8 = iVar2;
    if (*(int *)(unaff_ESI + 0x498) == 0) {
      *(undefined1 *)(unaff_ESI + 0x4a8) = 1;
      *(undefined1 *)(unaff_ESI + 0x4a9) = 1;
      return local_8;
    }
  }
  return local_8;
}



============================================================
DISASSEMBLY
============================================================
00a380f0 : PUSH EBP
00a380f1 : MOV EBP,ESP
00a380f3 : SUB ESP,0x8
00a380f6 : PUSH EBX
00a380f7 : PUSH EDI
00a380f8 : CALL dword ptr [0x00b85598]
00a380fe : XOR EBX,EBX
00a38100 : MOV dword ptr [EBP + -0x8],EAX
00a38103 : MOV dword ptr [EBP + -0x4],EBX
00a38106 : CMP dword ptr [ESI + 0x498],EBX
00a3810c : JZ 0x00a38229
00a38112 : MOV EAX,dword ptr [ESI + 0x494]
00a38118 : MOV EDX,dword ptr [ESI + 0x47c]
00a3811e : MOV ECX,EAX
00a38120 : SHR ECX,0x2
00a38123 : AND EAX,0x3
00a38126 : CMP EDX,EBX
00a38128 : JZ 0x00a3812e
00a3812a : MOV EDI,dword ptr [EDX]
00a3812c : JMP 0x00a38130
00a3812e : XOR EDI,EDI
00a38130 : CMP dword ptr [EDI + 0x14],ECX
00a38133 : JA 0x00a38142
00a38135 : CMP EDX,EBX
00a38137 : JZ 0x00a3813d
00a38139 : MOV EDI,dword ptr [EDX]
00a3813b : JMP 0x00a3813f
00a3813d : XOR EDI,EDI
00a3813f : SUB ECX,dword ptr [EDI + 0x14]
00a38142 : CMP EDX,EBX
00a38144 : JZ 0x00a3814a
00a38146 : MOV EDX,dword ptr [EDX]
00a38148 : JMP 0x00a3814c
00a3814a : XOR EDX,EDX
00a3814c : MOV EDX,dword ptr [EDX + 0x10]
00a3814f : MOV ECX,dword ptr [EDX + ECX*0x4]
00a38152 : MOV EDI,dword ptr [ECX + EAX*0x4]
00a38155 : MOV EAX,dword ptr [ESI + 0x498]
00a3815b : CMP EAX,EBX
00a3815d : JZ 0x00a38190
00a3815f : MOV EDX,dword ptr [ESI + 0x490]
00a38165 : INC dword ptr [ESI + 0x494]
00a3816b : MOV ECX,dword ptr [ESI + 0x494]
00a38171 : ADD EDX,EDX
00a38173 : ADD EDX,EDX
00a38175 : CMP EDX,ECX
00a38177 : JA 0x00a3817f
00a38179 : MOV dword ptr [ESI + 0x494],EBX
00a3817f : DEC EAX
00a38180 : MOV dword ptr [ESI + 0x498],EAX
00a38186 : CMP EAX,EBX
00a38188 : JNZ 0x00a38190
00a3818a : MOV dword ptr [ESI + 0x494],EBX
00a38190 : PUSH EDI
00a38191 : MOV ECX,ESI
00a38193 : CALL 0x00a1a840
00a38198 : CMP EAX,EBX
00a3819a : JNZ 0x00a381c2
00a3819c : PUSH EDI
00a3819d : MOV ECX,ESI
00a3819f : CALL 0x00a1a6d0
00a381a4 : CMP EAX,EBX
00a381a6 : JNZ 0x00a381c2
00a381a8 : PUSH EDI
00a381a9 : MOV ECX,ESI
00a381ab : CALL 0x00a1a780
00a381b0 : CMP EAX,EBX
00a381b2 : JNZ 0x00a381c2
00a381b4 : CMP dword ptr [ESI + 0x498],EBX
00a381ba : JNZ 0x00a38112
00a381c0 : JMP 0x00a3820a
00a381c2 : CMP EDI,dword ptr [ESI + 0x24c]
00a381c8 : JZ 0x00a38207
00a381ca : MOV ECX,dword ptr [EBP + -0x8]
00a381cd : SUB ECX,dword ptr [ESI + 0x310]
00a381d3 : CMP ECX,0xa
00a381d6 : JBE 0x00a3820a
00a381d8 : CMP byte ptr [EAX + 0x3ad],BL
00a381de : JZ 0x00a381fc
00a381e0 : PUSH EBX
00a381e1 : PUSH EDI
00a381e2 : MOV ECX,ESI
00a381e4 : CALL 0x00a364b0
00a381e9 : MOV EDX,dword ptr [0x017247d4]
00a381ef : PUSH 0x5
00a381f1 : PUSH EDX
00a381f2 : MOV ECX,EDI
00a381f4 : CALL 0x00a0d390
00a381f9 : MOV dword ptr [EBP + -0x4],EDI
00a381fc : MOV EAX,dword ptr [EBP + -0x8]
00a381ff : MOV dword ptr [ESI + 0x310],EAX
00a38205 : JMP 0x00a3820a
00a38207 : MOV dword ptr [EBP + -0x4],EDI
00a3820a : MOV EAX,dword ptr [EBP + -0x4]
00a3820d : CMP dword ptr [ESI + 0x498],EBX
00a38213 : JNZ 0x00a3826e
00a38215 : MOV byte ptr [ESI + 0x4a8],0x1
00a3821c : MOV byte ptr [ESI + 0x4a9],0x1
00a38223 : POP EDI
00a38224 : POP EBX
00a38225 : MOV ESP,EBP
00a38227 : POP EBP
00a38228 : RET
00a38229 : MOV byte ptr [ESI + 0x4a8],0x1
00a38230 : MOV byte ptr [ESI + 0x4a9],0x1
00a38237 : MOV ECX,dword ptr [ESI + 0x4a0]
00a3823d : MOV EDX,dword ptr [ECX + 0x4]
00a38240 : LEA EDI,[ESI + 0x49c]
00a38246 : PUSH EDX
00a38247 : MOV ECX,EDI
00a38249 : CALL 0x00401c00
00a3824e : MOV EAX,dword ptr [EDI + 0x4]
00a38251 : MOV dword ptr [EAX + 0x4],EAX
00a38254 : MOV EAX,dword ptr [EDI + 0x4]
00a38257 : MOV dword ptr [EDI + 0x8],EBX
00a3825a : MOV dword ptr [EAX],EAX
00a3825c : MOV EDI,dword ptr [EDI + 0x4]
00a3825f : MOV dword ptr [EDI + 0x8],EDI
00a38262 : MOV dword ptr [ESI + 0x254],0xffffffff
00a3826c : MOV EAX,EBX
00a3826e : POP EDI
00a3826f : POP EBX
00a38270 : MOV ESP,EBP
00a38272 : POP EBP
00a38273 : RET
