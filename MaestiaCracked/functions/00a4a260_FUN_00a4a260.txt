PROGRAM  : Maestia.exe
FUNCTION : FUN_00a4a260
ENTRY    : 00a4a260
BODY     : [[00a4a260, 00a4a309] [00a4a310, 00a4a3b1] [00a4a3b4, 00a4a3e2] [00a4a3e5, 00a4a425]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00a4a260(int param_1,undefined4 param_2,int *param_3,undefined2 *param_4)

{
  undefined4 *puVar1;
  undefined2 *puVar2;
  uint uVar3;
  int iVar4;
  int *piVar5;
  int iVar6;
  undefined1 local_24 [4];
  int local_20;
  undefined4 *local_1c;
  int local_18;
  undefined4 local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b171a4;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  iVar4 = FUN_00a49990();
  if ((iVar4 == 0) || (iVar4 = *(int *)(iVar4 + 300), iVar4 == 0)) {
    ExceptionList = local_10;
    return 0;
  }
  local_20 = 0;
  local_1c = (undefined4 *)0x0;
  local_18 = 0;
  local_8 = 0;
  switch(param_2) {
  case 4:
    piVar5 = (int *)(iVar4 + 0x388);
    break;
  case 5:
    piVar5 = (int *)(iVar4 + 0x354);
    break;
  default:
    ExceptionList = local_10;
    return 0;
  case 7:
    piVar5 = (int *)(iVar4 + 0x3bc);
    break;
  case 9:
    piVar5 = (int *)(iVar4 + 0x3f0);
  }
  param_1 = (**(code **)(*piVar5 + 4))(uVar3);
  iVar4 = 0;
  puVar1 = (undefined4 *)0x0;
  puVar2 = param_4;
  while (param_4 = puVar2, param_1 != 0) {
    local_14 = FUN_004f5680();
    if (iVar4 == 0) {
      uVar3 = 0;
    }
    else {
      uVar3 = local_18 - iVar4 >> 2;
    }
    if ((uint)((int)puVar1 - iVar4 >> 2) < uVar3) {
      *puVar1 = local_14;
      local_1c = puVar1 + 1;
      puVar1 = local_1c;
      puVar2 = param_4;
    }
    else {
      FUN_004d2c60(local_24,puVar1,&local_14);
      iVar4 = local_20;
      puVar1 = local_1c;
      puVar2 = param_4;
    }
  }
  iVar6 = (int)puVar1 - iVar4 >> 2;
  if (0 < iVar6) {
    param_1 = 0;
    piVar5 = param_3;
    if (param_3 == (int *)0x0) {
      piVar5 = &param_1;
    }
    iVar6 = *piVar5 % iVar6;
    *piVar5 = iVar6;
    if (puVar2 != (undefined2 *)0x0) {
      *puVar2 = *(undefined2 *)(*(int *)(iVar4 + iVar6 * 4) + 6);
    }
    iVar6 = *(int *)(iVar4 + *piVar5 * 4);
    local_8 = 0xffffffff;
    if (iVar4 != 0) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    ExceptionList = local_10;
    return CONCAT22(*(undefined2 *)(iVar6 + 4),*(undefined2 *)(iVar6 + 6));
  }
  local_8 = 0xffffffff;
  if (iVar4 != 0) {
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  ExceptionList = local_10;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
00a4a260 : PUSH EBP
00a4a261 : MOV EBP,ESP
00a4a263 : PUSH -0x1
00a4a265 : PUSH 0xb171a4
00a4a26a : MOV EAX,FS:[0x0]
00a4a270 : PUSH EAX
00a4a271 : SUB ESP,0x14
00a4a274 : PUSH EBX
00a4a275 : PUSH ESI
00a4a276 : PUSH EDI
00a4a277 : MOV EAX,[0x00d66fa0]
00a4a27c : XOR EAX,EBP
00a4a27e : PUSH EAX
00a4a27f : LEA EAX,[EBP + -0xc]
00a4a282 : MOV FS:[0x0],EAX
00a4a288 : CMP byte ptr [EBP + 0x8],0x0
00a4a28c : SETNZ AL
00a4a28f : MOVZX ECX,AL
00a4a292 : PUSH ECX
00a4a293 : PUSH EDX
00a4a294 : CALL 0x00a49990
00a4a299 : XOR ESI,ESI
00a4a29b : ADD ESP,0x8
00a4a29e : CMP EAX,ESI
00a4a2a0 : JZ 0x00a4a412
00a4a2a6 : MOV EAX,dword ptr [EAX + 0x12c]
00a4a2ac : CMP EAX,ESI
00a4a2ae : JZ 0x00a4a412
00a4a2b4 : MOV dword ptr [EBP + -0x1c],ESI
00a4a2b7 : XOR EDI,EDI
00a4a2b9 : MOV dword ptr [EBP + -0x18],EDI
00a4a2bc : MOV dword ptr [EBP + -0x14],ESI
00a4a2bf : MOV dword ptr [EBP + -0x4],ESI
00a4a2c2 : MOV ECX,dword ptr [EBP + 0xc]
00a4a2c5 : ADD ECX,-0x4
00a4a2c8 : CMP ECX,0x5
00a4a2cb : JA 0x00a4a402
00a4a2d1 : JMP dword ptr [ECX*0x4 + 0xa4a428]
00a4a2d8 : LEA EBX,[EAX + 0x354]
00a4a2de : JMP 0x00a4a2f6
00a4a2e0 : LEA EBX,[EAX + 0x388]
00a4a2e6 : JMP 0x00a4a2f6
00a4a2e8 : LEA EBX,[EAX + 0x3bc]
00a4a2ee : JMP 0x00a4a2f6
00a4a2f0 : LEA EBX,[EAX + 0x3f0]
00a4a2f6 : MOV EAX,dword ptr [EBX]
00a4a2f8 : MOV EDX,dword ptr [EAX + 0x4]
00a4a2fb : MOV ECX,EBX
00a4a2fd : CALL EDX
00a4a2ff : XOR ECX,ECX
00a4a301 : MOV dword ptr [EBP + 0x8],EAX
00a4a304 : CMP EAX,ECX
00a4a306 : JZ 0x00a4a35e
00a4a308 : JMP 0x00a4a310
00a4a310 : LEA EDX,[EBP + 0x8]
00a4a313 : MOV EAX,EBX
00a4a315 : CALL 0x004f5680
00a4a31a : MOV dword ptr [EBP + -0x10],EAX
00a4a31d : TEST ESI,ESI
00a4a31f : JNZ 0x00a4a325
00a4a321 : XOR ECX,ECX
00a4a323 : JMP 0x00a4a32d
00a4a325 : MOV ECX,dword ptr [EBP + -0x14]
00a4a328 : SUB ECX,ESI
00a4a32a : SAR ECX,0x2
00a4a32d : MOV EDX,EDI
00a4a32f : SUB EDX,ESI
00a4a331 : SAR EDX,0x2
00a4a334 : CMP EDX,ECX
00a4a336 : JNC 0x00a4a342
00a4a338 : MOV dword ptr [EDI],EAX
00a4a33a : ADD EDI,0x4
00a4a33d : MOV dword ptr [EBP + -0x18],EDI
00a4a340 : JMP 0x00a4a356
00a4a342 : LEA EAX,[EBP + -0x10]
00a4a345 : PUSH EAX
00a4a346 : PUSH EDI
00a4a347 : LEA ECX,[EBP + -0x20]
00a4a34a : PUSH ECX
00a4a34b : CALL 0x004d2c60
00a4a350 : MOV EDI,dword ptr [EBP + -0x18]
00a4a353 : MOV ESI,dword ptr [EBP + -0x1c]
00a4a356 : CMP dword ptr [EBP + 0x8],0x0
00a4a35a : JNZ 0x00a4a310
00a4a35c : XOR ECX,ECX
00a4a35e : SUB EDI,ESI
00a4a360 : SAR EDI,0x2
00a4a363 : CMP EDI,ECX
00a4a365 : JLE 0x00a4a3d1
00a4a367 : MOV EBX,dword ptr [EBP + 0x10]
00a4a36a : MOV dword ptr [EBP + 0x8],ECX
00a4a36d : CMP EBX,ECX
00a4a36f : JNZ 0x00a4a376
00a4a371 : LEA EDX,[EBP + 0x8]
00a4a374 : MOV EBX,EDX
00a4a376 : MOV EAX,dword ptr [EBX]
00a4a378 : CDQ
00a4a379 : IDIV EDI
00a4a37b : MOV EAX,dword ptr [EBP + 0x14]
00a4a37e : MOV dword ptr [EBX],EDX
00a4a380 : CMP EAX,ECX
00a4a382 : JZ 0x00a4a38e
00a4a384 : MOV EDX,dword ptr [ESI + EDX*0x4]
00a4a387 : MOV DX,word ptr [EDX + 0x6]
00a4a38b : MOV word ptr [EAX],DX
00a4a38e : MOV EAX,dword ptr [EBX]
00a4a390 : MOV EAX,dword ptr [ESI + EAX*0x4]
00a4a393 : MOVZX EDI,word ptr [EAX + 0x4]
00a4a397 : MOVZX EDX,word ptr [EAX + 0x6]
00a4a39b : SHL EDI,0x10
00a4a39e : OR EDI,EDX
00a4a3a0 : MOV dword ptr [EBP + -0x4],0xffffffff
00a4a3a7 : CMP ESI,ECX
00a4a3a9 : JZ 0x00a4a3b4
00a4a3ab : MOV ECX,ESI
00a4a3ad : CALL 0x006f04e0
00a4a3b4 : MOV dword ptr [EBP + -0x1c],ECX
00a4a3b7 : MOV dword ptr [EBP + -0x18],ECX
00a4a3ba : MOV dword ptr [EBP + -0x14],ECX
00a4a3bd : MOV EAX,EDI
00a4a3bf : MOV ECX,dword ptr [EBP + -0xc]
00a4a3c2 : MOV dword ptr FS:[0x0],ECX
00a4a3c9 : POP ECX
00a4a3ca : POP EDI
00a4a3cb : POP ESI
00a4a3cc : POP EBX
00a4a3cd : MOV ESP,EBP
00a4a3cf : POP EBP
00a4a3d0 : RET
00a4a3d1 : MOV dword ptr [EBP + -0x4],0xffffffff
00a4a3d8 : CMP ESI,ECX
00a4a3da : JZ 0x00a4a3e5
00a4a3dc : MOV ECX,ESI
00a4a3de : CALL 0x006f04e0
00a4a3e5 : MOV dword ptr [EBP + -0x1c],ECX
00a4a3e8 : MOV dword ptr [EBP + -0x18],ECX
00a4a3eb : MOV dword ptr [EBP + -0x14],ECX
00a4a3ee : XOR EAX,EAX
00a4a3f0 : MOV ECX,dword ptr [EBP + -0xc]
00a4a3f3 : MOV dword ptr FS:[0x0],ECX
00a4a3fa : POP ECX
00a4a3fb : POP EDI
00a4a3fc : POP ESI
00a4a3fd : POP EBX
00a4a3fe : MOV ESP,EBP
00a4a400 : POP EBP
00a4a401 : RET
00a4a402 : MOV dword ptr [EBP + -0x4],0xffffffff
00a4a409 : MOV dword ptr [EBP + -0x1c],ESI
00a4a40c : MOV dword ptr [EBP + -0x18],ESI
00a4a40f : MOV dword ptr [EBP + -0x14],ESI
00a4a412 : XOR EAX,EAX
00a4a414 : MOV ECX,dword ptr [EBP + -0xc]
00a4a417 : MOV dword ptr FS:[0x0],ECX
00a4a41e : POP ECX
00a4a41f : POP EDI
00a4a420 : POP ESI
00a4a421 : POP EBX
00a4a422 : MOV ESP,EBP
00a4a424 : POP EBP
00a4a425 : RET
