PROGRAM  : Maestia.exe
FUNCTION : FUN_008437c0
ENTRY    : 008437c0
BODY     : [[008437c0, 0084385c] [00843860, 00843939] [00843940, 00843970]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void FUN_008437c0(int param_1)

{
  short sVar1;
  wchar_t wVar2;
  int iVar3;
  bool bVar4;
  int iVar5;
  wchar_t *pwVar6;
  int iVar7;
  wchar_t local_1008;
  undefined1 local_1006 [2044];
  short sStack_80a;
  wchar_t local_808;
  short local_806 [1023];
  uint local_8;
  
  local_8 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  local_1008 = L'\0';
  _memset(local_1006,0,0x7fe);
  local_808 = L'\0';
  _memset(local_806,0,0x7fe);
  if (*(uint *)(param_1 + 0x18) < 8) {
    pwVar6 = (wchar_t *)(param_1 + 4);
  }
  else {
    pwVar6 = *(wchar_t **)(param_1 + 4);
  }
  _wcscpy_s(&local_808,0x400,pwVar6);
  iVar3 = *(int *)(param_1 + 0x14);
  iVar7 = 0;
  if (iVar3 != 0) {
    iVar5 = 0;
    if (0 < iVar3) {
      do {
        if (local_806[iVar5 + -1] == 0x20) {
          sVar1 = local_806[iVar5];
          while ((sVar1 == 0x20 && (iVar5 < iVar3))) {
            iVar5 = iVar5 + 1;
            sVar1 = local_806[iVar5];
          }
        }
        if ((local_806[iVar5 + -1] == 10) || (local_806[iVar5 + -1] == 0xd)) {
          bVar4 = false;
          if (((&sStack_80a)[iVar5] != 0x2e) && ((&sStack_80a)[iVar5] != 0x20)) {
            *(undefined2 *)(local_1006 + iVar7 * 2 + -2) = 0x20;
            iVar7 = iVar7 + 1;
            bVar4 = true;
          }
          if (local_806[iVar5] == 0x20) {
            do {
              if (iVar3 <= iVar5) goto LAB_008438d6;
              iVar5 = iVar5 + 1;
              bVar4 = true;
            } while (local_806[iVar5] == 0x20);
          }
          else {
LAB_008438d6:
            if (!bVar4) goto LAB_008438da;
          }
        }
        else {
LAB_008438da:
          if (local_806[iVar5 + -1] != 0) {
            *(short *)(local_1006 + iVar7 * 2 + -2) = local_806[iVar5 + -1];
            iVar7 = iVar7 + 1;
          }
          if (0x3ff < iVar7) goto LAB_0084395e;
        }
        iVar5 = iVar5 + 1;
      } while (iVar5 < iVar3);
    }
    *(undefined2 *)(local_1006 + iVar7 * 2 + -2) = 10;
    _wcscpy_s(&local_808,0x400,&local_1008);
    pwVar6 = &local_808;
    do {
      wVar2 = *pwVar6;
      pwVar6 = pwVar6 + 1;
    } while (wVar2 != L'\0');
    FUN_00406360(&local_808,(int)pwVar6 - (int)local_806 >> 1);
  }
LAB_0084395e:
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
008437c0 : PUSH EBP
008437c1 : MOV EBP,ESP
008437c3 : MOV EAX,0x1008
008437c8 : CALL 0x0063b780
008437cd : MOV EAX,[0x00d66fa0]
008437d2 : XOR EAX,EBP
008437d4 : MOV dword ptr [EBP + -0x4],EAX
008437d7 : PUSH EBX
008437d8 : MOV EBX,dword ptr [EBP + 0x8]
008437db : PUSH ESI
008437dc : PUSH EDI
008437dd : XOR EAX,EAX
008437df : PUSH 0x7fe
008437e4 : PUSH EAX
008437e5 : LEA ECX,[EBP + 0xffffeffe]
008437eb : PUSH ECX
008437ec : MOV dword ptr [EBP + 0xffffeff8],EBX
008437f2 : MOV word ptr [EBP + 0xffffeffc],AX
008437f9 : CALL 0x0063b700
008437fe : XOR EDX,EDX
00843800 : PUSH 0x7fe
00843805 : PUSH EDX
00843806 : LEA EAX,[EBP + 0xfffff7fe]
0084380c : PUSH EAX
0084380d : MOV word ptr [EBP + 0xfffff7fc],DX
00843814 : CALL 0x0063b700
00843819 : ADD ESP,0x18
0084381c : CMP dword ptr [EBX + 0x18],0x8
00843820 : JC 0x00843827
00843822 : MOV EAX,dword ptr [EBX + 0x4]
00843825 : JMP 0x0084382a
00843827 : LEA EAX,[EBX + 0x4]
0084382a : PUSH EAX
0084382b : LEA ECX,[EBP + 0xfffff7fc]
00843831 : PUSH 0x400
00843836 : PUSH ECX
00843837 : CALL 0x0063481b
0084383c : MOV EDI,dword ptr [EBX + 0x14]
0084383f : ADD ESP,0xc
00843842 : XOR ESI,ESI
00843844 : TEST EDI,EDI
00843846 : JZ 0x0084395e
0084384c : XOR EAX,EAX
0084384e : TEST EDI,EDI
00843850 : JLE 0x00843907
00843856 : MOV EBX,0x20
0084385b : JMP 0x00843860
00843860 : CMP word ptr [EBP + EAX*0x2 + 0xfffff7fc],BX
00843868 : JNZ 0x00843883
0084386a : CMP word ptr [EBP + EAX*0x2 + 0xfffff7fe],BX
00843872 : JNZ 0x00843883
00843874 : CMP EAX,EDI
00843876 : JGE 0x00843883
00843878 : INC EAX
00843879 : CMP word ptr [EBP + EAX*0x2 + 0xfffff7fe],BX
00843881 : JZ 0x00843874
00843883 : MOVZX ECX,word ptr [EBP + EAX*0x2 + 0xfffff7fc]
0084388b : CMP CX,0xa
0084388f : JZ 0x00843897
00843891 : CMP CX,0xd
00843895 : JNZ 0x008438da
00843897 : MOVZX EDX,word ptr [EBP + EAX*0x2 + 0xfffff7fa]
0084389f : XOR CL,CL
008438a1 : CMP DX,0x2e
008438a5 : JZ 0x008438b9
008438a7 : CMP DX,BX
008438aa : JZ 0x008438b9
008438ac : MOV EDX,EBX
008438ae : MOV word ptr [EBP + ESI*0x2 + 0xffffeffc],DX
008438b6 : INC ESI
008438b7 : MOV CL,0x1
008438b9 : CMP word ptr [EBP + EAX*0x2 + 0xfffff7fe],BX
008438c1 : JNZ 0x008438d6
008438c3 : CMP EAX,EDI
008438c5 : JGE 0x008438d6
008438c7 : INC EAX
008438c8 : MOV CL,0x1
008438ca : CMP word ptr [EBP + EAX*0x2 + 0xfffff7fe],BX
008438d2 : JZ 0x008438c3
008438d4 : JMP 0x008438f8
008438d6 : TEST CL,CL
008438d8 : JNZ 0x008438f8
008438da : MOVZX ECX,word ptr [EBP + EAX*0x2 + 0xfffff7fc]
008438e2 : TEST CX,CX
008438e5 : JZ 0x008438f0
008438e7 : MOV word ptr [EBP + ESI*0x2 + 0xffffeffc],CX
008438ef : INC ESI
008438f0 : CMP ESI,0x3ff
008438f6 : JG 0x0084395e
008438f8 : INC EAX
008438f9 : CMP EAX,EDI
008438fb : JL 0x00843860
00843901 : MOV EBX,dword ptr [EBP + 0xffffeff8]
00843907 : LEA ECX,[EBP + 0xffffeffc]
0084390d : PUSH ECX
0084390e : LEA EDX,[EBP + 0xfffff7fc]
00843914 : MOV EAX,0xa
00843919 : PUSH 0x400
0084391e : PUSH EDX
0084391f : MOV word ptr [EBP + ESI*0x2 + 0xffffeffc],AX
00843927 : CALL 0x0063481b
0084392c : LEA EAX,[EBP + 0xfffff7fc]
00843932 : ADD ESP,0xc
00843935 : LEA EDX,[EAX + 0x2]
00843938 : JMP 0x00843940
00843940 : MOV CX,word ptr [EAX]
00843943 : ADD EAX,0x2
00843946 : TEST CX,CX
00843949 : JNZ 0x00843940
0084394b : SUB EAX,EDX
0084394d : SAR EAX,0x1
0084394f : PUSH EAX
00843950 : LEA EAX,[EBP + 0xfffff7fc]
00843956 : PUSH EAX
00843957 : MOV ECX,EBX
00843959 : CALL 0x00406360
0084395e : MOV ECX,dword ptr [EBP + -0x4]
00843961 : POP EDI
00843962 : POP ESI
00843963 : XOR ECX,EBP
00843965 : POP EBX
00843966 : CALL 0x00633e6b
0084396b : MOV ESP,EBP
0084396d : POP EBP
0084396e : RET 0x4
