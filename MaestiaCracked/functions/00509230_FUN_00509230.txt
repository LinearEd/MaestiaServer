PROGRAM  : Maestia.exe
FUNCTION : FUN_00509230
ENTRY    : 00509230
BODY     : [[00509230, 005092e7] [005092f0, 00509380]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00509230(undefined4 param_1,undefined4 *param_2,uint param_3)

{
  uint *puVar1;
  int iVar2;
  int *piVar3;
  uint *puVar4;
  int iVar5;
  int iVar6;
  int *in_ECX;
  uint uVar7;
  uint uVar8;
  int iVar9;
  
  piVar3 = (int *)*in_ECX;
  if (piVar3 == (int *)0x0) {
    iVar9 = 8;
  }
  else {
    if ((uint)(*piVar3 * 5) <= piVar3[1] * 4 + 4U) goto LAB_0050926b;
    iVar9 = piVar3[1] * 2 + 2;
  }
  FUN_00508740(param_1,iVar9);
LAB_0050926b:
  piVar3 = (int *)*in_ECX;
  param_3 = param_3 & piVar3[1];
  *piVar3 = *piVar3 + 1;
  iVar9 = *in_ECX;
  puVar1 = (uint *)(iVar9 + 8 + param_3 * 0xc);
  if (*puVar1 == 0xfffffffe) {
    *puVar1 = 0xffffffff;
    puVar1[1] = *(uint *)*param_2;
    puVar4 = (uint *)param_2[1];
    uVar8 = *puVar4;
    if (uVar8 != 0) {
      *(uint *)(uVar8 + 8) = *(int *)(uVar8 + 8) + 1U & 0x8fffffff;
    }
    puVar1[2] = *puVar4;
    return;
  }
  uVar8 = param_3;
  do {
    uVar8 = uVar8 + 1 & *(uint *)(iVar9 + 4);
  } while (*(int *)(iVar9 + 8 + uVar8 * 0xc) != -2);
  iVar2 = iVar9 + 8 + uVar8 * 0xc;
  iVar6 = 4;
  uVar7 = 0x1505;
  do {
    iVar5 = iVar6 + 3;
    iVar6 = iVar6 + -1;
    uVar7 = uVar7 * 0x1003f + (uint)*(byte *)((int)puVar1 + iVar5);
  } while (iVar6 != 0);
  if ((uVar7 & *(uint *)(iVar9 + 4)) != param_3) {
    iVar6 = FUN_005040e0(*(uint *)(iVar9 + 4));
    puVar4 = (uint *)(iVar9 + 8 + iVar6 * 0xc);
    for (uVar7 = *(uint *)(iVar9 + 8 + iVar6 * 0xc); uVar7 != param_3;
        uVar7 = *(uint *)(iVar9 + 8 + uVar7 * 0xc)) {
      uVar7 = *puVar4;
      puVar4 = (uint *)(iVar9 + 8 + uVar7 * 0xc);
    }
    if (iVar2 != 0) {
      FUN_005072c0(puVar1);
    }
    *puVar4 = uVar8;
    FUN_00505090(param_2);
    *puVar1 = 0xffffffff;
    return;
  }
  if (iVar2 != 0) {
    FUN_005072c0(puVar1);
  }
  FUN_00505090(param_2);
  *puVar1 = uVar8;
  return;
}



============================================================
DISASSEMBLY
============================================================
00509230 : PUSH EBX
00509231 : PUSH EBP
00509232 : PUSH ESI
00509233 : MOV ESI,ECX
00509235 : MOV EAX,dword ptr [ESI]
00509237 : TEST EAX,EAX
00509239 : JNZ 0x00509244
0050923b : MOV EAX,dword ptr [ESP + 0x10]
0050923f : PUSH 0x8
00509241 : PUSH EAX
00509242 : JMP 0x00509266
00509244 : MOV ECX,dword ptr [EAX + 0x4]
00509247 : LEA EDX,[ECX*0x4 + 0x4]
0050924e : MOV ECX,dword ptr [EAX]
00509250 : LEA ECX,[ECX + ECX*0x4]
00509253 : CMP ECX,EDX
00509255 : JBE 0x0050926b
00509257 : MOV EDX,dword ptr [EAX + 0x4]
0050925a : MOV ECX,dword ptr [ESP + 0x10]
0050925e : LEA EAX,[EDX + EDX*0x1 + 0x2]
00509262 : PUSH EAX
00509263 : PUSH ECX
00509264 : MOV ECX,ESI
00509266 : CALL 0x00508740
0050926b : MOV EAX,dword ptr [ESI]
0050926d : MOV EBP,dword ptr [ESP + 0x18]
00509271 : AND EBP,dword ptr [EAX + 0x4]
00509274 : INC dword ptr [EAX]
00509276 : MOV ESI,dword ptr [ESI]
00509278 : LEA EDX,[EBP + EBP*0x2]
0050927c : LEA EBX,[ESI + EDX*0x4 + 0x8]
00509280 : MOV ECX,0xfffffffe
00509285 : MOV dword ptr [ESP + 0x18],EBX
00509289 : CMP dword ptr [EBX],ECX
0050928b : JNZ 0x005092bf
0050928d : MOV EAX,dword ptr [ESP + 0x14]
00509291 : MOV dword ptr [EBX],0xffffffff
00509297 : MOV ECX,dword ptr [EAX]
00509299 : MOV EDX,dword ptr [ECX]
0050929b : MOV dword ptr [EBX + 0x4],EDX
0050929e : MOV ECX,dword ptr [EAX + 0x4]
005092a1 : MOV EAX,dword ptr [ECX]
005092a3 : TEST EAX,EAX
005092a5 : JZ 0x005092b4
005092a7 : MOV EDX,dword ptr [EAX + 0x8]
005092aa : INC EDX
005092ab : AND EDX,0x8fffffff
005092b1 : MOV dword ptr [EAX + 0x8],EDX
005092b4 : MOV EAX,dword ptr [ECX]
005092b6 : POP ESI
005092b7 : POP EBP
005092b8 : MOV dword ptr [EBX + 0x8],EAX
005092bb : POP EBX
005092bc : RET 0xc
005092bf : MOV EAX,dword ptr [ESI + 0x4]
005092c2 : PUSH EDI
005092c3 : MOV EDI,EBP
005092c5 : INC EDI
005092c6 : AND EDI,EAX
005092c8 : LEA EDX,[EDI + EDI*0x2]
005092cb : CMP dword ptr [ESI + EDX*0x4 + 0x8],ECX
005092cf : JNZ 0x005092c5
005092d1 : LEA EAX,[EDI + EDI*0x2]
005092d4 : LEA ECX,[ESI + EAX*0x4 + 0x8]
005092d8 : MOV dword ptr [ESP + 0x14],ECX
005092dc : MOV EAX,0x4
005092e1 : MOV EDX,0x1505
005092e6 : JMP 0x005092f0
005092f0 : MOVZX ECX,byte ptr [EBX + EAX*0x1 + 0x3]
005092f5 : IMUL EDX,EDX,0x1003f
005092fb : DEC EAX
005092fc : ADD EDX,ECX
005092fe : TEST EAX,EAX
00509300 : JA 0x005092f0
00509302 : MOV EAX,dword ptr [ESI + 0x4]
00509305 : AND EDX,EAX
00509307 : CMP EDX,EBP
00509309 : JNZ 0x0050932f
0050930b : MOV ECX,dword ptr [ESP + 0x14]
0050930f : TEST ECX,ECX
00509311 : JZ 0x00509319
00509313 : PUSH EBX
00509314 : CALL 0x005072c0
00509319 : MOV EDX,dword ptr [ESP + 0x18]
0050931d : PUSH EDX
0050931e : LEA ECX,[EBX + 0x4]
00509321 : CALL 0x00505090
00509326 : MOV dword ptr [EBX],EDI
00509328 : POP EDI
00509329 : POP ESI
0050932a : POP EBP
0050932b : POP EBX
0050932c : RET 0xc
0050932f : PUSH EAX
00509330 : MOV ECX,EBX
00509332 : CALL 0x005040e0
00509337 : LEA EAX,[EAX + EAX*0x2]
0050933a : CMP dword ptr [ESI + EAX*0x4 + 0x8],EBP
0050933e : LEA EBX,[ESI + EAX*0x4 + 0x8]
00509342 : JZ 0x00509353
00509344 : MOV EBX,dword ptr [EBX]
00509346 : LEA ECX,[EBX + EBX*0x2]
00509349 : CMP dword ptr [ESI + ECX*0x4 + 0x8],EBP
0050934d : LEA EBX,[ESI + ECX*0x4 + 0x8]
00509351 : JNZ 0x00509344
00509353 : MOV ECX,dword ptr [ESP + 0x14]
00509357 : MOV ESI,dword ptr [ESP + 0x1c]
0050935b : TEST ECX,ECX
0050935d : JZ 0x00509365
0050935f : PUSH ESI
00509360 : CALL 0x005072c0
00509365 : MOV EDX,dword ptr [ESP + 0x18]
00509369 : PUSH EDX
0050936a : LEA ECX,[ESI + 0x4]
0050936d : MOV dword ptr [EBX],EDI
0050936f : CALL 0x00505090
00509374 : POP EDI
00509375 : MOV dword ptr [ESI],0xffffffff
0050937b : POP ESI
0050937c : POP EBP
0050937d : POP EBX
0050937e : RET 0xc
