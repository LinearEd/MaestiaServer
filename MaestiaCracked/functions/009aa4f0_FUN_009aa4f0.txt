PROGRAM  : Maestia.exe
FUNCTION : FUN_009aa4f0
ENTRY    : 009aa4f0
BODY     : [[009aa4f0, 009aa903]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Removing unreachable block (ram,0x009aa7e8) */
/* WARNING: Removing unreachable block (ram,0x009aa88a) */
/* WARNING: Removing unreachable block (ram,0x009aa597) */
/* WARNING: Removing unreachable block (ram,0x009aa5c7) */
/* WARNING: Removing unreachable block (ram,0x009aa844) */
/* WARNING: Removing unreachable block (ram,0x009aa733) */

void FUN_009aa4f0(int param_1)

{
  int *piVar1;
  int *piVar2;
  DWORD DVar3;
  int iVar4;
  undefined4 uVar5;
  int in_ECX;
  int in_EDX;
  undefined4 extraout_EDX;
  uint uVar6;
  undefined4 extraout_EDX_00;
  float10 fVar7;
  float local_6c;
  uint local_4c;
  float fStack_44;
  float fStack_3c;
  float local_38;
  undefined1 local_34 [4];
  undefined2 local_30;
  undefined4 local_20;
  uint local_1c;
  uint local_18;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b2156d;
  local_10 = ExceptionList;
  local_18 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if (param_1 == 0) {
    FUN_00406460();
    local_8 = 0;
    uVar5 = extraout_EDX;
  }
  else {
    local_1c = 7;
    local_20 = 0;
    local_30 = 0;
    local_8 = 1;
    DVar3 = timeGetTime();
    uVar6 = (DVar3 - *(int *)(in_EDX + 0x44)) / 1000;
    if (uVar6 == 0) {
      local_38 = 0.0;
    }
    else {
      local_38 = (float)*(int *)(param_1 + 0x30);
      if (*(int *)(param_1 + 0x30) < 0) {
        local_38 = local_38 + 4.2949673e+09;
      }
      local_38 = local_38 / (float)uVar6;
    }
    if (uVar6 == 0) {
      local_6c = 0.0;
    }
    else {
      local_6c = (float)*(int *)(param_1 + 0x28);
      if (*(int *)(param_1 + 0x28) < 0) {
        local_6c = local_6c + 4.2949673e+09;
      }
      local_6c = local_6c / (float)uVar6;
    }
    if ((*(uint *)(in_EDX + 0x54) == 0) && (*(int *)(in_EDX + 0x50) == 0)) {
      fStack_3c = 0.0;
    }
    else {
      fVar7 = (float10)*(int *)(param_1 + 0x30);
      if (*(int *)(param_1 + 0x30) < 0) {
        fVar7 = fVar7 + (float10)4.2949673e+09;
      }
      fStack_3c = (float)((fVar7 / (-(float10)(longlong)
                                              (((ulonglong)*(uint *)(in_EDX + 0x54) & 0x80000000) <<
                                              0x20) +
                                   (float10)(*(ulonglong *)(in_EDX + 0x50) & 0x7fffffffffffffff))) *
                         (float10)100.0);
    }
    if ((*(uint *)(in_EDX + 0x5c) == 0) && (*(int *)(in_EDX + 0x58) == 0)) {
      fStack_44 = 0.0;
    }
    else {
      fVar7 = (float10)*(int *)(param_1 + 0x28);
      if (*(int *)(param_1 + 0x28) < 0) {
        fVar7 = fVar7 + (float10)4.2949673e+09;
      }
      fStack_44 = (float)((fVar7 / (-(float10)(longlong)
                                              (((ulonglong)*(uint *)(in_EDX + 0x5c) & 0x80000000) <<
                                              0x20) +
                                   (float10)(*(ulonglong *)(in_EDX + 0x58) & 0x7fffffffffffffff))) *
                         (float10)100.0);
    }
    if (*(uint *)(param_1 + 0x18) < 8) {
      iVar4 = param_1 + 4;
    }
    else {
      iVar4 = *(int *)(param_1 + 4);
    }
    uVar5 = FUN_00404750(L"%u@%u@%s@",*(undefined4 *)(param_1 + 0x1c),
                         *(undefined2 *)(param_1 + 0x24),iVar4);
    local_8._0_1_ = 2;
    FUN_00405c30(uVar5,0,0xffffffff);
    local_8._0_1_ = 1;
    if (7 < local_4c) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    uVar5 = FUN_00404750(L"%u@%d@%.1f@%u@%d@%.1f@",*(undefined4 *)(param_1 + 0x30),(int)local_38,
                         (double)fStack_3c,*(undefined4 *)(param_1 + 0x28),(int)local_6c,
                         (double)fStack_44);
    local_8._0_1_ = 3;
    FUN_00405c30(uVar5,0,0xffffffff);
    local_8._0_1_ = 1;
    piVar1 = *(int **)(param_1 + 0x50);
    piVar2 = (int *)*piVar1;
    while (piVar2 != piVar1) {
      if (piVar2[10] != 0) {
        uVar5 = FUN_00404750();
        local_8._0_1_ = 4;
        FUN_00405c30(uVar5,0,0xffffffff);
        local_8._0_1_ = 1;
      }
      FUN_00430160();
      piVar1 = *(int **)(param_1 + 0x50);
    }
    uVar5 = FUN_00404750(L"HP Potion : %u\n",*(undefined4 *)(param_1 + 0x40));
    local_8._0_1_ = 5;
    FUN_00405c30(uVar5,0,0xffffffff);
    local_8._0_1_ = 1;
    uVar5 = FUN_00404750(L"MP Potion : %u",*(undefined4 *)(param_1 + 0x44));
    local_8._0_1_ = 6;
    FUN_00405c30(uVar5,0,0xffffffff);
    local_8._0_1_ = 1;
    *(undefined4 *)(in_ECX + 0x18) = 7;
    *(undefined4 *)(in_ECX + 0x14) = 0;
    *(undefined2 *)(in_ECX + 4) = 0;
    FUN_00405eb0(local_34,0,0xffffffff);
    local_8 = (uint)local_8._1_3_ << 8;
    if (7 < local_1c) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_1c = 7;
    local_20 = 0;
    local_30 = 0;
    uVar5 = extraout_EDX_00;
  }
  ExceptionList = local_10;
  __security_check_cookie(local_18 ^ (uint)&stack0xfffffffc,uVar5,1);
  return;
}



============================================================
DISASSEMBLY
============================================================
009aa4f0 : PUSH EBP
009aa4f1 : MOV EBP,ESP
009aa4f3 : PUSH -0x1
009aa4f5 : PUSH 0xb2156d
009aa4fa : MOV EAX,FS:[0x0]
009aa500 : PUSH EAX
009aa501 : SUB ESP,0x60
009aa504 : MOV EAX,[0x00d66fa0]
009aa509 : XOR EAX,EBP
009aa50b : MOV dword ptr [EBP + -0x14],EAX
009aa50e : PUSH EBX
009aa50f : PUSH ESI
009aa510 : PUSH EDI
009aa511 : PUSH EAX
009aa512 : LEA EAX,[EBP + -0xc]
009aa515 : MOV FS:[0x0],EAX
009aa51b : MOV EDI,dword ptr [EBP + 0x8]
009aa51e : XOR EBX,EBX
009aa520 : MOV ESI,EDX
009aa522 : MOV dword ptr [EBP + -0x64],ECX
009aa525 : MOV dword ptr [EBP + -0x6c],EBX
009aa528 : CMP EDI,EBX
009aa52a : JNZ 0x009aa548
009aa52c : PUSH 0xc8b08c
009aa531 : CALL 0x00406460
009aa536 : MOV dword ptr [EBP + -0x4],EBX
009aa539 : MOV dword ptr [EBP + -0x6c],0x1
009aa540 : MOV EAX,dword ptr [EBP + -0x64]
009aa543 : JMP 0x009aa8e6
009aa548 : XOR EAX,EAX
009aa54a : MOV dword ptr [EBP + -0x18],0x7
009aa551 : MOV dword ptr [EBP + -0x1c],EBX
009aa554 : MOV word ptr [EBP + -0x2c],AX
009aa558 : MOV dword ptr [EBP + -0x4],0x1
009aa55f : CALL dword ptr [0x00b85598]
009aa565 : XORPS XMM0,XMM0
009aa568 : MOV ECX,EAX
009aa56a : SUB ECX,dword ptr [ESI + 0x44]
009aa56d : MOV EAX,0x10624dd3
009aa572 : MUL ECX
009aa574 : SHR EDX,0x6
009aa577 : CMP EDX,EBX
009aa579 : JBE 0x009aa5a4
009aa57b : MOV ECX,dword ptr [EDI + 0x30]
009aa57e : FILD dword ptr [EDI + 0x30]
009aa581 : TEST ECX,ECX
009aa583 : JGE 0x009aa58b
009aa585 : FADD float ptr [0x00cdf0e0]
009aa58b : MOV EAX,EDX
009aa58d : MOV dword ptr [EBP + -0x34],EAX
009aa590 : FILD dword ptr [EBP + -0x34]
009aa593 : TEST EAX,EAX
009aa595 : JGE 0x009aa59d
009aa597 : FADD float ptr [0x00cdf0e0]
009aa59d : FDIVP
009aa59f : FSTP float ptr [EBP + -0x34]
009aa5a2 : JMP 0x009aa5a9
009aa5a4 : MOVSS dword ptr [EBP + -0x34],XMM0
009aa5a9 : CMP EDX,EBX
009aa5ab : JBE 0x009aa5d4
009aa5ad : MOV ECX,dword ptr [EDI + 0x28]
009aa5b0 : FILD dword ptr [EDI + 0x28]
009aa5b3 : TEST ECX,ECX
009aa5b5 : JGE 0x009aa5bd
009aa5b7 : FADD float ptr [0x00cdf0e0]
009aa5bd : MOV dword ptr [EBP + -0x38],EDX
009aa5c0 : FILD dword ptr [EBP + -0x38]
009aa5c3 : TEST EDX,EDX
009aa5c5 : JGE 0x009aa5cd
009aa5c7 : FADD float ptr [0x00cdf0e0]
009aa5cd : FDIVP
009aa5cf : FSTP float ptr [EBP + -0x68]
009aa5d2 : JMP 0x009aa5d9
009aa5d4 : MOVSS dword ptr [EBP + -0x68],XMM0
009aa5d9 : MOV EAX,dword ptr [ESI + 0x54]
009aa5dc : FLD float ptr [0x00cdf230]
009aa5e2 : MOV ECX,dword ptr [ESI + 0x50]
009aa5e5 : CMP EAX,EBX
009aa5e7 : JA 0x009aa5ed
009aa5e9 : CMP ECX,EBX
009aa5eb : JBE 0x009aa629
009aa5ed : MOV EDX,dword ptr [EDI + 0x30]
009aa5f0 : FILD dword ptr [EDI + 0x30]
009aa5f3 : TEST EDX,EDX
009aa5f5 : JGE 0x009aa5fd
009aa5f7 : FADD float ptr [0x00cdf0e0]
009aa5fd : MOV dword ptr [EBP + -0x3c],ECX
009aa600 : MOV ECX,EAX
009aa602 : AND EAX,0x7fffffff
009aa607 : MOV dword ptr [EBP + -0x38],EAX
009aa60a : FILD qword ptr [EBP + -0x3c]
009aa60d : AND ECX,0x80000000
009aa613 : MOV dword ptr [EBP + -0x38],ECX
009aa616 : MOV dword ptr [EBP + -0x3c],EBX
009aa619 : FILD qword ptr [EBP + -0x3c]
009aa61c : FCHS
009aa61e : FADDP
009aa620 : FDIVP
009aa622 : FMUL ST1
009aa624 : FSTP float ptr [EBP + -0x38]
009aa627 : JMP 0x009aa62e
009aa629 : MOVSS dword ptr [EBP + -0x38],XMM0
009aa62e : MOV EAX,dword ptr [ESI + 0x58]
009aa631 : MOV ESI,dword ptr [ESI + 0x5c]
009aa634 : CMP ESI,EBX
009aa636 : JA 0x009aa63c
009aa638 : CMP EAX,EBX
009aa63a : JBE 0x009aa67a
009aa63c : MOV ECX,dword ptr [EDI + 0x28]
009aa63f : FILD dword ptr [EDI + 0x28]
009aa642 : TEST ECX,ECX
009aa644 : JGE 0x009aa64c
009aa646 : FADD float ptr [0x00cdf0e0]
009aa64c : MOV dword ptr [EBP + -0x44],EAX
009aa64f : MOV EAX,ESI
009aa651 : MOV ECX,ESI
009aa653 : AND EAX,0x7fffffff
009aa658 : MOV dword ptr [EBP + -0x40],EAX
009aa65b : FILD qword ptr [EBP + -0x44]
009aa65e : AND ECX,0x80000000
009aa664 : MOV dword ptr [EBP + -0x40],ECX
009aa667 : MOV dword ptr [EBP + -0x44],EBX
009aa66a : FILD qword ptr [EBP + -0x44]
009aa66d : FCHS
009aa66f : FADDP
009aa671 : FDIVP
009aa673 : FMULP
009aa675 : FSTP float ptr [EBP + -0x40]
009aa678 : JMP 0x009aa681
009aa67a : FSTP ST0
009aa67c : MOVSS dword ptr [EBP + -0x40],XMM0
009aa681 : CMP dword ptr [EDI + 0x18],0x8
009aa685 : JC 0x009aa68c
009aa687 : MOV EAX,dword ptr [EDI + 0x4]
009aa68a : JMP 0x009aa68f
009aa68c : LEA EAX,[EDI + 0x4]
009aa68f : MOVZX EDX,word ptr [EDI + 0x24]
009aa693 : PUSH EAX
009aa694 : MOV EAX,dword ptr [EDI + 0x1c]
009aa697 : PUSH EDX
009aa698 : PUSH EAX
009aa699 : PUSH 0xc8b090
009aa69e : LEA ESI,[EBP + -0x60]
009aa6a1 : CALL 0x00404750
009aa6a6 : ADD ESP,0x10
009aa6a9 : MOV byte ptr [EBP + -0x4],0x2
009aa6ad : PUSH -0x1
009aa6af : PUSH EBX
009aa6b0 : PUSH EAX
009aa6b1 : LEA ECX,[EBP + -0x30]
009aa6b4 : CALL 0x00405c30
009aa6b9 : MOV byte ptr [EBP + -0x4],0x1
009aa6bd : CMP dword ptr [EBP + -0x48],0x8
009aa6c1 : JC 0x009aa6cb
009aa6c3 : MOV ECX,dword ptr [EBP + -0x5c]
009aa6c6 : CALL 0x006f04e0
009aa6cb : CVTSS2SD XMM0,dword ptr [EBP + -0x40]
009aa6d0 : CVTTSS2SI EDX,dword ptr [EBP + -0x68]
009aa6d5 : MOV EAX,dword ptr [EDI + 0x28]
009aa6d8 : SUB ESP,0x8
009aa6db : MOVSD qword ptr [ESP],XMM0
009aa6e0 : CVTSS2SD XMM0,dword ptr [EBP + -0x38]
009aa6e5 : PUSH EDX
009aa6e6 : MOV EDX,dword ptr [EDI + 0x30]
009aa6e9 : PUSH EAX
009aa6ea : XOR ECX,ECX
009aa6ec : SUB ESP,0x8
009aa6ef : MOVSD qword ptr [ESP],XMM0
009aa6f4 : MOV word ptr [EBP + -0x5c],CX
009aa6f8 : CVTTSS2SI ECX,dword ptr [EBP + -0x34]
009aa6fd : PUSH ECX
009aa6fe : PUSH EDX
009aa6ff : PUSH 0xc8b0a4
009aa704 : LEA ESI,[EBP + -0x60]
009aa707 : MOV dword ptr [EBP + -0x48],0x7
009aa70e : MOV dword ptr [EBP + -0x4c],EBX
009aa711 : CALL 0x00404750
009aa716 : ADD ESP,0x24
009aa719 : MOV byte ptr [EBP + -0x4],0x3
009aa71d : PUSH -0x1
009aa71f : PUSH EBX
009aa720 : PUSH EAX
009aa721 : LEA ECX,[EBP + -0x30]
009aa724 : CALL 0x00405c30
009aa729 : MOV byte ptr [EBP + -0x4],0x1
009aa72d : CMP dword ptr [EBP + -0x48],0x8
009aa731 : JC 0x009aa73b
009aa733 : MOV ECX,dword ptr [EBP + -0x5c]
009aa736 : CALL 0x006f04e0
009aa73b : XOR EAX,EAX
009aa73d : MOV word ptr [EBP + -0x5c],AX
009aa741 : MOV EAX,dword ptr [EDI + 0x50]
009aa744 : MOV ECX,dword ptr [EAX]
009aa746 : MOV dword ptr [EBP + -0x48],0x7
009aa74d : MOV dword ptr [EBP + -0x4c],EBX
009aa750 : MOV dword ptr [EBP + -0x34],ECX
009aa753 : CMP ECX,EAX
009aa755 : JZ 0x009aa816
009aa75b : MOV EAX,dword ptr [ECX + 0x28]
009aa75e : CMP EAX,EBX
009aa760 : JZ 0x009aa800
009aa766 : MOV EAX,dword ptr [EAX]
009aa768 : CMP EAX,EBX
009aa76a : JBE 0x009aa7a0
009aa76c : MOV EDX,EAX
009aa76e : MOV dword ptr [EBP + -0x38],EDX
009aa771 : FILD dword ptr [EBP + -0x38]
009aa774 : TEST EDX,EDX
009aa776 : JGE 0x009aa77e
009aa778 : FADD float ptr [0x00cdf0e0]
009aa77e : MOV EDX,dword ptr [EDI + 0x30]
009aa781 : FILD dword ptr [EDI + 0x30]
009aa784 : TEST EDX,EDX
009aa786 : JGE 0x009aa78e
009aa788 : FADD float ptr [0x00cdf0e0]
009aa78e : FDIVP
009aa790 : FMUL float ptr [0x00cdf230]
009aa796 : FSTP float ptr [EBP + -0x38]
009aa799 : MOVSS XMM0,dword ptr [EBP + -0x38]
009aa79e : JMP 0x009aa7a3
009aa7a0 : XORPS XMM0,XMM0
009aa7a3 : CMP dword ptr [ECX + 0x24],0x8
009aa7a7 : JC 0x009aa7ae
009aa7a9 : MOV ECX,dword ptr [ECX + 0x10]
009aa7ac : JMP 0x009aa7b1
009aa7ae : ADD ECX,0x10
009aa7b1 : SUB ESP,0x8
009aa7b4 : CVTPS2PD XMM0,XMM0
009aa7b7 : MOVSD qword ptr [ESP],XMM0
009aa7bc : PUSH EAX
009aa7bd : PUSH ECX
009aa7be : PUSH 0xc8b0d4
009aa7c3 : LEA ESI,[EBP + -0x60]
009aa7c6 : CALL 0x00404750
009aa7cb : ADD ESP,0x14
009aa7ce : MOV byte ptr [EBP + -0x4],0x4
009aa7d2 : PUSH -0x1
009aa7d4 : PUSH EBX
009aa7d5 : PUSH EAX
009aa7d6 : LEA ECX,[EBP + -0x30]
009aa7d9 : CALL 0x00405c30
009aa7de : MOV byte ptr [EBP + -0x4],0x1
009aa7e2 : CMP dword ptr [EBP + -0x48],0x8
009aa7e6 : JC 0x009aa7f0
009aa7e8 : MOV ECX,dword ptr [EBP + -0x5c]
009aa7eb : CALL 0x006f04e0
009aa7f0 : XOR EAX,EAX
009aa7f2 : MOV dword ptr [EBP + -0x48],0x7
009aa7f9 : MOV dword ptr [EBP + -0x4c],EBX
009aa7fc : MOV word ptr [EBP + -0x5c],AX
009aa800 : LEA EDX,[EBP + -0x34]
009aa803 : CALL 0x00430160
009aa808 : MOV EAX,dword ptr [EDI + 0x50]
009aa80b : MOV ECX,dword ptr [EBP + -0x34]
009aa80e : CMP ECX,EAX
009aa810 : JNZ 0x009aa75b
009aa816 : MOV ECX,dword ptr [EDI + 0x40]
009aa819 : PUSH ECX
009aa81a : PUSH 0xc8b0f8
009aa81f : LEA ESI,[EBP + -0x60]
009aa822 : CALL 0x00404750
009aa827 : ADD ESP,0x8
009aa82a : MOV byte ptr [EBP + -0x4],0x5
009aa82e : PUSH -0x1
009aa830 : PUSH EBX
009aa831 : PUSH EAX
009aa832 : LEA ECX,[EBP + -0x30]
009aa835 : CALL 0x00405c30
009aa83a : MOV byte ptr [EBP + -0x4],0x1
009aa83e : CMP dword ptr [EBP + -0x48],0x8
009aa842 : JC 0x009aa84c
009aa844 : MOV ECX,dword ptr [EBP + -0x5c]
009aa847 : CALL 0x006f04e0
009aa84c : MOV EAX,dword ptr [EDI + 0x44]
009aa84f : PUSH EAX
009aa850 : XOR EDX,EDX
009aa852 : PUSH 0xc8b118
009aa857 : LEA ESI,[EBP + -0x60]
009aa85a : MOV dword ptr [EBP + -0x48],0x7
009aa861 : MOV dword ptr [EBP + -0x4c],EBX
009aa864 : MOV word ptr [EBP + -0x5c],DX
009aa868 : CALL 0x00404750
009aa86d : ADD ESP,0x8
009aa870 : MOV byte ptr [EBP + -0x4],0x6
009aa874 : PUSH -0x1
009aa876 : PUSH EBX
009aa877 : PUSH EAX
009aa878 : LEA ECX,[EBP + -0x30]
009aa87b : CALL 0x00405c30
009aa880 : MOV byte ptr [EBP + -0x4],0x1
009aa884 : CMP dword ptr [EBP + -0x48],0x8
009aa888 : JC 0x009aa892
009aa88a : MOV ECX,dword ptr [EBP + -0x5c]
009aa88d : CALL 0x006f04e0
009aa892 : MOV ESI,dword ptr [EBP + -0x64]
009aa895 : PUSH -0x1
009aa897 : XOR ECX,ECX
009aa899 : MOV EDI,0x7
009aa89e : PUSH EBX
009aa89f : LEA EAX,[EBP + -0x30]
009aa8a2 : MOV word ptr [EBP + -0x5c],CX
009aa8a6 : XOR EDX,EDX
009aa8a8 : MOV dword ptr [ESI + 0x18],EDI
009aa8ab : MOV dword ptr [ESI + 0x14],EBX
009aa8ae : PUSH EAX
009aa8af : MOV ECX,ESI
009aa8b1 : MOV dword ptr [EBP + -0x48],EDI
009aa8b4 : MOV dword ptr [EBP + -0x4c],EBX
009aa8b7 : MOV word ptr [ESI + 0x4],DX
009aa8bb : CALL 0x00405eb0
009aa8c0 : MOV dword ptr [EBP + -0x6c],0x1
009aa8c7 : MOV byte ptr [EBP + -0x4],BL
009aa8ca : CMP dword ptr [EBP + -0x18],0x8
009aa8ce : JC 0x009aa8d8
009aa8d0 : MOV ECX,dword ptr [EBP + -0x2c]
009aa8d3 : CALL 0x006f04e0
009aa8d8 : XOR ECX,ECX
009aa8da : MOV dword ptr [EBP + -0x18],EDI
009aa8dd : MOV dword ptr [EBP + -0x1c],EBX
009aa8e0 : MOV word ptr [EBP + -0x2c],CX
009aa8e4 : MOV EAX,ESI
009aa8e6 : MOV ECX,dword ptr [EBP + -0xc]
009aa8e9 : MOV dword ptr FS:[0x0],ECX
009aa8f0 : POP ECX
009aa8f1 : POP EDI
009aa8f2 : POP ESI
009aa8f3 : POP EBX
009aa8f4 : MOV ECX,dword ptr [EBP + -0x14]
009aa8f7 : XOR ECX,EBP
009aa8f9 : CALL 0x00633e6b
009aa8fe : MOV ESP,EBP
009aa900 : POP EBP
009aa901 : RET 0x4
