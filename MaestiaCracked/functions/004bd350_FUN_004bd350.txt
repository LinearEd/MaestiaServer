PROGRAM  : Maestia.exe
FUNCTION : FUN_004bd350
ENTRY    : 004bd350
BODY     : [[004bd350, 004bd490] [004bd4a2, 004bd577]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_004bd350(uint param_1,void *param_2,uint param_3,undefined4 *param_4)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  undefined4 uVar5;
  undefined4 *puVar6;
  uint uVar7;
  uint uVar8;
  undefined8 uVar9;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  iVar3 = param_1;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b7a370;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  iVar4 = *(int *)(param_1 + 4);
  if (iVar4 == 0) {
    uVar8 = 0;
  }
  else {
    uVar8 = *(int *)(param_1 + 0xc) - iVar4 >> 2;
  }
  if (param_3 != 0) {
    iVar2 = *(int *)(param_1 + 8);
    iVar4 = iVar2 - iVar4 >> 2;
    uVar7 = param_3;
    if (0x3fffffffU - iVar4 < param_3) {
      uVar9 = FUN_00452880();
      uVar7 = (uint)((ulonglong)uVar9 >> 0x20);
      iVar4 = (int)uVar9;
    }
    uVar1 = iVar4 + uVar7;
    if (uVar8 < uVar1) {
      if (0x3fffffff - (uVar8 >> 1) < uVar8) {
        param_1 = 0;
      }
      else {
        param_1 = uVar8 + (uVar8 >> 1);
      }
      if (param_1 < uVar1) {
        param_1 = uVar1;
      }
      iVar4 = FUN_004c1790();
      local_8 = 0;
      FUN_004154b0();
      FUN_00461070();
      FUN_00461070();
      local_8 = 0xffffffff;
      if (*(int *)(iVar3 + 4) == 0) {
        *(uint *)(iVar3 + 0xc) = iVar4 + param_1 * 4;
        *(uint *)(iVar3 + 8) =
             iVar4 + (param_3 + (*(int *)(iVar3 + 8) - *(int *)(iVar3 + 4) >> 2)) * 4;
        *(int *)(iVar3 + 4) = iVar4;
        ExceptionList = local_10;
        return;
      }
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    if ((uint)(iVar2 - (int)param_2 >> 2) < uVar7) {
      uVar5 = *param_4;
      FUN_00461070();
      puVar6 = *(undefined4 **)(param_1 + 8);
      for (iVar4 = param_3 - ((int)puVar6 - (int)param_2 >> 2); iVar4 != 0; iVar4 = iVar4 + -1) {
        *puVar6 = uVar5;
        puVar6 = puVar6 + 1;
      }
      local_8 = 0xffffffff;
      *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + param_3 * 4;
    }
    else {
      uVar5 = FUN_00461070();
      *(undefined4 *)(param_1 + 8) = uVar5;
      iVar4 = (int)((iVar2 + uVar7 * -4) - (int)param_2) >> 2;
      if (0 < iVar4) {
        _memmove_s((void *)(iVar2 + iVar4 * -4),iVar4 * 4,param_2,iVar4 * 4);
      }
    }
    FUN_00422490(param_2);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
004bd350 : PUSH EBP
004bd351 : MOV EBP,ESP
004bd353 : PUSH -0x1
004bd355 : PUSH 0xb7a370
004bd35a : MOV EAX,FS:[0x0]
004bd360 : PUSH EAX
004bd361 : SUB ESP,0x1c
004bd364 : PUSH EBX
004bd365 : PUSH ESI
004bd366 : PUSH EDI
004bd367 : MOV EAX,[0x00d66fa0]
004bd36c : XOR EAX,EBP
004bd36e : PUSH EAX
004bd36f : LEA EAX,[EBP + -0xc]
004bd372 : MOV FS:[0x0],EAX
004bd378 : MOV dword ptr [EBP + -0x10],ESP
004bd37b : MOV EBX,dword ptr [EBP + 0x8]
004bd37e : MOV ECX,dword ptr [EBX + 0x4]
004bd381 : TEST ECX,ECX
004bd383 : JNZ 0x004bd389
004bd385 : XOR EDI,EDI
004bd387 : JMP 0x004bd393
004bd389 : MOV EAX,dword ptr [EBX + 0xc]
004bd38c : SUB EAX,ECX
004bd38e : SAR EAX,0x2
004bd391 : MOV EDI,EAX
004bd393 : MOV EDX,dword ptr [EBP + 0x10]
004bd396 : TEST EDX,EDX
004bd398 : JZ 0x004bd564
004bd39e : MOV ESI,dword ptr [EBX + 0x8]
004bd3a1 : MOV EAX,ESI
004bd3a3 : SUB EAX,ECX
004bd3a5 : SAR EAX,0x2
004bd3a8 : MOV ECX,0x3fffffff
004bd3ad : SUB ECX,EAX
004bd3af : CMP ECX,EDX
004bd3b1 : JNC 0x004bd3b8
004bd3b3 : CALL 0x00452880
004bd3b8 : LEA ECX,[EAX + EDX*0x1]
004bd3bb : CMP EDI,ECX
004bd3bd : JNC 0x004bd4a2
004bd3c3 : MOV EAX,EDI
004bd3c5 : SHR EAX,0x1
004bd3c7 : MOV EDX,0x3fffffff
004bd3cc : SUB EDX,EAX
004bd3ce : CMP EDX,EDI
004bd3d0 : JNC 0x004bd3de
004bd3d2 : MOV dword ptr [EBP + 0x8],0x0
004bd3d9 : MOV EDI,dword ptr [EBP + 0x8]
004bd3dc : JMP 0x004bd3e3
004bd3de : ADD EDI,EAX
004bd3e0 : MOV dword ptr [EBP + 0x8],EDI
004bd3e3 : CMP EDI,ECX
004bd3e5 : JNC 0x004bd3ec
004bd3e7 : MOV dword ptr [EBP + 0x8],ECX
004bd3ea : MOV EDI,ECX
004bd3ec : MOV ECX,EDI
004bd3ee : CALL 0x004c1790
004bd3f3 : MOV dword ptr [EBP + -0x14],EAX
004bd3f6 : MOV ECX,dword ptr [EBP + 0xc]
004bd3f9 : SUB ECX,dword ptr [EBX + 0x4]
004bd3fc : SAR ECX,0x2
004bd3ff : MOV dword ptr [EBP + -0x1c],ECX
004bd402 : MOV dword ptr [EBP + -0x4],0x0
004bd409 : LEA EDI,[EAX + ECX*0x4]
004bd40c : MOV EDX,dword ptr [EBP + 0x14]
004bd40f : MOV ESI,dword ptr [EBP + 0x10]
004bd412 : CALL 0x004154b0
004bd417 : MOV dword ptr [EBP + -0x18],0x1
004bd41e : MOV ESI,dword ptr [EBP + -0x14]
004bd421 : MOV EDX,ESI
004bd423 : MOV EAX,dword ptr [EBP + 0xc]
004bd426 : MOV EDI,dword ptr [EBX + 0x4]
004bd429 : CALL 0x00461070
004bd42e : MOV dword ptr [EBP + -0x18],0x2
004bd435 : MOV EAX,dword ptr [EBP + -0x1c]
004bd438 : MOV ECX,dword ptr [EBP + 0x10]
004bd43b : ADD EAX,ECX
004bd43d : LEA EDX,[ESI + EAX*0x4]
004bd440 : MOV EAX,dword ptr [EBX + 0x8]
004bd443 : MOV EDI,dword ptr [EBP + 0xc]
004bd446 : CALL 0x00461070
004bd44b : MOV dword ptr [EBP + -0x4],0xffffffff
004bd452 : MOV ECX,dword ptr [EBX + 0x4]
004bd455 : MOV EDX,dword ptr [EBX + 0x8]
004bd458 : SUB EDX,ECX
004bd45a : SAR EDX,0x2
004bd45d : MOV EDI,dword ptr [EBP + 0x10]
004bd460 : ADD EDI,EDX
004bd462 : TEST ECX,ECX
004bd464 : JZ 0x004bd46b
004bd466 : CALL 0x006f04e0
004bd46b : MOV EAX,dword ptr [EBP + 0x8]
004bd46e : LEA ECX,[ESI + EAX*0x4]
004bd471 : MOV dword ptr [EBX + 0xc],ECX
004bd474 : LEA EDX,[ESI + EDI*0x4]
004bd477 : MOV dword ptr [EBX + 0x8],EDX
004bd47a : MOV dword ptr [EBX + 0x4],ESI
004bd47d : MOV ECX,dword ptr [EBP + -0xc]
004bd480 : MOV dword ptr FS:[0x0],ECX
004bd487 : POP ECX
004bd488 : POP EDI
004bd489 : POP ESI
004bd48a : POP EBX
004bd48b : MOV ESP,EBP
004bd48d : POP EBP
004bd48e : RET 0x10
004bd4a2 : MOV EAX,ESI
004bd4a4 : MOV EDI,dword ptr [EBP + 0xc]
004bd4a7 : SUB EAX,EDI
004bd4a9 : SAR EAX,0x2
004bd4ac : CMP EAX,EDX
004bd4ae : JNC 0x004bd50c
004bd4b0 : MOV ECX,dword ptr [EBP + 0x14]
004bd4b3 : MOV EAX,dword ptr [ECX]
004bd4b5 : MOV dword ptr [EBP + 0x14],EAX
004bd4b8 : LEA EDX,[EDI + EDX*0x4]
004bd4bb : MOV EAX,ESI
004bd4bd : CALL 0x00461070
004bd4c2 : MOV dword ptr [EBP + -0x4],0x2
004bd4c9 : MOV ECX,dword ptr [EBX + 0x8]
004bd4cc : MOV ESI,ECX
004bd4ce : SUB ESI,dword ptr [EBP + 0xc]
004bd4d1 : SAR ESI,0x2
004bd4d4 : MOV EDX,dword ptr [EBP + 0x10]
004bd4d7 : MOV EAX,EDX
004bd4d9 : SUB EAX,ESI
004bd4db : MOV dword ptr [EBP + -0x20],EAX
004bd4de : MOV dword ptr [EBP + -0x24],ECX
004bd4e1 : TEST EAX,EAX
004bd4e3 : JBE 0x004bd4f0
004bd4e5 : MOV ESI,dword ptr [EBP + 0x14]
004bd4e8 : MOV dword ptr [ECX],ESI
004bd4ea : DEC EAX
004bd4eb : ADD ECX,0x4
004bd4ee : JMP 0x004bd4db
004bd4f0 : MOV dword ptr [EBP + -0x4],0xffffffff
004bd4f7 : LEA EAX,[EDX*0x4 + 0x0]
004bd4fe : ADD dword ptr [EBX + 0x8],EAX
004bd501 : MOV ECX,dword ptr [EBX + 0x8]
004bd504 : SUB ECX,EAX
004bd506 : MOV EDX,dword ptr [EBP + 0xc]
004bd509 : PUSH EDX
004bd50a : JMP 0x004bd559
004bd50c : MOV EAX,dword ptr [EBP + 0x14]
004bd50f : MOV ECX,dword ptr [EAX]
004bd511 : MOV dword ptr [EBP + 0x14],ECX
004bd514 : LEA EAX,[EDX*0x4 + 0x0]
004bd51b : MOV dword ptr [EBP + 0x10],EAX
004bd51e : MOV EDI,ESI
004bd520 : SUB EDI,EAX
004bd522 : MOV EDX,ESI
004bd524 : MOV EAX,ESI
004bd526 : CALL 0x00461070
004bd52b : MOV dword ptr [EBX + 0x8],EAX
004bd52e : MOV EAX,dword ptr [EBP + 0xc]
004bd531 : SUB EDI,EAX
004bd533 : SAR EDI,0x2
004bd536 : TEST EDI,EDI
004bd538 : JLE 0x004bd552
004bd53a : LEA ECX,[EDI*0x4 + 0x0]
004bd541 : PUSH ECX
004bd542 : PUSH EAX
004bd543 : PUSH ECX
004bd544 : SUB ESI,ECX
004bd546 : PUSH ESI
004bd547 : CALL 0x00634101
004bd54c : ADD ESP,0x10
004bd54f : MOV EAX,dword ptr [EBP + 0xc]
004bd552 : MOV EDX,dword ptr [EBP + 0x10]
004bd555 : LEA ECX,[EDX + EAX*0x1]
004bd558 : PUSH EAX
004bd559 : LEA EDX,[EBP + 0x14]
004bd55c : CALL 0x00422490
004bd561 : ADD ESP,0x4
004bd564 : MOV ECX,dword ptr [EBP + -0xc]
004bd567 : MOV dword ptr FS:[0x0],ECX
004bd56e : POP ECX
004bd56f : POP EDI
004bd570 : POP ESI
004bd571 : POP EBX
004bd572 : MOV ESP,EBP
004bd574 : POP EBP
004bd575 : RET 0x10
