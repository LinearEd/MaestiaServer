PROGRAM  : Maestia.exe
FUNCTION : FUN_00715530
ENTRY    : 00715530
BODY     : [[00715530, 007159c8]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00715530(undefined4 param_1,float *param_2)

{
  undefined8 uVar1;
  undefined4 uVar2;
  int *piVar3;
  int iVar4;
  uint uVar5;
  undefined8 *puVar6;
  undefined8 *puVar7;
  int iVar8;
  int in_ECX;
  uint uVar9;
  uint uVar10;
  float fVar11;
  undefined4 unaff_EDI;
  float fVar12;
  float fVar13;
  undefined1 *puStack_c0;
  undefined1 *puStack_bc;
  float fStack_b8;
  float local_b4;
  float fStack_a4;
  float fStack_9c;
  float fStack_98;
  float fStack_94;
  float fStack_90;
  float fStack_8c;
  float fStack_88;
  float fStack_84;
  float fStack_80;
  float fStack_7c;
  float fStack_78;
  float fStack_74;
  float fStack_70;
  undefined1 auStack_60 [12];
  undefined1 auStack_54 [12];
  undefined1 local_48 [68];
  
  if (*(int *)(in_ECX + 4) == 0) {
    return 0xffffffff;
  }
  local_b4 = 1.0408027e-38;
  iVar4 = FUN_004c5420();
  if (0xffff < *(int *)(iVar4 + 0x10)) {
    return 0xffffffff;
  }
  local_b4 = 1.040805e-38;
  iVar4 = FUN_004c5420();
  if (*(char *)(iVar4 + 0x14) == '\0') {
    local_b4 = 1.0408066e-38;
    FUN_004c5420();
    local_b4 = 1.0408076e-38;
    FUN_0075c370();
    local_b4 = 1.0408083e-38;
    iVar4 = FUN_004c5420();
    if (*(char *)(iVar4 + 0x14) == '\0') {
      return 0;
    }
  }
  if (*(int *)(in_ECX + 8) == -1) {
    local_b4 = 1.0408112e-38;
    iVar4 = FUN_004c5420();
    *(undefined4 *)(in_ECX + 8) = *(undefined4 *)(iVar4 + 0x10);
    *(undefined4 *)(in_ECX + 0xc) = 0;
    *(undefined4 *)(in_ECX + 0x10) = 0;
  }
  _local_b4 = CONCAT44(unaff_EDI,param_2[0x15]);
  fStack_b8 = (float)(in_ECX + 0x2c);
  puStack_bc = local_48;
  puStack_c0 = (undefined1 *)0x7155b8;
  D3DXMatrixRotationAxis();
  puStack_c0 = auStack_54;
  D3DXVec3Transform(&fStack_74,in_ECX + 0x20);
  D3DXVec3Transform(&fStack_90,in_ECX + 0x14,auStack_60);
  fVar12 = param_2[0xc] * DAT_00d72c24;
  fStack_8c = fStack_8c * fVar12;
  fStack_88 = fStack_88 * fVar12;
  fStack_84 = fStack_84 * fVar12;
  local_b4 = (float)(longlong)ROUND(param_2[7] * 255.0);
  fStack_80 = fStack_80 * fVar12;
  uVar10 = (int)local_b4 << 8;
  fStack_90 = fStack_90 * fVar12;
  local_b4 = (float)(longlong)ROUND(param_2[4] * 255.0);
  uVar5 = (uint)local_b4 & 0xff;
  fVar13 = param_2[0x19];
  local_b4 = (float)(longlong)ROUND(param_2[5] * 255.0);
  uVar9 = (uint)local_b4 & 0xff;
  local_b4 = (float)(longlong)ROUND(param_2[6] * 255.0);
  fVar11 = (float)(((uVar10 | uVar5) << 8 | uVar9) << 8 | (uint)local_b4 & 0xff);
  _local_b4 = CONCAT44((int)((ulonglong)(longlong)ROUND(param_2[6] * 255.0) >> 0x20),fVar11);
  if (fVar13 == 0.0) goto LAB_00715870;
  uVar5 = _rand();
  uVar5 = uVar5 & 0x80000003;
  if ((int)uVar5 < 0) {
    uVar5 = (uVar5 - 1 | 0xfffffffc) + 1;
  }
  if ((int)uVar5 < 2) {
    if (uVar5 != 0) {
      fStack_7c = -fStack_8c;
      fStack_78 = -fStack_88;
      fStack_74 = -fStack_84;
      fVar12 = fStack_80;
LAB_007157f0:
      fStack_70 = -fVar12;
    }
  }
  else if (uVar5 != 2) {
    fStack_7c = -(fStack_9c * fVar12);
    fStack_78 = -(fStack_98 * fVar12);
    fStack_74 = -(fStack_94 * fVar12);
    fVar12 = fStack_90;
    goto LAB_007157f0;
  }
  D3DXVec3Normalize(&puStack_c0,&stack0xffffff58);
  *param_2 = *param_2 + (float)puStack_c0 * fVar13;
  param_2[1] = (float)puStack_bc * fVar13 + param_2[1];
  param_2[2] = fStack_b8 * fVar13 + param_2[2];
LAB_00715870:
  iVar4 = FUN_004c5420();
  puStack_c0 = (undefined1 *)*param_2;
  puVar7 = *(undefined8 **)(iVar4 + 0xc);
  puStack_bc = (undefined1 *)param_2[1];
  fStack_b8 = param_2[2];
  if (*(char *)(*(int *)(in_ECX + 4) + 0x18) == '\0') {
    piVar3 = *(int **)(*(int *)(in_ECX + 4) + 0x1c);
    if (*(char *)((int)piVar3 + 0x5d) != '\0') {
      (**(code **)(*piVar3 + 0x14))();
    }
    fVar13 = (float)piVar3[0x30];
    puStack_c0 = (undefined1 *)((float)*(undefined8 *)(piVar3 + 0x2e) + (float)puStack_c0);
    fStack_a4 = (float)((ulonglong)*(undefined8 *)(piVar3 + 0x2e) >> 0x20);
    puStack_bc = (undefined1 *)(fStack_a4 + (float)puStack_bc);
  }
  else {
    if (*(char *)(param_2 + 0x19) == '\0') {
      *(undefined1 *)(param_2 + 0x19) = 1;
      puVar6 = (undefined8 *)FUN_007cc270();
      uVar1 = *puVar6;
      uVar2 = *(undefined4 *)(puVar6 + 1);
      *(int *)((int)param_2 + 0x65) = (int)uVar1;
      fStack_a4 = (float)((ulonglong)uVar1 >> 0x20);
      *(float *)((int)param_2 + 0x69) = fStack_a4;
      *(undefined4 *)((int)param_2 + 0x6d) = uVar2;
      fVar11 = local_b4;
    }
    puStack_c0 = (undefined1 *)(*(float *)((int)param_2 + 0x65) + (float)puStack_c0);
    puStack_bc = (undefined1 *)(*(float *)((int)param_2 + 0x69) + (float)puStack_bc);
    fVar13 = *(float *)((int)param_2 + 0x6d);
  }
  fStack_b8 = fVar13 + fStack_b8;
  *puVar7 = CONCAT44(puStack_bc,puStack_c0);
  *(float *)((int)puVar7 + 0xc) = fVar11;
  *(float *)(puVar7 + 1) = fStack_b8;
  iVar4 = FUN_004c5420();
  *(undefined8 **)(iVar4 + 0xc) = puVar7 + 2;
  *(int *)(in_ECX + 0x10) = *(int *)(in_ECX + 0x10) + 1;
  *(int *)(in_ECX + 0xc) = *(int *)(in_ECX + 0xc) + 1;
  iVar4 = FUN_004c5420();
  iVar4 = *(int *)(iVar4 + 0x10);
  iVar8 = FUN_004c5420();
  *(int *)(iVar8 + 0x10) = iVar4 + 1;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
00715530 : PUSH EBP
00715531 : MOV EBP,ESP
00715533 : AND ESP,0xfffffff8
00715536 : SUB ESP,0x9c
0071553c : PUSH EBX
0071553d : MOV EBX,ECX
0071553f : CMP dword ptr [EBX + 0x4],0x0
00715543 : PUSH ESI
00715544 : PUSH EDI
00715545 : JNZ 0x00715553
00715547 : OR EAX,0xffffffff
0071554a : POP EDI
0071554b : POP ESI
0071554c : POP EBX
0071554d : MOV ESP,EBP
0071554f : POP EBP
00715550 : RET 0x8
00715553 : CALL 0x004c5420
00715558 : CMP dword ptr [EAX + 0x10],0x10000
0071555f : JGE 0x00715547
00715561 : MOV EDI,dword ptr [EBP + 0xc]
00715564 : CALL 0x004c5420
00715569 : CMP byte ptr [EAX + 0x14],0x0
0071556d : JNZ 0x0071558a
0071556f : CALL 0x004c5420
00715574 : MOV ESI,EAX
00715576 : CALL 0x0075c370
0071557b : CALL 0x004c5420
00715580 : CMP byte ptr [EAX + 0x14],0x0
00715584 : JZ 0x007159be
0071558a : CMP dword ptr [EBX + 0x8],-0x1
0071558e : JNZ 0x007155a3
00715590 : CALL 0x004c5420
00715595 : MOV EAX,dword ptr [EAX + 0x10]
00715598 : MOV dword ptr [EBX + 0x8],EAX
0071559b : XOR EAX,EAX
0071559d : MOV dword ptr [EBX + 0xc],EAX
007155a0 : MOV dword ptr [EBX + 0x10],EAX
007155a3 : FLD float ptr [EDI + 0x54]
007155a6 : PUSH ECX
007155a7 : FSTP float ptr [ESP]
007155aa : LEA ECX,[EBX + 0x2c]
007155ad : PUSH ECX
007155ae : LEA EDX,[ESP + 0x70]
007155b2 : PUSH EDX
007155b3 : CALL 0x004ff746
007155b8 : LEA EAX,[ESP + 0x68]
007155bc : PUSH EAX
007155bd : LEA ECX,[EBX + 0x20]
007155c0 : PUSH ECX
007155c1 : LEA EDX,[ESP + 0x50]
007155c5 : PUSH EDX
007155c6 : CALL 0x004ff75e
007155cb : LEA EAX,[ESP + 0x68]
007155cf : PUSH EAX
007155d0 : LEA ECX,[EBX + 0x14]
007155d3 : PUSH ECX
007155d4 : LEA EDX,[ESP + 0x40]
007155d8 : PUSH EDX
007155d9 : CALL 0x004ff75e
007155de : FLD float ptr [EDI + 0x1c]
007155e1 : FLD float ptr [0x00cdf130]
007155e7 : MOVSS XMM0,dword ptr [EDI + 0x30]
007155ec : FNSTCW word ptr [ESP + 0xc]
007155f0 : MULSS XMM0,dword ptr [0x00d72c24]
007155f8 : MOVZX EAX,word ptr [ESP + 0xc]
007155fd : FMUL ST1
007155ff : OR EAX,0xc00
00715604 : FXCH
00715606 : MOV dword ptr [ESP + 0x10],EAX
0071560a : MOVSS XMM1,dword ptr [ESP + 0x48]
00715610 : MULSS XMM1,XMM0
00715614 : FLDCW word ptr [ESP + 0x10]
00715618 : MOVSS dword ptr [ESP + 0x48],XMM1
0071561e : MOVSS XMM1,dword ptr [ESP + 0x4c]
00715624 : MULSS XMM1,XMM0
00715628 : MOVSS dword ptr [ESP + 0x4c],XMM1
0071562e : MOVSS XMM1,dword ptr [ESP + 0x50]
00715634 : FISTP qword ptr [ESP + 0x20]
00715638 : MULSS XMM1,XMM0
0071563c : MOVSS dword ptr [ESP + 0x50],XMM1
00715642 : MOVSS XMM1,dword ptr [ESP + 0x54]
00715648 : MOV ESI,dword ptr [ESP + 0x20]
0071564c : MULSS XMM1,XMM0
00715650 : MOVSS dword ptr [ESP + 0x54],XMM1
00715656 : FLDCW word ptr [ESP + 0xc]
0071565a : MOVSS XMM1,dword ptr [ESP + 0x38]
00715660 : MULSS XMM1,XMM0
00715664 : MOVSS dword ptr [ESP + 0x38],XMM1
0071566a : MOVSS XMM1,dword ptr [ESP + 0x3c]
00715670 : SHL ESI,0x8
00715673 : MULSS XMM1,XMM0
00715677 : MOVSS dword ptr [ESP + 0x3c],XMM1
0071567d : FLD float ptr [EDI + 0x10]
00715680 : MOVSS XMM1,dword ptr [ESP + 0x40]
00715686 : FNSTCW word ptr [ESP + 0xc]
0071568a : MULSS XMM1,XMM0
0071568e : MOVSS dword ptr [ESP + 0x40],XMM1
00715694 : MOVSS XMM1,dword ptr [ESP + 0x44]
0071569a : FMUL ST1
0071569c : MOVZX EAX,word ptr [ESP + 0xc]
007156a1 : OR EAX,0xc00
007156a6 : MOV dword ptr [ESP + 0x10],EAX
007156aa : MULSS XMM1,XMM0
007156ae : MOVSS dword ptr [ESP + 0x44],XMM1
007156b4 : FLDCW word ptr [ESP + 0x10]
007156b8 : FISTP qword ptr [ESP + 0x20]
007156bc : MOV EAX,dword ptr [ESP + 0x20]
007156c0 : AND EAX,0xff
007156c5 : OR ESI,EAX
007156c7 : FLDCW word ptr [ESP + 0xc]
007156cb : SHL ESI,0x8
007156ce : FLD float ptr [EDI + 0x14]
007156d1 : FNSTCW word ptr [ESP + 0xc]
007156d5 : FMUL ST1
007156d7 : MOVZX EAX,word ptr [ESP + 0xc]
007156dc : OR EAX,0xc00
007156e1 : MOV dword ptr [ESP + 0x10],EAX
007156e5 : FLDCW word ptr [ESP + 0x10]
007156e9 : FISTP qword ptr [ESP + 0x20]
007156ed : MOVSS XMM0,dword ptr [EDI + 0x64]
007156f2 : MOV ECX,dword ptr [ESP + 0x20]
007156f6 : AND ECX,0xff
007156fc : OR ESI,ECX
007156fe : FLDCW word ptr [ESP + 0xc]
00715702 : SHL ESI,0x8
00715705 : FMUL float ptr [EDI + 0x18]
00715708 : FNSTCW word ptr [ESP + 0xc]
0071570c : MOVZX EAX,word ptr [ESP + 0xc]
00715711 : OR EAX,0xc00
00715716 : MOV dword ptr [ESP + 0x10],EAX
0071571a : FLDCW word ptr [ESP + 0x10]
0071571e : MOVSS dword ptr [ESP + 0x10],XMM0
00715724 : FISTP qword ptr [ESP + 0x20]
00715728 : MOV EDX,dword ptr [ESP + 0x20]
0071572c : AND EDX,0xff
00715732 : OR ESI,EDX
00715734 : UCOMISS XMM0,dword ptr [0x00b9b0b4]
0071573b : FLDCW word ptr [ESP + 0xc]
0071573f : LAHF
00715740 : MOV dword ptr [ESP + 0x20],ESI
00715744 : TEST AH,0x44
00715747 : JNP 0x00715870
0071574d : CALL 0x00635d2f
00715752 : AND EAX,0x80000003
00715757 : JNS 0x0071575e
00715759 : DEC EAX
0071575a : OR EAX,0xfffffffc
0071575d : INC EAX
0071575e : CMP EAX,0x2
00715761 : JGE 0x007157ad
00715763 : TEST EAX,EAX
00715765 : JNZ 0x00715770
00715767 : LEA EAX,[ESP + 0x48]
0071576b : JMP 0x007157fd
00715770 : MOVSS XMM0,dword ptr [0x00cdf0c0]
00715778 : MOVSS XMM1,dword ptr [ESP + 0x48]
0071577e : XORPS XMM1,XMM0
00715781 : MOVSS dword ptr [ESP + 0x58],XMM1
00715787 : MOVSS XMM1,dword ptr [ESP + 0x4c]
0071578d : XORPS XMM1,XMM0
00715790 : MOVSS dword ptr [ESP + 0x5c],XMM1
00715796 : MOVSS XMM1,dword ptr [ESP + 0x50]
0071579c : XORPS XMM1,XMM0
0071579f : MOVSS dword ptr [ESP + 0x60],XMM1
007157a5 : MOVSS XMM1,dword ptr [ESP + 0x54]
007157ab : JMP 0x007157f0
007157ad : JNZ 0x007157b5
007157af : LEA EAX,[ESP + 0x38]
007157b3 : JMP 0x007157fd
007157b5 : MOVSS XMM0,dword ptr [0x00cdf0c0]
007157bd : MOVSS XMM1,dword ptr [ESP + 0x38]
007157c3 : XORPS XMM1,XMM0
007157c6 : MOVSS dword ptr [ESP + 0x58],XMM1
007157cc : MOVSS XMM1,dword ptr [ESP + 0x3c]
007157d2 : XORPS XMM1,XMM0
007157d5 : MOVSS dword ptr [ESP + 0x5c],XMM1
007157db : MOVSS XMM1,dword ptr [ESP + 0x40]
007157e1 : XORPS XMM1,XMM0
007157e4 : MOVSS dword ptr [ESP + 0x60],XMM1
007157ea : MOVSS XMM1,dword ptr [ESP + 0x44]
007157f0 : XORPS XMM1,XMM0
007157f3 : LEA EAX,[ESP + 0x58]
007157f7 : MOVSS dword ptr [ESP + 0x64],XMM1
007157fd : MOVSS XMM0,dword ptr [EAX]
00715801 : MOVSS dword ptr [ESP + 0x2c],XMM0
00715807 : MOVSS XMM0,dword ptr [EAX + 0x4]
0071580c : MOVSS dword ptr [ESP + 0x30],XMM0
00715812 : MOVSS XMM0,dword ptr [EAX + 0x8]
00715817 : LEA EAX,[ESP + 0x2c]
0071581b : PUSH EAX
0071581c : LEA ECX,[ESP + 0x18]
00715820 : PUSH ECX
00715821 : MOVSS dword ptr [ESP + 0x3c],XMM0
00715827 : CALL 0x004ff722
0071582c : MOVSS XMM3,dword ptr [ESP + 0x10]
00715832 : MOVSS XMM2,dword ptr [ESP + 0x14]
00715838 : MOVSS XMM0,dword ptr [ESP + 0x18]
0071583e : MOVSS XMM1,dword ptr [ESP + 0x1c]
00715844 : MULSS XMM0,XMM3
00715848 : ADDSS XMM0,dword ptr [EDI + 0x4]
0071584d : MULSS XMM1,XMM3
00715851 : ADDSS XMM1,dword ptr [EDI + 0x8]
00715856 : MULSS XMM2,XMM3
0071585a : MOVSS XMM3,dword ptr [EDI]
0071585e : ADDSS XMM3,XMM2
00715862 : MOVSS dword ptr [EDI],XMM3
00715866 : MOVSS dword ptr [EDI + 0x4],XMM0
0071586b : MOVSS dword ptr [EDI + 0x8],XMM1
00715870 : CALL 0x004c5420
00715875 : MOVSS XMM0,dword ptr [EDI]
00715879 : MOV ECX,dword ptr [EBX + 0x4]
0071587c : CMP byte ptr [ECX + 0x18],0x0
00715880 : MOV EAX,dword ptr [EAX + 0xc]
00715883 : MOVSS dword ptr [ESP + 0x14],XMM0
00715889 : MOVSS XMM0,dword ptr [EDI + 0x4]
0071588e : MOVSS dword ptr [ESP + 0x18],XMM0
00715894 : MOVSS XMM0,dword ptr [EDI + 0x8]
00715899 : MOV dword ptr [ESP + 0xc],EAX
0071589d : MOVSS dword ptr [ESP + 0x1c],XMM0
007158a3 : JZ 0x0071591d
007158a5 : CMP byte ptr [EDI + 0x64],0x0
007158a9 : JNZ 0x007158f4
007158ab : MOV byte ptr [EDI + 0x64],0x1
007158af : MOV EDX,dword ptr [EBX + 0x4]
007158b2 : MOV ESI,dword ptr [EDX + 0x1c]
007158b5 : CALL 0x007cc270
007158ba : MOVQ XMM0,qword ptr [EAX]
007158be : MOV EAX,dword ptr [EAX + 0x8]
007158c1 : MOV ESI,dword ptr [ESP + 0x20]
007158c5 : MOVQ qword ptr [ESP + 0x2c],XMM0
007158cb : MOVSS XMM0,dword ptr [ESP + 0x2c]
007158d1 : MOVSS dword ptr [EDI + 0x65],XMM0
007158d6 : MOVSS XMM0,dword ptr [ESP + 0x30]
007158dc : MOV dword ptr [ESP + 0x34],EAX
007158e0 : MOV EAX,dword ptr [ESP + 0xc]
007158e4 : MOVSS dword ptr [EDI + 0x69],XMM0
007158e9 : MOVSS XMM0,dword ptr [ESP + 0x34]
007158ef : MOVSS dword ptr [EDI + 0x6d],XMM0
007158f4 : MOVSS XMM0,dword ptr [EDI + 0x65]
007158f9 : ADDSS XMM0,dword ptr [ESP + 0x14]
007158ff : MOVSS dword ptr [ESP + 0x14],XMM0
00715905 : MOVSS XMM0,dword ptr [EDI + 0x69]
0071590a : ADDSS XMM0,dword ptr [ESP + 0x18]
00715910 : MOVSS dword ptr [ESP + 0x18],XMM0
00715916 : MOVSS XMM0,dword ptr [EDI + 0x6d]
0071591b : JMP 0x00715975
0071591d : MOV EDI,dword ptr [ECX + 0x1c]
00715920 : CMP byte ptr [EDI + 0x5d],0x0
00715924 : JZ 0x00715933
00715926 : MOV EDX,dword ptr [EDI]
00715928 : MOV EAX,dword ptr [EDX + 0x14]
0071592b : MOV ECX,EDI
0071592d : CALL EAX
0071592f : MOV EAX,dword ptr [ESP + 0xc]
00715933 : MOVQ XMM0,qword ptr [EDI + 0xb8]
0071593b : MOV ECX,dword ptr [EDI + 0xc0]
00715941 : MOVQ qword ptr [ESP + 0x2c],XMM0
00715947 : MOVSS XMM0,dword ptr [ESP + 0x2c]
0071594d : ADDSS XMM0,dword ptr [ESP + 0x14]
00715953 : MOVSS dword ptr [ESP + 0x14],XMM0
00715959 : MOVSS XMM0,dword ptr [ESP + 0x30]
0071595f : ADDSS XMM0,dword ptr [ESP + 0x18]
00715965 : MOV dword ptr [ESP + 0x34],ECX
00715969 : MOVSS dword ptr [ESP + 0x18],XMM0
0071596f : MOVSS XMM0,dword ptr [ESP + 0x34]
00715975 : ADDSS XMM0,dword ptr [ESP + 0x1c]
0071597b : MOVSS dword ptr [ESP + 0x1c],XMM0
00715981 : MOVQ XMM0,qword ptr [ESP + 0x14]
00715987 : MOV EDX,dword ptr [ESP + 0x1c]
0071598b : MOVQ qword ptr [EAX],XMM0
0071598f : MOV dword ptr [EAX + 0xc],ESI
00715992 : MOV dword ptr [EAX + 0x8],EDX
00715995 : LEA ESI,[EAX + 0x10]
00715998 : CALL 0x004c5420
0071599d : MOV dword ptr [EAX + 0xc],ESI
007159a0 : MOV EAX,0x1
007159a5 : ADD dword ptr [EBX + 0x10],EAX
007159a8 : ADD dword ptr [EBX + 0xc],EAX
007159ab : CALL 0x004c5420
007159b0 : MOV EAX,dword ptr [EAX + 0x10]
007159b3 : LEA ESI,[EAX + 0x1]
007159b6 : CALL 0x004c5420
007159bb : MOV dword ptr [EAX + 0x10],ESI
007159be : POP EDI
007159bf : POP ESI
007159c0 : XOR EAX,EAX
007159c2 : POP EBX
007159c3 : MOV ESP,EBP
007159c5 : POP EBP
007159c6 : RET 0x8
