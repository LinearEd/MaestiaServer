PROGRAM  : Maestia.exe
FUNCTION : FUN_00ad27f0
ENTRY    : 00ad27f0
BODY     : [[00ad27f0, 00ad2a94]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00ad27f0(void)

{
  int *piVar1;
  int iVar2;
  int iVar3;
  uint uVar4;
  int iVar5;
  int iVar6;
  undefined4 uVar7;
  int *in_ECX;
  float10 fVar8;
  float10 fVar9;
  float fVar10;
  float fVar11;
  float fVar12;
  undefined1 local_38 [24];
  uint local_20;
  int *local_1c;
  float local_18;
  float local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  iVar5 = DAT_00d7c54c;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b24787;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_14 = (float)in_ECX[4];
  local_1c = in_ECX;
  FUN_004437f0(&local_14);
  if ((local_18 == *(float *)(iVar5 + 0x44)) ||
     (local_18 = *(float *)((int)local_18 + 0x10), local_18 == 0.0)) {
    FUN_00406460(L"Invalid SkillScroll");
    local_8 = 0;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaItemSkillScroll::OnUse",0x18,local_38);
    }
    local_8 = 0xffffffff;
    if (local_20 < 8) {
      ExceptionList = local_10;
      return;
    }
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  uVar7 = *(undefined4 *)(DAT_00da93ec + 0x24c);
  iVar5 = FUN_00a1a840(uVar7);
  if ((iVar5 == 0) && (iVar5 = FUN_00a1a6d0(uVar7), iVar5 == 0)) {
    iVar5 = FUN_00a1a780(uVar7);
  }
  piVar1 = *(int **)((int)local_18 + 0x18c);
  iVar2 = *(int *)(DAT_0172491c + 0x17c);
  if ((((piVar1 != (int *)0x0) && (iVar6 = (**(code **)(*piVar1 + 0x38))(uVar4), iVar6 != 0)) &&
      (iVar6 = (**(code **)(*piVar1 + 0x40))(), iVar6 != 0)) && ((iVar5 != 0 && (iVar2 != 0)))) {
    iVar6 = *(int *)(iVar2 + 1000);
    iVar2 = *(int *)(iVar2 + 0xc4);
    local_14 = (float)*(ushort *)(piVar1 + 0x27c);
    iVar3 = *(int *)(iVar5 + 1000);
    fVar11 = *(float *)(iVar3 + 0x6c) - *(float *)(iVar6 + 0x6c);
    fVar12 = *(float *)(iVar3 + 0x70) - *(float *)(iVar6 + 0x70);
    iVar5 = *(int *)(iVar5 + 0xc4);
    fVar10 = *(float *)(iVar3 + 0x68) - *(float *)(iVar6 + 0x68);
    fVar8 = (float10)FUN_0040f460(fVar10 * fVar10 + fVar11 * fVar11 + fVar12 * fVar12);
    iVar5 = iVar5 + iVar2;
    fVar9 = (float10)iVar5;
    if (iVar5 < 0) {
      fVar9 = fVar9 + (float10)4.2949673e+09;
    }
    local_18 = (float)(fVar8 - fVar9);
    if ((local_14 < local_18) && (local_14 != 0.0)) {
      if (DAT_0172491c == 0) {
        ExceptionList = local_10;
        return;
      }
      if (*DAT_00da9894 == 0) {
        ExceptionList = local_10;
        return;
      }
      if (*(int *)(*DAT_00da9894 + 0x1a8) == 0) {
        ExceptionList = local_10;
        return;
      }
      FUN_00406460(L"IDS_CANCELED_SKILL_19");
      local_8 = 1;
      piVar1 = *(int **)(*DAT_00da9894 + 0x1a8);
      uVar7 = FUN_0081d120(local_38);
      local_8._0_1_ = 2;
      (**(code **)(*piVar1 + 0x44))(uVar7,3);
      local_8 = CONCAT31(local_8._1_3_,1);
      FUN_00406560();
      local_8 = 0xffffffff;
      FUN_00406560();
      ExceptionList = local_10;
      return;
    }
  }
  (**(code **)(*local_1c + 0x10))();
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00ad27f0 : PUSH EBP
00ad27f1 : MOV EBP,ESP
00ad27f3 : PUSH -0x1
00ad27f5 : PUSH 0xb24787
00ad27fa : MOV EAX,FS:[0x0]
00ad2800 : PUSH EAX
00ad2801 : SUB ESP,0x44
00ad2804 : PUSH EBX
00ad2805 : PUSH ESI
00ad2806 : PUSH EDI
00ad2807 : MOV EAX,[0x00d66fa0]
00ad280c : XOR EAX,EBP
00ad280e : PUSH EAX
00ad280f : LEA EAX,[EBP + -0xc]
00ad2812 : MOV FS:[0x0],EAX
00ad2818 : MOV dword ptr [EBP + -0x18],ECX
00ad281b : MOV EAX,dword ptr [ECX + 0x10]
00ad281e : MOV ESI,dword ptr [0x00d7c54c]
00ad2824 : LEA ECX,[EBP + -0x10]
00ad2827 : MOV dword ptr [EBP + -0x10],EAX
00ad282a : PUSH ECX
00ad282b : LEA ECX,[ESI + 0x40]
00ad282e : LEA EAX,[EBP + -0x14]
00ad2831 : CALL 0x004437f0
00ad2836 : MOV ESI,dword ptr [ESI + 0x44]
00ad2839 : MOV EAX,dword ptr [EBP + -0x14]
00ad283c : CMP EAX,ESI
00ad283e : JZ 0x00ad284a
00ad2840 : MOV EAX,dword ptr [EAX + 0x10]
00ad2843 : MOV dword ptr [EBP + -0x14],EAX
00ad2846 : TEST EAX,EAX
00ad2848 : JNZ 0x00ad28b1
00ad284a : PUSH 0xca2a20
00ad284f : LEA ECX,[EBP + -0x34]
00ad2852 : CALL 0x00406460
00ad2857 : XOR ESI,ESI
00ad2859 : MOV dword ptr [EBP + -0x4],ESI
00ad285c : MOV EDX,dword ptr [0x00da98e8]
00ad2862 : MOV ECX,dword ptr [EDX]
00ad2864 : CMP ECX,ESI
00ad2866 : JZ 0x00ad287a
00ad2868 : MOV EAX,dword ptr [ECX]
00ad286a : MOV EAX,dword ptr [EAX + 0x14]
00ad286d : LEA EDX,[EBP + -0x34]
00ad2870 : PUSH EDX
00ad2871 : PUSH 0x18
00ad2873 : PUSH 0xca2a48
00ad2878 : CALL EAX
00ad287a : MOV dword ptr [EBP + -0x4],0xffffffff
00ad2881 : CMP dword ptr [EBP + -0x1c],0x8
00ad2885 : JC 0x00ad288f
00ad2887 : MOV ECX,dword ptr [EBP + -0x30]
00ad288a : CALL 0x006f04e0
00ad288f : XOR ECX,ECX
00ad2891 : MOV dword ptr [EBP + -0x1c],0x7
00ad2898 : MOV dword ptr [EBP + -0x20],ESI
00ad289b : MOV word ptr [EBP + -0x30],CX
00ad289f : MOV ECX,dword ptr [EBP + -0xc]
00ad28a2 : MOV dword ptr FS:[0x0],ECX
00ad28a9 : POP ECX
00ad28aa : POP EDI
00ad28ab : POP ESI
00ad28ac : POP EBX
00ad28ad : MOV ESP,EBP
00ad28af : POP EBP
00ad28b0 : RET
00ad28b1 : MOV ECX,dword ptr [0x00da93ec]
00ad28b7 : MOV EDI,dword ptr [ECX + 0x24c]
00ad28bd : PUSH EDI
00ad28be : MOV EBX,ECX
00ad28c0 : CALL 0x00a1a840
00ad28c5 : MOV ESI,EAX
00ad28c7 : TEST ESI,ESI
00ad28c9 : JNZ 0x00ad28e3
00ad28cb : PUSH EDI
00ad28cc : MOV ECX,EBX
00ad28ce : CALL 0x00a1a6d0
00ad28d3 : MOV ESI,EAX
00ad28d5 : TEST ESI,ESI
00ad28d7 : JNZ 0x00ad28e3
00ad28d9 : PUSH EDI
00ad28da : MOV ECX,EBX
00ad28dc : CALL 0x00a1a780
00ad28e1 : MOV ESI,EAX
00ad28e3 : MOV EAX,dword ptr [EBP + -0x14]
00ad28e6 : MOV EBX,dword ptr [EAX + 0x18c]
00ad28ec : MOV EDX,dword ptr [0x0172491c]
00ad28f2 : MOV EDI,dword ptr [EDX + 0x17c]
00ad28f8 : TEST EBX,EBX
00ad28fa : JZ 0x00ad2a79
00ad2900 : MOV EDX,dword ptr [EBX]
00ad2902 : MOV EAX,dword ptr [EDX + 0x38]
00ad2905 : MOV ECX,EBX
00ad2907 : CALL EAX
00ad2909 : TEST EAX,EAX
00ad290b : JZ 0x00ad2a79
00ad2911 : MOV EDX,dword ptr [EBX]
00ad2913 : MOV EAX,dword ptr [EDX + 0x40]
00ad2916 : MOV ECX,EBX
00ad2918 : CALL EAX
00ad291a : TEST EAX,EAX
00ad291c : JZ 0x00ad2a79
00ad2922 : TEST ESI,ESI
00ad2924 : JZ 0x00ad2a79
00ad292a : TEST EDI,EDI
00ad292c : JZ 0x00ad2a79
00ad2932 : MOVZX ECX,word ptr [EBX + 0x9f0]
00ad2939 : MOV EAX,dword ptr [EDI + 0x3e8]
00ad293f : MOV EDI,dword ptr [EDI + 0xc4]
00ad2945 : CVTSI2SS XMM0,ECX
00ad2949 : MOV ECX,dword ptr [ESI + 0x3e8]
00ad294f : MOVSS XMM1,dword ptr [ECX + 0x6c]
00ad2954 : SUBSS XMM1,dword ptr [EAX + 0x6c]
00ad2959 : MOVSS XMM2,dword ptr [ECX + 0x70]
00ad295e : SUBSS XMM2,dword ptr [EAX + 0x70]
00ad2963 : MOV ESI,dword ptr [ESI + 0xc4]
00ad2969 : MOVSS dword ptr [EBP + -0x10],XMM0
00ad296e : MOVSS XMM0,dword ptr [ECX + 0x68]
00ad2973 : SUBSS XMM0,dword ptr [EAX + 0x68]
00ad2978 : ADD ECX,0x68
00ad297b : ADD EAX,0x68
00ad297e : MOVAPS XMM3,XMM0
00ad2981 : MULSS XMM3,XMM0
00ad2985 : MOVAPS XMM0,XMM1
00ad2988 : MULSS XMM0,XMM1
00ad298c : ADDSS XMM3,XMM0
00ad2990 : MOVAPS XMM0,XMM2
00ad2993 : MULSS XMM0,XMM2
00ad2997 : PUSH ECX
00ad2998 : ADDSS XMM3,XMM0
00ad299c : MOVSS dword ptr [ESP],XMM3
00ad29a1 : CALL 0x0040f460
00ad29a6 : ADD ESI,EDI
00ad29a8 : ADD ESP,0x4
00ad29ab : MOV dword ptr [EBP + -0x14],ESI
00ad29ae : FILD dword ptr [EBP + -0x14]
00ad29b1 : TEST ESI,ESI
00ad29b3 : JGE 0x00ad29bb
00ad29b5 : FADD float ptr [0x00cdf0e0]
00ad29bb : MOVSS XMM0,dword ptr [EBP + -0x10]
00ad29c0 : FSUBP
00ad29c2 : FSTP float ptr [EBP + -0x14]
00ad29c5 : MOVSS XMM1,dword ptr [EBP + -0x14]
00ad29ca : COMISS XMM1,XMM0
00ad29cd : JBE 0x00ad2a79
00ad29d3 : UCOMISS XMM0,dword ptr [0x00b9b0b4]
00ad29da : LAHF
00ad29db : TEST AH,0x44
00ad29de : JNP 0x00ad2a79
00ad29e4 : CMP dword ptr [0x0172491c],0x0
00ad29eb : JZ 0x00ad2a83
00ad29f1 : MOV EDX,dword ptr [0x00da9894]
00ad29f7 : MOV EAX,dword ptr [EDX]
00ad29f9 : TEST EAX,EAX
00ad29fb : JZ 0x00ad2a83
00ad2a01 : CMP dword ptr [EAX + 0x1a8],0x0
00ad2a08 : JZ 0x00ad2a83
00ad2a0a : PUSH 0xca2a7c
00ad2a0f : LEA ECX,[EBP + -0x34]
00ad2a12 : CALL 0x00406460
00ad2a17 : MOV EBX,0x1
00ad2a1c : MOV dword ptr [EBP + -0x4],EBX
00ad2a1f : MOV EAX,[0x00da9894]
00ad2a24 : MOV EAX,dword ptr [EAX]
00ad2a26 : MOV ESI,dword ptr [EAX + 0x1a8]
00ad2a2c : LEA ECX,[EBP + -0x34]
00ad2a2f : PUSH ECX
00ad2a30 : MOV ECX,dword ptr [0x0172491c]
00ad2a36 : LEA EDI,[EBP + -0x50]
00ad2a39 : CALL 0x0081d120
00ad2a3e : MOV byte ptr [EBP + -0x4],0x2
00ad2a42 : MOV EDX,dword ptr [ESI]
00ad2a44 : PUSH 0x3
00ad2a46 : PUSH EAX
00ad2a47 : MOV EAX,dword ptr [EDX + 0x44]
00ad2a4a : MOV ECX,ESI
00ad2a4c : CALL EAX
00ad2a4e : MOV byte ptr [EBP + -0x4],BL
00ad2a51 : MOV ECX,EDI
00ad2a53 : CALL 0x00406560
00ad2a58 : MOV dword ptr [EBP + -0x4],0xffffffff
00ad2a5f : LEA ECX,[EBP + -0x34]
00ad2a62 : CALL 0x00406560
00ad2a67 : MOV ECX,dword ptr [EBP + -0xc]
00ad2a6a : MOV dword ptr FS:[0x0],ECX
00ad2a71 : POP ECX
00ad2a72 : POP EDI
00ad2a73 : POP ESI
00ad2a74 : POP EBX
00ad2a75 : MOV ESP,EBP
00ad2a77 : POP EBP
00ad2a78 : RET
00ad2a79 : MOV ECX,dword ptr [EBP + -0x18]
00ad2a7c : MOV EDX,dword ptr [ECX]
00ad2a7e : MOV EAX,dword ptr [EDX + 0x10]
00ad2a81 : CALL EAX
00ad2a83 : MOV ECX,dword ptr [EBP + -0xc]
00ad2a86 : MOV dword ptr FS:[0x0],ECX
00ad2a8d : POP ECX
00ad2a8e : POP EDI
00ad2a8f : POP ESI
00ad2a90 : POP EBX
00ad2a91 : MOV ESP,EBP
00ad2a93 : POP EBP
00ad2a94 : RET
