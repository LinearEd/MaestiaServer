PROGRAM  : Maestia.exe
FUNCTION : FUN_00a25f10
ENTRY    : 00a25f10
BODY     : [[00a25f10, 00a26152]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00a25f10(void)

{
  ushort uVar1;
  ushort uVar2;
  int iVar3;
  int iVar4;
  char cVar5;
  ushort uVar6;
  uint uVar7;
  int in_ECX;
  LPCRITICAL_SECTION lpCriticalSection;
  float fVar8;
  float fVar9;
  float fVar10;
  undefined1 local_5c [4];
  undefined2 local_58;
  undefined4 local_48;
  uint local_44;
  undefined4 local_40;
  undefined4 local_3c;
  float local_38;
  int local_34;
  int local_30;
  LPCRITICAL_SECTION local_2c;
  int *local_28;
  float local_24;
  float local_20;
  float local_1c;
  int local_18;
  int *local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b366a1;
  local_10 = ExceptionList;
  uVar7 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if (in_ECX == 0) {
    local_30 = 0;
  }
  else {
    local_30 = in_ECX + 0x18;
  }
  lpCriticalSection = (LPCRITICAL_SECTION)(local_30 + 4);
  local_2c = lpCriticalSection;
  EnterCriticalSection(lpCriticalSection);
  local_8 = 0;
  if (*(int *)(in_ECX + 0xac) != 0) {
    iVar3 = *(int *)(*(int *)(in_ECX + 0xac) + 1000);
    local_1c = *(float *)(iVar3 + 0x68);
    local_20 = *(float *)(iVar3 + 0x6c);
    local_24 = *(float *)(iVar3 + 0x70);
    local_40 = 0;
    local_3c = 0;
    FUN_00889560(uVar7);
    local_28 = *(int **)(in_ECX + 0xcc);
    local_14 = (int *)*local_28;
    local_38 = 0.0;
    local_34 = -1;
    if (local_14 != local_28) {
      local_18 = *(int *)(in_ECX + 0xac);
      uVar1 = *(ushort *)(local_18 + 0x80);
      do {
        iVar3 = local_14[4];
        uVar2 = *(ushort *)(iVar3 + 0x80);
        if (uVar2 == 0) {
          uVar2 = *(ushort *)(iVar3 + 0x7c);
        }
        uVar6 = uVar1;
        if (uVar1 == 0) {
          uVar6 = *(ushort *)(local_18 + 0x7c);
        }
        if ((uVar6 < 5) || (4 < uVar2)) {
          uVar6 = uVar1;
          if (uVar1 == 0) {
            uVar6 = *(ushort *)(local_18 + 0x7c);
          }
        }
        else {
          uVar6 = FUN_0042a760();
        }
        if (((uVar6 != uVar2) && (cVar5 = FUN_008896f0(), cVar5 == '\0')) &&
           (*(char *)(iVar3 + 0x3ad) != '\0')) {
          iVar4 = *(int *)(iVar3 + 1000);
          fVar9 = *(float *)(iVar4 + 0x6c) - local_20;
          fVar8 = *(float *)(iVar4 + 0x68) - local_1c;
          fVar10 = *(float *)(iVar4 + 0x70) - local_24;
          fVar8 = fVar8 * fVar8 + fVar9 * fVar9 + fVar10 * fVar10;
          if (local_34 == -1) {
            local_34 = *(int *)(iVar3 + 4);
            local_38 = fVar8;
          }
          else if (fVar8 < local_38) {
            local_34 = *(int *)(iVar3 + 4);
            local_38 = fVar8;
          }
        }
        FUN_00416210();
        lpCriticalSection = local_2c;
      } while (local_14 != local_28);
    }
    local_8 = 0xffffffff;
    LeaveCriticalSection(lpCriticalSection);
    ExceptionList = local_10;
    return local_34;
  }
  FUN_00406460(L"MyChar NULL");
  local_8._0_1_ = 1;
  if ((int *)*DAT_00da98e8 != (int *)0x0) {
    (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaGameZone::GetProximityTargets",0x4ab3,local_5c)
    ;
  }
  local_8 = (uint)local_8._1_3_ << 8;
  if (local_44 < 8) {
    local_44 = 7;
    local_48 = 0;
    local_58 = 0;
    local_8 = 0xffffffff;
    LeaveCriticalSection(lpCriticalSection);
    ExceptionList = local_10;
    return 0;
  }
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
00a25f10 : PUSH EBP
00a25f11 : MOV EBP,ESP
00a25f13 : PUSH -0x1
00a25f15 : PUSH 0xb366a1
00a25f1a : MOV EAX,FS:[0x0]
00a25f20 : PUSH EAX
00a25f21 : SUB ESP,0x4c
00a25f24 : PUSH EBX
00a25f25 : PUSH ESI
00a25f26 : PUSH EDI
00a25f27 : MOV EAX,[0x00d66fa0]
00a25f2c : XOR EAX,EBP
00a25f2e : PUSH EAX
00a25f2f : LEA EAX,[EBP + -0xc]
00a25f32 : MOV FS:[0x0],EAX
00a25f38 : MOV EDI,ECX
00a25f3a : XOR ESI,ESI
00a25f3c : CMP EDI,ESI
00a25f3e : JZ 0x00a25f45
00a25f40 : LEA EAX,[EDI + 0x18]
00a25f43 : JMP 0x00a25f47
00a25f45 : XOR EAX,EAX
00a25f47 : LEA EBX,[EAX + 0x4]
00a25f4a : PUSH EBX
00a25f4b : MOV dword ptr [EBP + -0x2c],EAX
00a25f4e : MOV dword ptr [EBP + -0x28],EBX
00a25f51 : CALL dword ptr [0x00b85118]
00a25f57 : MOV dword ptr [EBP + -0x4],ESI
00a25f5a : CMP dword ptr [EDI + 0xac],ESI
00a25f60 : JNZ 0x00a25fd7
00a25f62 : PUSH 0xcc4548
00a25f67 : LEA ECX,[EBP + -0x58]
00a25f6a : CALL 0x00406460
00a25f6f : MOV byte ptr [EBP + -0x4],0x1
00a25f73 : MOV EAX,[0x00da98e8]
00a25f78 : MOV ECX,dword ptr [EAX]
00a25f7a : CMP ECX,ESI
00a25f7c : JZ 0x00a25f93
00a25f7e : MOV EDX,dword ptr [ECX]
00a25f80 : MOV EDX,dword ptr [EDX + 0x14]
00a25f83 : LEA EAX,[EBP + -0x58]
00a25f86 : PUSH EAX
00a25f87 : PUSH 0x4ab3
00a25f8c : PUSH 0xcc4560
00a25f91 : CALL EDX
00a25f93 : MOV byte ptr [EBP + -0x4],0x0
00a25f97 : CMP dword ptr [EBP + -0x40],0x8
00a25f9b : JC 0x00a25fa5
00a25f9d : MOV ECX,dword ptr [EBP + -0x54]
00a25fa0 : CALL 0x006f04e0
00a25fa5 : XOR EAX,EAX
00a25fa7 : MOV dword ptr [EBP + -0x40],0x7
00a25fae : MOV dword ptr [EBP + -0x44],ESI
00a25fb1 : MOV word ptr [EBP + -0x54],AX
00a25fb5 : MOV dword ptr [EBP + -0x4],0xffffffff
00a25fbc : PUSH EBX
00a25fbd : CALL dword ptr [0x00b8511c]
00a25fc3 : XOR EAX,EAX
00a25fc5 : MOV ECX,dword ptr [EBP + -0xc]
00a25fc8 : MOV dword ptr FS:[0x0],ECX
00a25fcf : POP ECX
00a25fd0 : POP EDI
00a25fd1 : POP ESI
00a25fd2 : POP EBX
00a25fd3 : MOV ESP,EBP
00a25fd5 : POP EBP
00a25fd6 : RET
00a25fd7 : MOV EAX,dword ptr [EDI + 0xac]
00a25fdd : MOV ECX,dword ptr [EAX + 0x3e8]
00a25fe3 : MOVSS XMM0,dword ptr [ECX + 0x68]
00a25fe8 : ADD ECX,0x68
00a25feb : MOVSS dword ptr [EBP + -0x18],XMM0
00a25ff0 : MOVSS XMM0,dword ptr [ECX + 0x4]
00a25ff5 : MOVSS dword ptr [EBP + -0x1c],XMM0
00a25ffa : MOVSS XMM0,dword ptr [ECX + 0x8]
00a25fff : MOVSS dword ptr [EBP + -0x20],XMM0
00a26004 : XORPS XMM0,XMM0
00a26007 : LEA ESI,[EBP + -0x3c]
00a2600a : MOVSS dword ptr [EBP + -0x3c],XMM0
00a2600f : MOVSS dword ptr [EBP + -0x38],XMM0
00a26014 : CALL 0x00889560
00a26019 : MOV ECX,dword ptr [EDI + 0xcc]
00a2601f : MOV EAX,dword ptr [ECX]
00a26021 : XORPS XMM0,XMM0
00a26024 : MOV dword ptr [EBP + -0x24],ECX
00a26027 : MOVSS dword ptr [EBP + -0x34],XMM0
00a2602c : MOV dword ptr [EBP + -0x30],0xffffffff
00a26033 : MOV dword ptr [EBP + -0x10],EAX
00a26036 : CMP EAX,ECX
00a26038 : JZ 0x00a26130
00a2603e : MOV ECX,dword ptr [EDI + 0xac]
00a26044 : MOVZX EBX,word ptr [ECX + 0x80]
00a2604b : MOV dword ptr [EBP + -0x14],ECX
00a2604e : JMP 0x00a26053
00a26050 : MOV ECX,dword ptr [EBP + -0x14]
00a26053 : MOV ESI,dword ptr [EAX + 0x10]
00a26056 : MOVZX EAX,word ptr [ESI + 0x80]
00a2605d : MOVZX EDI,AX
00a26060 : TEST AX,AX
00a26063 : JNZ 0x00a26069
00a26065 : MOVZX EDI,word ptr [ESI + 0x7c]
00a26069 : MOVZX EAX,BX
00a2606c : TEST BX,BX
00a2606f : JNZ 0x00a26075
00a26071 : MOVZX EAX,word ptr [ECX + 0x7c]
00a26075 : CMP AX,0x5
00a26079 : JC 0x00a2608b
00a2607b : CMP DI,0x5
00a2607f : JNC 0x00a2608b
00a26081 : CALL 0x0042a760
00a26086 : CMP AX,DI
00a26089 : JMP 0x00a2609a
00a2608b : MOVZX EAX,BX
00a2608e : TEST BX,BX
00a26091 : JNZ 0x00a26097
00a26093 : MOVZX EAX,word ptr [ECX + 0x7c]
00a26097 : CMP DI,AX
00a2609a : SETZ AL
00a2609d : TEST AL,AL
00a2609f : JNZ 0x00a26118
00a260a1 : MOV EAX,ESI
00a260a3 : CALL 0x008896f0
00a260a8 : TEST AL,AL
00a260aa : JNZ 0x00a26118
00a260ac : CMP byte ptr [ESI + 0x3ad],AL
00a260b2 : JZ 0x00a26118
00a260b4 : MOV EAX,dword ptr [ESI + 0x3e8]
00a260ba : MOVSS XMM1,dword ptr [EAX + 0x6c]
00a260bf : SUBSS XMM1,dword ptr [EBP + -0x1c]
00a260c4 : MOVSS XMM0,dword ptr [EAX + 0x68]
00a260c9 : SUBSS XMM0,dword ptr [EBP + -0x18]
00a260ce : MOVSS XMM2,dword ptr [EAX + 0x70]
00a260d3 : SUBSS XMM2,dword ptr [EBP + -0x20]
00a260d8 : ADD EAX,0x68
00a260db : CMP dword ptr [EBP + -0x30],-0x1
00a260df : MOVAPS XMM3,XMM1
00a260e2 : MULSS XMM3,XMM1
00a260e6 : MULSS XMM0,XMM0
00a260ea : MOVAPS XMM1,XMM2
00a260ed : ADDSS XMM0,XMM3
00a260f1 : MULSS XMM1,XMM2
00a260f5 : ADDSS XMM0,XMM1
00a260f9 : JNZ 0x00a26103
00a260fb : MOV ECX,dword ptr [ESI + 0x4]
00a260fe : MOV dword ptr [EBP + -0x30],ECX
00a26101 : JMP 0x00a26113
00a26103 : MOVSS XMM1,dword ptr [EBP + -0x34]
00a26108 : COMISS XMM1,XMM0
00a2610b : JBE 0x00a26118
00a2610d : MOV EDX,dword ptr [ESI + 0x4]
00a26110 : MOV dword ptr [EBP + -0x30],EDX
00a26113 : MOVSS dword ptr [EBP + -0x34],XMM0
00a26118 : LEA EDX,[EBP + -0x10]
00a2611b : CALL 0x00416210
00a26120 : MOV EAX,dword ptr [EBP + -0x10]
00a26123 : CMP EAX,dword ptr [EBP + -0x24]
00a26126 : JNZ 0x00a26050
00a2612c : MOV EBX,dword ptr [EBP + -0x28]
00a2612f : NOP
00a26130 : MOV dword ptr [EBP + -0x4],0xffffffff
00a26137 : PUSH EBX
00a26138 : CALL dword ptr [0x00b8511c]
00a2613e : MOV EAX,dword ptr [EBP + -0x30]
00a26141 : MOV ECX,dword ptr [EBP + -0xc]
00a26144 : MOV dword ptr FS:[0x0],ECX
00a2614b : POP ECX
00a2614c : POP EDI
00a2614d : POP ESI
00a2614e : POP EBX
00a2614f : MOV ESP,EBP
00a26151 : POP EBP
00a26152 : RET
