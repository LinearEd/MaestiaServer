PROGRAM  : Maestia.exe
FUNCTION : FUN_00516bc0
ENTRY    : 00516bc0
BODY     : [[00516bc0, 00516c96] [00516ca0, 00516cc9] [00516cd0, 00516d27]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00516bc0(undefined4 param_1,uint param_2)

{
  undefined4 *puVar1;
  undefined4 *puVar2;
  int iVar3;
  int *in_ECX;
  int iVar4;
  float10 fVar5;
  longlong local_8;
  
  if (param_2 == 0) {
    FUN_005a2e40();
    return;
  }
  if (param_2 < 8) {
    iVar4 = 8;
  }
  else {
    fVar5 = (float10)FUN_0063b270();
    local_8 = (longlong)ROUND((float)fVar5 / 0.6931472 + 1.0);
    iVar4 = 1 << ((byte)local_8 & 0x1f);
  }
  local_8 = CONCAT44(local_8._4_4_,2);
  puVar2 = (undefined4 *)FUN_00515840(iVar4 * 0xc + 8,&local_8);
  *puVar2 = 0;
  puVar2[1] = iVar4 + -1;
  if (iVar4 != 0) {
    iVar3 = 0;
    do {
      *(undefined4 *)(iVar3 + 8 + (int)puVar2) = 0xfffffffe;
      iVar3 = iVar3 + 0xc;
      iVar4 = iVar4 + -1;
    } while (iVar4 != 0);
  }
  if (*in_ECX != 0) {
    iVar3 = 0;
    iVar4 = *(int *)(*in_ECX + 4) + 1;
    do {
      puVar1 = (undefined4 *)(iVar3 + 8 + *in_ECX);
      if (*(int *)(iVar3 + 8 + *in_ECX) != -2) {
        FUN_00516990(param_1,puVar1 + 2,(uint)puVar1[2] >> 6 ^ puVar1[2]);
        *puVar1 = 0xfffffffe;
      }
      iVar3 = iVar3 + 0xc;
      iVar4 = iVar4 + -1;
    } while (iVar4 != 0);
    FUN_00515cf0(*in_ECX);
  }
  *in_ECX = (int)puVar2;
  return;
}



============================================================
DISASSEMBLY
============================================================
00516bc0 : SUB ESP,0xc
00516bc3 : MOV EAX,dword ptr [ESP + 0x14]
00516bc7 : PUSH EDI
00516bc8 : MOV EDI,ECX
00516bca : MOV dword ptr [ESP + 0x4],EDI
00516bce : TEST EAX,EAX
00516bd0 : JNZ 0x00516bde
00516bd2 : CALL 0x005a2e40
00516bd7 : POP EDI
00516bd8 : ADD ESP,0xc
00516bdb : RET 0x8
00516bde : PUSH ESI
00516bdf : CMP EAX,0x8
00516be2 : JNC 0x00516beb
00516be4 : MOV ESI,0x8
00516be9 : JMP 0x00516c50
00516beb : DEC EAX
00516bec : MOV dword ptr [ESP + 0x1c],EAX
00516bf0 : FILD dword ptr [ESP + 0x1c]
00516bf4 : TEST EAX,EAX
00516bf6 : JGE 0x00516bfe
00516bf8 : FADD float ptr [0x00cdf0e0]
00516bfe : CALL 0x0063b270
00516c03 : FSTP float ptr [ESP + 0x1c]
00516c07 : FLD float ptr [ESP + 0x1c]
00516c0b : MOV ESI,0x1
00516c10 : FDIV double ptr [0x00b85fe0]
00516c16 : FSTP float ptr [ESP + 0x1c]
00516c1a : FLD float ptr [ESP + 0x1c]
00516c1e : FADD double ptr [0x00cdf108]
00516c24 : FSTP float ptr [ESP + 0x1c]
00516c28 : FLD float ptr [ESP + 0x1c]
00516c2c : FNSTCW word ptr [ESP + 0x1c]
00516c30 : MOVZX EAX,word ptr [ESP + 0x1c]
00516c35 : OR EAX,0xc00
00516c3a : MOV dword ptr [ESP + 0xc],EAX
00516c3e : FLDCW word ptr [ESP + 0xc]
00516c42 : FISTP qword ptr [ESP + 0xc]
00516c46 : MOV CL,byte ptr [ESP + 0xc]
00516c4a : SHL ESI,CL
00516c4c : FLDCW word ptr [ESP + 0x1c]
00516c50 : LEA EAX,[ESP + 0xc]
00516c54 : LEA ECX,[ESI + ESI*0x2]
00516c57 : LEA EDX,[ECX*0x4 + 0x8]
00516c5e : MOV ECX,dword ptr [0x00d73250]
00516c64 : PUSH EAX
00516c65 : PUSH EDX
00516c66 : MOV dword ptr [ESP + 0x24],0x0
00516c6e : MOV dword ptr [ESP + 0x14],0x2
00516c76 : CALL 0x00515840
00516c7b : MOV dword ptr [ESP + 0x1c],EAX
00516c7f : MOV dword ptr [EAX],0x0
00516c85 : MOV ECX,dword ptr [ESP + 0x1c]
00516c89 : LEA EAX,[ESI + -0x1]
00516c8c : MOV dword ptr [ECX + 0x4],EAX
00516c8f : TEST ESI,ESI
00516c91 : JBE 0x00516cb4
00516c93 : XOR EAX,EAX
00516c95 : JMP 0x00516ca0
00516ca0 : MOV EDX,dword ptr [ESP + 0x1c]
00516ca4 : MOV dword ptr [EAX + EDX*0x1 + 0x8],0xfffffffe
00516cac : ADD EAX,0xc
00516caf : SUB ESI,0x1
00516cb2 : JNZ 0x00516ca0
00516cb4 : MOV EAX,dword ptr [EDI]
00516cb6 : TEST EAX,EAX
00516cb8 : JZ 0x00516d1a
00516cba : MOV EAX,dword ptr [EAX + 0x4]
00516cbd : PUSH EBX
00516cbe : PUSH EBP
00516cbf : MOV EBP,dword ptr [ESP + 0x20]
00516cc3 : XOR EDI,EDI
00516cc5 : LEA EBX,[EAX + 0x1]
00516cc8 : JMP 0x00516cd0
00516cd0 : MOV EAX,dword ptr [ESP + 0x10]
00516cd4 : MOV ECX,dword ptr [EAX]
00516cd6 : CMP dword ptr [EDI + ECX*0x1 + 0x8],-0x2
00516cdb : LEA ESI,[EDI + ECX*0x1 + 0x8]
00516cdf : JZ 0x00516d00
00516ce1 : MOV ECX,dword ptr [ESI + 0x8]
00516ce4 : LEA EAX,[ESI + 0x8]
00516ce7 : MOV EDX,ECX
00516ce9 : SHR EDX,0x6
00516cec : XOR EDX,ECX
00516cee : PUSH EDX
00516cef : PUSH EAX
00516cf0 : PUSH EBP
00516cf1 : LEA ECX,[ESP + 0x30]
00516cf5 : CALL 0x00516990
00516cfa : MOV dword ptr [ESI],0xfffffffe
00516d00 : ADD EDI,0xc
00516d03 : SUB EBX,0x1
00516d06 : JNZ 0x00516cd0
00516d08 : MOV EAX,dword ptr [ESP + 0x10]
00516d0c : MOV ECX,dword ptr [EAX]
00516d0e : PUSH ECX
00516d0f : CALL 0x00515cf0
00516d14 : MOV EDI,dword ptr [ESP + 0x10]
00516d18 : POP EBP
00516d19 : POP EBX
00516d1a : MOV EDX,dword ptr [ESP + 0x1c]
00516d1e : POP ESI
00516d1f : MOV dword ptr [EDI],EDX
00516d21 : POP EDI
00516d22 : ADD ESP,0xc
00516d25 : RET 0x8
