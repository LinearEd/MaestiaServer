PROGRAM  : Maestia.exe
FUNCTION : FUN_00933b80
ENTRY    : 00933b80
BODY     : [[00933b80, 00933dcf]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void FUN_00933b80(void)

{
  undefined2 uVar1;
  undefined2 uVar2;
  int *piVar3;
  int *piVar4;
  int iVar5;
  undefined4 uVar6;
  int iVar7;
  undefined4 *extraout_ECX;
  undefined4 *puVar8;
  int *piVar9;
  undefined4 *puVar10;
  undefined *puVar11;
  uint uVar12;
  int local_200c;
  wchar_t local_2008 [4096];
  uint local_8;
  
  local_8 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  uVar12 = 0;
  if (((*(int *)(DAT_0172491c + 0x17c) != 0) && (*DAT_00da9894 != 0)) &&
     (piVar3 = *(int **)(*DAT_00da9894 + 0x114), piVar3 != (int *)0x0)) {
    (**(code **)(*piVar3 + 4))
              (piVar3,"SetMyLevel",&DAT_00c6eb90,
               *(undefined4 *)(*(int *)(DAT_0172491c + 0x17c) + 0xa0));
  }
  if ((*DAT_00da9894 != 0) &&
     (puVar8 = *(undefined4 **)(*DAT_00da9894 + 0x114), puVar8 != (undefined4 *)0x0)) {
    (**(code **)*puVar8)("ClearQuestBook");
  }
  if (*(int *)(DAT_017248f8 + 0xc) != 0) {
    uVar1 = *(undefined2 *)(*(int *)(DAT_0172491c + 0x17c) + 0x7c);
    piVar9 = (int *)(DAT_017248f8 + 8);
    uVar2 = *(undefined2 *)(*(int *)(DAT_0172491c + 0x17c) + 0x16d8);
    piVar3 = (int *)*piVar9;
    piVar4 = (int *)*piVar3;
    local_200c = 0;
    if (piVar4 != piVar3) {
      do {
        puVar8 = (undefined4 *)piVar4[4];
        iVar7 = puVar8[1];
        if ((((*(uint *)(iVar7 + 0xa0) & 1 << ((byte)uVar2 & 0x1f)) != 0) &&
            ((*(uint *)(iVar7 + 0xa4) & 1 << ((byte)uVar1 & 0x1f)) != 0)) &&
           ((iVar5 = puVar8[10], iVar5 != 0 && (*(char *)(iVar7 + 0x10) != '\x03')))) {
          puVar11 = &DAT_00c6ebb0;
          if (uVar12 == 0) {
            puVar11 = &DAT_00c6ebb4;
          }
          if (*(ushort *)(puVar8 + 9) - 2 < 6) {
            uVar6 = FUN_00933b30();
            puVar8 = extraout_ECX;
          }
          else {
            uVar6 = 0;
          }
          if ((uint)puVar8[8] < 8) {
            puVar10 = puVar8 + 3;
          }
          else {
            puVar10 = (undefined4 *)puVar8[3];
          }
          iVar7 = __snwprintf(local_2008 + uVar12,0x1000 - uVar12,L"%s%d&%d&%d&%s&%d&%d&%d",puVar11,
                              *puVar8,iVar5,puVar8[0xb],puVar10,puVar8[0xc],puVar8[0xd],uVar6);
          uVar12 = uVar12 + iVar7;
          if (0xf38 < uVar12) {
            if ((*DAT_00da9894 != 0) &&
               (piVar3 = *(int **)(*DAT_00da9894 + 0x114), piVar3 != (int *)0x0)) {
              (**(code **)(*piVar3 + 4))(piVar3,"AddQuestBook","%d,%ls",local_200c == 0,local_2008);
              local_200c = local_200c + 1;
            }
            uVar12 = 0;
          }
        }
        FUN_00416210();
      } while (piVar4 != (int *)*piVar9);
    }
    if ((*DAT_00da9894 != 0) && (piVar3 = *(int **)(*DAT_00da9894 + 0x114), piVar3 != (int *)0x0)) {
      (**(code **)(*piVar3 + 4))(piVar3,"AddQuestBook","%d,%ls",local_200c == 0,local_2008);
    }
  }
  __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00933b80 : PUSH EBP
00933b81 : MOV EBP,ESP
00933b83 : MOV EAX,0x2018
00933b88 : CALL 0x0063b780
00933b8d : MOV EAX,[0x00d66fa0]
00933b92 : XOR EAX,EBP
00933b94 : MOV dword ptr [EBP + -0x4],EAX
00933b97 : MOV EAX,[0x0172491c]
00933b9c : MOV ECX,dword ptr [EAX + 0x17c]
00933ba2 : PUSH ESI
00933ba3 : XOR ESI,ESI
00933ba5 : CMP ECX,ESI
00933ba7 : JZ 0x00933bdb
00933ba9 : MOV EDX,dword ptr [0x00da9894]
00933baf : MOV EAX,dword ptr [EDX]
00933bb1 : CMP EAX,ESI
00933bb3 : JZ 0x00933bdb
00933bb5 : MOV EAX,dword ptr [EAX + 0x114]
00933bbb : CMP EAX,ESI
00933bbd : JZ 0x00933bdb
00933bbf : MOV ECX,dword ptr [ECX + 0xa0]
00933bc5 : MOV EDX,dword ptr [EAX]
00933bc7 : MOV EDX,dword ptr [EDX + 0x4]
00933bca : PUSH ECX
00933bcb : PUSH 0xc6eb90
00933bd0 : PUSH 0xc6eb94
00933bd5 : PUSH EAX
00933bd6 : CALL EDX
00933bd8 : ADD ESP,0x10
00933bdb : MOV EAX,[0x00da9894]
00933be0 : MOV EAX,dword ptr [EAX]
00933be2 : CMP EAX,ESI
00933be4 : JZ 0x00933bfb
00933be6 : MOV ECX,dword ptr [EAX + 0x114]
00933bec : CMP ECX,ESI
00933bee : JZ 0x00933bfb
00933bf0 : MOV EDX,dword ptr [ECX]
00933bf2 : MOV EAX,dword ptr [EDX]
00933bf4 : PUSH 0xc6eba0
00933bf9 : CALL EAX
00933bfb : MOV EDX,dword ptr [0x017248f8]
00933c01 : CMP dword ptr [EDX + 0xc],ESI
00933c04 : JZ 0x00933dc1
00933c0a : MOV ECX,dword ptr [0x0172491c]
00933c10 : MOV EAX,dword ptr [ECX + 0x17c]
00933c16 : MOVZX ECX,word ptr [EAX + 0x7c]
00933c1a : ADD EDX,0x8
00933c1d : PUSH EBX
00933c1e : MOVZX EBX,word ptr [EAX + 0x16d8]
00933c25 : MOV EAX,dword ptr [EDX]
00933c27 : MOV dword ptr [EBP + 0xffffdfec],EDX
00933c2d : MOV EDX,dword ptr [EAX]
00933c2f : MOV dword ptr [EBP + 0xffffdff8],ESI
00933c35 : MOV dword ptr [EBP + 0xffffdff4],EDX
00933c3b : CMP EDX,EAX
00933c3d : JZ 0x00933d82
00933c43 : PUSH EDI
00933c44 : MOV EDI,0x1
00933c49 : SHL EDI,CL
00933c4b : MOV EAX,0x1
00933c50 : MOV CL,BL
00933c52 : SHL EAX,CL
00933c54 : MOV dword ptr [EBP + 0xffffdff0],EDI
00933c5a : MOV dword ptr [EBP + 0xffffdfe8],EAX
00933c60 : JMP 0x00933c68
00933c62 : MOV EDI,dword ptr [EBP + 0xffffdff0]
00933c68 : MOV ECX,dword ptr [EDX + 0x10]
00933c6b : MOV EAX,dword ptr [ECX + 0x4]
00933c6e : MOV DL,0x1
00933c70 : TEST dword ptr [EAX + 0xa4],EDI
00933c76 : JNZ 0x00933c7a
00933c78 : XOR DL,DL
00933c7a : MOV EDI,dword ptr [EBP + 0xffffdfe8]
00933c80 : TEST dword ptr [EAX + 0xa0],EDI
00933c86 : JZ 0x00933d62
00933c8c : TEST DL,DL
00933c8e : JZ 0x00933d62
00933c94 : MOV EDI,dword ptr [ECX + 0x28]
00933c97 : TEST EDI,EDI
00933c99 : JZ 0x00933d62
00933c9f : CMP byte ptr [EAX + 0x10],0x3
00933ca3 : JZ 0x00933d62
00933ca9 : MOV EBX,0xc6ebb0
00933cae : TEST ESI,ESI
00933cb0 : JA 0x00933cb7
00933cb2 : MOV EBX,0xc6ebb4
00933cb7 : MOVZX EAX,word ptr [ECX + 0x24]
00933cbb : SUB EAX,0x2
00933cbe : CMP EAX,0x5
00933cc1 : JA 0x00933cca
00933cc3 : CALL 0x00933b30
00933cc8 : JMP 0x00933ccc
00933cca : XOR EAX,EAX
00933ccc : CMP dword ptr [ECX + 0x20],0x8
00933cd0 : JC 0x00933cd7
00933cd2 : MOV EDX,dword ptr [ECX + 0xc]
00933cd5 : JMP 0x00933cda
00933cd7 : LEA EDX,[ECX + 0xc]
00933cda : PUSH EAX
00933cdb : MOV EAX,dword ptr [ECX + 0x34]
00933cde : PUSH EAX
00933cdf : MOV EAX,dword ptr [ECX + 0x30]
00933ce2 : PUSH EAX
00933ce3 : MOV EAX,dword ptr [ECX]
00933ce5 : PUSH EDX
00933ce6 : MOV EDX,dword ptr [ECX + 0x2c]
00933ce9 : PUSH EDX
00933cea : PUSH EDI
00933ceb : PUSH EAX
00933cec : PUSH EBX
00933ced : MOV ECX,0x1000
00933cf2 : PUSH 0xc6ebb8
00933cf7 : SUB ECX,ESI
00933cf9 : PUSH ECX
00933cfa : LEA EDX,[EBP + ESI*0x2 + 0xffffdffc]
00933d01 : PUSH EDX
00933d02 : CALL 0x006343c8
00933d07 : ADD ESI,EAX
00933d09 : ADD ESP,0x2c
00933d0c : CMP ESI,0xf38
00933d12 : JBE 0x00933d62
00933d14 : MOV EAX,[0x00da9894]
00933d19 : MOV EAX,dword ptr [EAX]
00933d1b : TEST EAX,EAX
00933d1d : JZ 0x00933d60
00933d1f : MOV EAX,dword ptr [EAX + 0x114]
00933d25 : TEST EAX,EAX
00933d27 : JZ 0x00933d60
00933d29 : MOV ECX,dword ptr [EBP + 0xffffdff8]
00933d2f : MOV EDX,ECX
00933d31 : INC ECX
00933d32 : MOV dword ptr [EBP + 0xffffdff8],ECX
00933d38 : TEST EDX,EDX
00933d3a : JNZ 0x00933d41
00933d3c : LEA ECX,[EDX + 0x1]
00933d3f : JMP 0x00933d43
00933d41 : XOR ECX,ECX
00933d43 : MOV EDX,dword ptr [EAX]
00933d45 : LEA ESI,[EBP + 0xffffdffc]
00933d4b : PUSH ESI
00933d4c : PUSH ECX
00933d4d : PUSH 0xc6ebe8
00933d52 : PUSH 0xc6ebf0
00933d57 : PUSH EAX
00933d58 : MOV EAX,dword ptr [EDX + 0x4]
00933d5b : CALL EAX
00933d5d : ADD ESP,0x14
00933d60 : XOR ESI,ESI
00933d62 : LEA EDX,[EBP + 0xffffdff4]
00933d68 : CALL 0x00416210
00933d6d : MOV EDX,dword ptr [EBP + 0xffffdff4]
00933d73 : MOV ECX,dword ptr [EBP + 0xffffdfec]
00933d79 : CMP EDX,dword ptr [ECX]
00933d7b : JNZ 0x00933c62
00933d81 : POP EDI
00933d82 : MOV EDX,dword ptr [0x00da9894]
00933d88 : MOV EAX,dword ptr [EDX]
00933d8a : POP EBX
00933d8b : TEST EAX,EAX
00933d8d : JZ 0x00933dc1
00933d8f : MOV EAX,dword ptr [EAX + 0x114]
00933d95 : TEST EAX,EAX
00933d97 : JZ 0x00933dc1
00933d99 : MOV ECX,dword ptr [EAX]
00933d9b : LEA EDX,[EBP + 0xffffdffc]
00933da1 : PUSH EDX
00933da2 : XOR EDX,EDX
00933da4 : CMP dword ptr [EBP + 0xffffdff8],EDX
00933daa : SETZ DL
00933dad : PUSH EDX
00933dae : PUSH 0xc6ec00
00933db3 : PUSH 0xc6ec08
00933db8 : PUSH EAX
00933db9 : MOV EAX,dword ptr [ECX + 0x4]
00933dbc : CALL EAX
00933dbe : ADD ESP,0x14
00933dc1 : MOV ECX,dword ptr [EBP + -0x4]
00933dc4 : XOR ECX,EBP
00933dc6 : POP ESI
00933dc7 : CALL 0x00633e6b
00933dcc : MOV ESP,EBP
00933dce : POP EBP
00933dcf : RET
