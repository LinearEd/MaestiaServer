PROGRAM  : Maestia.exe
FUNCTION : FUN_00540dc0
ENTRY    : 00540dc0
BODY     : [[00540dc0, 00540eae]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00540dc0(int *param_1,int param_2)

{
  int *piVar1;
  int iVar2;
  short *psVar3;
  int iVar4;
  int in_ECX;
  uint uVar5;
  int local_4;
  
  if (((*param_1 != 0) && (iVar2 = param_1[1], -1 < iVar2)) && (iVar2 < *(int *)(*param_1 + 4))) {
    local_4 = 0;
    if (iVar2 != 0) {
      piVar1 = *(int **)(*(int *)(in_ECX + 0xc) + -4 + iVar2 * 4);
      uVar5 = piVar1[1];
      if (uVar5 != 0) {
        if ((*piVar1 == 0) || (uVar5 <= uVar5 - 1)) {
          psVar3 = (short *)0x0;
        }
        else {
          psVar3 = (short *)(*piVar1 + (uVar5 - 1) * 2);
        }
        if (*psVar3 == 0) {
          uVar5 = uVar5 - 1;
        }
      }
      local_4 = uVar5 + piVar1[7];
    }
    FUN_0053f720();
    param_1 = (int *)FUN_0053f770();
    FUN_00540a60(iVar2,&param_1);
    iVar4 = (int)param_1;
    if (param_1 != (int *)0x0) {
      FUN_0053bb30(*(undefined4 *)((int)param_1 + 0x10),*(undefined4 *)((int)param_1 + 0x14));
      FUN_00515cf0(*(undefined4 *)(iVar4 + 0x10));
      if (*(GRefCountNTSImpl **)(iVar4 + 0xc) != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(iVar4 + 0xc));
      }
      FUN_00515cf0(iVar4);
    }
    iVar2 = *(int *)(*(int *)(in_ECX + 0xc) + iVar2 * 4);
    iVar4 = param_2;
    if (param_2 == 0) {
      iVar4 = *(int *)(in_ECX + 0x18);
    }
    FUN_0053c230(*(undefined4 *)(in_ECX + 8),iVar4);
    *(int *)(iVar2 + 0x1c) = local_4;
    return iVar2;
  }
  iVar2 = FUN_00540b60(param_2);
  return iVar2;
}



============================================================
DISASSEMBLY
============================================================
00540dc0 : PUSH ECX
00540dc1 : PUSH EBP
00540dc2 : MOV EBP,ECX
00540dc4 : MOV ECX,dword ptr [ESP + 0xc]
00540dc8 : MOV EAX,dword ptr [ECX]
00540dca : PUSH EDI
00540dcb : TEST EAX,EAX
00540dcd : JZ 0x00540ddb
00540dcf : MOV EDI,dword ptr [ECX + 0x4]
00540dd2 : TEST EDI,EDI
00540dd4 : JL 0x00540ddb
00540dd6 : CMP EDI,dword ptr [EAX + 0x4]
00540dd9 : JL 0x00540ded
00540ddb : MOV EAX,dword ptr [ESP + 0x14]
00540ddf : PUSH EAX
00540de0 : MOV ECX,EBP
00540de2 : CALL 0x00540b60
00540de7 : POP EDI
00540de8 : POP EBP
00540de9 : POP ECX
00540dea : RET 0x8
00540ded : PUSH ESI
00540dee : MOV dword ptr [ESP + 0xc],0x0
00540df6 : TEST EDI,EDI
00540df8 : JBE 0x00540e2c
00540dfa : MOV ECX,dword ptr [EBP + 0xc]
00540dfd : MOV EAX,dword ptr [ECX + EDI*0x4 + -0x4]
00540e01 : MOV ECX,dword ptr [EAX + 0x4]
00540e04 : MOV ESI,dword ptr [EAX + 0x1c]
00540e07 : TEST ECX,ECX
00540e09 : JBE 0x00540e26
00540e0b : MOV EAX,dword ptr [EAX]
00540e0d : LEA EDX,[ECX + -0x1]
00540e10 : TEST EAX,EAX
00540e12 : JZ 0x00540e1d
00540e14 : CMP EDX,ECX
00540e16 : JNC 0x00540e1d
00540e18 : LEA EAX,[EAX + EDX*0x2]
00540e1b : JMP 0x00540e1f
00540e1d : XOR EAX,EAX
00540e1f : CMP word ptr [EAX],0x0
00540e23 : JNZ 0x00540e26
00540e25 : DEC ECX
00540e26 : ADD ECX,ESI
00540e28 : MOV dword ptr [ESP + 0xc],ECX
00540e2c : PUSH EBX
00540e2d : MOV ECX,EBP
00540e2f : CALL 0x0053f720
00540e34 : MOV ECX,EAX
00540e36 : CALL 0x0053f770
00540e3b : LEA EDX,[ESP + 0x18]
00540e3f : PUSH EDX
00540e40 : LEA EBX,[EBP + 0xc]
00540e43 : PUSH EDI
00540e44 : MOV ECX,EBX
00540e46 : MOV dword ptr [ESP + 0x20],EAX
00540e4a : CALL 0x00540a60
00540e4f : MOV ESI,dword ptr [ESP + 0x18]
00540e53 : TEST ESI,ESI
00540e55 : JZ 0x00540e82
00540e57 : MOV EAX,dword ptr [ESI + 0x14]
00540e5a : MOV ECX,dword ptr [ESI + 0x10]
00540e5d : PUSH EAX
00540e5e : PUSH ECX
00540e5f : CALL 0x0053bb30
00540e64 : MOV EDX,dword ptr [ESI + 0x10]
00540e67 : ADD ESP,0x8
00540e6a : PUSH EDX
00540e6b : CALL 0x00515cf0
00540e70 : MOV ECX,dword ptr [ESI + 0xc]
00540e73 : TEST ECX,ECX
00540e75 : JZ 0x00540e7c
00540e77 : CALL 0x004ff7c0
00540e7c : PUSH ESI
00540e7d : CALL 0x00515cf0
00540e82 : MOV EAX,dword ptr [EBX]
00540e84 : MOV ESI,dword ptr [EAX + EDI*0x4]
00540e87 : MOV EAX,dword ptr [ESP + 0x1c]
00540e8b : POP EBX
00540e8c : TEST EAX,EAX
00540e8e : JNZ 0x00540e93
00540e90 : MOV EAX,dword ptr [EBP + 0x18]
00540e93 : MOV ECX,dword ptr [EBP + 0x8]
00540e96 : PUSH EAX
00540e97 : PUSH ECX
00540e98 : MOV ECX,ESI
00540e9a : CALL 0x0053c230
00540e9f : MOV EDX,dword ptr [ESP + 0xc]
00540ea3 : MOV dword ptr [ESI + 0x1c],EDX
00540ea6 : MOV EAX,ESI
00540ea8 : POP ESI
00540ea9 : POP EDI
00540eaa : POP EBP
00540eab : POP ECX
00540eac : RET 0x8
