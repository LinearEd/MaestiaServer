PROGRAM  : Maestia.exe
FUNCTION : FUN_008e90e0
ENTRY    : 008e90e0
BODY     : [[008e90e0, 008e92fc] [008e9300, 008e9447]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008e90e0(uint param_1)

{
  int iVar1;
  undefined4 uVar2;
  uint uVar3;
  int iVar4;
  int iVar5;
  uint8_t *packet;
  int in_ECX;
  int *piVar6;
  byte bVar7;
  undefined1 local_6c [24];
  uint local_54;
  undefined1 local_50 [60];
  void *local_14;
  undefined1 *puStack_10;
  undefined4 local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b3f1dd;
  local_14 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xffffff80;
  ExceptionList = &local_14;
  if ((*(int *)(in_ECX + 0x5c) - *(int *)(in_ECX + 0x58) & 0xfffffffcU) == 0) {
    FUN_00406460(L"ulIndex Error");
    local_c = 0;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                (L"AvaGuiGameMailBox::SendDeleteMail",0x8e,local_6c,uVar3);
    }
    local_c = 0xffffffff;
    if (7 < local_54) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    ExceptionList = local_14;
    return;
  }
  if (param_1 < (uint)(*(int *)(in_ECX + 0x5c) - *(int *)(in_ECX + 0x58) >> 2)) {
    iVar4 = param_1 * 4;
    if (*(int *)(*(int *)(in_ECX + 0x58) + iVar4) != 0) {
      iVar1 = *(int *)(*(int *)(in_ECX + 0x58) + iVar4);
      if ((*(int *)(iVar1 + 0xa8) != 0) && (*DAT_00da9894 != 0)) {
        FUN_00406460(L"IDS_POST_CANT_DELETE_EXIST_ITEM_MAIL");
        local_c = 2;
        iVar4 = FUN_0081d120(local_50);
        local_c._0_1_ = 3;
        if (*(uint *)(iVar4 + 0x18) < 8) {
          iVar4 = iVar4 + 4;
        }
        else {
          iVar4 = *(int *)(iVar4 + 4);
        }
        FUN_00406460(iVar4);
        local_c._0_1_ = 4;
        FUN_008ede80(local_6c,0);
        local_c._0_1_ = 3;
        FUN_00406560();
        local_c = CONCAT31(local_c._1_3_,2);
        FUN_00406560();
        local_c = 0xffffffff;
        FUN_00406560();
        ExceptionList = local_14;
        return;
      }
      iVar5 = 0;
      piVar6 = (int *)(iVar1 + 0xb0);
      do {
        if ((*piVar6 == 1) && (*DAT_00da9894 != 0)) {
          FUN_00406460(L"IDS_POST_CANT_DELETE_EXIST_ITEM_MAIL");
          local_c = 5;
          iVar4 = FUN_0081d120(local_6c);
          local_c._0_1_ = 6;
          if (*(uint *)(iVar4 + 0x18) < 8) {
            iVar4 = iVar4 + 4;
          }
          else {
            iVar4 = *(int *)(iVar4 + 4);
          }
          FUN_00406460(iVar4);
          local_c._0_1_ = 7;
          FUN_008ede80(local_50,0);
          local_c._0_1_ = 6;
          FUN_00406560();
          local_c = CONCAT31(local_c._1_3_,5);
          FUN_00406560();
          local_c = 0xffffffff;
          FUN_00406560();
          ExceptionList = local_14;
          return;
        }
        iVar5 = iVar5 + 1;
        piVar6 = piVar6 + 1;
      } while (iVar5 < 4);
      iVar1 = *(int *)ThreadLocalStoragePointer;
      bVar7 = (byte)((ulonglong)(*(byte *)(iVar1 + 0x18) + 1) % 3);
      *(byte *)(iVar1 + 0x18) = bVar7;
      packet = (uint8_t *)((uint)bVar7 * 0x2000 + 0x122cb8 + iVar1);
      if (packet == (uint8_t *)0x0) {
        packet = (uint8_t *)0x0;
      }
      else {
        uVar2 = **(undefined4 **)(*(int *)(in_ECX + 0x58) + iVar4);
        packet[0] = '\0';
        packet[1] = '\0';
        packet[2] = 'D';
        packet[3] = ')';
        *(undefined4 *)(packet + 4) = uVar2;
      }
      local_c = 0xffffffff;
      if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
        FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),8,packet);
      }
    }
    ExceptionList = local_14;
    return;
  }
  FUN_00406460(L"ulIndex Error");
  local_c = 1;
  if ((int *)*DAT_00da98e8 != (int *)0x0) {
    (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaGuiGameMailBox::SendDeleteMail",0x94,local_6c);
  }
  local_c = 0xffffffff;
  if (7 < local_54) {
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  ExceptionList = local_14;
  return;
}



============================================================
DISASSEMBLY
============================================================
008e90e0 : PUSH EBP
008e90e1 : MOV EBP,ESP
008e90e3 : AND ESP,0xfffffff8
008e90e6 : PUSH -0x1
008e90e8 : PUSH 0xb3f1dd
008e90ed : MOV EAX,FS:[0x0]
008e90f3 : PUSH EAX
008e90f4 : SUB ESP,0x60
008e90f7 : PUSH EBX
008e90f8 : PUSH ESI
008e90f9 : PUSH EDI
008e90fa : MOV EAX,[0x00d66fa0]
008e90ff : XOR EAX,ESP
008e9101 : PUSH EAX
008e9102 : LEA EAX,[ESP + 0x70]
008e9106 : MOV FS:[0x0],EAX
008e910c : MOV EAX,dword ptr [EBP + 0x8]
008e910f : MOV ESI,ECX
008e9111 : MOV ECX,dword ptr [ESI + 0x5c]
008e9114 : SUB ECX,dword ptr [ESI + 0x58]
008e9117 : TEST ECX,0xfffffffc
008e911d : JNZ 0x008e9195
008e911f : PUSH 0xc5a598
008e9124 : LEA ECX,[ESP + 0x1c]
008e9128 : CALL 0x00406460
008e912d : XOR ESI,ESI
008e912f : MOV dword ptr [ESP + 0x78],ESI
008e9133 : MOV EDX,dword ptr [0x00da98e8]
008e9139 : MOV ECX,dword ptr [EDX]
008e913b : CMP ECX,ESI
008e913d : JZ 0x008e9155
008e913f : MOV EAX,dword ptr [ECX]
008e9141 : MOV EAX,dword ptr [EAX + 0x14]
008e9144 : LEA EDX,[ESP + 0x18]
008e9148 : PUSH EDX
008e9149 : PUSH 0x8e
008e914e : PUSH 0xc5a5d0
008e9153 : CALL EAX
008e9155 : MOV dword ptr [ESP + 0x78],0xffffffff
008e915d : CMP dword ptr [ESP + 0x30],0x8
008e9162 : JC 0x008e916d
008e9164 : MOV ECX,dword ptr [ESP + 0x1c]
008e9168 : CALL 0x006f04e0
008e916d : XOR ECX,ECX
008e916f : MOV dword ptr [ESP + 0x30],0x7
008e9177 : MOV dword ptr [ESP + 0x2c],ESI
008e917b : MOV word ptr [ESP + 0x1c],CX
008e9180 : MOV ECX,dword ptr [ESP + 0x70]
008e9184 : MOV dword ptr FS:[0x0],ECX
008e918b : POP ECX
008e918c : POP EDI
008e918d : POP ESI
008e918e : POP EBX
008e918f : MOV ESP,EBP
008e9191 : POP EBP
008e9192 : RET 0x4
008e9195 : MOV EDX,dword ptr [ESI + 0x5c]
008e9198 : SUB EDX,dword ptr [ESI + 0x58]
008e919b : SAR EDX,0x2
008e919e : CMP EAX,EDX
008e91a0 : JC 0x008e921d
008e91a2 : PUSH 0xc5a5b4
008e91a7 : LEA ECX,[ESP + 0x1c]
008e91ab : CALL 0x00406460
008e91b0 : MOV dword ptr [ESP + 0x78],0x1
008e91b8 : MOV EAX,[0x00da98e8]
008e91bd : MOV ECX,dword ptr [EAX]
008e91bf : TEST ECX,ECX
008e91c1 : JZ 0x008e91d9
008e91c3 : MOV EDX,dword ptr [ECX]
008e91c5 : MOV EDX,dword ptr [EDX + 0x14]
008e91c8 : LEA EAX,[ESP + 0x18]
008e91cc : PUSH EAX
008e91cd : PUSH 0x94
008e91d2 : PUSH 0xc5a618
008e91d7 : CALL EDX
008e91d9 : MOV dword ptr [ESP + 0x78],0xffffffff
008e91e1 : CMP dword ptr [ESP + 0x30],0x8
008e91e6 : JC 0x008e91f1
008e91e8 : MOV ECX,dword ptr [ESP + 0x1c]
008e91ec : CALL 0x006f04e0
008e91f1 : XOR EAX,EAX
008e91f3 : MOV dword ptr [ESP + 0x30],0x7
008e91fb : MOV dword ptr [ESP + 0x2c],0x0
008e9203 : MOV word ptr [ESP + 0x1c],AX
008e9208 : MOV ECX,dword ptr [ESP + 0x70]
008e920c : MOV dword ptr FS:[0x0],ECX
008e9213 : POP ECX
008e9214 : POP EDI
008e9215 : POP ESI
008e9216 : POP EBX
008e9217 : MOV ESP,EBP
008e9219 : POP EBP
008e921a : RET 0x4
008e921d : MOV ECX,dword ptr [ESI + 0x58]
008e9220 : LEA EDI,[EAX*0x4 + 0x0]
008e9227 : CMP dword ptr [ECX + EDI*0x1],0x0
008e922b : LEA EAX,[ECX + EDI*0x1]
008e922e : JZ 0x008e9433
008e9234 : MOV ECX,dword ptr [EAX]
008e9236 : CMP dword ptr [ECX + 0xa8],0x0
008e923d : MOV EDX,dword ptr [0x00da9894]
008e9243 : JBE 0x008e92f3
008e9249 : CMP dword ptr [EDX],0x0
008e924c : JZ 0x008e92f3
008e9252 : PUSH 0xc5a680
008e9257 : LEA ECX,[ESP + 0x38]
008e925b : CALL 0x00406460
008e9260 : MOV dword ptr [ESP + 0x78],0x2
008e9268 : MOV ECX,dword ptr [0x0172491c]
008e926e : LEA EDX,[ESP + 0x34]
008e9272 : PUSH EDX
008e9273 : LEA EDI,[ESP + 0x54]
008e9277 : CALL 0x0081d120
008e927c : MOV BL,0x3
008e927e : MOV byte ptr [ESP + 0x78],BL
008e9282 : CMP dword ptr [EAX + 0x18],0x8
008e9286 : JC 0x008e928d
008e9288 : MOV EAX,dword ptr [EAX + 0x4]
008e928b : JMP 0x008e9290
008e928d : ADD EAX,0x4
008e9290 : PUSH EAX
008e9291 : LEA ECX,[ESP + 0x1c]
008e9295 : CALL 0x00406460
008e929a : MOV byte ptr [ESP + 0x78],0x4
008e929f : MOV EAX,[0x00da9894]
008e92a4 : MOV ECX,dword ptr [EAX]
008e92a6 : PUSH 0x0
008e92a8 : LEA EDX,[ESP + 0x1c]
008e92ac : PUSH EDX
008e92ad : CALL 0x008ede80
008e92b2 : MOV byte ptr [ESP + 0x78],BL
008e92b6 : LEA ECX,[ESP + 0x18]
008e92ba : CALL 0x00406560
008e92bf : MOV byte ptr [ESP + 0x78],0x2
008e92c4 : LEA ECX,[ESP + 0x50]
008e92c8 : CALL 0x00406560
008e92cd : MOV dword ptr [ESP + 0x78],0xffffffff
008e92d5 : LEA ECX,[ESP + 0x34]
008e92d9 : CALL 0x00406560
008e92de : MOV ECX,dword ptr [ESP + 0x70]
008e92e2 : MOV dword ptr FS:[0x0],ECX
008e92e9 : POP ECX
008e92ea : POP EDI
008e92eb : POP ESI
008e92ec : POP EBX
008e92ed : MOV ESP,EBP
008e92ef : POP EBP
008e92f0 : RET 0x4
008e92f3 : XOR EAX,EAX
008e92f5 : ADD ECX,0xb0
008e92fb : JMP 0x008e9300
008e9300 : CMP dword ptr [ECX],0x1
008e9303 : JNZ 0x008e930a
008e9305 : CMP dword ptr [EDX],0x0
008e9308 : JNZ 0x008e936a
008e930a : INC EAX
008e930b : ADD ECX,0x4
008e930e : CMP EAX,0x4
008e9311 : JL 0x008e9300
008e9313 : MOV EAX,FS:[0x2c]
008e9319 : MOV ECX,dword ptr [EAX]
008e931b : MOVZX EAX,byte ptr [ECX + 0x18]
008e931f : INC EAX
008e9320 : CDQ
008e9321 : MOV EBX,0x3
008e9326 : IDIV EBX
008e9328 : MOV byte ptr [ECX + 0x18],DL
008e932b : MOVZX EDX,DL
008e932e : SHL EDX,0xd
008e9331 : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
008e9338 : MOV dword ptr [ESP + 0x14],EAX
008e933c : MOV dword ptr [ESP + 0x78],0x8
008e9344 : TEST EAX,EAX
008e9346 : JZ 0x008e940c
008e934c : MOV ECX,dword ptr [ESI + 0x58]
008e934f : ADD ECX,EDI
008e9351 : MOV ECX,dword ptr [ECX]
008e9353 : MOV ECX,dword ptr [ECX]
008e9355 : XOR EDX,EDX
008e9357 : MOV word ptr [EAX],DX
008e935a : MOV byte ptr [EAX + 0x2],0x44
008e935e : MOV byte ptr [EAX + 0x3],0x29
008e9362 : MOV dword ptr [EAX + 0x4],ECX
008e9365 : JMP 0x008e940e
008e936a : PUSH 0xc5a6d0
008e936f : LEA ECX,[ESP + 0x1c]
008e9373 : CALL 0x00406460
008e9378 : MOV dword ptr [ESP + 0x78],0x5
008e9380 : MOV ECX,dword ptr [0x0172491c]
008e9386 : LEA EAX,[ESP + 0x18]
008e938a : PUSH EAX
008e938b : LEA EDI,[ESP + 0x54]
008e938f : CALL 0x0081d120
008e9394 : MOV BL,0x6
008e9396 : MOV byte ptr [ESP + 0x78],BL
008e939a : CMP dword ptr [EAX + 0x18],0x8
008e939e : JC 0x008e93a5
008e93a0 : MOV EAX,dword ptr [EAX + 0x4]
008e93a3 : JMP 0x008e93a8
008e93a5 : ADD EAX,0x4
008e93a8 : PUSH EAX
008e93a9 : LEA ECX,[ESP + 0x38]
008e93ad : CALL 0x00406460
008e93b2 : MOV byte ptr [ESP + 0x78],0x7
008e93b7 : MOV ECX,dword ptr [0x00da9894]
008e93bd : MOV ECX,dword ptr [ECX]
008e93bf : PUSH 0x0
008e93c1 : LEA EDX,[ESP + 0x38]
008e93c5 : PUSH EDX
008e93c6 : CALL 0x008ede80
008e93cb : MOV byte ptr [ESP + 0x78],BL
008e93cf : LEA ECX,[ESP + 0x34]
008e93d3 : CALL 0x00406560
008e93d8 : MOV byte ptr [ESP + 0x78],0x5
008e93dd : LEA ECX,[ESP + 0x50]
008e93e1 : CALL 0x00406560
008e93e6 : MOV dword ptr [ESP + 0x78],0xffffffff
008e93ee : LEA ECX,[ESP + 0x18]
008e93f2 : CALL 0x00406560
008e93f7 : MOV ECX,dword ptr [ESP + 0x70]
008e93fb : MOV dword ptr FS:[0x0],ECX
008e9402 : POP ECX
008e9403 : POP EDI
008e9404 : POP ESI
008e9405 : POP EBX
008e9406 : MOV ESP,EBP
008e9408 : POP EBP
008e9409 : RET 0x4
008e940c : XOR EAX,EAX
008e940e : MOV dword ptr [ESP + 0x78],0xffffffff
008e9416 : MOV EDX,dword ptr [0x017247d4]
008e941c : MOV ECX,dword ptr [EDX + 0x4]
008e941f : TEST ECX,ECX
008e9421 : JZ 0x008e9433
008e9423 : CMP byte ptr [EDX + 0x8],0x0
008e9427 : JZ 0x008e9433
008e9429 : PUSH 0x8
008e942b : PUSH ECX
008e942c : MOV EDI,EAX
008e942e : CALL 0x00a0dd40
008e9433 : MOV ECX,dword ptr [ESP + 0x70]
008e9437 : MOV dword ptr FS:[0x0],ECX
008e943e : POP ECX
008e943f : POP EDI
008e9440 : POP ESI
008e9441 : POP EBX
008e9442 : MOV ESP,EBP
008e9444 : POP EBP
008e9445 : RET 0x4
