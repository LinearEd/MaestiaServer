PROGRAM  : Maestia.exe
FUNCTION : FUN_005e8450
ENTRY    : 005e8450
BODY     : [[005e8450, 005e8616]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005e8450(int param_1)

{
  undefined1 uVar1;
  undefined1 uVar2;
  int iVar3;
  int *piVar4;
  int iVar5;
  int iVar6;
  int iVar7;
  int iVar8;
  GThread *this;
  GRefCountNTSImpl *this_00;
  int *unaff_EBP;
  int iVar9;
  
  iVar5 = param_1;
  iVar8 = *(int *)(param_1 + 0x314);
  if (iVar8 == 0) {
    iVar8 = param_1 + 0x28;
  }
  *(undefined1 *)(iVar8 + 0x15) = 0;
  if (*(int *)(iVar8 + 0x30) - *(int *)(iVar8 + 0x2c) < 2) {
    FUN_00539fb0(2);
  }
  iVar6 = *(int *)(iVar8 + 0x2c);
  uVar1 = *(undefined1 *)(*(int *)(iVar8 + 0x3c) + 1 + iVar6);
  uVar2 = *(undefined1 *)(*(int *)(iVar8 + 0x3c) + iVar6);
  *(int *)(iVar8 + 0x2c) = iVar6 + 2;
  this = (GThread *)(uint)CONCAT11(uVar1,uVar2);
  GThread::OnExit(this);
  iVar6 = FUN_005e63b0();
  iVar8 = *(int *)(param_1 + 0x314);
  if (iVar8 == 0) {
    iVar8 = param_1 + 0x28;
  }
  iVar9 = *(int *)(iVar8 + 0x34);
  iVar3 = *(int *)(iVar8 + 0x30);
  this_00 = (GRefCountNTSImpl *)0x0;
  iVar8 = *(int *)(iVar8 + 0x2c);
  if (*(int *)(*(int *)(param_1 + 0x10) + 0x28) == 0) {
    FUN_00555e50(param_1 + 0x14,"Error: GFxZlibState is not set - can\'t load zipped image data\n");
  }
  else {
    piVar4 = *(int **)(*(int *)(param_1 + 0x10) + 0x24);
    if (piVar4 == (int *)0x0) {
      FUN_00555e50(param_1 + 0x14,
                   "Error: Jpeg System is not installed - can\'t load jpeg image data\n");
    }
    else {
      iVar7 = FUN_005a02c0(*(undefined4 *)(param_1 + 0x2b8));
      if (iVar7 == 0) {
        param_1 = FUN_00561610();
      }
      else {
        param_1 = DAT_00d73250;
      }
      iVar7 = *(int *)(iVar5 + 0x314);
      if (iVar7 == 0) {
        iVar7 = iVar5 + 0x28;
      }
      FUN_0053a0b0();
      *(undefined1 *)(iVar7 + 0x38) = 1;
      this_00 = (GRefCountNTSImpl *)
                (**(code **)(*piVar4 + 0x14))(*(undefined4 *)(iVar7 + 0x10),param_1);
      FUN_0053a190((iVar9 - iVar3) + iVar8 + iVar6);
      iVar9 = *(int *)(this_00 + 0x10) * *(int *)(this_00 + 0xc);
      iVar6 = FUN_00515840(iVar9,0);
      iVar8 = *(int *)(iVar5 + 0x314);
      if (iVar8 == 0) {
        iVar8 = iVar5 + 0x28;
      }
      (**(code **)(*unaff_EBP + 8))(iVar8,iVar6,iVar9);
      iVar8 = 0;
      if (0 < iVar9) {
        do {
          *(undefined1 *)(*(int *)(this_00 + 0x18) + 3 + iVar8 * 4) = *(undefined1 *)(iVar8 + iVar6)
          ;
          iVar8 = iVar8 + 1;
        } while (iVar8 < iVar9);
      }
      FUN_005e8100(this_00);
      FUN_00515cf0(iVar6);
    }
  }
  FUN_005a1850(this,this_00);
  if (this_00 != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release(this_00);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005e8450 : SUB ESP,0x8
005e8453 : PUSH EBX
005e8454 : PUSH EBP
005e8455 : PUSH ESI
005e8456 : MOV ESI,dword ptr [ESP + 0x18]
005e845a : PUSH EDI
005e845b : MOV EDI,dword ptr [ESI + 0x314]
005e8461 : TEST EDI,EDI
005e8463 : JNZ 0x005e8468
005e8465 : LEA EDI,[ESI + 0x28]
005e8468 : MOV EAX,dword ptr [EDI + 0x30]
005e846b : SUB EAX,dword ptr [EDI + 0x2c]
005e846e : MOV byte ptr [EDI + 0x15],0x0
005e8472 : CMP EAX,0x2
005e8475 : JGE 0x005e8480
005e8477 : PUSH 0x2
005e8479 : MOV ECX,EDI
005e847b : CALL 0x00539fb0
005e8480 : MOV EAX,dword ptr [EDI + 0x2c]
005e8483 : MOV ECX,dword ptr [EDI + 0x3c]
005e8486 : MOVZX DX,byte ptr [ECX + EAX*0x1 + 0x1]
005e848c : ADD ECX,EAX
005e848e : MOVZX CX,byte ptr [ECX]
005e8492 : ADD EAX,0x2
005e8495 : SHL DX,0x8
005e8499 : MOV dword ptr [EDI + 0x2c],EAX
005e849c : MOV EAX,dword ptr [ESI + 0x314]
005e84a2 : OR DX,CX
005e84a5 : MOVZX ECX,DX
005e84a8 : TEST EAX,EAX
005e84aa : JNZ 0x005e84af
005e84ac : LEA EAX,[ESI + 0x28]
005e84af : MOV EDX,dword ptr [EAX + 0x34]
005e84b2 : SUB EDX,dword ptr [EAX + 0x30]
005e84b5 : MOVZX ECX,CX
005e84b8 : ADD EDX,dword ptr [EAX + 0x2c]
005e84bb : LEA EBP,[ESI + 0x14]
005e84be : PUSH EDX
005e84bf : PUSH ECX
005e84c0 : PUSH 0xb94550
005e84c5 : PUSH EBP
005e84c6 : MOV dword ptr [ESP + 0x24],ECX
005e84ca : CALL 0x0051d420
005e84cf : ADD ESP,0x10
005e84d2 : MOV ECX,ESI
005e84d4 : CALL 0x005e63b0
005e84d9 : MOV ECX,dword ptr [ESI + 0x314]
005e84df : TEST ECX,ECX
005e84e1 : JNZ 0x005e84e6
005e84e3 : LEA ECX,[ESI + 0x28]
005e84e6 : MOV EDI,dword ptr [ECX + 0x34]
005e84e9 : SUB EDI,dword ptr [ECX + 0x30]
005e84ec : XOR EBX,EBX
005e84ee : ADD EDI,dword ptr [ECX + 0x2c]
005e84f1 : MOV ECX,dword ptr [ESI + 0x10]
005e84f4 : ADD EDI,EAX
005e84f6 : MOV EAX,dword ptr [ECX + 0x28]
005e84f9 : MOV dword ptr [ESP + 0x10],EAX
005e84fd : TEST EAX,EAX
005e84ff : JNZ 0x005e8514
005e8501 : PUSH 0xb94510
005e8506 : PUSH EBP
005e8507 : CALL 0x00555e50
005e850c : ADD ESP,0x8
005e850f : JMP 0x005e85f1
005e8514 : MOV EBP,dword ptr [ECX + 0x24]
005e8517 : TEST EBP,EBP
005e8519 : JNZ 0x005e8531
005e851b : LEA EAX,[ESI + 0x14]
005e851e : PUSH 0xb93ea8
005e8523 : PUSH EAX
005e8524 : CALL 0x00555e50
005e8529 : ADD ESP,0x8
005e852c : JMP 0x005e85f1
005e8531 : MOV EAX,dword ptr [ESI + 0x2b8]
005e8537 : PUSH EAX
005e8538 : CALL 0x005a02c0
005e853d : TEST EAX,EAX
005e853f : JZ 0x005e854d
005e8541 : MOV ECX,dword ptr [0x00d73250]
005e8547 : MOV dword ptr [ESP + 0x1c],ECX
005e854b : JMP 0x005e8559
005e854d : MOV ECX,dword ptr [ESI + 0x20]
005e8550 : CALL 0x00561610
005e8555 : MOV dword ptr [ESP + 0x1c],EAX
005e8559 : MOV EBX,dword ptr [ESI + 0x314]
005e855f : TEST EBX,EBX
005e8561 : JNZ 0x005e8566
005e8563 : LEA EBX,[ESI + 0x28]
005e8566 : MOV ECX,EBX
005e8568 : CALL 0x0053a0b0
005e856d : MOV EAX,dword ptr [ESP + 0x1c]
005e8571 : MOV byte ptr [EBX + 0x38],0x1
005e8575 : MOV EBX,dword ptr [EBX + 0x10]
005e8578 : MOV EDX,dword ptr [EBP]
005e857b : MOV EDX,dword ptr [EDX + 0x14]
005e857e : PUSH EAX
005e857f : PUSH EBX
005e8580 : MOV ECX,EBP
005e8582 : CALL EDX
005e8584 : MOV EBX,EAX
005e8586 : MOV EAX,dword ptr [ESI + 0x314]
005e858c : TEST EAX,EAX
005e858e : JNZ 0x005e8593
005e8590 : LEA EAX,[ESI + 0x28]
005e8593 : PUSH EDI
005e8594 : MOV ECX,EAX
005e8596 : CALL 0x0053a190
005e859b : MOV EDI,dword ptr [EBX + 0x10]
005e859e : IMUL EDI,dword ptr [EBX + 0xc]
005e85a2 : MOV ECX,dword ptr [0x00d73250]
005e85a8 : PUSH 0x0
005e85aa : PUSH EDI
005e85ab : CALL 0x00515840
005e85b0 : MOV EBP,EAX
005e85b2 : MOV EAX,dword ptr [ESI + 0x314]
005e85b8 : TEST EAX,EAX
005e85ba : JNZ 0x005e85bf
005e85bc : LEA EAX,[ESI + 0x28]
005e85bf : MOV ECX,dword ptr [ESP + 0x10]
005e85c3 : MOV EDX,dword ptr [ECX]
005e85c5 : PUSH EDI
005e85c6 : PUSH EBP
005e85c7 : PUSH EAX
005e85c8 : MOV EAX,dword ptr [EDX + 0x8]
005e85cb : CALL EAX
005e85cd : XOR EAX,EAX
005e85cf : TEST EDI,EDI
005e85d1 : JLE 0x005e85e2
005e85d3 : MOV DL,byte ptr [EAX + EBP*0x1]
005e85d6 : MOV ECX,dword ptr [EBX + 0x18]
005e85d9 : MOV byte ptr [ECX + EAX*0x4 + 0x3],DL
005e85dd : INC EAX
005e85de : CMP EAX,EDI
005e85e0 : JL 0x005e85d3
005e85e2 : PUSH EBX
005e85e3 : CALL 0x005e8100
005e85e8 : ADD ESP,0x4
005e85eb : PUSH EBP
005e85ec : CALL 0x00515cf0
005e85f1 : PUSH EBX
005e85f2 : PUSH ECX
005e85f3 : MOV ECX,dword ptr [ESP + 0x1c]
005e85f7 : MOV EAX,ESP
005e85f9 : MOV dword ptr [EAX],ECX
005e85fb : MOV ECX,ESI
005e85fd : CALL 0x005a1850
005e8602 : TEST EBX,EBX
005e8604 : JZ 0x005e860d
005e8606 : MOV ECX,EBX
005e8608 : CALL 0x004ff7c0
005e860d : POP EDI
005e860e : POP ESI
005e860f : POP EBP
005e8610 : POP EBX
005e8611 : ADD ESP,0x8
005e8614 : RET 0x8
