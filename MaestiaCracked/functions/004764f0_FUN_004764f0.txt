PROGRAM  : Maestia.exe
FUNCTION : FUN_004764f0
ENTRY    : 004764f0
BODY     : [[004764f0, 0047664c]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_004764f0(void)

{
  void *pvVar1;
  rsize_t _DstSize;
  uint uVar2;
  undefined4 *_Dst;
  int iVar3;
  int iVar4;
  uint uVar5;
  int unaff_ESI;
  undefined4 *puVar6;
  undefined4 *puVar7;
  uint local_8;
  
  uVar2 = *(uint *)(unaff_ESI + 0x14);
  local_8 = 1;
  if (uVar2 == 0xfffffff) {
    uVar2 = FUN_00476830();
  }
  uVar5 = uVar2 >> 1;
  if (uVar5 < 8) {
    uVar5 = 8;
  }
  else if (uVar5 < 2) goto LAB_00476534;
  if (uVar2 <= 0xfffffff - uVar5) {
    local_8 = uVar5;
  }
LAB_00476534:
  uVar2 = *(uint *)(unaff_ESI + 0x18) >> 2;
  _Dst = (undefined4 *)FUN_004c1790();
  iVar4 = uVar2 * 4;
  pvVar1 = (void *)(*(int *)(unaff_ESI + 0x10) + iVar4);
  iVar3 = (*(int *)(unaff_ESI + 0x14) * 4 - (int)pvVar1) + *(int *)(unaff_ESI + 0x10) >> 2;
  puVar7 = _Dst + uVar2 + iVar3;
  if (iVar3 != 0) {
    _memmove_s(_Dst + uVar2,iVar3 * 4,pvVar1,iVar3 * 4);
  }
  if (local_8 < uVar2) {
    iVar3 = (int)(local_8 * 4) >> 2;
    if (iVar3 != 0) {
      _DstSize = iVar3 * 4;
      _memmove_s(puVar7,_DstSize,*(void **)(unaff_ESI + 0x10),_DstSize);
    }
    pvVar1 = (void *)(local_8 * 4 + *(int *)(unaff_ESI + 0x10));
    iVar4 = (*(int *)(unaff_ESI + 0x10) - (int)pvVar1) + iVar4 >> 2;
    puVar7 = _Dst + iVar4;
    uVar2 = local_8;
    if (iVar4 != 0) {
      _memmove_s(_Dst,iVar4 * 4,pvVar1,iVar4 * 4);
    }
  }
  else {
    iVar4 = iVar4 >> 2;
    puVar6 = puVar7 + iVar4;
    if (iVar4 != 0) {
      _memmove_s(puVar7,iVar4 * 4,*(void **)(unaff_ESI + 0x10),iVar4 * 4);
    }
    iVar4 = local_8 - uVar2;
    puVar7 = _Dst;
    if (iVar4 != 0) {
      for (; iVar4 != 0; iVar4 = iVar4 + -1) {
        *puVar6 = 0;
        puVar6 = puVar6 + 1;
      }
    }
  }
  if (uVar2 != 0) {
    for (; uVar2 != 0; uVar2 = uVar2 - 1) {
      *puVar7 = 0;
      puVar7 = puVar7 + 1;
    }
  }
  if (*(int *)(unaff_ESI + 0x10) == 0) {
    *(int *)(unaff_ESI + 0x14) = *(int *)(unaff_ESI + 0x14) + local_8;
    *(undefined4 **)(unaff_ESI + 0x10) = _Dst;
    return;
  }
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
004764f0 : PUSH EBP
004764f1 : MOV EBP,ESP
004764f3 : SUB ESP,0x10
004764f6 : MOV EAX,dword ptr [ESI + 0x14]
004764f9 : MOV ECX,0xfffffff
004764fe : SUB ECX,EAX
00476500 : MOV dword ptr [EBP + -0x4],0x1
00476507 : CMP ECX,0x1
0047650a : JNC 0x00476511
0047650c : CALL 0x00476830
00476511 : MOV ECX,EAX
00476513 : SHR ECX,0x1
00476515 : CMP ECX,0x8
00476518 : JNC 0x00476521
0047651a : MOV ECX,0x8
0047651f : JMP 0x00476526
00476521 : CMP ECX,0x1
00476524 : JBE 0x00476534
00476526 : MOV EDX,0xfffffff
0047652b : SUB EDX,ECX
0047652d : CMP EAX,EDX
0047652f : JA 0x00476534
00476531 : MOV dword ptr [EBP + -0x4],ECX
00476534 : MOV ECX,dword ptr [EBP + -0x4]
00476537 : PUSH EBX
00476538 : MOV EBX,dword ptr [ESI + 0x18]
0047653b : PUSH EDI
0047653c : ADD ECX,EAX
0047653e : SHR EBX,0x2
00476541 : CALL 0x004c1790
00476546 : MOV ECX,dword ptr [ESI + 0x10]
00476549 : MOV dword ptr [EBP + -0x8],EAX
0047654c : LEA EDI,[EBX*0x4 + 0x0]
00476553 : LEA EDX,[EDI + EAX*0x1]
00476556 : LEA EAX,[ECX + EDI*0x1]
00476559 : MOV dword ptr [EBP + -0xc],EAX
0047655c : MOV EAX,dword ptr [ESI + 0x14]
0047655f : ADD EAX,EAX
00476561 : ADD EAX,EAX
00476563 : SUB EAX,dword ptr [EBP + -0xc]
00476566 : ADD EAX,ECX
00476568 : SAR EAX,0x2
0047656b : LEA ECX,[EAX*0x4 + 0x0]
00476572 : ADD EDX,ECX
00476574 : MOV dword ptr [EBP + -0x10],EDX
00476577 : TEST EAX,EAX
00476579 : JBE 0x00476592
0047657b : MOV EDX,dword ptr [EBP + -0xc]
0047657e : MOV EAX,dword ptr [EBP + -0x8]
00476581 : PUSH ECX
00476582 : PUSH EDX
00476583 : PUSH ECX
00476584 : ADD EAX,EDI
00476586 : PUSH EAX
00476587 : CALL 0x00634101
0047658c : MOV EDX,dword ptr [EBP + -0x10]
0047658f : ADD ESP,0x10
00476592 : MOV EAX,dword ptr [EBP + -0x4]
00476595 : MOV ECX,dword ptr [ESI + 0x10]
00476598 : CMP EBX,EAX
0047659a : JA 0x004765da
0047659c : MOV EAX,ECX
0047659e : SUB EAX,ECX
004765a0 : ADD EAX,EDI
004765a2 : SAR EAX,0x2
004765a5 : LEA EDI,[EAX*0x4 + 0x0]
004765ac : MOV dword ptr [EBP + -0x10],EDI
004765af : ADD EDI,EDX
004765b1 : TEST EAX,EAX
004765b3 : JBE 0x004765c4
004765b5 : MOV EAX,dword ptr [EBP + -0x10]
004765b8 : PUSH EAX
004765b9 : PUSH ECX
004765ba : PUSH EAX
004765bb : PUSH EDX
004765bc : CALL 0x00634101
004765c1 : ADD ESP,0x10
004765c4 : MOV ECX,dword ptr [EBP + -0x4]
004765c7 : SUB ECX,EBX
004765c9 : JZ 0x004765cf
004765cb : XOR EAX,EAX
004765cd : STOSD.REP ES:EDI
004765cf : TEST EBX,EBX
004765d1 : JBE 0x0047662f
004765d3 : MOV EDI,dword ptr [EBP + -0x8]
004765d6 : MOV ECX,EBX
004765d8 : JMP 0x0047662b
004765da : LEA EBX,[EAX*0x4 + 0x0]
004765e1 : MOV EAX,EBX
004765e3 : SAR EAX,0x2
004765e6 : TEST EAX,EAX
004765e8 : JBE 0x004765fa
004765ea : ADD EAX,EAX
004765ec : ADD EAX,EAX
004765ee : PUSH EAX
004765ef : PUSH ECX
004765f0 : PUSH EAX
004765f1 : PUSH EDX
004765f2 : CALL 0x00634101
004765f7 : ADD ESP,0x10
004765fa : MOV EAX,dword ptr [ESI + 0x10]
004765fd : LEA EDX,[EBX + EAX*0x1]
00476600 : MOV EBX,dword ptr [EBP + -0x8]
00476603 : SUB EAX,EDX
00476605 : ADD EAX,EDI
00476607 : SAR EAX,0x2
0047660a : LEA ECX,[EAX*0x4 + 0x0]
00476611 : LEA EDI,[ECX + EBX*0x1]
00476614 : TEST EAX,EAX
00476616 : JBE 0x00476624
00476618 : PUSH ECX
00476619 : PUSH EDX
0047661a : PUSH ECX
0047661b : PUSH EBX
0047661c : CALL 0x00634101
00476621 : ADD ESP,0x10
00476624 : MOV ECX,dword ptr [EBP + -0x4]
00476627 : TEST ECX,ECX
00476629 : JBE 0x0047662f
0047662b : XOR EAX,EAX
0047662d : STOSD.REP ES:EDI
0047662f : MOV ECX,dword ptr [ESI + 0x10]
00476632 : POP EDI
00476633 : POP EBX
00476634 : TEST ECX,ECX
00476636 : JZ 0x0047663d
00476638 : CALL 0x006f04e0
0047663d : MOV ECX,dword ptr [EBP + -0x8]
00476640 : MOV EDX,dword ptr [EBP + -0x4]
00476643 : ADD dword ptr [ESI + 0x14],EDX
00476646 : MOV dword ptr [ESI + 0x10],ECX
00476649 : MOV ESP,EBP
0047664b : POP EBP
0047664c : RET
