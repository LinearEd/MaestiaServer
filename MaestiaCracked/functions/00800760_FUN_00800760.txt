PROGRAM  : Maestia.exe
FUNCTION : FUN_00800760
ENTRY    : 00800760
BODY     : [[00800760, 00800ad4]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00800760(int param_1,ushort param_2)

{
  undefined8 uVar1;
  HWND hWnd;
  int iVar2;
  undefined4 uVar3;
  uint uVar4;
  HDC hdc;
  int iVar5;
  int iVar6;
  int iVar7;
  int *piVar8;
  int *piVar9;
  wchar_t *pwVar10;
  int local_74 [4];
  undefined4 local_64;
  undefined4 local_60;
  undefined4 local_5c;
  undefined4 local_54;
  int local_4c;
  undefined4 local_44;
  LPCRITICAL_SECTION local_3c;
  char *local_38;
  undefined4 local_34;
  int local_30;
  undefined4 local_2c;
  undefined8 local_28;
  undefined8 local_20;
  undefined4 local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  iVar2 = param_1;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b4f843;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_3c = (LPCRITICAL_SECTION)(DAT_017251ac + 0x424);
  local_30 = 0;
  local_38 = ".\\Render\\AvaRender.cpp";
  local_34 = 0x969;
  local_2c = 1;
  FUN_006ef1a0(&local_3c);
  local_8 = 0;
  if ((param_2 != 0x10) && (param_2 != 0x20)) {
    local_8 = 0xffffffff;
    if (local_30 != 0) {
      LeaveCriticalSection(local_3c);
    }
    ExceptionList = local_10;
    return 0;
  }
  local_18 = *(undefined4 *)(*(int *)(iVar2 + 0x174) + 8);
  hWnd = *(HWND *)(iVar2 + 0x170);
  piVar8 = (int *)(*(int *)(iVar2 + 0x178) + 0x48);
  piVar9 = local_74;
  for (iVar7 = 0xe; iVar7 != 0; iVar7 = iVar7 + -1) {
    *piVar9 = *piVar8;
    piVar8 = piVar8 + 1;
    piVar9 = piVar9 + 1;
  }
  hdc = GetDC(hWnd);
  GetDeviceCaps(hdc,0xc);
  if (*(char *)(iVar2 + 0x16c) == '\0') {
    local_28 = *(undefined8 *)(*(int *)(iVar2 + 0x174) + 0x458);
    uVar1 = *(undefined8 *)(*(int *)(iVar2 + 0x174) + 0x460);
    local_20._4_4_ = (int)((ulonglong)uVar1 >> 0x20);
    local_54 = 1;
    local_44 = 0;
    pwVar10 = L"[AvaRender::ChangeBPP] Window Mode";
    iVar7 = local_20._4_4_;
    local_20 = uVar1;
  }
  else {
    local_54 = 0;
    iVar7 = FUN_007874a0(uVar4);
    if (iVar7 != 0) {
      local_14 = (uint)*(ushort *)(iVar2 + 0x4aa);
      for (iVar5 = *(int *)(iVar7 + 0xc); iVar5 != *(int *)(iVar7 + 0x10); iVar5 = iVar5 + 0x18) {
        if ((local_14 == *(uint *)(iVar5 + 4)) &&
           ((uint)*(ushort *)(iVar2 + 0x4ac) == *(uint *)(iVar5 + 8))) {
          local_44 = *(undefined4 *)(iVar5 + 0xc);
          goto LAB_008008c1;
        }
      }
    }
    local_44 = 0x3c;
LAB_008008c1:
    pwVar10 = L"[AvaRender::ChangeBPP] Full Screen";
    iVar7 = 0x17 - (uint)(0x10 < param_2);
  }
  local_74[2] = iVar7;
  FUN_008018d0(pwVar10);
  uVar3 = local_18;
  *(int *)(*(int *)(iVar2 + 0x178) + 0xa8) = iVar7;
  if (param_2 < 0x11) {
    local_4c = 0x50;
  }
  else {
    iVar5 = (**(code **)(**(int **)(iVar2 + 0x14) + 0x28))
                      (*(int **)(iVar2 + 0x14),local_18,1,iVar7,2,1,0x4b);
    if (iVar5 < 0) {
      iVar5 = (**(code **)(**(int **)(iVar2 + 0x14) + 0x30))
                        (*(int **)(iVar2 + 0x14),uVar3,1,iVar7,iVar7,0x4d);
      if (iVar5 < 0) {
        iVar5 = (**(code **)(**(int **)(iVar2 + 0x14) + 0x28))
                          (*(int **)(iVar2 + 0x14),uVar3,1,iVar7,2,1,0x47);
        local_4c = ((iVar5 < 0) - 1 & 0xfffffff7) + 0x50;
      }
      else {
        local_4c = 0x4d;
      }
    }
    else {
      local_4c = 0x4b;
    }
  }
  param_1 = 0;
  uVar4 = 1;
  do {
    iVar6 = (**(code **)(**(int **)(iVar2 + 0x14) + 0x2c))
                      (*(int **)(iVar2 + 0x14),0,1,iVar7,0,uVar4,&param_1);
    iVar5 = DAT_017251ac;
    if (iVar6 < 0) {
      if (uVar4 < (uint)(*(int *)(DAT_017251ac + 0x330) - *(int *)(DAT_017251ac + 0x32c) >> 2)) {
        *(undefined4 *)(*(int *)(DAT_017251ac + 0x32c) + uVar4 * 4) = 0xffffffff;
      }
    }
    else if (uVar4 < (uint)(*(int *)(DAT_017251ac + 0x330) - *(int *)(DAT_017251ac + 0x32c) >> 2)) {
      *(int *)(*(int *)(DAT_017251ac + 0x32c) + uVar4 * 4) = param_1 + -1;
    }
    uVar4 = uVar4 + 1;
  } while ((int)uVar4 < 0x11);
  if (((*(int *)(iVar5 + 0x31c) < 2) ||
      ((uint)(*(int *)(iVar5 + 0x330) - *(int *)(iVar5 + 0x32c) >> 2) < 5)) ||
     (*(int *)(*(int *)(iVar5 + 0x32c) + 0x10) < 0)) {
    if (((*(int *)(iVar5 + 0x31c) == 1) &&
        (2 < (uint)(*(int *)(iVar5 + 0x330) - *(int *)(iVar5 + 0x32c) >> 2))) &&
       (-1 < *(int *)(*(int *)(iVar5 + 0x32c) + 8))) {
      local_64 = 2;
    }
    else {
      local_64 = 0;
    }
  }
  else {
    local_64 = 4;
  }
  local_60 = 0;
  local_5c = 1;
  *(undefined4 *)(iVar2 + 0x240) = local_64;
  *(undefined4 *)(iVar2 + 0x244) = 0;
  if (*(char *)(iVar2 + 0x324) != '\0') {
    uVar4 = *(uint *)(iVar2 + 0x248);
    local_64 = 0;
    local_60 = 0;
    if (uVar4 != 0) {
      *(uint *)(iVar2 + 0x244) = ~-(uint)(uVar4 != 0) & uVar4;
    }
  }
  local_60 = 0;
  piVar8 = local_74;
  piVar9 = (int *)(*(int *)(iVar2 + 0x178) + 0x48);
  for (iVar7 = 0xe; iVar7 != 0; iVar7 = iVar7 + -1) {
    *piVar9 = *piVar8;
    piVar8 = piVar8 + 1;
    piVar9 = piVar9 + 1;
  }
  FUN_00800250(iVar2);
  local_8 = 0xffffffff;
  if (local_30 != 0) {
    LeaveCriticalSection(local_3c);
  }
  ExceptionList = local_10;
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00800760 : PUSH EBP
00800761 : MOV EBP,ESP
00800763 : PUSH -0x1
00800765 : PUSH 0xb4f843
0080076a : MOV EAX,FS:[0x0]
00800770 : PUSH EAX
00800771 : SUB ESP,0x64
00800774 : PUSH EBX
00800775 : PUSH ESI
00800776 : PUSH EDI
00800777 : MOV EAX,[0x00d66fa0]
0080077c : XOR EAX,EBP
0080077e : PUSH EAX
0080077f : LEA EAX,[EBP + -0xc]
00800782 : MOV FS:[0x0],EAX
00800788 : MOV EBX,dword ptr [EBP + 0x8]
0080078b : MOV EAX,[0x017251ac]
00800790 : LEA ECX,[EBP + -0x38]
00800793 : ADD EAX,0x424
00800798 : XOR ESI,ESI
0080079a : PUSH ECX
0080079b : MOV dword ptr [EBP + -0x2c],ESI
0080079e : MOV dword ptr [EBP + -0x38],EAX
008007a1 : MOV dword ptr [EBP + -0x34],0xc28648
008007a8 : MOV dword ptr [EBP + -0x30],0x969
008007af : MOV dword ptr [EBP + -0x28],0x1
008007b6 : CALL 0x006ef1a0
008007bb : MOV dword ptr [EBP + -0x4],ESI
008007be : MOV AX,word ptr [EBP + 0xc]
008007c2 : CMP AX,0x10
008007c6 : JZ 0x008007fd
008007c8 : CMP AX,0x20
008007cc : JZ 0x008007fd
008007ce : MOV dword ptr [EBP + -0x4],0xffffffff
008007d5 : CMP dword ptr [EBP + -0x2c],ESI
008007d8 : JZ 0x008007e7
008007da : MOV EDX,dword ptr [EBP + -0x38]
008007dd : PUSH EDX
008007de : CALL dword ptr [0x00b8511c]
008007e4 : MOV dword ptr [EBP + -0x2c],ESI
008007e7 : XOR AL,AL
008007e9 : MOV ECX,dword ptr [EBP + -0xc]
008007ec : MOV dword ptr FS:[0x0],ECX
008007f3 : POP ECX
008007f4 : POP EDI
008007f5 : POP ESI
008007f6 : POP EBX
008007f7 : MOV ESP,EBP
008007f9 : POP EBP
008007fa : RET 0x8
008007fd : MOV EAX,dword ptr [EBX + 0x174]
00800803 : MOV ECX,dword ptr [EAX + 0x8]
00800806 : MOV EAX,dword ptr [EBX + 0x178]
0080080c : MOV EDX,dword ptr [EBX + 0x170]
00800812 : MOV dword ptr [EBP + -0x14],ECX
00800815 : LEA ESI,[EAX + 0x48]
00800818 : MOV ECX,0xe
0080081d : LEA EDI,[EBP + -0x70]
00800820 : PUSH EDX
00800821 : MOVSD.REP ES:EDI,ESI
00800823 : CALL dword ptr [0x00b85500]
00800829 : PUSH 0xc
0080082b : PUSH EAX
0080082c : CALL dword ptr [0x00b8507c]
00800832 : CMP byte ptr [EBX + 0x16c],0x0
00800839 : JNZ 0x00800873
0080083b : MOV EAX,dword ptr [EBX + 0x174]
00800841 : MOVQ XMM0,qword ptr [EAX + 0x458]
00800849 : MOVQ qword ptr [EBP + -0x24],XMM0
0080084e : MOVQ XMM0,qword ptr [EAX + 0x460]
00800856 : MOVQ qword ptr [EBP + -0x1c],XMM0
0080085b : MOV EDI,dword ptr [EBP + -0x18]
0080085e : MOV dword ptr [EBP + -0x50],0x1
00800865 : MOV dword ptr [EBP + -0x40],0x0
0080086c : PUSH 0xc28660
00800871 : JMP 0x008008d3
00800873 : MOV ESI,dword ptr [EBX + 0x174]
00800879 : MOV dword ptr [EBP + -0x50],0x0
00800880 : CALL 0x007874a0
00800885 : TEST EAX,EAX
00800887 : JZ 0x008008ba
00800889 : MOVZX ECX,word ptr [EBX + 0x4aa]
00800890 : MOVZX EDI,word ptr [EBX + 0x4ac]
00800897 : MOV dword ptr [EBP + -0x10],ECX
0080089a : MOV ECX,dword ptr [EAX + 0xc]
0080089d : MOV EAX,dword ptr [EAX + 0x10]
008008a0 : CMP ECX,EAX
008008a2 : JZ 0x008008ba
008008a4 : MOV EDX,dword ptr [ECX + 0x4]
008008a7 : MOV ESI,dword ptr [ECX + 0x8]
008008aa : CMP dword ptr [EBP + -0x10],EDX
008008ad : JNZ 0x008008b3
008008af : CMP EDI,ESI
008008b1 : JZ 0x00800932
008008b3 : ADD ECX,0x18
008008b6 : CMP ECX,EAX
008008b8 : JNZ 0x008008a4
008008ba : MOV dword ptr [EBP + -0x40],0x3c
008008c1 : MOV AX,0x10
008008c5 : CMP AX,word ptr [EBP + 0xc]
008008c9 : PUSH 0xc286a8
008008ce : SBB EDI,EDI
008008d0 : ADD EDI,0x17
008008d3 : MOV ESI,dword ptr [0x00da98e8]
008008d9 : MOV dword ptr [EBP + -0x68],EDI
008008dc : CALL 0x008018d0
008008e1 : MOV EAX,dword ptr [EBX + 0x178]
008008e7 : ADD ESP,0x4
008008ea : CMP word ptr [EBP + 0xc],0x10
008008ef : MOV dword ptr [EAX + 0xa8],EDI
008008f5 : JBE 0x0080096b
008008f7 : MOV EAX,dword ptr [EBX + 0x14]
008008fa : MOV ESI,dword ptr [EBP + -0x14]
008008fd : MOV ECX,dword ptr [EAX]
008008ff : MOV EDX,dword ptr [ECX + 0x28]
00800902 : PUSH 0x4b
00800904 : PUSH 0x1
00800906 : PUSH 0x2
00800908 : PUSH EDI
00800909 : PUSH 0x1
0080090b : PUSH ESI
0080090c : PUSH EAX
0080090d : CALL EDX
0080090f : TEST EAX,EAX
00800911 : JGE 0x00800962
00800913 : MOV EAX,dword ptr [EBX + 0x14]
00800916 : MOV ECX,dword ptr [EAX]
00800918 : MOV EDX,dword ptr [ECX + 0x30]
0080091b : PUSH 0x4d
0080091d : PUSH EDI
0080091e : PUSH EDI
0080091f : PUSH 0x1
00800921 : PUSH ESI
00800922 : PUSH EAX
00800923 : CALL EDX
00800925 : TEST EAX,EAX
00800927 : JL 0x0080093a
00800929 : MOV dword ptr [EBP + -0x48],0x4d
00800930 : JMP 0x00800972
00800932 : MOV EDX,dword ptr [ECX + 0xc]
00800935 : MOV dword ptr [EBP + -0x40],EDX
00800938 : JMP 0x008008c1
0080093a : MOV EAX,dword ptr [EBX + 0x14]
0080093d : MOV ECX,dword ptr [EAX]
0080093f : MOV EDX,dword ptr [ECX + 0x28]
00800942 : PUSH 0x47
00800944 : PUSH 0x1
00800946 : PUSH 0x2
00800948 : PUSH EDI
00800949 : PUSH 0x1
0080094b : PUSH ESI
0080094c : PUSH EAX
0080094d : CALL EDX
0080094f : XOR ECX,ECX
00800951 : TEST EAX,EAX
00800953 : SETL CL
00800956 : DEC ECX
00800957 : AND ECX,0xfffffff7
0080095a : ADD ECX,0x50
0080095d : MOV dword ptr [EBP + -0x48],ECX
00800960 : JMP 0x00800972
00800962 : MOV dword ptr [EBP + -0x48],0x4b
00800969 : JMP 0x00800972
0080096b : MOV dword ptr [EBP + -0x48],0x50
00800972 : MOV dword ptr [EBP + 0x8],0x0
00800979 : MOV ESI,0x1
0080097e : MOV EAX,dword ptr [EBX + 0x14]
00800981 : MOV EDX,dword ptr [EAX]
00800983 : MOV EDX,dword ptr [EDX + 0x2c]
00800986 : LEA ECX,[EBP + 0x8]
00800989 : PUSH ECX
0080098a : PUSH ESI
0080098b : PUSH 0x0
0080098d : PUSH EDI
0080098e : PUSH 0x1
00800990 : PUSH 0x0
00800992 : PUSH EAX
00800993 : CALL EDX
00800995 : TEST EAX,EAX
00800997 : MOV EAX,[0x017251ac]
0080099c : JL 0x008009c0
0080099e : MOV EDX,dword ptr [EAX + 0x330]
008009a4 : SUB EDX,dword ptr [EAX + 0x32c]
008009aa : MOV ECX,dword ptr [EBP + 0x8]
008009ad : SAR EDX,0x2
008009b0 : DEC ECX
008009b1 : CMP ESI,EDX
008009b3 : JNC 0x008009e0
008009b5 : MOV EDX,dword ptr [EAX + 0x32c]
008009bb : MOV dword ptr [EDX + ESI*0x4],ECX
008009be : JMP 0x008009e0
008009c0 : MOV ECX,dword ptr [EAX + 0x330]
008009c6 : SUB ECX,dword ptr [EAX + 0x32c]
008009cc : SAR ECX,0x2
008009cf : CMP ESI,ECX
008009d1 : JNC 0x008009e0
008009d3 : MOV EDX,dword ptr [EAX + 0x32c]
008009d9 : MOV dword ptr [EDX + ESI*0x4],0xffffffff
008009e0 : INC ESI
008009e1 : CMP ESI,0x10
008009e4 : JLE 0x0080097e
008009e6 : MOV ECX,dword ptr [EAX + 0x31c]
008009ec : CMP ECX,0x2
008009ef : JL 0x00800a17
008009f1 : MOV EDX,dword ptr [EAX + 0x330]
008009f7 : SUB EDX,dword ptr [EAX + 0x32c]
008009fd : SAR EDX,0x2
00800a00 : CMP EDX,0x4
00800a03 : JBE 0x00800a17
00800a05 : MOV ESI,dword ptr [EAX + 0x32c]
00800a0b : XOR EDX,EDX
00800a0d : CMP dword ptr [ESI + 0x10],EDX
00800a10 : JL 0x00800a19
00800a12 : LEA EAX,[EDX + 0x4]
00800a15 : JMP 0x00800a46
00800a17 : XOR EDX,EDX
00800a19 : CMP ECX,0x1
00800a1c : JNZ 0x00800a44
00800a1e : MOV ECX,dword ptr [EAX + 0x330]
00800a24 : SUB ECX,dword ptr [EAX + 0x32c]
00800a2a : SAR ECX,0x2
00800a2d : CMP ECX,0x2
00800a30 : JBE 0x00800a44
00800a32 : MOV EAX,dword ptr [EAX + 0x32c]
00800a38 : CMP dword ptr [EAX + 0x8],EDX
00800a3b : JL 0x00800a44
00800a3d : MOV EAX,0x2
00800a42 : JMP 0x00800a46
00800a44 : XOR EAX,EAX
00800a46 : CMP byte ptr [EBX + 0x324],0x0
00800a4d : MOV dword ptr [EBP + -0x60],EAX
00800a50 : MOV dword ptr [EBP + -0x5c],EDX
00800a53 : MOV dword ptr [EBP + -0x58],0x1
00800a5a : MOV dword ptr [EBX + 0x240],EAX
00800a60 : MOV dword ptr [EBX + 0x244],EDX
00800a66 : JZ 0x00800a88
00800a68 : MOV ECX,dword ptr [EBX + 0x248]
00800a6e : MOV dword ptr [EBP + -0x60],EDX
00800a71 : MOV dword ptr [EBP + -0x5c],EDX
00800a74 : CMP ECX,EDX
00800a76 : JBE 0x00800a88
00800a78 : XOR EDX,EDX
00800a7a : CMP EDX,ECX
00800a7c : SBB EAX,EAX
00800a7e : NOT EAX
00800a80 : AND EAX,ECX
00800a82 : MOV dword ptr [EBX + 0x244],EAX
00800a88 : MOV EAX,dword ptr [EBX + 0x178]
00800a8e : LEA EDI,[EAX + 0x48]
00800a91 : MOV ECX,0xe
00800a96 : LEA ESI,[EBP + -0x70]
00800a99 : PUSH EBX
00800a9a : MOVSD.REP ES:EDI,ESI
00800a9c : CALL 0x00800250
00800aa1 : MOV dword ptr [EBP + -0x4],0xffffffff
00800aa8 : CMP dword ptr [EBP + -0x2c],0x0
00800aac : JZ 0x00800abf
00800aae : MOV EAX,dword ptr [EBP + -0x38]
00800ab1 : PUSH EAX
00800ab2 : CALL dword ptr [0x00b8511c]
00800ab8 : MOV dword ptr [EBP + -0x2c],0x0
00800abf : MOV AL,0x1
00800ac1 : MOV ECX,dword ptr [EBP + -0xc]
00800ac4 : MOV dword ptr FS:[0x0],ECX
00800acb : POP ECX
00800acc : POP EDI
00800acd : POP ESI
00800ace : POP EBX
00800acf : MOV ESP,EBP
00800ad1 : POP EBP
00800ad2 : RET 0x8
