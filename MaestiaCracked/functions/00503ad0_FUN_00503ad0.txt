PROGRAM  : Maestia.exe
FUNCTION : FUN_00503ad0
ENTRY    : 00503ad0
BODY     : [[00503ad0, 00503afc] [00503b00, 00503daf]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00503ad0(uint *param_1)

{
  undefined4 *puVar1;
  int *piVar2;
  int iVar3;
  undefined4 uVar4;
  uint *in_ECX;
  uint uVar5;
  uint uVar6;
  int iVar7;
  uint uVar8;
  int *piVar9;
  uint local_10;
  uint local_c;
  uint local_8;
  uint local_4;
  
  if ((in_ECX[6] & 1) == 0) {
    uVar5 = *in_ECX;
    if (uVar5 != 0) {
      local_4 = 0;
      local_c = 0;
      do {
        uVar6 = 0;
        local_4 = local_4 + uVar5;
        local_10 = 0;
        local_8 = uVar5;
        if (uVar5 != 0) {
          do {
            iVar7 = (uVar6 >> 10) * 4;
            iVar3 = (uVar6 & 0x3ff) * 4;
            puVar1 = *(undefined4 **)(*(int *)(iVar7 + in_ECX[3]) + iVar3);
            if (((uint)puVar1 & 1) == 0) {
              uVar5 = puVar1[2];
              if ((uVar5 & 0x70000000) == 0x30000000) {
                puVar1[2] = uVar5 & 0x9fffffff | 0x10000000;
                (**(code **)*puVar1)(1);
              }
              else {
                puVar1[2] = uVar5 & 0x7fffffff;
                puVar1[3] = 0xffffffff;
              }
              uVar8 = local_10 >> 10;
              uVar5 = local_10 & 0x3ff;
              local_10 = local_10 + 1;
              *(undefined4 *)(*(int *)(in_ECX[3] + uVar8 * 4) + uVar5 * 4) =
                   *(undefined4 *)(*(int *)(in_ECX[3] + iVar7) + iVar3);
              uVar5 = local_8;
            }
            uVar6 = uVar6 + 1;
          } while (uVar6 < uVar5);
        }
        if (*in_ECX < local_10) {
          for (uVar5 = in_ECX[1]; uVar5 < local_10 + 0x3ff >> 10; uVar5 = uVar5 + 1) {
            if (in_ECX[2] <= uVar5) {
              if (in_ECX[3] == 0) {
                local_8 = 2;
                uVar6 = FUN_00515d60(in_ECX,0x14,&local_8);
              }
              else {
                uVar6 = FUN_00515c80(in_ECX[3],in_ECX[2] * 4 + 0x14);
              }
              in_ECX[2] = in_ECX[2] + 5;
              in_ECX[3] = uVar6;
            }
            local_8 = 2;
            uVar4 = FUN_00515d60(in_ECX,0x1000,&local_8);
            *(undefined4 *)(in_ECX[3] + uVar5 * 4) = uVar4;
            in_ECX[1] = in_ECX[1] + 1;
          }
LAB_00503c1f:
          *in_ECX = local_10;
        }
        else if (local_10 < *in_ECX) goto LAB_00503c1f;
        uVar5 = 0;
        if (local_10 != 0) {
          do {
            puVar1 = *(undefined4 **)(*(int *)(in_ECX[3] + (uVar5 >> 10) * 4) + (uVar5 & 0x3ff) * 4)
            ;
            if ((puVar1 != (undefined4 *)0x0) &&
               (uVar6 = puVar1[2], (uVar6 & 0x70000000) == 0x10000000)) {
              if ((uVar6 & 0xfffffff) == 0) {
                uVar6 = uVar6 & 0xafffffff | 0x20000000;
                uVar4 = 4;
              }
              else {
                uVar6 = uVar6 & 0x8fffffff;
                uVar4 = 2;
              }
              puVar1[2] = uVar6;
              (**(code **)*puVar1)(uVar4);
            }
            uVar5 = uVar5 + 1;
          } while (uVar5 < local_10);
        }
        uVar5 = 0;
        if (local_10 != 0) {
          do {
            puVar1 = *(undefined4 **)(*(int *)(in_ECX[3] + (uVar5 >> 10) * 4) + (uVar5 & 0x3ff) * 4)
            ;
            if (puVar1 != (undefined4 *)0x0) {
              puVar1[2] = puVar1[2] & 0x7fffffff;
              uVar6 = puVar1[2];
              puVar1[3] = 0xffffffff;
              if (((uVar6 & 0x70000000) == 0x20000000) && (-1 < (int)uVar6)) {
                puVar1[2] = uVar6 & 0x8fffffff;
                (**(code **)*puVar1)(3);
                iVar7 = puVar1[1];
                if ((puVar1[2] & 0x70000000) != 0x40000000) {
                  puVar1[1] = *(undefined4 *)(iVar7 + 0x14);
                  *(undefined4 **)(iVar7 + 0x14) = puVar1;
                  puVar1[2] = puVar1[2] & 0xcfffffff | 0x40000000;
                }
              }
            }
            uVar5 = uVar5 + 1;
          } while (uVar5 < local_10);
        }
        if (*in_ECX != 0) {
          *in_ECX = 0;
        }
        iVar7 = 0;
        in_ECX[4] = 0xffffffff;
        if ((int *)in_ECX[5] != (int *)0x0) {
          iVar7 = 0;
          piVar9 = (int *)in_ECX[5];
          do {
            piVar2 = (int *)piVar9[1];
            (**(code **)(*piVar9 + 4))();
            FUN_00515cf0(piVar9);
            iVar7 = iVar7 + 1;
            piVar9 = piVar2;
          } while (piVar2 != (int *)0x0);
        }
        local_c = local_c + iVar7;
        uVar5 = *in_ECX;
        in_ECX[5] = 0;
        if (uVar5 == 0) {
          if (param_1 != (uint *)0x0) {
            *param_1 = local_4;
            if (local_c <= local_4) {
              local_4 = local_c;
            }
            param_1[1] = local_4;
          }
          return 1;
        }
      } while( true );
    }
  }
  if (param_1 != (uint *)0x0) {
    *param_1 = 0;
    param_1[1] = 0;
  }
  return 0;
}



============================================================
DISASSEMBLY
============================================================
00503ad0 : SUB ESP,0x10
00503ad3 : PUSH EBX
00503ad4 : PUSH EDI
00503ad5 : MOV EDI,ECX
00503ad7 : TEST byte ptr [EDI + 0x18],0x1
00503adb : JNZ 0x00503d97
00503ae1 : MOV EAX,dword ptr [EDI]
00503ae3 : XOR EBX,EBX
00503ae5 : MOV dword ptr [ESP + 0x10],EAX
00503ae9 : CMP EAX,EBX
00503aeb : JZ 0x00503d97
00503af1 : PUSH EBP
00503af2 : PUSH ESI
00503af3 : MOV dword ptr [ESP + 0x1c],EBX
00503af7 : MOV dword ptr [ESP + 0x14],EBX
00503afb : JMP 0x00503b00
00503b00 : ADD dword ptr [ESP + 0x1c],EAX
00503b04 : XOR ECX,ECX
00503b06 : MOV dword ptr [ESP + 0x10],ECX
00503b0a : CMP EAX,EBX
00503b0c : JBE 0x00503ba1
00503b12 : MOV ECX,dword ptr [EDI + 0xc]
00503b15 : MOV ESI,EBX
00503b17 : SHR ESI,0xa
00503b1a : MOV EBP,EBX
00503b1c : AND EBP,0x3ff
00503b22 : ADD ESI,ESI
00503b24 : ADD ESI,ESI
00503b26 : MOV EDX,dword ptr [ESI + ECX*0x1]
00503b29 : ADD EBP,EBP
00503b2b : ADD EBP,EBP
00503b2d : MOV ECX,dword ptr [EDX + EBP*0x1]
00503b30 : TEST CL,0x1
00503b33 : JNZ 0x00503b94
00503b35 : MOV EAX,dword ptr [ECX + 0x8]
00503b38 : MOV EDX,EAX
00503b3a : AND EDX,0x70000000
00503b40 : CMP EDX,0x30000000
00503b46 : JNZ 0x00503b5f
00503b48 : AND EAX,0x9fffffff
00503b4d : OR EAX,0x10000000
00503b52 : MOV dword ptr [ECX + 0x8],EAX
00503b55 : MOV EAX,dword ptr [ECX]
00503b57 : MOV EDX,dword ptr [EAX]
00503b59 : PUSH 0x1
00503b5b : CALL EDX
00503b5d : JMP 0x00503b6e
00503b5f : AND EAX,0x7fffffff
00503b64 : MOV dword ptr [ECX + 0x8],EAX
00503b67 : MOV dword ptr [ECX + 0xc],0xffffffff
00503b6e : MOV EAX,dword ptr [EDI + 0xc]
00503b71 : MOV EDX,dword ptr [EAX + ESI*0x1]
00503b74 : MOV ECX,dword ptr [ESP + 0x10]
00503b78 : MOV EDX,dword ptr [EDX + EBP*0x1]
00503b7b : MOV ESI,ECX
00503b7d : SHR ESI,0xa
00503b80 : MOV EAX,dword ptr [EAX + ESI*0x4]
00503b83 : AND ECX,0x3ff
00503b89 : INC dword ptr [ESP + 0x10]
00503b8d : MOV dword ptr [EAX + ECX*0x4],EDX
00503b90 : MOV EAX,dword ptr [ESP + 0x18]
00503b94 : INC EBX
00503b95 : CMP EBX,EAX
00503b97 : JC 0x00503b12
00503b9d : MOV ECX,dword ptr [ESP + 0x10]
00503ba1 : MOV EAX,dword ptr [EDI]
00503ba3 : CMP ECX,EAX
00503ba5 : JBE 0x00503c1d
00503ba7 : MOV ESI,dword ptr [EDI + 0x4]
00503baa : LEA EBX,[ECX + 0x3ff]
00503bb0 : SHR EBX,0xa
00503bb3 : CMP ESI,EBX
00503bb5 : JNC 0x00503c17
00503bb7 : MOV ECX,dword ptr [EDI + 0x8]
00503bba : CMP ESI,ECX
00503bbc : JC 0x00503bf1
00503bbe : MOV EAX,dword ptr [EDI + 0xc]
00503bc1 : TEST EAX,EAX
00503bc3 : JZ 0x00503bd5
00503bc5 : LEA ECX,[ECX*0x4 + 0x14]
00503bcc : PUSH ECX
00503bcd : PUSH EAX
00503bce : CALL 0x00515c80
00503bd3 : JMP 0x00503bea
00503bd5 : LEA EAX,[ESP + 0x18]
00503bd9 : PUSH EAX
00503bda : PUSH 0x14
00503bdc : PUSH EDI
00503bdd : MOV dword ptr [ESP + 0x24],0x2
00503be5 : CALL 0x00515d60
00503bea : ADD dword ptr [EDI + 0x8],0x5
00503bee : MOV dword ptr [EDI + 0xc],EAX
00503bf1 : LEA ECX,[ESP + 0x18]
00503bf5 : PUSH ECX
00503bf6 : PUSH 0x1000
00503bfb : PUSH EDI
00503bfc : MOV dword ptr [ESP + 0x24],0x2
00503c04 : CALL 0x00515d60
00503c09 : MOV EDX,dword ptr [EDI + 0xc]
00503c0c : MOV dword ptr [EDX + ESI*0x4],EAX
00503c0f : INC dword ptr [EDI + 0x4]
00503c12 : INC ESI
00503c13 : CMP ESI,EBX
00503c15 : JC 0x00503bb7
00503c17 : MOV ECX,dword ptr [ESP + 0x10]
00503c1b : JMP 0x00503c1f
00503c1d : JNC 0x00503c21
00503c1f : MOV dword ptr [EDI],ECX
00503c21 : XOR ESI,ESI
00503c23 : TEST ECX,ECX
00503c25 : JBE 0x00503c82
00503c27 : MOV ECX,dword ptr [EDI + 0xc]
00503c2a : MOV EAX,ESI
00503c2c : SHR EAX,0xa
00503c2f : MOV EAX,dword ptr [ECX + EAX*0x4]
00503c32 : MOV EDX,ESI
00503c34 : AND EDX,0x3ff
00503c3a : MOV ECX,dword ptr [EAX + EDX*0x4]
00503c3d : TEST ECX,ECX
00503c3f : JZ 0x00503c79
00503c41 : MOV EAX,dword ptr [ECX + 0x8]
00503c44 : MOV EDX,EAX
00503c46 : AND EDX,0x70000000
00503c4c : CMP EDX,0x10000000
00503c52 : JNZ 0x00503c79
00503c54 : TEST EAX,0xfffffff
00503c59 : JBE 0x00503c64
00503c5b : AND EAX,0x8fffffff
00503c60 : PUSH 0x2
00503c62 : JMP 0x00503c70
00503c64 : AND EAX,0xafffffff
00503c69 : OR EAX,0x20000000
00503c6e : PUSH 0x4
00503c70 : MOV dword ptr [ECX + 0x8],EAX
00503c73 : MOV EAX,dword ptr [ECX]
00503c75 : MOV EDX,dword ptr [EAX]
00503c77 : CALL EDX
00503c79 : MOV ECX,dword ptr [ESP + 0x10]
00503c7d : INC ESI
00503c7e : CMP ESI,ECX
00503c80 : JC 0x00503c27
00503c82 : XOR EBX,EBX
00503c84 : TEST ECX,ECX
00503c86 : JBE 0x00503d1f
00503c8c : LEA ESP,[ESP]
00503c90 : MOV ECX,dword ptr [EDI + 0xc]
00503c93 : MOV EAX,EBX
00503c95 : SHR EAX,0xa
00503c98 : MOV EAX,dword ptr [ECX + EAX*0x4]
00503c9b : MOV EDX,EBX
00503c9d : AND EDX,0x3ff
00503ca3 : MOV ESI,dword ptr [EAX + EDX*0x4]
00503ca6 : TEST ESI,ESI
00503ca8 : JZ 0x00503d14
00503caa : AND dword ptr [ESI + 0x8],0x7fffffff
00503cb1 : MOV EAX,dword ptr [ESI + 0x8]
00503cb4 : MOV ECX,EAX
00503cb6 : AND ECX,0x70000000
00503cbc : MOV dword ptr [ESI + 0xc],0xffffffff
00503cc3 : CMP ECX,0x20000000
00503cc9 : JNZ 0x00503d14
00503ccb : MOV EDX,EAX
00503ccd : SHR EDX,0x1f
00503cd0 : TEST DL,0x1
00503cd3 : JNZ 0x00503d14
00503cd5 : AND EAX,0x8fffffff
00503cda : MOV dword ptr [ESI + 0x8],EAX
00503cdd : MOV EAX,dword ptr [ESI]
00503cdf : MOV EDX,dword ptr [EAX]
00503ce1 : PUSH 0x3
00503ce3 : MOV ECX,ESI
00503ce5 : CALL EDX
00503ce7 : MOV ECX,dword ptr [ESI + 0x8]
00503cea : MOV EAX,dword ptr [ESI + 0x4]
00503ced : AND ECX,0x70000000
00503cf3 : CMP ECX,0x40000000
00503cf9 : JZ 0x00503d14
00503cfb : MOV EDX,dword ptr [EAX + 0x14]
00503cfe : MOV dword ptr [ESI + 0x4],EDX
00503d01 : MOV dword ptr [EAX + 0x14],ESI
00503d04 : MOV EAX,dword ptr [ESI + 0x8]
00503d07 : AND EAX,0xcfffffff
00503d0c : OR EAX,0x40000000
00503d11 : MOV dword ptr [ESI + 0x8],EAX
00503d14 : INC EBX
00503d15 : CMP EBX,dword ptr [ESP + 0x10]
00503d19 : JC 0x00503c90
00503d1f : CMP dword ptr [EDI],0x0
00503d22 : JBE 0x00503d2a
00503d24 : MOV dword ptr [EDI],0x0
00503d2a : MOV ESI,dword ptr [EDI + 0x14]
00503d2d : XOR EBX,EBX
00503d2f : MOV dword ptr [EDI + 0x10],0xffffffff
00503d36 : TEST ESI,ESI
00503d38 : JZ 0x00503d59
00503d3a : LEA EBX,[EBX]
00503d40 : MOV EDX,dword ptr [ESI]
00503d42 : MOV EAX,dword ptr [EDX + 0x4]
00503d45 : MOV EBP,dword ptr [ESI + 0x4]
00503d48 : MOV ECX,ESI
00503d4a : CALL EAX
00503d4c : PUSH ESI
00503d4d : CALL 0x00515cf0
00503d52 : INC EBX
00503d53 : MOV ESI,EBP
00503d55 : TEST EBP,EBP
00503d57 : JNZ 0x00503d40
00503d59 : ADD dword ptr [ESP + 0x14],EBX
00503d5d : MOV EAX,dword ptr [EDI]
00503d5f : XOR EBX,EBX
00503d61 : MOV dword ptr [EDI + 0x14],EBX
00503d64 : MOV dword ptr [ESP + 0x18],EAX
00503d68 : CMP EAX,EBX
00503d6a : JA 0x00503b00
00503d70 : MOV ECX,dword ptr [ESP + 0x24]
00503d74 : POP ESI
00503d75 : POP EBP
00503d76 : CMP ECX,EBX
00503d78 : JZ 0x00503d8d
00503d7a : MOV EAX,dword ptr [ESP + 0x14]
00503d7e : MOV dword ptr [ECX],EAX
00503d80 : CMP EAX,dword ptr [ESP + 0xc]
00503d84 : JC 0x00503d8a
00503d86 : MOV EAX,dword ptr [ESP + 0xc]
00503d8a : MOV dword ptr [ECX + 0x4],EAX
00503d8d : POP EDI
00503d8e : MOV AL,0x1
00503d90 : POP EBX
00503d91 : ADD ESP,0x10
00503d94 : RET 0x4
00503d97 : MOV ECX,dword ptr [ESP + 0x1c]
00503d9b : TEST ECX,ECX
00503d9d : JZ 0x00503da6
00503d9f : XOR EAX,EAX
00503da1 : MOV dword ptr [ECX],EAX
00503da3 : MOV dword ptr [ECX + 0x4],EAX
00503da6 : POP EDI
00503da7 : XOR AL,AL
00503da9 : POP EBX
00503daa : ADD ESP,0x10
00503dad : RET 0x4
