PROGRAM  : Maestia.exe
FUNCTION : FUN_00566210
ENTRY    : 00566210
BODY     : [[00566210, 00566238] [00566240, 005663fe] [00566400, 0056655f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00566210(int *param_1,GRefCountImpl *param_2,int param_3,char param_4)

{
  undefined4 *puVar1;
  int iVar2;
  int *piVar3;
  int *piVar4;
  bool bVar5;
  int iVar6;
  char cVar7;
  int iVar8;
  int iVar9;
  undefined4 uVar10;
  undefined4 uVar11;
  LONG LVar12;
  int in_ECX;
  uint uVar13;
  uint *puVar14;
  char local_19;
  uint local_14;
  int iStack_10;
  int iStack_c;
  int local_8;
  undefined4 local_4;
  
  piVar3 = param_1;
  uVar13 = 0;
  local_19 = '\0';
  if (param_1[1] != 0) {
    param_1 = (int *)0x0;
    do {
      puVar14 = (uint *)(*piVar3 + (int)param_1);
      local_8 = 0;
      local_4 = 0;
      cVar7 = FUN_005649d0(&local_8,puVar14);
      if (cVar7 == '\0') {
        if (*(int *)(param_3 + 0xc) != 0) {
          FUN_00500460(*(int *)(param_3 + 0xc) + 0xc,
                       "Import error: GFxResource \'%s\' is not exported from movie \'%s\'\n",
                       (*puVar14 & 0xfffffffc) + 8,(piVar3[3] & 0xfffffffcU) + 8);
        }
      }
      else {
        local_19 = FUN_00565eb0(puVar14[1],&local_8,(*puVar14 & 0xfffffffc) + 8);
      }
      if (local_8 != 0) {
        FUN_00524240();
      }
      param_1 = (int *)((int)param_1 + 0xc);
      uVar13 = uVar13 + 1;
    } while (uVar13 < (uint)piVar3[1]);
    if (local_19 != '\0') {
      if (param_4 != '\0') {
        return;
      }
      EnterCriticalSection((LPCRITICAL_SECTION)(in_ECX + 0x50));
      if (param_2 != (GRefCountImpl *)0x0) {
        GRefCountImpl::AddRef(param_2);
      }
      FUN_00562810((int *)(in_ECX + 0x44),*(int *)(in_ECX + 0x48) + 1);
      puVar1 = (undefined4 *)(*(int *)(in_ECX + 0x44) + -4 + *(int *)(in_ECX + 0x48) * 4);
      if (puVar1 != (undefined4 *)0x0) {
        if (param_2 != (GRefCountImpl *)0x0) {
          GRefCountImpl::AddRef(param_2);
        }
        *puVar1 = param_2;
      }
      if (param_2 != (GRefCountImpl *)0x0) {
        FUN_00524240();
      }
      LeaveCriticalSection((LPCRITICAL_SECTION)(in_ECX + 0x50));
      goto LAB_0056634d;
    }
  }
  if (param_4 != '\0') {
    return;
  }
LAB_0056634d:
  bVar5 = false;
  FUN_0051c8c0(&local_14);
  iVar8 = FUN_00634e90((local_14 & 0xfffffffc) + 8,"_glyphs");
  if (iVar8 != 0) {
    bVar5 = true;
    if (param_2 != (GRefCountImpl *)0x0) {
      GRefCountImpl::AddRef(param_2);
    }
    FUN_005627b0((int *)(param_3 + 0x48),*(int *)(param_3 + 0x4c) + 1);
    puVar1 = (undefined4 *)(*(int *)(param_3 + 0x48) + -4 + *(int *)(param_3 + 0x4c) * 4);
    if (puVar1 != (undefined4 *)0x0) {
      if (param_2 != (GRefCountImpl *)0x0) {
        GRefCountImpl::AddRef(param_2);
      }
      *puVar1 = param_2;
    }
    if (param_2 != (GRefCountImpl *)0x0) {
      FUN_00524240();
    }
  }
  iVar8 = *(int *)(*(int *)(*(int *)(in_ECX + 0xc) + 0x20) + 0x98);
  iVar2 = *(int *)(*(int *)(*(int *)(*(int *)(param_2 + 0x1c) + 0xc) + 0x20) + 0x98);
  do {
    if (iVar8 == 0) {
      LVar12 = InterlockedExchangeAdd((LONG *)((local_14 & 0xfffffffc) + 4),-1);
      if (LVar12 == 1) {
        FUN_00515cf0(local_14 & 0xfffffffc);
      }
      return;
    }
    piVar3 = *(int **)(iVar8 + 4);
    iVar9 = (**(code **)(*piVar3 + 0x38))();
    iVar6 = iVar2;
    if ((iVar9 == 0) || (bVar5)) {
      for (; iVar6 != 0; iVar6 = *(int *)(iVar6 + 0xc)) {
        piVar4 = *(int **)(iVar6 + 4);
        iVar9 = (**(code **)(*piVar4 + 0x38))();
        if ((iVar9 != 0) &&
           (uVar13 = piVar4[5], uVar10 = (**(code **)(*piVar4 + 0x3c))(),
           ((-(uint)((uVar13 & 0x300) != 0) & 0x300 | 3) & piVar3[5]) == (uVar13 & 0x303))) {
          uVar11 = (**(code **)(*piVar3 + 0x3c))(uVar10);
          iVar9 = FUN_0051b280(uVar11,uVar10);
          if (iVar9 == 0) {
            iVar9 = *(int *)(param_2 + 0x1c);
            uVar13 = *(uint *)(iVar6 + 8);
            iStack_10 = 0;
            iStack_c = 0;
            if ((*(char *)(iVar9 + 0x3c) == '\0') || (*(uint *)(iVar9 + 0x1c) <= uVar13)) {
              FUN_00569f80(&iStack_10,uVar13);
            }
            else {
              piVar3 = (int *)(*(int *)(iVar9 + 0x20) + uVar13 * 8);
              if (((GRefCountImpl *)*piVar3 != (GRefCountImpl *)0x0) &&
                 (GRefCountImpl::AddRef((GRefCountImpl *)*piVar3), iStack_10 != 0)) {
                FUN_00524240();
              }
              iStack_10 = *piVar3;
              iStack_c = piVar3[1];
            }
            if ((iStack_10 != 0) &&
               (FUN_0056a050(*(undefined4 *)(iVar8 + 8),&iStack_10), iStack_10 != 0)) {
              FUN_00524240();
            }
            break;
          }
        }
      }
    }
    iVar8 = *(int *)(iVar8 + 0xc);
  } while( true );
}



============================================================
DISASSEMBLY
============================================================
00566210 : SUB ESP,0x1c
00566213 : PUSH EBX
00566214 : PUSH EBP
00566215 : PUSH ESI
00566216 : PUSH EDI
00566217 : MOV EDI,dword ptr [ESP + 0x30]
0056621b : MOV EAX,dword ptr [EDI + 0x4]
0056621e : MOV dword ptr [ESP + 0x14],ECX
00566222 : XOR ECX,ECX
00566224 : XOR EBX,EBX
00566226 : MOV byte ptr [ESP + 0x13],0x0
0056622b : CMP EAX,ECX
0056622d : JBE 0x0056633e
00566233 : MOV dword ptr [ESP + 0x30],ECX
00566237 : JMP 0x00566242
00566240 : XOR ECX,ECX
00566242 : MOV ESI,dword ptr [EDI]
00566244 : ADD ESI,dword ptr [ESP + 0x30]
00566248 : MOV EBP,dword ptr [ESP + 0x34]
0056624c : PUSH ESI
0056624d : LEA EAX,[ESP + 0x28]
00566251 : MOV dword ptr [ESP + 0x28],ECX
00566255 : MOV dword ptr [ESP + 0x2c],ECX
00566259 : PUSH EAX
0056625a : MOV ECX,EBP
0056625c : CALL 0x005649d0
00566261 : TEST AL,AL
00566263 : JNZ 0x00566296
00566265 : MOV ECX,dword ptr [ESP + 0x38]
00566269 : MOV EAX,dword ptr [ECX + 0xc]
0056626c : TEST EAX,EAX
0056626e : JZ 0x005662b9
00566270 : MOV EDX,dword ptr [EDI + 0xc]
00566273 : MOV ECX,dword ptr [ESI]
00566275 : AND EDX,0xfffffffc
00566278 : ADD EDX,0x8
0056627b : PUSH EDX
0056627c : AND ECX,0xfffffffc
0056627f : ADD ECX,0x8
00566282 : PUSH ECX
00566283 : ADD EAX,0xc
00566286 : PUSH 0xb8cc10
0056628b : PUSH EAX
0056628c : CALL 0x00500460
00566291 : ADD ESP,0x10
00566294 : JMP 0x005662b9
00566296 : MOV EAX,dword ptr [ESI]
00566298 : AND EAX,0xfffffffc
0056629b : ADD EAX,0x8
0056629e : PUSH EAX
0056629f : LEA EDX,[ESP + 0x28]
005662a3 : PUSH EDX
005662a4 : PUSH ECX
005662a5 : MOV ECX,dword ptr [ESI + 0x4]
005662a8 : MOV EAX,ESP
005662aa : MOV dword ptr [EAX],ECX
005662ac : MOV ECX,dword ptr [ESP + 0x20]
005662b0 : CALL 0x00565eb0
005662b5 : MOV byte ptr [ESP + 0x13],AL
005662b9 : MOV ECX,dword ptr [ESP + 0x24]
005662bd : TEST ECX,ECX
005662bf : JZ 0x005662c6
005662c1 : CALL 0x00524240
005662c6 : ADD dword ptr [ESP + 0x30],0xc
005662cb : INC EBX
005662cc : CMP EBX,dword ptr [EDI + 0x4]
005662cf : JC 0x00566240
005662d5 : CMP byte ptr [ESP + 0x13],0x0
005662da : JZ 0x00566342
005662dc : CMP byte ptr [ESP + 0x3c],0x0
005662e1 : JNZ 0x00566556
005662e7 : MOV ESI,dword ptr [ESP + 0x14]
005662eb : LEA EBX,[ESI + 0x50]
005662ee : PUSH EBX
005662ef : CALL dword ptr [0x00b85118]
005662f5 : TEST EBP,EBP
005662f7 : JZ 0x00566300
005662f9 : MOV ECX,EBP
005662fb : CALL 0x00523dd0
00566300 : MOV EDX,dword ptr [ESI + 0x48]
00566303 : ADD ESI,0x44
00566306 : INC EDX
00566307 : PUSH EDX
00566308 : PUSH ESI
00566309 : MOV ECX,ESI
0056630b : CALL 0x00562810
00566310 : MOV EAX,dword ptr [ESI + 0x4]
00566313 : MOV ECX,dword ptr [ESI]
00566315 : LEA ESI,[ECX + EAX*0x4 + -0x4]
00566319 : TEST ESI,ESI
0056631b : JZ 0x0056632a
0056631d : TEST EBP,EBP
0056631f : JZ 0x00566328
00566321 : MOV ECX,EBP
00566323 : CALL 0x00523dd0
00566328 : MOV dword ptr [ESI],EBP
0056632a : TEST EBP,EBP
0056632c : JZ 0x00566335
0056632e : MOV ECX,EBP
00566330 : CALL 0x00524240
00566335 : PUSH EBX
00566336 : CALL dword ptr [0x00b8511c]
0056633c : JMP 0x0056634d
0056633e : MOV EBP,dword ptr [ESP + 0x34]
00566342 : CMP byte ptr [ESP + 0x3c],0x0
00566347 : JNZ 0x00566556
0056634d : LEA EDX,[ESP + 0x18]
00566351 : PUSH EDX
00566352 : LEA ECX,[EDI + 0xc]
00566355 : MOV byte ptr [ESP + 0x40],0x0
0056635a : CALL 0x0051c8c0
0056635f : MOV EAX,dword ptr [ESP + 0x18]
00566363 : AND EAX,0xfffffffc
00566366 : ADD EAX,0x8
00566369 : PUSH 0xb8cc08
0056636e : PUSH EAX
0056636f : CALL 0x00634e90
00566374 : ADD ESP,0x8
00566377 : TEST EAX,EAX
00566379 : JZ 0x005663c4
0056637b : MOV byte ptr [ESP + 0x3c],0x1
00566380 : TEST EBP,EBP
00566382 : JZ 0x0056638b
00566384 : MOV ECX,EBP
00566386 : CALL 0x00523dd0
0056638b : MOV ESI,dword ptr [ESP + 0x38]
0056638f : MOV EAX,dword ptr [ESI + 0x4c]
00566392 : ADD ESI,0x48
00566395 : INC EAX
00566396 : PUSH EAX
00566397 : PUSH ESI
00566398 : MOV ECX,ESI
0056639a : CALL 0x005627b0
0056639f : MOV ECX,dword ptr [ESI + 0x4]
005663a2 : MOV EDX,dword ptr [ESI]
005663a4 : LEA ESI,[EDX + ECX*0x4 + -0x4]
005663a8 : TEST ESI,ESI
005663aa : JZ 0x005663b9
005663ac : TEST EBP,EBP
005663ae : JZ 0x005663b7
005663b0 : MOV ECX,EBP
005663b2 : CALL 0x00523dd0
005663b7 : MOV dword ptr [ESI],EBP
005663b9 : TEST EBP,EBP
005663bb : JZ 0x005663c4
005663bd : MOV ECX,EBP
005663bf : CALL 0x00524240
005663c4 : MOV EAX,dword ptr [ESP + 0x14]
005663c8 : MOV ECX,dword ptr [EAX + 0xc]
005663cb : MOV EAX,dword ptr [ECX + 0x20]
005663ce : MOV ECX,dword ptr [EAX + 0x98]
005663d4 : MOV EDX,dword ptr [EBP + 0x1c]
005663d7 : ADD EAX,0x98
005663dc : MOV EAX,dword ptr [EDX + 0xc]
005663df : MOV EAX,dword ptr [EAX + 0x20]
005663e2 : MOV EBX,dword ptr [EAX + 0x98]
005663e8 : ADD EAX,0x98
005663ed : MOV dword ptr [ESP + 0x38],ECX
005663f1 : MOV dword ptr [ESP + 0x30],EBX
005663f5 : TEST ECX,ECX
005663f7 : JZ 0x00566538
005663fd : JMP 0x00566404
00566400 : MOV EBX,dword ptr [ESP + 0x30]
00566404 : MOV ECX,dword ptr [ESP + 0x38]
00566408 : MOV EBP,dword ptr [ECX + 0x4]
0056640b : MOV EDX,dword ptr [EBP]
0056640e : MOV EAX,dword ptr [EDX + 0x38]
00566411 : MOV ECX,EBP
00566413 : CALL EAX
00566415 : TEST EAX,EAX
00566417 : JZ 0x00566424
00566419 : CMP byte ptr [ESP + 0x3c],0x0
0056641e : JZ 0x00566525
00566424 : TEST EBX,EBX
00566426 : JZ 0x00566525
0056642c : LEA ESP,[ESP]
00566430 : MOV EDI,dword ptr [EBX + 0x4]
00566433 : MOV EDX,dword ptr [EDI]
00566435 : MOV EAX,dword ptr [EDX + 0x38]
00566438 : MOV ECX,EDI
0056643a : CALL EAX
0056643c : TEST EAX,EAX
0056643e : JBE 0x00566490
00566440 : MOV EDX,dword ptr [EDI]
00566442 : MOV ESI,dword ptr [EDI + 0x14]
00566445 : MOV EAX,dword ptr [EDX + 0x3c]
00566448 : MOV ECX,EDI
0056644a : AND ESI,0x303
00566450 : CALL EAX
00566452 : MOV ECX,ESI
00566454 : AND ECX,0x300
0056645a : NEG ECX
0056645c : SBB ECX,ECX
0056645e : AND ECX,0x300
00566464 : MOV EDX,ESI
00566466 : AND EDX,0x10
00566469 : OR ECX,EDX
0056646b : OR ECX,0x3
0056646e : AND ECX,dword ptr [EBP + 0x14]
00566471 : AND ESI,0x313
00566477 : CMP ECX,ESI
00566479 : JNZ 0x00566490
0056647b : PUSH EAX
0056647c : MOV EAX,dword ptr [EBP]
0056647f : MOV EDX,dword ptr [EAX + 0x3c]
00566482 : MOV ECX,EBP
00566484 : CALL EDX
00566486 : PUSH EAX
00566487 : CALL 0x0051b280
0056648c : TEST EAX,EAX
0056648e : JZ 0x0056649c
00566490 : MOV EBX,dword ptr [EBX + 0xc]
00566493 : TEST EBX,EBX
00566495 : JNZ 0x00566430
00566497 : JMP 0x00566525
0056649c : MOV ECX,dword ptr [ESP + 0x34]
005664a0 : MOV ECX,dword ptr [ECX + 0x1c]
005664a3 : MOV EAX,dword ptr [EBX + 0x8]
005664a6 : XOR EDI,EDI
005664a8 : ADD ECX,0x18
005664ab : MOV dword ptr [ESP + 0x1c],EDI
005664af : MOV dword ptr [ESP + 0x20],EDI
005664b3 : MOV DL,byte ptr [ECX + 0x24]
005664b6 : TEST DL,DL
005664b8 : JZ 0x005664ee
005664ba : MOV EDX,dword ptr [ECX + 0x4]
005664bd : CMP EAX,EDX
005664bf : JNC 0x005664ee
005664c1 : MOV ECX,dword ptr [ECX + 0x8]
005664c4 : LEA ESI,[ECX + EAX*0x8]
005664c7 : MOV ECX,dword ptr [ESI]
005664c9 : CMP ECX,EDI
005664cb : JZ 0x005664df
005664cd : CALL 0x00523dd0
005664d2 : MOV ECX,dword ptr [ESP + 0x1c]
005664d6 : CMP ECX,EDI
005664d8 : JZ 0x005664df
005664da : CALL 0x00524240
005664df : MOV EDX,dword ptr [ESI]
005664e1 : MOV dword ptr [ESP + 0x1c],EDX
005664e5 : MOV EAX,dword ptr [ESI + 0x4]
005664e8 : MOV dword ptr [ESP + 0x20],EAX
005664ec : JMP 0x005664f9
005664ee : PUSH EAX
005664ef : LEA EDX,[ESP + 0x20]
005664f3 : PUSH EDX
005664f4 : CALL 0x00569f80
005664f9 : CMP dword ptr [ESP + 0x1c],EDI
005664fd : JZ 0x00566525
005664ff : MOV ECX,dword ptr [ESP + 0x38]
00566503 : MOV EDX,dword ptr [ECX + 0x8]
00566506 : MOV ECX,dword ptr [ESP + 0x14]
0056650a : LEA EAX,[ESP + 0x1c]
0056650e : PUSH EAX
0056650f : PUSH EDX
00566510 : ADD ECX,0x18
00566513 : CALL 0x0056a050
00566518 : MOV ECX,dword ptr [ESP + 0x1c]
0056651c : TEST ECX,ECX
0056651e : JZ 0x00566525
00566520 : CALL 0x00524240
00566525 : MOV EAX,dword ptr [ESP + 0x38]
00566529 : MOV EAX,dword ptr [EAX + 0xc]
0056652c : MOV dword ptr [ESP + 0x38],EAX
00566530 : TEST EAX,EAX
00566532 : JNZ 0x00566400
00566538 : MOV ESI,dword ptr [ESP + 0x18]
0056653c : AND ESI,0xfffffffc
0056653f : PUSH -0x1
00566541 : LEA ECX,[ESI + 0x4]
00566544 : PUSH ECX
00566545 : CALL dword ptr [0x00b851cc]
0056654b : SUB EAX,0x1
0056654e : JNZ 0x00566556
00566550 : PUSH ESI
00566551 : CALL 0x00515cf0
00566556 : POP EDI
00566557 : POP ESI
00566558 : POP EBP
00566559 : POP EBX
0056655a : ADD ESP,0x1c
0056655d : RET 0x10
