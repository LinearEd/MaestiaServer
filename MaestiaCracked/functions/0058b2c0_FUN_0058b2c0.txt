PROGRAM  : Maestia.exe
FUNCTION : FUN_0058b2c0
ENTRY    : 0058b2c0
BODY     : [[0058b2c0, 0058b39a]]

============================================================
DECOMPILED C CODE
============================================================

undefined1 FUN_0058b2c0(int *param_1)

{
  undefined1 uVar1;
  GRefCountNTSImpl *in_ECX;
  
  if (((byte)in_ECX[0x66] & 0x10) != 0) {
    return 0;
  }
  *(int *)(in_ECX + 4) = *(int *)(in_ECX + 4) + 1;
  if (((*param_1 == 1) &&
      (in_ECX[0x66] = (GRefCountNTSImpl)((byte)in_ECX[0x66] & 0xdf),
      (*(uint *)(in_ECX + 0x8c) >> 0xc & 1) == 0)) && (((byte)in_ECX[0x1c4] & 0x80) == 0)) {
    GRefCountNTSImpl::Release(in_ECX);
    return 0;
  }
  uVar1 = FUN_00521590(param_1);
  if (*param_1 == 4) {
    in_ECX[0x66] = (GRefCountNTSImpl)((byte)in_ECX[0x66] | 0x10);
    *(undefined4 *)(in_ECX + 0x78) = *(undefined4 *)(*(int *)(in_ECX + 0xa0) + 0xafc);
    *(GRefCountNTSImpl **)(*(int *)(in_ECX + 0xa0) + 0xafc) = in_ECX;
    *(int *)(in_ECX + 4) = *(int *)(in_ECX + 4) + 1;
  }
  GRefCountNTSImpl::Release(in_ECX);
  return uVar1;
}



============================================================
DISASSEMBLY
============================================================
0058b2c0 : SUB ESP,0x20
0058b2c3 : PUSH ESI
0058b2c4 : MOV ESI,ECX
0058b2c6 : TEST byte ptr [ESI + 0x66],0x10
0058b2ca : JZ 0x0058b2d5
0058b2cc : XOR AL,AL
0058b2ce : POP ESI
0058b2cf : ADD ESP,0x20
0058b2d2 : RET 0x4
0058b2d5 : INC dword ptr [ESI + 0x4]
0058b2d8 : PUSH EBX
0058b2d9 : XOR EBX,EBX
0058b2db : PUSH EDI
0058b2dc : MOV EDI,dword ptr [ESP + 0x30]
0058b2e0 : XOR EAX,EAX
0058b2e2 : CMP dword ptr [EDI],0x1
0058b2e5 : MOV dword ptr [ESP + 0xc],0x1
0058b2ed : MOV dword ptr [ESP + 0x10],EBX
0058b2f1 : MOV word ptr [ESP + 0x14],AX
0058b2f6 : MOV byte ptr [ESP + 0x16],BL
0058b2fa : MOV byte ptr [ESP + 0x17],0xff
0058b2ff : MOV byte ptr [ESP + 0x18],BL
0058b303 : MOV byte ptr [ESP + 0x19],BL
0058b307 : JNZ 0x0058b336
0058b309 : MOV ECX,dword ptr [ESI + 0x8c]
0058b30f : AND byte ptr [ESI + 0x66],0xdf
0058b313 : SHR ECX,0xc
0058b316 : TEST CL,0x1
0058b319 : JNZ 0x0058b336
0058b31b : TEST byte ptr [ESI + 0x1c4],0x80
0058b322 : JNZ 0x0058b336
0058b324 : MOV ECX,ESI
0058b326 : CALL 0x004ff7c0
0058b32b : POP EDI
0058b32c : POP EBX
0058b32d : XOR AL,AL
0058b32f : POP ESI
0058b330 : ADD ESP,0x20
0058b333 : RET 0x4
0058b336 : PUSH EDI
0058b337 : MOV ECX,ESI
0058b339 : CALL 0x00521590
0058b33e : XOR EDX,EDX
0058b340 : CMP dword ptr [EDI],0x4
0058b343 : MOV byte ptr [ESP + 0x30],AL
0058b347 : MOV dword ptr [ESP + 0x1c],0x4
0058b34f : MOV dword ptr [ESP + 0x20],EBX
0058b353 : MOV word ptr [ESP + 0x24],DX
0058b358 : MOV byte ptr [ESP + 0x26],BL
0058b35c : MOV byte ptr [ESP + 0x27],0xff
0058b361 : MOV byte ptr [ESP + 0x28],BL
0058b365 : MOV byte ptr [ESP + 0x29],BL
0058b369 : JNZ 0x0058b387
0058b36b : MOV EAX,dword ptr [ESI + 0xa0]
0058b371 : OR byte ptr [ESI + 0x66],0x10
0058b375 : MOV ECX,dword ptr [EAX + 0xafc]
0058b37b : MOV dword ptr [ESI + 0x78],ECX
0058b37e : MOV dword ptr [EAX + 0xafc],ESI
0058b384 : INC dword ptr [ESI + 0x4]
0058b387 : MOV ECX,ESI
0058b389 : CALL 0x004ff7c0
0058b38e : MOV AL,byte ptr [ESP + 0x30]
0058b392 : POP EDI
0058b393 : POP EBX
0058b394 : POP ESI
0058b395 : ADD ESP,0x20
0058b398 : RET 0x4
