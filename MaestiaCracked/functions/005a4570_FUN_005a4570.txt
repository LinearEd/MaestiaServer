PROGRAM  : Maestia.exe
FUNCTION : FUN_005a4570
ENTRY    : 005a4570
BODY     : [[005a4570, 005a4751]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005a4570(LPCRITICAL_SECTION param_1)

{
  LPCRITICAL_SECTION lpCriticalSection;
  int *piVar1;
  int *piVar2;
  int iVar3;
  uint uVar4;
  int in_ECX;
  uint *puVar5;
  int iVar6;
  int iVar7;
  uint local_8;
  undefined2 local_4;
  undefined1 local_2;
  byte local_1;
  
  lpCriticalSection = (LPCRITICAL_SECTION)(in_ECX + 0x9e4);
  EnterCriticalSection(lpCriticalSection);
  uVar4 = (uint)param_1;
  iVar7 = *(int *)(in_ECX + 0x8e0);
  if (((iVar7 != 0) &&
      (iVar3 = FUN_005a2c00(&stack0x00000004,
                            ((uint)param_1 >> 6 ^ (uint)param_1) & *(uint *)(iVar7 + 4)), -1 < iVar3
      )) && (iVar7 + 0x10 + iVar3 * 0xc != 0)) {
    FUN_005f3ce0(uVar4);
    FUN_005e4170(in_ECX + 8);
    FUN_005168e0(&stack0x00000004);
    iVar7 = *(int *)(in_ECX + 0x3c);
    if (iVar7 != in_ECX + 0x38) {
      do {
        piVar1 = *(int **)(iVar7 + 8);
        if ((piVar1 != (int *)0x0) && (uVar4 = 0, piVar1[5] != 0)) {
          puVar5 = (uint *)piVar1[4];
LAB_005a4620:
          if ((LPCRITICAL_SECTION)*puVar5 != param_1) goto code_r0x005a4628;
          if ((int *)piVar1[7] != (int *)0x0) {
            (**(code **)(*(int *)piVar1[7] + 0x44))(piVar1 + 7,3);
          }
          piVar1[7] = 0;
          piVar1[8] = 0;
          FUN_00515cf0(piVar1[4]);
          FUN_00515cf0(piVar1[1]);
          if (*piVar1 != 0) {
            iVar6 = 0;
            iVar3 = *(int *)(*piVar1 + 4) + 1;
            do {
              if (*(int *)(iVar6 + 8 + *piVar1) != -2) {
                *(undefined4 *)(iVar6 + 8 + *piVar1) = 0xfffffffe;
              }
              iVar6 = iVar6 + 0x20;
              iVar3 = iVar3 + -1;
            } while (iVar3 != 0);
            FUN_00515cf0(*piVar1);
            *piVar1 = 0;
          }
          FUN_00515cf0(piVar1);
          *(undefined4 *)(iVar7 + 8) = 0;
        }
LAB_005a46b6:
        iVar7 = *(int *)(iVar7 + 4);
      } while (iVar7 != in_ECX + 0x38);
    }
  }
  piVar1 = *(int **)(in_ECX + 0x8fc);
  uVar4 = local_8;
  while (piVar2 = piVar1, piVar2 != (int *)(in_ECX + 0x8f8)) {
    local_8 = piVar2[2];
    piVar1 = (int *)piVar2[1];
    if ((LPCRITICAL_SECTION)local_8 == param_1) {
      local_4 = (undefined2)piVar2[3];
      local_1 = *(byte *)((int)piVar2 + 0xf) & 3;
      local_2 = *(undefined1 *)((int)piVar2 + 0xe);
      FUN_005a3880(&local_8);
      *(int *)(*piVar2 + 4) = piVar2[1];
      *(int *)piVar2[1] = *piVar2;
      if (piVar2[4] != 0) {
        FUN_00557b30();
      }
      *piVar2 = *(int *)(in_ECX + 0x8f0);
      *(int **)(in_ECX + 0x8f0) = piVar2;
      uVar4 = local_8;
    }
  }
  param_1 = lpCriticalSection;
  local_8 = uVar4;
                    /* WARNING: Could not recover jumptable at 0x005a474c. Too many branches */
                    /* WARNING: Treating indirect jump as call */
  LeaveCriticalSection(lpCriticalSection);
  return;
code_r0x005a4628:
  uVar4 = uVar4 + 1;
  puVar5 = puVar5 + 7;
  if ((uint)piVar1[5] <= uVar4) goto LAB_005a46b6;
  goto LAB_005a4620;
}



============================================================
DISASSEMBLY
============================================================
005a4570 : SUB ESP,0xc
005a4573 : PUSH EBX
005a4574 : PUSH EBP
005a4575 : PUSH ESI
005a4576 : MOV EBP,ECX
005a4578 : LEA EAX,[EBP + 0x9e4]
005a457e : PUSH EDI
005a457f : PUSH EAX
005a4580 : MOV dword ptr [ESP + 0x14],EAX
005a4584 : CALL dword ptr [0x00b85118]
005a458a : MOV ESI,dword ptr [EBP + 0x8e0]
005a4590 : LEA EDI,[EBP + 0x8e0]
005a4596 : TEST ESI,ESI
005a4598 : JZ 0x005a46c4
005a459e : MOV EBX,dword ptr [ESP + 0x20]
005a45a2 : MOV EAX,EBX
005a45a4 : SHR EAX,0x6
005a45a7 : XOR EAX,EBX
005a45a9 : AND EAX,dword ptr [ESI + 0x4]
005a45ac : LEA ECX,[ESP + 0x20]
005a45b0 : PUSH EAX
005a45b1 : PUSH ECX
005a45b2 : MOV ECX,EDI
005a45b4 : CALL 0x005a2c00
005a45b9 : TEST EAX,EAX
005a45bb : JL 0x005a46c4
005a45c1 : LEA EDX,[EAX + EAX*0x2]
005a45c4 : LEA EAX,[ESI + EDX*0x4 + 0x10]
005a45c8 : TEST EAX,EAX
005a45ca : JZ 0x005a46c4
005a45d0 : PUSH EBX
005a45d1 : LEA ECX,[EBP + 0x40]
005a45d4 : CALL 0x005f3ce0
005a45d9 : LEA EAX,[EBP + 0x8]
005a45dc : PUSH EAX
005a45dd : MOV ECX,EBX
005a45df : CALL 0x005e4170
005a45e4 : LEA ECX,[ESP + 0x20]
005a45e8 : PUSH ECX
005a45e9 : MOV ECX,EDI
005a45eb : CALL 0x005168e0
005a45f0 : MOV EBX,dword ptr [EBP + 0x3c]
005a45f3 : LEA EAX,[EBP + 0x38]
005a45f6 : CMP EBX,EAX
005a45f8 : JZ 0x005a46c4
005a45fe : MOV EDI,EDI
005a4600 : MOV ESI,dword ptr [EBX + 0x8]
005a4603 : TEST ESI,ESI
005a4605 : JZ 0x005a46b6
005a460b : XOR EAX,EAX
005a460d : CMP dword ptr [ESI + 0x14],EAX
005a4610 : JBE 0x005a46b6
005a4616 : MOV ECX,dword ptr [ESI + 0x10]
005a4619 : LEA ESP,[ESP]
005a4620 : MOV EDX,dword ptr [ESP + 0x20]
005a4624 : CMP dword ptr [ECX],EDX
005a4626 : JZ 0x005a4638
005a4628 : INC EAX
005a4629 : MOV EDX,ESI
005a462b : ADD ECX,0x1c
005a462e : CMP EAX,dword ptr [EDX + 0x14]
005a4631 : JC 0x005a4620
005a4633 : JMP 0x005a46b6
005a4638 : MOV ECX,dword ptr [ESI + 0x1c]
005a463b : LEA EDI,[ESI + 0x1c]
005a463e : TEST ECX,ECX
005a4640 : JZ 0x005a464c
005a4642 : MOV EAX,dword ptr [ECX]
005a4644 : MOV EDX,dword ptr [EAX + 0x44]
005a4647 : PUSH 0x3
005a4649 : PUSH EDI
005a464a : CALL EDX
005a464c : MOV dword ptr [EDI],0x0
005a4652 : MOV dword ptr [EDI + 0x4],0x0
005a4659 : MOV EAX,dword ptr [ESI + 0x10]
005a465c : PUSH EAX
005a465d : CALL 0x00515cf0
005a4662 : MOV ECX,dword ptr [ESI + 0x4]
005a4665 : PUSH ECX
005a4666 : CALL 0x00515cf0
005a466b : MOV EAX,dword ptr [ESI]
005a466d : TEST EAX,EAX
005a466f : JZ 0x005a46a9
005a4671 : MOV EAX,dword ptr [EAX + 0x4]
005a4674 : XOR ECX,ECX
005a4676 : LEA EDX,[EAX + 0x1]
005a4679 : LEA ESP,[ESP]
005a4680 : MOV EAX,dword ptr [ESI]
005a4682 : CMP dword ptr [ECX + EAX*0x1 + 0x8],-0x2
005a4687 : LEA EAX,[ECX + EAX*0x1 + 0x8]
005a468b : JZ 0x005a4693
005a468d : MOV dword ptr [EAX],0xfffffffe
005a4693 : ADD ECX,0x20
005a4696 : SUB EDX,0x1
005a4699 : JNZ 0x005a4680
005a469b : MOV ECX,dword ptr [ESI]
005a469d : PUSH ECX
005a469e : CALL 0x00515cf0
005a46a3 : MOV dword ptr [ESI],0x0
005a46a9 : PUSH ESI
005a46aa : CALL 0x00515cf0
005a46af : MOV dword ptr [EBX + 0x8],0x0
005a46b6 : MOV EBX,dword ptr [EBX + 0x4]
005a46b9 : LEA EAX,[EBP + 0x38]
005a46bc : CMP EBX,EAX
005a46be : JNZ 0x005a4600
005a46c4 : MOV ESI,dword ptr [EBP + 0x8fc]
005a46ca : LEA EBX,[EBP + 0x8f8]
005a46d0 : CMP ESI,EBX
005a46d2 : JZ 0x005a473d
005a46d4 : MOV EAX,dword ptr [ESI + 0x8]
005a46d7 : MOV EDI,dword ptr [ESI + 0x4]
005a46da : CMP EAX,dword ptr [ESP + 0x20]
005a46de : JNZ 0x005a4737
005a46e0 : MOV DX,word ptr [ESI + 0xc]
005a46e4 : MOV CL,byte ptr [ESI + 0xf]
005a46e7 : AND CL,0x3
005a46ea : MOV word ptr [ESP + 0x18],DX
005a46ef : MOV dword ptr [ESP + 0x14],EAX
005a46f3 : MOV AL,byte ptr [ESI + 0xe]
005a46f6 : LEA EDX,[ESP + 0x14]
005a46fa : MOV byte ptr [ESP + 0x1b],CL
005a46fe : PUSH EDX
005a46ff : LEA ECX,[EBP + 0x900]
005a4705 : MOV byte ptr [ESP + 0x1e],AL
005a4709 : CALL 0x005a3880
005a470e : MOV EAX,dword ptr [ESI]
005a4710 : MOV ECX,dword ptr [ESI + 0x4]
005a4713 : MOV dword ptr [EAX + 0x4],ECX
005a4716 : MOV EDX,dword ptr [ESI + 0x4]
005a4719 : MOV EAX,dword ptr [ESI]
005a471b : MOV dword ptr [EDX],EAX
005a471d : MOV ECX,dword ptr [ESI + 0x10]
005a4720 : TEST ECX,ECX
005a4722 : JZ 0x005a4729
005a4724 : CALL 0x00557b30
005a4729 : MOV ECX,dword ptr [EBP + 0x8f0]
005a472f : MOV dword ptr [ESI],ECX
005a4731 : MOV dword ptr [EBP + 0x8f0],ESI
005a4737 : MOV ESI,EDI
005a4739 : CMP EDI,EBX
005a473b : JNZ 0x005a46d4
005a473d : MOV EDX,dword ptr [ESP + 0x10]
005a4741 : POP EDI
005a4742 : POP ESI
005a4743 : POP EBP
005a4744 : POP EBX
005a4745 : ADD ESP,0xc
005a4748 : MOV dword ptr [ESP + 0x4],EDX
005a474c : JMP dword ptr [0x00b8511c]
