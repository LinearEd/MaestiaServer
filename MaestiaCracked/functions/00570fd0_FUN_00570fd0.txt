PROGRAM  : Maestia.exe
FUNCTION : FUN_00570fd0
ENTRY    : 00570fd0
BODY     : [[00570fd0, 00571131]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00570fd0(int param_1,undefined4 param_2)

{
  char cVar1;
  int iVar2;
  undefined4 uVar3;
  undefined4 uVar4;
  GRefCountImpl *this;
  LONG LVar5;
  undefined4 *in_ECX;
  uint unaff_retaddr;
  undefined4 in_stack_ffffffdc;
  undefined4 in_stack_ffffffe0;
  undefined4 uVar6;
  
  in_ECX[1] = 0;
  in_ECX[2] = 0;
  in_ECX[3] = param_2;
  in_ECX[4] = param_1;
  *in_ECX = &PTR_FUN_00b8d1f0;
  in_ECX[5] = 0;
  in_ECX[6] = 0;
  iVar2 = FUN_00515840(0x54,0);
  if (iVar2 == 0) {
    uVar4 = 0;
  }
  else {
    uVar4 = *(undefined4 *)(*(int *)(in_ECX[3] + 0x6c) + 0x14);
    uVar6 = 0;
    uVar3 = (*(code *)**(undefined4 **)(in_ECX[3] + 8))(0);
    in_stack_ffffffe0 = 0x571028;
    uVar4 = FUN_005a19f0(uVar4,uVar3,uVar6);
  }
  if ((GRefCountImpl *)in_ECX[6] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)in_ECX[6]);
  }
  in_ECX[6] = uVar4;
  FUN_0051b6e0();
  if (*(int *)(in_ECX[3] + 0x68) != 0) {
    uVar4 = (**(code **)(**(int **)(in_ECX[3] + 0x6c) + 0x30))();
    FUN_0051bb20(uVar4);
    cVar1 = FUN_005a23d0(&param_2);
    if (cVar1 != '\0') goto LAB_0057107e;
  }
  FUN_0051bf30();
LAB_0057107e:
  uVar3 = 0x24;
  uVar4 = 0x57108c;
  iVar2 = FUN_00515840(0x24,0);
  if (iVar2 == 0) {
    uVar4 = 0;
  }
  else {
    FUN_005266c0(param_1 + 0x3c);
    if (*(GRefCountImpl **)(param_1 + 0x4c) != (GRefCountImpl *)0x0) {
      GRefCountImpl::AddRef(*(GRefCountImpl **)(param_1 + 0x4c));
    }
    uVar4 = FUN_0056f1f0(in_ECX[6],&param_2,param_1 + 0xc,in_stack_ffffffdc,in_stack_ffffffe0,uVar4,
                         uVar3,*(undefined4 *)(param_1 + 0x4c));
  }
  if ((GRefCountImpl *)in_ECX[5] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)in_ECX[5]);
  }
  in_ECX[5] = uVar4;
  this = (GRefCountImpl *)(**(code **)(*(int *)(in_ECX[3] + 8) + 0xc))(0x17);
  (**(code **)(*(int *)this + 4))(in_ECX[5]);
  GRefCountImpl::Release(this);
  LVar5 = InterlockedExchangeAdd((LONG *)((unaff_retaddr & 0xfffffffc) + 4),-1);
  if (LVar5 == 1) {
    FUN_00515cf0(unaff_retaddr & 0xfffffffc);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00570fd0 : MOV EAX,dword ptr [ESP + 0x8]
00570fd4 : PUSH EBX
00570fd5 : PUSH EBP
00570fd6 : PUSH ESI
00570fd7 : MOV ESI,ECX
00570fd9 : MOV ECX,dword ptr [ESP + 0x10]
00570fdd : XOR EBP,EBP
00570fdf : PUSH EDI
00570fe0 : MOV dword ptr [ESI + 0x4],EBP
00570fe3 : MOV dword ptr [ESI + 0x8],EBP
00570fe6 : MOV dword ptr [ESI + 0xc],EAX
00570fe9 : MOV dword ptr [ESI + 0x10],ECX
00570fec : MOV dword ptr [ESI],0xb8d1f0
00570ff2 : MOV dword ptr [ESI + 0x14],EBP
00570ff5 : PUSH EBP
00570ff6 : MOV dword ptr [ESI + 0x18],EBP
00570ff9 : MOV ECX,dword ptr [0x00d73250]
00570fff : PUSH 0x54
00571001 : CALL 0x00515840
00571006 : MOV EDI,EAX
00571008 : CMP EDI,EBP
0057100a : JZ 0x0057102c
0057100c : MOV EAX,dword ptr [ESI + 0xc]
0057100f : MOV EDX,dword ptr [EAX + 0x6c]
00571012 : MOV EBX,dword ptr [EDX + 0x14]
00571015 : LEA ECX,[EAX + 0x8]
00571018 : MOV EAX,dword ptr [ECX]
0057101a : MOV EDX,dword ptr [EAX]
0057101c : PUSH EBP
0057101d : CALL EDX
0057101f : PUSH EAX
00571020 : PUSH EBX
00571021 : MOV ECX,EDI
00571023 : CALL 0x005a19f0
00571028 : MOV EDI,EAX
0057102a : JMP 0x0057102e
0057102c : XOR EDI,EDI
0057102e : MOV ECX,dword ptr [ESI + 0x18]
00571031 : CMP ECX,EBP
00571033 : JZ 0x0057103a
00571035 : CALL 0x004ff7e0
0057103a : LEA ECX,[ESP + 0x18]
0057103e : MOV dword ptr [ESI + 0x18],EDI
00571041 : CALL 0x0051b6e0
00571046 : MOV EAX,dword ptr [ESI + 0xc]
00571049 : CMP dword ptr [EAX + 0x68],EBP
0057104c : JZ 0x00571075
0057104e : MOV EAX,dword ptr [EAX + 0x6c]
00571051 : MOV EDX,dword ptr [EAX]
00571053 : MOV ECX,EAX
00571055 : MOV EAX,dword ptr [EDX + 0x30]
00571058 : CALL EAX
0057105a : PUSH EAX
0057105b : LEA ECX,[ESP + 0x1c]
0057105f : CALL 0x0051bb20
00571064 : LEA ECX,[ESP + 0x18]
00571068 : PUSH ECX
00571069 : CALL 0x005a23d0
0057106e : ADD ESP,0x4
00571071 : TEST AL,AL
00571073 : JNZ 0x0057107e
00571075 : LEA ECX,[ESP + 0x18]
00571079 : CALL 0x0051bf30
0057107e : MOV ECX,dword ptr [0x00d73250]
00571084 : PUSH EBP
00571085 : PUSH 0x24
00571087 : CALL 0x00515840
0057108c : MOV EBP,EAX
0057108e : TEST EBP,EBP
00571090 : JZ 0x005710d4
00571092 : MOV EDI,dword ptr [ESP + 0x14]
00571096 : SUB ESP,0x14
00571099 : MOV EBX,ESP
0057109b : ADD EDI,0x3c
0057109e : PUSH EDI
0057109f : MOV ECX,EBX
005710a1 : CALL 0x005266c0
005710a6 : MOV ECX,dword ptr [EDI + 0x10]
005710a9 : TEST ECX,ECX
005710ab : JZ 0x005710b2
005710ad : CALL 0x00523dd0
005710b2 : MOV EDX,dword ptr [EDI + 0x10]
005710b5 : MOV ECX,dword ptr [ESP + 0x28]
005710b9 : ADD ECX,0xc
005710bc : MOV dword ptr [EBX + 0x10],EDX
005710bf : MOV EAX,dword ptr [ESI + 0x18]
005710c2 : PUSH ECX
005710c3 : LEA EDX,[ESP + 0x30]
005710c7 : PUSH EDX
005710c8 : PUSH EAX
005710c9 : MOV ECX,EBP
005710cb : CALL 0x0056f1f0
005710d0 : MOV EDI,EAX
005710d2 : JMP 0x005710d6
005710d4 : XOR EDI,EDI
005710d6 : MOV ECX,dword ptr [ESI + 0x14]
005710d9 : TEST ECX,ECX
005710db : JZ 0x005710e2
005710dd : CALL 0x004ff7e0
005710e2 : MOV dword ptr [ESI + 0x14],EDI
005710e5 : MOV ECX,dword ptr [ESI + 0xc]
005710e8 : MOV EAX,dword ptr [ECX + 0x8]
005710eb : MOV EDX,dword ptr [EAX + 0xc]
005710ee : ADD ECX,0x8
005710f1 : PUSH 0x17
005710f3 : CALL EDX
005710f5 : MOV ECX,dword ptr [ESI + 0x14]
005710f8 : MOV EDI,EAX
005710fa : MOV EAX,dword ptr [EDI]
005710fc : MOV EDX,dword ptr [EAX + 0x4]
005710ff : PUSH ECX
00571100 : MOV ECX,EDI
00571102 : CALL EDX
00571104 : MOV ECX,EDI
00571106 : CALL 0x004ff7e0
0057110b : MOV EDI,dword ptr [ESP + 0x18]
0057110f : AND EDI,0xfffffffc
00571112 : PUSH -0x1
00571114 : LEA EAX,[EDI + 0x4]
00571117 : PUSH EAX
00571118 : CALL dword ptr [0x00b851cc]
0057111e : SUB EAX,0x1
00571121 : JNZ 0x00571129
00571123 : PUSH EDI
00571124 : CALL 0x00515cf0
00571129 : POP EDI
0057112a : MOV EAX,ESI
0057112c : POP ESI
0057112d : POP EBP
0057112e : POP EBX
0057112f : RET 0x8
