PROGRAM  : Maestia.exe
FUNCTION : FUN_00559120
ENTRY    : 00559120
BODY     : [[00559120, 00559388]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00559120(float param_1,int param_2,undefined4 param_3)

{
  GRefCountNTSImpl *pGVar1;
  float fVar2;
  bool bVar3;
  int iVar4;
  undefined4 uVar5;
  byte *pbVar6;
  int *in_ECX;
  uint uVar7;
  GRefCountNTSImpl *unaff_EBP;
  GRefCountNTSImpl *pGVar8;
  float unaff_retaddr;
  GRefCountNTSImpl *local_34;
  undefined4 local_30;
  float local_2c;
  undefined4 local_28;
  byte *local_24;
  byte *pbStack_20;
  ushort uStack_14;
  uint uStack_10;
  uint uStack_c;
  
  if (in_ECX[8] == 0) {
    if ((((*(byte *)(param_2 + 0x14) & 0x10) == 0) || ((*(uint *)(param_2 + 0x1c) & 0x100) == 0)) ||
       (((*(uint *)(param_2 + 0x1c) >> 9 & 1) == 0 && ((*(byte *)(in_ECX + 9) & 1) != 0)))) {
      bVar3 = false;
    }
    else {
      bVar3 = true;
    }
    iVar4 = FUN_00515840(0x3b4,0);
    if (iVar4 == 0) {
      local_34 = (GRefCountNTSImpl *)0x0;
    }
    else {
      local_34 = (GRefCountNTSImpl *)FUN_005ddf20(DAT_00d73250);
    }
    local_2c = 20.0 / param_1;
    local_28 = 0x83;
    fVar2 = local_2c * 0.75 * *(float *)(param_2 + 0x10);
    iVar4 = FUN_00515d60(in_ECX,0x70,&local_28);
    if (iVar4 == 0) {
      iVar4 = 0;
    }
    else {
      iVar4 = FUN_005dc3f0(local_2c,fVar2,!bVar3,0);
    }
    pGVar1 = local_34 + 8;
    in_ECX[8] = iVar4;
    FUN_005dd100();
    FUN_005dcbb0(fVar2);
    local_34[0x4c] = (GRefCountNTSImpl)(*(byte *)(in_ECX + 9) >> 3 & 1);
    if ((*(byte *)(in_ECX + 9) & 0x10) != 0) {
      FUN_005d9f10(in_ECX + 1,param_3);
    }
    FUN_005548f0(in_ECX);
    local_30 = 0;
    uVar5 = (**(code **)(*in_ECX + 0x24))(&local_30);
    pGVar8 = local_34;
    if (uStack_10 < uStack_c) {
      uVar7 = (uint)uStack_14;
      do {
        pbVar6 = local_24;
        pGVar8 = unaff_EBP;
        if ((*local_24 & 7) == 0) {
          local_2c = unaff_retaddr * 0.25;
          FUN_005dcd20(local_2c);
          FUN_005dc490(pGVar1,uVar5,local_34,0,fVar2);
          FUN_005dd100();
          if (uStack_c <= uStack_10) break;
          if ((*pbVar6 & 7) == 0) {
            local_24 = pbVar6 + 1;
          }
          else {
            FUN_00555bc0();
            uVar7 = (uint)uStack_14;
          }
          uStack_10 = uStack_10 + 1;
          pbVar6 = pbStack_20 + -(uVar7 & 0xffff);
          if (*(int *)(pbVar6 + 4) <= (int)(local_24 + (-8 - (int)pbVar6))) {
            iVar4 = *(int *)pbVar6;
            if (iVar4 == 0) {
              local_24 = (byte *)0x0;
            }
            else {
              local_24 = (byte *)(iVar4 + 8);
              uVar7 = (int)local_24 - iVar4;
              uStack_14 = (ushort)uVar7;
              pbStack_20 = local_24;
            }
          }
        }
        else {
          FUN_00558bc0(pGVar1);
          uVar7 = (uint)uStack_14;
        }
      } while (uStack_10 < uStack_c);
    }
    FUN_005dcd20(unaff_retaddr * 0.25);
    FUN_005dc490(pGVar1,uVar5,local_34,0,fVar2);
    GRefCountNTSImpl::Release(pGVar8);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00559120 : SUB ESP,0x34
00559123 : PUSH EBP
00559124 : MOV EBP,ECX
00559126 : CMP dword ptr [EBP + 0x20],0x0
0055912a : JNZ 0x00559382
00559130 : PUSH EBX
00559131 : PUSH ESI
00559132 : MOV ESI,dword ptr [ESP + 0x48]
00559136 : TEST byte ptr [ESI + 0x14],0x10
0055913a : PUSH EDI
0055913b : JZ 0x00559158
0055913d : MOV EAX,dword ptr [ESI + 0x1c]
00559140 : TEST EAX,0x100
00559145 : JZ 0x00559158
00559147 : SHR EAX,0x9
0055914a : TEST AL,0x1
0055914c : JNZ 0x00559154
0055914e : TEST byte ptr [EBP + 0x24],0x1
00559152 : JNZ 0x00559158
00559154 : MOV BL,0x1
00559156 : JMP 0x0055915a
00559158 : XOR BL,BL
0055915a : MOV ECX,dword ptr [0x00d73250]
00559160 : PUSH 0x0
00559162 : PUSH 0x3b4
00559167 : CALL 0x00515840
0055916c : TEST EAX,EAX
0055916e : JZ 0x00559186
00559170 : MOV ECX,dword ptr [0x00d73250]
00559176 : PUSH ECX
00559177 : MOV ECX,EAX
00559179 : CALL 0x005ddf20
0055917e : MOV EDI,EAX
00559180 : MOV dword ptr [ESP + 0x10],EDI
00559184 : JMP 0x00559192
00559186 : MOV dword ptr [ESP + 0x10],0x0
0055918e : MOV EDI,dword ptr [ESP + 0x10]
00559192 : FLD float ptr [ESP + 0x48]
00559196 : LEA EDX,[ESP + 0x1c]
0055919a : FDIVR double ptr [0x00b86058]
005591a0 : PUSH EDX
005591a1 : PUSH 0x70
005591a3 : PUSH EBP
005591a4 : MOV dword ptr [ESP + 0x28],0x83
005591ac : FSTP float ptr [ESP + 0x24]
005591b0 : FLD float ptr [ESP + 0x24]
005591b4 : FMUL double ptr [0x00b8c220]
005591ba : FMUL float ptr [ESI + 0x10]
005591bd : FSTP float ptr [ESP + 0x54]
005591c1 : CALL 0x00515d60
005591c6 : TEST EAX,EAX
005591c8 : JZ 0x005591f0
005591ca : FLD float ptr [ESP + 0x48]
005591ce : TEST BL,BL
005591d0 : SETZ CL
005591d3 : MOVZX EDX,CL
005591d6 : PUSH 0x0
005591d8 : PUSH EDX
005591d9 : SUB ESP,0x8
005591dc : MOV ECX,EAX
005591de : FSTP float ptr [ESP + 0x4]
005591e2 : FLD float ptr [ESP + 0x28]
005591e6 : FSTP float ptr [ESP]
005591e9 : CALL 0x005dc3f0
005591ee : JMP 0x005591f2
005591f0 : XOR EAX,EAX
005591f2 : LEA ESI,[EDI + 0x8]
005591f5 : MOV ECX,ESI
005591f7 : MOV dword ptr [EBP + 0x20],EAX
005591fa : CALL 0x005dd100
005591ff : FLD float ptr [ESP + 0x48]
00559203 : PUSH ECX
00559204 : MOV ECX,ESI
00559206 : FSTP float ptr [ESP]
00559209 : CALL 0x005dcbb0
0055920e : MOV AL,byte ptr [EBP + 0x24]
00559211 : SHR AL,0x3
00559214 : AND AL,0x1
00559216 : MOV byte ptr [EDI + 0x4c],AL
00559219 : TEST byte ptr [EBP + 0x24],0x10
0055921d : JZ 0x00559233
0055921f : FLD float ptr [ESP + 0x50]
00559223 : PUSH ECX
00559224 : LEA ECX,[EBP + 0x4]
00559227 : FSTP float ptr [ESP]
0055922a : PUSH ECX
0055922b : MOV ECX,dword ptr [EBP + 0x20]
0055922e : CALL 0x005d9f10
00559233 : PUSH EBP
00559234 : LEA ECX,[ESP + 0x24]
00559238 : CALL 0x005548f0
0055923d : MOV EDX,dword ptr [EBP]
00559240 : MOV EDX,dword ptr [EDX + 0x24]
00559243 : LEA EAX,[ESP + 0x14]
00559247 : PUSH EAX
00559248 : MOV ECX,EBP
0055924a : MOV dword ptr [ESP + 0x18],0x0
00559252 : CALL EDX
00559254 : MOV dword ptr [ESP + 0x50],EAX
00559258 : MOV EAX,dword ptr [ESP + 0x3c]
0055925c : CMP dword ptr [ESP + 0x38],EAX
00559260 : JNC 0x00559341
00559266 : MOV BX,word ptr [ESP + 0x34]
0055926b : MOV EDI,dword ptr [ESP + 0x24]
0055926f : NOP
00559270 : TEST byte ptr [EDI],0x7
00559273 : JNZ 0x0055931c
00559279 : FLD float ptr [ESP + 0x48]
0055927d : PUSH ECX
0055927e : FMUL double ptr [0x00cdf848]
00559284 : MOV ECX,ESI
00559286 : FSTP float ptr [ESP + 0x20]
0055928a : FLD float ptr [ESP + 0x20]
0055928e : FSTP float ptr [ESP]
00559291 : CALL 0x005dcd20
00559296 : MOV ECX,dword ptr [ESP + 0x4c]
0055929a : MOV EDX,dword ptr [ESP + 0x14]
0055929e : MOV EAX,dword ptr [ESP + 0x50]
005592a2 : PUSH ECX
005592a3 : MOV ECX,dword ptr [EBP + 0x20]
005592a6 : PUSH 0x0
005592a8 : PUSH EDX
005592a9 : PUSH EAX
005592aa : PUSH ESI
005592ab : CALL 0x005dc490
005592b0 : MOV ECX,ESI
005592b2 : CALL 0x005dd100
005592b7 : MOV ECX,dword ptr [ESP + 0x38]
005592bb : CMP ECX,dword ptr [ESP + 0x3c]
005592bf : JNC 0x0055933d
005592c1 : TEST byte ptr [EDI],0x7
005592c4 : JNZ 0x005592cd
005592c6 : INC EDI
005592c7 : MOV dword ptr [ESP + 0x24],EDI
005592cb : JMP 0x005592df
005592cd : LEA ECX,[ESP + 0x20]
005592d1 : CALL 0x00555bc0
005592d6 : MOV BX,word ptr [ESP + 0x34]
005592db : MOV EDI,dword ptr [ESP + 0x24]
005592df : MOV EAX,dword ptr [ESP + 0x28]
005592e3 : INC dword ptr [ESP + 0x38]
005592e7 : MOVZX EDX,BX
005592ea : SUB EAX,EDX
005592ec : MOV ECX,EDI
005592ee : SUB ECX,EAX
005592f0 : SUB ECX,0x8
005592f3 : CMP ECX,dword ptr [EAX + 0x4]
005592f6 : JL 0x0055932f
005592f8 : MOV EAX,dword ptr [EAX]
005592fa : TEST EAX,EAX
005592fc : JZ 0x00559314
005592fe : LEA EDI,[EAX + 0x8]
00559301 : MOV EBX,EDI
00559303 : SUB EBX,EAX
00559305 : MOV dword ptr [ESP + 0x24],EDI
00559309 : MOV dword ptr [ESP + 0x28],EDI
0055930d : MOV word ptr [ESP + 0x34],BX
00559312 : JMP 0x0055932f
00559314 : XOR EDI,EDI
00559316 : MOV dword ptr [ESP + 0x24],EDI
0055931a : JMP 0x0055932f
0055931c : PUSH ESI
0055931d : LEA ECX,[ESP + 0x24]
00559321 : CALL 0x00558bc0
00559326 : MOV BX,word ptr [ESP + 0x34]
0055932b : MOV EDI,dword ptr [ESP + 0x24]
0055932f : MOV EDX,dword ptr [ESP + 0x3c]
00559333 : CMP dword ptr [ESP + 0x38],EDX
00559337 : JC 0x00559270
0055933d : MOV EDI,dword ptr [ESP + 0x10]
00559341 : FLD float ptr [ESP + 0x48]
00559345 : PUSH ECX
00559346 : FMUL double ptr [0x00cdf848]
0055934c : MOV ECX,ESI
0055934e : FSTP float ptr [ESP + 0x4c]
00559352 : FLD float ptr [ESP + 0x4c]
00559356 : FSTP float ptr [ESP]
00559359 : CALL 0x005dcd20
0055935e : MOV EAX,dword ptr [ESP + 0x4c]
00559362 : MOV ECX,dword ptr [ESP + 0x14]
00559366 : MOV EDX,dword ptr [ESP + 0x50]
0055936a : PUSH EAX
0055936b : PUSH 0x0
0055936d : PUSH ECX
0055936e : MOV ECX,dword ptr [EBP + 0x20]
00559371 : PUSH EDX
00559372 : PUSH ESI
00559373 : CALL 0x005dc490
00559378 : MOV ECX,EDI
0055937a : CALL 0x004ff7c0
0055937f : POP EDI
00559380 : POP ESI
00559381 : POP EBX
00559382 : POP EBP
00559383 : ADD ESP,0x34
00559386 : RET 0xc
