PROGRAM  : Maestia.exe
FUNCTION : FUN_0090aab0
ENTRY    : 0090aab0
BODY     : [[0090aab0, 0090ab9e] [0090aba0, 0090ae2f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0090aab0(int param_1,undefined1 *param_2,ushort *param_3)

{
  undefined4 ******ppppppuVar1;
  ushort *puVar2;
  int iVar3;
  int iVar4;
  uint *puVar5;
  int *unaff_EDI;
  undefined4 ****ppppuStack_b0;
  char *pcStack_ac;
  char *pcStack_a8;
  undefined4 uStack_a4;
  uint uStack_a0;
  undefined1 *puStack_9c;
  undefined4 ******ppppppuStack_98;
  uint uStack_94;
  undefined1 auStack_88 [4];
  undefined4 *****local_84;
  undefined4 *local_80;
  ushort *local_7c;
  uint *local_78;
  undefined1 local_74 [4];
  undefined4 *local_70;
  undefined4 *local_6c;
  undefined4 uStack_68;
  undefined4 *****pppppuStack_64;
  int local_60;
  int local_5c;
  int iStack_58;
  undefined2 uStack_50;
  undefined4 uStack_40;
  uint uStack_3c;
  undefined1 auStack_38 [4];
  undefined4 ******appppppuStack_34 [4];
  undefined4 uStack_24;
  uint uStack_20;
  uint local_1c;
  void *local_14;
  undefined1 *puStack_10;
  uint local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b2c7b8;
  local_14 = ExceptionList;
  local_1c = DAT_00d66fa0 ^ (uint)auStack_88;
  uStack_94 = DAT_00d66fa0 ^ (uint)&stack0xffffff70;
  ExceptionList = &local_14;
  local_7c = param_3;
  ppppppuStack_98 =
       (undefined4 ******)(*(int *)(unaff_EDI[0x17] + 0x38) * 0x10 + 0x24 + DAT_01724910);
  puStack_9c = local_74;
  uStack_a0 = 0x90ab0d;
  FUN_0047bc90();
  local_c = 0;
  local_80 = local_70;
  iVar4 = DAT_00d7c54c;
  if (local_70 != local_6c) {
    do {
      puVar5 = (uint *)*local_80;
      local_78 = puVar5;
      if (*puVar5 >> 0x10 == 0x768) {
        ppppppuStack_98 = &local_84;
        puStack_9c = (undefined1 *)0x90ab60;
        local_84 = (undefined4 ******)*puVar5;
        FUN_004437f0();
        if ((local_5c != *(int *)(iVar4 + 0x44)) && (iVar3 = *(int *)(local_5c + 0x10), iVar3 != 0))
        {
          local_60 = iVar3 + 0x1ea8;
          ppppppuStack_98 = (undefined4 *******)0x90ab91;
          local_84 = (undefined4 *****)(**(code **)(*(int *)(iVar3 + 0x1ea8) + 4))();
          iVar4 = DAT_00d7c54c;
          while (DAT_00d7c54c = iVar4, (undefined4 ******)local_84 != (undefined4 ******)0x0) {
            ppppppuStack_98 = (undefined4 *******)0x90abaf;
            iVar3 = FUN_004f5680();
            iVar4 = DAT_00d7c54c;
            if (iVar3 != 0) {
              if (CONCAT22(*(undefined2 *)(iVar3 + 4),*(undefined2 *)(iVar3 + 6)) == param_1) {
                uStack_20 = 7;
                uStack_24 = 0;
                appppppuStack_34[0] = (undefined4 ******)((uint)appppppuStack_34[0] & 0xffff0000);
                local_c._0_1_ = 1;
                puStack_9c = (undefined1 *)*puVar5;
                ppppppuStack_98 = (undefined4 ******)auStack_38;
                uStack_a0 = 0x90abfe;
                (**(code **)(*unaff_EDI + 0x58))();
                pppppuStack_64 = &ppppuStack_b0;
                ppppppuStack_98 = (undefined4 ******)0x7;
                puStack_9c = (undefined1 *)0x0;
                pcStack_ac = (char *)((uint)pcStack_ac & 0xffff0000);
                FUN_00405eb0(auStack_38,0,0xffffffff);
                local_c._0_1_ = 1;
                uStack_a0 = FUN_008f75f0();
                local_c._0_1_ = 3;
                ppppppuStack_98 = (undefined4 ******)0xffffffff;
                puStack_9c = (undefined1 *)0x0;
                uStack_a4 = 0x90ac59;
                FUN_00405eb0();
                local_c = CONCAT31(local_c._1_3_,1);
                if (7 < uStack_3c) {
                    /* WARNING: Subroutine does not return */
                  ppppppuStack_98 = (undefined4 ******)0x90ac71;
                  FUN_006f04e0();
                }
                uStack_50 = 0;
                ppppppuStack_98 = (undefined4 ******)*puVar5;
                uStack_3c = 7;
                ppppppuVar1 = (undefined4 ******)puVar5[1];
                uStack_40 = 0;
                puStack_9c = (undefined1 *)0x90ac95;
                iVar4 = FUN_009f2740();
                if (iVar4 != 0) {
                  ppppppuStack_98 = &pppppuStack_64;
                  puStack_9c = (undefined1 *)0x90acb0;
                  pppppuStack_64 = ppppppuVar1;
                  FUN_004437f0();
                  puVar2 = local_7c;
                  if ((iStack_58 != *(int *)(iVar4 + 0xc)) && (*(uint *)(iStack_58 + 0x10) != 0)) {
                    ppppppuStack_98 = (undefined4 ******)(uint)*local_7c;
                    puStack_9c = param_2;
                    uStack_a4 = 0x90ad0e;
                    uStack_a0 = *(uint *)(iStack_58 + 0x10);
                    FUN_009094a0();
                    iVar4 = *DAT_00da9894;
                    if ((iVar4 != 0) && (*(int *)(iVar4 + 0x114) != 0)) {
                      ppppuStack_b0 = *(undefined4 *****)(iVar4 + 0x114);
                      ppppppuStack_98 = appppppuStack_34[0];
                      if (uStack_20 < 8) {
                        ppppppuStack_98 = appppppuStack_34;
                      }
                      puStack_9c = *(undefined1 **)puVar2;
                      uStack_a0 = (uint)param_2 & 0xffff;
                      uStack_a4 = *(undefined4 *)(unaff_EDI[0x17] + 0x38);
                      pcStack_a8 = "%d,%d,%d,%ls";
                      pcStack_ac = "AddPassiveSkill";
                      (*(code *)(*ppppuStack_b0)[1])();
                    }
                    *(int *)puVar2 = *(int *)puVar2 + 1;
                    local_c = local_c & 0xffffff00;
                    if (7 < uStack_20) {
                    /* WARNING: Subroutine does not return */
                      ppppppuStack_98 = (undefined4 ******)0x90ad76;
                      FUN_006f04e0();
                    }
                    uStack_20 = 7;
                    uStack_24 = 0;
                    appppppuStack_34[0] =
                         (undefined4 ******)((uint)appppppuStack_34[0] & 0xffff0000);
                    puVar5 = local_78;
                    goto LAB_0090ad91;
                  }
                }
                local_c = local_c & 0xffffff00;
                if (7 < uStack_20) {
                    /* WARNING: Subroutine does not return */
                  ppppppuStack_98 = (undefined4 ******)0x90acda;
                  FUN_006f04e0();
                }
                uStack_20 = 7;
                uStack_24 = 0;
                appppppuStack_34[0] = (undefined4 ******)((uint)appppppuStack_34[0] & 0xffff0000);
                puVar5 = local_78;
                iVar4 = DAT_00d7c54c;
              }
              else {
LAB_0090ad91:
                iVar4 = DAT_00d7c54c;
                if (2 < *(int *)local_7c) {
                  local_c = 0xffffffff;
                  if (local_70 != (undefined4 *)0x0) {
                    /* WARNING: Subroutine does not return */
                    ppppppuStack_98 = (undefined4 ******)0x90ae22;
                    FUN_006f04e0();
                  }
                  goto LAB_0090ade6;
                }
              }
            }
          }
        }
      }
      local_80 = local_80 + 1;
    } while (local_80 != local_6c);
  }
  local_c = 0xffffffff;
  if (local_70 != (undefined4 *)0x0) {
                    /* WARNING: Subroutine does not return */
    ppppppuStack_98 = (undefined4 ******)0x90add8;
    FUN_006f04e0();
  }
LAB_0090ade6:
  local_c = 0xffffffff;
  uStack_68 = 0;
  local_6c = (undefined4 *)0x0;
  local_70 = (undefined4 *)0x0;
  ExceptionList = local_14;
  __security_check_cookie(local_1c ^ (uint)auStack_88);
  return;
}



============================================================
DISASSEMBLY
============================================================
0090aab0 : PUSH EBP
0090aab1 : MOV EBP,ESP
0090aab3 : AND ESP,0xfffffff8
0090aab6 : PUSH -0x1
0090aab8 : PUSH 0xb2c7b8
0090aabd : MOV EAX,FS:[0x0]
0090aac3 : PUSH EAX
0090aac4 : SUB ESP,0x74
0090aac7 : MOV EAX,[0x00d66fa0]
0090aacc : XOR EAX,ESP
0090aace : MOV dword ptr [ESP + 0x6c],EAX
0090aad2 : PUSH EBX
0090aad3 : PUSH ESI
0090aad4 : MOV EAX,[0x00d66fa0]
0090aad9 : XOR EAX,ESP
0090aadb : PUSH EAX
0090aadc : LEA EAX,[ESP + 0x80]
0090aae3 : MOV FS:[0x0],EAX
0090aae9 : MOV ECX,dword ptr [EDI + 0x5c]
0090aaec : MOV EAX,dword ptr [EBP + 0x10]
0090aaef : MOV EDX,dword ptr [ECX + 0x38]
0090aaf2 : MOV dword ptr [ESP + 0x18],EAX
0090aaf6 : MOV EAX,[0x01724910]
0090aafb : SHL EDX,0x4
0090aafe : LEA EAX,[EDX + EAX*0x1 + 0x24]
0090ab02 : PUSH EAX
0090ab03 : LEA ECX,[ESP + 0x24]
0090ab07 : PUSH ECX
0090ab08 : CALL 0x0047bc90
0090ab0d : MOV dword ptr [ESP + 0x88],0x0
0090ab18 : MOV ECX,dword ptr [ESP + 0x24]
0090ab1c : MOV EAX,ECX
0090ab1e : MOV dword ptr [ESP + 0x14],EAX
0090ab22 : CMP ECX,dword ptr [ESP + 0x28]
0090ab26 : JZ 0x0090adc4
0090ab2c : MOV EBX,dword ptr [0x00d7c54c]
0090ab32 : MOV ESI,dword ptr [EAX]
0090ab34 : MOV EAX,dword ptr [ESI]
0090ab36 : MOV EDX,EAX
0090ab38 : SHR EDX,0x10
0090ab3b : MOV dword ptr [ESP + 0x1c],ESI
0090ab3f : CMP EDX,0x768
0090ab45 : JNZ 0x0090adab
0090ab4b : MOV dword ptr [ESP + 0x10],EAX
0090ab4f : LEA EAX,[ESP + 0x10]
0090ab53 : PUSH EAX
0090ab54 : LEA ECX,[EBX + 0x40]
0090ab57 : LEA EAX,[ESP + 0x3c]
0090ab5b : CALL 0x004437f0
0090ab60 : MOV EAX,dword ptr [EBX + 0x44]
0090ab63 : MOV ECX,dword ptr [ESP + 0x38]
0090ab67 : CMP ECX,EAX
0090ab69 : JZ 0x0090adab
0090ab6f : MOV EAX,dword ptr [ECX + 0x10]
0090ab72 : TEST EAX,EAX
0090ab74 : JZ 0x0090adab
0090ab7a : MOV EDX,dword ptr [EAX + 0x1ea8]
0090ab80 : LEA EBX,[EAX + 0x1ea8]
0090ab86 : MOV EAX,dword ptr [EDX + 0x4]
0090ab89 : MOV ECX,EBX
0090ab8b : MOV dword ptr [ESP + 0x34],EBX
0090ab8f : CALL EAX
0090ab91 : MOV dword ptr [ESP + 0x10],EAX
0090ab95 : TEST EAX,EAX
0090ab97 : JZ 0x0090ada5
0090ab9d : JMP 0x0090aba4
0090aba0 : MOV EBX,dword ptr [ESP + 0x34]
0090aba4 : LEA EDX,[ESP + 0x10]
0090aba8 : MOV EAX,EBX
0090abaa : CALL 0x004f5680
0090abaf : TEST EAX,EAX
0090abb1 : JZ 0x0090ad9a
0090abb7 : MOVZX ECX,word ptr [EAX + 0x4]
0090abbb : MOVZX EDX,word ptr [EAX + 0x6]
0090abbf : SHL ECX,0x10
0090abc2 : OR ECX,EDX
0090abc4 : CMP ECX,dword ptr [EBP + 0x8]
0090abc7 : JNZ 0x0090ad91
0090abcd : MOV EBX,0x7
0090abd2 : XOR EAX,EAX
0090abd4 : MOV dword ptr [ESP + 0x74],EBX
0090abd8 : MOV dword ptr [ESP + 0x70],0x0
0090abe0 : MOV word ptr [ESP + 0x60],AX
0090abe5 : MOV byte ptr [ESP + 0x88],0x1
0090abed : MOV EAX,dword ptr [ESI]
0090abef : MOV EDX,dword ptr [EDI]
0090abf1 : MOV EDX,dword ptr [EDX + 0x58]
0090abf4 : LEA ECX,[ESP + 0x5c]
0090abf8 : PUSH ECX
0090abf9 : PUSH EAX
0090abfa : MOV ECX,EDI
0090abfc : CALL EDX
0090abfe : SUB ESP,0x1c
0090ac01 : MOV ECX,ESP
0090ac03 : MOV dword ptr [ESP + 0x4c],ESP
0090ac07 : XOR EAX,EAX
0090ac09 : PUSH -0x1
0090ac0b : PUSH EAX
0090ac0c : LEA EDX,[ESP + 0x80]
0090ac13 : MOV dword ptr [ECX + 0x18],EBX
0090ac16 : MOV dword ptr [ECX + 0x14],0x0
0090ac1d : PUSH EDX
0090ac1e : MOV word ptr [ECX + 0x4],AX
0090ac22 : CALL 0x00405eb0
0090ac27 : MOV byte ptr [ESP + 0xa4],0x2
0090ac2f : MOV byte ptr [ESP + 0xa4],0x1
0090ac37 : LEA ECX,[ESP + 0x5c]
0090ac3b : CALL 0x008f75f0
0090ac40 : ADD ESP,0x1c
0090ac43 : MOV byte ptr [ESP + 0x88],0x3
0090ac4b : PUSH -0x1
0090ac4d : PUSH 0x0
0090ac4f : PUSH EAX
0090ac50 : LEA ECX,[ESP + 0x68]
0090ac54 : CALL 0x00405eb0
0090ac59 : MOV byte ptr [ESP + 0x88],0x1
0090ac61 : CMP dword ptr [ESP + 0x58],0x8
0090ac66 : JC 0x0090ac71
0090ac68 : MOV ECX,dword ptr [ESP + 0x44]
0090ac6c : CALL 0x006f04e0
0090ac71 : MOV ECX,dword ptr [0x017247f0]
0090ac77 : XOR EAX,EAX
0090ac79 : MOV word ptr [ESP + 0x44],AX
0090ac7e : MOV EAX,dword ptr [ESI]
0090ac80 : MOV dword ptr [ESP + 0x58],EBX
0090ac84 : MOV EBX,dword ptr [ESI + 0x4]
0090ac87 : PUSH EAX
0090ac88 : MOV dword ptr [ESP + 0x58],0x0
0090ac90 : CALL 0x009f2740
0090ac95 : MOV ESI,EAX
0090ac97 : TEST ESI,ESI
0090ac99 : JZ 0x0090acc2
0090ac9b : LEA ECX,[ESP + 0x30]
0090ac9f : PUSH ECX
0090aca0 : LEA ECX,[ESI + 0x8]
0090aca3 : LEA EAX,[ESP + 0x40]
0090aca7 : MOV dword ptr [ESP + 0x34],EBX
0090acab : CALL 0x004437f0
0090acb0 : MOV ESI,dword ptr [ESI + 0xc]
0090acb3 : MOV EAX,dword ptr [ESP + 0x3c]
0090acb7 : CMP EAX,ESI
0090acb9 : JZ 0x0090acc2
0090acbb : MOV EAX,dword ptr [EAX + 0x10]
0090acbe : TEST EAX,EAX
0090acc0 : JNZ 0x0090acfa
0090acc2 : MOV byte ptr [ESP + 0x88],0x0
0090acca : CMP dword ptr [ESP + 0x74],0x8
0090accf : JC 0x0090acda
0090acd1 : MOV ECX,dword ptr [ESP + 0x60]
0090acd5 : CALL 0x006f04e0
0090acda : MOV ESI,dword ptr [ESP + 0x1c]
0090acde : XOR EDX,EDX
0090ace0 : MOV dword ptr [ESP + 0x74],0x7
0090ace8 : MOV dword ptr [ESP + 0x70],0x0
0090acf0 : MOV word ptr [ESP + 0x60],DX
0090acf5 : JMP 0x0090ad9a
0090acfa : MOV ESI,dword ptr [ESP + 0x18]
0090acfe : MOVZX ECX,word ptr [ESI]
0090ad01 : MOV EBX,dword ptr [EBP + 0xc]
0090ad04 : PUSH ECX
0090ad05 : PUSH EBX
0090ad06 : PUSH EAX
0090ad07 : MOV ECX,EDI
0090ad09 : CALL 0x009094a0
0090ad0e : MOV EDX,dword ptr [0x00da9894]
0090ad14 : MOV EAX,dword ptr [EDX]
0090ad16 : TEST EAX,EAX
0090ad18 : JZ 0x0090ad5c
0090ad1a : CMP dword ptr [EAX + 0x114],0x0
0090ad21 : JZ 0x0090ad5c
0090ad23 : CMP dword ptr [ESP + 0x74],0x8
0090ad28 : MOV EAX,dword ptr [EAX + 0x114]
0090ad2e : MOV ECX,dword ptr [ESP + 0x60]
0090ad32 : JNC 0x0090ad38
0090ad34 : LEA ECX,[ESP + 0x60]
0090ad38 : MOV EDX,dword ptr [EAX]
0090ad3a : MOV EDX,dword ptr [EDX + 0x4]
0090ad3d : PUSH ECX
0090ad3e : MOV ECX,dword ptr [ESI]
0090ad40 : PUSH ECX
0090ad41 : MOVZX ECX,BX
0090ad44 : PUSH ECX
0090ad45 : MOV ECX,dword ptr [EDI + 0x5c]
0090ad48 : MOV ECX,dword ptr [ECX + 0x38]
0090ad4b : PUSH ECX
0090ad4c : PUSH 0xc64f68
0090ad51 : PUSH 0xc64f78
0090ad56 : PUSH EAX
0090ad57 : CALL EDX
0090ad59 : ADD ESP,0x1c
0090ad5c : INC dword ptr [ESI]
0090ad5e : MOV byte ptr [ESP + 0x88],0x0
0090ad66 : CMP dword ptr [ESP + 0x74],0x8
0090ad6b : JC 0x0090ad76
0090ad6d : MOV ECX,dword ptr [ESP + 0x60]
0090ad71 : CALL 0x006f04e0
0090ad76 : MOV ESI,dword ptr [ESP + 0x1c]
0090ad7a : XOR EAX,EAX
0090ad7c : MOV dword ptr [ESP + 0x74],0x7
0090ad84 : MOV dword ptr [ESP + 0x70],0x0
0090ad8c : MOV word ptr [ESP + 0x60],AX
0090ad91 : MOV ECX,dword ptr [ESP + 0x18]
0090ad95 : CMP dword ptr [ECX],0x2
0090ad98 : JG 0x0090ae08
0090ad9a : CMP dword ptr [ESP + 0x10],0x0
0090ad9f : JNZ 0x0090aba0
0090ada5 : MOV EBX,dword ptr [0x00d7c54c]
0090adab : MOV EAX,dword ptr [ESP + 0x14]
0090adaf : ADD EAX,0x4
0090adb2 : MOV dword ptr [ESP + 0x14],EAX
0090adb6 : CMP EAX,dword ptr [ESP + 0x28]
0090adba : JNZ 0x0090ab32
0090adc0 : MOV ECX,dword ptr [ESP + 0x24]
0090adc4 : MOV dword ptr [ESP + 0x88],0xffffffff
0090adcf : TEST ECX,ECX
0090add1 : JZ 0x0090add8
0090add3 : CALL 0x006f04e0
0090add8 : XOR EAX,EAX
0090adda : MOV dword ptr [ESP + 0x24],EAX
0090adde : MOV dword ptr [ESP + 0x28],EAX
0090ade2 : MOV dword ptr [ESP + 0x2c],EAX
0090ade6 : MOV ECX,dword ptr [ESP + 0x80]
0090aded : MOV dword ptr FS:[0x0],ECX
0090adf4 : POP ECX
0090adf5 : POP ESI
0090adf6 : POP EBX
0090adf7 : MOV ECX,dword ptr [ESP + 0x6c]
0090adfb : XOR ECX,ESP
0090adfd : CALL 0x00633e6b
0090ae02 : MOV ESP,EBP
0090ae04 : POP EBP
0090ae05 : RET 0xc
0090ae08 : MOV dword ptr [ESP + 0x88],0xffffffff
0090ae13 : MOV ECX,dword ptr [ESP + 0x24]
0090ae17 : XOR ESI,ESI
0090ae19 : CMP ECX,ESI
0090ae1b : JZ 0x0090ae22
0090ae1d : CALL 0x006f04e0
0090ae22 : MOV dword ptr [ESP + 0x24],ESI
0090ae26 : MOV dword ptr [ESP + 0x28],ESI
0090ae2a : MOV dword ptr [ESP + 0x2c],ESI
0090ae2e : JMP 0x0090ade6
