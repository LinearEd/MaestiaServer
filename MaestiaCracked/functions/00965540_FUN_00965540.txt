PROGRAM  : Maestia.exe
FUNCTION : FUN_00965540
ENTRY    : 00965540
BODY     : [[00965540, 0096578f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00965540(int param_1,int param_2,int param_3,int param_4,int param_5)

{
  ushort uVar1;
  undefined4 *puVar2;
  char cVar3;
  int iVar4;
  short sVar5;
  int iVar6;
  int *piVar7;
  
  piVar7 = DAT_00da9894;
  if (*(short *)(param_1 + 0x7e) != 1) {
    *(undefined2 *)(param_1 + 0x7e) = 1;
    if ((*piVar7 != 0) && (piVar7 = *(int **)(*piVar7 + 0x114), piVar7 != (int *)0x0)) {
      (**(code **)(*piVar7 + 4))(piVar7,"SetNowPage",&DAT_00c7a694,1);
    }
  }
  *(undefined2 *)(param_1 + 0x74) = 0;
  (**(code **)(**(int **)(param_1 + 0x38) + 0x80))();
  *(short *)(param_1 + 0x8a) = (short)param_2;
  if (*(int *)(*(int *)(param_1 + 0x38) + 0x3c) == 0) {
    FUN_008018d0(L"[AvaGuiNpcShop::ChangeCategory] ( m_pShopGrid->GetGridContainer() ) Is NULL");
    return;
  }
  if ((((param_2 == 0) && ((char)param_3 == '\0')) && (param_4 == 0)) && (param_5 == 0)) {
    param_3 = *(int *)(param_1 + 0x44);
    if (param_3 != *(int *)(param_1 + 0x48)) {
      do {
        *(short *)(param_1 + 0x74) = *(short *)(param_1 + 0x74) + 1;
        FUN_00907d60(&param_2);
        iVar4 = param_3;
        (**(code **)(**(int **)(param_1 + 0x38) + 0x70))
                  (*(undefined4 *)(param_3 + 4),param_5,param_2);
        param_3 = iVar4 + 8;
      } while (param_3 != *(int *)(param_1 + 0x48));
    }
  }
  else {
    piVar7 = *(int **)(param_1 + 0x44);
    if (piVar7 != *(int **)(param_1 + 0x48)) {
      do {
        if ((((param_2 < 1) || (*piVar7 == param_2)) &&
            (((char)param_3 == '\0' || (cVar3 = FUN_00962630(param_1,*piVar7), cVar3 != '\0')))) &&
           (cVar3 = FUN_00962300(param_3,param_4,param_5), cVar3 != '\0')) {
          uVar1 = *(ushort *)(param_1 + 0x74);
          *(ushort *)(param_1 + 0x74) = uVar1 + 1;
          iVar4 = (*(int **)(param_1 + 0x38))[0xf];
          if (*(int *)(iVar4 + 0xc) == 0) {
            iVar4 = -1;
            iVar6 = -1;
          }
          else {
            iVar6 = *(int *)(iVar4 + 0xc);
            iVar4 = (int)((longlong)(ulonglong)(uint)uVar1 / (longlong)iVar6);
            iVar6 = (uint)uVar1 - iVar6 * iVar4;
          }
          (**(code **)(**(int **)(param_1 + 0x38) + 0x70))(piVar7[1],iVar6,iVar4);
        }
        piVar7 = piVar7 + 2;
      } while (piVar7 != *(int **)(param_1 + 0x48));
    }
  }
  piVar7 = DAT_00da9894;
  sVar5 = 1;
  if (*(ushort *)(param_1 + 0x74) != 0) {
    sVar5 = (short)((int)(*(ushort *)(param_1 + 0x74) - 1) / 10) + 1;
  }
  if (sVar5 == 0) {
    sVar5 = 1;
  }
  if (sVar5 != *(short *)(param_1 + 0x7c)) {
    *(short *)(param_1 + 0x7c) = sVar5;
    if ((*piVar7 != 0) && (piVar7 = *(int **)(*piVar7 + 0x114), piVar7 != (int *)0x0)) {
      (**(code **)(*piVar7 + 4))(piVar7,"SetTotalPage",&DAT_00c7a680,sVar5);
    }
  }
  FUN_00425530(*(int *)(param_1 + 0x44),*(int *)(param_1 + 0x48),
               *(int *)(param_1 + 0x48) - *(int *)(param_1 + 0x44) >> 3,FUN_00961f00);
  if ((*DAT_00da9894 != 0) &&
     (puVar2 = *(undefined4 **)(*DAT_00da9894 + 0x114), puVar2 != (undefined4 *)0x0)) {
    (**(code **)*puVar2)("ShopInitialize");
  }
  FUN_009646d0(param_1);
  return;
}



============================================================
DISASSEMBLY
============================================================
00965540 : PUSH EBP
00965541 : MOV EBP,ESP
00965543 : PUSH EBX
00965544 : MOV EBX,dword ptr [EBP + 0x8]
00965547 : MOV EAX,0x1
0096554c : PUSH ESI
0096554d : PUSH EDI
0096554e : CMP AX,word ptr [EBX + 0x7e]
00965552 : JZ 0x00965587
00965554 : MOV EDX,dword ptr [0x00da9894]
0096555a : MOV ECX,EAX
0096555c : MOV word ptr [EBX + 0x7e],CX
00965560 : MOV EAX,dword ptr [EDX]
00965562 : TEST EAX,EAX
00965564 : JZ 0x00965587
00965566 : MOV EAX,dword ptr [EAX + 0x114]
0096556c : TEST EAX,EAX
0096556e : JZ 0x00965587
00965570 : MOV ECX,dword ptr [EAX]
00965572 : MOV EDX,dword ptr [ECX + 0x4]
00965575 : PUSH 0x1
00965577 : PUSH 0xc7a694
0096557c : PUSH 0xc7a698
00965581 : PUSH EAX
00965582 : CALL EDX
00965584 : ADD ESP,0x10
00965587 : MOV ECX,dword ptr [EBX + 0x38]
0096558a : XOR EAX,EAX
0096558c : MOV word ptr [EBX + 0x74],AX
00965590 : MOV EDX,dword ptr [ECX]
00965592 : MOV EAX,dword ptr [EDX + 0x80]
00965598 : CALL EAX
0096559a : MOV EAX,dword ptr [EBP + 0xc]
0096559d : MOV ECX,dword ptr [EBX + 0x38]
009655a0 : MOV word ptr [EBX + 0x8a],AX
009655a7 : CMP dword ptr [ECX + 0x3c],0x0
009655ab : JNZ 0x009655c7
009655ad : MOV ESI,dword ptr [0x00da98e8]
009655b3 : PUSH 0xc7abb8
009655b8 : CALL 0x008018d0
009655bd : ADD ESP,0x4
009655c0 : POP EDI
009655c1 : POP ESI
009655c2 : POP EBX
009655c3 : POP EBP
009655c4 : RET 0x14
009655c7 : TEST EAX,EAX
009655c9 : JNZ 0x00965637
009655cb : CMP byte ptr [EBP + 0x10],AL
009655ce : JNZ 0x00965637
009655d0 : CMP dword ptr [EBP + 0x14],EAX
009655d3 : JNZ 0x00965637
009655d5 : CMP dword ptr [EBP + 0x18],EAX
009655d8 : JNZ 0x00965637
009655da : MOV EAX,dword ptr [EBX + 0x44]
009655dd : MOV dword ptr [EBP + 0x10],EAX
009655e0 : CMP EAX,dword ptr [EBX + 0x48]
009655e3 : JZ 0x009656d5
009655e9 : LEA ESP,[ESP]
009655f0 : MOVZX EAX,word ptr [EBX + 0x74]
009655f4 : MOVZX ECX,AX
009655f7 : INC EAX
009655f8 : MOV word ptr [EBX + 0x74],AX
009655fc : MOV EAX,dword ptr [EBX + 0x38]
009655ff : MOV ESI,dword ptr [EAX + 0x3c]
00965602 : LEA EDX,[EBP + 0xc]
00965605 : PUSH EDX
00965606 : LEA EDI,[EBP + 0x18]
00965609 : CALL 0x00907d60
0096560e : MOV EDX,dword ptr [EBP + 0xc]
00965611 : MOV ECX,dword ptr [EBX + 0x38]
00965614 : MOV ESI,dword ptr [EBP + 0x10]
00965617 : MOV EAX,dword ptr [ECX]
00965619 : MOV EAX,dword ptr [EAX + 0x70]
0096561c : PUSH EDX
0096561d : MOV EDX,dword ptr [EBP + 0x18]
00965620 : PUSH EDX
00965621 : MOV EDX,dword ptr [ESI + 0x4]
00965624 : PUSH EDX
00965625 : CALL EAX
00965627 : ADD ESI,0x8
0096562a : MOV dword ptr [EBP + 0x10],ESI
0096562d : CMP ESI,dword ptr [EBX + 0x48]
00965630 : JNZ 0x009655f0
00965632 : JMP 0x009656d5
00965637 : MOV EDI,dword ptr [EBX + 0x44]
0096563a : MOV dword ptr [EBP + 0x8],EDI
0096563d : CMP EDI,dword ptr [EBX + 0x48]
00965640 : JZ 0x009656d5
00965646 : JMP 0x0096564b
00965648 : MOV EAX,dword ptr [EBP + 0xc]
0096564b : TEST EAX,EAX
0096564d : JLE 0x00965653
0096564f : CMP dword ptr [EDI],EAX
00965651 : JNZ 0x009656c6
00965653 : CMP byte ptr [EBP + 0x10],0x0
00965657 : JZ 0x00965669
00965659 : MOV ECX,dword ptr [EDI]
0096565b : MOV ESI,dword ptr [EDI + 0x4]
0096565e : PUSH ECX
0096565f : PUSH EBX
00965660 : CALL 0x00962630
00965665 : TEST AL,AL
00965667 : JZ 0x009656c6
00965669 : MOV EDX,dword ptr [EBP + 0x18]
0096566c : MOV EAX,dword ptr [EBP + 0x14]
0096566f : MOV ECX,dword ptr [EBP + 0x10]
00965672 : PUSH EDX
00965673 : PUSH EAX
00965674 : MOV EAX,dword ptr [EDI + 0x4]
00965677 : PUSH ECX
00965678 : CALL 0x00962300
0096567d : TEST AL,AL
0096567f : JZ 0x009656c6
00965681 : MOVZX EAX,word ptr [EBX + 0x74]
00965685 : MOV EDI,dword ptr [EBX + 0x38]
00965688 : MOVZX ESI,AX
0096568b : INC EAX
0096568c : MOV word ptr [EBX + 0x74],AX
00965690 : MOV EAX,dword ptr [EDI + 0x3c]
00965693 : TEST ESI,ESI
00965695 : JL 0x009656ac
00965697 : CMP dword ptr [EAX + 0xc],0x0
0096569b : JZ 0x009656ac
0096569d : MOV ECX,dword ptr [EAX + 0xc]
009656a0 : MOV EAX,ESI
009656a2 : CDQ
009656a3 : IDIV ECX
009656a5 : IMUL ECX,EAX
009656a8 : SUB ESI,ECX
009656aa : JMP 0x009656b1
009656ac : OR EAX,0xffffffff
009656af : OR ESI,EAX
009656b1 : MOV EDX,dword ptr [EDI]
009656b3 : MOV EDX,dword ptr [EDX + 0x70]
009656b6 : PUSH EAX
009656b7 : MOV EAX,dword ptr [EBP + 0x8]
009656ba : MOV ECX,dword ptr [EAX + 0x4]
009656bd : PUSH ESI
009656be : PUSH ECX
009656bf : MOV ECX,EDI
009656c1 : CALL EDX
009656c3 : MOV EDI,dword ptr [EBP + 0x8]
009656c6 : ADD EDI,0x8
009656c9 : MOV dword ptr [EBP + 0x8],EDI
009656cc : CMP EDI,dword ptr [EBX + 0x48]
009656cf : JNZ 0x00965648
009656d5 : MOVZX ECX,word ptr [EBX + 0x74]
009656d9 : MOV EAX,0x1
009656de : TEST CX,CX
009656e1 : JBE 0x009656fd
009656e3 : MOVZX ECX,CX
009656e6 : DEC ECX
009656e7 : MOV EAX,0x66666667
009656ec : IMUL ECX
009656ee : SAR EDX,0x2
009656f1 : MOV EAX,EDX
009656f3 : SHR EAX,0x1f
009656f6 : LEA ECX,[EDX + EAX*0x1 + 0x1]
009656fa : MOVZX EAX,CX
009656fd : MOVZX ECX,AX
00965700 : CMP AX,0x1
00965704 : JNC 0x0096570b
00965706 : MOV ECX,0x1
0096570b : CMP CX,word ptr [EBX + 0x7c]
0096570f : JZ 0x00965744
00965711 : MOV EDX,dword ptr [0x00da9894]
00965717 : MOV word ptr [EBX + 0x7c],CX
0096571b : MOV EAX,dword ptr [EDX]
0096571d : TEST EAX,EAX
0096571f : JZ 0x00965744
00965721 : MOV EAX,dword ptr [EAX + 0x114]
00965727 : TEST EAX,EAX
00965729 : JZ 0x00965744
0096572b : MOV EDX,dword ptr [EAX]
0096572d : MOV EDX,dword ptr [EDX + 0x4]
00965730 : MOVZX ECX,CX
00965733 : PUSH ECX
00965734 : PUSH 0xc7a680
00965739 : PUSH 0xc7a684
0096573e : PUSH EAX
0096573f : CALL EDX
00965741 : ADD ESP,0x10
00965744 : MOV EAX,dword ptr [EBX + 0x48]
00965747 : MOV ECX,dword ptr [EBX + 0x44]
0096574a : MOV EDX,EAX
0096574c : SUB EDX,ECX
0096574e : PUSH 0x961f00
00965753 : SAR EDX,0x3
00965756 : PUSH EDX
00965757 : PUSH EAX
00965758 : PUSH ECX
00965759 : CALL 0x00425530
0096575e : MOV EAX,[0x00da9894]
00965763 : MOV EAX,dword ptr [EAX]
00965765 : ADD ESP,0x10
00965768 : TEST EAX,EAX
0096576a : JZ 0x00965783
0096576c : MOV EAX,dword ptr [EAX + 0x114]
00965772 : TEST EAX,EAX
00965774 : JZ 0x00965783
00965776 : MOV EDX,dword ptr [EAX]
00965778 : MOV ECX,EAX
0096577a : MOV EAX,dword ptr [EDX]
0096577c : PUSH 0xc7a3d0
00965781 : CALL EAX
00965783 : PUSH EBX
00965784 : CALL 0x009646d0
00965789 : POP EDI
0096578a : POP ESI
0096578b : POP EBX
0096578c : POP EBP
0096578d : RET 0x14
