PROGRAM  : Maestia.exe
FUNCTION : FUN_006f3fa0
ENTRY    : 006f3fa0
BODY     : [[006f3fa0, 006f4239]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_006f3fa0(void)

{
  uint uVar1;
  uint uVar2;
  byte *pbVar3;
  LONG LVar4;
  int in_ECX;
  int iVar5;
  int unaff_EDI;
  undefined4 uVar6;
  LPCRITICAL_SECTION local_2c;
  char *local_28;
  undefined4 local_24;
  int local_20;
  undefined4 local_1c;
  undefined4 local_18;
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b4760e;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  if (in_ECX == 0) {
    uVar6 = 0xe0;
  }
  else {
    local_2c = (LPCRITICAL_SECTION)(unaff_EDI + 0xf60);
    local_18 = 0xff;
    local_20 = 0;
    local_28 = ".\\AvSocket.cpp";
    local_24 = 0x4e1;
    local_1c = 1;
    FUN_006ef1a0(&local_2c);
    local_8 = 0;
    if (*(int *)(unaff_EDI + 0xee0) == -1) {
      local_8 = 0xffffffff;
      if (local_20 == 0) {
        ExceptionList = local_10;
        return;
      }
      LeaveCriticalSection(local_2c);
      ExceptionList = local_10;
      return;
    }
    if (*(int *)(unaff_EDI + 0xedc) == 0) {
      pbVar3 = (byte *)(*(int *)(unaff_EDI + 0xfe0) + 0xfec + unaff_EDI);
      for (iVar5 = in_ECX; iVar5 != 0; iVar5 = iVar5 + -1) {
        *pbVar3 = *pbVar3 ^ *(byte *)((uint)*(byte *)(unaff_EDI + 0x2404) +
                                     *(int *)(unaff_EDI + 0x23fc));
        *(char *)(unaff_EDI + 0x2404) = *(char *)(unaff_EDI + 0x2404) + '\x01';
        pbVar3 = pbVar3 + 1;
      }
    }
    *(int *)(unaff_EDI + 0xfe0) = *(int *)(unaff_EDI + 0xfe0) + in_ECX;
    local_14 = 0;
    iVar5 = FUN_006f3bd0(&local_14);
    if (local_14 != 0) {
      if (local_20 != 0) {
        LeaveCriticalSection(local_2c);
        local_20 = 0;
      }
      iVar5 = local_20;
      FUN_006f2e90(0xe4);
      local_8 = 0xffffffff;
      if (iVar5 == 0) {
        ExceptionList = local_10;
        return;
      }
      LeaveCriticalSection(local_2c);
      ExceptionList = local_10;
      return;
    }
    uVar1 = *(uint *)(unaff_EDI + 0xfe4);
    if (uVar1 != 0) {
      uVar2 = *(uint *)(unaff_EDI + 0xfe0);
      if (uVar2 == uVar1) {
        *(undefined4 *)(unaff_EDI + 0xfe0) = 0;
      }
      else {
        if (uVar2 <= uVar1) {
          FUN_006ef0f0();
          FUN_006f2e90(0xe4);
          local_8 = 0xffffffff;
          FUN_006ef180();
          ExceptionList = local_10;
          return;
        }
        _memmove((void *)(unaff_EDI + 0xfec),(void *)(uVar1 + 0xfec + unaff_EDI),uVar2 - uVar1);
        FUN_006ee470(L"READ SHIFT IS OCCURED %d,%d\n",*(undefined4 *)(unaff_EDI + 0xfe0),
                     *(undefined4 *)(unaff_EDI + 0xfe4));
        *(int *)(unaff_EDI + 0xfe0) = *(int *)(unaff_EDI + 0xfe0) - *(int *)(unaff_EDI + 0xfe4);
      }
      *(undefined4 *)(unaff_EDI + 0xfe4) = 0;
    }
    if ((*(int *)(unaff_EDI + 0xec4) != 0) && (iVar5 != 0)) {
      iVar5 = FUN_006f2640();
      while (iVar5 != 0) {
        if (*(int **)(unaff_EDI + 0x23f8) != (int *)0x0) {
          (**(code **)(**(int **)(unaff_EDI + 0x23f8) + 0xc))();
        }
        LVar4 = InterlockedDecrement((LONG *)(iVar5 + 4));
        if ((LVar4 == 0) && (iVar5 != 0)) {
          if (*(int *)(iVar5 + 8) == 0) {
            *(undefined4 *)(iVar5 + 8) = 0;
                    /* WARNING: Subroutine does not return */
            FUN_006f04e0();
          }
                    /* WARNING: Subroutine does not return */
          FUN_006f04e0();
        }
        iVar5 = FUN_006f2640();
      }
    }
    iVar5 = FUN_006f2ca0(&local_18);
    local_8 = 0xffffffff;
    if (local_20 != 0) {
      LeaveCriticalSection(local_2c);
      local_20 = 0;
    }
    uVar6 = local_18;
    if (iVar5 != 0) {
      ExceptionList = local_10;
      return;
    }
  }
  FUN_006f2e90(uVar6);
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
006f3fa0 : PUSH EBP
006f3fa1 : MOV EBP,ESP
006f3fa3 : PUSH -0x1
006f3fa5 : PUSH 0xb4760e
006f3faa : MOV EAX,FS:[0x0]
006f3fb0 : PUSH EAX
006f3fb1 : SUB ESP,0x1c
006f3fb4 : PUSH EBX
006f3fb5 : PUSH ESI
006f3fb6 : MOV EAX,[0x00d66fa0]
006f3fbb : XOR EAX,EBP
006f3fbd : PUSH EAX
006f3fbe : LEA EAX,[EBP + -0xc]
006f3fc1 : MOV FS:[0x0],EAX
006f3fc7 : MOV ESI,ECX
006f3fc9 : XOR EBX,EBX
006f3fcb : CMP ESI,EBX
006f3fcd : JNZ 0x006f3fd9
006f3fcf : PUSH 0xe0
006f3fd4 : JMP 0x006f41a9
006f3fd9 : LEA ECX,[EBP + -0x28]
006f3fdc : LEA EAX,[EDI + 0xf60]
006f3fe2 : PUSH ECX
006f3fe3 : MOV dword ptr [EBP + -0x14],0xff
006f3fea : MOV dword ptr [EBP + -0x1c],EBX
006f3fed : MOV dword ptr [EBP + -0x28],EAX
006f3ff0 : MOV dword ptr [EBP + -0x24],0xbf6f24
006f3ff7 : MOV dword ptr [EBP + -0x20],0x4e1
006f3ffe : MOV dword ptr [EBP + -0x18],0x1
006f4005 : CALL 0x006ef1a0
006f400a : MOV dword ptr [EBP + -0x4],EBX
006f400d : OR EAX,0xffffffff
006f4010 : CMP dword ptr [EDI + 0xee0],EAX
006f4016 : JNZ 0x006f4042
006f4018 : MOV dword ptr [EBP + -0x4],EAX
006f401b : CMP dword ptr [EBP + -0x1c],EBX
006f401e : JZ 0x006f41b0
006f4024 : MOV EDX,dword ptr [EBP + -0x28]
006f4027 : PUSH EDX
006f4028 : CALL dword ptr [0x00b8511c]
006f402e : MOV dword ptr [EBP + -0x1c],EBX
006f4031 : MOV ECX,dword ptr [EBP + -0xc]
006f4034 : MOV dword ptr FS:[0x0],ECX
006f403b : POP ECX
006f403c : POP ESI
006f403d : POP EBX
006f403e : MOV ESP,EBP
006f4040 : POP EBP
006f4041 : RET
006f4042 : CMP dword ptr [EDI + 0xedc],EBX
006f4048 : JNZ 0x006f4080
006f404a : MOV EAX,dword ptr [EDI + 0xfe0]
006f4050 : LEA EAX,[EAX + EDI*0x1 + 0xfec]
006f4057 : CMP ESI,EBX
006f4059 : JBE 0x006f4080
006f405b : MOV ECX,ESI
006f405d : LEA ECX,[ECX]
006f4060 : MOVZX EDX,byte ptr [EDI + 0x2404]
006f4067 : MOV EBX,dword ptr [EDI + 0x23fc]
006f406d : MOV DL,byte ptr [EDX + EBX*0x1]
006f4070 : XOR byte ptr [EAX],DL
006f4072 : INC byte ptr [EDI + 0x2404]
006f4078 : INC EAX
006f4079 : SUB ECX,0x1
006f407c : JNZ 0x006f4060
006f407e : XOR EBX,EBX
006f4080 : ADD dword ptr [EDI + 0xfe0],ESI
006f4086 : LEA EAX,[EBP + -0x10]
006f4089 : PUSH EAX
006f408a : MOV EAX,EDI
006f408c : MOV dword ptr [EBP + -0x10],EBX
006f408f : CALL 0x006f3bd0
006f4094 : MOV ESI,EAX
006f4096 : CMP dword ptr [EBP + -0x10],EBX
006f4099 : JZ 0x006f40ee
006f409b : MOV EBX,dword ptr [EBP + -0x1c]
006f409e : TEST EBX,EBX
006f40a0 : JZ 0x006f40b1
006f40a2 : MOV ECX,dword ptr [EBP + -0x28]
006f40a5 : PUSH ECX
006f40a6 : CALL dword ptr [0x00b8511c]
006f40ac : XOR EBX,EBX
006f40ae : MOV dword ptr [EBP + -0x1c],EBX
006f40b1 : PUSH 0xe4
006f40b6 : MOV ESI,EDI
006f40b8 : CALL 0x006f2e90
006f40bd : MOV dword ptr [EBP + -0x4],0xffffffff
006f40c4 : TEST EBX,EBX
006f40c6 : JZ 0x006f41b0
006f40cc : MOV EDX,dword ptr [EBP + -0x28]
006f40cf : PUSH EDX
006f40d0 : CALL dword ptr [0x00b8511c]
006f40d6 : MOV dword ptr [EBP + -0x1c],0x0
006f40dd : MOV ECX,dword ptr [EBP + -0xc]
006f40e0 : MOV dword ptr FS:[0x0],ECX
006f40e7 : POP ECX
006f40e8 : POP ESI
006f40e9 : POP EBX
006f40ea : MOV ESP,EBP
006f40ec : POP EBP
006f40ed : RET
006f40ee : MOV ECX,dword ptr [EDI + 0xfe4]
006f40f4 : CMP ECX,EBX
006f40f6 : JBE 0x006f4112
006f40f8 : MOV EAX,dword ptr [EDI + 0xfe0]
006f40fe : CMP EAX,ECX
006f4100 : JNZ 0x006f41c1
006f4106 : MOV dword ptr [EDI + 0xfe0],EBX
006f410c : MOV dword ptr [EDI + 0xfe4],EBX
006f4112 : CMP dword ptr [EDI + 0xec4],EBX
006f4118 : JZ 0x006f417b
006f411a : CMP ESI,EBX
006f411c : JZ 0x006f417b
006f411e : MOV ECX,EDI
006f4120 : CALL 0x006f2640
006f4125 : MOV ESI,EAX
006f4127 : TEST ESI,ESI
006f4129 : JZ 0x006f4179
006f412b : MOV EBX,dword ptr [0x00b851b0]
006f4131 : MOV ECX,dword ptr [EDI + 0x23f8]
006f4137 : TEST ECX,ECX
006f4139 : JZ 0x006f4144
006f413b : MOV EDX,dword ptr [ECX]
006f413d : MOV EAX,dword ptr [EDX + 0xc]
006f4140 : PUSH ESI
006f4141 : PUSH EDI
006f4142 : CALL EAX
006f4144 : LEA ECX,[ESI + 0x4]
006f4147 : PUSH ECX
006f4148 : CALL EBX
006f414a : TEST EAX,EAX
006f414c : JNZ 0x006f416c
006f414e : TEST ESI,ESI
006f4150 : JZ 0x006f416c
006f4152 : MOV ECX,dword ptr [ESI + 0x8]
006f4155 : TEST ECX,ECX
006f4157 : JZ 0x006f415e
006f4159 : CALL 0x006f04e0
006f415e : MOV ECX,ESI
006f4160 : MOV dword ptr [ESI + 0x8],0x0
006f4167 : CALL 0x006f04e0
006f416c : MOV ECX,EDI
006f416e : CALL 0x006f2640
006f4173 : MOV ESI,EAX
006f4175 : TEST ESI,ESI
006f4177 : JNZ 0x006f4131
006f4179 : XOR EBX,EBX
006f417b : LEA EDX,[EBP + -0x14]
006f417e : PUSH EDX
006f417f : MOV ECX,EDI
006f4181 : CALL 0x006f2ca0
006f4186 : MOV ESI,EAX
006f4188 : MOV dword ptr [EBP + -0x4],0xffffffff
006f418f : CMP dword ptr [EBP + -0x1c],EBX
006f4192 : JZ 0x006f41a1
006f4194 : MOV EAX,dword ptr [EBP + -0x28]
006f4197 : PUSH EAX
006f4198 : CALL dword ptr [0x00b8511c]
006f419e : MOV dword ptr [EBP + -0x1c],EBX
006f41a1 : CMP ESI,EBX
006f41a3 : JNZ 0x006f41b0
006f41a5 : MOV ECX,dword ptr [EBP + -0x14]
006f41a8 : PUSH ECX
006f41a9 : MOV ESI,EDI
006f41ab : CALL 0x006f2e90
006f41b0 : MOV ECX,dword ptr [EBP + -0xc]
006f41b3 : MOV dword ptr FS:[0x0],ECX
006f41ba : POP ECX
006f41bb : POP ESI
006f41bc : POP EBX
006f41bd : MOV ESP,EBP
006f41bf : POP EBP
006f41c0 : RET
006f41c1 : JBE 0x006f4206
006f41c3 : SUB EAX,ECX
006f41c5 : PUSH EAX
006f41c6 : LEA EAX,[ECX + EDI*0x1 + 0xfec]
006f41cd : PUSH EAX
006f41ce : LEA ECX,[EDI + 0xfec]
006f41d4 : PUSH ECX
006f41d5 : CALL 0x00636880
006f41da : MOV EDX,dword ptr [EDI + 0xfe4]
006f41e0 : MOV EAX,dword ptr [EDI + 0xfe0]
006f41e6 : PUSH EDX
006f41e7 : PUSH EAX
006f41e8 : PUSH 0xbf634c
006f41ed : CALL 0x006ee470
006f41f2 : MOV ECX,dword ptr [EDI + 0xfe4]
006f41f8 : ADD ESP,0x18
006f41fb : SUB dword ptr [EDI + 0xfe0],ECX
006f4201 : JMP 0x006f410c
006f4206 : LEA ESI,[EBP + -0x28]
006f4209 : CALL 0x006ef0f0
006f420e : PUSH 0xe4
006f4213 : MOV ESI,EDI
006f4215 : CALL 0x006f2e90
006f421a : MOV dword ptr [EBP + -0x4],0xffffffff
006f4221 : LEA ESI,[EBP + -0x28]
006f4224 : CALL 0x006ef180
006f4229 : MOV ECX,dword ptr [EBP + -0xc]
006f422c : MOV dword ptr FS:[0x0],ECX
006f4233 : POP ECX
006f4234 : POP ESI
006f4235 : POP EBX
006f4236 : MOV ESP,EBP
006f4238 : POP EBP
006f4239 : RET
