PROGRAM  : Maestia.exe
FUNCTION : FUN_005ba9c0
ENTRY    : 005ba9c0
BODY     : [[005ba9c0, 005bab23]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005ba9c0(int param_1,int param_2,int param_3,uint param_4)

{
  uint *puVar1;
  undefined1 *puVar2;
  uint uVar3;
  int iVar4;
  int iVar5;
  int iVar6;
  LONG LVar7;
  int in_ECX;
  uint uVar8;
  undefined4 local_8;
  uint local_4;
  
  uVar3 = param_4;
  if (param_2 != 0) {
    FUN_0051b6e0();
    FUN_0051fc70(&param_4);
    iVar6 = FUN_005b9c60(&param_4);
    if ((iVar6 == 0) || ((undefined4 *)(iVar6 + 4) == (undefined4 *)0x0)) {
      local_8 = param_3;
      local_4 = uVar3;
      FUN_005ba940(&param_4,&local_8);
    }
    else {
      *(undefined4 *)(iVar6 + 4) = param_3;
      *(uint *)(iVar6 + 8) = uVar3;
    }
    uVar8 = param_4 & 0xfffffffc;
    LVar7 = InterlockedExchangeAdd((LONG *)(uVar8 + 4),-1);
    if (LVar7 == 1) {
      FUN_00515cf0(uVar8);
    }
  }
  *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + 0x10;
  puVar1 = (uint *)(param_1 + 8);
  if (*(uint *)(param_1 + 0x10) <= *(uint *)(param_1 + 8)) {
    FUN_00504050();
  }
  puVar2 = (undefined1 *)*puVar1;
  if (puVar2 != (undefined1 *)0x0) {
    *puVar2 = 4;
    *(uint *)(puVar2 + 4) = uVar3;
  }
  *puVar1 = *puVar1 + 0x10;
  if (*(uint *)(param_1 + 0x10) <= *puVar1) {
    FUN_00504050();
  }
  puVar2 = (undefined1 *)*puVar1;
  if (puVar2 != (undefined1 *)0x0) {
    *puVar2 = 4;
    *(int *)(puVar2 + 4) = param_3;
  }
  *puVar1 = *puVar1 + 0x10;
  if (*(uint *)(param_1 + 0x10) <= *puVar1) {
    FUN_00504050();
  }
  if (*puVar1 != 0) {
    FUN_00526090(param_2);
  }
  if (in_ECX == 0) {
    iVar6 = 0;
  }
  else {
    iVar6 = in_ECX + 0x10;
  }
  uVar3 = *puVar1;
  iVar4 = *(int *)(param_1 + 0xc);
  iVar5 = *(int *)(param_1 + 0x1c);
  param_3 = FUN_00525380("onLoadProgress",0xe,0);
  *(int *)(param_3 + 8) = *(int *)(param_3 + 8) + 1;
  FUN_0057bb40(param_1,iVar6,&param_3,3,((int)(uVar3 - iVar4) >> 4) + -0x20 + iVar5 * 0x20);
  *(int *)(param_3 + 8) = *(int *)(param_3 + 8) + -1;
  if (*(int *)(param_3 + 8) == 0) {
    FUN_00525340();
  }
  FUN_0052f560();
  return;
}



============================================================
DISASSEMBLY
============================================================
005ba9c0 : SUB ESP,0x8
005ba9c3 : PUSH EBX
005ba9c4 : PUSH EBP
005ba9c5 : PUSH ESI
005ba9c6 : MOV ESI,dword ptr [ESP + 0x1c]
005ba9ca : PUSH EDI
005ba9cb : MOV EDI,dword ptr [ESP + 0x28]
005ba9cf : MOV EBX,ECX
005ba9d1 : TEST ESI,ESI
005ba9d3 : JZ 0x005baa48
005ba9d5 : LEA ECX,[ESP + 0x28]
005ba9d9 : CALL 0x0051b6e0
005ba9de : LEA EAX,[ESP + 0x28]
005ba9e2 : PUSH EAX
005ba9e3 : MOV ECX,ESI
005ba9e5 : CALL 0x0051fc70
005ba9ea : LEA ECX,[ESP + 0x28]
005ba9ee : LEA ESI,[EBX + 0x30]
005ba9f1 : PUSH ECX
005ba9f2 : MOV ECX,ESI
005ba9f4 : CALL 0x005b9c60
005ba9f9 : TEST EAX,EAX
005ba9fb : JZ 0x005baa0d
005ba9fd : ADD EAX,0x4
005baa00 : JZ 0x005baa0d
005baa02 : MOV EDX,dword ptr [ESP + 0x24]
005baa06 : MOV dword ptr [EAX],EDX
005baa08 : MOV dword ptr [EAX + 0x4],EDI
005baa0b : JMP 0x005baa2a
005baa0d : MOV EAX,dword ptr [ESP + 0x24]
005baa11 : LEA ECX,[ESP + 0x10]
005baa15 : PUSH ECX
005baa16 : LEA EDX,[ESP + 0x2c]
005baa1a : PUSH EDX
005baa1b : MOV ECX,ESI
005baa1d : MOV dword ptr [ESP + 0x18],EAX
005baa21 : MOV dword ptr [ESP + 0x1c],EDI
005baa25 : CALL 0x005ba940
005baa2a : MOV ESI,dword ptr [ESP + 0x28]
005baa2e : AND ESI,0xfffffffc
005baa31 : PUSH -0x1
005baa33 : LEA EAX,[ESI + 0x4]
005baa36 : PUSH EAX
005baa37 : CALL dword ptr [0x00b851cc]
005baa3d : SUB EAX,0x1
005baa40 : JNZ 0x005baa48
005baa42 : PUSH ESI
005baa43 : CALL 0x00515cf0
005baa48 : MOV EBP,dword ptr [ESP + 0x1c]
005baa4c : ADD dword ptr [EBP + 0x8],0x10
005baa50 : MOV EAX,dword ptr [EBP + 0x8]
005baa53 : CMP EAX,dword ptr [EBP + 0x10]
005baa56 : LEA ESI,[EBP + 0x8]
005baa59 : JC 0x005baa62
005baa5b : MOV ECX,ESI
005baa5d : CALL 0x00504050
005baa62 : MOV EAX,dword ptr [ESI]
005baa64 : TEST EAX,EAX
005baa66 : JZ 0x005baa6e
005baa68 : MOV byte ptr [EAX],0x4
005baa6b : MOV dword ptr [EAX + 0x4],EDI
005baa6e : ADD dword ptr [ESI],0x10
005baa71 : MOV EAX,dword ptr [ESI]
005baa73 : CMP EAX,dword ptr [ESI + 0x8]
005baa76 : JC 0x005baa7f
005baa78 : MOV ECX,ESI
005baa7a : CALL 0x00504050
005baa7f : MOV EAX,dword ptr [ESI]
005baa81 : TEST EAX,EAX
005baa83 : JZ 0x005baa8f
005baa85 : MOV ECX,dword ptr [ESP + 0x24]
005baa89 : MOV byte ptr [EAX],0x4
005baa8c : MOV dword ptr [EAX + 0x4],ECX
005baa8f : ADD dword ptr [ESI],0x10
005baa92 : MOV EAX,dword ptr [ESI]
005baa94 : CMP EAX,dword ptr [ESI + 0x8]
005baa97 : JC 0x005baaa0
005baa99 : MOV ECX,ESI
005baa9b : CALL 0x00504050
005baaa0 : MOV ECX,dword ptr [ESI]
005baaa2 : TEST ECX,ECX
005baaa4 : JZ 0x005baab0
005baaa6 : MOV EDX,dword ptr [ESP + 0x20]
005baaaa : PUSH EDX
005baaab : CALL 0x00526090
005baab0 : TEST EBX,EBX
005baab2 : JZ 0x005baab9
005baab4 : ADD EBX,0x10
005baab7 : JMP 0x005baabb
005baab9 : XOR EBX,EBX
005baabb : MOV EAX,dword ptr [ESI]
005baabd : SUB EAX,dword ptr [ESI + 0x4]
005baac0 : MOV ECX,dword ptr [ESI + 0x14]
005baac3 : SAR EAX,0x4
005baac6 : SHL ECX,0x5
005baac9 : PUSH 0x0
005baacb : LEA EDI,[EAX + ECX*0x1 + -0x20]
005baacf : MOV EAX,dword ptr [EBP + 0x78]
005baad2 : PUSH 0xe
005baad4 : PUSH 0xb8fa64
005baad9 : LEA ECX,[EAX + 0x254]
005baadf : CALL 0x00525380
005baae4 : PUSH EDI
005baae5 : PUSH 0x3
005baae7 : LEA EDX,[ESP + 0x2c]
005baaeb : PUSH EDX
005baaec : PUSH EBX
005baaed : MOV dword ptr [ESP + 0x34],EAX
005baaf1 : INC dword ptr [EAX + 0x8]
005baaf4 : PUSH EBP
005baaf5 : CALL 0x0057bb40
005baafa : MOV EAX,dword ptr [ESP + 0x38]
005baafe : DEC dword ptr [EAX + 0x8]
005bab01 : MOV ECX,EAX
005bab03 : ADD EAX,0x8
005bab06 : ADD ESP,0x14
005bab09 : CMP dword ptr [EAX],0x0
005bab0c : JNZ 0x005bab13
005bab0e : CALL 0x00525340
005bab13 : MOV ECX,ESI
005bab15 : CALL 0x0052f560
005bab1a : POP EDI
005bab1b : POP ESI
005bab1c : POP EBP
005bab1d : POP EBX
005bab1e : ADD ESP,0x8
005bab21 : RET 0x10
