PROGRAM  : Maestia.exe
FUNCTION : FUN_006789e0
ENTRY    : 006789e0
BODY     : [[006789e0, 00678c30]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_006789e0(GRefCountImpl *param_1,undefined4 param_2,char *param_3,undefined4 param_4)

{
  undefined4 *puVar1;
  char cVar2;
  HDC hdc;
  char *pcVar3;
  int iVar4;
  HFONT h;
  HGDIOBJ h_00;
  undefined4 *in_ECX;
  uint uVar5;
  uint uVar6;
  undefined1 auStack_a8 [3];
  char local_a5;
  char *local_a4;
  char *local_a0;
  tagTEXTMETRICW local_9c;
  tagLOGFONTW local_60;
  uint local_4;
  
  local_4 = DAT_00d66fa0 ^ (uint)auStack_a8;
  in_ECX[2] = 0;
  in_ECX[3] = 0;
  in_ECX[4] = 0;
  *in_ECX = &PTR_FUN_00cd3f2c;
  local_a4 = param_3;
  in_ECX[1] = 1;
  in_ECX[5] = param_4;
  *in_ECX = &PTR_FUN_00bd6300;
  if (param_1 != (GRefCountImpl *)0x0) {
    GRefCountImpl::AddRef(param_1);
  }
  in_ECX[6] = param_1;
  in_ECX[7] = param_2;
  in_ECX[8] = 0;
  in_ECX[9] = 0;
  in_ECX[10] = 0;
  in_ECX[0xb] = 0;
  in_ECX[0xc] = 0;
  in_ECX[0xd] = 0;
  puVar1 = in_ECX + 0xb;
  in_ECX[0xe] = 0;
  in_ECX[0xf] = 0;
  in_ECX[0x10] = 0;
  in_ECX[0x11] = 0;
  in_ECX[0x12] = 0;
  in_ECX[0x13] = 0;
  in_ECX[0x14] = 0;
  in_ECX[0x15] = 0;
  in_ECX[0x16] = 0;
  in_ECX[0x17] = 0x40888889;
  FUN_0051b6e0();
  local_a0 = local_a4;
  do {
    cVar2 = *local_a0;
    local_a0 = local_a0 + 1;
  } while (cVar2 != '\0');
  local_a0 = local_a0 + (1 - (int)(local_a4 + 1));
  if (local_a0 < (char *)in_ECX[9]) {
    pcVar3 = local_a0;
    if (local_a0 < (char *)((uint)in_ECX[10] >> 1)) {
LAB_00678acc:
      FUN_006770c0(in_ECX + 8,pcVar3);
    }
  }
  else if ((char *)in_ECX[10] <= local_a0) {
    pcVar3 = local_a0 + ((uint)local_a0 >> 2);
    goto LAB_00678acc;
  }
  in_ECX[9] = local_a0;
  pcVar3 = local_a4;
  do {
    cVar2 = *pcVar3;
    pcVar3 = pcVar3 + 1;
  } while (cVar2 != '\0');
  _strcpy_s((char *)in_ECX[8],(rsize_t)(pcVar3 + (1 - (int)(local_a4 + 1))),local_a4);
  iVar4 = FUN_0051b0c0(local_a4,0xffffffff);
  uVar5 = iVar4 + 1;
  if (uVar5 < (uint)in_ECX[0xc]) {
    uVar6 = uVar5;
    if ((uint)in_ECX[0xd] >> 1 <= uVar5) goto LAB_00678b33;
  }
  else {
    if (uVar5 < (uint)in_ECX[0xd]) goto LAB_00678b33;
    uVar6 = (uVar5 >> 2) + uVar5;
  }
  FUN_005da0e0(puVar1,uVar6);
LAB_00678b33:
  in_ECX[0xc] = uVar5;
  FUN_0051b030(*puVar1,local_a4,0xffffffff);
  lstrcpyW(local_60.lfFaceName,(LPCWSTR)*puVar1);
  local_60.lfCharSet = '\x01';
  local_a5 = '\0';
  EnumFontFamiliesExW(*(HDC *)(in_ECX[7] + 0xc),&local_60,(FONTENUMPROCW)&LAB_00676f30,
                      (LPARAM)&local_a5,0);
  if (local_a5 != '\0') {
    h = CreateFontW(-0xf0,0,0,0,(-(uint)(((uint)in_ECX[5] >> 1 & 1) != 0) & 300) + 400,
                    (uint)(*(byte *)(in_ECX + 5) & 1),0,0,1,0,0,4,0,(LPCWSTR)*puVar1);
    in_ECX[0xe] = h;
    if (h != (HFONT)0x0) {
      hdc = *(HDC *)(in_ECX[7] + 0xc);
      h_00 = SelectObject(hdc,h);
      GetTextMetricsW(*(HDC *)(in_ECX[7] + 0xc),&local_9c);
      in_ECX[4] = (float)local_9c.tmExternalLeading * (float)in_ECX[0x17];
      in_ECX[2] = (float)local_9c.tmAscent * (float)in_ECX[0x17];
      in_ECX[3] = (float)local_9c.tmDescent * (float)in_ECX[0x17];
      FUN_00678840();
      SelectObject(hdc,h_00);
    }
  }
  __security_check_cookie(local_4 ^ (uint)auStack_a8);
  return;
}



============================================================
DISASSEMBLY
============================================================
006789e0 : SUB ESP,0xa8
006789e6 : MOV EAX,[0x00d66fa0]
006789eb : XOR EAX,ESP
006789ed : MOV dword ptr [ESP + 0xa4],EAX
006789f4 : FLDZ
006789f6 : MOV EAX,dword ptr [ESP + 0xb4]
006789fd : PUSH EBX
006789fe : PUSH EBP
006789ff : PUSH ESI
00678a00 : MOV ESI,ECX
00678a02 : MOV ECX,dword ptr [ESP + 0xc4]
00678a09 : FST float ptr [ESI + 0x8]
00678a0c : PUSH EDI
00678a0d : FST float ptr [ESI + 0xc]
00678a10 : MOV EDI,dword ptr [ESP + 0xbc]
00678a17 : FSTP float ptr [ESI + 0x10]
00678a1a : XOR EBX,EBX
00678a1c : MOV dword ptr [ESI],0xcd3f2c
00678a22 : MOV dword ptr [ESP + 0x14],EAX
00678a26 : MOV dword ptr [ESI + 0x4],0x1
00678a2d : MOV dword ptr [ESI + 0x14],ECX
00678a30 : MOV dword ptr [ESI],0xbd6300
00678a36 : CMP EDI,EBX
00678a38 : JZ 0x00678a41
00678a3a : MOV ECX,EDI
00678a3c : CALL 0x00523dd0
00678a41 : MOV EDX,dword ptr [ESP + 0xc0]
00678a48 : FLD float ptr [0x00bd6348]
00678a4e : MOV dword ptr [ESI + 0x18],EDI
00678a51 : MOV dword ptr [ESI + 0x1c],EDX
00678a54 : MOV dword ptr [ESI + 0x20],EBX
00678a57 : MOV dword ptr [ESI + 0x24],EBX
00678a5a : MOV dword ptr [ESI + 0x28],EBX
00678a5d : MOV dword ptr [ESI + 0x2c],EBX
00678a60 : MOV dword ptr [ESI + 0x30],EBX
00678a63 : MOV dword ptr [ESI + 0x34],EBX
00678a66 : LEA EBP,[ESI + 0x20]
00678a69 : LEA EDI,[ESI + 0x2c]
00678a6c : MOV dword ptr [ESI + 0x38],EBX
00678a6f : MOV dword ptr [ESI + 0x3c],EBX
00678a72 : MOV dword ptr [ESI + 0x40],EBX
00678a75 : MOV dword ptr [ESI + 0x44],EBX
00678a78 : MOV dword ptr [ESI + 0x48],EBX
00678a7b : MOV dword ptr [ESI + 0x4c],EBX
00678a7e : MOV dword ptr [ESI + 0x50],EBX
00678a81 : MOV dword ptr [ESI + 0x54],EBX
00678a84 : MOV dword ptr [ESI + 0x58],EBX
00678a87 : FSTP float ptr [ESI + 0x5c]
00678a8a : LEA ECX,[ESI + 0x60]
00678a8d : CALL 0x0051b6e0
00678a92 : MOV EAX,dword ptr [ESP + 0x14]
00678a96 : LEA EDX,[EAX + 0x1]
00678a99 : LEA ESP,[ESP]
00678aa0 : MOV CL,byte ptr [EAX]
00678aa2 : INC EAX
00678aa3 : CMP CL,BL
00678aa5 : JNZ 0x00678aa0
00678aa7 : SUB EAX,EDX
00678aa9 : INC EAX
00678aaa : MOV dword ptr [ESP + 0x18],EAX
00678aae : CMP EAX,dword ptr [EBP + 0x4]
00678ab1 : JNC 0x00678abf
00678ab3 : MOV ECX,dword ptr [EBP + 0x8]
00678ab6 : SHR ECX,0x1
00678ab8 : CMP EAX,ECX
00678aba : JNC 0x00678ad8
00678abc : PUSH EAX
00678abd : JMP 0x00678acc
00678abf : CMP EAX,dword ptr [EBP + 0x8]
00678ac2 : JC 0x00678ad8
00678ac4 : MOV EDX,EAX
00678ac6 : SHR EDX,0x2
00678ac9 : ADD EDX,EAX
00678acb : PUSH EDX
00678acc : PUSH EBP
00678acd : MOV ECX,EBP
00678acf : CALL 0x006770c0
00678ad4 : MOV EAX,dword ptr [ESP + 0x18]
00678ad8 : MOV dword ptr [EBP + 0x4],EAX
00678adb : MOV EAX,dword ptr [ESP + 0x14]
00678adf : LEA EDX,[EAX + 0x1]
00678ae2 : MOV CL,byte ptr [EAX]
00678ae4 : INC EAX
00678ae5 : CMP CL,BL
00678ae7 : JNZ 0x00678ae2
00678ae9 : MOV ECX,dword ptr [ESP + 0x14]
00678aed : SUB EAX,EDX
00678aef : MOV EDX,dword ptr [EBP]
00678af2 : PUSH ECX
00678af3 : INC EAX
00678af4 : PUSH EAX
00678af5 : PUSH EDX
00678af6 : CALL 0x00638300
00678afb : MOV EAX,dword ptr [ESP + 0x20]
00678aff : ADD ESP,0xc
00678b02 : PUSH -0x1
00678b04 : PUSH EAX
00678b05 : CALL 0x0051b0c0
00678b0a : MOV EBP,EAX
00678b0c : INC EBP
00678b0d : CMP EBP,dword ptr [EDI + 0x4]
00678b10 : JNC 0x00678b1e
00678b12 : MOV ECX,dword ptr [EDI + 0x8]
00678b15 : SHR ECX,0x1
00678b17 : CMP EBP,ECX
00678b19 : JNC 0x00678b33
00678b1b : PUSH EBP
00678b1c : JMP 0x00678b2b
00678b1e : CMP EBP,dword ptr [EDI + 0x8]
00678b21 : JC 0x00678b33
00678b23 : MOV EDX,EBP
00678b25 : SHR EDX,0x2
00678b28 : ADD EDX,EBP
00678b2a : PUSH EDX
00678b2b : PUSH EDI
00678b2c : MOV ECX,EDI
00678b2e : CALL 0x005da0e0
00678b33 : MOV EAX,dword ptr [ESP + 0x14]
00678b37 : PUSH -0x1
00678b39 : MOV dword ptr [EDI + 0x4],EBP
00678b3c : MOV ECX,dword ptr [EDI]
00678b3e : PUSH EAX
00678b3f : PUSH ECX
00678b40 : CALL 0x0051b030
00678b45 : MOV EDX,dword ptr [EDI]
00678b47 : PUSH EDX
00678b48 : LEA EAX,[ESP + 0x78]
00678b4c : PUSH EAX
00678b4d : CALL dword ptr [0x00b85174]
00678b53 : MOV EAX,dword ptr [ESI + 0x1c]
00678b56 : PUSH EBX
00678b57 : LEA ECX,[ESP + 0x17]
00678b5b : PUSH ECX
00678b5c : PUSH 0x676f30
00678b61 : LEA EDX,[ESP + 0x64]
00678b65 : MOV byte ptr [ESP + 0x7b],0x1
00678b6a : MOV byte ptr [ESP + 0x1f],BL
00678b6e : MOV ECX,dword ptr [EAX + 0xc]
00678b71 : PUSH EDX
00678b72 : PUSH ECX
00678b73 : CALL dword ptr [0x00b85060]
00678b79 : CMP byte ptr [ESP + 0x13],BL
00678b7d : JZ 0x00678c14
00678b83 : MOV EDI,dword ptr [EDI]
00678b85 : MOV EAX,dword ptr [ESI + 0x14]
00678b88 : MOV CL,byte ptr [ESI + 0x14]
00678b8b : PUSH EDI
00678b8c : PUSH EBX
00678b8d : PUSH 0x4
00678b8f : SHR EAX,0x1
00678b91 : PUSH EBX
00678b92 : AND AL,0x1
00678b94 : PUSH EBX
00678b95 : PUSH 0x1
00678b97 : MOVZX EAX,AL
00678b9a : PUSH EBX
00678b9b : AND CL,0x1
00678b9e : NEG EAX
00678ba0 : PUSH EBX
00678ba1 : SBB EAX,EAX
00678ba3 : MOVZX EDX,CL
00678ba6 : PUSH EDX
00678ba7 : AND EAX,0x12c
00678bac : ADD EAX,0x190
00678bb1 : PUSH EAX
00678bb2 : PUSH EBX
00678bb3 : PUSH EBX
00678bb4 : PUSH EBX
00678bb5 : PUSH 0xffffff10
00678bba : CALL dword ptr [0x00b85068]
00678bc0 : MOV dword ptr [ESI + 0x38],EAX
00678bc3 : CMP EAX,EBX
00678bc5 : JZ 0x00678c14
00678bc7 : MOV ECX,dword ptr [ESI + 0x1c]
00678bca : MOV EDI,dword ptr [ECX + 0xc]
00678bcd : MOV EBX,dword ptr [0x00b85058]
00678bd3 : PUSH EAX
00678bd4 : PUSH EDI
00678bd5 : CALL EBX
00678bd7 : MOV EBP,EAX
00678bd9 : MOV EAX,dword ptr [ESI + 0x1c]
00678bdc : MOV ECX,dword ptr [EAX + 0xc]
00678bdf : LEA EDX,[ESP + 0x1c]
00678be3 : PUSH EDX
00678be4 : PUSH ECX
00678be5 : CALL dword ptr [0x00b8505c]
00678beb : FILD dword ptr [ESP + 0x2c]
00678bef : MOV ECX,ESI
00678bf1 : FMUL float ptr [ESI + 0x5c]
00678bf4 : FSTP float ptr [ESI + 0x10]
00678bf7 : FILD dword ptr [ESP + 0x20]
00678bfb : FMUL float ptr [ESI + 0x5c]
00678bfe : FSTP float ptr [ESI + 0x8]
00678c01 : FILD dword ptr [ESP + 0x24]
00678c05 : FMUL float ptr [ESI + 0x5c]
00678c08 : FSTP float ptr [ESI + 0xc]
00678c0b : CALL 0x00678840
00678c10 : PUSH EBP
00678c11 : PUSH EDI
00678c12 : CALL EBX
00678c14 : MOV ECX,dword ptr [ESP + 0xb4]
00678c1b : POP EDI
00678c1c : MOV EAX,ESI
00678c1e : POP ESI
00678c1f : POP EBP
00678c20 : POP EBX
00678c21 : XOR ECX,ESP
00678c23 : CALL 0x00633e6b
00678c28 : ADD ESP,0xa8
00678c2e : RET 0x10
