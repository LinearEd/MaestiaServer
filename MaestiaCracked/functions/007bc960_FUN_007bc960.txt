PROGRAM  : Maestia.exe
FUNCTION : FUN_007bc960
ENTRY    : 007bc960
BODY     : [[007bc960, 007bcabd]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Removing unreachable block (ram,0x007bc9f1) */

void FUN_007bc960(int param_1,int param_2)

{
  int *piVar1;
  uint uVar2;
  ushort *puVar3;
  int iVar4;
  ushort *puVar5;
  uint uVar6;
  LPCRITICAL_SECTION local_28;
  char *local_24;
  undefined4 local_20;
  int local_1c;
  undefined4 local_18;
  int *local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b109cf;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  local_28 = (LPCRITICAL_SECTION)(param_1 + 4);
  local_1c = 0;
  local_24 = ".\\mss\\AvaMssMgr.cpp";
  local_20 = 0x406;
  local_18 = 1;
  FUN_006ef1a0(&local_28);
  local_8 = 0;
  if ((*(int *)(param_1 + 0x20) != 0) &&
     (local_14 = *(int **)(param_1 + 0x50), local_14 != *(int **)(param_1 + 0x54))) {
    do {
      piVar1 = (int *)*local_14;
      if (*(uint *)(param_2 + 0x18) < 8) {
        puVar3 = (ushort *)(param_2 + 4);
      }
      else {
        puVar3 = *(ushort **)(param_2 + 4);
      }
      uVar2 = piVar1[10];
      uVar6 = *(uint *)(param_2 + 0x14);
      if (uVar2 < *(uint *)(param_2 + 0x14)) {
        uVar6 = uVar2;
      }
      if ((uint)piVar1[0xb] < 8) {
        puVar5 = (ushort *)(piVar1 + 6);
      }
      else {
        puVar5 = (ushort *)piVar1[6];
      }
      for (; uVar6 != 0; uVar6 = uVar6 - 1) {
        if (*puVar5 != *puVar3) {
          uVar6 = (-(uint)(*puVar5 < *puVar3) & 0xfffffffe) + 1;
          if (uVar6 != 0) goto LAB_007bca3a;
          break;
        }
        puVar5 = puVar5 + 1;
        puVar3 = puVar3 + 1;
      }
      if (*(uint *)(param_2 + 0x14) <= uVar2) {
        uVar6 = (uint)(uVar2 != *(uint *)(param_2 + 0x14));
LAB_007bca3a:
        if (((uVar6 == 0) && (*piVar1 != 0)) && (iVar4 = _AIL_sample_status_4(*piVar1), iVar4 == 4))
        {
          _AIL_end_sample_4(*piVar1);
        }
      }
      local_14 = local_14 + 1;
    } while (local_14 != *(int **)(param_1 + 0x54));
  }
  local_8 = 0xffffffff;
  if (local_1c != 0) {
    LeaveCriticalSection(local_28);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
007bc960 : PUSH EBP
007bc961 : MOV EBP,ESP
007bc963 : PUSH -0x1
007bc965 : PUSH 0xb109cf
007bc96a : MOV EAX,FS:[0x0]
007bc970 : PUSH EAX
007bc971 : SUB ESP,0x18
007bc974 : PUSH EBX
007bc975 : PUSH ESI
007bc976 : PUSH EDI
007bc977 : MOV EAX,[0x00d66fa0]
007bc97c : XOR EAX,EBP
007bc97e : PUSH EAX
007bc97f : LEA EAX,[EBP + -0xc]
007bc982 : MOV FS:[0x0],EAX
007bc988 : MOV EBX,dword ptr [EBP + 0xc]
007bc98b : MOV ESI,dword ptr [EBP + 0x8]
007bc98e : LEA ECX,[EBP + -0x24]
007bc991 : LEA EAX,[ESI + 0x4]
007bc994 : XOR EDI,EDI
007bc996 : PUSH ECX
007bc997 : MOV dword ptr [EBP + -0x18],EDI
007bc99a : MOV dword ptr [EBP + -0x24],EAX
007bc99d : MOV dword ptr [EBP + -0x20],0xc18f70
007bc9a4 : MOV dword ptr [EBP + -0x1c],0x406
007bc9ab : MOV dword ptr [EBP + -0x14],0x1
007bc9b2 : CALL 0x006ef1a0
007bc9b7 : MOV dword ptr [EBP + -0x4],EDI
007bc9ba : CMP dword ptr [ESI + 0x20],EDI
007bc9bd : JZ 0x007bca75
007bc9c3 : MOV EAX,dword ptr [ESI + 0x50]
007bc9c6 : MOV dword ptr [EBP + -0x10],EAX
007bc9c9 : CMP EAX,dword ptr [ESI + 0x54]
007bc9cc : JZ 0x007bca75
007bc9d2 : JMP 0x007bc9d7
007bc9d4 : MOV EAX,dword ptr [EBP + -0x10]
007bc9d7 : CMP dword ptr [EBX + 0x18],0x8
007bc9db : MOV EDI,dword ptr [EAX]
007bc9dd : MOV EDX,dword ptr [EBX + 0x14]
007bc9e0 : JC 0x007bc9e7
007bc9e2 : MOV EAX,dword ptr [EBX + 0x4]
007bc9e5 : JMP 0x007bc9ea
007bc9e7 : LEA EAX,[EBX + 0x4]
007bc9ea : MOV ESI,dword ptr [EDI + 0x28]
007bc9ed : MOV ECX,ESI
007bc9ef : CMP ECX,ESI
007bc9f1 : CMOVC ESI,ECX
007bc9f4 : CMP ESI,EDX
007bc9f6 : JNC 0x007bc9fa
007bc9f8 : MOV EDX,ESI
007bc9fa : CMP dword ptr [EDI + 0x2c],0x8
007bc9fe : JC 0x007bca05
007bca00 : MOV ECX,dword ptr [EDI + 0x18]
007bca03 : JMP 0x007bca08
007bca05 : LEA ECX,[EDI + 0x18]
007bca08 : TEST EDX,EDX
007bca0a : JBE 0x007bca2a
007bca0c : LEA ESP,[ESP]
007bca10 : MOV BX,word ptr [ECX]
007bca13 : CMP BX,word ptr [EAX]
007bca16 : JNZ 0x007bcaa2
007bca1c : ADD ECX,0x2
007bca1f : ADD EAX,0x2
007bca22 : SUB EDX,0x1
007bca25 : JNZ 0x007bca10
007bca27 : MOV EBX,dword ptr [EBP + 0xc]
007bca2a : MOV EAX,dword ptr [EBX + 0x14]
007bca2d : CMP ESI,EAX
007bca2f : JC 0x007bca5e
007bca31 : XOR EDX,EDX
007bca33 : CMP ESI,EAX
007bca35 : SETNZ DL
007bca38 : MOV EAX,EDX
007bca3a : TEST EAX,EAX
007bca3c : JNZ 0x007bca5e
007bca3e : MOV EAX,dword ptr [EDI]
007bca40 : TEST EAX,EAX
007bca42 : JZ 0x007bca5e
007bca44 : PUSH EAX
007bca45 : CALL dword ptr [0x00b85708]
007bca4b : CMP EAX,0x4
007bca4e : SETZ AL
007bca51 : TEST AL,AL
007bca53 : JZ 0x007bca5e
007bca55 : MOV EAX,dword ptr [EDI]
007bca57 : PUSH EAX
007bca58 : CALL dword ptr [0x00b856f4]
007bca5e : MOV EAX,dword ptr [EBP + -0x10]
007bca61 : MOV ECX,dword ptr [EBP + 0x8]
007bca64 : ADD EAX,0x4
007bca67 : MOV dword ptr [EBP + -0x10],EAX
007bca6a : CMP EAX,dword ptr [ECX + 0x54]
007bca6d : JNZ 0x007bc9d4
007bca73 : XOR EDI,EDI
007bca75 : MOV dword ptr [EBP + -0x4],0xffffffff
007bca7c : CMP dword ptr [EBP + -0x18],EDI
007bca7f : JZ 0x007bca8e
007bca81 : MOV EDX,dword ptr [EBP + -0x24]
007bca84 : PUSH EDX
007bca85 : CALL dword ptr [0x00b8511c]
007bca8b : MOV dword ptr [EBP + -0x18],EDI
007bca8e : MOV ECX,dword ptr [EBP + -0xc]
007bca91 : MOV dword ptr FS:[0x0],ECX
007bca98 : POP ECX
007bca99 : POP EDI
007bca9a : POP ESI
007bca9b : POP EBX
007bca9c : MOV ESP,EBP
007bca9e : POP EBP
007bca9f : RET 0x8
007bcaa2 : MOV CX,BX
007bcaa5 : CMP CX,word ptr [EAX]
007bcaa8 : SBB EAX,EAX
007bcaaa : AND EAX,0xfffffffe
007bcaad : ADD EAX,0x1
007bcab0 : JZ 0x007bca27
007bcab6 : MOV EBX,dword ptr [EBP + 0xc]
007bcab9 : JMP 0x007bca3a
