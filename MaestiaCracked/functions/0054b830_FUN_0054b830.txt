PROGRAM  : Maestia.exe
FUNCTION : FUN_0054b830
ENTRY    : 0054b830
BODY     : [[0054b830, 0054ba57]]

============================================================
DECOMPILED C CODE
============================================================

undefined1 FUN_0054b830(float *param_1,uint param_2)

{
  float fVar1;
  int *piVar2;
  float fVar3;
  float fVar4;
  uint uVar5;
  uint uVar6;
  int in_ECX;
  int iVar7;
  int iVar8;
  undefined1 local_7d;
  uint local_74;
  int *local_70 [2];
  uint local_68;
  uint local_5c;
  uint local_58;
  int *local_10;
  GRefCountNTSImpl *local_c;
  
  if (param_1 != (float *)0x0) {
    uVar5 = FUN_0053c470();
    if (param_2 < uVar5) {
      if ((*(byte *)(in_ECX + 0x143) & 3) != 0) {
        FUN_00549ad0();
        *(byte *)(in_ECX + 0x143) = *(byte *)(in_ECX + 0x143) & 0xfc;
      }
      FUN_00599f40(local_70,param_2);
      local_7d = 0;
      if (((local_70[0] != (int *)0x0) && (local_68 < (uint)local_70[0][1])) && (-1 < (int)local_68)
         ) {
        piVar2 = *(int **)(*local_70[0] + local_68 * 4);
        uVar5 = piVar2[2];
        if ((*piVar2 < 0) && (uVar5 = uVar5 & 0xffffff, uVar5 == 0xffffff)) {
          uVar5 = 0xffffffff;
        }
        FUN_005461c0(&local_5c);
        iVar8 = 0;
        iVar7 = 0;
        while( true ) {
          if ((local_5c == 0) || (local_58 <= local_5c)) goto LAB_0054ba0b;
          if (iVar7 == param_2 - uVar5) break;
          uVar6 = (uint)*(ushort *)(local_5c + 2);
          if ((*(byte *)(local_5c + 6) >> 6 & 1) != 0) {
            uVar6 = -uVar6;
          }
          iVar8 = iVar8 + uVar6;
          FUN_005443b0();
          iVar7 = iVar7 + 1;
        }
        if ((*(byte *)(local_5c + 7) & 1) == 0) {
          local_7d = 1;
          *param_1 = 0.0;
          param_1[1] = 0.0;
          param_1[2] = 0.0;
          param_1[3] = 0.0;
          if ((*(byte *)(local_5c + 6) >> 6 & 1) == 0) {
            local_74 = (uint)*(ushort *)(local_5c + 2);
          }
          else {
            local_74 = -(uint)*(ushort *)(local_5c + 2);
          }
          fVar3 = (float)(int)local_74;
          fVar1 = param_1[2];
          param_1[2] = fVar3 + fVar1;
          param_1[1] = 40.0;
          if (*piVar2 < 0) {
            local_74 = (uint)*(ushort *)((int)piVar2 + 0x16);
          }
          else {
            local_74 = piVar2[6];
          }
          fVar4 = (float)(int)local_74;
          param_1[3] = fVar4;
          if (*piVar2 < 0) {
            local_74 = piVar2[4];
          }
          else {
            local_74 = piVar2[4];
          }
          *param_1 = (float)iVar8 + 40.0 + 0.0;
          param_1[2] = fVar3 + fVar1 + (float)iVar8 + 40.0;
          param_1[1] = (float)(int)local_74 + 40.0;
          param_1[3] = (float)(int)local_74 + fVar4;
        }
LAB_0054ba0b:
        if (local_c != (GRefCountNTSImpl *)0x0) {
          GRefCountNTSImpl::Release(local_c);
        }
        if ((local_10 != (int *)0x0) && (*local_10 = *local_10 + -1, *local_10 == 0)) {
          FUN_00500860();
          FUN_00515cf0(local_10);
        }
      }
      return local_7d;
    }
  }
  return 0;
}



============================================================
DISASSEMBLY
============================================================
0054b830 : SUB ESP,0x80
0054b836 : PUSH EBX
0054b837 : MOV EBX,dword ptr [ESP + 0x88]
0054b83e : PUSH ESI
0054b83f : PUSH EDI
0054b840 : MOV EDI,ECX
0054b842 : TEST EBX,EBX
0054b844 : JZ 0x0054ba4a
0054b84a : MOV ECX,dword ptr [EDI + 0xc]
0054b84d : CALL 0x0053c470
0054b852 : MOV ESI,dword ptr [ESP + 0x94]
0054b859 : CMP ESI,EAX
0054b85b : JNC 0x0054ba4a
0054b861 : TEST byte ptr [EDI + 0x143],0x3
0054b868 : JZ 0x0054b878
0054b86a : MOV ECX,EDI
0054b86c : CALL 0x00549ad0
0054b871 : AND byte ptr [EDI + 0x143],0xfc
0054b878 : PUSH ESI
0054b879 : LEA EAX,[ESP + 0x20]
0054b87d : PUSH EAX
0054b87e : LEA ECX,[EDI + 0x28]
0054b881 : CALL 0x00599f40
0054b886 : MOV EAX,dword ptr [ESP + 0x1c]
0054b88a : MOV byte ptr [ESP + 0xf],0x0
0054b88f : TEST EAX,EAX
0054b891 : JZ 0x0054ba3a
0054b897 : MOV ECX,dword ptr [ESP + 0x24]
0054b89b : CMP ECX,dword ptr [EAX + 0x4]
0054b89e : JNC 0x0054ba3a
0054b8a4 : TEST ECX,ECX
0054b8a6 : JL 0x0054ba3a
0054b8ac : MOV EDX,dword ptr [EAX]
0054b8ae : MOV EDI,dword ptr [EDX + ECX*0x4]
0054b8b1 : MOV EAX,dword ptr [EDI]
0054b8b3 : SHR EAX,0x1f
0054b8b6 : TEST AL,0x1
0054b8b8 : MOV EAX,dword ptr [EDI + 0x8]
0054b8bb : JZ 0x0054b8cc
0054b8bd : AND EAX,0xffffff
0054b8c2 : CMP EAX,0xffffff
0054b8c7 : JNZ 0x0054b8cc
0054b8c9 : OR EAX,0xffffffff
0054b8cc : PUSH EBP
0054b8cd : LEA ECX,[ESP + 0x34]
0054b8d1 : SUB ESI,EAX
0054b8d3 : PUSH ECX
0054b8d4 : MOV ECX,EDI
0054b8d6 : MOV dword ptr [ESP + 0x20],ESI
0054b8da : CALL 0x005461c0
0054b8df : XOR ESI,ESI
0054b8e1 : XOR EBP,EBP
0054b8e3 : MOV EAX,dword ptr [ESP + 0x34]
0054b8e7 : TEST EAX,EAX
0054b8e9 : JZ 0x0054ba0b
0054b8ef : CMP EAX,dword ptr [ESP + 0x38]
0054b8f3 : JNC 0x0054ba0b
0054b8f9 : CMP EBP,dword ptr [ESP + 0x1c]
0054b8fd : JZ 0x0054b91e
0054b8ff : MOV DL,byte ptr [EAX + 0x6]
0054b902 : MOVZX EAX,word ptr [EAX + 0x2]
0054b906 : SHR DL,0x6
0054b909 : TEST DL,0x1
0054b90c : JZ 0x0054b910
0054b90e : NEG EAX
0054b910 : LEA ECX,[ESP + 0x34]
0054b914 : ADD ESI,EAX
0054b916 : CALL 0x005443b0
0054b91b : INC EBP
0054b91c : JMP 0x0054b8e3
0054b91e : TEST byte ptr [EAX + 0x7],0x1
0054b922 : MOV dword ptr [ESP + 0x14],ESI
0054b926 : JNZ 0x0054ba0b
0054b92c : FLDZ
0054b92e : MOV byte ptr [ESP + 0x13],0x1
0054b933 : FST float ptr [EBX]
0054b935 : FSTP float ptr [EBX + 0x4]
0054b938 : FLDZ
0054b93a : FLD ST0
0054b93c : FADD ST0,ST1
0054b93e : FSTP float ptr [ESP + 0x1c]
0054b942 : FLD float ptr [ESP + 0x1c]
0054b946 : FST float ptr [EBX + 0x8]
0054b949 : FSTP float ptr [EBX + 0xc]
0054b94c : MOV CL,byte ptr [EAX + 0x6]
0054b94f : SHR CL,0x6
0054b952 : TEST CL,0x1
0054b955 : JNZ 0x0054b961
0054b957 : MOVZX EDX,word ptr [EAX + 0x2]
0054b95b : MOV dword ptr [ESP + 0x1c],EDX
0054b95f : JMP 0x0054b96b
0054b961 : MOVZX EAX,word ptr [EAX + 0x2]
0054b965 : NEG EAX
0054b967 : MOV dword ptr [ESP + 0x1c],EAX
0054b96b : FILD dword ptr [ESP + 0x1c]
0054b96f : FADD float ptr [EBX + 0x8]
0054b972 : FSTP float ptr [ESP + 0x1c]
0054b976 : FLD float ptr [ESP + 0x1c]
0054b97a : FST float ptr [EBX + 0x8]
0054b97d : FLD float ptr [0x00cdf238]
0054b983 : FSTP float ptr [EBX + 0x4]
0054b986 : MOV ECX,dword ptr [EDI]
0054b988 : SHR ECX,0x1f
0054b98b : TEST CL,0x1
0054b98e : JZ 0x0054b99a
0054b990 : MOVZX EDX,word ptr [EDI + 0x16]
0054b994 : MOV dword ptr [ESP + 0x1c],EDX
0054b998 : JMP 0x0054b9a1
0054b99a : MOV EAX,dword ptr [EDI + 0x18]
0054b99d : MOV dword ptr [ESP + 0x1c],EAX
0054b9a1 : FILD dword ptr [ESP + 0x1c]
0054b9a5 : FSTP float ptr [ESP + 0x1c]
0054b9a9 : FLD float ptr [ESP + 0x1c]
0054b9ad : FST float ptr [EBX + 0xc]
0054b9b0 : MOV ECX,dword ptr [EDI]
0054b9b2 : SHR ECX,0x1f
0054b9b5 : TEST CL,0x1
0054b9b8 : JZ 0x0054b9c3
0054b9ba : MOV EDX,dword ptr [EDI + 0x10]
0054b9bd : MOV dword ptr [ESP + 0x1c],EDX
0054b9c1 : JMP 0x0054b9ca
0054b9c3 : MOV EAX,dword ptr [EDI + 0x10]
0054b9c6 : MOV dword ptr [ESP + 0x1c],EAX
0054b9ca : FILD dword ptr [ESP + 0x14]
0054b9ce : FLD double ptr [0x00b8be30]
0054b9d4 : FADD ST1,ST0
0054b9d6 : FXCH
0054b9d8 : FSTP float ptr [ESP + 0x14]
0054b9dc : FILD dword ptr [ESP + 0x1c]
0054b9e0 : FSTP float ptr [ESP + 0x18]
0054b9e4 : FLD float ptr [ESP + 0x14]
0054b9e8 : FLD ST0
0054b9ea : FADDP ST5,ST0
0054b9ec : FXCH ST4
0054b9ee : FSTP float ptr [EBX]
0054b9f0 : FXCH ST2
0054b9f2 : FADDP ST3,ST0
0054b9f4 : FXCH ST2
0054b9f6 : FSTP float ptr [EBX + 0x8]
0054b9f9 : FLD float ptr [ESP + 0x18]
0054b9fd : FLD ST0
0054b9ff : FADDP ST2,ST0
0054ba01 : FXCH
0054ba03 : FSTP float ptr [EBX + 0x4]
0054ba06 : FADDP
0054ba08 : FSTP float ptr [EBX + 0xc]
0054ba0b : MOV ECX,dword ptr [ESP + 0x84]
0054ba12 : POP EBP
0054ba13 : TEST ECX,ECX
0054ba15 : JZ 0x0054ba1c
0054ba17 : CALL 0x004ff7c0
0054ba1c : MOV EAX,dword ptr [ESP + 0x7c]
0054ba20 : TEST EAX,EAX
0054ba22 : JZ 0x0054ba3a
0054ba24 : DEC dword ptr [EAX]
0054ba26 : MOV ESI,EAX
0054ba28 : CMP dword ptr [ESI],0x0
0054ba2b : JNZ 0x0054ba3a
0054ba2d : MOV ECX,ESI
0054ba2f : CALL 0x00500860
0054ba34 : PUSH ESI
0054ba35 : CALL 0x00515cf0
0054ba3a : MOV AL,byte ptr [ESP + 0xf]
0054ba3e : POP EDI
0054ba3f : POP ESI
0054ba40 : POP EBX
0054ba41 : ADD ESP,0x80
0054ba47 : RET 0x8
0054ba4a : POP EDI
0054ba4b : POP ESI
0054ba4c : XOR AL,AL
0054ba4e : POP EBX
0054ba4f : ADD ESP,0x80
0054ba55 : RET 0x8
