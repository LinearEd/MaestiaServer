PROGRAM  : Maestia.exe
FUNCTION : FUN_0090a6c0
ENTRY    : 0090a6c0
BODY     : [[0090a6c0, 0090aaac]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0090a6c0(undefined4 *param_1,undefined1 *param_2,ushort *param_3)

{
  uint *puVar1;
  undefined4 *puVar2;
  uint uVar3;
  ushort *puVar4;
  int iVar5;
  int iVar6;
  int *unaff_EDI;
  bool bVar7;
  int *piStack_b0;
  char *pcStack_ac;
  char *pcStack_a8;
  undefined4 uStack_a4;
  uint uStack_a0;
  undefined1 *puStack_9c;
  undefined4 **ppuStack_98;
  uint uStack_94;
  undefined4 *local_88;
  undefined4 *local_84;
  uint *local_80;
  uint local_7c;
  undefined1 local_78 [4];
  undefined4 *local_74;
  undefined4 *local_70;
  undefined4 uStack_6c;
  undefined4 *puStack_68;
  int local_64;
  int local_60;
  int iStack_5c;
  ushort *local_58;
  undefined2 uStack_50;
  undefined4 uStack_40;
  uint uStack_3c;
  undefined1 auStack_38 [4];
  undefined4 uStack_34;
  undefined4 uStack_24;
  uint uStack_20;
  uint local_1c;
  void *local_14;
  undefined1 *puStack_10;
  uint local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b2c770;
  local_14 = ExceptionList;
  local_1c = DAT_00d66fa0 ^ (uint)&local_88;
  uStack_94 = DAT_00d66fa0 ^ (uint)&stack0xffffff70;
  ExceptionList = &local_14;
  local_58 = param_3;
  ppuStack_98 = (undefined4 **)(*(int *)(unaff_EDI[0x17] + 0x38) * 0x10 + 0x24 + DAT_01724910);
  puStack_9c = local_78;
  uStack_a0 = 0x90a71d;
  FUN_0047bc90();
  iVar6 = DAT_00d7c54c;
  local_c = 0;
  local_7c = 0;
  if ((uint)param_1 >> 0x10 == 0x143e) {
    local_84 = param_1;
    ppuStack_98 = &local_84;
    puStack_9c = (undefined1 *)0x90a755;
    FUN_004437f0();
    if ((local_88 != *(undefined4 **)(iVar6 + 0x44)) && (local_88[4] != 0)) {
      local_7c = (uint)*(ushort *)(local_88[4] + 0x1a4);
    }
  }
  local_84 = local_74;
  if (local_74 != local_70) {
    do {
      puVar1 = (uint *)*local_84;
      local_80 = puVar1;
      if (*puVar1 >> 0x10 == 0x769) {
        ppuStack_98 = &local_88;
        puStack_9c = (undefined1 *)0x90a7b2;
        local_88 = (undefined4 *)*puVar1;
        FUN_004437f0();
        if ((local_60 != *(int *)(iVar6 + 0x44)) && (iVar5 = *(int *)(local_60 + 0x10), iVar5 != 0))
        {
          local_64 = iVar5 + 0x1c40;
          ppuStack_98 = (undefined4 **)0x90a7e3;
          local_88 = (undefined4 *)(**(code **)(*(int *)(iVar5 + 0x1c40) + 4))();
          iVar6 = DAT_00d7c54c;
          while (DAT_00d7c54c = iVar6, local_88 != (undefined4 *)0x0) {
            ppuStack_98 = (undefined4 **)0x90a800;
            iVar5 = FUN_004f5680();
            iVar6 = DAT_00d7c54c;
            if (iVar5 != 0) {
              if ((short)local_7c == 0) {
                bVar7 = (undefined4 *)
                        CONCAT22(*(undefined2 *)(iVar5 + 4),*(undefined2 *)(iVar5 + 6)) == param_1;
              }
              else {
                bVar7 = (short)local_7c == *(short *)(iVar5 + 6);
              }
              if (bVar7) {
                uStack_20 = 7;
                uStack_24 = 0;
                uStack_34 = (undefined4 **)((uint)uStack_34 & 0xffff0000);
                local_c._0_1_ = 1;
                puStack_9c = (undefined1 *)*puVar1;
                ppuStack_98 = (undefined4 **)auStack_38;
                uStack_a0 = 0x90a85e;
                (**(code **)(*unaff_EDI + 0x58))();
                puStack_68 = &piStack_b0;
                ppuStack_98 = (undefined4 **)0x7;
                puStack_9c = (undefined1 *)0x0;
                pcStack_ac = (char *)((uint)pcStack_ac & 0xffff0000);
                FUN_00405eb0(auStack_38,0,0xffffffff);
                local_c._0_1_ = 1;
                uStack_a0 = FUN_008f75f0();
                local_c._0_1_ = 3;
                ppuStack_98 = (undefined4 **)0xffffffff;
                puStack_9c = (undefined1 *)0x0;
                uStack_a4 = 0x90a8b9;
                FUN_00405eb0();
                local_c = CONCAT31(local_c._1_3_,1);
                if (7 < uStack_3c) {
                    /* WARNING: Subroutine does not return */
                  ppuStack_98 = (undefined4 **)0x90a8d1;
                  FUN_006f04e0();
                }
                uStack_50 = 0;
                ppuStack_98 = (undefined4 **)*puVar1;
                uStack_3c = 7;
                puVar2 = (undefined4 *)puVar1[1];
                uStack_40 = 0;
                puStack_9c = (undefined1 *)0x90a8f5;
                iVar6 = FUN_009f2740();
                if (iVar6 == 0) {
LAB_0090a922:
                  local_c = local_c & 0xffffff00;
                  if (7 < uStack_20) {
                    /* WARNING: Subroutine does not return */
                    ppuStack_98 = (undefined4 **)0x90a93a;
                    FUN_006f04e0();
                  }
                  uVar3 = (uint)uStack_34 >> 0x10;
                }
                else {
                  ppuStack_98 = &puStack_68;
                  puStack_9c = (undefined1 *)0x90a910;
                  puStack_68 = puVar2;
                  FUN_004437f0();
                  puVar4 = local_58;
                  if ((iStack_5c == *(int *)(iVar6 + 0xc)) || (*(uint *)(iStack_5c + 0x10) == 0))
                  goto LAB_0090a922;
                  ppuStack_98 = (undefined4 **)(uint)*local_58;
                  puStack_9c = param_2;
                  uStack_a4 = 0x90a95a;
                  uStack_a0 = *(uint *)(iStack_5c + 0x10);
                  FUN_009094a0();
                  iVar6 = *DAT_00da9894;
                  if ((iVar6 != 0) && (*(int *)(iVar6 + 0x114) != 0)) {
                    piStack_b0 = *(int **)(iVar6 + 0x114);
                    ppuStack_98 = uStack_34;
                    if (uStack_20 < 8) {
                      ppuStack_98 = (undefined4 **)&uStack_34;
                    }
                    puStack_9c = *(undefined1 **)puVar4;
                    uStack_a0 = (uint)param_2 & 0xffff;
                    uStack_a4 = *(undefined4 *)(unaff_EDI[0x17] + 0x38);
                    pcStack_a8 = "%d,%d,%d,%ls";
                    pcStack_ac = "AddPassiveSkill";
                    (**(code **)(*piStack_b0 + 4))();
                  }
                  *(int *)puVar4 = *(int *)puVar4 + 1;
                  if (2 < *(int *)puVar4) {
                    local_c = (uint)local_c._1_3_ << 8;
                    if (7 < uStack_20) {
                    /* WARNING: Subroutine does not return */
                      ppuStack_98 = (undefined4 **)0x90aa6e;
                      FUN_006f04e0();
                    }
                    uStack_20 = 7;
                    uStack_24 = 0;
                    uStack_34 = (undefined4 **)((uint)uStack_34._2_2_ << 0x10);
                    local_c = 0xffffffff;
                    if (local_74 != (undefined4 *)0x0) {
                    /* WARNING: Subroutine does not return */
                      ppuStack_98 = (undefined4 **)0x90aa9d;
                      FUN_006f04e0();
                    }
                    goto LAB_0090aa34;
                  }
                  local_c = (uint)local_c._1_3_ << 8;
                  if (7 < uStack_20) {
                    /* WARNING: Subroutine does not return */
                    ppuStack_98 = (undefined4 **)0x90a9cb;
                    FUN_006f04e0();
                  }
                  uVar3 = (uint)uStack_34._2_2_;
                }
                uStack_34 = (undefined4 **)(uVar3 << 0x10);
                uStack_24 = 0;
                uStack_20 = 7;
                puVar1 = local_80;
                iVar6 = DAT_00d7c54c;
              }
            }
          }
        }
      }
      local_84 = local_84 + 1;
    } while (local_84 != local_70);
  }
  local_c = 0xffffffff;
  if (local_74 != (undefined4 *)0x0) {
                    /* WARNING: Subroutine does not return */
    ppuStack_98 = (undefined4 **)0x90aa28;
    FUN_006f04e0();
  }
LAB_0090aa34:
  local_c = 0xffffffff;
  uStack_6c = 0;
  local_70 = (undefined4 *)0x0;
  local_74 = (undefined4 *)0x0;
  ExceptionList = local_14;
  __security_check_cookie(local_1c ^ (uint)&local_88);
  return;
}



============================================================
DISASSEMBLY
============================================================
0090a6c0 : PUSH EBP
0090a6c1 : MOV EBP,ESP
0090a6c3 : AND ESP,0xfffffff8
0090a6c6 : PUSH -0x1
0090a6c8 : PUSH 0xb2c770
0090a6cd : MOV EAX,FS:[0x0]
0090a6d3 : PUSH EAX
0090a6d4 : SUB ESP,0x74
0090a6d7 : MOV EAX,[0x00d66fa0]
0090a6dc : XOR EAX,ESP
0090a6de : MOV dword ptr [ESP + 0x6c],EAX
0090a6e2 : PUSH EBX
0090a6e3 : PUSH ESI
0090a6e4 : MOV EAX,[0x00d66fa0]
0090a6e9 : XOR EAX,ESP
0090a6eb : PUSH EAX
0090a6ec : LEA EAX,[ESP + 0x80]
0090a6f3 : MOV FS:[0x0],EAX
0090a6f9 : MOV ECX,dword ptr [EDI + 0x5c]
0090a6fc : MOV EAX,dword ptr [EBP + 0x10]
0090a6ff : MOV EDX,dword ptr [ECX + 0x38]
0090a702 : MOV dword ptr [ESP + 0x3c],EAX
0090a706 : MOV EAX,[0x01724910]
0090a70b : SHL EDX,0x4
0090a70e : LEA EAX,[EDX + EAX*0x1 + 0x24]
0090a712 : PUSH EAX
0090a713 : LEA ECX,[ESP + 0x20]
0090a717 : PUSH ECX
0090a718 : CALL 0x0047bc90
0090a71d : XOR ESI,ESI
0090a71f : MOV dword ptr [ESP + 0x88],ESI
0090a726 : MOV EAX,dword ptr [EBP + 0x8]
0090a729 : MOV EBX,dword ptr [0x00d7c54c]
0090a72f : MOV EDX,EAX
0090a731 : SHR EDX,0x10
0090a734 : MOV dword ptr [ESP + 0x18],ESI
0090a738 : CMP EDX,0x143e
0090a73e : JNZ 0x0090a772
0090a740 : MOV dword ptr [ESP + 0x10],EAX
0090a744 : LEA EAX,[ESP + 0x10]
0090a748 : PUSH EAX
0090a749 : LEA ECX,[EBX + 0x40]
0090a74c : LEA EAX,[ESP + 0x10]
0090a750 : CALL 0x004437f0
0090a755 : MOV EAX,dword ptr [EBX + 0x44]
0090a758 : MOV ECX,dword ptr [ESP + 0xc]
0090a75c : CMP ECX,EAX
0090a75e : JZ 0x0090a772
0090a760 : MOV EAX,dword ptr [ECX + 0x10]
0090a763 : CMP EAX,ESI
0090a765 : JZ 0x0090a772
0090a767 : MOVZX ECX,word ptr [EAX + 0x1a4]
0090a76e : MOV dword ptr [ESP + 0x18],ECX
0090a772 : MOV EAX,dword ptr [ESP + 0x20]
0090a776 : MOV dword ptr [ESP + 0x10],EAX
0090a77a : CMP EAX,dword ptr [ESP + 0x24]
0090a77e : JZ 0x0090aa12
0090a784 : MOV ESI,dword ptr [EAX]
0090a786 : MOV EAX,dword ptr [ESI]
0090a788 : MOV EDX,EAX
0090a78a : SHR EDX,0x10
0090a78d : MOV dword ptr [ESP + 0x14],ESI
0090a791 : CMP EDX,0x769
0090a797 : JNZ 0x0090a9f7
0090a79d : MOV dword ptr [ESP + 0xc],EAX
0090a7a1 : LEA EAX,[ESP + 0xc]
0090a7a5 : PUSH EAX
0090a7a6 : LEA ECX,[EBX + 0x40]
0090a7a9 : LEA EAX,[ESP + 0x38]
0090a7ad : CALL 0x004437f0
0090a7b2 : MOV EAX,dword ptr [EBX + 0x44]
0090a7b5 : MOV ECX,dword ptr [ESP + 0x34]
0090a7b9 : CMP ECX,EAX
0090a7bb : JZ 0x0090a9f7
0090a7c1 : MOV EAX,dword ptr [ECX + 0x10]
0090a7c4 : TEST EAX,EAX
0090a7c6 : JZ 0x0090a9f7
0090a7cc : MOV EDX,dword ptr [EAX + 0x1c40]
0090a7d2 : LEA EBX,[EAX + 0x1c40]
0090a7d8 : MOV EAX,dword ptr [EDX + 0x4]
0090a7db : MOV ECX,EBX
0090a7dd : MOV dword ptr [ESP + 0x30],EBX
0090a7e1 : CALL EAX
0090a7e3 : MOV dword ptr [ESP + 0xc],EAX
0090a7e7 : TEST EAX,EAX
0090a7e9 : JZ 0x0090a9f1
0090a7ef : JMP 0x0090a7f5
0090a7f1 : MOV EBX,dword ptr [ESP + 0x30]
0090a7f5 : LEA EDX,[ESP + 0xc]
0090a7f9 : MOV EAX,EBX
0090a7fb : CALL 0x004f5680
0090a800 : TEST EAX,EAX
0090a802 : JZ 0x0090a9e6
0090a808 : MOV ECX,dword ptr [ESP + 0x18]
0090a80c : TEST CX,CX
0090a80f : JZ 0x0090a817
0090a811 : CMP CX,word ptr [EAX + 0x6]
0090a815 : JMP 0x0090a827
0090a817 : MOVZX ECX,word ptr [EAX + 0x4]
0090a81b : MOVZX EDX,word ptr [EAX + 0x6]
0090a81f : SHL ECX,0x10
0090a822 : OR ECX,EDX
0090a824 : CMP ECX,dword ptr [EBP + 0x8]
0090a827 : JNZ 0x0090a9e6
0090a82d : MOV EBX,0x7
0090a832 : XOR EAX,EAX
0090a834 : MOV dword ptr [ESP + 0x74],EBX
0090a838 : MOV dword ptr [ESP + 0x70],0x0
0090a840 : MOV word ptr [ESP + 0x60],AX
0090a845 : MOV byte ptr [ESP + 0x88],0x1
0090a84d : MOV EAX,dword ptr [ESI]
0090a84f : MOV EDX,dword ptr [EDI]
0090a851 : MOV EDX,dword ptr [EDX + 0x58]
0090a854 : LEA ECX,[ESP + 0x5c]
0090a858 : PUSH ECX
0090a859 : PUSH EAX
0090a85a : MOV ECX,EDI
0090a85c : CALL EDX
0090a85e : SUB ESP,0x1c
0090a861 : MOV ECX,ESP
0090a863 : MOV dword ptr [ESP + 0x48],ESP
0090a867 : XOR EAX,EAX
0090a869 : PUSH -0x1
0090a86b : PUSH EAX
0090a86c : LEA EDX,[ESP + 0x80]
0090a873 : MOV dword ptr [ECX + 0x18],EBX
0090a876 : MOV dword ptr [ECX + 0x14],0x0
0090a87d : PUSH EDX
0090a87e : MOV word ptr [ECX + 0x4],AX
0090a882 : CALL 0x00405eb0
0090a887 : MOV byte ptr [ESP + 0xa4],0x2
0090a88f : MOV byte ptr [ESP + 0xa4],0x1
0090a897 : LEA ECX,[ESP + 0x5c]
0090a89b : CALL 0x008f75f0
0090a8a0 : ADD ESP,0x1c
0090a8a3 : MOV byte ptr [ESP + 0x88],0x3
0090a8ab : PUSH -0x1
0090a8ad : PUSH 0x0
0090a8af : PUSH EAX
0090a8b0 : LEA ECX,[ESP + 0x68]
0090a8b4 : CALL 0x00405eb0
0090a8b9 : MOV byte ptr [ESP + 0x88],0x1
0090a8c1 : CMP dword ptr [ESP + 0x58],0x8
0090a8c6 : JC 0x0090a8d1
0090a8c8 : MOV ECX,dword ptr [ESP + 0x44]
0090a8cc : CALL 0x006f04e0
0090a8d1 : MOV ECX,dword ptr [0x017247f0]
0090a8d7 : XOR EAX,EAX
0090a8d9 : MOV word ptr [ESP + 0x44],AX
0090a8de : MOV EAX,dword ptr [ESI]
0090a8e0 : MOV dword ptr [ESP + 0x58],EBX
0090a8e4 : MOV EBX,dword ptr [ESI + 0x4]
0090a8e7 : PUSH EAX
0090a8e8 : MOV dword ptr [ESP + 0x58],0x0
0090a8f0 : CALL 0x009f2740
0090a8f5 : MOV ESI,EAX
0090a8f7 : TEST ESI,ESI
0090a8f9 : JZ 0x0090a922
0090a8fb : LEA ECX,[ESP + 0x2c]
0090a8ff : PUSH ECX
0090a900 : LEA ECX,[ESI + 0x8]
0090a903 : LEA EAX,[ESP + 0x3c]
0090a907 : MOV dword ptr [ESP + 0x30],EBX
0090a90b : CALL 0x004437f0
0090a910 : MOV ESI,dword ptr [ESI + 0xc]
0090a913 : MOV EAX,dword ptr [ESP + 0x38]
0090a917 : CMP EAX,ESI
0090a919 : JZ 0x0090a922
0090a91b : MOV EAX,dword ptr [EAX + 0x10]
0090a91e : TEST EAX,EAX
0090a920 : JNZ 0x0090a946
0090a922 : MOV byte ptr [ESP + 0x88],0x0
0090a92a : CMP dword ptr [ESP + 0x74],0x8
0090a92f : JC 0x0090a93a
0090a931 : MOV ECX,dword ptr [ESP + 0x60]
0090a935 : CALL 0x006f04e0
0090a93a : XOR EDX,EDX
0090a93c : MOV word ptr [ESP + 0x60],DX
0090a941 : JMP 0x0090a9d2
0090a946 : MOV ESI,dword ptr [ESP + 0x3c]
0090a94a : MOVZX ECX,word ptr [ESI]
0090a94d : MOV EBX,dword ptr [EBP + 0xc]
0090a950 : PUSH ECX
0090a951 : PUSH EBX
0090a952 : PUSH EAX
0090a953 : MOV ECX,EDI
0090a955 : CALL 0x009094a0
0090a95a : MOV EDX,dword ptr [0x00da9894]
0090a960 : MOV EAX,dword ptr [EDX]
0090a962 : TEST EAX,EAX
0090a964 : JZ 0x0090a9a8
0090a966 : CMP dword ptr [EAX + 0x114],0x0
0090a96d : JZ 0x0090a9a8
0090a96f : CMP dword ptr [ESP + 0x74],0x8
0090a974 : MOV EAX,dword ptr [EAX + 0x114]
0090a97a : MOV ECX,dword ptr [ESP + 0x60]
0090a97e : JNC 0x0090a984
0090a980 : LEA ECX,[ESP + 0x60]
0090a984 : MOV EDX,dword ptr [EAX]
0090a986 : MOV EDX,dword ptr [EDX + 0x4]
0090a989 : PUSH ECX
0090a98a : MOV ECX,dword ptr [ESI]
0090a98c : PUSH ECX
0090a98d : MOVZX ECX,BX
0090a990 : PUSH ECX
0090a991 : MOV ECX,dword ptr [EDI + 0x5c]
0090a994 : MOV ECX,dword ptr [ECX + 0x38]
0090a997 : PUSH ECX
0090a998 : PUSH 0xc64f88
0090a99d : PUSH 0xc64f98
0090a9a2 : PUSH EAX
0090a9a3 : CALL EDX
0090a9a5 : ADD ESP,0x1c
0090a9a8 : INC dword ptr [ESI]
0090a9aa : CMP dword ptr [ESI],0x2
0090a9ad : JG 0x0090aa56
0090a9b3 : MOV byte ptr [ESP + 0x88],0x0
0090a9bb : CMP dword ptr [ESP + 0x74],0x8
0090a9c0 : JC 0x0090a9cb
0090a9c2 : MOV ECX,dword ptr [ESP + 0x60]
0090a9c6 : CALL 0x006f04e0
0090a9cb : XOR EAX,EAX
0090a9cd : MOV word ptr [ESP + 0x60],AX
0090a9d2 : MOV ESI,dword ptr [ESP + 0x14]
0090a9d6 : MOV dword ptr [ESP + 0x70],0x0
0090a9de : MOV dword ptr [ESP + 0x74],0x7
0090a9e6 : CMP dword ptr [ESP + 0xc],0x0
0090a9eb : JNZ 0x0090a7f1
0090a9f1 : MOV EBX,dword ptr [0x00d7c54c]
0090a9f7 : MOV EAX,dword ptr [ESP + 0x10]
0090a9fb : ADD EAX,0x4
0090a9fe : MOV dword ptr [ESP + 0x10],EAX
0090aa02 : CMP EAX,dword ptr [ESP + 0x24]
0090aa06 : JNZ 0x0090a784
0090aa0c : MOV EAX,dword ptr [ESP + 0x20]
0090aa10 : XOR ESI,ESI
0090aa12 : MOV dword ptr [ESP + 0x88],0xffffffff
0090aa1d : CMP EAX,ESI
0090aa1f : JZ 0x0090aa28
0090aa21 : MOV ECX,EAX
0090aa23 : CALL 0x006f04e0
0090aa28 : MOV dword ptr [ESP + 0x20],ESI
0090aa2c : MOV dword ptr [ESP + 0x24],ESI
0090aa30 : MOV dword ptr [ESP + 0x28],ESI
0090aa34 : MOV ECX,dword ptr [ESP + 0x80]
0090aa3b : MOV dword ptr FS:[0x0],ECX
0090aa42 : POP ECX
0090aa43 : POP ESI
0090aa44 : POP EBX
0090aa45 : MOV ECX,dword ptr [ESP + 0x6c]
0090aa49 : XOR ECX,ESP
0090aa4b : CALL 0x00633e6b
0090aa50 : MOV ESP,EBP
0090aa52 : POP EBP
0090aa53 : RET 0xc
0090aa56 : MOV byte ptr [ESP + 0x88],0x0
0090aa5e : CMP dword ptr [ESP + 0x74],0x8
0090aa63 : JC 0x0090aa6e
0090aa65 : MOV ECX,dword ptr [ESP + 0x60]
0090aa69 : CALL 0x006f04e0
0090aa6e : XOR ECX,ECX
0090aa70 : MOV dword ptr [ESP + 0x74],0x7
0090aa78 : MOV dword ptr [ESP + 0x70],0x0
0090aa80 : MOV word ptr [ESP + 0x60],CX
0090aa85 : MOV dword ptr [ESP + 0x88],0xffffffff
0090aa90 : MOV ECX,dword ptr [ESP + 0x20]
0090aa94 : TEST ECX,ECX
0090aa96 : JZ 0x0090aa9d
0090aa98 : CALL 0x006f04e0
0090aa9d : XOR EAX,EAX
0090aa9f : MOV dword ptr [ESP + 0x20],EAX
0090aaa3 : MOV dword ptr [ESP + 0x24],EAX
0090aaa7 : MOV dword ptr [ESP + 0x28],EAX
0090aaab : JMP 0x0090aa34
