PROGRAM  : Maestia.exe
FUNCTION : FUN_004728f0
ENTRY    : 004728f0
BODY     : [[004728f0, 00472998]]

============================================================
DECOMPILED C CODE
============================================================

undefined1 FUN_004728f0(void)

{
  undefined1 uVar1;
  int iVar2;
  int unaff_EDI;
  
  if (*(int *)(unaff_EDI + 0x28) == 0) {
    uVar1 = 0;
  }
  else {
    uVar1 = FUN_00472880(*(int *)(unaff_EDI + 0x28),
                         *(uint *)(unaff_EDI + 0x2c) / *(uint *)(unaff_EDI + 0x38),
                         *(uint *)(unaff_EDI + 0x38));
  }
  if (*(char *)(unaff_EDI + 0x34) == '\0') {
    FUN_00455c80();
    *(undefined4 *)(unaff_EDI + 0x28) = 0;
    *(undefined4 *)(unaff_EDI + 0x30) = 0;
    *(undefined4 *)(unaff_EDI + 0x2c) = 0;
  }
  else {
    *(undefined4 *)(unaff_EDI + 0x2c) = 0;
  }
  if (-1 < *(int *)(unaff_EDI + 0x60)) {
    iVar2 = *(int *)(unaff_EDI + 0x60) * 0x114;
    if ((&DAT_017212d0)[iVar2] != '\0') {
      (&DAT_017212d0)[iVar2] = 0;
      *(undefined4 *)(&DAT_017211cc + iVar2) = 0;
      (&DAT_017211d0)[iVar2] = 0;
      *(undefined4 *)(unaff_EDI + 0x60) = 0xffffffff;
      return uVar1;
    }
    FUN_00807d70("CSharedHeapBlock::Unlock() called when buffer was not locked");
    *(undefined4 *)(unaff_EDI + 0x60) = 0xffffffff;
  }
  return uVar1;
}



============================================================
DISASSEMBLY
============================================================
004728f0 : PUSH EBP
004728f1 : MOV EBP,ESP
004728f3 : PUSH ECX
004728f4 : MOV EAX,dword ptr [EDI + 0x2c]
004728f7 : MOV ECX,dword ptr [EDI + 0x28]
004728fa : PUSH EBX
004728fb : PUSH ESI
004728fc : MOV ESI,dword ptr [EDI + 0x38]
004728ff : XOR EDX,EDX
00472901 : DIV ESI
00472903 : TEST ECX,ECX
00472905 : JZ 0x00472916
00472907 : PUSH ESI
00472908 : PUSH EAX
00472909 : PUSH ECX
0047290a : LEA EAX,[EDI + 0x4]
0047290d : CALL 0x00472880
00472912 : MOV BL,AL
00472914 : JMP 0x00472918
00472916 : XOR BL,BL
00472918 : CMP byte ptr [EDI + 0x34],0x0
0047291c : JZ 0x00472927
0047291e : MOV dword ptr [EDI + 0x2c],0x0
00472925 : JMP 0x00472940
00472927 : MOV EAX,dword ptr [EDI + 0x28]
0047292a : LEA ESI,[EBP + -0x4]
0047292d : MOV dword ptr [EBP + -0x4],EAX
00472930 : CALL 0x00455c80
00472935 : XOR EAX,EAX
00472937 : MOV dword ptr [EDI + 0x28],EAX
0047293a : MOV dword ptr [EDI + 0x30],EAX
0047293d : MOV dword ptr [EDI + 0x2c],EAX
00472940 : MOV EAX,dword ptr [EDI + 0x60]
00472943 : CMP EAX,-0x1
00472946 : JLE 0x00472991
00472948 : IMUL EAX,EAX,0x114
0047294e : ADD EAX,0x17211c0
00472953 : CMP byte ptr [EAX + 0x110],0x0
0047295a : JZ 0x0047297d
0047295c : MOV byte ptr [EAX + 0x110],0x0
00472963 : MOV dword ptr [EAX + 0xc],0x0
0047296a : MOV byte ptr [EAX + 0x10],0x0
0047296e : POP ESI
0047296f : MOV AL,BL
00472971 : MOV dword ptr [EDI + 0x60],0xffffffff
00472978 : POP EBX
00472979 : MOV ESP,EBP
0047297b : POP EBP
0047297c : RET
0047297d : PUSH 0xcd4178
00472982 : CALL 0x00807d70
00472987 : ADD ESP,0x4
0047298a : MOV dword ptr [EDI + 0x60],0xffffffff
00472991 : POP ESI
00472992 : MOV AL,BL
00472994 : POP EBX
00472995 : MOV ESP,EBP
00472997 : POP EBP
00472998 : RET
