PROGRAM  : Maestia.exe
FUNCTION : FUN_006b6670
ENTRY    : 006b6670
BODY     : [[006b6670, 006b6897]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_006b6670(void)

{
  byte *pbVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  int iVar6;
  int iVar7;
  ushort *in_EAX;
  int iVar8;
  int iVar9;
  uint uVar10;
  int iVar11;
  int iVar12;
  int iVar13;
  int iVar14;
  int iVar15;
  int iVar16;
  int unaff_ESI;
  
  if ((((*(ushort *)(unaff_ESI + 0x2c) <= in_EAX[6]) || (*(ushort *)(unaff_ESI + 0x2c) <= in_EAX[8])
       ) || (*(ushort *)(unaff_ESI + 0x50) <= in_EAX[2])) ||
     ((*(ushort *)(unaff_ESI + 0x50) <= in_EAX[4] || (*(ushort *)(unaff_ESI + 0x74) <= *in_EAX)))) {
    if (*(char *)(unaff_ESI + 0x231) != '\0') {
      *(undefined4 *)(unaff_ESI + 0xc) = 0x86;
    }
    return;
  }
  iVar13 = *(int *)(unaff_ESI + 0x34);
  iVar4 = (uint)in_EAX[8] * 8;
  iVar5 = (uint)in_EAX[6] * 8;
  iVar14 = *(int *)(iVar13 + iVar5);
  iVar16 = *(int *)(iVar13 + iVar4) - iVar14;
  iVar15 = *(int *)(iVar13 + 4 + iVar5);
  iVar13 = *(int *)(iVar13 + 4 + iVar4);
  iVar6 = (uint)in_EAX[4] * 8;
  iVar7 = (uint)in_EAX[2] * 8;
  iVar2 = *(int *)(iVar7 + *(int *)(unaff_ESI + 0x58));
  iVar9 = *(int *)(unaff_ESI + 0x58);
  iVar8 = *(int *)(iVar9 + iVar6) - iVar2;
  iVar3 = *(int *)(iVar7 + 4 + iVar9);
  iVar9 = *(int *)(iVar9 + 4 + iVar6) - iVar3;
  uVar10 = (uint)*in_EAX;
  pbVar1 = (byte *)(uVar10 + *(int *)(unaff_ESI + 0x84));
  *pbVar1 = *pbVar1 | 0x18;
  iVar11 = -(iVar13 - iVar15);
  iVar12 = FUN_00685d60(iVar8,iVar11,0x40);
  iVar13 = FUN_00685d60(iVar9,iVar16,0x40);
  iVar12 = iVar12 + iVar13;
  iVar13 = iVar12;
  if (iVar12 < 0) {
    iVar13 = -iVar12;
  }
  if (0x3f < iVar13) {
    iVar13 = FUN_00685d60(iVar14 - iVar2,iVar11,0x40);
    iVar14 = FUN_00685d60(iVar15 - iVar3,iVar16,0x40);
    iVar15 = FUN_00685d60(iVar13 + iVar14,iVar8,iVar12);
    iVar13 = FUN_00685d60(iVar13 + iVar14,iVar9,iVar12);
    *(int *)(*(int *)(unaff_ESI + 0x7c) + uVar10 * 8) =
         *(int *)(*(int *)(unaff_ESI + 0x58) + iVar7) + iVar15;
    *(int *)(*(int *)(unaff_ESI + 0x7c) + 4 + uVar10 * 8) =
         *(int *)(*(int *)(unaff_ESI + 0x58) + 4 + iVar7) + iVar13;
    return;
  }
  iVar13 = *(int *)(iVar7 + *(int *)(unaff_ESI + 0x58)) +
           *(int *)(*(int *)(unaff_ESI + 0x58) + iVar6) +
           *(int *)(*(int *)(unaff_ESI + 0x34) + iVar5) +
           *(int *)(*(int *)(unaff_ESI + 0x34) + iVar4);
  *(int *)(*(int *)(unaff_ESI + 0x7c) + uVar10 * 8) = (int)(iVar13 + (iVar13 >> 0x1f & 3U)) >> 2;
  iVar13 = *(int *)(iVar7 + 4 + *(int *)(unaff_ESI + 0x58)) +
           *(int *)(*(int *)(unaff_ESI + 0x58) + 4 + iVar6) +
           *(int *)(*(int *)(unaff_ESI + 0x34) + 4 + iVar5) +
           *(int *)(*(int *)(unaff_ESI + 0x34) + 4 + iVar4);
  *(int *)(*(int *)(unaff_ESI + 0x7c) + 4 + uVar10 * 8) = (int)(iVar13 + (iVar13 >> 0x1f & 3U)) >> 2
  ;
  return;
}



============================================================
DISASSEMBLY
============================================================
006b6670 : SUB ESP,0x28
006b6673 : MOVZX ECX,word ptr [EAX + 0xc]
006b6677 : MOVZX EDX,word ptr [ESI + 0x2c]
006b667b : PUSH EBX
006b667c : MOVZX EBX,word ptr [EAX + 0x8]
006b6680 : PUSH EBP
006b6681 : MOVZX EBP,word ptr [EAX]
006b6684 : PUSH EDI
006b6685 : MOVZX EDI,word ptr [EAX + 0x4]
006b6689 : MOVZX EAX,word ptr [EAX + 0x10]
006b668d : MOV dword ptr [ESP + 0x24],EBP
006b6691 : MOV dword ptr [ESP + 0x20],EBX
006b6695 : CMP CX,DX
006b6698 : JNC 0x006b6881
006b669e : CMP AX,DX
006b66a1 : JNC 0x006b6881
006b66a7 : MOVZX EDX,word ptr [ESI + 0x50]
006b66ab : CMP DI,DX
006b66ae : JNC 0x006b6881
006b66b4 : CMP BX,DX
006b66b7 : JNC 0x006b6881
006b66bd : CMP BP,word ptr [ESI + 0x74]
006b66c1 : JNC 0x006b6881
006b66c7 : MOVZX EBX,AX
006b66ca : MOV EAX,dword ptr [ESI + 0x34]
006b66cd : MOVZX EBP,CX
006b66d0 : ADD EBX,EBX
006b66d2 : ADD EBP,EBP
006b66d4 : ADD EBX,EBX
006b66d6 : ADD EBP,EBP
006b66d8 : ADD EBX,EBX
006b66da : MOV EDX,dword ptr [EAX + EBX*0x1]
006b66dd : ADD EBP,EBP
006b66df : MOV ECX,dword ptr [EAX + EBP*0x1]
006b66e2 : SUB EDX,ECX
006b66e4 : MOV dword ptr [ESP + 0x14],EDX
006b66e8 : MOV EDX,dword ptr [EAX + EBP*0x1 + 0x4]
006b66ec : MOV EAX,dword ptr [EAX + EBX*0x1 + 0x4]
006b66f0 : SUB EAX,EDX
006b66f2 : MOV dword ptr [ESP + 0x28],EAX
006b66f6 : MOVZX EAX,word ptr [ESP + 0x20]
006b66fb : ADD EAX,EAX
006b66fd : ADD EAX,EAX
006b66ff : MOVZX EDI,DI
006b6702 : MOV dword ptr [ESP + 0x1c],EDX
006b6706 : MOV EDX,dword ptr [ESI + 0x58]
006b6709 : ADD EAX,EAX
006b670b : MOV dword ptr [ESP + 0xc],EAX
006b670f : ADD EDI,EDI
006b6711 : ADD EDI,EDI
006b6713 : ADD EDI,EDI
006b6715 : MOV EDX,dword ptr [EDI + EDX*0x1]
006b6718 : MOV dword ptr [ESP + 0x10],EDX
006b671c : MOV EDX,dword ptr [ESI + 0x58]
006b671f : MOV EAX,dword ptr [EDX + EAX*0x1]
006b6722 : SUB EAX,dword ptr [ESP + 0x10]
006b6726 : SUB ECX,dword ptr [ESP + 0x10]
006b672a : MOV dword ptr [ESP + 0x18],EAX
006b672e : MOV EAX,EDX
006b6730 : MOV EDX,dword ptr [EDI + EAX*0x1 + 0x4]
006b6734 : MOV dword ptr [ESP + 0x20],EDX
006b6738 : MOV EDX,dword ptr [ESP + 0xc]
006b673c : MOV EAX,dword ptr [EAX + EDX*0x1 + 0x4]
006b6740 : MOV EDX,dword ptr [ESP + 0x20]
006b6744 : SUB EAX,EDX
006b6746 : MOV dword ptr [ESP + 0x20],EAX
006b674a : MOV EAX,dword ptr [ESP + 0x1c]
006b674e : SUB EAX,EDX
006b6750 : MOV EDX,dword ptr [ESP + 0x18]
006b6754 : MOV dword ptr [ESP + 0x30],EAX
006b6758 : MOVZX EAX,word ptr [ESP + 0x24]
006b675d : MOV dword ptr [ESP + 0x2c],ECX
006b6761 : MOV ECX,dword ptr [ESI + 0x84]
006b6767 : OR byte ptr [EAX + ECX*0x1],0x18
006b676b : MOV dword ptr [ESP + 0x10],EAX
006b676f : ADD EAX,ECX
006b6771 : MOV EAX,dword ptr [ESP + 0x28]
006b6775 : NEG EAX
006b6777 : PUSH 0x40
006b6779 : PUSH EAX
006b677a : PUSH EDX
006b677b : MOV dword ptr [ESP + 0x30],EAX
006b677f : CALL 0x00685d60
006b6784 : MOV ECX,dword ptr [ESP + 0x2c]
006b6788 : MOV dword ptr [ESP + 0x34],EAX
006b678c : MOV EAX,dword ptr [ESP + 0x20]
006b6790 : PUSH 0x40
006b6792 : PUSH EAX
006b6793 : PUSH ECX
006b6794 : CALL 0x00685d60
006b6799 : MOV ECX,dword ptr [ESP + 0x40]
006b679d : ADD ESP,0x18
006b67a0 : ADD ECX,EAX
006b67a2 : MOV dword ptr [ESP + 0x1c],ECX
006b67a6 : JNS 0x006b67aa
006b67a8 : NEG ECX
006b67aa : CMP ECX,0x40
006b67ad : JL 0x006b6823
006b67af : MOV EDX,dword ptr [ESP + 0x24]
006b67b3 : MOV EAX,dword ptr [ESP + 0x2c]
006b67b7 : PUSH 0x40
006b67b9 : PUSH EDX
006b67ba : PUSH EAX
006b67bb : CALL 0x00685d60
006b67c0 : MOV ECX,dword ptr [ESP + 0x20]
006b67c4 : MOV EDX,dword ptr [ESP + 0x3c]
006b67c8 : PUSH 0x40
006b67ca : PUSH ECX
006b67cb : PUSH EDX
006b67cc : MOV EBX,EAX
006b67ce : CALL 0x00685d60
006b67d3 : MOV ECX,dword ptr [ESP + 0x30]
006b67d7 : ADD EBX,EAX
006b67d9 : MOV EAX,dword ptr [ESP + 0x34]
006b67dd : PUSH EAX
006b67de : PUSH ECX
006b67df : PUSH EBX
006b67e0 : CALL 0x00685d60
006b67e5 : MOV EDX,dword ptr [ESP + 0x40]
006b67e9 : MOV EBP,EAX
006b67eb : MOV EAX,dword ptr [ESP + 0x44]
006b67ef : PUSH EDX
006b67f0 : PUSH EAX
006b67f1 : PUSH EBX
006b67f2 : CALL 0x00685d60
006b67f7 : MOV ECX,dword ptr [ESI + 0x58]
006b67fa : MOV EDX,dword ptr [ECX + EDI*0x1]
006b67fd : MOV EBX,dword ptr [ESI + 0x7c]
006b6800 : MOV ECX,dword ptr [ESP + 0x40]
006b6804 : ADD EDX,EBP
006b6806 : MOV dword ptr [EBX + ECX*0x8],EDX
006b6809 : MOV EDX,dword ptr [ESI + 0x58]
006b680c : MOV EDX,dword ptr [EDX + EDI*0x1 + 0x4]
006b6810 : ADD ESP,0x30
006b6813 : POP EDI
006b6814 : ADD EDX,EAX
006b6816 : MOV EAX,dword ptr [ESI + 0x7c]
006b6819 : POP EBP
006b681a : MOV dword ptr [EAX + ECX*0x8 + 0x4],EDX
006b681e : POP EBX
006b681f : ADD ESP,0x28
006b6822 : RET
006b6823 : MOV ECX,dword ptr [ESI + 0x58]
006b6826 : MOV EAX,dword ptr [EDI + ECX*0x1]
006b6829 : MOV EDX,dword ptr [ESP + 0xc]
006b682d : ADD EAX,dword ptr [ECX + EDX*0x1]
006b6830 : MOV ECX,dword ptr [ESI + 0x34]
006b6833 : ADD EAX,dword ptr [ECX + EBP*0x1]
006b6836 : ADD EAX,dword ptr [ECX + EBX*0x1]
006b6839 : MOV ECX,dword ptr [ESI + 0x7c]
006b683c : CDQ
006b683d : AND EDX,0x3
006b6840 : ADD EAX,EDX
006b6842 : MOV EDX,dword ptr [ESP + 0x10]
006b6846 : SAR EAX,0x2
006b6849 : MOV dword ptr [ECX + EDX*0x8],EAX
006b684c : MOV EDX,dword ptr [ESI + 0x58]
006b684f : MOV EAX,dword ptr [EDI + EDX*0x1 + 0x4]
006b6853 : MOV EDI,dword ptr [ESP + 0xc]
006b6857 : ADD EAX,dword ptr [EDX + EDI*0x1 + 0x4]
006b685b : MOV ECX,dword ptr [ESI + 0x34]
006b685e : ADD EAX,dword ptr [ECX + EBP*0x1 + 0x4]
006b6862 : POP EDI
006b6863 : ADD EAX,dword ptr [ECX + EBX*0x1 + 0x4]
006b6867 : MOV ECX,dword ptr [ESI + 0x7c]
006b686a : CDQ
006b686b : AND EDX,0x3
006b686e : ADD EAX,EDX
006b6870 : MOV EDX,dword ptr [ESP + 0xc]
006b6874 : SAR EAX,0x2
006b6877 : POP EBP
006b6878 : MOV dword ptr [ECX + EDX*0x8 + 0x4],EAX
006b687c : POP EBX
006b687d : ADD ESP,0x28
006b6880 : RET
006b6881 : CMP byte ptr [ESI + 0x231],0x0
006b6888 : JZ 0x006b6891
006b688a : MOV dword ptr [ESI + 0xc],0x86
006b6891 : POP EDI
006b6892 : POP EBP
006b6893 : POP EBX
006b6894 : ADD ESP,0x28
006b6897 : RET
