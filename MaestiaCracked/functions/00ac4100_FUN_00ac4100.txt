PROGRAM  : Maestia.exe
FUNCTION : FUN_00ac4100
ENTRY    : 00ac4100
BODY     : [[00ac4100, 00ac432e]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00ac4100(int param_1,int param_2)

{
  undefined2 uVar1;
  int *piVar2;
  uint uVar3;
  uint8_t *packet;
  int iVar4;
  undefined4 uVar5;
  byte bVar6;
  undefined1 local_48 [28];
  undefined1 local_2c [28];
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b4cd8a;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if (param_2 != 0) {
    if (param_1 == 0) {
      iVar4 = *(int *)ThreadLocalStoragePointer;
      bVar6 = (byte)((ulonglong)(*(byte *)(iVar4 + 0x18) + 1) % 3);
      *(byte *)(iVar4 + 0x18) = bVar6;
      packet = (uint8_t *)((uint)bVar6 * 0x2000 + 0x122cb8 + iVar4);
      if (packet == (uint8_t *)0x0) {
        packet = (uint8_t *)0x0;
      }
      else {
        uVar1 = *(undefined2 *)(*(int *)(*DAT_00da9894 + 0x128) + 0x84);
        uVar5 = *(undefined4 *)(param_2 + 0xc);
        packet[0] = '\0';
        packet[1] = '\0';
        packet[2] = 0x99;
        packet[3] = '\x03';
        *(undefined4 *)(packet + 4) = uVar5;
        packet[8] = (uint8_t)uVar1;
      }
      local_8 = 0xffffffff;
      if (((*(int *)(DAT_017247d4 + 4) == 0) || (*(char *)(DAT_017247d4 + 8) == '\0')) ||
         (iVar4 = FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),9,packet), iVar4 == 0)) {
        if (DAT_0172491c == 0) {
          ExceptionList = local_10;
          return;
        }
        if (*DAT_00da9894 == 0) {
          ExceptionList = local_10;
          return;
        }
        if (*(int *)(*DAT_00da9894 + 0x1a8) == 0) {
          ExceptionList = local_10;
          return;
        }
        FUN_00406460(L"send to server failed");
        local_8 = 2;
        piVar2 = *(int **)(*DAT_00da9894 + 0x1a8);
        uVar5 = FUN_0081d120(local_48);
        local_8._0_1_ = 3;
        (**(code **)(*piVar2 + 0x44))(uVar5,3);
        local_8 = CONCAT31(local_8._1_3_,2);
        FUN_00406560();
      }
      else {
        iVar4 = *DAT_00da9894;
        if ((iVar4 != 0) && (*(int *)(iVar4 + 0x128) != 0)) {
          FUN_0097fca0(*(undefined4 *)(iVar4 + 0x128));
          FUN_0097fa60();
          ExceptionList = local_10;
          return;
        }
        FUN_00406460(&DAT_00c9374c);
        local_8 = 1;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"DecomposeItemCallback",0x7f,local_2c);
        }
      }
      local_8 = 0xffffffff;
      FUN_00406560();
    }
    else if (((param_1 == 1) && (*DAT_00da9894 != 0)) &&
            (iVar4 = *(int *)(*DAT_00da9894 + 0x128), iVar4 != 0)) {
      FUN_0097fca0(iVar4);
      FUN_0097fa60(uVar3);
      ExceptionList = local_10;
      return;
    }
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00ac4100 : PUSH EBP
00ac4101 : MOV EBP,ESP
00ac4103 : PUSH -0x1
00ac4105 : PUSH 0xb4cd8a
00ac410a : MOV EAX,FS:[0x0]
00ac4110 : PUSH EAX
00ac4111 : SUB ESP,0x54
00ac4114 : PUSH ESI
00ac4115 : PUSH EDI
00ac4116 : MOV EAX,[0x00d66fa0]
00ac411b : XOR EAX,EBP
00ac411d : PUSH EAX
00ac411e : LEA EAX,[EBP + -0xc]
00ac4121 : MOV FS:[0x0],EAX
00ac4127 : MOV ESI,dword ptr [EBP + 0xc]
00ac412a : TEST ESI,ESI
00ac412c : JZ 0x00ac431c
00ac4132 : MOV EAX,dword ptr [EBP + 0x8]
00ac4135 : SUB EAX,0x0
00ac4138 : JZ 0x00ac418c
00ac413a : SUB EAX,0x1
00ac413d : JNZ 0x00ac431c
00ac4143 : MOV EAX,[0x00da9894]
00ac4148 : MOV EAX,dword ptr [EAX]
00ac414a : TEST EAX,EAX
00ac414c : JZ 0x00ac431c
00ac4152 : MOV EAX,dword ptr [EAX + 0x128]
00ac4158 : TEST EAX,EAX
00ac415a : JZ 0x00ac431c
00ac4160 : PUSH EAX
00ac4161 : CALL 0x0097fca0
00ac4166 : MOV ECX,dword ptr [0x00da9894]
00ac416c : MOV EDX,dword ptr [ECX]
00ac416e : MOV ECX,dword ptr [EDX + 0x128]
00ac4174 : CALL 0x0097fa60
00ac4179 : MOV ECX,dword ptr [EBP + -0xc]
00ac417c : MOV dword ptr FS:[0x0],ECX
00ac4183 : POP ECX
00ac4184 : POP EDI
00ac4185 : POP ESI
00ac4186 : MOV ESP,EBP
00ac4188 : POP EBP
00ac4189 : RET 0x8
00ac418c : MOV EAX,FS:[0x2c]
00ac4192 : MOV ECX,dword ptr [EAX]
00ac4194 : MOVZX EAX,byte ptr [ECX + 0x18]
00ac4198 : INC EAX
00ac4199 : CDQ
00ac419a : MOV EDI,0x3
00ac419f : IDIV EDI
00ac41a1 : MOV byte ptr [ECX + 0x18],DL
00ac41a4 : MOVZX EDX,DL
00ac41a7 : SHL EDX,0xd
00ac41aa : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
00ac41b1 : MOV dword ptr [EBP + 0xc],EAX
00ac41b4 : MOV dword ptr [EBP + -0x4],0x0
00ac41bb : TEST EAX,EAX
00ac41bd : JZ 0x00ac41ec
00ac41bf : MOV ECX,dword ptr [0x00da9894]
00ac41c5 : MOV ECX,dword ptr [ECX]
00ac41c7 : MOV ECX,dword ptr [ECX + 0x128]
00ac41cd : MOVZX ECX,word ptr [ECX + 0x84]
00ac41d4 : MOV EDX,dword ptr [ESI + 0xc]
00ac41d7 : XOR ESI,ESI
00ac41d9 : MOV word ptr [EAX],SI
00ac41dc : MOV byte ptr [EAX + 0x2],0x99
00ac41e0 : MOV byte ptr [EAX + 0x3],0x3
00ac41e4 : MOV dword ptr [EAX + 0x4],EDX
00ac41e7 : MOV byte ptr [EAX + 0x8],CL
00ac41ea : JMP 0x00ac41ee
00ac41ec : XOR EAX,EAX
00ac41ee : OR ESI,0xffffffff
00ac41f1 : MOV dword ptr [EBP + -0x4],ESI
00ac41f4 : MOV EDX,dword ptr [0x017247d4]
00ac41fa : MOV ECX,dword ptr [EDX + 0x4]
00ac41fd : TEST ECX,ECX
00ac41ff : JZ 0x00ac42a1
00ac4205 : CMP byte ptr [EDX + 0x8],0x0
00ac4209 : JZ 0x00ac42a1
00ac420f : PUSH 0x9
00ac4211 : PUSH ECX
00ac4212 : MOV EDI,EAX
00ac4214 : CALL 0x00a0dd40
00ac4219 : TEST EAX,EAX
00ac421b : JZ 0x00ac42a1
00ac4221 : MOV EDX,dword ptr [0x00da9894]
00ac4227 : MOV EAX,dword ptr [EDX]
00ac4229 : TEST EAX,EAX
00ac422b : JZ 0x00ac4268
00ac422d : CMP dword ptr [EAX + 0x128],0x0
00ac4234 : JZ 0x00ac4268
00ac4236 : MOV EAX,dword ptr [EAX + 0x128]
00ac423c : PUSH EAX
00ac423d : CALL 0x0097fca0
00ac4242 : MOV ECX,dword ptr [0x00da9894]
00ac4248 : MOV EDX,dword ptr [ECX]
00ac424a : MOV ECX,dword ptr [EDX + 0x128]
00ac4250 : CALL 0x0097fa60
00ac4255 : MOV ECX,dword ptr [EBP + -0xc]
00ac4258 : MOV dword ptr FS:[0x0],ECX
00ac425f : POP ECX
00ac4260 : POP EDI
00ac4261 : POP ESI
00ac4262 : MOV ESP,EBP
00ac4264 : POP EBP
00ac4265 : RET 0x8
00ac4268 : PUSH 0xc9374c
00ac426d : LEA ECX,[EBP + -0x28]
00ac4270 : CALL 0x00406460
00ac4275 : MOV dword ptr [EBP + -0x4],0x1
00ac427c : MOV EAX,[0x00da98e8]
00ac4281 : MOV ECX,dword ptr [EAX]
00ac4283 : TEST ECX,ECX
00ac4285 : JZ 0x00ac4299
00ac4287 : MOV EDX,dword ptr [ECX]
00ac4289 : MOV EDX,dword ptr [EDX + 0x14]
00ac428c : LEA EAX,[EBP + -0x28]
00ac428f : PUSH EAX
00ac4290 : PUSH 0x7f
00ac4292 : PUSH 0xc93754
00ac4297 : CALL EDX
00ac4299 : MOV dword ptr [EBP + -0x4],ESI
00ac429c : LEA ECX,[EBP + -0x28]
00ac429f : JMP 0x00ac4317
00ac42a1 : CMP dword ptr [0x0172491c],0x0
00ac42a8 : JZ 0x00ac431c
00ac42aa : MOV EAX,[0x00da9894]
00ac42af : MOV EAX,dword ptr [EAX]
00ac42b1 : TEST EAX,EAX
00ac42b3 : JZ 0x00ac431c
00ac42b5 : CMP dword ptr [EAX + 0x1a8],0x0
00ac42bc : JZ 0x00ac431c
00ac42be : PUSH 0xc93780
00ac42c3 : LEA ECX,[EBP + -0x44]
00ac42c6 : CALL 0x00406460
00ac42cb : MOV dword ptr [EBP + -0x4],0x2
00ac42d2 : MOV ECX,dword ptr [0x00da9894]
00ac42d8 : MOV EAX,dword ptr [ECX]
00ac42da : MOV ECX,dword ptr [0x0172491c]
00ac42e0 : MOV ESI,dword ptr [EAX + 0x1a8]
00ac42e6 : LEA EDX,[EBP + -0x44]
00ac42e9 : PUSH EDX
00ac42ea : LEA EDI,[EBP + -0x60]
00ac42ed : CALL 0x0081d120
00ac42f2 : MOV byte ptr [EBP + -0x4],0x3
00ac42f6 : MOV EDX,dword ptr [ESI]
00ac42f8 : PUSH 0x3
00ac42fa : PUSH EAX
00ac42fb : MOV EAX,dword ptr [EDX + 0x44]
00ac42fe : MOV ECX,ESI
00ac4300 : CALL EAX
00ac4302 : MOV byte ptr [EBP + -0x4],0x2
00ac4306 : MOV ECX,EDI
00ac4308 : CALL 0x00406560
00ac430d : MOV dword ptr [EBP + -0x4],0xffffffff
00ac4314 : LEA ECX,[EBP + -0x44]
00ac4317 : CALL 0x00406560
00ac431c : MOV ECX,dword ptr [EBP + -0xc]
00ac431f : MOV dword ptr FS:[0x0],ECX
00ac4326 : POP ECX
00ac4327 : POP EDI
00ac4328 : POP ESI
00ac4329 : MOV ESP,EBP
00ac432b : POP EBP
00ac432c : RET 0x8
