PROGRAM  : Maestia.exe
FUNCTION : FUN_00a7c380
ENTRY    : 00a7c380
BODY     : [[00a7c380, 00a7c4fe]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a7c380(void)

{
  uint uVar1;
  undefined4 uVar2;
  int iVar3;
  int in_ECX;
  undefined1 local_50 [28];
  int local_34;
  undefined1 local_30 [4];
  undefined4 ****local_2c [5];
  uint local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b34f42;
  local_10 = ExceptionList;
  uVar1 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_14 = uVar1;
  FUN_0042ee80(&stack0x00000004);
  if ((local_34 != *(int *)(in_ECX + 0xac)) && (*(int *)(local_34 + 0x18) != 0)) {
    *(undefined8 *)(in_ECX + 0xb4) = *(undefined8 *)(local_34 + 0x10);
    *(undefined8 *)(in_ECX + 0xbc) = *(undefined8 *)(local_34 + 0x18);
    *(undefined8 *)(in_ECX + 0xc4) = *(undefined8 *)(local_34 + 0x20);
    if (*(int *)(*(int *)(local_34 + 0x10) + 4) == 1) {
      FUN_00406460(L"IDS_CRAFT_ADDOPTION_ITEM_USE");
      local_8 = 0;
      FUN_0081d120(local_50);
      local_8._0_1_ = 2;
      FUN_00406560();
      iVar3 = *(int *)(in_ECX + 0xb4);
      if (*(uint *)(iVar3 + 0x50) < 8) {
        iVar3 = iVar3 + 0x3c;
      }
      else {
        iVar3 = *(int *)(iVar3 + 0x3c);
      }
      if (local_18 < 8) {
        local_2c[0] = local_2c;
      }
      uVar2 = FUN_00404750(local_2c[0],iVar3);
      local_8._0_1_ = 3;
      FUN_00405eb0(uVar2,0,0xffffffff);
      local_8 = CONCAT31(local_8._1_3_,2);
      FUN_00406560();
      iVar3 = FUN_008ede80(local_30,2);
      if (iVar3 != 0) {
        if (*(code **)(iVar3 + 0x60) != (code *)0x0) {
          (**(code **)(iVar3 + 0x60))(1,iVar3);
        }
        *(code **)(iVar3 + 0x60) = FUN_00a7b8d0;
      }
      local_8 = 0xffffffff;
      FUN_00406560();
    }
    else {
      FUN_00a7b770(uVar1);
    }
  }
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00a7c380 : PUSH EBP
00a7c381 : MOV EBP,ESP
00a7c383 : PUSH -0x1
00a7c385 : PUSH 0xb34f42
00a7c38a : MOV EAX,FS:[0x0]
00a7c390 : PUSH EAX
00a7c391 : SUB ESP,0x44
00a7c394 : MOV EAX,[0x00d66fa0]
00a7c399 : XOR EAX,EBP
00a7c39b : MOV dword ptr [EBP + -0x10],EAX
00a7c39e : PUSH ESI
00a7c39f : PUSH EDI
00a7c3a0 : PUSH EAX
00a7c3a1 : LEA EAX,[EBP + -0xc]
00a7c3a4 : MOV FS:[0x0],EAX
00a7c3aa : LEA EAX,[EBP + 0x8]
00a7c3ad : MOV ESI,ECX
00a7c3af : PUSH EAX
00a7c3b0 : LEA ECX,[ESI + 0xa8]
00a7c3b6 : LEA EAX,[EBP + -0x30]
00a7c3b9 : CALL 0x0042ee80
00a7c3be : MOV ECX,dword ptr [ESI + 0xac]
00a7c3c4 : MOV EAX,dword ptr [EBP + -0x30]
00a7c3c7 : CMP EAX,ECX
00a7c3c9 : JZ 0x00a7c4e2
00a7c3cf : MOV ECX,dword ptr [EAX + 0x18]
00a7c3d2 : TEST ECX,ECX
00a7c3d4 : JNZ 0x00a7c3eb
00a7c3d6 : MOV EDX,dword ptr [EAX + 0x10]
00a7c3d9 : CMP dword ptr [EDX + 0x4],0x1
00a7c3dd : JZ 0x00a7c4e2
00a7c3e3 : TEST ECX,ECX
00a7c3e5 : JZ 0x00a7c4e2
00a7c3eb : MOVQ XMM0,qword ptr [EAX + 0x10]
00a7c3f0 : MOVQ qword ptr [ESI + 0xb4],XMM0
00a7c3f8 : MOVQ XMM0,qword ptr [EAX + 0x18]
00a7c3fd : MOVQ qword ptr [ESI + 0xbc],XMM0
00a7c405 : MOVQ XMM0,qword ptr [EAX + 0x20]
00a7c40a : MOVQ qword ptr [ESI + 0xc4],XMM0
00a7c412 : MOV EAX,dword ptr [EAX + 0x10]
00a7c415 : CMP dword ptr [EAX + 0x4],0x1
00a7c419 : JNZ 0x00a7c4db
00a7c41f : PUSH 0xc52614
00a7c424 : LEA ECX,[EBP + -0x4c]
00a7c427 : CALL 0x00406460
00a7c42c : MOV dword ptr [EBP + -0x4],0x0
00a7c433 : LEA ECX,[EBP + -0x4c]
00a7c436 : PUSH ECX
00a7c437 : MOV ECX,dword ptr [0x0172491c]
00a7c43d : LEA EDI,[EBP + -0x2c]
00a7c440 : CALL 0x0081d120
00a7c445 : MOV byte ptr [EBP + -0x4],0x2
00a7c449 : LEA ECX,[EBP + -0x4c]
00a7c44c : CALL 0x00406560
00a7c451 : MOV EAX,dword ptr [ESI + 0xb4]
00a7c457 : ADD EAX,0x38
00a7c45a : MOV ECX,0x8
00a7c45f : CMP dword ptr [EAX + 0x18],ECX
00a7c462 : JC 0x00a7c469
00a7c464 : MOV EAX,dword ptr [EAX + 0x4]
00a7c467 : JMP 0x00a7c46c
00a7c469 : ADD EAX,0x4
00a7c46c : CMP dword ptr [EBP + -0x14],ECX
00a7c46f : MOV ECX,dword ptr [EBP + -0x28]
00a7c472 : JNC 0x00a7c477
00a7c474 : LEA ECX,[EBP + -0x28]
00a7c477 : PUSH EAX
00a7c478 : PUSH ECX
00a7c479 : LEA ESI,[EBP + -0x4c]
00a7c47c : CALL 0x00404750
00a7c481 : ADD ESP,0x8
00a7c484 : MOV byte ptr [EBP + -0x4],0x3
00a7c488 : OR EDI,0xffffffff
00a7c48b : PUSH EDI
00a7c48c : PUSH 0x0
00a7c48e : PUSH EAX
00a7c48f : LEA ECX,[EBP + -0x2c]
00a7c492 : CALL 0x00405eb0
00a7c497 : MOV byte ptr [EBP + -0x4],0x2
00a7c49b : MOV ECX,ESI
00a7c49d : CALL 0x00406560
00a7c4a2 : MOV EDX,dword ptr [0x00da9894]
00a7c4a8 : MOV ECX,dword ptr [EDX]
00a7c4aa : PUSH 0x2
00a7c4ac : LEA EAX,[EBP + -0x2c]
00a7c4af : PUSH EAX
00a7c4b0 : CALL 0x008ede80
00a7c4b5 : MOV ESI,EAX
00a7c4b7 : TEST ESI,ESI
00a7c4b9 : JZ 0x00a7c4ce
00a7c4bb : MOV EAX,dword ptr [ESI + 0x60]
00a7c4be : TEST EAX,EAX
00a7c4c0 : JZ 0x00a7c4c7
00a7c4c2 : PUSH ESI
00a7c4c3 : PUSH 0x1
00a7c4c5 : CALL EAX
00a7c4c7 : MOV dword ptr [ESI + 0x60],0xa7b8d0
00a7c4ce : MOV dword ptr [EBP + -0x4],EDI
00a7c4d1 : LEA ECX,[EBP + -0x2c]
00a7c4d4 : CALL 0x00406560
00a7c4d9 : JMP 0x00a7c4e2
00a7c4db : MOV EAX,ESI
00a7c4dd : CALL 0x00a7b770
00a7c4e2 : MOV ECX,dword ptr [EBP + -0xc]
00a7c4e5 : MOV dword ptr FS:[0x0],ECX
00a7c4ec : POP ECX
00a7c4ed : POP EDI
00a7c4ee : POP ESI
00a7c4ef : MOV ECX,dword ptr [EBP + -0x10]
00a7c4f2 : XOR ECX,EBP
00a7c4f4 : CALL 0x00633e6b
00a7c4f9 : MOV ESP,EBP
00a7c4fb : POP EBP
00a7c4fc : RET 0x4
