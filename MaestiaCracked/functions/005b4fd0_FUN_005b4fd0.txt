PROGRAM  : Maestia.exe
FUNCTION : FUN_005b4fd0
ENTRY    : 005b4fd0
BODY     : [[005b4fd0, 005b50e9]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005b4fd0(int param_1)

{
  byte *pbVar1;
  GRefCountNTSImpl *this;
  char cVar2;
  uint uVar3;
  int iVar4;
  uint uVar5;
  GRefCountNTSImpl *pGVar6;
  uint uVar7;
  float *pfVar8;
  undefined2 in_FPUControlWord;
  GRefCountNTSImpl *local_2c;
  longlong local_28;
  float local_20 [5];
  float local_c;
  
  cVar2 = FUN_00526030(0x15);
  if (cVar2 == '\0') {
    FUN_00526050("Color",0,0);
  }
  else if ((*(int *)(param_1 + 8) != 0) && (*(int *)(param_1 + 8) != 0x10)) {
    FUN_005033a0(&local_2c);
    this = local_2c;
    if (local_2c != (GRefCountNTSImpl *)0x0) {
      *(int *)(local_2c + 4) = *(int *)(local_2c + 4) + 1;
      GRefCountNTSImpl::Release(local_2c);
      pGVar6 = this + 0x24;
      pfVar8 = local_20;
      for (iVar4 = 8; iVar4 != 0; iVar4 = iVar4 + -1) {
        *pfVar8 = *(float *)pGVar6;
        pGVar6 = pGVar6 + 4;
        pfVar8 = pfVar8 + 1;
      }
      local_28._0_4_ = (uint)(longlong)ROUND(local_20[1]);
      pbVar1 = *(byte **)(param_1 + 4);
      uVar7 = (uint)local_28 & 0xff;
      local_28._0_4_ = (uint)(longlong)ROUND(local_20[3]);
      uVar5 = (uint)local_28 & 0xff;
      local_2c = (GRefCountNTSImpl *)CONCAT22(local_2c._2_2_,in_FPUControlWord);
      local_28 = (longlong)ROUND(local_c);
      uVar3 = (uint)local_28 & 0xff;
      if (4 < *pbVar1) {
        FUN_00526400();
      }
      *(uint *)(pbVar1 + 4) = (uVar7 << 8 | uVar5) << 8 | uVar3;
      *pbVar1 = 4;
      GRefCountNTSImpl::Release(this);
      return;
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005b4fd0 : SUB ESP,0x2c
005b4fd3 : PUSH EBP
005b4fd4 : MOV EBP,dword ptr [ESP + 0x34]
005b4fd8 : PUSH 0x15
005b4fda : MOV ECX,EBP
005b4fdc : CALL 0x00526030
005b4fe1 : TEST AL,AL
005b4fe3 : JNZ 0x005b4ffa
005b4fe5 : PUSH 0x0
005b4fe7 : PUSH 0x0
005b4fe9 : PUSH 0xb8fe48
005b4fee : MOV ECX,EBP
005b4ff0 : CALL 0x00526050
005b4ff5 : POP EBP
005b4ff6 : ADD ESP,0x2c
005b4ff9 : RET
005b4ffa : MOV EAX,dword ptr [EBP + 0x8]
005b4ffd : TEST EAX,EAX
005b4fff : JZ 0x005b4ff5
005b5001 : ADD EAX,-0x10
005b5004 : JZ 0x005b4ff5
005b5006 : LEA ECX,[ESP + 0x4]
005b500a : PUSH ECX
005b500b : LEA ECX,[EAX + 0x30]
005b500e : CALL 0x005033a0
005b5013 : MOV EAX,dword ptr [ESP + 0x4]
005b5017 : TEST EAX,EAX
005b5019 : JZ 0x005b4ff5
005b501b : INC dword ptr [EAX + 0x4]
005b501e : PUSH EBX
005b501f : MOV EBX,dword ptr [ESP + 0x8]
005b5023 : PUSH ESI
005b5024 : PUSH EDI
005b5025 : MOV ECX,EBX
005b5027 : CALL 0x004ff7c0
005b502c : FNSTCW word ptr [ESP + 0x10]
005b5030 : MOVZX EAX,word ptr [ESP + 0x10]
005b5035 : OR EAX,0xc00
005b503a : MOV dword ptr [ESP + 0x14],EAX
005b503e : LEA ESI,[EBX + 0x24]
005b5041 : MOV ECX,0x8
005b5046 : LEA EDI,[ESP + 0x1c]
005b504a : MOVSD.REP ES:EDI,ESI
005b504c : FLD float ptr [ESP + 0x20]
005b5050 : FLDCW word ptr [ESP + 0x14]
005b5054 : FISTP qword ptr [ESP + 0x14]
005b5058 : MOV ESI,dword ptr [ESP + 0x14]
005b505c : FLDCW word ptr [ESP + 0x10]
005b5060 : MOV EDI,dword ptr [EBP + 0x4]
005b5063 : AND ESI,0xff
005b5069 : SHL ESI,0x8
005b506c : FLD float ptr [ESP + 0x28]
005b5070 : FNSTCW word ptr [ESP + 0x10]
005b5074 : MOVZX EAX,word ptr [ESP + 0x10]
005b5079 : OR EAX,0xc00
005b507e : MOV dword ptr [ESP + 0x14],EAX
005b5082 : FLDCW word ptr [ESP + 0x14]
005b5086 : FISTP qword ptr [ESP + 0x14]
005b508a : MOV EDX,dword ptr [ESP + 0x14]
005b508e : AND EDX,0xff
005b5094 : OR ESI,EDX
005b5096 : FLDCW word ptr [ESP + 0x10]
005b509a : SHL ESI,0x8
005b509d : FLD float ptr [ESP + 0x30]
005b50a1 : FNSTCW word ptr [ESP + 0x10]
005b50a5 : MOVZX EAX,word ptr [ESP + 0x10]
005b50aa : OR EAX,0xc00
005b50af : MOV dword ptr [ESP + 0x14],EAX
005b50b3 : FLDCW word ptr [ESP + 0x14]
005b50b7 : FISTP qword ptr [ESP + 0x14]
005b50bb : MOV EAX,dword ptr [ESP + 0x14]
005b50bf : AND EAX,0xff
005b50c4 : OR ESI,EAX
005b50c6 : CMP byte ptr [EDI],0x5
005b50c9 : FLDCW word ptr [ESP + 0x10]
005b50cd : JC 0x005b50d6
005b50cf : MOV ECX,EDI
005b50d1 : CALL 0x00526400
005b50d6 : MOV dword ptr [EDI + 0x4],ESI
005b50d9 : MOV byte ptr [EDI],0x4
005b50dc : POP EDI
005b50dd : POP ESI
005b50de : MOV ECX,EBX
005b50e0 : POP EBX
005b50e1 : POP EBP
005b50e2 : ADD ESP,0x2c
005b50e5 : JMP 0x004ff7c0
