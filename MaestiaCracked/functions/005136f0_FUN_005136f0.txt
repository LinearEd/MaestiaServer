PROGRAM  : Maestia.exe
FUNCTION : FUN_005136f0
ENTRY    : 005136f0
BODY     : [[005136f0, 00513893]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005136f0(uint param_1,undefined4 param_2)

{
  undefined1 *puVar1;
  undefined1 uVar2;
  undefined1 uVar3;
  int iVar4;
  LONG LVar5;
  ushort uVar6;
  undefined4 uVar7;
  uint uVar8;
  uint local_8 [2];
  
  uVar8 = param_1;
  uVar7 = 0;
  *(undefined1 *)(param_1 + 0x15) = 0;
  if (*(int *)(param_1 + 0x30) - *(int *)(param_1 + 0x2c) < 2) {
    FUN_00539fb0(2);
  }
  iVar4 = *(int *)(uVar8 + 0x2c);
  uVar6 = CONCAT11(*(undefined1 *)(*(int *)(uVar8 + 0x3c) + 1 + iVar4),
                   *(undefined1 *)(*(int *)(uVar8 + 0x3c) + iVar4));
  *(int *)(uVar8 + 0x2c) = iVar4 + 2;
  if (0x109 < uVar6) {
    *(undefined1 *)(uVar8 + 0x15) = 0;
    if (*(int *)(uVar8 + 0x30) - (iVar4 + 2) < 4) {
      FUN_00539fb0(4);
    }
    iVar4 = *(int *)(uVar8 + 0x2c);
    puVar1 = (undefined1 *)(*(int *)(uVar8 + 0x3c) + iVar4);
    uVar7 = CONCAT31(CONCAT21(CONCAT11(puVar1[3],*(undefined1 *)(*(int *)(uVar8 + 0x3c) + 2 + iVar4)
                                      ),puVar1[1]),*puVar1);
    *(int *)(uVar8 + 0x2c) = iVar4 + 4;
  }
  *(undefined1 *)(uVar8 + 0x15) = 0;
  if (*(int *)(uVar8 + 0x30) - *(int *)(uVar8 + 0x2c) < 2) {
    FUN_00539fb0(2);
  }
  iVar4 = *(int *)(uVar8 + 0x2c);
  uVar2 = *(undefined1 *)(*(int *)(uVar8 + 0x3c) + 1 + iVar4);
  uVar3 = *(undefined1 *)(*(int *)(uVar8 + 0x3c) + iVar4);
  *(int *)(uVar8 + 0x2c) = iVar4 + 2;
  FUN_0051b6e0();
  FUN_0051b6e0();
  FUN_0053a9b0(local_8);
  FUN_0053a9b0(&param_1);
  GThread::OnExit((GThread *)(uVar6 & 0xff));
  FUN_005127d0(uVar6,CONCAT11(uVar2,uVar3),(param_1 & 0xfffffffc) + 8,(local_8[0] & 0xfffffffc) + 8,
               uVar7);
  uVar8 = param_1 & 0xfffffffc;
  LVar5 = InterlockedExchangeAdd((LONG *)(uVar8 + 4),-1);
  if (LVar5 == 1) {
    FUN_00515cf0(uVar8);
  }
  LVar5 = InterlockedExchangeAdd((LONG *)((local_8[0] & 0xfffffffc) + 4),-1);
  if (LVar5 == 1) {
    FUN_00515cf0(local_8[0] & 0xfffffffc);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005136f0 : SUB ESP,0x8
005136f3 : PUSH EBX
005136f4 : PUSH EBP
005136f5 : PUSH ESI
005136f6 : MOV ESI,dword ptr [ESP + 0x18]
005136fa : MOV EAX,dword ptr [ESI + 0x30]
005136fd : SUB EAX,dword ptr [ESI + 0x2c]
00513700 : XOR EBP,EBP
00513702 : CMP EAX,0x2
00513705 : PUSH EDI
00513706 : MOV dword ptr [ESP + 0x14],ECX
0051370a : MOV byte ptr [ESI + 0x15],0x0
0051370e : JGE 0x00513719
00513710 : PUSH 0x2
00513712 : MOV ECX,ESI
00513714 : CALL 0x00539fb0
00513719 : MOV EAX,dword ptr [ESI + 0x2c]
0051371c : MOV ECX,dword ptr [ESI + 0x3c]
0051371f : MOVZX DX,byte ptr [ECX + EAX*0x1 + 0x1]
00513725 : ADD ECX,EAX
00513727 : MOVZX CX,byte ptr [ECX]
0051372b : SHL DX,0x8
0051372f : OR DX,CX
00513732 : MOVZX EBX,DX
00513735 : ADD EAX,0x2
00513738 : MOV EDX,0x10a
0051373d : MOV dword ptr [ESI + 0x2c],EAX
00513740 : CMP BX,DX
00513743 : JC 0x0051378c
00513745 : MOV ECX,dword ptr [ESI + 0x30]
00513748 : SUB ECX,EAX
0051374a : CMP ECX,0x4
0051374d : MOV byte ptr [ESI + 0x15],0x0
00513751 : JGE 0x0051375c
00513753 : PUSH 0x4
00513755 : MOV ECX,ESI
00513757 : CALL 0x00539fb0
0051375c : MOV EDX,dword ptr [ESI + 0x2c]
0051375f : MOV EAX,dword ptr [ESI + 0x3c]
00513762 : MOVZX EDI,byte ptr [EAX + EDX*0x1 + 0x2]
00513767 : LEA ECX,[EAX + EDX*0x1]
0051376a : MOVZX EAX,byte ptr [ECX + 0x3]
0051376e : SHL EAX,0x8
00513771 : OR EAX,EDI
00513773 : MOVZX EDI,byte ptr [ECX + 0x1]
00513777 : MOVZX ECX,byte ptr [ECX]
0051377a : SHL EAX,0x8
0051377d : OR EAX,EDI
0051377f : SHL EAX,0x8
00513782 : OR EAX,ECX
00513784 : ADD EDX,0x4
00513787 : MOV dword ptr [ESI + 0x2c],EDX
0051378a : MOV EBP,EAX
0051378c : MOV EDX,dword ptr [ESI + 0x30]
0051378f : SUB EDX,dword ptr [ESI + 0x2c]
00513792 : MOV byte ptr [ESI + 0x15],0x0
00513796 : CMP EDX,0x2
00513799 : JGE 0x005137a4
0051379b : PUSH 0x2
0051379d : MOV ECX,ESI
0051379f : CALL 0x00539fb0
005137a4 : MOV EAX,dword ptr [ESI + 0x2c]
005137a7 : MOV ECX,dword ptr [ESI + 0x3c]
005137aa : MOVZX DX,byte ptr [ECX + EAX*0x1 + 0x1]
005137b0 : ADD ECX,EAX
005137b2 : MOVZX CX,byte ptr [ECX]
005137b6 : SHL DX,0x8
005137ba : OR DX,CX
005137bd : ADD EAX,0x2
005137c0 : LEA ECX,[ESP + 0x10]
005137c4 : MOVZX EDI,DX
005137c7 : MOV dword ptr [ESI + 0x2c],EAX
005137ca : CALL 0x0051b6e0
005137cf : LEA ECX,[ESP + 0x1c]
005137d3 : CALL 0x0051b6e0
005137d8 : LEA EDX,[ESP + 0x10]
005137dc : PUSH EDX
005137dd : MOV ECX,ESI
005137df : CALL 0x0053a9b0
005137e4 : LEA EAX,[ESP + 0x1c]
005137e8 : PUSH EAX
005137e9 : MOV ECX,ESI
005137eb : CALL 0x0053a9b0
005137f0 : MOV ECX,dword ptr [ESP + 0x1c]
005137f4 : MOV EDX,dword ptr [ESP + 0x10]
005137f8 : PUSH EBP
005137f9 : AND ECX,0xfffffffc
005137fc : ADD ECX,0x8
005137ff : PUSH ECX
00513800 : AND EDX,0xfffffffc
00513803 : MOVZX EAX,BX
00513806 : ADD EDX,0x8
00513809 : PUSH EDX
0051380a : MOV EDX,dword ptr [ESP + 0x2c]
0051380e : MOVZX EDI,DI
00513811 : PUSH EDI
00513812 : MOV ECX,EAX
00513814 : AND ECX,0xff
0051381a : PUSH ECX
0051381b : SHR EAX,0x8
0051381e : PUSH EAX
0051381f : PUSH EDX
00513820 : PUSH 0xb86e00
00513825 : PUSH ESI
00513826 : CALL 0x0051d420
0051382b : MOV EAX,dword ptr [ESP + 0x34]
0051382f : MOV ECX,dword ptr [ESP + 0x40]
00513833 : ADD ESP,0x24
00513836 : PUSH EBP
00513837 : AND EAX,0xfffffffc
0051383a : AND ECX,0xfffffffc
0051383d : ADD EAX,0x8
00513840 : PUSH EAX
00513841 : ADD ECX,0x8
00513844 : PUSH ECX
00513845 : MOV ECX,dword ptr [ESP + 0x20]
00513849 : PUSH EDI
0051384a : PUSH EBX
0051384b : CALL 0x005127d0
00513850 : MOV ESI,dword ptr [ESP + 0x1c]
00513854 : MOV EDI,dword ptr [0x00b851cc]
0051385a : AND ESI,0xfffffffc
0051385d : PUSH -0x1
0051385f : LEA EDX,[ESI + 0x4]
00513862 : PUSH EDX
00513863 : CALL EDI
00513865 : SUB EAX,0x1
00513868 : JNZ 0x00513870
0051386a : PUSH ESI
0051386b : CALL 0x00515cf0
00513870 : MOV ESI,dword ptr [ESP + 0x10]
00513874 : AND ESI,0xfffffffc
00513877 : PUSH -0x1
00513879 : LEA EAX,[ESI + 0x4]
0051387c : PUSH EAX
0051387d : CALL EDI
0051387f : SUB EAX,0x1
00513882 : JNZ 0x0051388a
00513884 : PUSH ESI
00513885 : CALL 0x00515cf0
0051388a : POP EDI
0051388b : POP ESI
0051388c : POP EBP
0051388d : POP EBX
0051388e : ADD ESP,0x8
00513891 : RET 0x8
