PROGRAM  : Maestia.exe
FUNCTION : FUN_0054fa60
ENTRY    : 0054fa60
BODY     : [[0054fa60, 0054fbd0]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0054fa60(undefined4 param_1,uint param_2)

{
  int *piVar1;
  undefined4 *puVar2;
  undefined4 *puVar3;
  int iVar4;
  int *in_ECX;
  int iVar5;
  int iVar6;
  float10 fVar7;
  longlong local_8;
  
  iVar5 = 0;
  if (param_2 == 0) {
    FUN_0054f5d0();
    return;
  }
  if (param_2 < 8) {
    iVar6 = 8;
  }
  else {
    fVar7 = (float10)FUN_0063b270();
    local_8 = (longlong)ROUND((float)fVar7 / 0.6931472 + 1.0);
    iVar6 = 1 << ((byte)local_8 & 0x1f);
  }
  local_8 = CONCAT44(local_8._4_4_,0x143);
  puVar3 = (undefined4 *)FUN_00515d60(param_1,iVar6 * 0x18 + 8,&local_8);
  *puVar3 = 0;
  puVar3[1] = iVar6 + -1;
  if (iVar6 != 0) {
    iVar4 = 0;
    do {
      *(undefined4 *)(iVar4 + 8 + (int)puVar3) = 0xfffffffe;
      iVar4 = iVar4 + 0x18;
      iVar6 = iVar6 + -1;
    } while (iVar6 != 0);
  }
  if (*in_ECX != 0) {
    iVar6 = *(int *)(*in_ECX + 4) + 1;
    do {
      puVar2 = (undefined4 *)(iVar5 + 8 + *in_ECX);
      if (*(int *)(iVar5 + 8 + *in_ECX) != -2) {
        FUN_0054ff30(param_1,puVar2 + 1,*(undefined4 *)(puVar2[1] + 0xc));
        FUN_00526bc0();
        piVar1 = (int *)(puVar2[1] + 8);
        *piVar1 = *piVar1 + -1;
        if (*piVar1 == 0) {
          FUN_00525340();
        }
        *puVar2 = 0xfffffffe;
      }
      iVar5 = iVar5 + 0x18;
      iVar6 = iVar6 + -1;
    } while (iVar6 != 0);
    FUN_00515cf0(*in_ECX);
  }
  *in_ECX = (int)puVar3;
  FUN_0052aaa0();
  return;
}



============================================================
DISASSEMBLY
============================================================
0054fa60 : SUB ESP,0xc
0054fa63 : MOV EAX,dword ptr [ESP + 0x14]
0054fa67 : PUSH EBX
0054fa68 : PUSH EDI
0054fa69 : XOR EBX,EBX
0054fa6b : MOV EDI,ECX
0054fa6d : MOV dword ptr [ESP + 0x8],EDI
0054fa71 : CMP EAX,EBX
0054fa73 : JNZ 0x0054fa82
0054fa75 : CALL 0x0054f5d0
0054fa7a : POP EDI
0054fa7b : POP EBX
0054fa7c : ADD ESP,0xc
0054fa7f : RET 0x8
0054fa82 : PUSH ESI
0054fa83 : CMP EAX,0x8
0054fa86 : JNC 0x0054fa8f
0054fa88 : MOV ESI,0x8
0054fa8d : JMP 0x0054faf4
0054fa8f : DEC EAX
0054fa90 : MOV dword ptr [ESP + 0x20],EAX
0054fa94 : FILD dword ptr [ESP + 0x20]
0054fa98 : TEST EAX,EAX
0054fa9a : JGE 0x0054faa2
0054fa9c : FADD float ptr [0x00cdf0e0]
0054faa2 : CALL 0x0063b270
0054faa7 : FSTP float ptr [ESP + 0x20]
0054faab : FLD float ptr [ESP + 0x20]
0054faaf : MOV ESI,0x1
0054fab4 : FDIV double ptr [0x00b85fe0]
0054faba : FSTP float ptr [ESP + 0x20]
0054fabe : FLD float ptr [ESP + 0x20]
0054fac2 : FADD double ptr [0x00cdf108]
0054fac8 : FSTP float ptr [ESP + 0x20]
0054facc : FLD float ptr [ESP + 0x20]
0054fad0 : FNSTCW word ptr [ESP + 0x20]
0054fad4 : MOVZX EAX,word ptr [ESP + 0x20]
0054fad9 : OR EAX,0xc00
0054fade : MOV dword ptr [ESP + 0x10],EAX
0054fae2 : FLDCW word ptr [ESP + 0x10]
0054fae6 : FISTP qword ptr [ESP + 0x10]
0054faea : MOV CL,byte ptr [ESP + 0x10]
0054faee : SHL ESI,CL
0054faf0 : FLDCW word ptr [ESP + 0x20]
0054faf4 : LEA EAX,[ESP + 0x10]
0054faf8 : PUSH EAX
0054faf9 : MOV EAX,dword ptr [ESP + 0x20]
0054fafd : LEA ECX,[ESI + ESI*0x2]
0054fb00 : LEA EDX,[ECX*0x8 + 0x8]
0054fb07 : PUSH EDX
0054fb08 : PUSH EAX
0054fb09 : MOV dword ptr [ESP + 0x2c],EBX
0054fb0d : MOV dword ptr [ESP + 0x1c],0x143
0054fb15 : CALL 0x00515d60
0054fb1a : MOV dword ptr [ESP + 0x20],EAX
0054fb1e : MOV dword ptr [EAX],EBX
0054fb20 : MOV EDX,dword ptr [ESP + 0x20]
0054fb24 : LEA ECX,[ESI + -0x1]
0054fb27 : MOV dword ptr [EDX + 0x4],ECX
0054fb2a : CMP ESI,EBX
0054fb2c : JBE 0x0054fb44
0054fb2e : XOR EAX,EAX
0054fb30 : MOV ECX,dword ptr [ESP + 0x20]
0054fb34 : MOV dword ptr [EAX + ECX*0x1 + 0x8],0xfffffffe
0054fb3c : ADD EAX,0x18
0054fb3f : SUB ESI,0x1
0054fb42 : JNZ 0x0054fb30
0054fb44 : MOV EAX,dword ptr [EDI]
0054fb46 : CMP EAX,EBX
0054fb48 : JZ 0x0054fbb1
0054fb4a : MOV EAX,dword ptr [EAX + 0x4]
0054fb4d : PUSH EBP
0054fb4e : LEA EBP,[EAX + 0x1]
0054fb51 : JMP 0x0054fb57
0054fb53 : MOV EDI,dword ptr [ESP + 0x10]
0054fb57 : MOV EDX,dword ptr [EDI]
0054fb59 : CMP dword ptr [EBX + EDX*0x1 + 0x8],-0x2
0054fb5e : LEA EDI,[EBX + EDX*0x1 + 0x8]
0054fb62 : JZ 0x0054fb98
0054fb64 : MOV EAX,dword ptr [EDI + 0x4]
0054fb67 : MOV ECX,dword ptr [EAX + 0xc]
0054fb6a : MOV EDX,dword ptr [ESP + 0x20]
0054fb6e : LEA ESI,[EDI + 0x4]
0054fb71 : PUSH ECX
0054fb72 : PUSH ESI
0054fb73 : PUSH EDX
0054fb74 : LEA ECX,[ESP + 0x30]
0054fb78 : CALL 0x0054ff30
0054fb7d : LEA ECX,[ESI + 0x4]
0054fb80 : CALL 0x00526bc0
0054fb85 : MOV ECX,dword ptr [ESI]
0054fb87 : ADD dword ptr [ECX + 0x8],-0x1
0054fb8b : JNZ 0x0054fb92
0054fb8d : CALL 0x00525340
0054fb92 : MOV dword ptr [EDI],0xfffffffe
0054fb98 : ADD EBX,0x18
0054fb9b : SUB EBP,0x1
0054fb9e : JNZ 0x0054fb53
0054fba0 : MOV EAX,dword ptr [ESP + 0x10]
0054fba4 : MOV ECX,dword ptr [EAX]
0054fba6 : PUSH ECX
0054fba7 : CALL 0x00515cf0
0054fbac : MOV EDI,dword ptr [ESP + 0x10]
0054fbb0 : POP EBP
0054fbb1 : MOV EDX,dword ptr [ESP + 0x20]
0054fbb5 : LEA ECX,[ESP + 0x20]
0054fbb9 : MOV dword ptr [EDI],EDX
0054fbbb : MOV dword ptr [ESP + 0x20],0x0
0054fbc3 : CALL 0x0052aaa0
0054fbc8 : POP ESI
0054fbc9 : POP EDI
0054fbca : POP EBX
0054fbcb : ADD ESP,0xc
0054fbce : RET 0x8
