PROGRAM  : Maestia.exe
FUNCTION : FUN_0055f050
ENTRY    : 0055f050
BODY     : [[0055f050, 0055f14f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0055f050(undefined4 param_1,uint *param_2,uint param_3)

{
  uint *puVar1;
  int iVar2;
  uint *puVar3;
  int *piVar4;
  int iVar5;
  uint uVar6;
  GRefCountImpl *pGVar7;
  int *in_ECX;
  uint uVar8;
  
  FUN_00560820(param_1);
  piVar4 = (int *)*in_ECX;
  param_3 = param_3 & piVar4[1];
  *piVar4 = *piVar4 + 1;
  iVar5 = *in_ECX;
  puVar1 = (uint *)(iVar5 + 8 + param_3 * 0xc);
  if (*puVar1 == 0xfffffffe) {
    *puVar1 = 0xffffffff;
    if ((GRefCountImpl *)*param_2 != (GRefCountImpl *)0x0) {
      GRefCountImpl::AddRef((GRefCountImpl *)*param_2);
    }
    puVar1[2] = *param_2;
    puVar1[1] = param_3;
    return;
  }
  uVar8 = param_3;
  do {
    uVar8 = uVar8 + 1 & *(uint *)(iVar5 + 4);
  } while (*(int *)(iVar5 + 8 + uVar8 * 0xc) != -2);
  uVar6 = puVar1[1];
  iVar2 = iVar5 + 8 + uVar8 * 0xc;
  if (uVar6 != param_3) {
    puVar3 = (uint *)(iVar5 + 8 + uVar6 * 0xc);
    for (uVar6 = *(uint *)(iVar5 + 8 + uVar6 * 0xc); uVar6 != param_3;
        uVar6 = *(uint *)(iVar5 + 8 + uVar6 * 0xc)) {
      uVar6 = *puVar3;
      puVar3 = (uint *)(iVar5 + 8 + uVar6 * 0xc);
    }
    if (iVar2 != 0) {
      FUN_00513520(puVar1);
    }
    *puVar3 = uVar8;
    pGVar7 = (GRefCountImpl *)*param_2;
    if (pGVar7 != (GRefCountImpl *)0x0) {
      GRefCountImpl::AddRef(pGVar7);
    }
    if ((GRefCountImpl *)puVar1[2] != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release((GRefCountImpl *)puVar1[2]);
    }
    puVar1[2] = (uint)pGVar7;
    puVar1[1] = param_3;
    *puVar1 = 0xffffffff;
    return;
  }
  if (iVar2 != 0) {
    FUN_00513520(puVar1);
  }
  pGVar7 = (GRefCountImpl *)*param_2;
  if (pGVar7 != (GRefCountImpl *)0x0) {
    GRefCountImpl::AddRef(pGVar7);
  }
  if ((GRefCountImpl *)puVar1[2] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)puVar1[2]);
  }
  puVar1[2] = (uint)pGVar7;
  *puVar1 = uVar8;
  puVar1[1] = param_3;
  return;
}



============================================================
DISASSEMBLY
============================================================
0055f050 : MOV EAX,dword ptr [ESP + 0x4]
0055f054 : PUSH EBX
0055f055 : PUSH ESI
0055f056 : PUSH EDI
0055f057 : PUSH EAX
0055f058 : MOV ESI,ECX
0055f05a : CALL 0x00560820
0055f05f : MOV EAX,dword ptr [ESI]
0055f061 : MOV EBX,dword ptr [ESP + 0x18]
0055f065 : AND EBX,dword ptr [EAX + 0x4]
0055f068 : INC dword ptr [EAX]
0055f06a : MOV EAX,dword ptr [ESI]
0055f06c : LEA ECX,[EBX + EBX*0x2]
0055f06f : LEA EDI,[EAX + ECX*0x4 + 0x8]
0055f073 : MOV EDX,0xfffffffe
0055f078 : CMP dword ptr [EDI],EDX
0055f07a : JNZ 0x0055f09f
0055f07c : MOV ESI,dword ptr [ESP + 0x14]
0055f080 : MOV dword ptr [EDI],0xffffffff
0055f086 : MOV ECX,dword ptr [ESI]
0055f088 : TEST ECX,ECX
0055f08a : JZ 0x0055f091
0055f08c : CALL 0x00523dd0
0055f091 : MOV EDX,dword ptr [ESI]
0055f093 : MOV dword ptr [EDI + 0x8],EDX
0055f096 : MOV dword ptr [EDI + 0x4],EBX
0055f099 : POP EDI
0055f09a : POP ESI
0055f09b : POP EBX
0055f09c : RET 0xc
0055f09f : MOV ECX,dword ptr [EAX + 0x4]
0055f0a2 : MOV ESI,EBX
0055f0a4 : PUSH EBP
0055f0a5 : INC ESI
0055f0a6 : AND ESI,ECX
0055f0a8 : LEA EBP,[ESI + ESI*0x2]
0055f0ab : CMP dword ptr [EAX + EBP*0x4 + 0x8],EDX
0055f0af : JNZ 0x0055f0a5
0055f0b1 : MOV EDX,dword ptr [EDI + 0x4]
0055f0b4 : LEA ECX,[ESI + ESI*0x2]
0055f0b7 : LEA ECX,[EAX + ECX*0x4 + 0x8]
0055f0bb : CMP EDX,EBX
0055f0bd : JNZ 0x0055f0f5
0055f0bf : TEST ECX,ECX
0055f0c1 : JZ 0x0055f0c9
0055f0c3 : PUSH EDI
0055f0c4 : CALL 0x00513520
0055f0c9 : MOV EDX,dword ptr [ESP + 0x18]
0055f0cd : MOV EBP,dword ptr [EDX]
0055f0cf : TEST EBP,EBP
0055f0d1 : JZ 0x0055f0da
0055f0d3 : MOV ECX,EBP
0055f0d5 : CALL 0x00523dd0
0055f0da : MOV ECX,dword ptr [EDI + 0x8]
0055f0dd : TEST ECX,ECX
0055f0df : JZ 0x0055f0e6
0055f0e1 : CALL 0x004ff7e0
0055f0e6 : MOV dword ptr [EDI + 0x8],EBP
0055f0e9 : POP EBP
0055f0ea : MOV dword ptr [EDI],ESI
0055f0ec : MOV dword ptr [EDI + 0x4],EBX
0055f0ef : POP EDI
0055f0f0 : POP ESI
0055f0f1 : POP EBX
0055f0f2 : RET 0xc
0055f0f5 : LEA EDX,[EDX + EDX*0x2]
0055f0f8 : CMP dword ptr [EAX + EDX*0x4 + 0x8],EBX
0055f0fc : LEA EBP,[EAX + EDX*0x4 + 0x8]
0055f100 : JZ 0x0055f113
0055f102 : MOV EBP,dword ptr [EBP]
0055f105 : LEA EDX,[EBP + EBP*0x2]
0055f109 : CMP dword ptr [EAX + EDX*0x4 + 0x8],EBX
0055f10d : LEA EBP,[EAX + EDX*0x4 + 0x8]
0055f111 : JNZ 0x0055f102
0055f113 : TEST ECX,ECX
0055f115 : JZ 0x0055f11d
0055f117 : PUSH EDI
0055f118 : CALL 0x00513520
0055f11d : MOV EAX,dword ptr [ESP + 0x18]
0055f121 : MOV dword ptr [EBP],ESI
0055f124 : MOV ESI,dword ptr [EAX]
0055f126 : TEST ESI,ESI
0055f128 : JZ 0x0055f131
0055f12a : MOV ECX,ESI
0055f12c : CALL 0x00523dd0
0055f131 : MOV ECX,dword ptr [EDI + 0x8]
0055f134 : TEST ECX,ECX
0055f136 : JZ 0x0055f13d
0055f138 : CALL 0x004ff7e0
0055f13d : MOV dword ptr [EDI + 0x8],ESI
0055f140 : POP EBP
0055f141 : MOV dword ptr [EDI + 0x4],EBX
0055f144 : MOV dword ptr [EDI],0xffffffff
0055f14a : POP EDI
0055f14b : POP ESI
0055f14c : POP EBX
0055f14d : RET 0xc
