PROGRAM  : Maestia.exe
FUNCTION : FUN_00601510
ENTRY    : 00601510
BODY     : [[00601510, 00601557] [00601560, 006017ee]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00601510(int param_1,undefined4 param_2,GMatrix2D *param_3)

{
  undefined2 *puVar1;
  int iVar2;
  int iVar3;
  int *piVar4;
  undefined4 uVar5;
  bool bVar6;
  bool bVar7;
  undefined4 uVar8;
  uint uVar9;
  uint *in_ECX;
  code *pcVar10;
  int iVar11;
  uint uVar12;
  undefined4 local_20;
  uint local_1c;
  uint local_18;
  float local_10;
  float local_c;
  undefined4 local_8;
  undefined4 local_4;
  
  FUN_005f8d90(*in_ECX);
  iVar2 = **(int **)(param_1 + 0xc);
  if (in_ECX[0x20] == 0) {
    local_18 = 0;
  }
  else {
    local_18 = in_ECX[0x21];
  }
  local_1c = 0;
  if (*in_ECX != 0) {
    do {
      iVar3 = *(int *)(in_ECX[3] + (local_1c >> 8) * 4);
      local_8 = *(undefined4 *)(iVar3 + (local_1c & 0xff) * 0xc);
      iVar3 = iVar3 + (local_1c & 0xff) * 0xc;
      local_4 = *(undefined4 *)(iVar3 + 4);
      iVar11 = *(int *)(*(int *)(param_1 + 0xc) + 4) * local_1c + *(int *)(param_1 + 8);
      piVar4 = *(int **)(*(int *)(param_1 + 0xc) + 8);
      GMatrix2D::Transform(param_3,(GPoint<float> *)&local_10,(GPoint<float> *)&local_8);
      if (32767.0 < ABS(local_10)) {
        if (local_10 <= 32767.0) {
          local_10 = -32768.0;
        }
        else {
          local_10 = 32767.0;
        }
      }
      if (32767.0 < ABS(local_c)) {
        if (local_c <= 32767.0) {
          local_c = -32768.0;
        }
        else {
          local_c = 32767.0;
        }
      }
      (**(code **)(*piVar4 + 4))(iVar11,local_10,local_c,0);
      uVar12 = *(uint *)(iVar3 + 8);
      uVar9 = uVar12 & 0xffffff;
      bVar6 = (int)local_18 <= (int)uVar9;
      if ((bVar6) || (*(char *)(in_ECX[0x20] + uVar9 * 0x28) == '\0')) {
        bVar7 = true;
      }
      else {
        bVar7 = false;
      }
      if ((uVar12 & 0x80000000) == 0) {
        if (bVar6) {
          local_20 = 0xffffffff;
LAB_0060176f:
          (**(code **)(*piVar4 + 0x10))(iVar11,local_20);
        }
        else if (bVar7) {
          uVar5 = *(undefined4 *)(in_ECX[0x20] + 4 + uVar9 * 0x28);
          local_20._1_3_ = (undefined3)((uint)uVar5 >> 8);
          local_20 = CONCAT31(local_20._1_3_,(char)((uint)uVar5 >> 0x10));
          uVar8 = local_20;
          local_20._3_1_ = (undefined1)((uint)uVar5 >> 0x18);
          local_20._0_2_ = (undefined2)uVar8;
          local_20._0_3_ = CONCAT12((char)uVar5,(undefined2)local_20);
          goto LAB_0060176f;
        }
        uVar12 = in_ECX[0x23] | 0xff000000;
LAB_00601785:
        pcVar10 = *(code **)(*piVar4 + 0x14);
LAB_0060178b:
        (*pcVar10)(iVar11,uVar12);
      }
      else {
        if (iVar2 != 3) {
          if (bVar6) {
            (**(code **)(*piVar4 + 0x10))(iVar11,0xffffffff);
            uVar12 = in_ECX[0x23];
          }
          else {
            if (!bVar7) {
              pcVar10 = *(code **)(*piVar4 + 0x14);
              uVar12 = 0xffffff;
              goto LAB_0060178b;
            }
            uVar5 = *(undefined4 *)(in_ECX[0x20] + 4 + uVar9 * 0x28);
            local_20._1_3_ = (undefined3)((uint)uVar5 >> 8);
            local_20 = CONCAT31(local_20._1_3_,(char)((uint)uVar5 >> 0x10));
            uVar8 = local_20;
            local_20._3_1_ = (undefined1)((uint)uVar5 >> 0x18);
            local_20._0_2_ = (undefined2)uVar8;
            local_20._0_3_ = CONCAT12((char)uVar5,(undefined2)local_20);
            (**(code **)(*piVar4 + 0x10))(iVar11,local_20);
            uVar12 = in_ECX[0x23];
          }
          goto LAB_00601785;
        }
        if (bVar6) {
          pcVar10 = *(code **)(*piVar4 + 0x10);
          uVar12 = 0xffffff;
          goto LAB_0060178b;
        }
        if (bVar7) {
          uVar5 = *(undefined4 *)(in_ECX[0x20] + 4 + uVar9 * 0x28);
          local_20._1_3_ = (undefined3)((uint)uVar5 >> 8);
          local_20 = CONCAT31(local_20._1_3_,(char)((uint)uVar5 >> 0x10));
          local_20._0_3_ = CONCAT12((char)uVar5,(undefined2)local_20);
          pcVar10 = *(code **)(*piVar4 + 0x10);
          uVar12 = (uint)(uint3)local_20;
          goto LAB_0060178b;
        }
      }
      local_1c = local_1c + 1;
    } while (local_1c < *in_ECX);
  }
  uVar12 = 0;
  if (in_ECX[0x17] != 0) {
    do {
      iVar2 = *(int *)(in_ECX[0x1a] + (uVar12 >> 8) * 4);
      puVar1 = (undefined2 *)(iVar2 + (uVar12 & 0xff) * 0xc);
      FUN_005da450(*puVar1,puVar1[2],*(undefined2 *)(iVar2 + 8 + (uVar12 & 0xff) * 0xc));
      uVar12 = uVar12 + 1;
    } while (uVar12 < in_ECX[0x17]);
  }
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00601510 : SUB ESP,0x20
00601513 : PUSH EBX
00601514 : PUSH ESI
00601515 : MOV ESI,dword ptr [ESP + 0x2c]
00601519 : MOV EBX,ECX
0060151b : MOV EAX,dword ptr [EBX]
0060151d : PUSH EDI
0060151e : PUSH EAX
0060151f : MOV ECX,ESI
00601521 : CALL 0x005f8d90
00601526 : MOV ECX,dword ptr [ESI + 0xc]
00601529 : MOV EDX,dword ptr [ECX]
0060152b : XOR ECX,ECX
0060152d : MOV dword ptr [ESP + 0x18],EDX
00601531 : CMP dword ptr [EBX + 0x80],ECX
00601537 : JZ 0x00601545
00601539 : MOV EAX,dword ptr [EBX + 0x84]
0060153f : MOV dword ptr [ESP + 0x14],EAX
00601543 : JMP 0x00601549
00601545 : MOV dword ptr [ESP + 0x14],ECX
00601549 : MOV dword ptr [ESP + 0x10],ECX
0060154d : CMP dword ptr [EBX],ECX
0060154f : JBE 0x006017a2
00601555 : PUSH EBP
00601556 : JMP 0x00601568
00601560 : MOV ECX,dword ptr [ESP + 0x14]
00601564 : MOV ESI,dword ptr [ESP + 0x34]
00601568 : MOV EDI,dword ptr [EBX + 0xc]
0060156b : MOV EDX,ECX
0060156d : MOV EAX,ECX
0060156f : AND EAX,0xff
00601574 : SHR EDX,0x8
00601577 : MOV EDX,dword ptr [EDI + EDX*0x4]
0060157a : LEA EAX,[EAX + EAX*0x2]
0060157d : FLD float ptr [EDX + EAX*0x4]
00601580 : LEA EBP,[EDX + EAX*0x4]
00601583 : MOV EAX,dword ptr [ESI + 0xc]
00601586 : FSTP float ptr [ESP + 0x28]
0060158a : MOV EDI,dword ptr [EAX + 0x4]
0060158d : FLD float ptr [EBP + 0x4]
00601590 : IMUL EDI,ECX
00601593 : FSTP float ptr [ESP + 0x2c]
00601597 : ADD EDI,dword ptr [ESI + 0x8]
0060159a : MOV ESI,dword ptr [EAX + 0x8]
0060159d : LEA EAX,[ESP + 0x28]
006015a1 : PUSH EAX
006015a2 : LEA ECX,[ESP + 0x24]
006015a6 : PUSH ECX
006015a7 : MOV ECX,dword ptr [ESP + 0x44]
006015ab : CALL 0x00522c50
006015b0 : FLD float ptr [ESP + 0x20]
006015b4 : FLD ST0
006015b6 : FABS
006015b8 : FSTP float ptr [ESP + 0x10]
006015bc : FLD float ptr [ESP + 0x10]
006015c0 : FLD double ptr [0x00b8d1d0]
006015c6 : FCOM
006015c8 : FNSTSW AX
006015ca : FSTP ST1
006015cc : TEST AH,0x5
006015cf : JP 0x006015f4
006015d1 : FCOM
006015d3 : FNSTSW AX
006015d5 : FSTP ST1
006015d7 : TEST AH,0x5
006015da : JP 0x006015e8
006015dc : FLD float ptr [0x00cdf18c]
006015e2 : FSTP float ptr [ESP + 0x20]
006015e6 : JMP 0x006015f6
006015e8 : FLD float ptr [0x00b8d1cc]
006015ee : FSTP float ptr [ESP + 0x20]
006015f2 : JMP 0x006015f6
006015f4 : FSTP ST1
006015f6 : FLD float ptr [ESP + 0x24]
006015fa : FLD ST0
006015fc : FABS
006015fe : FSTP float ptr [ESP + 0x10]
00601602 : FLD float ptr [ESP + 0x10]
00601606 : FCOMP ST2
00601608 : FNSTSW AX
0060160a : TEST AH,0x41
0060160d : JNZ 0x00601630
0060160f : FCOMPP
00601611 : FNSTSW AX
00601613 : TEST AH,0x41
00601616 : JNZ 0x00601624
00601618 : FLD float ptr [0x00cdf18c]
0060161e : FSTP float ptr [ESP + 0x24]
00601622 : JMP 0x00601634
00601624 : FLD float ptr [0x00b8d1cc]
0060162a : FSTP float ptr [ESP + 0x24]
0060162e : JMP 0x00601634
00601630 : FSTP ST1
00601632 : FSTP ST0
00601634 : FLD float ptr [ESP + 0x24]
00601638 : MOV EDX,dword ptr [ESI]
0060163a : MOV EAX,dword ptr [EDX + 0x4]
0060163d : PUSH 0x0
0060163f : SUB ESP,0x8
00601642 : FSTP float ptr [ESP + 0x4]
00601646 : MOV ECX,ESI
00601648 : FLD float ptr [ESP + 0x2c]
0060164c : FSTP float ptr [ESP]
0060164f : PUSH EDI
00601650 : CALL EAX
00601652 : MOV EAX,dword ptr [EBP + 0x8]
00601655 : MOV dword ptr [ESP + 0x10],EAX
00601659 : AND EAX,0xffffff
0060165e : CMP EAX,dword ptr [ESP + 0x18]
00601662 : SETGE CL
00601665 : TEST CL,CL
00601667 : JNZ 0x0060167c
00601669 : MOV EBP,dword ptr [EBX + 0x80]
0060166f : LEA EDX,[EAX + EAX*0x4]
00601672 : CMP byte ptr [EBP + EDX*0x8],CL
00601676 : JZ 0x0060167c
00601678 : XOR DL,DL
0060167a : JMP 0x0060167e
0060167c : MOV DL,0x1
0060167e : TEST dword ptr [ESP + 0x10],0x80000000
00601686 : JZ 0x00601740
0060168c : CMP dword ptr [ESP + 0x1c],0x3
00601691 : JNZ 0x006016e0
00601693 : TEST CL,CL
00601695 : JZ 0x006016a6
00601697 : MOV EAX,dword ptr [ESI]
00601699 : MOV EDX,dword ptr [EAX + 0x10]
0060169c : PUSH 0xffffff
006016a1 : JMP 0x0060178b
006016a6 : TEST DL,DL
006016a8 : JZ 0x00601790
006016ae : MOV ECX,dword ptr [EBX + 0x80]
006016b4 : LEA EAX,[EAX + EAX*0x4]
006016b7 : MOV EAX,dword ptr [ECX + EAX*0x8 + 0x4]
006016bb : MOV EDX,EAX
006016bd : MOV dword ptr [ESP + 0x10],EAX
006016c1 : SHR EDX,0x10
006016c4 : MOV byte ptr [ESP + 0x10],DL
006016c8 : MOV byte ptr [ESP + 0x12],AL
006016cc : MOV EAX,dword ptr [ESI]
006016ce : MOV ECX,dword ptr [ESP + 0x10]
006016d2 : MOV EDX,dword ptr [EAX + 0x10]
006016d5 : AND ECX,0xffffff
006016db : JMP 0x0060178a
006016e0 : TEST CL,CL
006016e2 : JZ 0x006016fb
006016e4 : MOV EAX,dword ptr [ESI]
006016e6 : MOV EDX,dword ptr [EAX + 0x10]
006016e9 : PUSH -0x1
006016eb : PUSH EDI
006016ec : MOV ECX,ESI
006016ee : CALL EDX
006016f0 : MOV ECX,dword ptr [EBX + 0x8c]
006016f6 : JMP 0x00601785
006016fb : TEST DL,DL
006016fd : JZ 0x00601734
006016ff : MOV ECX,dword ptr [EBX + 0x80]
00601705 : LEA EAX,[EAX + EAX*0x4]
00601708 : MOV EAX,dword ptr [ECX + EAX*0x8 + 0x4]
0060170c : MOV EDX,EAX
0060170e : MOV dword ptr [ESP + 0x10],EAX
00601712 : SHR EDX,0x10
00601715 : MOV byte ptr [ESP + 0x10],DL
00601719 : MOV byte ptr [ESP + 0x12],AL
0060171d : MOV ECX,dword ptr [ESP + 0x10]
00601721 : MOV EAX,dword ptr [ESI]
00601723 : MOV EDX,dword ptr [EAX + 0x10]
00601726 : PUSH ECX
00601727 : PUSH EDI
00601728 : MOV ECX,ESI
0060172a : CALL EDX
0060172c : MOV ECX,dword ptr [EBX + 0x8c]
00601732 : JMP 0x00601785
00601734 : MOV EAX,dword ptr [ESI]
00601736 : MOV EDX,dword ptr [EAX + 0x14]
00601739 : PUSH 0xffffff
0060173e : JMP 0x0060178b
00601740 : TEST CL,CL
00601742 : JZ 0x00601748
00601744 : PUSH -0x1
00601746 : JMP 0x0060176f
00601748 : TEST DL,DL
0060174a : JZ 0x00601779
0060174c : MOV ECX,dword ptr [EBX + 0x80]
00601752 : LEA EAX,[EAX + EAX*0x4]
00601755 : MOV EAX,dword ptr [ECX + EAX*0x8 + 0x4]
00601759 : MOV EDX,EAX
0060175b : MOV dword ptr [ESP + 0x10],EAX
0060175f : SHR EDX,0x10
00601762 : MOV byte ptr [ESP + 0x10],DL
00601766 : MOV byte ptr [ESP + 0x12],AL
0060176a : MOV ECX,dword ptr [ESP + 0x10]
0060176e : PUSH ECX
0060176f : MOV EAX,dword ptr [ESI]
00601771 : MOV EDX,dword ptr [EAX + 0x10]
00601774 : PUSH EDI
00601775 : MOV ECX,ESI
00601777 : CALL EDX
00601779 : MOV ECX,dword ptr [EBX + 0x8c]
0060177f : OR ECX,0xff000000
00601785 : MOV EAX,dword ptr [ESI]
00601787 : MOV EDX,dword ptr [EAX + 0x14]
0060178a : PUSH ECX
0060178b : PUSH EDI
0060178c : MOV ECX,ESI
0060178e : CALL EDX
00601790 : MOV EAX,dword ptr [ESP + 0x14]
00601794 : INC EAX
00601795 : MOV dword ptr [ESP + 0x14],EAX
00601799 : CMP EAX,dword ptr [EBX]
0060179b : JC 0x00601560
006017a1 : POP EBP
006017a2 : XOR ESI,ESI
006017a4 : CMP dword ptr [EBX + 0x5c],ESI
006017a7 : JBE 0x006017e4
006017a9 : MOV EDI,dword ptr [ESP + 0x34]
006017ad : LEA ECX,[ECX]
006017b0 : MOV EDX,dword ptr [EBX + 0x68]
006017b3 : MOV ECX,ESI
006017b5 : SHR ECX,0x8
006017b8 : MOV ECX,dword ptr [EDX + ECX*0x4]
006017bb : MOV EAX,ESI
006017bd : AND EAX,0xff
006017c2 : LEA EAX,[EAX + EAX*0x2]
006017c5 : MOVZX EDX,word ptr [ECX + EAX*0x4 + 0x8]
006017ca : LEA EAX,[ECX + EAX*0x4]
006017cd : MOVZX ECX,word ptr [EAX + 0x4]
006017d1 : PUSH EDX
006017d2 : MOVZX EDX,word ptr [EAX]
006017d5 : PUSH ECX
006017d6 : PUSH EDX
006017d7 : MOV ECX,EDI
006017d9 : CALL 0x005da450
006017de : INC ESI
006017df : CMP ESI,dword ptr [EBX + 0x5c]
006017e2 : JC 0x006017b0
006017e4 : POP EDI
006017e5 : POP ESI
006017e6 : MOV AL,0x1
006017e8 : POP EBX
006017e9 : ADD ESP,0x20
006017ec : RET 0xc
