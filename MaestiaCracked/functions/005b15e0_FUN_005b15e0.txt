PROGRAM  : Maestia.exe
FUNCTION : FUN_005b15e0
ENTRY    : 005b15e0
BODY     : [[005b15e0, 005b18fd]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005b15e0(int param_1,undefined1 param_2)

{
  undefined1 *puVar1;
  int *piVar2;
  byte *pbVar3;
  uint uVar4;
  int iVar5;
  char *pcVar6;
  int iVar7;
  undefined4 uVar8;
  int iVar9;
  int *piVar10;
  int iVar11;
  float10 fVar12;
  undefined4 local_1c;
  int local_14;
  int local_10;
  int local_c;
  int local_8;
  byte local_4;
  
  iVar5 = param_1;
  puVar1 = *(undefined1 **)(param_1 + 4);
  FUN_00526400();
  *puVar1 = 0;
  if (*(int *)(param_1 + 0x1c) < 2) {
    return;
  }
  param_1 = 1;
  pcVar6 = (char *)FUN_00526260(0);
  if ((*pcVar6 == '\b') || (*pcVar6 == '\v')) {
    iVar7 = FUN_00515840(0x40,0);
    if (iVar7 == 0) {
      iVar7 = 0;
    }
    else {
      iVar9 = *(int *)(iVar5 + 0x18);
      iVar7 = iVar9 + 0x78;
      piVar10 = &local_c;
      FUN_00526260(0);
      uVar8 = FUN_00527140(piVar10,iVar9);
      iVar7 = FUN_005b10d0(uVar8,iVar7);
      if (((local_4 & 2) == 0) && (local_c != 0)) {
        FUN_00503db0();
      }
      local_c = 0;
      if (((local_4 & 1) == 0) && (local_8 != 0)) {
        FUN_00503db0();
      }
      local_8 = 0;
    }
    goto LAB_005b17b3;
  }
  pcVar6 = (char *)FUN_00526260(0);
  if (*pcVar6 == '\x06') {
    iVar7 = FUN_00515840(0x40,0);
    if (iVar7 != 0) {
      uVar8 = *(undefined4 *)(iVar5 + 0x18);
      FUN_00526260(1);
      FUN_005272e0(&local_14,uVar8,0xffffffff,0);
      uVar8 = *(undefined4 *)(iVar5 + 0x18);
      piVar10 = &local_14;
      FUN_00526260(0);
      uVar8 = FUN_00526fa0(uVar8);
      iVar7 = FUN_005b1150(uVar8,piVar10);
      goto LAB_005b179a;
    }
    iVar7 = 0;
  }
  else {
    pcVar6 = (char *)FUN_00526260(0);
    if (*pcVar6 != '\a') {
      return;
    }
    iVar7 = FUN_00515840(0x40,0);
    if (iVar7 == 0) {
      iVar7 = 0;
    }
    else {
      uVar8 = *(undefined4 *)(iVar5 + 0x18);
      FUN_00526260(1);
      FUN_005272e0(&local_10,uVar8,0xffffffff,0);
      uVar8 = *(undefined4 *)(iVar5 + 0x18);
      piVar10 = &local_10;
      FUN_00526260(0);
      uVar8 = FUN_00525fa0(uVar8);
      iVar7 = FUN_005b11b0(uVar8,piVar10);
      local_14 = local_10;
LAB_005b179a:
      *(int *)(local_14 + 8) = *(int *)(local_14 + 8) + -1;
      if (*(int *)(local_14 + 8) == 0) {
        FUN_00525340();
      }
    }
  }
  param_1 = 2;
LAB_005b17b3:
  if (param_1 < *(int *)(iVar5 + 0x1c)) {
    piVar10 = *(int **)(*(int *)(iVar5 + 0x18) + 0x74);
    if (piVar10 != (int *)0x0) {
      iVar9 = (**(code **)(*piVar10 + 0x54))(0);
      piVar10 = *(int **)(iVar9 + 0x80);
      if (piVar10 == (int *)0x0) {
        piVar10 = (int *)FUN_00520df0();
      }
      if (piVar10 != (int *)0x0) {
        *piVar10 = *piVar10 + 1;
      }
      piVar2 = *(int **)(iVar7 + 0x34);
      if ((piVar2 != (int *)0x0) && (*piVar2 = *piVar2 + -1, *piVar2 < 1)) {
        FUN_0051d070();
        FUN_00515cf0(piVar2);
      }
      *(int **)(iVar7 + 0x34) = piVar10;
    }
    FUN_00526260(param_1);
    fVar12 = (float10)FUN_00527730(*(undefined4 *)(iVar5 + 0x18));
    param_1 = param_1 + 1;
    *(undefined1 *)(iVar7 + 0x39) = param_2;
    local_1c = (undefined4)(longlong)ROUND(fVar12);
    *(undefined4 *)(iVar7 + 0x24) = local_1c;
    if (param_1 < *(int *)(iVar5 + 0x1c)) {
      do {
        uVar8 = FUN_00526260(param_1);
        FUN_005034e0((int *)(iVar7 + 0x18),*(int *)(iVar7 + 0x1c) + 1);
        if (*(int *)(iVar7 + 0x1c) * 0x10 + -0x10 + *(int *)(iVar7 + 0x18) != 0) {
          FUN_005266c0(uVar8);
        }
        param_1 = param_1 + 1;
      } while (param_1 < *(int *)(iVar5 + 0x1c));
    }
    iVar9 = FUN_005296a0();
    iVar11 = FUN_00571d90(iVar7);
    pbVar3 = *(byte **)(iVar5 + 4);
    if (4 < *pbVar3) {
      FUN_00526400();
    }
    *pbVar3 = 3;
    *(double *)(pbVar3 + 4) = (double)iVar11;
    uVar4 = *(uint *)(iVar9 + 0x130);
    iVar5 = *(int *)(iVar9 + 0x134);
    *(uint *)(iVar7 + 0x28) = *(uint *)(iVar7 + 0x24) + *(uint *)(iVar9 + 0x130);
    *(uint *)(iVar7 + 0x2c) = iVar5 + (uint)CARRY4(*(uint *)(iVar7 + 0x24),uVar4);
  }
  else if (iVar7 != 0) {
    FUN_00571d00();
    FUN_00515cf0(iVar7);
    return;
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005b15e0 : SUB ESP,0x1c
005b15e3 : PUSH EBP
005b15e4 : PUSH ESI
005b15e5 : MOV ESI,dword ptr [ESP + 0x28]
005b15e9 : PUSH EDI
005b15ea : MOV EDI,dword ptr [ESI + 0x4]
005b15ed : XOR EBP,EBP
005b15ef : MOV ECX,EDI
005b15f1 : MOV dword ptr [ESP + 0xc],EBP
005b15f5 : CALL 0x00526400
005b15fa : MOV byte ptr [EDI],0x0
005b15fd : CMP dword ptr [ESI + 0x1c],0x2
005b1601 : JL 0x005b18f7
005b1607 : MOV EAX,dword ptr [ESI + 0x18]
005b160a : MOV ECX,dword ptr [EAX + 0x78]
005b160d : MOV EDI,dword ptr [ECX + 0x288]
005b1613 : PUSH EBX
005b1614 : MOV EBX,0x1
005b1619 : PUSH EBP
005b161a : MOV ECX,ESI
005b161c : MOV dword ptr [ESP + 0x34],EBX
005b1620 : CALL 0x00526260
005b1625 : MOV AL,byte ptr [EAX]
005b1627 : CMP AL,0x8
005b1629 : JZ 0x005b162f
005b162b : CMP AL,0xb
005b162d : JNZ 0x005b16ad
005b162f : PUSH EBP
005b1630 : PUSH 0x40
005b1632 : MOV ECX,EDI
005b1634 : CALL 0x00515840
005b1639 : MOV EDI,EAX
005b163b : CMP EDI,EBP
005b163d : JZ 0x005b166b
005b163f : MOV EAX,dword ptr [ESI + 0x18]
005b1642 : LEA ECX,[EAX + 0x78]
005b1645 : PUSH ECX
005b1646 : PUSH EAX
005b1647 : LEA EDX,[ESP + 0x28]
005b164b : PUSH EDX
005b164c : PUSH EBP
005b164d : MOV ECX,ESI
005b164f : MOV dword ptr [ESP + 0x20],EBX
005b1653 : CALL 0x00526260
005b1658 : MOV ECX,EAX
005b165a : CALL 0x00527140
005b165f : PUSH EAX
005b1660 : MOV ECX,EDI
005b1662 : CALL 0x005b10d0
005b1667 : MOV EBX,EAX
005b1669 : JMP 0x005b166d
005b166b : XOR EBX,EBX
005b166d : TEST byte ptr [ESP + 0x10],0x1
005b1672 : JZ 0x005b17b3
005b1678 : TEST byte ptr [ESP + 0x28],0x2
005b167d : JNZ 0x005b168c
005b167f : MOV ECX,dword ptr [ESP + 0x20]
005b1683 : CMP ECX,EBP
005b1685 : JZ 0x005b168c
005b1687 : CALL 0x00503db0
005b168c : TEST byte ptr [ESP + 0x28],0x1
005b1691 : MOV dword ptr [ESP + 0x20],EBP
005b1695 : JNZ 0x005b16a4
005b1697 : MOV ECX,dword ptr [ESP + 0x24]
005b169b : CMP ECX,EBP
005b169d : JZ 0x005b16a4
005b169f : CALL 0x00503db0
005b16a4 : MOV dword ptr [ESP + 0x24],EBP
005b16a8 : JMP 0x005b17b3
005b16ad : PUSH EBP
005b16ae : MOV ECX,ESI
005b16b0 : CALL 0x00526260
005b16b5 : CMP byte ptr [EAX],0x6
005b16b8 : PUSH EBP
005b16b9 : JNZ 0x005b1725
005b16bb : PUSH 0x40
005b16bd : MOV ECX,EDI
005b16bf : CALL 0x00515840
005b16c4 : MOV EBX,EAX
005b16c6 : CMP EBX,EBP
005b16c8 : JZ 0x005b1712
005b16ca : MOV EDI,dword ptr [ESI + 0x18]
005b16cd : PUSH 0x1
005b16cf : MOV ECX,ESI
005b16d1 : MOV dword ptr [ESP + 0x14],0x2
005b16d9 : CALL 0x00526260
005b16de : PUSH EBP
005b16df : PUSH -0x1
005b16e1 : PUSH EDI
005b16e2 : LEA ECX,[ESP + 0x24]
005b16e6 : PUSH ECX
005b16e7 : MOV ECX,EAX
005b16e9 : CALL 0x005272e0
005b16ee : MOV EAX,dword ptr [ESI + 0x18]
005b16f1 : LEA EDX,[ESP + 0x18]
005b16f5 : PUSH EDX
005b16f6 : PUSH EAX
005b16f7 : PUSH EBP
005b16f8 : MOV ECX,ESI
005b16fa : CALL 0x00526260
005b16ff : MOV ECX,EAX
005b1701 : CALL 0x00526fa0
005b1706 : PUSH EAX
005b1707 : MOV ECX,EBX
005b1709 : CALL 0x005b1150
005b170e : MOV EBX,EAX
005b1710 : JMP 0x005b1714
005b1712 : XOR EBX,EBX
005b1714 : TEST byte ptr [ESP + 0x10],0x2
005b1719 : JZ 0x005b17ab
005b171f : MOV EAX,dword ptr [ESP + 0x18]
005b1723 : JMP 0x005b179a
005b1725 : MOV ECX,ESI
005b1727 : CALL 0x00526260
005b172c : CMP byte ptr [EAX],0x7
005b172f : JNZ 0x005b18f6
005b1735 : PUSH EBP
005b1736 : PUSH 0x40
005b1738 : MOV ECX,EDI
005b173a : CALL 0x00515840
005b173f : MOV EBX,EAX
005b1741 : CMP EBX,EBP
005b1743 : JZ 0x005b178d
005b1745 : MOV EDI,dword ptr [ESI + 0x18]
005b1748 : PUSH 0x1
005b174a : MOV ECX,ESI
005b174c : MOV dword ptr [ESP + 0x14],0x4
005b1754 : CALL 0x00526260
005b1759 : PUSH EBP
005b175a : PUSH -0x1
005b175c : PUSH EDI
005b175d : LEA ECX,[ESP + 0x28]
005b1761 : PUSH ECX
005b1762 : MOV ECX,EAX
005b1764 : CALL 0x005272e0
005b1769 : MOV EAX,dword ptr [ESI + 0x18]
005b176c : LEA EDX,[ESP + 0x1c]
005b1770 : PUSH EDX
005b1771 : PUSH EAX
005b1772 : PUSH EBP
005b1773 : MOV ECX,ESI
005b1775 : CALL 0x00526260
005b177a : MOV ECX,EAX
005b177c : CALL 0x00525fa0
005b1781 : PUSH EAX
005b1782 : MOV ECX,EBX
005b1784 : CALL 0x005b11b0
005b1789 : MOV EBX,EAX
005b178b : JMP 0x005b178f
005b178d : XOR EBX,EBX
005b178f : TEST byte ptr [ESP + 0x10],0x4
005b1794 : JZ 0x005b17ab
005b1796 : MOV EAX,dword ptr [ESP + 0x1c]
005b179a : DEC dword ptr [EAX + 0x8]
005b179d : MOV ECX,EAX
005b179f : ADD EAX,0x8
005b17a2 : CMP dword ptr [EAX],EBP
005b17a4 : JNZ 0x005b17ab
005b17a6 : CALL 0x00525340
005b17ab : MOV dword ptr [ESP + 0x30],0x2
005b17b3 : MOV EDI,dword ptr [ESP + 0x30]
005b17b7 : CMP dword ptr [ESI + 0x1c],EDI
005b17ba : JG 0x005b17d9
005b17bc : CMP EBX,EBP
005b17be : JZ 0x005b18f6
005b17c4 : MOV ECX,EBX
005b17c6 : CALL 0x00571d00
005b17cb : PUSH EBX
005b17cc : CALL 0x00515cf0
005b17d1 : POP EBX
005b17d2 : POP EDI
005b17d3 : POP ESI
005b17d4 : POP EBP
005b17d5 : ADD ESP,0x1c
005b17d8 : RET
005b17d9 : MOV ECX,dword ptr [ESI + 0x18]
005b17dc : MOV ECX,dword ptr [ECX + 0x74]
005b17df : CMP ECX,EBP
005b17e1 : JZ 0x005b182b
005b17e3 : MOV EDX,dword ptr [ECX]
005b17e5 : MOV EAX,dword ptr [EDX + 0x54]
005b17e8 : PUSH EBP
005b17e9 : CALL EAX
005b17eb : MOV ECX,dword ptr [EAX + 0x80]
005b17f1 : CMP ECX,EBP
005b17f3 : JNZ 0x005b1800
005b17f5 : MOV ECX,EAX
005b17f7 : CALL 0x00520df0
005b17fc : MOV EBP,EAX
005b17fe : JMP 0x005b1802
005b1800 : MOV EBP,ECX
005b1802 : TEST EBP,EBP
005b1804 : JZ 0x005b1809
005b1806 : INC dword ptr [EBP]
005b1809 : MOV EDI,dword ptr [EBX + 0x34]
005b180c : TEST EDI,EDI
005b180e : JZ 0x005b1824
005b1810 : DEC dword ptr [EDI]
005b1812 : CMP dword ptr [EDI],0x0
005b1815 : JG 0x005b1824
005b1817 : MOV ECX,EDI
005b1819 : CALL 0x0051d070
005b181e : PUSH EDI
005b181f : CALL 0x00515cf0
005b1824 : MOV EDI,dword ptr [ESP + 0x30]
005b1828 : MOV dword ptr [EBX + 0x34],EBP
005b182b : PUSH EDI
005b182c : MOV ECX,ESI
005b182e : CALL 0x00526260
005b1833 : MOV ECX,dword ptr [ESI + 0x18]
005b1836 : PUSH ECX
005b1837 : MOV ECX,EAX
005b1839 : CALL 0x00527730
005b183e : FNSTCW word ptr [ESP + 0x30]
005b1842 : MOVZX EAX,word ptr [ESP + 0x30]
005b1847 : OR EAX,0xc00
005b184c : MOV dword ptr [ESP + 0x10],EAX
005b1850 : MOV AL,byte ptr [ESP + 0x34]
005b1854 : LEA EBP,[EDI + 0x1]
005b1857 : FLDCW word ptr [ESP + 0x10]
005b185b : MOV byte ptr [EBX + 0x39],AL
005b185e : FISTP qword ptr [ESP + 0x10]
005b1862 : MOV EDX,dword ptr [ESP + 0x10]
005b1866 : MOV dword ptr [EBX + 0x24],EDX
005b1869 : CMP EBP,dword ptr [ESI + 0x1c]
005b186c : FLDCW word ptr [ESP + 0x30]
005b1870 : JGE 0x005b18ae
005b1872 : LEA EDI,[EBX + 0x18]
005b1875 : PUSH EBP
005b1876 : MOV ECX,ESI
005b1878 : CALL 0x00526260
005b187d : MOV ECX,dword ptr [EDI + 0x4]
005b1880 : INC ECX
005b1881 : PUSH ECX
005b1882 : PUSH EDI
005b1883 : MOV ECX,EDI
005b1885 : MOV dword ptr [ESP + 0x38],EAX
005b1889 : CALL 0x005034e0
005b188e : MOV EDX,dword ptr [EDI + 0x4]
005b1891 : MOV EAX,dword ptr [EDI]
005b1893 : SHL EDX,0x4
005b1896 : LEA ECX,[EDX + EAX*0x1 + -0x10]
005b189a : TEST ECX,ECX
005b189c : JZ 0x005b18a8
005b189e : MOV EDX,dword ptr [ESP + 0x30]
005b18a2 : PUSH EDX
005b18a3 : CALL 0x005266c0
005b18a8 : INC EBP
005b18a9 : CMP EBP,dword ptr [ESI + 0x1c]
005b18ac : JL 0x005b1875
005b18ae : MOV ECX,dword ptr [ESI + 0x18]
005b18b1 : CALL 0x005296a0
005b18b6 : MOV EDI,EAX
005b18b8 : PUSH EBX
005b18b9 : MOV ECX,EDI
005b18bb : CALL 0x00571d90
005b18c0 : MOV ESI,dword ptr [ESI + 0x4]
005b18c3 : CMP byte ptr [ESI],0x5
005b18c6 : MOV dword ptr [ESP + 0x30],EAX
005b18ca : JC 0x005b18d3
005b18cc : MOV ECX,ESI
005b18ce : CALL 0x00526400
005b18d3 : FILD dword ptr [ESP + 0x30]
005b18d7 : MOV byte ptr [ESI],0x3
005b18da : XOR ECX,ECX
005b18dc : FSTP double ptr [ESI + 0x4]
005b18df : MOV EAX,dword ptr [EBX + 0x24]
005b18e2 : ADD EAX,dword ptr [EDI + 0x130]
005b18e8 : MOV EDX,dword ptr [EDI + 0x134]
005b18ee : ADC EDX,ECX
005b18f0 : MOV dword ptr [EBX + 0x28],EAX
005b18f3 : MOV dword ptr [EBX + 0x2c],EDX
005b18f6 : POP EBX
005b18f7 : POP EDI
005b18f8 : POP ESI
005b18f9 : POP EBP
005b18fa : ADD ESP,0x1c
005b18fd : RET
