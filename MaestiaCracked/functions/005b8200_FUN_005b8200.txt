PROGRAM  : Maestia.exe
FUNCTION : FUN_005b8200
ENTRY    : 005b8200
BODY     : [[005b8200, 005b8483]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_005b8200(int *param_1,uint *param_2)

{
  char cVar1;
  int *piVar2;
  int iVar3;
  uint uVar4;
  GRefCountNTSImpl *in_ECX;
  int iStack_58;
  int iStack_54;
  int iStack_50;
  int iStack_4c;
  int iStack_48;
  int iStack_44;
  undefined4 uStack_40;
  undefined4 uStack_3c;
  undefined2 uStack_38;
  undefined1 uStack_36;
  undefined1 uStack_35;
  undefined1 uStack_34;
  undefined1 uStack_33;
  undefined4 uStack_30;
  undefined4 uStack_2c;
  undefined4 uStack_28;
  undefined2 uStack_24;
  undefined1 uStack_22;
  undefined1 uStack_21;
  undefined1 uStack_20;
  undefined1 uStack_1f;
  undefined1 auStack_10 [16];
  
  iStack_54 = (**(code **)(*(int *)in_ECX + 0x5c))();
  iVar3 = iStack_54 + 0x78;
  FUN_00529910(&iStack_58,iVar3);
  piVar2 = (int *)(**(code **)(*(int *)in_ECX + 0x40))();
  if (*(int *)(iStack_58 + 0x10) != 0) {
    auStack_10[0] = 0;
    if ((*param_1 == 0x40) || (*param_1 == 0x80)) {
      cVar1 = (**(code **)(*(int *)(in_ECX + 0x68) + 0x2c))(iVar3,&iStack_58,auStack_10);
      if ((cVar1 != '\0') && (5 < *(byte *)(iStack_54 + 0x7c))) {
        cVar1 = FUN_0050c880(in_ECX);
        if ((cVar1 != '\0') && ((*(byte *)((int)piVar2 + 0xb02) & 1) != 0)) {
          iVar3 = FUN_00571c40(4);
          if (iVar3 != 0) {
            iStack_50 = *param_1;
            iStack_48 = param_1[2];
            iStack_4c = param_1[1];
            iStack_44 = param_1[3];
            *(undefined4 *)(iVar3 + 4) = 2;
            *(int *)(in_ECX + 4) = *(int *)(in_ECX + 4) + 1;
            if (*(GRefCountNTSImpl **)(iVar3 + 8) != (GRefCountNTSImpl *)0x0) {
              GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(iVar3 + 8));
            }
            *(GRefCountNTSImpl **)(iVar3 + 8) = in_ECX;
            if (*(GRefCountNTSImpl **)(iVar3 + 0xc) != (GRefCountNTSImpl *)0x0) {
              GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(iVar3 + 0xc));
            }
            *(undefined4 *)(iVar3 + 0xc) = 0;
            *(int *)(iVar3 + 0x10) = iStack_50;
            *(int *)(iVar3 + 0x14) = iStack_4c;
            *(int *)(iVar3 + 0x18) = iStack_48;
            *(int *)(iVar3 + 0x1c) = iStack_44;
          }
        }
      }
    }
    FUN_00526bc0();
  }
  if (*param_1 == 0x40) {
    if ((*param_2 & 1) == 0) {
      uStack_38 = (undefined2)param_1[2];
      uStack_36 = *(undefined1 *)((int)param_1 + 10);
      uStack_40 = 0x20000;
      uStack_3c = 0;
      uStack_35 = 0;
      uStack_34 = 0;
      uStack_33 = 0;
      cVar1 = (**(code **)(*(int *)in_ECX + 0xe8))(&uStack_40);
      if (cVar1 != '\0') {
        *param_2 = *param_2 | 1;
      }
    }
    cVar1 = FUN_0050c880(in_ECX);
    if (((cVar1 != '\0') && ((*(byte *)((int)piVar2 + 0xb02) & 1) != 0)) &&
       (((short)param_1[2] == 0xd || ((short)param_1[2] == 0x20)))) {
      cVar1 = (**(code **)(*(int *)in_ECX + 0xb8))();
      if ((cVar1 != '\0') || ((uVar4 = (uint)piVar2[0x2c0] >> 0x1a & 3, uVar4 != 3 && (uVar4 == 1)))
         ) {
        uStack_30 = 0x400;
        uStack_2c = 0;
        uStack_28 = 0xff000000;
        uStack_24 = 0;
        (**(code **)(*(int *)in_ECX + 0xe8))(&uStack_30);
        *(int *)(in_ECX + 4) = *(int *)(in_ECX + 4) + 1;
        (**(code **)(*piVar2 + 0x8c))(0,0);
        uStack_24 = 0;
        uStack_2c = 0x800;
        uStack_28 = 0;
        uStack_22 = 0;
        uStack_21 = 0xff;
        uStack_20 = 0;
        uStack_1f = 0;
        (**(code **)(*(int *)in_ECX + 0xe8))(&uStack_2c);
        GRefCountNTSImpl::Release(in_ECX);
      }
    }
  }
  *(int *)(iStack_58 + 8) = *(int *)(iStack_58 + 8) + -1;
  if (*(int *)(iStack_58 + 8) == 0) {
    FUN_00525340();
  }
  return 1;
}



============================================================
DISASSEMBLY
============================================================
005b8200 : SUB ESP,0x58
005b8203 : PUSH EBX
005b8204 : PUSH EBP
005b8205 : PUSH ESI
005b8206 : MOV ESI,ECX
005b8208 : MOV EAX,dword ptr [ESI]
005b820a : MOV EDX,dword ptr [EAX + 0x5c]
005b820d : PUSH EDI
005b820e : CALL EDX
005b8210 : MOV EBP,dword ptr [ESP + 0x6c]
005b8214 : LEA EDI,[EAX + 0x78]
005b8217 : MOV dword ptr [ESP + 0x14],EAX
005b821b : PUSH EDI
005b821c : LEA EAX,[ESP + 0x14]
005b8220 : PUSH EAX
005b8221 : MOV ECX,EBP
005b8223 : CALL 0x00529910
005b8228 : MOV EDX,dword ptr [ESI]
005b822a : MOV EAX,dword ptr [EDX + 0x40]
005b822d : MOV ECX,ESI
005b822f : CALL EAX
005b8231 : MOV ECX,dword ptr [ESP + 0x10]
005b8235 : XOR EBX,EBX
005b8237 : MOV dword ptr [ESP + 0x6c],EAX
005b823b : CMP dword ptr [ECX + 0x10],EBX
005b823e : JBE 0x005b8322
005b8244 : MOV EAX,dword ptr [EBP]
005b8247 : MOV byte ptr [ESP + 0x58],BL
005b824b : CMP EAX,0x40
005b824e : JZ 0x005b825b
005b8250 : CMP EAX,0x80
005b8255 : JNZ 0x005b8319
005b825b : MOV EDX,dword ptr [ESI + 0x68]
005b825e : MOV EDX,dword ptr [EDX + 0x2c]
005b8261 : LEA EAX,[ESP + 0x58]
005b8265 : PUSH EAX
005b8266 : LEA ECX,[ESI + 0x68]
005b8269 : LEA EAX,[ESP + 0x14]
005b826d : PUSH EAX
005b826e : PUSH EDI
005b826f : CALL EDX
005b8271 : TEST AL,AL
005b8273 : JZ 0x005b8319
005b8279 : MOV EAX,dword ptr [ESP + 0x14]
005b827d : CMP byte ptr [EAX + 0x7c],0x6
005b8281 : JC 0x005b8319
005b8287 : MOV ECX,dword ptr [ESP + 0x6c]
005b828b : PUSH ESI
005b828c : CALL 0x0050c880
005b8291 : TEST AL,AL
005b8293 : JZ 0x005b8319
005b8299 : MOV ECX,dword ptr [ESP + 0x6c]
005b829d : TEST byte ptr [ECX + 0xb02],0x1
005b82a4 : JZ 0x005b8319
005b82a6 : PUSH 0x4
005b82a8 : ADD ECX,0xa2c
005b82ae : CALL 0x00571c40
005b82b3 : MOV EDI,EAX
005b82b5 : CMP EDI,EBX
005b82b7 : JZ 0x005b8319
005b82b9 : MOV EDX,dword ptr [EBP]
005b82bc : MOV ECX,dword ptr [EBP + 0x8]
005b82bf : MOV EAX,dword ptr [EBP + 0x4]
005b82c2 : MOV dword ptr [ESP + 0x18],EDX
005b82c6 : MOV EDX,dword ptr [EBP + 0xc]
005b82c9 : MOV dword ptr [EDI + 0x4],0x2
005b82d0 : INC dword ptr [ESI + 0x4]
005b82d3 : MOV dword ptr [ESP + 0x20],ECX
005b82d7 : MOV ECX,dword ptr [EDI + 0x8]
005b82da : MOV dword ptr [ESP + 0x1c],EAX
005b82de : MOV dword ptr [ESP + 0x24],EDX
005b82e2 : CMP ECX,EBX
005b82e4 : JZ 0x005b82eb
005b82e6 : CALL 0x004ff7c0
005b82eb : MOV dword ptr [EDI + 0x8],ESI
005b82ee : MOV ECX,dword ptr [EDI + 0xc]
005b82f1 : CMP ECX,EBX
005b82f3 : JZ 0x005b82fa
005b82f5 : CALL 0x004ff7c0
005b82fa : MOV EAX,dword ptr [ESP + 0x18]
005b82fe : MOV ECX,dword ptr [ESP + 0x1c]
005b8302 : MOV EDX,dword ptr [ESP + 0x20]
005b8306 : MOV dword ptr [EDI + 0xc],EBX
005b8309 : MOV dword ptr [EDI + 0x10],EAX
005b830c : MOV EAX,dword ptr [ESP + 0x24]
005b8310 : MOV dword ptr [EDI + 0x14],ECX
005b8313 : MOV dword ptr [EDI + 0x18],EDX
005b8316 : MOV dword ptr [EDI + 0x1c],EAX
005b8319 : LEA ECX,[ESP + 0x58]
005b831d : CALL 0x00526bc0
005b8322 : CMP dword ptr [EBP],0x40
005b8326 : JNZ 0x005b8463
005b832c : MOV EDI,dword ptr [ESP + 0x70]
005b8330 : TEST byte ptr [EDI],0x1
005b8333 : JNZ 0x005b8375
005b8335 : MOV CX,word ptr [EBP + 0x8]
005b8339 : MOV DL,byte ptr [EBP + 0xa]
005b833c : MOV EAX,dword ptr [ESI]
005b833e : MOV word ptr [ESP + 0x30],CX
005b8343 : LEA ECX,[ESP + 0x28]
005b8347 : MOV byte ptr [ESP + 0x32],DL
005b834b : MOV EDX,dword ptr [EAX + 0xe8]
005b8351 : PUSH ECX
005b8352 : MOV ECX,ESI
005b8354 : MOV dword ptr [ESP + 0x2c],0x20000
005b835c : MOV dword ptr [ESP + 0x30],EBX
005b8360 : MOV byte ptr [ESP + 0x37],BL
005b8364 : MOV byte ptr [ESP + 0x38],BL
005b8368 : MOV byte ptr [ESP + 0x39],BL
005b836c : CALL EDX
005b836e : TEST AL,AL
005b8370 : JZ 0x005b8375
005b8372 : OR dword ptr [EDI],0x1
005b8375 : MOV ECX,dword ptr [ESP + 0x6c]
005b8379 : PUSH ESI
005b837a : CALL 0x0050c880
005b837f : TEST AL,AL
005b8381 : JZ 0x005b8463
005b8387 : MOV EDI,dword ptr [ESP + 0x6c]
005b838b : TEST byte ptr [EDI + 0xb02],0x1
005b8392 : JZ 0x005b8463
005b8398 : MOVZX EAX,word ptr [EBP + 0x8]
005b839c : CMP AX,0xd
005b83a0 : JZ 0x005b83ac
005b83a2 : CMP AX,0x20
005b83a6 : JNZ 0x005b8463
005b83ac : MOV EAX,dword ptr [ESI]
005b83ae : MOV EDX,dword ptr [EAX + 0xb8]
005b83b4 : MOV ECX,ESI
005b83b6 : CALL EDX
005b83b8 : TEST AL,AL
005b83ba : JNZ 0x005b83da
005b83bc : MOV EAX,dword ptr [EDI + 0xb00]
005b83c2 : SHR EAX,0x1a
005b83c5 : AND EAX,0x3
005b83c8 : CMP EAX,0x3
005b83cb : JZ 0x005b8463
005b83d1 : CMP EAX,0x1
005b83d4 : JNZ 0x005b8463
005b83da : MOV EDX,dword ptr [ESI]
005b83dc : MOV EDX,dword ptr [EDX + 0xe8]
005b83e2 : XOR EAX,EAX
005b83e4 : MOV word ptr [ESP + 0x40],AX
005b83e9 : LEA EAX,[ESP + 0x38]
005b83ed : PUSH EAX
005b83ee : MOV ECX,ESI
005b83f0 : MOV dword ptr [ESP + 0x3c],0x400
005b83f8 : MOV dword ptr [ESP + 0x40],EBX
005b83fc : MOV byte ptr [ESP + 0x46],BL
005b8400 : MOV byte ptr [ESP + 0x47],0xff
005b8405 : MOV byte ptr [ESP + 0x48],BL
005b8409 : MOV byte ptr [ESP + 0x49],BL
005b840d : CALL EDX
005b840f : FLDZ
005b8411 : INC dword ptr [ESI + 0x4]
005b8414 : MOV EAX,dword ptr [EDI]
005b8416 : MOV EDX,dword ptr [EAX + 0x8c]
005b841c : PUSH EBX
005b841d : PUSH ECX
005b841e : MOV ECX,EDI
005b8420 : FSTP float ptr [ESP]
005b8423 : CALL EDX
005b8425 : FSTP ST0
005b8427 : MOV EDX,dword ptr [ESI]
005b8429 : MOV EDX,dword ptr [EDX + 0xe8]
005b842f : XOR EAX,EAX
005b8431 : MOV word ptr [ESP + 0x50],AX
005b8436 : LEA EAX,[ESP + 0x48]
005b843a : PUSH EAX
005b843b : MOV ECX,ESI
005b843d : MOV dword ptr [ESP + 0x4c],0x800
005b8445 : MOV dword ptr [ESP + 0x50],EBX
005b8449 : MOV byte ptr [ESP + 0x56],BL
005b844d : MOV byte ptr [ESP + 0x57],0xff
005b8452 : MOV byte ptr [ESP + 0x58],BL
005b8456 : MOV byte ptr [ESP + 0x59],BL
005b845a : CALL EDX
005b845c : MOV ECX,ESI
005b845e : CALL 0x004ff7c0
005b8463 : MOV EAX,dword ptr [ESP + 0x10]
005b8467 : DEC dword ptr [EAX + 0x8]
005b846a : POP EDI
005b846b : MOV ECX,EAX
005b846d : ADD EAX,0x8
005b8470 : CMP dword ptr [EAX],EBX
005b8472 : POP ESI
005b8473 : POP EBP
005b8474 : POP EBX
005b8475 : JNZ 0x005b847c
005b8477 : CALL 0x00525340
005b847c : MOV AL,0x1
005b847e : ADD ESP,0x58
005b8481 : RET 0x8
