PROGRAM  : Maestia.exe
FUNCTION : FUN_00661a60
ENTRY    : 00661a60
BODY     : [[00661a60, 00661b09] [00661b10, 00661bcf]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00661a60(int param_1,uint param_2,undefined4 *param_3,int *param_4)

{
  int iVar1;
  undefined4 *puVar2;
  undefined4 *puVar3;
  undefined4 *local_68;
  int iStack_64;
  int *local_60;
  int local_5c;
  undefined4 auStack_58 [15];
  undefined4 uStack_1c;
  undefined4 uStack_18;
  undefined4 uStack_14;
  uint local_10;
  void *local_c;
  undefined1 *puStack_8;
  undefined4 uStack_4;
  
  uStack_4 = 0xffffffff;
  puStack_8 = &LAB_00b0c5c8;
  local_c = ExceptionList;
  local_10 = DAT_00d66fa0 ^ (uint)&local_68;
  ExceptionList = &local_c;
  local_5c = param_1;
  local_68 = param_3;
  local_60 = param_4;
  if ((param_3 != (undefined4 *)0x0) &&
     (iVar1 = (**(code **)(**(int **)(param_1 + 8) + 0x10))(DAT_00d66fa0 ^ (uint)&stack0xffffff88),
     iVar1 == *(int *)(param_1 + 0xc))) {
    if (param_4 == (int *)0x0) {
      if (1 < param_2) goto LAB_00661baf;
    }
    else {
      *local_60 = 0;
    }
    iStack_64 = 0;
    for (; param_2 != 0; param_2 = param_2 - 1) {
      FUN_006645f0();
      iVar1 = *(int *)(param_1 + 4);
      *(int *)(param_1 + 4) = iVar1 + 1;
      uStack_4 = 0;
      iVar1 = (**(code **)(**(int **)(param_1 + 8) + 0x34))(iVar1,auStack_58);
      if (iVar1 != 0) {
LAB_00661b91:
        uStack_4 = 0xffffffff;
        FUN_006645b0();
        break;
      }
      puVar2 = CoTaskMemAlloc(0x48);
      *param_3 = puVar2;
      uStack_4 = 0xffffffff;
      if (puVar2 == (undefined4 *)0x0) goto LAB_00661b91;
      local_68 = local_68 + 1;
      iStack_64 = iStack_64 + 1;
      puVar3 = auStack_58;
      for (iVar1 = 0x12; iVar1 != 0; iVar1 = iVar1 + -1) {
        *puVar2 = *puVar3;
        puVar3 = puVar3 + 1;
        puVar2 = puVar2 + 1;
      }
      uStack_14 = 0;
      uStack_18 = 0;
      uStack_1c = 0;
      FUN_006645b0();
      param_3 = local_68;
      param_1 = local_5c;
    }
    if (local_60 != (int *)0x0) {
      *local_60 = iStack_64;
    }
  }
LAB_00661baf:
  ExceptionList = local_c;
  __security_check_cookie(local_10 ^ (uint)&local_68);
  return;
}



============================================================
DISASSEMBLY
============================================================
00661a60 : PUSH -0x1
00661a62 : PUSH 0xb0c5c8
00661a67 : MOV EAX,FS:[0x0]
00661a6d : PUSH EAX
00661a6e : SUB ESP,0x5c
00661a71 : MOV EAX,[0x00d66fa0]
00661a76 : XOR EAX,ESP
00661a78 : MOV dword ptr [ESP + 0x58],EAX
00661a7c : PUSH EBX
00661a7d : PUSH EBP
00661a7e : PUSH ESI
00661a7f : PUSH EDI
00661a80 : MOV EAX,[0x00d66fa0]
00661a85 : XOR EAX,ESP
00661a87 : PUSH EAX
00661a88 : LEA EAX,[ESP + 0x70]
00661a8c : MOV FS:[0x0],EAX
00661a92 : MOV EDI,dword ptr [ESP + 0x88]
00661a99 : MOV ESI,dword ptr [ESP + 0x80]
00661aa0 : MOV EBX,dword ptr [ESP + 0x8c]
00661aa7 : XOR EBP,EBP
00661aa9 : MOV dword ptr [ESP + 0x20],ESI
00661aad : MOV dword ptr [ESP + 0x14],EDI
00661ab1 : MOV dword ptr [ESP + 0x1c],EBX
00661ab5 : CMP EDI,EBP
00661ab7 : JNZ 0x00661ac3
00661ab9 : MOV EAX,0x80004003
00661abe : JMP 0x00661baf
00661ac3 : MOV ECX,dword ptr [ESI + 0x8]
00661ac6 : MOV EAX,dword ptr [ECX]
00661ac8 : MOV EDX,dword ptr [EAX + 0x10]
00661acb : CALL EDX
00661acd : CMP EAX,dword ptr [ESI + 0xc]
00661ad0 : JZ 0x00661adc
00661ad2 : MOV EAX,0x80040203
00661ad7 : JMP 0x00661baf
00661adc : CMP EBX,EBP
00661ade : MOV EBX,dword ptr [ESP + 0x84]
00661ae5 : JZ 0x00661afb
00661ae7 : MOV EAX,dword ptr [ESP + 0x1c]
00661aeb : MOV dword ptr [EAX],EBP
00661aed : MOV dword ptr [ESP + 0x18],EBP
00661af1 : CMP EBX,EBP
00661af3 : JZ 0x00661b9a
00661af9 : JMP 0x00661b18
00661afb : CMP EBX,0x1
00661afe : JBE 0x00661aed
00661b00 : MOV EAX,0x80070057
00661b05 : JMP 0x00661baf
00661b10 : MOV EDI,dword ptr [ESP + 0x14]
00661b14 : MOV ESI,dword ptr [ESP + 0x20]
00661b18 : LEA ECX,[ESP + 0x24]
00661b1c : CALL 0x006645f0
00661b21 : MOV EAX,dword ptr [ESI + 0x4]
00661b24 : LEA ECX,[EAX + 0x1]
00661b27 : MOV dword ptr [ESI + 0x4],ECX
00661b2a : MOV ECX,dword ptr [ESI + 0x8]
00661b2d : MOV EDX,dword ptr [ECX]
00661b2f : LEA ESI,[ESP + 0x24]
00661b33 : PUSH ESI
00661b34 : PUSH EAX
00661b35 : MOV EAX,dword ptr [EDX + 0x34]
00661b38 : MOV dword ptr [ESP + 0x80],EBP
00661b3f : CALL EAX
00661b41 : CMP EAX,EBP
00661b43 : JNZ 0x00661b89
00661b45 : PUSH 0x48
00661b47 : CALL dword ptr [0x00b85764]
00661b4d : MOV dword ptr [EDI],EAX
00661b4f : MOV dword ptr [ESP + 0x78],0xffffffff
00661b57 : CMP EAX,EBP
00661b59 : JZ 0x00661b91
00661b5b : ADD dword ptr [ESP + 0x14],0x4
00661b60 : INC dword ptr [ESP + 0x18]
00661b64 : MOV EDI,EAX
00661b66 : MOV ECX,0x12
00661b6b : MOVSD.REP ES:EDI,ESI
00661b6d : LEA ECX,[ESP + 0x24]
00661b71 : MOV dword ptr [ESP + 0x68],EBP
00661b75 : MOV dword ptr [ESP + 0x64],EBP
00661b79 : MOV dword ptr [ESP + 0x60],EBP
00661b7d : DEC EBX
00661b7e : CALL 0x006645b0
00661b83 : CMP EBX,EBP
00661b85 : JNZ 0x00661b10
00661b87 : JMP 0x00661b9a
00661b89 : MOV dword ptr [ESP + 0x78],0xffffffff
00661b91 : LEA ECX,[ESP + 0x24]
00661b95 : CALL 0x006645b0
00661b9a : MOV EAX,dword ptr [ESP + 0x1c]
00661b9e : CMP EAX,EBP
00661ba0 : JZ 0x00661ba8
00661ba2 : MOV ECX,dword ptr [ESP + 0x18]
00661ba6 : MOV dword ptr [EAX],ECX
00661ba8 : XOR EAX,EAX
00661baa : CMP EBX,EBP
00661bac : SETNZ AL
00661baf : MOV ECX,dword ptr [ESP + 0x70]
00661bb3 : MOV dword ptr FS:[0x0],ECX
00661bba : POP ECX
00661bbb : POP EDI
00661bbc : POP ESI
00661bbd : POP EBP
00661bbe : POP EBX
00661bbf : MOV ECX,dword ptr [ESP + 0x58]
00661bc3 : XOR ECX,ESP
00661bc5 : CALL 0x00633e6b
00661bca : ADD ESP,0x68
00661bcd : RET 0x10
