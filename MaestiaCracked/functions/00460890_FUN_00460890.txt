PROGRAM  : Maestia.exe
FUNCTION : FUN_00460890
ENTRY    : 00460890
BODY     : [[00460890, 004608fc] [00460900, 00460a2d]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Removing unreachable block (ram,0x004609aa) */

void FUN_00460890(void)

{
  ushort *puVar1;
  int iVar2;
  undefined4 *puVar3;
  undefined4 uVar4;
  uint uVar5;
  uint uVar6;
  ushort *puVar7;
  int unaff_ESI;
  undefined4 *puVar8;
  undefined4 *puVar9;
  undefined8 uVar10;
  
  if (*(uint *)(unaff_ESI + 0x24) <
      (*(int *)(unaff_ESI + 0x18) - *(int *)(unaff_ESI + 0x14) >> 2) - 1U) {
    if (*(uint *)(unaff_ESI + 0x20) < *(uint *)(unaff_ESI + 0x24)) {
      *(uint *)(unaff_ESI + 0x20) = *(uint *)(unaff_ESI + 0x20) * 2 + 1;
    }
  }
  else {
    *(int *)(unaff_ESI + 0x20) =
         (*(int *)(unaff_ESI + 0x18) - *(int *)(unaff_ESI + 0x14) >> 2) * 2 + -3;
    FUN_0044f4a0(*(undefined4 *)(unaff_ESI + 8));
  }
  uVar5 = (*(int *)(unaff_ESI + 0x24) - (*(uint *)(unaff_ESI + 0x20) >> 1)) - 1;
  puVar8 = *(undefined4 **)(uVar5 * 4 + *(int *)(unaff_ESI + 0x14));
  if (puVar8 != *(undefined4 **)(uVar5 * 4 + *(int *)(unaff_ESI + 0x14) + 4)) {
    do {
      if ((uint)puVar8[8] < 8) {
        puVar7 = (ushort *)(puVar8 + 3);
      }
      else {
        puVar7 = (ushort *)puVar8[3];
      }
      puVar1 = puVar7 + puVar8[7];
      uVar6 = 0x811c9dc5;
      for (; puVar7 != puVar1; puVar7 = puVar7 + 1) {
        uVar6 = uVar6 * 0x1000193 ^ (uint)*puVar7;
      }
      uVar10 = FUN_0063871f(uVar6 & 0x7fffffff,0x1f31d);
      uVar6 = (int)((ulonglong)uVar10 >> 0x20) * 0x41a7 + (int)uVar10 * -0xb14;
      if ((int)uVar6 < 0) {
        uVar6 = uVar6 + 0x7fffffff;
      }
      if ((*(uint *)(unaff_ESI + 0x20) & uVar6) == uVar5) {
        puVar9 = (undefined4 *)*puVar8;
      }
      else {
        puVar9 = (undefined4 *)*puVar8;
        if (puVar9 != *(undefined4 **)(unaff_ESI + 8)) {
          iVar2 = uVar5 * 4;
          puVar3 = *(undefined4 **)(iVar2 + *(int *)(unaff_ESI + 0x14));
          uVar6 = uVar5;
          while ((puVar8 == puVar3 &&
                 (*(undefined4 **)(iVar2 + *(int *)(unaff_ESI + 0x14)) = puVar9, uVar6 != 0))) {
            uVar6 = uVar6 - 1;
            iVar2 = uVar6 * 4;
            puVar3 = *(undefined4 **)(iVar2 + *(int *)(unaff_ESI + 0x14));
          }
          iVar2 = *(int *)(unaff_ESI + 8);
          *(undefined4 **)puVar8[1] = puVar9;
          *(int *)puVar9[1] = iVar2;
          **(undefined4 **)(iVar2 + 4) = puVar8;
          uVar4 = *(undefined4 *)(iVar2 + 4);
          *(undefined4 *)(iVar2 + 4) = puVar9[1];
          puVar9[1] = puVar8[1];
          puVar8[1] = uVar4;
          puVar8 = *(undefined4 **)(*(int *)(unaff_ESI + 8) + 4);
          *(int *)(*(int *)(unaff_ESI + 0x14) + 4 + *(int *)(unaff_ESI + 0x24) * 4) =
               *(int *)(unaff_ESI + 8);
        }
        for (uVar6 = *(uint *)(unaff_ESI + 0x24);
            (uVar5 < uVar6 &&
            (*(int *)(*(int *)(unaff_ESI + 0x14) + uVar6 * 4) == *(int *)(unaff_ESI + 8)));
            uVar6 = uVar6 - 1) {
          *(undefined4 **)(*(int *)(unaff_ESI + 0x14) + uVar6 * 4) = puVar8;
        }
        if (puVar9 == *(undefined4 **)(unaff_ESI + 8)) break;
      }
      puVar8 = puVar9;
    } while (puVar9 != *(undefined4 **)(uVar5 * 4 + 4 + *(int *)(unaff_ESI + 0x14)));
  }
  *(int *)(unaff_ESI + 0x24) = *(int *)(unaff_ESI + 0x24) + 1;
  return;
}



============================================================
DISASSEMBLY
============================================================
00460890 : PUSH EBP
00460891 : MOV EBP,ESP
00460893 : MOV EDX,dword ptr [ESI + 0x18]
00460896 : SUB EDX,dword ptr [ESI + 0x14]
00460899 : MOV ECX,dword ptr [ESI + 0x24]
0046089c : LEA EAX,[ESI + 0x10]
0046089f : SUB ESP,0x8
004608a2 : SAR EDX,0x2
004608a5 : DEC EDX
004608a6 : PUSH EBX
004608a7 : PUSH EDI
004608a8 : CMP EDX,ECX
004608aa : JA 0x004608ca
004608ac : MOV ECX,dword ptr [EAX + 0x8]
004608af : SUB ECX,dword ptr [EAX + 0x4]
004608b2 : MOV EDX,dword ptr [ESI + 0x8]
004608b5 : SAR ECX,0x2
004608b8 : LEA ECX,[ECX + ECX*0x1 + -0x3]
004608bc : MOV dword ptr [ESI + 0x20],ECX
004608bf : PUSH EDX
004608c0 : ADD ECX,0x2
004608c3 : CALL 0x0044f4a0
004608c8 : JMP 0x004608d8
004608ca : MOV EAX,dword ptr [ESI + 0x20]
004608cd : CMP EAX,ECX
004608cf : JNC 0x004608d8
004608d1 : LEA EAX,[EAX + EAX*0x1 + 0x1]
004608d5 : MOV dword ptr [ESI + 0x20],EAX
004608d8 : MOV ECX,dword ptr [ESI + 0x20]
004608db : MOV EAX,dword ptr [ESI + 0x24]
004608de : MOV EDX,dword ptr [ESI + 0x14]
004608e1 : SHR ECX,0x1
004608e3 : SUB EAX,ECX
004608e5 : DEC EAX
004608e6 : MOV dword ptr [EBP + -0x4],EAX
004608e9 : ADD EAX,EAX
004608eb : ADD EAX,EAX
004608ed : MOV EDI,dword ptr [EAX + EDX*0x1]
004608f0 : ADD EAX,EDX
004608f2 : CMP EDI,dword ptr [EAX + 0x4]
004608f5 : JZ 0x00460a25
004608fb : JMP 0x00460900
00460900 : CMP dword ptr [EDI + 0x20],0x8
00460904 : JC 0x0046090b
00460906 : MOV ECX,dword ptr [EDI + 0xc]
00460909 : JMP 0x0046090e
0046090b : LEA ECX,[EDI + 0xc]
0046090e : MOV EDX,dword ptr [EDI + 0x1c]
00460911 : LEA EDX,[ECX + EDX*0x2]
00460914 : MOV EAX,0x811c9dc5
00460919 : CMP ECX,EDX
0046091b : JZ 0x00460932
0046091d : LEA ECX,[ECX]
00460920 : MOVZX EBX,word ptr [ECX]
00460923 : IMUL EAX,EAX,0x1000193
00460929 : ADD ECX,0x2
0046092c : XOR EAX,EBX
0046092e : CMP ECX,EDX
00460930 : JNZ 0x00460920
00460932 : AND EAX,0x7fffffff
00460937 : PUSH 0x1f31d
0046093c : PUSH EAX
0046093d : CALL 0x0063871f
00460942 : IMUL EDX,EDX,0x41a7
00460948 : IMUL EAX,EAX,0xb14
0046094e : ADD ESP,0x8
00460951 : SUB EDX,EAX
00460953 : JNS 0x0046095b
00460955 : ADD EDX,0x7fffffff
0046095b : MOV EAX,dword ptr [ESI + 0x20]
0046095e : MOV ECX,dword ptr [EBP + -0x4]
00460961 : AND EAX,EDX
00460963 : CMP EAX,ECX
00460965 : JNZ 0x0046096e
00460967 : MOV EDI,dword ptr [EDI]
00460969 : JMP 0x00460a11
0046096e : MOV EDX,dword ptr [EDI]
00460970 : MOV dword ptr [EBP + -0x8],EDX
00460973 : CMP EDX,dword ptr [ESI + 0x8]
00460976 : JZ 0x004609ea
00460978 : MOV EBX,dword ptr [ESI + 0x14]
0046097b : MOV EAX,ECX
0046097d : ADD ECX,ECX
0046097f : ADD ECX,ECX
00460981 : CMP EDI,dword ptr [ECX + EBX*0x1]
00460984 : JNZ 0x004609a0
00460986 : MOV EBX,dword ptr [ESI + 0x14]
00460989 : MOV dword ptr [ECX + EBX*0x1],EDX
0046098c : TEST EAX,EAX
0046098e : JZ 0x004609a0
00460990 : MOV EBX,dword ptr [ESI + 0x14]
00460993 : DEC EAX
00460994 : LEA ECX,[EAX*0x4 + 0x0]
0046099b : CMP EDI,dword ptr [ECX + EBX*0x1]
0046099e : JZ 0x00460986
004609a0 : MOV EBX,dword ptr [ESI + 0x8]
004609a3 : LEA EAX,[ESI + 0x4]
004609a6 : CMP EAX,EAX
004609a8 : JZ 0x004609b6
004609aa : XOR ECX,ECX
004609ac : MOV EDX,EAX
004609ae : CALL 0x00460fe0
004609b3 : MOV EDX,dword ptr [EBP + -0x8]
004609b6 : MOV ECX,dword ptr [EDI + 0x4]
004609b9 : MOV dword ptr [ECX],EDX
004609bb : MOV EAX,dword ptr [EDX + 0x4]
004609be : MOV dword ptr [EAX],EBX
004609c0 : MOV ECX,dword ptr [EBX + 0x4]
004609c3 : MOV dword ptr [ECX],EDI
004609c5 : MOV EAX,dword ptr [EBX + 0x4]
004609c8 : MOV ECX,dword ptr [EDX + 0x4]
004609cb : MOV dword ptr [EBX + 0x4],ECX
004609ce : MOV ECX,dword ptr [EDI + 0x4]
004609d1 : MOV dword ptr [EDX + 0x4],ECX
004609d4 : MOV dword ptr [EDI + 0x4],EAX
004609d7 : MOV EAX,dword ptr [ESI + 0x8]
004609da : MOV ECX,dword ptr [ESI + 0x24]
004609dd : MOV EBX,dword ptr [ESI + 0x14]
004609e0 : MOV EDI,dword ptr [EAX + 0x4]
004609e3 : MOV dword ptr [EBX + ECX*0x4 + 0x4],EAX
004609e7 : MOV ECX,dword ptr [EBP + -0x4]
004609ea : MOV EAX,dword ptr [ESI + 0x24]
004609ed : CMP ECX,EAX
004609ef : JNC 0x00460a0a
004609f1 : MOV ECX,dword ptr [ESI + 0x14]
004609f4 : MOV EBX,dword ptr [ECX + EAX*0x4]
004609f7 : LEA ECX,[ECX + EAX*0x4]
004609fa : CMP EBX,dword ptr [ESI + 0x8]
004609fd : JNZ 0x00460a07
004609ff : DEC EAX
00460a00 : MOV dword ptr [ECX],EDI
00460a02 : CMP dword ptr [EBP + -0x4],EAX
00460a05 : JC 0x004609f1
00460a07 : MOV ECX,dword ptr [EBP + -0x4]
00460a0a : CMP EDX,dword ptr [ESI + 0x8]
00460a0d : JZ 0x00460a25
00460a0f : MOV EDI,EDX
00460a11 : MOV EDX,dword ptr [ESI + 0x14]
00460a14 : LEA EAX,[ECX*0x4 + 0x0]
00460a1b : CMP EDI,dword ptr [EAX + EDX*0x1 + 0x4]
00460a1f : JNZ 0x00460900
00460a25 : INC dword ptr [ESI + 0x24]
00460a28 : POP EDI
00460a29 : POP EBX
00460a2a : MOV ESP,EBP
00460a2c : POP EBP
00460a2d : RET
