PROGRAM  : Maestia.exe
FUNCTION : FUN_009634e0
ENTRY    : 009634e0
BODY     : [[009634e0, 009636ac]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_009634e0(undefined4 param_1)

{
  short sVar1;
  int iVar2;
  int iVar3;
  ulonglong uVar4;
  uint uVar5;
  uint8_t *packet;
  undefined1 local_2c [4];
  undefined2 local_28;
  undefined4 local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b405c3;
  local_10 = ExceptionList;
  uVar5 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if (DAT_017247f0 == 0) {
    FUN_00406460(L"g_pItemMgr NULL");
    local_8 = 0;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaGuiNpcShop::Open",0x3ac,local_2c);
    }
    local_8 = 0xffffffff;
    if (7 < local_14) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_14 = 7;
    local_18 = 0;
    local_28 = 0;
    if (DAT_017247f0 == 0) goto LAB_00963587;
  }
  local_8 = 0xffffffff;
  *(undefined4 *)(DAT_017247f0 + 0x10) = 1;
  FUN_009f2920(uVar5);
LAB_00963587:
  FUN_008f7770(param_1,300);
  if ((((DAT_0172491c != 0) && (iVar2 = *(int *)(DAT_0172491c + 0x17c), iVar2 != 0)) &&
      (iVar3 = *DAT_00da9894, iVar3 != 0)) && (*(int *)(iVar3 + 0x114) != 0)) {
    sVar1 = *(short *)(iVar2 + 0x80);
    if (sVar1 == 0) {
      sVar1 = *(short *)(iVar2 + 0x7c);
    }
    (**(code **)(**(int **)(iVar3 + 0x114) + 4))
              (*(int **)(iVar3 + 0x114),"SetMyAlliance",&DAT_00c7a2cc,sVar1);
  }
  iVar2 = *DAT_00da9894;
  if ((iVar2 != 0) && (*(int *)(iVar2 + 0x114) != 0)) {
    (**(code **)**(undefined4 **)(iVar2 + 0x114))("ShopOpen");
  }
  if ((*(int *)(*DAT_00da9894 + 0x184) != 0) &&
     (*(char *)(*(int *)(*DAT_00da9894 + 0x184) + 0x32) != '\0')) {
    iVar2 = *(int *)ThreadLocalStoragePointer;
    uVar4 = (ulonglong)(*(byte *)(iVar2 + 0x18) + 1) % 3;
    packet = (uint8_t *)((int)uVar4 * 0x2000 + 0x122cb8 + iVar2);
    *(char *)(iVar2 + 0x18) = (char)uVar4;
    if (packet == (uint8_t *)0x0) {
      packet = (uint8_t *)0x0;
    }
    else {
      packet[0] = '\0';
      packet[1] = '\0';
      packet[2] = '6';
      packet[3] = 0xa3;
    }
    local_8 = 0xffffffff;
    if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
      FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),4,packet);
    }
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
009634e0 : PUSH EBP
009634e1 : MOV EBP,ESP
009634e3 : PUSH -0x1
009634e5 : PUSH 0xb405c3
009634ea : MOV EAX,FS:[0x0]
009634f0 : PUSH EAX
009634f1 : SUB ESP,0x1c
009634f4 : PUSH ESI
009634f5 : PUSH EDI
009634f6 : MOV EAX,[0x00d66fa0]
009634fb : XOR EAX,EBP
009634fd : PUSH EAX
009634fe : LEA EAX,[EBP + -0xc]
00963501 : MOV FS:[0x0],EAX
00963507 : MOV ESI,ECX
00963509 : MOV ECX,dword ptr [0x017247f0]
0096350f : MOV EDI,0x1
00963514 : TEST ECX,ECX
00963516 : JNZ 0x0096357f
00963518 : PUSH 0xc7a350
0096351d : LEA ECX,[EBP + -0x28]
00963520 : CALL 0x00406460
00963525 : MOV dword ptr [EBP + -0x4],0x0
0096352c : MOV EAX,[0x00da98e8]
00963531 : MOV ECX,dword ptr [EAX]
00963533 : TEST ECX,ECX
00963535 : JZ 0x0096354c
00963537 : MOV EDX,dword ptr [ECX]
00963539 : MOV EDX,dword ptr [EDX + 0x14]
0096353c : LEA EAX,[EBP + -0x28]
0096353f : PUSH EAX
00963540 : PUSH 0x3ac
00963545 : PUSH 0xc7a370
0096354a : CALL EDX
0096354c : MOV dword ptr [EBP + -0x4],0xffffffff
00963553 : CMP dword ptr [EBP + -0x10],0x8
00963557 : JC 0x00963561
00963559 : MOV ECX,dword ptr [EBP + -0x24]
0096355c : CALL 0x006f04e0
00963561 : MOV ECX,dword ptr [0x017247f0]
00963567 : XOR EAX,EAX
00963569 : MOV dword ptr [EBP + -0x10],0x7
00963570 : MOV dword ptr [EBP + -0x14],0x0
00963577 : MOV word ptr [EBP + -0x24],AX
0096357b : TEST ECX,ECX
0096357d : JZ 0x00963587
0096357f : MOV dword ptr [ECX + 0x10],EDI
00963582 : CALL 0x009f2920
00963587 : MOV ECX,dword ptr [EBP + 0x8]
0096358a : PUSH 0x12c
0096358f : PUSH ECX
00963590 : MOV ECX,ESI
00963592 : CALL 0x008f7770
00963597 : MOV EAX,[0x0172491c]
0096359c : TEST EAX,EAX
0096359e : JZ 0x009635f0
009635a0 : MOV EDX,dword ptr [EAX + 0x17c]
009635a6 : TEST EDX,EDX
009635a8 : JZ 0x009635f0
009635aa : MOV EAX,[0x00da9894]
009635af : MOV EAX,dword ptr [EAX]
009635b1 : TEST EAX,EAX
009635b3 : JZ 0x009635f0
009635b5 : CMP dword ptr [EAX + 0x114],0x0
009635bc : JZ 0x009635f0
009635be : MOVZX ECX,word ptr [EDX + 0x80]
009635c5 : MOV EAX,dword ptr [EAX + 0x114]
009635cb : TEST CX,CX
009635ce : MOVZX ECX,CX
009635d1 : JNZ 0x009635d7
009635d3 : MOVZX ECX,word ptr [EDX + 0x7c]
009635d7 : MOV EDX,dword ptr [EAX]
009635d9 : MOV EDX,dword ptr [EDX + 0x4]
009635dc : MOVZX ECX,CX
009635df : PUSH ECX
009635e0 : PUSH 0xc7a2cc
009635e5 : PUSH 0xc7a398
009635ea : PUSH EAX
009635eb : CALL EDX
009635ed : ADD ESP,0x10
009635f0 : MOV EAX,[0x00da9894]
009635f5 : MOV EAX,dword ptr [EAX]
009635f7 : TEST EAX,EAX
009635f9 : JZ 0x00963617
009635fb : CMP dword ptr [EAX + 0x114],0x0
00963602 : JZ 0x00963617
00963604 : MOV EAX,dword ptr [EAX + 0x114]
0096360a : MOV EDX,dword ptr [EAX]
0096360c : MOV ECX,EAX
0096360e : MOV EAX,dword ptr [EDX]
00963610 : PUSH 0xc7a3a8
00963615 : CALL EAX
00963617 : MOV ECX,dword ptr [0x00da9894]
0096361d : MOV EAX,dword ptr [ECX]
0096361f : CMP dword ptr [EAX + 0x184],0x0
00963626 : JZ 0x0096369a
00963628 : MOV EAX,dword ptr [EAX + 0x184]
0096362e : CMP byte ptr [EAX + 0x32],0x0
00963632 : JZ 0x0096369a
00963634 : MOV EDX,dword ptr FS:[0x2c]
0096363b : MOV ECX,dword ptr [EDX]
0096363d : MOVZX EAX,byte ptr [ECX + 0x18]
00963641 : ADD EAX,EDI
00963643 : CDQ
00963644 : MOV ESI,0x3
00963649 : IDIV ESI
0096364b : MOVZX EAX,DL
0096364e : SHL EAX,0xd
00963651 : LEA EAX,[EAX + ECX*0x1 + 0x122cb8]
00963658 : MOV byte ptr [ECX + 0x18],DL
0096365b : MOV dword ptr [EBP + 0x8],EAX
0096365e : MOV dword ptr [EBP + -0x4],EDI
00963661 : TEST EAX,EAX
00963663 : JZ 0x00963674
00963665 : XOR ECX,ECX
00963667 : MOV word ptr [EAX],CX
0096366a : MOV byte ptr [EAX + 0x2],0x36
0096366e : MOV byte ptr [EAX + 0x3],0xa3
00963672 : JMP 0x00963676
00963674 : XOR EAX,EAX
00963676 : MOV dword ptr [EBP + -0x4],0xffffffff
0096367d : MOV EDX,dword ptr [0x017247d4]
00963683 : MOV ECX,dword ptr [EDX + 0x4]
00963686 : TEST ECX,ECX
00963688 : JZ 0x0096369a
0096368a : CMP byte ptr [EDX + 0x8],0x0
0096368e : JZ 0x0096369a
00963690 : PUSH 0x4
00963692 : PUSH ECX
00963693 : MOV EDI,EAX
00963695 : CALL 0x00a0dd40
0096369a : MOV ECX,dword ptr [EBP + -0xc]
0096369d : MOV dword ptr FS:[0x0],ECX
009636a4 : POP ECX
009636a5 : POP EDI
009636a6 : POP ESI
009636a7 : MOV ESP,EBP
009636a9 : POP EBP
009636aa : RET 0x8
