PROGRAM  : Maestia.exe
FUNCTION : FUN_00783950
ENTRY    : 00783950
BODY     : [[00783950, 00783d76] [00783d80, 00783ddc]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00783950(int param_1,undefined4 param_2,int *param_3,int param_4)

{
  uint *puVar1;
  float fVar2;
  float fVar3;
  char cVar4;
  code *pcVar5;
  float *pfVar6;
  undefined4 *puVar7;
  undefined4 uVar8;
  int iVar9;
  int iVar10;
  int *piVar11;
  uint uVar12;
  int *piVar13;
  uint uVar14;
  undefined1 local_dc [64];
  int local_9c [16];
  int local_5c [16];
  undefined1 local_1c [12];
  float local_10;
  uint uStack_c;
  float local_8;
  
  if (DAT_017251c4 == -4) {
    return 0x80004005;
  }
  local_10 = -*(float *)(DAT_017251c4 + 0x30);
  uStack_c = *(uint *)(DAT_017251c4 + 0x34) ^ 0x80000000;
  local_8 = -*(float *)(DAT_017251c4 + 0x38);
  *(ulonglong *)(param_1 + 0x170) = *(ulonglong *)(DAT_017251c4 + 0x30) ^ 0x8000000080000000;
  *(float *)(param_1 + 0x178) = local_8;
  if (*(float *)(param_1 + 0x174) <= 0.33 && *(float *)(param_1 + 0x174) != 0.33) {
    *(undefined4 *)(param_1 + 0x174) = 0x3ea8f5c3;
  }
  (**(code **)(*param_3 + 0x24))();
  (**(code **)(*param_3 + 0x1c))();
  piVar11 = param_3 + 0x2d;
  piVar13 = local_5c;
  for (iVar9 = 0x10; iVar9 != 0; iVar9 = iVar9 + -1) {
    *piVar13 = *piVar11;
    piVar11 = piVar11 + 1;
    piVar13 = piVar13 + 1;
  }
  if (*(char *)((int)param_3 + 0x157) == '\0') {
    pcVar5 = *(code **)(*param_3 + 0x30);
  }
  else {
    pcVar5 = *(code **)(*param_3 + 0x20);
  }
  (*pcVar5)();
  iVar9 = *(int *)(param_1 + 0x168);
  piVar11 = param_3 + 0x1d;
  piVar13 = local_9c;
  for (iVar10 = 0x10; iVar10 != 0; iVar10 = iVar10 + -1) {
    *piVar13 = *piVar11;
    piVar11 = piVar11 + 1;
    piVar13 = piVar13 + 1;
  }
  *(int *)(param_1 + 0x260) = param_3[0x14];
  if (iVar9 == 0) {
    *(undefined4 *)(param_1 + 0x144) = *(undefined4 *)(param_1 + 0x150);
    *(undefined4 *)(param_1 + 0x148) = *(undefined4 *)(param_1 + 0x154);
    uVar8 = *(undefined4 *)(param_1 + 0x158);
  }
  else {
    if (*(char *)(*(int *)(param_3[0x12] + 0xf0) + 0x2a95) != '\0') {
      pfVar6 = (float *)(**(code **)(*param_3 + 8))(&local_10);
      local_10 = *pfVar6 + 50.0;
      iVar9 = (**(code **)(*param_3 + 8))(local_1c);
      local_8 = *(float *)(iVar9 + 8) + 50.0;
      pfVar6 = (float *)(**(code **)(*param_3 + 0x14))();
      fVar2 = pfVar6[2];
      fVar3 = pfVar6[1];
      *(float *)(param_1 + 0x144) = *pfVar6 + local_10;
      *(float *)(param_1 + 0x148) = fVar3;
      *(float *)(param_1 + 0x14c) = fVar2 + local_8;
      goto LAB_00783afe;
    }
    puVar7 = (undefined4 *)(**(code **)(*param_3 + 0x18))();
    *(undefined4 *)(param_1 + 0x144) = *puVar7;
    *(undefined4 *)(param_1 + 0x148) = puVar7[1];
    uVar8 = puVar7[2];
  }
  *(undefined4 *)(param_1 + 0x14c) = uVar8;
LAB_00783afe:
  puVar1 = (uint *)(param_1 + 0x170);
  D3DXVec3Normalize(puVar1,puVar1);
  iVar9 = *(int *)(param_1 + 0x244) - *(int *)(param_1 + 0x240) >> 2;
  FUN_0042d2e0(param_1 + 0x23c);
  if (*(int *)(param_1 + 0x230) != *(int *)(param_1 + 0x234)) {
    uVar8 = FUN_00443090();
    *(undefined4 *)(param_1 + 0x234) = uVar8;
  }
  if (*(int *)(param_1 + 0x220) != *(int *)(param_1 + 0x224)) {
    uVar8 = FUN_00443090();
    *(undefined4 *)(param_1 + 0x224) = uVar8;
  }
  FUN_004644b0(0x400);
  FUN_004847b0();
  FUN_004847b0();
  *(uint *)(param_1 + 0xd8) = *puVar1 ^ 0x80000000;
  *(uint *)(param_1 + 0xdc) = *(uint *)(param_1 + 0x174) ^ 0x80000000;
  *(uint *)(param_1 + 0xe0) = *(uint *)(param_1 + 0x178) ^ 0x80000000;
  piVar11 = local_5c;
  piVar13 = (int *)(param_1 + 0xf0);
  for (iVar10 = 0x10; iVar10 != 0; iVar10 = iVar10 + -1) {
    *piVar13 = *piVar11;
    piVar11 = piVar11 + 1;
    piVar13 = piVar13 + 1;
  }
  D3DXMatrixMultiply(local_dc,local_5c,local_9c);
  FUN_007821f0();
  if ((param_4 != 0) && (*(int **)(param_4 + 0x24) != (int *)0x0)) {
    (**(code **)(**(int **)(param_4 + 0x24) + 0x8c))(param_1,2);
  }
  FUN_00782af0(param_1,local_5c,local_9c);
  (*(code *)PTR_FUN_00d6d240)
            (0x28,0xe,"PSM Cover  %4.0fm",
             (double)((*(float *)(param_1 + 0x250) - *(float *)(param_1 + 0x24c)) * 0.1));
  (*(code *)PTR_FUN_00d6d240)
            (0x28,0xf,"[S] Caster  %4d",
             (*(int *)(param_1 + 0x224) - *(int *)(param_1 + 0x220)) / 0x18);
  if ((((*(int *)(param_1 + 0x244) - *(int *)(param_1 + 0x240) & 0xfffffffcU) != 0) || (iVar9 != 0))
     && (iVar10 = FUN_00781e70(), -1 < iVar10)) {
    if (((*(int *)(param_1 + 0x244) - *(int *)(param_1 + 0x240) & 0xfffffffcU) != 0) || (iVar9 < 1))
    {
      if (*(int **)(param_1 + 0x130) != (int *)0x0) {
        (**(code **)(**(int **)(param_1 + 0x130) + 0xc))();
        (**(code **)(**(int **)(param_1 + 0x130) + 8))();
        uVar14 = *(int *)(param_1 + 0x244) - *(int *)(param_1 + 0x240) >> 2;
        (**(code **)(**(int **)(param_1 + 0x140) + 0x1c))();
        FUN_007fc490();
        FUN_007f1710();
        FUN_007fc460();
        uVar12 = 0;
        if (uVar14 != 0) {
          do {
            FUN_00748a20(*(undefined4 *)(param_1 + 0x130),
                         *(undefined4 *)(*(int *)(param_1 + 0x240) + uVar12 * 4),
                         *(undefined4 *)(param_1 + 0x140));
            uVar12 = uVar12 + 1;
          } while (uVar12 < uVar14);
        }
        cVar4 = FUN_008006b0();
        if (cVar4 == '\0') {
          return 0x80004005;
        }
        (**(code **)(**(int **)(param_1 + 0x130) + 0x2c))();
        FUN_007fc990();
      }
      return 0;
    }
    FUN_00781e70();
  }
  return 0x80004005;
}



============================================================
DISASSEMBLY
============================================================
00783950 : PUSH EBP
00783951 : MOV EBP,ESP
00783953 : MOV EAX,[0x017251c4]
00783958 : SUB ESP,0xdc
0078395e : ADD EAX,0x4
00783961 : PUSH EBX
00783962 : MOV EBX,dword ptr [EBP + 0x8]
00783965 : PUSH ESI
00783966 : PUSH EDI
00783967 : JZ 0x00783cf4
0078396d : MOVSS XMM0,dword ptr [EAX + 0x2c]
00783972 : MOVSS XMM3,dword ptr [0x00cdf0c0]
0078397a : MOVSS XMM1,dword ptr [EAX + 0x30]
0078397f : MOVSS XMM2,dword ptr [EAX + 0x34]
00783984 : XORPS XMM0,XMM3
00783987 : MOVSS dword ptr [EBP + -0xc],XMM0
0078398c : XORPS XMM1,XMM3
0078398f : XORPS XMM2,XMM3
00783992 : MOVSS dword ptr [EBP + -0x8],XMM1
00783997 : MOVQ XMM0,qword ptr [EBP + -0xc]
0078399c : MOVSS dword ptr [EBP + -0x4],XMM2
007839a1 : MOV EAX,dword ptr [EBP + -0x4]
007839a4 : MOVQ qword ptr [EBX + 0x170],XMM0
007839ac : MOVSS XMM0,dword ptr [0x00cdf6d0]
007839b4 : MOV dword ptr [EBX + 0x178],EAX
007839ba : COMISS XMM0,dword ptr [EBX + 0x174]
007839c1 : JBE 0x007839cb
007839c3 : MOVSS dword ptr [EBX + 0x174],XMM0
007839cb : MOV ESI,dword ptr [EBP + 0x10]
007839ce : MOV EDX,dword ptr [ESI]
007839d0 : MOV EAX,dword ptr [EDX + 0x24]
007839d3 : MOV ECX,ESI
007839d5 : CALL EAX
007839d7 : MOV EDX,dword ptr [ESI]
007839d9 : MOV EAX,dword ptr [EDX + 0x1c]
007839dc : MOV ECX,ESI
007839de : CALL EAX
007839e0 : ADD ESI,0xb4
007839e6 : MOV ECX,0x10
007839eb : LEA EDI,[EBP + -0x58]
007839ee : MOVSD.REP ES:EDI,ESI
007839f0 : MOV ESI,dword ptr [EBP + 0x10]
007839f3 : CMP byte ptr [ESI + 0x157],0x0
007839fa : MOV EDX,dword ptr [ESI]
007839fc : MOV ECX,ESI
007839fe : JZ 0x00783a05
00783a00 : MOV EAX,dword ptr [EDX + 0x20]
00783a03 : JMP 0x00783a08
00783a05 : MOV EAX,dword ptr [EDX + 0x30]
00783a08 : CALL EAX
00783a0a : ADD ESI,0x74
00783a0d : CMP dword ptr [EBX + 0x168],0x0
00783a14 : MOV ECX,0x10
00783a19 : LEA EDI,[EBP + 0xffffff68]
00783a1f : MOVSD.REP ES:EDI,ESI
00783a21 : MOV ESI,dword ptr [EBP + 0x10]
00783a24 : FLD float ptr [ESI + 0x50]
00783a27 : FSTP float ptr [EBX + 0x260]
00783a2d : JZ 0x00783ada
00783a33 : MOV ECX,dword ptr [ESI + 0x48]
00783a36 : MOV EDX,dword ptr [ECX + 0xf0]
00783a3c : CMP byte ptr [EDX + 0x2a95],0x0
00783a43 : MOV EAX,dword ptr [ESI]
00783a45 : JZ 0x00783abd
00783a47 : MOV EDX,dword ptr [EAX + 0x8]
00783a4a : LEA ECX,[EBP + -0xc]
00783a4d : PUSH ECX
00783a4e : MOV ECX,ESI
00783a50 : CALL EDX
00783a52 : MOVSS XMM0,dword ptr [EAX]
00783a56 : MOV EAX,dword ptr [ESI]
00783a58 : ADDSS XMM0,dword ptr [0x00cdf214]
00783a60 : MOV EDX,dword ptr [EAX + 0x8]
00783a63 : LEA ECX,[EBP + -0x18]
00783a66 : PUSH ECX
00783a67 : MOV ECX,ESI
00783a69 : MOVSS dword ptr [EBP + -0xc],XMM0
00783a6e : CALL EDX
00783a70 : MOVSS XMM0,dword ptr [EAX + 0x8]
00783a75 : MOV EAX,dword ptr [ESI]
00783a77 : ADDSS XMM0,dword ptr [0x00cdf214]
00783a7f : MOV EDX,dword ptr [EAX + 0x14]
00783a82 : MOV ECX,ESI
00783a84 : MOVSS dword ptr [EBP + -0x4],XMM0
00783a89 : CALL EDX
00783a8b : MOVSS XMM0,dword ptr [EAX]
00783a8f : MOVSS XMM1,dword ptr [EAX + 0x8]
00783a94 : MOVSS XMM2,dword ptr [EAX + 0x4]
00783a99 : ADDSS XMM0,dword ptr [EBP + -0xc]
00783a9e : ADDSS XMM1,dword ptr [EBP + -0x4]
00783aa3 : MOVSS dword ptr [EBX + 0x144],XMM0
00783aab : MOVSS dword ptr [EBX + 0x148],XMM2
00783ab3 : MOVSS dword ptr [EBX + 0x14c],XMM1
00783abb : JMP 0x00783afe
00783abd : MOV EDX,dword ptr [EAX + 0x18]
00783ac0 : MOV ECX,ESI
00783ac2 : CALL EDX
00783ac4 : FLD float ptr [EAX]
00783ac6 : FSTP float ptr [EBX + 0x144]
00783acc : FLD float ptr [EAX + 0x4]
00783acf : FSTP float ptr [EBX + 0x148]
00783ad5 : FLD float ptr [EAX + 0x8]
00783ad8 : JMP 0x00783af8
00783ada : FLD float ptr [EBX + 0x150]
00783ae0 : FSTP float ptr [EBX + 0x144]
00783ae6 : FLD float ptr [EBX + 0x154]
00783aec : FSTP float ptr [EBX + 0x148]
00783af2 : FLD float ptr [EBX + 0x158]
00783af8 : FSTP float ptr [EBX + 0x14c]
00783afe : LEA ESI,[EBX + 0x170]
00783b04 : PUSH ESI
00783b05 : PUSH ESI
00783b06 : CALL 0x004ff722
00783b0b : MOV EAX,dword ptr [EBX + 0x244]
00783b11 : SUB EAX,dword ptr [EBX + 0x240]
00783b17 : LEA EDI,[EBX + 0x23c]
00783b1d : SAR EAX,0x2
00783b20 : PUSH EDI
00783b21 : MOV dword ptr [EBP + 0x10],EAX
00783b24 : CALL 0x0042d2e0
00783b29 : MOV EDX,dword ptr [EBX + 0x234]
00783b2f : MOV EAX,dword ptr [EBX + 0x230]
00783b35 : CMP EAX,EDX
00783b37 : JZ 0x00783b58
00783b39 : MOV byte ptr [EBP + 0x8],0x0
00783b3d : MOV ECX,dword ptr [EBP + 0x8]
00783b40 : PUSH ECX
00783b41 : MOV ECX,dword ptr [EBP + 0x10]
00783b44 : PUSH ECX
00783b45 : MOV ECX,dword ptr [EBP + 0x10]
00783b48 : PUSH ECX
00783b49 : PUSH EDX
00783b4a : CALL 0x00443090
00783b4f : ADD ESP,0x10
00783b52 : MOV dword ptr [EBX + 0x234],EAX
00783b58 : MOV EDX,dword ptr [EBX + 0x224]
00783b5e : MOV EAX,dword ptr [EBX + 0x220]
00783b64 : CMP EAX,EDX
00783b66 : JZ 0x00783b87
00783b68 : MOV byte ptr [EBP + 0x8],0x0
00783b6c : MOV ECX,dword ptr [EBP + 0x8]
00783b6f : PUSH ECX
00783b70 : MOV ECX,dword ptr [EBP + 0x10]
00783b73 : PUSH ECX
00783b74 : MOV ECX,dword ptr [EBP + 0x10]
00783b77 : PUSH ECX
00783b78 : PUSH EDX
00783b79 : CALL 0x00443090
00783b7e : ADD ESP,0x10
00783b81 : MOV dword ptr [EBX + 0x224],EAX
00783b87 : PUSH 0x400
00783b8c : MOV ECX,EDI
00783b8e : CALL 0x004644b0
00783b93 : LEA ECX,[EBX + 0x22c]
00783b99 : CALL 0x004847b0
00783b9e : LEA ECX,[EBX + 0x21c]
00783ba4 : CALL 0x004847b0
00783ba9 : MOVSS XMM3,dword ptr [0x00cdf0c0]
00783bb1 : MOVSS XMM0,dword ptr [ESI]
00783bb5 : MOVSS XMM1,dword ptr [ESI + 0x4]
00783bba : MOVSS XMM2,dword ptr [ESI + 0x8]
00783bbf : LEA EDX,[EBP + 0xffffff68]
00783bc5 : XORPS XMM0,XMM3
00783bc8 : XORPS XMM1,XMM3
00783bcb : XORPS XMM2,XMM3
00783bce : PUSH EDX
00783bcf : MOVSS dword ptr [EBX + 0xd8],XMM0
00783bd7 : MOVSS dword ptr [EBX + 0xdc],XMM1
00783bdf : MOVSS dword ptr [EBX + 0xe0],XMM2
00783be7 : LEA EDI,[EBX + 0xf0]
00783bed : MOV ECX,0x10
00783bf2 : LEA ESI,[EBP + -0x58]
00783bf5 : LEA EAX,[EBP + -0x58]
00783bf8 : MOVSD.REP ES:EDI,ESI
00783bfa : PUSH EAX
00783bfb : LEA ECX,[EBP + 0xffffff28]
00783c01 : PUSH ECX
00783c02 : CALL 0x004ff752
00783c07 : LEA EAX,[EBP + 0xffffff28]
00783c0d : MOV ESI,EBX
00783c0f : CALL 0x007821f0
00783c14 : MOV EAX,dword ptr [EBP + 0x14]
00783c17 : TEST EAX,EAX
00783c19 : JZ 0x00783c2f
00783c1b : MOV ECX,dword ptr [EAX + 0x24]
00783c1e : TEST ECX,ECX
00783c20 : JZ 0x00783c2f
00783c22 : MOV EDX,dword ptr [ECX]
00783c24 : MOV EAX,dword ptr [EDX + 0x8c]
00783c2a : PUSH 0x2
00783c2c : PUSH EBX
00783c2d : CALL EAX
00783c2f : LEA ECX,[EBP + 0xffffff68]
00783c35 : PUSH ECX
00783c36 : LEA EDX,[EBP + -0x58]
00783c39 : PUSH EDX
00783c3a : PUSH EBX
00783c3b : CALL 0x00782af0
00783c40 : MOVSS XMM0,dword ptr [EBX + 0x250]
00783c48 : SUBSS XMM0,dword ptr [EBX + 0x24c]
00783c50 : MULSS XMM0,dword ptr [0x00cdf0f0]
00783c58 : SUB ESP,0x8
00783c5b : CVTPS2PD XMM0,XMM0
00783c5e : MOVSD qword ptr [ESP],XMM0
00783c63 : PUSH 0xc1107c
00783c68 : PUSH 0xe
00783c6a : PUSH 0x28
00783c6c : CALL dword ptr [0x00d6d240]
00783c72 : MOV ECX,dword ptr [EBX + 0x224]
00783c78 : SUB ECX,dword ptr [EBX + 0x220]
00783c7e : MOV EAX,0x2aaaaaab
00783c83 : IMUL ECX
00783c85 : SAR EDX,0x2
00783c88 : MOV EAX,EDX
00783c8a : ADD ESP,0x14
00783c8d : SHR EAX,0x1f
00783c90 : ADD EAX,EDX
00783c92 : PUSH EAX
00783c93 : PUSH 0xc11090
00783c98 : PUSH 0xf
00783c9a : PUSH 0x28
00783c9c : CALL dword ptr [0x00d6d240]
00783ca2 : MOV ECX,dword ptr [EBX + 0x244]
00783ca8 : SUB ECX,dword ptr [EBX + 0x240]
00783cae : ADD ESP,0x10
00783cb1 : TEST ECX,0xfffffffc
00783cb7 : JNZ 0x00783cbf
00783cb9 : CMP dword ptr [EBP + 0x10],0x0
00783cbd : JZ 0x00783cf4
00783cbf : MOV ESI,dword ptr [EBP + 0xc]
00783cc2 : PUSH 0x1
00783cc4 : MOV EAX,ESI
00783cc6 : MOV EDI,EBX
00783cc8 : CALL 0x00781e70
00783ccd : TEST EAX,EAX
00783ccf : JL 0x00783cf4
00783cd1 : MOV EDX,dword ptr [EBX + 0x244]
00783cd7 : SUB EDX,dword ptr [EBX + 0x240]
00783cdd : TEST EDX,0xfffffffc
00783ce3 : JNZ 0x00783d02
00783ce5 : CMP dword ptr [EBP + 0x10],0x0
00783ce9 : JLE 0x00783d02
00783ceb : PUSH 0x0
00783ced : MOV EAX,ESI
00783cef : CALL 0x00781e70
00783cf4 : MOV EAX,0x80004005
00783cf9 : POP EDI
00783cfa : POP ESI
00783cfb : POP EBX
00783cfc : MOV ESP,EBP
00783cfe : POP EBP
00783cff : RET 0x10
00783d02 : MOV ECX,dword ptr [EBX + 0x130]
00783d08 : TEST ECX,ECX
00783d0a : JZ 0x00783dd2
00783d10 : MOV EAX,dword ptr [ECX]
00783d12 : MOV EDX,dword ptr [EAX + 0xc]
00783d15 : CALL EDX
00783d17 : MOV ECX,dword ptr [EBX + 0x130]
00783d1d : MOV EAX,dword ptr [ECX]
00783d1f : MOV EDX,dword ptr [EAX + 0x8]
00783d22 : CALL EDX
00783d24 : MOV ESI,dword ptr [EBX + 0x140]
00783d2a : MOV EDI,dword ptr [EBX + 0x244]
00783d30 : SUB EDI,dword ptr [EBX + 0x240]
00783d36 : MOV EAX,dword ptr [ESI]
00783d38 : MOV EDX,dword ptr [EAX + 0x1c]
00783d3b : MOV ECX,ESI
00783d3d : SAR EDI,0x2
00783d40 : CALL EDX
00783d42 : MOV EAX,[0x017251ac]
00783d47 : LEA EDX,[ESI + 0xb4]
00783d4d : CALL 0x007fc490
00783d52 : MOV EAX,[0x017251ac]
00783d57 : MOV ESI,dword ptr [EBX + 0x140]
00783d5d : MOV dword ptr [EBP + 0x10],EAX
00783d60 : CALL 0x007f1710
00783d65 : MOV EDX,EAX
00783d67 : MOV EAX,dword ptr [EBP + 0x10]
00783d6a : CALL 0x007fc460
00783d6f : XOR ESI,ESI
00783d71 : TEST EDI,EDI
00783d73 : JBE 0x00783da2
00783d75 : JMP 0x00783d80
00783d80 : MOV ECX,dword ptr [EBX + 0x140]
00783d86 : MOV EDX,dword ptr [EBX + 0x240]
00783d8c : MOV EAX,dword ptr [EDX + ESI*0x4]
00783d8f : PUSH ECX
00783d90 : MOV ECX,dword ptr [EBX + 0x130]
00783d96 : PUSH EAX
00783d97 : PUSH ECX
00783d98 : CALL 0x00748a20
00783d9d : INC ESI
00783d9e : CMP ESI,EDI
00783da0 : JC 0x00783d80
00783da2 : MOV EAX,[0x017251ac]
00783da7 : CALL 0x008006b0
00783dac : TEST AL,AL
00783dae : JZ 0x00783cf4
00783db4 : MOV ECX,dword ptr [EBX + 0x130]
00783dba : MOV EDX,dword ptr [ECX]
00783dbc : MOV EAX,dword ptr [EBX + 0x140]
00783dc2 : MOV EDX,dword ptr [EDX + 0x2c]
00783dc5 : PUSH EAX
00783dc6 : CALL EDX
00783dc8 : MOV EAX,[0x017251ac]
00783dcd : CALL 0x007fc990
00783dd2 : POP EDI
00783dd3 : POP ESI
00783dd4 : XOR EAX,EAX
00783dd6 : POP EBX
00783dd7 : MOV ESP,EBP
00783dd9 : POP EBP
00783dda : RET 0x10
