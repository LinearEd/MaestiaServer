PROGRAM  : Maestia.exe
FUNCTION : FUN_00540eb0
ENTRY    : 00540eb0
BODY     : [[00540eb0, 00540f90]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00540eb0(int *param_1,int param_2)

{
  int iVar1;
  int *piVar2;
  short *psVar3;
  undefined4 uVar4;
  int iVar5;
  int in_ECX;
  uint uVar6;
  int iVar7;
  
  if (((*param_1 != 0) && (iVar1 = param_1[1], -1 < iVar1)) && (iVar1 < *(int *)(*param_1 + 4))) {
    iVar7 = 0;
    if (iVar1 != 0) {
      piVar2 = *(int **)(*(int *)(in_ECX + 0xc) + -4 + iVar1 * 4);
      uVar6 = piVar2[1];
      if (uVar6 != 0) {
        if ((*piVar2 == 0) || (uVar6 <= uVar6 - 1)) {
          psVar3 = (short *)0x0;
        }
        else {
          psVar3 = (short *)(*piVar2 + (uVar6 - 1) * 2);
        }
        if (*psVar3 == 0) {
          uVar6 = uVar6 - 1;
        }
      }
      iVar7 = uVar6 + piVar2[7];
    }
    uVar4 = FUN_0053f720();
    iVar5 = FUN_00515840(0x28,0);
    if (iVar5 == 0) {
      param_2 = 0;
    }
    else {
      param_2 = FUN_00540310(param_2,uVar4);
    }
    FUN_00540a60(iVar1,&param_2);
    iVar5 = param_2;
    if (param_2 != 0) {
      FUN_0053bb30(*(undefined4 *)(param_2 + 0x10),*(undefined4 *)(param_2 + 0x14));
      FUN_00515cf0(*(undefined4 *)(iVar5 + 0x10));
      if (*(GRefCountNTSImpl **)(iVar5 + 0xc) != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(iVar5 + 0xc));
      }
      FUN_00515cf0(iVar5);
    }
    *(int *)(*(int *)(*(int *)(in_ECX + 0xc) + iVar1 * 4) + 0x1c) = iVar7;
    return;
  }
  FUN_00540ca0(param_2);
  return;
}



============================================================
DISASSEMBLY
============================================================
00540eb0 : PUSH EBX
00540eb1 : PUSH EDI
00540eb2 : MOV EDI,ECX
00540eb4 : MOV ECX,dword ptr [ESP + 0xc]
00540eb8 : MOV EAX,dword ptr [ECX]
00540eba : TEST EAX,EAX
00540ebc : JZ 0x00540eca
00540ebe : MOV EBX,dword ptr [ECX + 0x4]
00540ec1 : TEST EBX,EBX
00540ec3 : JL 0x00540eca
00540ec5 : CMP EBX,dword ptr [EAX + 0x4]
00540ec8 : JL 0x00540edb
00540eca : MOV EAX,dword ptr [ESP + 0x10]
00540ece : PUSH EAX
00540ecf : MOV ECX,EDI
00540ed1 : CALL 0x00540ca0
00540ed6 : POP EDI
00540ed7 : POP EBX
00540ed8 : RET 0x8
00540edb : PUSH EBP
00540edc : XOR EBP,EBP
00540ede : PUSH ESI
00540edf : TEST EBX,EBX
00540ee1 : JBE 0x00540f11
00540ee3 : MOV ECX,dword ptr [EDI + 0xc]
00540ee6 : MOV EAX,dword ptr [ECX + EBX*0x4 + -0x4]
00540eea : MOV ECX,dword ptr [EAX + 0x4]
00540eed : MOV ESI,dword ptr [EAX + 0x1c]
00540ef0 : TEST ECX,ECX
00540ef2 : JBE 0x00540f0e
00540ef4 : MOV EAX,dword ptr [EAX]
00540ef6 : LEA EDX,[ECX + -0x1]
00540ef9 : TEST EAX,EAX
00540efb : JZ 0x00540f06
00540efd : CMP EDX,ECX
00540eff : JNC 0x00540f06
00540f01 : LEA EAX,[EAX + EDX*0x2]
00540f04 : JMP 0x00540f08
00540f06 : XOR EAX,EAX
00540f08 : CMP word ptr [EAX],BP
00540f0b : JNZ 0x00540f0e
00540f0d : DEC ECX
00540f0e : LEA EBP,[ECX + ESI*0x1]
00540f11 : MOV ECX,EDI
00540f13 : CALL 0x0053f720
00540f18 : MOV ESI,EAX
00540f1a : MOV ECX,dword ptr [ESI + 0x1c]
00540f1d : PUSH 0x0
00540f1f : PUSH 0x28
00540f21 : CALL 0x00515840
00540f26 : TEST EAX,EAX
00540f28 : JZ 0x00540f39
00540f2a : MOV EDX,dword ptr [ESP + 0x18]
00540f2e : PUSH ESI
00540f2f : PUSH EDX
00540f30 : MOV ECX,EAX
00540f32 : CALL 0x00540310
00540f37 : JMP 0x00540f3b
00540f39 : XOR EAX,EAX
00540f3b : MOV dword ptr [ESP + 0x18],EAX
00540f3f : LEA EAX,[ESP + 0x18]
00540f43 : PUSH EAX
00540f44 : ADD EDI,0xc
00540f47 : PUSH EBX
00540f48 : MOV ECX,EDI
00540f4a : CALL 0x00540a60
00540f4f : MOV ESI,dword ptr [ESP + 0x18]
00540f53 : TEST ESI,ESI
00540f55 : JZ 0x00540f82
00540f57 : MOV ECX,dword ptr [ESI + 0x14]
00540f5a : MOV EDX,dword ptr [ESI + 0x10]
00540f5d : PUSH ECX
00540f5e : PUSH EDX
00540f5f : CALL 0x0053bb30
00540f64 : MOV EAX,dword ptr [ESI + 0x10]
00540f67 : ADD ESP,0x8
00540f6a : PUSH EAX
00540f6b : CALL 0x00515cf0
00540f70 : MOV ECX,dword ptr [ESI + 0xc]
00540f73 : TEST ECX,ECX
00540f75 : JZ 0x00540f7c
00540f77 : CALL 0x004ff7c0
00540f7c : PUSH ESI
00540f7d : CALL 0x00515cf0
00540f82 : MOV ECX,dword ptr [EDI]
00540f84 : MOV EAX,dword ptr [ECX + EBX*0x4]
00540f87 : POP ESI
00540f88 : MOV dword ptr [EAX + 0x1c],EBP
00540f8b : POP EBP
00540f8c : POP EDI
00540f8d : POP EBX
00540f8e : RET 0x8
