PROGRAM  : Maestia.exe
FUNCTION : FUN_005f4070
ENTRY    : 005f4070
BODY     : [[005f4070, 005f418c]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005f4070(int param_1,char param_2)

{
  undefined4 *puVar1;
  int iVar2;
  undefined4 uVar3;
  undefined4 uVar4;
  undefined4 uVar5;
  int iVar6;
  undefined4 *puVar7;
  LONG LVar8;
  int in_ECX;
  uint uVar9;
  uint local_8;
  
  FUN_005f3a20(param_1);
  uVar9 = 0;
  local_8 = 0;
  if (*(int *)(in_ECX + 0x1c) != 0) {
    do {
      iVar2 = (local_8 >> 6) * 4;
      iVar6 = (local_8 & 0x3f) * 0x1c;
      if (*(int *)(*(int *)(*(int *)(in_ECX + 0x28) + iVar2) + 0x18 + iVar6) != param_1) {
        puVar1 = (undefined4 *)
                 (*(int *)(*(int *)(in_ECX + 0x28) + (uVar9 >> 6) * 4) + (uVar9 & 0x3f) * 0x1c);
        iVar2 = *(int *)(*(int *)(in_ECX + 0x28) + iVar2);
        uVar3 = *(undefined4 *)(iVar2 + 4 + iVar6);
        uVar9 = uVar9 + 1;
        puVar7 = (undefined4 *)(iVar2 + iVar6);
        *puVar1 = *puVar7;
        puVar1[1] = uVar3;
        uVar3 = puVar7[5];
        uVar4 = puVar7[3];
        uVar5 = puVar7[4];
        puVar1[2] = puVar7[2];
        puVar1[3] = uVar4;
        puVar1[4] = uVar5;
        puVar1[5] = uVar3;
        puVar1[6] = puVar7[6];
      }
      local_8 = local_8 + 1;
    } while (local_8 < *(uint *)(in_ECX + 0x1c));
  }
  if (uVar9 < *(uint *)(in_ECX + 0x1c)) {
    *(uint *)(in_ECX + 0x1c) = uVar9;
  }
  iVar2 = in_ECX + param_1 * 0x14;
  *(undefined4 *)(iVar2 + 0x48) = 0;
  if (param_2 != '\0') {
    (**(code **)(**(int **)(iVar2 + 0x38) + 0x30))(in_ECX + (param_1 * 5 + 0xf) * 4);
    puVar1 = *(undefined4 **)(iVar2 + 0x38);
    LVar8 = InterlockedExchangeAdd(puVar1 + 1,-1);
    if ((LVar8 == 1) && (puVar1 != (undefined4 *)0x0)) {
      (**(code **)*puVar1)(1);
    }
    *(undefined4 *)(iVar2 + 0x38) = 0;
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005f4070 : SUB ESP,0x8
005f4073 : PUSH EBX
005f4074 : MOV EBX,dword ptr [ESP + 0x10]
005f4078 : PUSH EBP
005f4079 : PUSH ESI
005f407a : PUSH EDI
005f407b : MOV EDI,ECX
005f407d : PUSH EBX
005f407e : LEA ECX,[EDI + 0x710]
005f4084 : MOV dword ptr [ESP + 0x18],EDI
005f4088 : CALL 0x005f3a20
005f408d : XOR ECX,ECX
005f408f : XOR EBP,EBP
005f4091 : MOV dword ptr [ESP + 0x10],ECX
005f4095 : CMP dword ptr [EDI + 0x1c],ECX
005f4098 : JBE 0x005f412c
005f409e : MOV EDI,EDI
005f40a0 : MOV EAX,ECX
005f40a2 : AND EAX,0x3f
005f40a5 : MOV EDX,ECX
005f40a7 : SHR EDX,0x6
005f40aa : LEA ESI,[EAX*0x8 + 0x0]
005f40b1 : SUB ESI,EAX
005f40b3 : MOV EAX,dword ptr [EDI + 0x28]
005f40b6 : ADD EDX,EDX
005f40b8 : ADD EDX,EDX
005f40ba : MOV EAX,dword ptr [EAX + EDX*0x1]
005f40bd : ADD ESI,ESI
005f40bf : ADD ESI,ESI
005f40c1 : CMP dword ptr [EAX + ESI*0x1 + 0x18],EBX
005f40c5 : JZ 0x005f411e
005f40c7 : MOV EDI,dword ptr [EDI + 0x28]
005f40ca : MOV EAX,EBP
005f40cc : AND EAX,0x3f
005f40cf : LEA EBX,[EAX*0x8 + 0x0]
005f40d6 : SUB EBX,EAX
005f40d8 : MOV ECX,EBP
005f40da : SHR ECX,0x6
005f40dd : MOV EAX,dword ptr [EDI + ECX*0x4]
005f40e0 : LEA ECX,[EAX + EBX*0x4]
005f40e3 : MOV EAX,dword ptr [EDI + EDX*0x1]
005f40e6 : MOV EDX,dword ptr [EAX + ESI*0x1 + 0x4]
005f40ea : INC EBP
005f40eb : ADD EAX,ESI
005f40ed : MOV ESI,dword ptr [EAX]
005f40ef : MOV dword ptr [ECX],ESI
005f40f1 : MOV dword ptr [ECX + 0x4],EDX
005f40f4 : MOV EDX,dword ptr [EAX + 0x14]
005f40f7 : MOV EDI,dword ptr [EAX + 0xc]
005f40fa : MOV EBX,dword ptr [EAX + 0x8]
005f40fd : MOV ESI,dword ptr [EAX + 0x10]
005f4100 : MOV dword ptr [ECX + 0x8],EBX
005f4103 : MOV EBX,dword ptr [ESP + 0x1c]
005f4107 : MOV dword ptr [ECX + 0xc],EDI
005f410a : MOV EDI,dword ptr [ESP + 0x14]
005f410e : MOV dword ptr [ECX + 0x10],ESI
005f4111 : MOV dword ptr [ECX + 0x14],EDX
005f4114 : MOV EDX,dword ptr [EAX + 0x18]
005f4117 : MOV dword ptr [ECX + 0x18],EDX
005f411a : MOV ECX,dword ptr [ESP + 0x10]
005f411e : INC ECX
005f411f : MOV dword ptr [ESP + 0x10],ECX
005f4123 : CMP ECX,dword ptr [EDI + 0x1c]
005f4126 : JC 0x005f40a0
005f412c : CMP EBP,dword ptr [EDI + 0x1c]
005f412f : JNC 0x005f4134
005f4131 : MOV dword ptr [EDI + 0x1c],EBP
005f4134 : CMP byte ptr [ESP + 0x20],0x0
005f4139 : LEA EAX,[EBX + EBX*0x4]
005f413c : LEA ESI,[EDI + EAX*0x4]
005f413f : MOV dword ptr [ESI + 0x48],0x0
005f4146 : JZ 0x005f4183
005f4148 : MOV ECX,dword ptr [ESI + 0x38]
005f414b : MOV EDX,dword ptr [ECX]
005f414d : MOV EDX,dword ptr [EDX + 0x30]
005f4150 : LEA EAX,[EBX + EBX*0x4 + 0xf]
005f4154 : LEA EAX,[EDI + EAX*0x4]
005f4157 : PUSH EAX
005f4158 : CALL EDX
005f415a : MOV EDI,dword ptr [ESI + 0x38]
005f415d : PUSH -0x1
005f415f : LEA EAX,[EDI + 0x4]
005f4162 : PUSH EAX
005f4163 : CALL dword ptr [0x00b851cc]
005f4169 : SUB EAX,0x1
005f416c : JNZ 0x005f417c
005f416e : TEST EDI,EDI
005f4170 : JZ 0x005f417c
005f4172 : MOV EDX,dword ptr [EDI]
005f4174 : MOV EAX,dword ptr [EDX]
005f4176 : PUSH 0x1
005f4178 : MOV ECX,EDI
005f417a : CALL EAX
005f417c : MOV dword ptr [ESI + 0x38],0x0
005f4183 : POP EDI
005f4184 : POP ESI
005f4185 : POP EBP
005f4186 : POP EBX
005f4187 : ADD ESP,0x8
005f418a : RET 0x8
