PROGRAM  : Maestia.exe
FUNCTION : FUN_0081fe70
ENTRY    : 0081fe70
BODY     : [[0081fe70, 0081fff3]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0081fe70(void)

{
  int *piVar1;
  void *pvVar2;
  char cVar3;
  uint uVar4;
  DWORD DVar5;
  int iVar6;
  int iVar7;
  int in_ECX;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  pvVar2 = ExceptionList;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b3d1c4;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  *(undefined1 *)(in_ECX + 0x346) = 1;
  if (*(int *)(in_ECX + 0x160) != 0) {
    *(undefined4 *)(in_ECX + 0x160) = 0;
    ExceptionList = pvVar2;
    return;
  }
  if (*(int *)(in_ECX + 0xc4) == 4) {
    *(undefined4 *)(in_ECX + 0x33c) = DAT_00d72c20;
    FUN_00a0cfe0();
  }
  else {
    *(undefined4 *)(in_ECX + 0x33c) = 0;
    FUN_00a0ce50(uVar4);
    DVar5 = timeGetTime();
    *(DWORD *)(in_ECX + 0x374) = DVar5;
    iVar6 = FUN_00404750(L"[Request to exit] : %u",DVar5);
    local_8 = 0;
    if (*(uint *)(iVar6 + 0x18) < 8) {
      iVar6 = iVar6 + 4;
    }
    else {
      iVar6 = *(int *)(iVar6 + 4);
    }
    FUN_008018d0(iVar6);
    local_8 = 0xffffffff;
    if (7 < local_14) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
  }
  piVar1 = DAT_00da9894;
  *(undefined1 *)(in_ECX + 0x342) = 0;
  *(undefined1 *)(in_ECX + 0x339) = 1;
  *(undefined1 *)(in_ECX + 0x34b) = 0;
  *(undefined4 *)(in_ECX + 0x164) = 0;
  iVar6 = DAT_017248d0;
  if (*(int *)(*piVar1 + 300) == 0) {
    iVar7 = 0;
  }
  else {
    iVar7 = *(int *)(*(int *)(*piVar1 + 300) + 0xc);
  }
  *(undefined2 *)(DAT_017248d0 + 0x24) = *(undefined2 *)(*(int *)(iVar7 + 0x48) + 0x50);
  cVar3 = FUN_008b18b0(iVar6);
  if (cVar3 != '\0') {
    FUN_008018d0(L"UserData file save..");
  }
  cVar3 = FUN_008b2600();
  if (cVar3 != '\0') {
    FUN_008018d0(L"GameOption file save..");
  }
  DAT_00da9853 = 0;
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
0081fe70 : PUSH EBP
0081fe71 : MOV EBP,ESP
0081fe73 : PUSH -0x1
0081fe75 : PUSH 0xb3d1c4
0081fe7a : MOV EAX,FS:[0x0]
0081fe80 : PUSH EAX
0081fe81 : SUB ESP,0x1c
0081fe84 : PUSH EBX
0081fe85 : PUSH ESI
0081fe86 : PUSH EDI
0081fe87 : MOV EAX,[0x00d66fa0]
0081fe8c : XOR EAX,EBP
0081fe8e : PUSH EAX
0081fe8f : LEA EAX,[EBP + -0xc]
0081fe92 : MOV FS:[0x0],EAX
0081fe98 : MOV EDI,ECX
0081fe9a : XOR EBX,EBX
0081fe9c : MOV byte ptr [EDI + 0x346],0x1
0081fea3 : CMP dword ptr [EDI + 0x160],EBX
0081fea9 : JZ 0x0081fec3
0081feab : MOV dword ptr [EDI + 0x160],EBX
0081feb1 : MOV ECX,dword ptr [EBP + -0xc]
0081feb4 : MOV dword ptr FS:[0x0],ECX
0081febb : POP ECX
0081febc : POP EDI
0081febd : POP ESI
0081febe : POP EBX
0081febf : MOV ESP,EBP
0081fec1 : POP EBP
0081fec2 : RET
0081fec3 : CMP dword ptr [EDI + 0xc4],0x4
0081feca : MOV ECX,dword ptr [EDI + 0x158]
0081fed0 : JNZ 0x0081fee9
0081fed2 : MOVSS XMM0,dword ptr [0x00d72c20]
0081feda : MOVSS dword ptr [EDI + 0x33c],XMM0
0081fee2 : CALL 0x00a0cfe0
0081fee7 : JMP 0x0081ff5b
0081fee9 : XORPS XMM0,XMM0
0081feec : MOVSS dword ptr [EDI + 0x33c],XMM0
0081fef4 : CALL 0x00a0ce50
0081fef9 : CALL dword ptr [0x00b85598]
0081feff : PUSH EAX
0081ff00 : PUSH 0xc335ec
0081ff05 : LEA ESI,[EBP + -0x28]
0081ff08 : MOV dword ptr [EDI + 0x374],EAX
0081ff0e : CALL 0x00404750
0081ff13 : ADD ESP,0x8
0081ff16 : MOV dword ptr [EBP + -0x4],EBX
0081ff19 : CMP dword ptr [EAX + 0x18],0x8
0081ff1d : JC 0x0081ff24
0081ff1f : MOV EAX,dword ptr [EAX + 0x4]
0081ff22 : JMP 0x0081ff27
0081ff24 : ADD EAX,0x4
0081ff27 : MOV ESI,dword ptr [0x00da98e8]
0081ff2d : PUSH EAX
0081ff2e : CALL 0x008018d0
0081ff33 : ADD ESP,0x4
0081ff36 : MOV dword ptr [EBP + -0x4],0xffffffff
0081ff3d : CMP dword ptr [EBP + -0x10],0x8
0081ff41 : JC 0x0081ff4b
0081ff43 : MOV ECX,dword ptr [EBP + -0x24]
0081ff46 : CALL 0x006f04e0
0081ff4b : XOR EAX,EAX
0081ff4d : MOV dword ptr [EBP + -0x10],0x7
0081ff54 : MOV dword ptr [EBP + -0x14],EBX
0081ff57 : MOV word ptr [EBP + -0x24],AX
0081ff5b : MOV ECX,dword ptr [0x00da9894]
0081ff61 : MOV byte ptr [EDI + 0x342],BL
0081ff67 : MOV byte ptr [EDI + 0x339],0x1
0081ff6e : MOV byte ptr [EDI + 0x34b],BL
0081ff74 : MOV dword ptr [EDI + 0x164],EBX
0081ff7a : MOV EAX,dword ptr [ECX]
0081ff7c : MOV EAX,dword ptr [EAX + 0x12c]
0081ff82 : CMP EAX,EBX
0081ff84 : JNZ 0x0081ff8a
0081ff86 : XOR EAX,EAX
0081ff88 : JMP 0x0081ff8d
0081ff8a : MOV EAX,dword ptr [EAX + 0xc]
0081ff8d : MOV EDX,dword ptr [EAX + 0x48]
0081ff90 : MOV EAX,[0x017248d0]
0081ff95 : MOV CX,word ptr [EDX + 0x50]
0081ff99 : PUSH EAX
0081ff9a : MOV word ptr [EAX + 0x24],CX
0081ff9e : CALL 0x008b18b0
0081ffa3 : TEST AL,AL
0081ffa5 : JZ 0x0081ffba
0081ffa7 : MOV ESI,dword ptr [0x00da98e8]
0081ffad : PUSH 0xc3361c
0081ffb2 : CALL 0x008018d0
0081ffb7 : ADD ESP,0x4
0081ffba : MOV EDI,dword ptr [0x017248cc]
0081ffc0 : CALL 0x008b2600
0081ffc5 : TEST AL,AL
0081ffc7 : JZ 0x0081ffdc
0081ffc9 : MOV ESI,dword ptr [0x00da98e8]
0081ffcf : PUSH 0xc33648
0081ffd4 : CALL 0x008018d0
0081ffd9 : ADD ESP,0x4
0081ffdc : MOV byte ptr [0x00da9853],BL
0081ffe2 : MOV ECX,dword ptr [EBP + -0xc]
0081ffe5 : MOV dword ptr FS:[0x0],ECX
0081ffec : POP ECX
0081ffed : POP EDI
0081ffee : POP ESI
0081ffef : POP EBX
0081fff0 : MOV ESP,EBP
0081fff2 : POP EBP
0081fff3 : RET
