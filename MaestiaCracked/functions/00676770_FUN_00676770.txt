PROGRAM  : Maestia.exe
FUNCTION : FUN_00676770
ENTRY    : 00676770
BODY     : [[00676770, 006769c7]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00676770(int *param_1,undefined4 param_2)

{
  char cVar1;
  char *_Src;
  int iVar2;
  GRefCountNTSImpl *this;
  int iVar3;
  uint uVar4;
  int iVar5;
  void *pvStack_18c;
  int iStack_188;
  int iStack_184;
  uint uStack_180;
  int iStack_178;
  int iStack_174;
  char acStack_10c [256];
  undefined1 auStack_c [8];
  uint local_4;
  
  local_4 = DAT_00d66fa0 ^ (uint)&pvStack_18c;
  iVar5 = 0;
  if ((param_1 != (int *)0x0) && (cVar1 = (**(code **)(*param_1 + 8))(), cVar1 != '\0')) {
    _memset(&pvStack_18c,0,0x180);
    _Src = (char *)(**(code **)(*param_1 + 4))();
    _strcpy_s(acStack_10c,0x100,_Src);
    iVar2 = (**(code **)(*param_1 + 0x28))(auStack_c,8);
    if ((iVar2 == 8) &&
       ((iVar2 = FUN_006cc990(auStack_c,8), iVar2 != 0 &&
        (pvStack_18c = __aligned_recalloc("1.2.18",(size_t)&pvStack_18c,0x676560,0),
        pvStack_18c != (void *)0x0)))) {
      iStack_188 = FUN_006ccaf0(pvStack_18c);
      if (iStack_188 == 0) {
        FUN_006c4360(&pvStack_18c,0,0);
      }
      else {
        FUN_006cd360(pvStack_18c,param_1,&LAB_00676520);
        iVar2 = FUN_006765d0(&pvStack_18c);
        if (iVar2 == 0) {
          FUN_006c4360(&pvStack_18c,&iStack_188,0);
        }
        else {
          if (iStack_178 == 2) {
            iVar2 = 2;
            iVar5 = iStack_184 * 3;
          }
          else if (iStack_178 == 6) {
            iVar2 = 1;
            iVar5 = iStack_184 * 4;
          }
          else {
            iVar2 = 0;
          }
          if (iStack_174 != 0) {
            iVar5 = iStack_174;
          }
          if ((iVar2 == 0) ||
             (this = (GRefCountNTSImpl *)FUN_00519a90(iVar2,iStack_184,uStack_180,param_2),
             this == (GRefCountNTSImpl *)0x0)) {
            FUN_006c4360(&pvStack_18c,&iStack_188,0);
          }
          else {
            iVar2 = *(int *)(this + 0x18);
            iVar3 = FUN_0045b5a0(uStack_180 * 4);
            if (iVar3 == 0) {
              FUN_006c4360(&pvStack_18c,&iStack_188,0);
              GRefCountNTSImpl::Release(this);
            }
            else {
              uVar4 = 0;
              if (uStack_180 != 0) {
                do {
                  *(int *)(iVar3 + uVar4 * 4) = iVar2;
                  uVar4 = uVar4 + 1;
                  iVar2 = iVar2 + (iVar5 + 3U & 0xfffffffc);
                } while (uVar4 < uStack_180);
              }
              iVar5 = FUN_00676720(&pvStack_18c,iVar3);
              if (iVar5 == 0) {
                FUN_006c4360(&pvStack_18c,&iStack_188,0);
                FUN_00515cf0(iVar3);
                GRefCountNTSImpl::Release(this);
              }
              else {
                FUN_006c4360(&pvStack_18c,&iStack_188,0);
                FUN_00515cf0(iVar3);
                *(int *)(this + 4) = *(int *)(this + 4) + 1;
                GRefCountNTSImpl::Release(this);
              }
            }
          }
        }
      }
    }
  }
  __security_check_cookie(local_4 ^ (uint)&pvStack_18c);
  return;
}



============================================================
DISASSEMBLY
============================================================
00676770 : SUB ESP,0x18c
00676776 : MOV EAX,[0x00d66fa0]
0067677b : XOR EAX,ESP
0067677d : MOV dword ptr [ESP + 0x188],EAX
00676784 : PUSH EBP
00676785 : MOV EBP,dword ptr [ESP + 0x198]
0067678c : PUSH ESI
0067678d : MOV ESI,dword ptr [ESP + 0x198]
00676794 : PUSH EDI
00676795 : XOR EDI,EDI
00676797 : TEST ESI,ESI
00676799 : JZ 0x0067684f
0067679f : MOV EAX,dword ptr [ESI]
006767a1 : MOV EDX,dword ptr [EAX + 0x8]
006767a4 : MOV ECX,ESI
006767a6 : CALL EDX
006767a8 : TEST AL,AL
006767aa : JZ 0x0067684f
006767b0 : PUSH 0x180
006767b5 : LEA EAX,[ESP + 0x10]
006767b9 : PUSH EDI
006767ba : PUSH EAX
006767bb : CALL 0x0063b700
006767c0 : MOV EDX,dword ptr [ESI]
006767c2 : MOV EAX,dword ptr [EDX + 0x4]
006767c5 : ADD ESP,0xc
006767c8 : MOV ECX,ESI
006767ca : CALL EAX
006767cc : PUSH EAX
006767cd : LEA ECX,[ESP + 0x90]
006767d4 : PUSH 0x100
006767d9 : PUSH ECX
006767da : CALL 0x00638300
006767df : MOV EDX,dword ptr [ESI]
006767e1 : MOV EDX,dword ptr [EDX + 0x28]
006767e4 : ADD ESP,0xc
006767e7 : PUSH 0x8
006767e9 : LEA EAX,[ESP + 0x190]
006767f0 : PUSH EAX
006767f1 : MOV ECX,ESI
006767f3 : CALL EDX
006767f5 : CMP EAX,0x8
006767f8 : JNZ 0x0067684f
006767fa : PUSH EAX
006767fb : LEA EAX,[ESP + 0x190]
00676802 : PUSH EAX
00676803 : CALL 0x006cc990
00676808 : ADD ESP,0x8
0067680b : TEST EAX,EAX
0067680d : JZ 0x0067684f
0067680f : PUSH EDI
00676810 : PUSH 0x676560
00676815 : LEA ECX,[ESP + 0x14]
00676819 : PUSH ECX
0067681a : PUSH 0xbd6208
0067681f : CALL 0x006c2b50
00676824 : ADD ESP,0x10
00676827 : MOV dword ptr [ESP + 0xc],EAX
0067682b : TEST EAX,EAX
0067682d : JZ 0x0067684f
0067682f : PUSH EAX
00676830 : CALL 0x006ccaf0
00676835 : ADD ESP,0x4
00676838 : MOV dword ptr [ESP + 0x10],EAX
0067683c : TEST EAX,EAX
0067683e : JNZ 0x00676856
00676840 : PUSH EAX
00676841 : PUSH EAX
00676842 : LEA EDX,[ESP + 0x14]
00676846 : PUSH EDX
00676847 : CALL 0x006c4360
0067684c : ADD ESP,0xc
0067684f : XOR EAX,EAX
00676851 : JMP 0x006769ae
00676856 : MOV EAX,dword ptr [ESP + 0xc]
0067685a : PUSH 0x676520
0067685f : PUSH ESI
00676860 : PUSH EAX
00676861 : CALL 0x006cd360
00676866 : LEA ECX,[ESP + 0x18]
0067686a : PUSH ECX
0067686b : CALL 0x006765d0
00676870 : ADD ESP,0x10
00676873 : TEST EAX,EAX
00676875 : JNZ 0x00676891
00676877 : PUSH EAX
00676878 : LEA EDX,[ESP + 0x14]
0067687c : PUSH EDX
0067687d : LEA EAX,[ESP + 0x14]
00676881 : PUSH EAX
00676882 : CALL 0x006c4360
00676887 : ADD ESP,0xc
0067688a : XOR EAX,EAX
0067688c : JMP 0x006769ae
00676891 : MOV EAX,dword ptr [ESP + 0x20]
00676895 : SUB EAX,0x2
00676898 : MOV ECX,dword ptr [ESP + 0x14]
0067689c : JZ 0x006768b5
0067689e : SUB EAX,0x4
006768a1 : JZ 0x006768a7
006768a3 : XOR EAX,EAX
006768a5 : JMP 0x006768bd
006768a7 : MOV EAX,0x1
006768ac : LEA EDI,[ECX*0x4 + 0x0]
006768b3 : JMP 0x006768bd
006768b5 : MOV EAX,0x2
006768ba : LEA EDI,[ECX + ECX*0x2]
006768bd : MOV EDX,dword ptr [ESP + 0x24]
006768c1 : TEST EDX,EDX
006768c3 : JZ 0x006768c7
006768c5 : MOV EDI,EDX
006768c7 : PUSH EBX
006768c8 : LEA EBX,[EDI + 0x3]
006768cb : AND EBX,0xfffffffc
006768ce : TEST EAX,EAX
006768d0 : JZ 0x00676997
006768d6 : MOV EDX,dword ptr [ESP + 0x1c]
006768da : PUSH EBP
006768db : PUSH EDX
006768dc : PUSH ECX
006768dd : PUSH EAX
006768de : CALL 0x00519a90
006768e3 : MOV ESI,EAX
006768e5 : TEST ESI,ESI
006768e7 : JZ 0x00676997
006768ed : MOV EAX,dword ptr [ESP + 0x1c]
006768f1 : MOV EBP,dword ptr [ESI + 0x18]
006768f4 : LEA ECX,[EAX*0x4 + 0x0]
006768fb : PUSH ECX
006768fc : CALL 0x0045b5a0
00676901 : MOV EDI,EAX
00676903 : TEST EDI,EDI
00676905 : JNZ 0x00676926
00676907 : PUSH EAX
00676908 : LEA EDX,[ESP + 0x18]
0067690c : PUSH EDX
0067690d : LEA EAX,[ESP + 0x18]
00676911 : PUSH EAX
00676912 : CALL 0x006c4360
00676917 : ADD ESP,0xc
0067691a : MOV ECX,ESI
0067691c : CALL 0x004ff7c0
00676921 : JMP 0x006769ab
00676926 : XOR EAX,EAX
00676928 : CMP dword ptr [ESP + 0x1c],EAX
0067692c : JBE 0x0067693c
0067692e : MOV ECX,EBP
00676930 : MOV dword ptr [EDI + EAX*0x4],ECX
00676933 : INC EAX
00676934 : ADD ECX,EBX
00676936 : CMP EAX,dword ptr [ESP + 0x1c]
0067693a : JC 0x00676930
0067693c : LEA ECX,[ESP + 0x10]
00676940 : PUSH EDI
00676941 : PUSH ECX
00676942 : CALL 0x00676720
00676947 : ADD ESP,0x8
0067694a : PUSH 0x0
0067694c : TEST EAX,EAX
0067694e : JNZ 0x00676971
00676950 : LEA EDX,[ESP + 0x18]
00676954 : PUSH EDX
00676955 : LEA EAX,[ESP + 0x18]
00676959 : PUSH EAX
0067695a : CALL 0x006c4360
0067695f : ADD ESP,0xc
00676962 : PUSH EDI
00676963 : CALL 0x00515cf0
00676968 : MOV ECX,ESI
0067696a : CALL 0x004ff7c0
0067696f : JMP 0x006769ab
00676971 : LEA ECX,[ESP + 0x18]
00676975 : PUSH ECX
00676976 : LEA EDX,[ESP + 0x18]
0067697a : PUSH EDX
0067697b : CALL 0x006c4360
00676980 : ADD ESP,0xc
00676983 : PUSH EDI
00676984 : CALL 0x00515cf0
00676989 : INC dword ptr [ESI + 0x4]
0067698c : MOV ECX,ESI
0067698e : CALL 0x004ff7c0
00676993 : MOV EAX,ESI
00676995 : JMP 0x006769ad
00676997 : PUSH 0x0
00676999 : LEA EAX,[ESP + 0x18]
0067699d : PUSH EAX
0067699e : LEA ECX,[ESP + 0x18]
006769a2 : PUSH ECX
006769a3 : CALL 0x006c4360
006769a8 : ADD ESP,0xc
006769ab : XOR EAX,EAX
006769ad : POP EBX
006769ae : MOV ECX,dword ptr [ESP + 0x194]
006769b5 : POP EDI
006769b6 : POP ESI
006769b7 : POP EBP
006769b8 : XOR ECX,ESP
006769ba : CALL 0x00633e6b
006769bf : ADD ESP,0x18c
006769c5 : RET 0x8
