PROGRAM  : Maestia.exe
FUNCTION : FUN_00559390
ENTRY    : 00559390
BODY     : [[00559390, 005594dc] [005594e0, 00559599]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00559390(float param_1,int param_2,undefined4 param_3)

{
  bool bVar1;
  int iVar2;
  undefined4 uVar3;
  int *in_ECX;
  int iVar4;
  GRefCountNTSImpl *local_88;
  float local_84;
  float local_80;
  undefined4 local_7c;
  float local_78;
  char cStack_58;
  
  if (in_ECX[8] == 0) {
    if ((((*(byte *)(param_2 + 0x14) & 0x10) == 0) || ((*(uint *)(param_2 + 0x1c) & 0x100) == 0)) ||
       (((*(uint *)(param_2 + 0x1c) >> 9 & 1) == 0 && ((*(byte *)(in_ECX + 9) & 1) != 0)))) {
      bVar1 = false;
    }
    else {
      bVar1 = true;
    }
    iVar2 = FUN_00515840(0x3b4,0);
    if (iVar2 == 0) {
      local_84 = 0.0;
    }
    else {
      local_84 = (float)FUN_005ddf20(DAT_00d73250);
    }
    local_78 = 20.0 / param_1;
    local_88 = (GRefCountNTSImpl *)0x83;
    local_80 = local_78 * 0.75 * *(float *)(param_2 + 0x10);
    iVar2 = FUN_00515d60(in_ECX,0x70,&local_88);
    if (iVar2 == 0) {
      iVar2 = 0;
    }
    else {
      iVar2 = FUN_005dc3f0(local_78,local_80,!bVar1,0);
    }
    iVar4 = (int)local_84 + 8;
    in_ECX[8] = iVar2;
    FUN_005dd100();
    FUN_005dcbb0(local_80);
    *(byte *)((int)local_84 + 0x4c) = *(byte *)(in_ECX + 9) >> 3 & 1;
    if ((*(byte *)(in_ECX + 9) & 0x10) != 0) {
      FUN_005d9f10(in_ECX + 1,param_3);
    }
    FUN_005560e0(in_ECX);
    local_7c = 0;
    uVar3 = (**(code **)(*in_ECX + 0x24))(&local_7c);
    while (cStack_58 != '\x01') {
      if (cStack_58 == '\x02') {
        FUN_005dcd20(local_84 * 0.25);
        FUN_005dc490(iVar4,uVar3,local_80,0,param_2);
        FUN_005dd100();
        if (cStack_58 == '\x01') break;
        if (cStack_58 == '\x02') {
          do {
            FUN_00553740();
          } while (cStack_58 == '\x03');
        }
        else {
          FUN_005564c0();
        }
      }
      else {
        FUN_00558a80(iVar4);
      }
    }
    FUN_005dcd20(local_84 * 0.25);
    FUN_005dc490(iVar4,uVar3,local_80,0,param_2);
    GRefCountNTSImpl::Release(local_88);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00559390 : SUB ESP,0x88
00559396 : PUSH EDI
00559397 : MOV EDI,ECX
00559399 : CMP dword ptr [EDI + 0x20],0x0
0055939d : JNZ 0x00559590
005593a3 : PUSH EBX
005593a4 : PUSH EBP
005593a5 : MOV EBP,dword ptr [ESP + 0x9c]
005593ac : TEST byte ptr [EBP + 0x14],0x10
005593b0 : PUSH ESI
005593b1 : JZ 0x005593ce
005593b3 : MOV EAX,dword ptr [EBP + 0x1c]
005593b6 : TEST EAX,0x100
005593bb : JZ 0x005593ce
005593bd : SHR EAX,0x9
005593c0 : TEST AL,0x1
005593c2 : JNZ 0x005593ca
005593c4 : TEST byte ptr [EDI + 0x24],0x1
005593c8 : JNZ 0x005593ce
005593ca : MOV BL,0x1
005593cc : JMP 0x005593d0
005593ce : XOR BL,BL
005593d0 : MOV ECX,dword ptr [0x00d73250]
005593d6 : PUSH 0x0
005593d8 : PUSH 0x3b4
005593dd : CALL 0x00515840
005593e2 : TEST EAX,EAX
005593e4 : JZ 0x005593fa
005593e6 : MOV ECX,dword ptr [0x00d73250]
005593ec : PUSH ECX
005593ed : MOV ECX,EAX
005593ef : CALL 0x005ddf20
005593f4 : MOV dword ptr [ESP + 0x14],EAX
005593f8 : JMP 0x00559402
005593fa : MOV dword ptr [ESP + 0x14],0x0
00559402 : FLD float ptr [ESP + 0x9c]
00559409 : LEA EDX,[ESP + 0x10]
0055940d : FDIVR double ptr [0x00b86058]
00559413 : PUSH EDX
00559414 : PUSH 0x70
00559416 : PUSH EDI
00559417 : MOV dword ptr [ESP + 0x1c],0x83
0055941f : FSTP float ptr [ESP + 0x2c]
00559423 : FLD float ptr [ESP + 0x2c]
00559427 : FMUL double ptr [0x00b8c220]
0055942d : FMUL float ptr [EBP + 0x10]
00559430 : FSTP float ptr [ESP + 0x24]
00559434 : CALL 0x00515d60
00559439 : TEST EAX,EAX
0055943b : JZ 0x00559463
0055943d : FLD float ptr [ESP + 0x18]
00559441 : TEST BL,BL
00559443 : SETZ CL
00559446 : MOVZX EDX,CL
00559449 : PUSH 0x0
0055944b : PUSH EDX
0055944c : SUB ESP,0x8
0055944f : MOV ECX,EAX
00559451 : FSTP float ptr [ESP + 0x4]
00559455 : FLD float ptr [ESP + 0x30]
00559459 : FSTP float ptr [ESP]
0055945c : CALL 0x005dc3f0
00559461 : JMP 0x00559465
00559463 : XOR EAX,EAX
00559465 : MOV ESI,dword ptr [ESP + 0x14]
00559469 : ADD ESI,0x8
0055946c : MOV ECX,ESI
0055946e : MOV dword ptr [EDI + 0x20],EAX
00559471 : CALL 0x005dd100
00559476 : FLD float ptr [ESP + 0x18]
0055947a : PUSH ECX
0055947b : MOV ECX,ESI
0055947d : FSTP float ptr [ESP]
00559480 : CALL 0x005dcbb0
00559485 : MOV AL,byte ptr [EDI + 0x24]
00559488 : MOV ECX,dword ptr [ESP + 0x14]
0055948c : SHR AL,0x3
0055948f : AND AL,0x1
00559491 : MOV byte ptr [ECX + 0x4c],AL
00559494 : TEST byte ptr [EDI + 0x24],0x10
00559498 : JZ 0x005594b1
0055949a : FLD float ptr [ESP + 0xa4]
005594a1 : PUSH ECX
005594a2 : MOV ECX,dword ptr [EDI + 0x20]
005594a5 : FSTP float ptr [ESP]
005594a8 : LEA EDX,[EDI + 0x4]
005594ab : PUSH EDX
005594ac : CALL 0x005d9f10
005594b1 : PUSH EDI
005594b2 : LEA ECX,[ESP + 0x28]
005594b6 : CALL 0x005560e0
005594bb : MOV EAX,dword ptr [EDI]
005594bd : MOV EDX,dword ptr [EAX + 0x24]
005594c0 : LEA ECX,[ESP + 0x1c]
005594c4 : PUSH ECX
005594c5 : MOV ECX,EDI
005594c7 : MOV dword ptr [ESP + 0x20],0x0
005594cf : CALL EDX
005594d1 : MOV EBX,EAX
005594d3 : MOV AL,byte ptr [ESP + 0x44]
005594d7 : CMP AL,0x1
005594d9 : JZ 0x00559555
005594db : JMP 0x005594e0
005594e0 : CMP AL,0x2
005594e2 : JNZ 0x00559543
005594e4 : FLD float ptr [ESP + 0x18]
005594e8 : PUSH ECX
005594e9 : FMUL double ptr [0x00cdf848]
005594ef : MOV ECX,ESI
005594f1 : FSTP float ptr [ESP + 0x14]
005594f5 : FLD float ptr [ESP + 0x14]
005594f9 : FSTP float ptr [ESP]
005594fc : CALL 0x005dcd20
00559501 : MOV EAX,dword ptr [ESP + 0x1c]
00559505 : MOV ECX,dword ptr [EDI + 0x20]
00559508 : PUSH EBP
00559509 : PUSH 0x0
0055950b : PUSH EAX
0055950c : PUSH EBX
0055950d : PUSH ESI
0055950e : CALL 0x005dc490
00559513 : MOV ECX,ESI
00559515 : CALL 0x005dd100
0055951a : MOV AL,byte ptr [ESP + 0x44]
0055951e : CMP AL,0x1
00559520 : JZ 0x00559555
00559522 : CMP AL,0x2
00559524 : JNZ 0x00559538
00559526 : LEA ECX,[ESP + 0x24]
0055952a : CALL 0x00553740
0055952f : CMP byte ptr [ESP + 0x44],0x3
00559534 : JZ 0x00559526
00559536 : JMP 0x0055954d
00559538 : LEA ECX,[ESP + 0x24]
0055953c : CALL 0x005564c0
00559541 : JMP 0x0055954d
00559543 : PUSH ESI
00559544 : LEA ECX,[ESP + 0x28]
00559548 : CALL 0x00558a80
0055954d : MOV AL,byte ptr [ESP + 0x44]
00559551 : CMP AL,0x1
00559553 : JNZ 0x005594e0
00559555 : FLD float ptr [ESP + 0x18]
00559559 : PUSH ECX
0055955a : FMUL double ptr [0x00cdf848]
00559560 : MOV ECX,ESI
00559562 : FSTP float ptr [ESP + 0x14]
00559566 : FLD float ptr [ESP + 0x14]
0055956a : FSTP float ptr [ESP]
0055956d : CALL 0x005dcd20
00559572 : MOV ECX,dword ptr [ESP + 0x1c]
00559576 : PUSH EBP
00559577 : PUSH 0x0
00559579 : PUSH ECX
0055957a : MOV ECX,dword ptr [EDI + 0x20]
0055957d : PUSH EBX
0055957e : PUSH ESI
0055957f : CALL 0x005dc490
00559584 : MOV ECX,dword ptr [ESP + 0x14]
00559588 : CALL 0x004ff7c0
0055958d : POP ESI
0055958e : POP EBP
0055958f : POP EBX
00559590 : POP EDI
00559591 : ADD ESP,0x88
00559597 : RET 0xc
