PROGRAM  : Maestia.exe
FUNCTION : FUN_0080d160
ENTRY    : 0080d160
BODY     : [[0080d160, 0080d35b]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0080d160(int param_1)

{
  int iVar1;
  int *piVar2;
  uint uVar3;
  int iVar4;
  int iVar5;
  undefined1 local_30 [4];
  int local_2c;
  int *local_28;
  int local_24;
  int local_20;
  int local_1c;
  undefined1 local_18 [8];
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b1a775;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if ((*(int *)(param_1 + 0x38) != 0) && (DAT_01724780 != 0)) {
    local_1c = -(uint)(*(int *)(DAT_01724780 + 0x28) != 0);
    local_20 = 0;
    FUN_00404160(&local_1c,local_18,&local_20);
    iVar1 = local_20;
    while (local_1c != 0) {
      if ((iVar1 != 0) && (*(int *)(iVar1 + 0x120) != 0)) {
        if (((uint)*(byte *)(iVar1 + 0x41) == *(uint *)(param_1 + 0x74)) &&
           (*(short *)(*(int *)(iVar1 + 0x120) + 6) == *(short *)(param_1 + 0x78))) break;
        local_20 = 0;
        FUN_00404160(&local_1c,local_18,&local_20);
        iVar1 = local_20;
      }
    }
    if ((iVar1 != 0) && (*(int *)(iVar1 + 300) != 0)) {
      local_2c = 0;
      local_28 = (int *)0x0;
      local_24 = 0;
      local_8 = 0;
      local_20 = (**(code **)(*(int *)(*(int *)(iVar1 + 300) + 0x2ec) + 4))(uVar3);
      piVar2 = (int *)0x0;
      iVar1 = 0;
      while (local_20 != 0) {
        local_1c = FUN_004f5680();
        if ((*(char *)(param_1 + 0xd8) != '\x02') || ((*(byte *)(local_1c + 0xc0) & 4) != 0)) {
          if (iVar1 == 0) {
            uVar3 = 0;
          }
          else {
            uVar3 = local_24 - iVar1 >> 2;
          }
          if ((uint)((int)piVar2 - iVar1 >> 2) < uVar3) {
            *piVar2 = local_1c;
            local_28 = piVar2 + 1;
            piVar2 = local_28;
          }
          else {
            FUN_004d2c60(local_30,piVar2,&local_1c);
            piVar2 = local_28;
            iVar1 = local_2c;
          }
        }
      }
      iVar5 = (int)piVar2 - iVar1 >> 2;
      iVar4 = *(int *)(param_1 + 0x7c) % iVar5;
      *(int *)(param_1 + 0x7c) = iVar4;
      if (iVar4 < iVar5) {
        if (iVar4 < 0) {
          *(int *)(param_1 + 0x7c) = iVar5 + -1;
        }
      }
      else {
        *(undefined4 *)(param_1 + 0x7c) = 0;
      }
      iVar4 = *DAT_00da9894;
      if ((iVar4 != 0) && (*(int *)(iVar4 + 0x114) != 0)) {
        (**(code **)(**(int **)(iVar4 + 0x114) + 4))
                  (*(int **)(iVar4 + 0x114),"mc_beautyshop.SetHair",&DAT_00c2daf4,
                   *(undefined4 *)(param_1 + 0x7c));
      }
      *(undefined2 *)(*(int *)(param_1 + 0x38) + 0x169a) =
           *(undefined2 *)(*(int *)(iVar1 + *(int *)(param_1 + 0x7c) * 4) + 6);
      FUN_0042d2e0(local_30);
      local_8 = 0xffffffff;
      if (local_2c != 0) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
    }
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
0080d160 : PUSH EBP
0080d161 : MOV EBP,ESP
0080d163 : PUSH -0x1
0080d165 : PUSH 0xb1a775
0080d16a : MOV EAX,FS:[0x0]
0080d170 : PUSH EAX
0080d171 : SUB ESP,0x20
0080d174 : PUSH EBX
0080d175 : PUSH ESI
0080d176 : PUSH EDI
0080d177 : MOV EAX,[0x00d66fa0]
0080d17c : XOR EAX,EBP
0080d17e : PUSH EAX
0080d17f : LEA EAX,[EBP + -0xc]
0080d182 : MOV FS:[0x0],EAX
0080d188 : MOV EDI,dword ptr [EBP + 0x8]
0080d18b : XOR ESI,ESI
0080d18d : CMP dword ptr [EDI + 0x38],ESI
0080d190 : JZ 0x0080d348
0080d196 : MOV EBX,dword ptr [0x01724780]
0080d19c : CMP EBX,ESI
0080d19e : JZ 0x0080d348
0080d1a4 : MOV EAX,dword ptr [EBX + 0x28]
0080d1a7 : NEG EAX
0080d1a9 : SBB EAX,EAX
0080d1ab : LEA ECX,[EBP + -0x1c]
0080d1ae : PUSH ECX
0080d1af : MOV dword ptr [EBP + -0x18],EAX
0080d1b2 : LEA EDX,[EBP + -0x14]
0080d1b5 : PUSH EDX
0080d1b6 : LEA EAX,[EBP + -0x18]
0080d1b9 : PUSH EAX
0080d1ba : MOV EAX,EBX
0080d1bc : MOV dword ptr [EBP + -0x1c],ESI
0080d1bf : CALL 0x00404160
0080d1c4 : MOV EAX,dword ptr [EBP + -0x1c]
0080d1c7 : CMP dword ptr [EBP + -0x18],ESI
0080d1ca : JZ 0x0080d20f
0080d1cc : LEA ESP,[ESP]
0080d1d0 : CMP EAX,ESI
0080d1d2 : JZ 0x0080d20a
0080d1d4 : MOV ECX,dword ptr [EAX + 0x120]
0080d1da : CMP ECX,ESI
0080d1dc : JZ 0x0080d20a
0080d1de : MOVZX EDX,byte ptr [EAX + 0x41]
0080d1e2 : CMP EDX,dword ptr [EDI + 0x74]
0080d1e5 : JNZ 0x0080d1f1
0080d1e7 : MOV CX,word ptr [ECX + 0x6]
0080d1eb : CMP CX,word ptr [EDI + 0x78]
0080d1ef : JZ 0x0080d20f
0080d1f1 : LEA EDX,[EBP + -0x1c]
0080d1f4 : PUSH EDX
0080d1f5 : LEA EAX,[EBP + -0x14]
0080d1f8 : PUSH EAX
0080d1f9 : LEA ECX,[EBP + -0x18]
0080d1fc : PUSH ECX
0080d1fd : MOV EAX,EBX
0080d1ff : MOV dword ptr [EBP + -0x1c],ESI
0080d202 : CALL 0x00404160
0080d207 : MOV EAX,dword ptr [EBP + -0x1c]
0080d20a : CMP dword ptr [EBP + -0x18],ESI
0080d20d : JNZ 0x0080d1d0
0080d20f : CMP EAX,ESI
0080d211 : JZ 0x0080d348
0080d217 : MOV EAX,dword ptr [EAX + 0x12c]
0080d21d : CMP EAX,ESI
0080d21f : JZ 0x0080d348
0080d225 : XOR EDI,EDI
0080d227 : MOV dword ptr [EBP + -0x28],EDI
0080d22a : MOV dword ptr [EBP + -0x24],ESI
0080d22d : MOV dword ptr [EBP + -0x20],ESI
0080d230 : MOV dword ptr [EBP + -0x4],ESI
0080d233 : MOV EDX,dword ptr [EAX + 0x2ec]
0080d239 : LEA EBX,[EAX + 0x2ec]
0080d23f : MOV EAX,dword ptr [EDX + 0x4]
0080d242 : MOV ECX,EBX
0080d244 : CALL EAX
0080d246 : MOV dword ptr [EBP + -0x1c],EAX
0080d249 : TEST EAX,EAX
0080d24b : JZ 0x0080d2b1
0080d24d : LEA ECX,[ECX]
0080d250 : LEA EDX,[EBP + -0x1c]
0080d253 : MOV EAX,EBX
0080d255 : CALL 0x004f5680
0080d25a : MOV ECX,dword ptr [EBP + 0x8]
0080d25d : CMP byte ptr [ECX + 0xd8],0x2
0080d264 : MOV dword ptr [EBP + -0x18],EAX
0080d267 : JNZ 0x0080d272
0080d269 : TEST byte ptr [EAX + 0xc0],0x4
0080d270 : JZ 0x0080d2ab
0080d272 : TEST EDI,EDI
0080d274 : JNZ 0x0080d27a
0080d276 : XOR ECX,ECX
0080d278 : JMP 0x0080d282
0080d27a : MOV ECX,dword ptr [EBP + -0x20]
0080d27d : SUB ECX,EDI
0080d27f : SAR ECX,0x2
0080d282 : MOV EDX,ESI
0080d284 : SUB EDX,EDI
0080d286 : SAR EDX,0x2
0080d289 : CMP EDX,ECX
0080d28b : JNC 0x0080d297
0080d28d : MOV dword ptr [ESI],EAX
0080d28f : ADD ESI,0x4
0080d292 : MOV dword ptr [EBP + -0x24],ESI
0080d295 : JMP 0x0080d2ab
0080d297 : LEA EAX,[EBP + -0x18]
0080d29a : PUSH EAX
0080d29b : PUSH ESI
0080d29c : LEA ECX,[EBP + -0x2c]
0080d29f : PUSH ECX
0080d2a0 : CALL 0x004d2c60
0080d2a5 : MOV ESI,dword ptr [EBP + -0x24]
0080d2a8 : MOV EDI,dword ptr [EBP + -0x28]
0080d2ab : CMP dword ptr [EBP + -0x1c],0x0
0080d2af : JNZ 0x0080d250
0080d2b1 : MOV EDX,dword ptr [EBP + 0x8]
0080d2b4 : MOV EAX,dword ptr [EDX + 0x7c]
0080d2b7 : SUB ESI,EDI
0080d2b9 : SAR ESI,0x2
0080d2bc : CDQ
0080d2bd : IDIV ESI
0080d2bf : MOV EBX,dword ptr [EBP + 0x8]
0080d2c2 : CMP EDX,ESI
0080d2c4 : MOV dword ptr [EBX + 0x7c],EDX
0080d2c7 : JL 0x0080d2d2
0080d2c9 : MOV dword ptr [EBX + 0x7c],0x0
0080d2d0 : JMP 0x0080d2da
0080d2d2 : TEST EDX,EDX
0080d2d4 : JGE 0x0080d2da
0080d2d6 : DEC ESI
0080d2d7 : MOV dword ptr [EBX + 0x7c],ESI
0080d2da : MOV EAX,[0x00da9894]
0080d2df : MOV EAX,dword ptr [EAX]
0080d2e1 : TEST EAX,EAX
0080d2e3 : JZ 0x0080d30d
0080d2e5 : CMP dword ptr [EAX + 0x114],0x0
0080d2ec : JZ 0x0080d30d
0080d2ee : MOV EDX,dword ptr [EBX + 0x7c]
0080d2f1 : MOV EAX,dword ptr [EAX + 0x114]
0080d2f7 : MOV ECX,dword ptr [EAX]
0080d2f9 : PUSH EDX
0080d2fa : PUSH 0xc2daf4
0080d2ff : PUSH 0xc2daf8
0080d304 : PUSH EAX
0080d305 : MOV EAX,dword ptr [ECX + 0x4]
0080d308 : CALL EAX
0080d30a : ADD ESP,0x10
0080d30d : MOV ECX,dword ptr [EBX + 0x7c]
0080d310 : MOV EDX,dword ptr [EDI + ECX*0x4]
0080d313 : MOVZX EAX,word ptr [EDX + 0x6]
0080d317 : MOV ECX,dword ptr [EBX + 0x38]
0080d31a : MOV word ptr [ECX + 0x169a],AX
0080d321 : LEA EAX,[EBP + -0x2c]
0080d324 : PUSH EAX
0080d325 : CALL 0x0042d2e0
0080d32a : MOV dword ptr [EBP + -0x4],0xffffffff
0080d331 : MOV ECX,dword ptr [EBP + -0x28]
0080d334 : XOR ESI,ESI
0080d336 : CMP ECX,ESI
0080d338 : JZ 0x0080d33f
0080d33a : CALL 0x006f04e0
0080d33f : MOV dword ptr [EBP + -0x28],ESI
0080d342 : MOV dword ptr [EBP + -0x24],ESI
0080d345 : MOV dword ptr [EBP + -0x20],ESI
0080d348 : MOV ECX,dword ptr [EBP + -0xc]
0080d34b : MOV dword ptr FS:[0x0],ECX
0080d352 : POP ECX
0080d353 : POP EDI
0080d354 : POP ESI
0080d355 : POP EBX
0080d356 : MOV ESP,EBP
0080d358 : POP EBP
0080d359 : RET 0x4
