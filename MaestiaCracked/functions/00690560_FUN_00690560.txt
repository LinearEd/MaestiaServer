PROGRAM  : Maestia.exe
FUNCTION : FUN_00690560
ENTRY    : 00690560
BODY     : [[00690560, 006907ac] [006907b0, 00690840]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00690560(int param_1,int param_2,int *param_3,int param_4)

{
  uint *puVar1;
  undefined1 uVar2;
  int in_EAX;
  size_t _Size;
  undefined4 uVar3;
  undefined1 *puVar4;
  size_t sVar5;
  int iVar6;
  int iVar7;
  void *_Src;
  void *pvVar8;
  size_t local_6c;
  int local_68;
  int local_64;
  undefined4 local_60;
  uint local_5c;
  uint local_58;
  size_t local_54;
  uint local_50;
  uint local_4c;
  int local_48;
  int local_44;
  uint local_40;
  uint local_3c;
  uint local_38;
  uint local_34;
  int *local_30;
  int local_2c;
  undefined4 local_28;
  
  local_5c = (uint)(in_EAX == 3);
  local_58 = (uint)(in_EAX == 4);
  if (*(int *)(param_2 + 0x48) != *(int *)(param_1 + 0x18)) {
    return 6;
  }
  if (in_EAX != param_4) {
    return 0x13;
  }
  if (param_3 != (int *)0x0) {
    FUN_00687400(param_2 + 0x6c,*param_3,param_3[1]);
  }
  FUN_00687370(param_2 + 0x6c,&local_40);
  local_38 = local_38 + 0x3f & 0xffffffc0;
  local_40 = local_40 & 0xffffffc0;
  _Size = (int)(local_38 - local_40) >> 6;
  local_60 = *(undefined4 *)(param_1 + 8);
  local_34 = local_34 + 0x3f & 0xffffffc0;
  local_3c = local_3c & 0xffffffc0;
  iVar7 = (int)(local_34 - local_3c) >> 6;
  local_64 = iVar7;
  local_54 = _Size;
  if ((*(byte *)(*(int *)(param_2 + 0x9c) + 4) & 1) != 0) {
    FUN_00687f30(local_60,*(undefined4 *)(param_2 + 0x58));
    *(undefined4 *)(param_2 + 0x58) = 0;
    puVar1 = (uint *)(*(int *)(param_2 + 0x9c) + 4);
    *puVar1 = *puVar1 & 0xfffffffe;
  }
  local_6c = _Size;
  if (local_5c != 0) {
    local_6c = _Size * 3;
    _Size = local_6c + 3 & 0xfffffffc;
  }
  if (local_58 != 0) {
    iVar7 = iVar7 * 3;
  }
  local_48 = (int)local_40 >> 6;
  local_44 = (int)local_34 >> 6;
  *(undefined1 *)(param_2 + 0x5e) = 2;
  *(undefined2 *)(param_2 + 0x5c) = 0x100;
  *(size_t *)(param_2 + 0x50) = local_6c;
  *(int *)(param_2 + 0x4c) = iVar7;
  *(size_t *)(param_2 + 0x54) = _Size;
  local_50 = local_3c;
  local_4c = local_40;
  FUN_00687400(param_2 + 0x6c,-local_40,-local_3c);
  uVar3 = FUN_00688c00(local_60,_Size * iVar7,&local_68);
  *(undefined4 *)(param_2 + 0x58) = uVar3;
  if (local_68 == 0) {
    puVar1 = (uint *)(*(int *)(param_2 + 0x9c) + 4);
    *puVar1 = *puVar1 | 1;
    local_28 = 1;
    local_30 = (int *)(param_2 + 0x4c);
    local_2c = param_2 + 0x6c;
    local_68 = (**(code **)(param_1 + 0x40))(*(undefined4 *)(param_1 + 0x3c),&local_30);
    if (local_5c != 0) {
      param_1 = local_64;
      if (local_64 != 0) {
        iVar6 = *(int *)(param_2 + 0x58) + -1;
        do {
          if (local_54 != 0) {
            puVar4 = (undefined1 *)((local_6c - 1) + iVar6);
            sVar5 = local_54;
            do {
              uVar2 = *(undefined1 *)(iVar6 + sVar5);
              puVar4[-1] = uVar2;
              *puVar4 = uVar2;
              puVar4[1] = uVar2;
              puVar4 = puVar4 + -3;
              sVar5 = sVar5 - 1;
            } while (sVar5 != 0);
          }
          param_1 = param_1 + -1;
          iVar6 = iVar6 + _Size;
        } while (param_1 != 0);
      }
    }
    if (local_58 != 0) {
      pvVar8 = *(void **)(param_2 + 0x58);
      _Src = (void *)((iVar7 - local_64) * _Size + (int)pvVar8);
      for (iVar7 = local_64; iVar7 != 0; iVar7 = iVar7 + -1) {
        _memcpy(pvVar8,_Src,_Size);
        _memcpy((void *)((int)pvVar8 + _Size),_Src,_Size);
        pvVar8 = (void *)((int)((int)pvVar8 + _Size) + _Size);
        _memcpy(pvVar8,_Src,_Size);
        pvVar8 = (void *)((int)pvVar8 + _Size);
        _Src = (void *)((int)_Src + _Size);
      }
    }
    FUN_00687400(param_2 + 0x6c,local_4c,local_50);
    if (local_68 == 0) {
      *(undefined4 *)(param_2 + 0x48) = 0x62697473;
      *(int *)(param_2 + 100) = local_48;
      *(int *)(param_2 + 0x68) = local_44;
    }
  }
  if ((param_2 + 0x6c != 0) && (param_3 != (int *)0x0)) {
    FUN_00687400(param_2 + 0x6c,-*param_3,-param_3[1]);
  }
  return local_68;
}



============================================================
DISASSEMBLY
============================================================
00690560 : SUB ESP,0x6c
00690563 : XOR ECX,ECX
00690565 : CMP EAX,0x3
00690568 : SETZ CL
0069056b : XOR EDX,EDX
0069056d : CMP EAX,0x4
00690570 : SETZ DL
00690573 : PUSH EBP
00690574 : MOV EBP,dword ptr [ESP + 0x78]
00690578 : MOV dword ptr [ESP + 0x14],ECX
0069057c : MOV ECX,dword ptr [EBP + 0x48]
0069057f : MOV dword ptr [ESP + 0x18],EDX
00690583 : MOV EDX,dword ptr [ESP + 0x74]
00690587 : CMP ECX,dword ptr [EDX + 0x18]
0069058a : JZ 0x00690596
0069058c : MOV EAX,0x6
00690591 : POP EBP
00690592 : ADD ESP,0x6c
00690595 : RET
00690596 : CMP EAX,dword ptr [ESP + 0x80]
0069059d : JZ 0x006905a9
0069059f : MOV EAX,0x13
006905a4 : POP EBP
006905a5 : ADD ESP,0x6c
006905a8 : RET
006905a9 : MOV EAX,dword ptr [ESP + 0x7c]
006905ad : PUSH EBX
006905ae : PUSH ESI
006905af : PUSH EDI
006905b0 : LEA ESI,[EBP + 0x6c]
006905b3 : TEST EAX,EAX
006905b5 : JZ 0x006905c7
006905b7 : MOV ECX,dword ptr [EAX + 0x4]
006905ba : MOV EDX,dword ptr [EAX]
006905bc : PUSH ECX
006905bd : PUSH EDX
006905be : PUSH ESI
006905bf : CALL 0x00687400
006905c4 : ADD ESP,0xc
006905c7 : LEA EAX,[ESP + 0x3c]
006905cb : PUSH EAX
006905cc : PUSH ESI
006905cd : CALL 0x00687370
006905d2 : MOV EAX,dword ptr [ESP + 0x4c]
006905d6 : MOV EDX,dword ptr [ESP + 0x44]
006905da : MOV ECX,dword ptr [ESP + 0x50]
006905de : MOV EBX,dword ptr [ESP + 0x48]
006905e2 : ADD EAX,0x3f
006905e5 : AND EAX,0xffffffc0
006905e8 : MOV dword ptr [ESP + 0x4c],EAX
006905ec : AND EDX,0xffffffc0
006905ef : SUB EAX,EDX
006905f1 : SAR EAX,0x6
006905f4 : MOV dword ptr [ESP + 0x18],EAX
006905f8 : MOV EAX,dword ptr [ESP + 0x88]
006905ff : MOV EAX,dword ptr [EAX + 0x8]
00690602 : ADD ECX,0x3f
00690605 : AND ECX,0xffffffc0
00690608 : AND EBX,0xffffffc0
0069060b : MOV dword ptr [ESP + 0x24],EAX
0069060f : MOV EAX,dword ptr [ESP + 0x18]
00690613 : MOV ESI,ECX
00690615 : SUB ESI,EBX
00690617 : MOV dword ptr [ESP + 0x30],EAX
0069061b : MOV EAX,dword ptr [EBP + 0x9c]
00690621 : SAR ESI,0x6
00690624 : ADD ESP,0x8
00690627 : MOV dword ptr [ESP + 0x3c],EDX
0069062b : MOV dword ptr [ESP + 0x40],EBX
0069062f : MOV dword ptr [ESP + 0x48],ECX
00690633 : TEST byte ptr [EAX + 0x4],0x1
00690637 : LEA EDI,[EBP + 0x4c]
0069063a : MOV dword ptr [ESP + 0x18],ESI
0069063e : JZ 0x0069066e
00690640 : MOV ECX,dword ptr [EDI + 0xc]
00690643 : MOV EDX,dword ptr [ESP + 0x1c]
00690647 : PUSH ECX
00690648 : PUSH EDX
00690649 : CALL 0x00687f30
0069064e : MOV dword ptr [EDI + 0xc],0x0
00690655 : MOV EBP,dword ptr [EBP + 0x9c]
0069065b : ADD ESP,0x8
0069065e : AND dword ptr [EBP + 0x4],0xfffffffe
00690662 : MOV ECX,dword ptr [ESP + 0x48]
00690666 : MOV EBX,dword ptr [ESP + 0x40]
0069066a : MOV EDX,dword ptr [ESP + 0x3c]
0069066e : CMP dword ptr [ESP + 0x20],0x0
00690673 : MOV EBP,dword ptr [ESP + 0x10]
00690677 : JZ 0x00690688
00690679 : MOV EAX,EBP
0069067b : LEA EBP,[EAX + EAX*0x2]
0069067e : MOV dword ptr [ESP + 0x10],EBP
00690682 : ADD EBP,0x3
00690685 : AND EBP,0xfffffffc
00690688 : CMP dword ptr [ESP + 0x24],0x0
0069068d : JZ 0x00690692
0069068f : LEA ESI,[ESI + ESI*0x2]
00690692 : MOV dword ptr [ESP + 0x2c],EBX
00690696 : NEG EBX
00690698 : MOV EAX,EDX
0069069a : PUSH EBX
0069069b : MOV EBX,dword ptr [ESP + 0x88]
006906a2 : MOV dword ptr [ESP + 0x34],EDX
006906a6 : SAR EAX,0x6
006906a9 : SAR ECX,0x6
006906ac : NEG EDX
006906ae : MOV dword ptr [ESP + 0x38],EAX
006906b2 : MOV dword ptr [ESP + 0x3c],ECX
006906b6 : MOV ECX,dword ptr [ESP + 0x14]
006906ba : PUSH EDX
006906bb : MOV EAX,0x100
006906c0 : ADD EBX,0x6c
006906c3 : PUSH EBX
006906c4 : MOV byte ptr [EDI + 0x12],0x2
006906c8 : MOV word ptr [EDI + 0x10],AX
006906cc : MOV dword ptr [EDI + 0x4],ECX
006906cf : MOV dword ptr [EDI],ESI
006906d1 : MOV dword ptr [EDI + 0x8],EBP
006906d4 : CALL 0x00687400
006906d9 : MOV ECX,dword ptr [ESP + 0x28]
006906dd : MOV EAX,EBP
006906df : IMUL EAX,ESI
006906e2 : LEA EDX,[ESP + 0x20]
006906e6 : PUSH EDX
006906e7 : PUSH EAX
006906e8 : PUSH ECX
006906e9 : CALL 0x00688c00
006906ee : MOV dword ptr [EDI + 0xc],EAX
006906f1 : MOV EAX,dword ptr [ESP + 0x2c]
006906f5 : ADD ESP,0x18
006906f8 : TEST EAX,EAX
006906fa : JNZ 0x00690812
00690700 : MOV EDX,dword ptr [ESP + 0x84]
00690707 : MOV EAX,dword ptr [EDX + 0x9c]
0069070d : MOV ECX,0x1
00690712 : OR dword ptr [EAX + 0x4],ECX
00690715 : LEA EAX,[ESP + 0x4c]
00690719 : PUSH EAX
0069071a : MOV EAX,dword ptr [ESP + 0x84]
00690721 : MOV EDX,dword ptr [EAX + 0x40]
00690724 : MOV dword ptr [ESP + 0x58],ECX
00690728 : MOV ECX,dword ptr [EAX + 0x3c]
0069072b : PUSH ECX
0069072c : MOV dword ptr [ESP + 0x54],EDI
00690730 : MOV dword ptr [ESP + 0x58],EBX
00690734 : CALL EDX
00690736 : ADD ESP,0x8
00690739 : CMP dword ptr [ESP + 0x20],0x0
0069073e : MOV dword ptr [ESP + 0x14],EAX
00690742 : MOV EAX,dword ptr [ESP + 0x18]
00690746 : JZ 0x00690794
00690748 : MOV EBX,dword ptr [EDI + 0xc]
0069074b : MOV dword ptr [ESP + 0x80],EAX
00690752 : TEST EAX,EAX
00690754 : JBE 0x00690794
00690756 : DEC EBX
00690757 : MOV EDX,dword ptr [ESP + 0x28]
0069075b : TEST EDX,EDX
0069075d : JBE 0x0069077f
0069075f : MOV EAX,dword ptr [ESP + 0x10]
00690763 : LEA EAX,[EAX + EBX*0x1 + -0x1]
00690767 : MOVZX ECX,byte ptr [EBX + EDX*0x1]
0069076b : MOV byte ptr [EAX + -0x1],CL
0069076e : MOV byte ptr [EAX],CL
00690770 : MOV byte ptr [EAX + 0x1],CL
00690773 : SUB EAX,0x3
00690776 : SUB EDX,0x1
00690779 : JNZ 0x00690767
0069077b : MOV EAX,dword ptr [ESP + 0x18]
0069077f : MOV ECX,dword ptr [ESP + 0x80]
00690786 : DEC ECX
00690787 : ADD EBX,EBP
00690789 : MOV dword ptr [ESP + 0x80],ECX
00690790 : TEST ECX,ECX
00690792 : JA 0x00690757
00690794 : CMP dword ptr [ESP + 0x24],0x0
00690799 : JZ 0x006907d8
0069079b : MOV EDI,dword ptr [EDI + 0xc]
0069079e : SUB ESI,EAX
006907a0 : IMUL ESI,EBP
006907a3 : ADD ESI,EDI
006907a5 : MOV EBX,EAX
006907a7 : TEST EAX,EAX
006907a9 : JBE 0x006907d8
006907ab : JMP 0x006907b0
006907b0 : PUSH EBP
006907b1 : PUSH ESI
006907b2 : PUSH EDI
006907b3 : CALL 0x0063ae40
006907b8 : PUSH EBP
006907b9 : ADD EDI,EBP
006907bb : PUSH ESI
006907bc : PUSH EDI
006907bd : CALL 0x0063ae40
006907c2 : PUSH EBP
006907c3 : ADD EDI,EBP
006907c5 : PUSH ESI
006907c6 : PUSH EDI
006907c7 : CALL 0x0063ae40
006907cc : ADD ESP,0x24
006907cf : ADD EDI,EBP
006907d1 : ADD ESI,EBP
006907d3 : SUB EBX,0x1
006907d6 : JNZ 0x006907b0
006907d8 : MOV ECX,dword ptr [ESP + 0x2c]
006907dc : MOV EDX,dword ptr [ESP + 0x30]
006907e0 : MOV ESI,dword ptr [ESP + 0x84]
006907e7 : PUSH ECX
006907e8 : PUSH EDX
006907e9 : LEA EBX,[ESI + 0x6c]
006907ec : PUSH EBX
006907ed : CALL 0x00687400
006907f2 : MOV EAX,dword ptr [ESP + 0x20]
006907f6 : ADD ESP,0xc
006907f9 : TEST EAX,EAX
006907fb : JNZ 0x00690812
006907fd : MOV ECX,dword ptr [ESP + 0x34]
00690801 : MOV EDX,dword ptr [ESP + 0x38]
00690805 : MOV dword ptr [ESI + 0x48],0x62697473
0069080c : MOV dword ptr [ESI + 0x64],ECX
0069080f : MOV dword ptr [ESI + 0x68],EDX
00690812 : TEST EBX,EBX
00690814 : JZ 0x00690839
00690816 : MOV ECX,dword ptr [ESP + 0x88]
0069081d : TEST ECX,ECX
0069081f : JZ 0x00690839
00690821 : MOV EAX,dword ptr [ECX + 0x4]
00690824 : MOV ECX,dword ptr [ECX]
00690826 : NEG EAX
00690828 : PUSH EAX
00690829 : NEG ECX
0069082b : PUSH ECX
0069082c : PUSH EBX
0069082d : CALL 0x00687400
00690832 : MOV EAX,dword ptr [ESP + 0x20]
00690836 : ADD ESP,0xc
00690839 : POP EDI
0069083a : POP ESI
0069083b : POP EBX
0069083c : POP EBP
0069083d : ADD ESP,0x6c
00690840 : RET
