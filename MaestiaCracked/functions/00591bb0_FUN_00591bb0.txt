PROGRAM  : Maestia.exe
FUNCTION : FUN_00591bb0
ENTRY    : 00591bb0
BODY     : [[00591bb0, 00591df7]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00591bb0(int param_1)

{
  int *piVar1;
  GRect<float> *pGVar2;
  int iVar3;
  float unaff_EDI;
  int *piVar4;
  undefined1 *puVar5;
  int *piStack_78;
  int iStack_74;
  float local_58;
  double local_54;
  undefined4 local_4c;
  GMatrix2D local_48 [4];
  double dStack_44;
  GMatrix2D local_30 [4];
  undefined1 auStack_2c [16];
  undefined1 auStack_1c [4];
  GMatrix2D local_18 [12];
  undefined1 auStack_c [12];
  
  if (*(int **)(param_1 + 8) == (int *)0x0) {
    piVar4 = *(int **)(*(int *)(param_1 + 0x18) + 0x74);
  }
  else {
    iVar3 = (**(code **)(**(int **)(param_1 + 8) + 8))();
    if (iVar3 != 2) {
      return;
    }
    if (*(int *)(param_1 + 8) == 0) {
      return;
    }
    piVar4 = (int *)(*(int *)(param_1 + 8) + -0x68);
  }
  if (piVar4 != (int *)0x0) {
    piVar1 = piVar4;
    if (0 < *(int *)(param_1 + 0x1c)) {
      FUN_00526260();
      piVar1 = (int *)FUN_00525fa0();
    }
    if (piVar1 == (int *)0x0) {
      piVar1 = (int *)0x0;
    }
    else {
      piVar1 = (int *)FUN_0054ed10();
    }
    local_58 = 0.0;
    local_54 = 0.0;
    local_4c = 0;
    GMatrix2D::SetIdentity(local_30);
    if (piVar1 != (int *)0x0) {
      if (piVar1 != piVar4) {
        GMatrix2D::SetIdentity(local_48);
        _iStack_74 = (double)CONCAT44(0x591c58,iStack_74);
        FUN_0051cdf0();
        _iStack_74 = (double)CONCAT44(0x591c66,iStack_74);
        GMatrix2D::SetInverse(local_30,local_48);
        GMatrix2D::SetIdentity(local_48);
        _iStack_74 = (double)CONCAT44(0x591c7b,iStack_74);
        FUN_0051cdf0();
        _iStack_74 = (double)CONCAT44(0x591c89,iStack_74);
        GMatrix2D::Prepend(local_30,local_48);
      }
      GMatrix2D::SetIdentity(local_18);
      _iStack_74 = (double)CONCAT44(local_48,0x591ca5);
      pGVar2 = (GRect<float> *)(**(code **)(*piVar4 + 0x2c))();
      _iStack_74 = (double)CONCAT44((GRect<float> *)&local_58,0x591cb4);
      GMatrix2D::EncloseTransform(local_30,(GRect<float> *)&local_58,pGVar2);
    }
    _iStack_74 = 1.01858683345772e-312;
    iVar3 = FUN_00515840();
    if (iVar3 == 0) {
      iVar3 = 0;
    }
    else {
      _iStack_74 = (double)CONCAT44(0x591cd8,iStack_74);
      iVar3 = FUN_00551210();
    }
    piVar1 = (int *)(*(int *)(param_1 + 0x18) + 0x78);
    piVar4 = (int *)(iVar3 + 0x10);
    _iStack_74 = (double)CONCAT44(local_48,*(int *)(*(int *)(param_1 + 0x18) + 0x78) + 500);
    local_48[0] = (GMatrix2D)0x3;
    dStack_44 = (double)(local_58 / 20.0);
    piStack_78 = piVar1;
    (**(code **)(*(int *)(iVar3 + 0x10) + 0x28))();
    FUN_00526bc0();
    puVar5 = auStack_c;
    local_58 = (float)CONCAT31(local_58._1_3_,3);
    auStack_c[0] = 0;
    local_54 = (double)(unaff_EDI / 20.0);
    (**(code **)(*piVar4 + 0x28))(piVar1,*piVar1 + 0x1f8,&local_58,puVar5);
    FUN_00526bc0();
    auStack_1c[0] = 0;
    (**(code **)(*piVar4 + 0x28))(piVar1,*piVar1 + 0x1fc,&stack0xffffff98,auStack_1c);
    FUN_00526bc0();
    piStack_78 = (int *)CONCAT31(piStack_78._1_3_,3);
    auStack_2c[0] = 0;
    _iStack_74 = (double)((float)puVar5 / 20.0);
    (**(code **)(*piVar4 + 0x28))(piVar1,*piVar1 + 0x200,&piStack_78,auStack_2c);
    FUN_00526bc0();
    FUN_005271c0(iVar3);
    FUN_00503db0();
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00591bb0 : SUB ESP,0x58
00591bb3 : PUSH EBP
00591bb4 : MOV EBP,dword ptr [ESP + 0x60]
00591bb8 : MOV ECX,dword ptr [EBP + 0x8]
00591bbb : PUSH EDI
00591bbc : TEST ECX,ECX
00591bbe : JNZ 0x00591bc8
00591bc0 : MOV EAX,dword ptr [EBP + 0x18]
00591bc3 : MOV EDI,dword ptr [EAX + 0x74]
00591bc6 : JMP 0x00591be6
00591bc8 : MOV EDX,dword ptr [ECX]
00591bca : MOV EAX,dword ptr [EDX + 0x8]
00591bcd : CALL EAX
00591bcf : CMP EAX,0x2
00591bd2 : JNZ 0x00591df2
00591bd8 : MOV EAX,dword ptr [EBP + 0x8]
00591bdb : TEST EAX,EAX
00591bdd : JZ 0x00591df2
00591be3 : LEA EDI,[EAX + -0x68]
00591be6 : TEST EDI,EDI
00591be8 : JZ 0x00591df2
00591bee : CMP dword ptr [EBP + 0x1c],0x0
00591bf2 : JLE 0x00591c0a
00591bf4 : MOV ECX,dword ptr [EBP + 0x18]
00591bf7 : PUSH ECX
00591bf8 : PUSH 0x0
00591bfa : MOV ECX,EBP
00591bfc : CALL 0x00526260
00591c01 : MOV ECX,EAX
00591c03 : CALL 0x00525fa0
00591c08 : JMP 0x00591c0c
00591c0a : MOV EAX,EDI
00591c0c : PUSH EBX
00591c0d : PUSH ESI
00591c0e : TEST EAX,EAX
00591c10 : JZ 0x00591c1e
00591c12 : LEA ECX,[EAX + 0x68]
00591c15 : CALL 0x0054ed10
00591c1a : MOV ESI,EAX
00591c1c : JMP 0x00591c20
00591c1e : XOR ESI,ESI
00591c20 : FLDZ
00591c22 : LEA ECX,[ESP + 0x38]
00591c26 : FST float ptr [ESP + 0x10]
00591c2a : FST float ptr [ESP + 0x14]
00591c2e : FST float ptr [ESP + 0x18]
00591c32 : FSTP float ptr [ESP + 0x1c]
00591c36 : CALL 0x00522b80
00591c3b : TEST ESI,ESI
00591c3d : JZ 0x00591cb4
00591c3f : CMP ESI,EDI
00591c41 : JZ 0x00591c89
00591c43 : LEA ECX,[ESP + 0x20]
00591c47 : CALL 0x00522b80
00591c4c : LEA EDX,[ESP + 0x20]
00591c50 : PUSH EDX
00591c51 : MOV ECX,ESI
00591c53 : CALL 0x0051cdf0
00591c58 : LEA EAX,[ESP + 0x20]
00591c5c : PUSH EAX
00591c5d : LEA ECX,[ESP + 0x3c]
00591c61 : CALL 0x00522cb0
00591c66 : LEA ECX,[ESP + 0x20]
00591c6a : CALL 0x00522b80
00591c6f : LEA ECX,[ESP + 0x20]
00591c73 : PUSH ECX
00591c74 : MOV ECX,EDI
00591c76 : CALL 0x0051cdf0
00591c7b : LEA EDX,[ESP + 0x20]
00591c7f : PUSH EDX
00591c80 : LEA ECX,[ESP + 0x3c]
00591c84 : CALL 0x00522e20
00591c89 : LEA ECX,[ESP + 0x50]
00591c8d : CALL 0x00522b80
00591c92 : MOV EAX,dword ptr [EDI]
00591c94 : MOV EAX,dword ptr [EAX + 0x2c]
00591c97 : LEA ECX,[ESP + 0x50]
00591c9b : PUSH ECX
00591c9c : LEA EDX,[ESP + 0x24]
00591ca0 : PUSH EDX
00591ca1 : MOV ECX,EDI
00591ca3 : CALL EAX
00591ca5 : PUSH EAX
00591ca6 : LEA ECX,[ESP + 0x14]
00591caa : PUSH ECX
00591cab : LEA ECX,[ESP + 0x40]
00591caf : CALL 0x005231d0
00591cb4 : MOV EDX,dword ptr [EBP + 0x18]
00591cb7 : MOV EAX,dword ptr [EDX + 0x78]
00591cba : MOV ECX,dword ptr [EAX + 0x288]
00591cc0 : PUSH 0x0
00591cc2 : PUSH 0x30
00591cc4 : CALL 0x00515840
00591cc9 : TEST EAX,EAX
00591ccb : JZ 0x00591cdc
00591ccd : MOV ECX,dword ptr [EBP + 0x18]
00591cd0 : PUSH ECX
00591cd1 : MOV ECX,EAX
00591cd3 : CALL 0x00551210
00591cd8 : MOV EBX,EAX
00591cda : JMP 0x00591cde
00591cdc : XOR EBX,EBX
00591cde : FLD float ptr [ESP + 0x10]
00591ce2 : MOV ESI,dword ptr [EBP + 0x18]
00591ce5 : FDIV double ptr [0x00b86058]
00591ceb : MOV EDX,dword ptr [EBX + 0x10]
00591cee : MOV EDX,dword ptr [EDX + 0x28]
00591cf1 : LEA EAX,[ESP + 0x6c]
00591cf5 : PUSH EAX
00591cf6 : MOV EAX,dword ptr [ESI + 0x78]
00591cf9 : ADD ESI,0x78
00591cfc : LEA ECX,[ESP + 0x24]
00591d00 : PUSH ECX
00591d01 : LEA EDI,[EBX + 0x10]
00591d04 : ADD EAX,0x1f4
00591d09 : PUSH EAX
00591d0a : PUSH ESI
00591d0b : MOV ECX,EDI
00591d0d : MOV byte ptr [ESP + 0x30],0x3
00591d12 : MOV byte ptr [ESP + 0x7c],0x0
00591d17 : FSTP double ptr [ESP + 0x34]
00591d1b : CALL EDX
00591d1d : LEA ECX,[ESP + 0x20]
00591d21 : CALL 0x00526bc0
00591d26 : FLD float ptr [ESP + 0x18]
00591d2a : FDIV double ptr [0x00b86058]
00591d30 : MOV EAX,dword ptr [EDI]
00591d32 : LEA ECX,[ESP + 0x6c]
00591d36 : PUSH ECX
00591d37 : MOV ECX,dword ptr [ESI]
00591d39 : LEA EDX,[ESP + 0x24]
00591d3d : PUSH EDX
00591d3e : MOV EDX,dword ptr [EAX + 0x28]
00591d41 : ADD ECX,0x1f8
00591d47 : PUSH ECX
00591d48 : PUSH ESI
00591d49 : MOV ECX,EDI
00591d4b : MOV byte ptr [ESP + 0x30],0x3
00591d50 : MOV byte ptr [ESP + 0x7c],0x0
00591d55 : FSTP double ptr [ESP + 0x34]
00591d59 : CALL EDX
00591d5b : LEA ECX,[ESP + 0x20]
00591d5f : CALL 0x00526bc0
00591d64 : FLD float ptr [ESP + 0x14]
00591d68 : FDIV double ptr [0x00b86058]
00591d6e : MOV EAX,dword ptr [EDI]
00591d70 : LEA ECX,[ESP + 0x6c]
00591d74 : PUSH ECX
00591d75 : MOV ECX,dword ptr [ESI]
00591d77 : LEA EDX,[ESP + 0x24]
00591d7b : PUSH EDX
00591d7c : MOV EDX,dword ptr [EAX + 0x28]
00591d7f : ADD ECX,0x1fc
00591d85 : PUSH ECX
00591d86 : PUSH ESI
00591d87 : MOV ECX,EDI
00591d89 : MOV byte ptr [ESP + 0x30],0x3
00591d8e : MOV byte ptr [ESP + 0x7c],0x0
00591d93 : FSTP double ptr [ESP + 0x34]
00591d97 : CALL EDX
00591d99 : LEA ECX,[ESP + 0x20]
00591d9d : CALL 0x00526bc0
00591da2 : FLD float ptr [ESP + 0x1c]
00591da6 : FDIV double ptr [0x00b86058]
00591dac : MOV EAX,dword ptr [EDI]
00591dae : LEA ECX,[ESP + 0x6c]
00591db2 : PUSH ECX
00591db3 : MOV ECX,dword ptr [ESI]
00591db5 : LEA EDX,[ESP + 0x24]
00591db9 : PUSH EDX
00591dba : MOV EDX,dword ptr [EAX + 0x28]
00591dbd : ADD ECX,0x200
00591dc3 : PUSH ECX
00591dc4 : PUSH ESI
00591dc5 : MOV ECX,EDI
00591dc7 : MOV byte ptr [ESP + 0x30],0x3
00591dcc : MOV byte ptr [ESP + 0x7c],0x0
00591dd1 : FSTP double ptr [ESP + 0x34]
00591dd5 : CALL EDX
00591dd7 : LEA ECX,[ESP + 0x20]
00591ddb : CALL 0x00526bc0
00591de0 : MOV ECX,dword ptr [EBP + 0x4]
00591de3 : PUSH EBX
00591de4 : CALL 0x005271c0
00591de9 : MOV ECX,EBX
00591deb : CALL 0x00503db0
00591df0 : POP ESI
00591df1 : POP EBX
00591df2 : POP EDI
00591df3 : POP EBP
00591df4 : ADD ESP,0x58
00591df7 : RET
