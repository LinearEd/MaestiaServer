PROGRAM  : Maestia.exe
FUNCTION : FUN_008811a0
ENTRY    : 008811a0
BODY     : [[008811a0, 00881282] [00881289, 008813c0]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008811a0(int param_1,char param_2)

{
  int *piVar1;
  int iVar2;
  rsize_t _DstSize;
  uint uVar3;
  int iVar4;
  DWORD DVar5;
  int *_Dst;
  int unaff_EDI;
  int local_3c [2];
  int local_34;
  int iStack_30;
  LPCRITICAL_SECTION local_2c;
  char *local_28;
  undefined4 local_24;
  int local_20;
  undefined4 local_1c;
  void *local_14;
  undefined1 *puStack_10;
  undefined4 local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b5f66a;
  local_14 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xffffffb8;
  ExceptionList = &local_14;
  local_2c = (LPCRITICAL_SECTION)(unaff_EDI + 0x38);
  local_20 = 0;
  local_28 = ".\\Objects\\AvaCharStatus.cpp";
  local_24 = 0x208;
  local_1c = 1;
  FUN_006ef1a0(&local_2c);
  local_c = 0;
  if ((*(int *)(unaff_EDI + 0x18) - *(int *)(unaff_EDI + 0x14) & 0xfffffffcU) == 0) {
    local_c = 0xffffffff;
    if (local_20 != 0) {
      LeaveCriticalSection(local_2c);
      ExceptionList = local_14;
      return;
    }
  }
  else {
    for (_Dst = *(int **)(unaff_EDI + 0x14); _Dst != *(int **)(unaff_EDI + 0x18); _Dst = _Dst + 1) {
      piVar1 = (int *)*_Dst;
      if ((piVar1[4] == param_1) && ((char)piVar1[2] == param_2)) {
        local_3c[0] = piVar1[1];
        local_34 = piVar1[3];
        iVar2 = *piVar1;
        if (piVar1 != (int *)0x0) {
                    /* WARNING: Subroutine does not return */
          FUN_006f04e0(uVar3);
        }
        iVar4 = *(int *)(unaff_EDI + 0x18) - (int)(_Dst + 1) >> 2;
        if (0 < iVar4) {
          _DstSize = iVar4 * 4;
          _memmove_s(_Dst,_DstSize,_Dst + 1,_DstSize);
        }
        *(int *)(unaff_EDI + 0x18) = *(int *)(unaff_EDI + 0x18) + -4;
        if ((iVar2 != 0) || (local_3c[0] != 0)) {
          local_c = 0xffffffff;
          if (local_20 != 0) {
            LeaveCriticalSection(local_2c);
            local_20 = 0;
          }
          iVar4 = FUN_00880fc0(iVar2,local_3c[0]);
          if (iVar4 == 0) {
            ExceptionList = local_14;
            return;
          }
          *(int *)(iVar4 + 0xc) = local_34;
          DVar5 = timeGetTime();
          *(DWORD *)(iVar4 + 0x18) = DVar5;
          (**(code **)(**(int **)(unaff_EDI + 0x2c) + 0x310))(iVar4,0);
          if ((*(int *)(iVar4 + 0xc) == 0) && (*(char *)(iVar4 + 0x12) != '\0')) {
            ExceptionList = local_14;
            return;
          }
          local_2c = (LPCRITICAL_SECTION)(unaff_EDI + 0x38);
          local_20 = 0;
          local_28 = ".\\Objects\\AvaCharStatus.cpp";
          local_24 = 0x22b;
          local_1c = 1;
          FUN_006ef1a0(&local_2c);
          local_c = 1;
          local_34 = iVar2;
          iStack_30 = iVar4;
          FUN_00451f10(local_3c,&local_34);
          if (local_20 == 0) {
            ExceptionList = local_14;
            return;
          }
          goto LAB_0088139f;
        }
        break;
      }
    }
    if (local_20 != 0) {
LAB_0088139f:
      local_c = 0xffffffff;
      LeaveCriticalSection(local_2c);
    }
  }
  ExceptionList = local_14;
  return;
}



============================================================
DISASSEMBLY
============================================================
008811a0 : PUSH EBP
008811a1 : MOV EBP,ESP
008811a3 : AND ESP,0xfffffff8
008811a6 : PUSH -0x1
008811a8 : PUSH 0xb5f66a
008811ad : MOV EAX,FS:[0x0]
008811b3 : PUSH EAX
008811b4 : SUB ESP,0x2c
008811b7 : PUSH EBX
008811b8 : PUSH ESI
008811b9 : MOV EAX,[0x00d66fa0]
008811be : XOR EAX,ESP
008811c0 : PUSH EAX
008811c1 : LEA EAX,[ESP + 0x38]
008811c5 : MOV FS:[0x0],EAX
008811cb : MOV EBX,dword ptr [EBP + 0x8]
008811ce : LEA EAX,[EDI + 0x38]
008811d1 : MOV dword ptr [ESP + 0x20],EAX
008811d5 : LEA EAX,[ESP + 0x20]
008811d9 : XOR ESI,ESI
008811db : PUSH EAX
008811dc : MOV dword ptr [ESP + 0x30],ESI
008811e0 : MOV dword ptr [ESP + 0x28],0xc44900
008811e8 : MOV dword ptr [ESP + 0x2c],0x208
008811f0 : MOV dword ptr [ESP + 0x34],0x1
008811f8 : CALL 0x006ef1a0
008811fd : MOV dword ptr [ESP + 0x40],ESI
00881201 : MOV ECX,dword ptr [EDI + 0x18]
00881204 : SUB ECX,dword ptr [EDI + 0x14]
00881207 : TEST ECX,0xfffffffc
0088120d : JNZ 0x00881244
0088120f : MOV dword ptr [ESP + 0x40],0xffffffff
00881217 : CMP dword ptr [ESP + 0x2c],ESI
0088121b : JZ 0x008813ad
00881221 : MOV EDX,dword ptr [ESP + 0x20]
00881225 : PUSH EDX
00881226 : CALL dword ptr [0x00b8511c]
0088122c : MOV dword ptr [ESP + 0x2c],ESI
00881230 : MOV ECX,dword ptr [ESP + 0x38]
00881234 : MOV dword ptr FS:[0x0],ECX
0088123b : POP ECX
0088123c : POP ESI
0088123d : POP EBX
0088123e : MOV ESP,EBP
00881240 : POP EBP
00881241 : RET 0x8
00881244 : MOV ESI,dword ptr [EDI + 0x14]
00881247 : MOV ECX,dword ptr [EDI + 0x18]
0088124a : CMP ESI,ECX
0088124c : JZ 0x008812b6
0088124e : MOV EDI,EDI
00881250 : MOV EAX,dword ptr [ESI]
00881252 : CMP dword ptr [EAX + 0x10],EBX
00881255 : JNZ 0x0088125f
00881257 : MOV DL,byte ptr [EBP + 0xc]
0088125a : CMP byte ptr [EAX + 0x8],DL
0088125d : JZ 0x00881268
0088125f : ADD ESI,0x4
00881262 : CMP ESI,ECX
00881264 : JNZ 0x00881250
00881266 : JMP 0x008812b6
00881268 : MOV ECX,EAX
0088126a : MOV EAX,dword ptr [ECX + 0x4]
0088126d : MOV EDX,dword ptr [ECX + 0xc]
00881270 : MOV EBX,dword ptr [ECX]
00881272 : MOV dword ptr [ESP + 0x10],EAX
00881276 : MOV dword ptr [ESP + 0x18],EDX
0088127a : TEST ECX,ECX
0088127c : JZ 0x00881289
0088127e : CALL 0x006f04e0
00881289 : MOV EAX,dword ptr [EDI + 0x18]
0088128c : LEA ECX,[ESI + 0x4]
0088128f : SUB EAX,ECX
00881291 : SAR EAX,0x2
00881294 : TEST EAX,EAX
00881296 : JLE 0x008812a8
00881298 : ADD EAX,EAX
0088129a : ADD EAX,EAX
0088129c : PUSH EAX
0088129d : PUSH ECX
0088129e : PUSH EAX
0088129f : PUSH ESI
008812a0 : CALL 0x00634101
008812a5 : ADD ESP,0x10
008812a8 : ADD dword ptr [EDI + 0x18],-0x4
008812ac : TEST EBX,EBX
008812ae : JNZ 0x008812d3
008812b0 : CMP dword ptr [ESP + 0x10],EBX
008812b4 : JNZ 0x008812d3
008812b6 : MOV dword ptr [ESP + 0x40],0xffffffff
008812be : CMP dword ptr [ESP + 0x2c],0x0
008812c3 : JZ 0x008813ad
008812c9 : MOV EAX,dword ptr [ESP + 0x20]
008812cd : PUSH EAX
008812ce : JMP 0x0088139f
008812d3 : MOV dword ptr [ESP + 0x40],0xffffffff
008812db : CMP dword ptr [ESP + 0x2c],0x0
008812e0 : JZ 0x008812f5
008812e2 : MOV ECX,dword ptr [ESP + 0x20]
008812e6 : PUSH ECX
008812e7 : CALL dword ptr [0x00b8511c]
008812ed : MOV dword ptr [ESP + 0x2c],0x0
008812f5 : MOV EDX,dword ptr [ESP + 0x10]
008812f9 : PUSH EDX
008812fa : PUSH EBX
008812fb : MOV ECX,EDI
008812fd : CALL 0x00880fc0
00881302 : MOV ESI,EAX
00881304 : TEST ESI,ESI
00881306 : JZ 0x008813ad
0088130c : MOV EAX,dword ptr [ESP + 0x18]
00881310 : MOV dword ptr [ESI + 0xc],EAX
00881313 : CALL dword ptr [0x00b85598]
00881319 : MOV dword ptr [ESI + 0x18],EAX
0088131c : MOV ECX,dword ptr [EDI + 0x2c]
0088131f : MOV EDX,dword ptr [ECX]
00881321 : MOV EAX,dword ptr [EDX + 0x310]
00881327 : PUSH 0x0
00881329 : PUSH ESI
0088132a : CALL EAX
0088132c : CMP dword ptr [ESI + 0xc],0x0
00881330 : JNZ 0x00881338
00881332 : CMP byte ptr [ESI + 0x12],0x0
00881336 : JNZ 0x008813ad
00881338 : LEA ECX,[ESP + 0x20]
0088133c : LEA EAX,[EDI + 0x38]
0088133f : PUSH ECX
00881340 : MOV dword ptr [ESP + 0x30],0x0
00881348 : MOV dword ptr [ESP + 0x24],EAX
0088134c : MOV dword ptr [ESP + 0x28],0xc4491c
00881354 : MOV dword ptr [ESP + 0x2c],0x22b
0088135c : MOV dword ptr [ESP + 0x34],0x1
00881364 : CALL 0x006ef1a0
00881369 : MOV dword ptr [ESP + 0x40],0x1
00881371 : LEA EDX,[ESP + 0x18]
00881375 : PUSH EDX
00881376 : LEA EAX,[ESP + 0x14]
0088137a : PUSH EAX
0088137b : LEA EAX,[EDI + 0x20]
0088137e : MOV dword ptr [ESP + 0x20],EBX
00881382 : MOV dword ptr [ESP + 0x24],ESI
00881386 : CALL 0x00451f10
0088138b : MOV dword ptr [ESP + 0x40],0xffffffff
00881393 : CMP dword ptr [ESP + 0x2c],0x0
00881398 : JZ 0x008813ad
0088139a : MOV ECX,dword ptr [ESP + 0x20]
0088139e : PUSH ECX
0088139f : CALL dword ptr [0x00b8511c]
008813a5 : MOV dword ptr [ESP + 0x2c],0x0
008813ad : MOV ECX,dword ptr [ESP + 0x38]
008813b1 : MOV dword ptr FS:[0x0],ECX
008813b8 : POP ECX
008813b9 : POP ESI
008813ba : POP EBX
008813bb : MOV ESP,EBP
008813bd : POP EBP
008813be : RET 0x8
