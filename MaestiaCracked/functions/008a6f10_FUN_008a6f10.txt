PROGRAM  : Maestia.exe
FUNCTION : FUN_008a6f10
ENTRY    : 008a6f10
BODY     : [[008a6f10, 008a705c]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008a6f10(int param_1)

{
  char cVar1;
  undefined2 uVar2;
  undefined4 uVar3;
  void *pvVar4;
  uint8_t *packet;
  int iVar5;
  byte bVar6;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  pvVar4 = ExceptionList;
  puStack_c = &LAB_00b3e17f;
  local_10 = ExceptionList;
  iVar5 = *(int *)(*DAT_00da9894 + 0x1c8);
  uVar3 = *(undefined4 *)(iVar5 + 200);
  uVar2 = *(undefined2 *)(iVar5 + 0xdc);
  if (param_1 == 0) {
    if (*DAT_00da9894 == 0) {
      return;
    }
    iVar5 = *(int *)ThreadLocalStoragePointer;
    bVar6 = (byte)((ulonglong)(*(byte *)(iVar5 + 0x18) + 1) % 3);
    ExceptionList = &local_10;
    *(byte *)(iVar5 + 0x18) = bVar6;
    packet = (uint8_t *)((uint)bVar6 * 0x2000 + 0x122cb8 + iVar5);
    if (packet == (uint8_t *)0x0) {
      packet = (uint8_t *)0x0;
    }
    else {
      packet[2] = 'F';
      packet[3] = 'Q';
      packet[4] = '\0';
      packet[5] = '\0';
      packet[6] = '\0';
      packet[7] = '\0';
      *(undefined4 *)(packet + 8) = uVar3;
      *(undefined2 *)(packet + 0xc) = uVar2;
      packet[0] = '\x0e';
      packet[1] = '\0';
    }
    iVar5 = *(int *)(DAT_017247d4 + 4);
    if (iVar5 == 0) {
      ExceptionList = pvVar4;
      return;
    }
    cVar1 = *(char *)(DAT_017247d4 + 8);
  }
  else {
    if (param_1 != 1) {
      return;
    }
    iVar5 = *(int *)ThreadLocalStoragePointer;
    bVar6 = (byte)((ulonglong)(*(byte *)(iVar5 + 0x18) + 1) % 3);
    ExceptionList = &local_10;
    *(byte *)(iVar5 + 0x18) = bVar6;
    packet = (uint8_t *)((uint)bVar6 * 0x2000 + 0x122cb8 + iVar5);
    if (packet == (uint8_t *)0x0) {
      packet = (uint8_t *)0x0;
    }
    else {
      packet[2] = 'F';
      packet[3] = 'Q';
      packet[4] = '\0';
      packet[5] = '\0';
      packet[6] = '\0';
      packet[7] = '\0';
      *(undefined4 *)(packet + 8) = uVar3;
      packet[0xc] = '\0';
      packet[0xd] = '\0';
      packet[0] = '\x0e';
      packet[1] = '\0';
    }
    iVar5 = *(int *)(DAT_017247d4 + 4);
    if (iVar5 == 0) {
      ExceptionList = pvVar4;
      return;
    }
    cVar1 = *(char *)(DAT_017247d4 + 8);
  }
  local_8 = 0xffffffff;
  if (cVar1 != '\0') {
    FUN_00a0dd40(iVar5,0xe,packet);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
008a6f10 : PUSH EBP
008a6f11 : MOV EBP,ESP
008a6f13 : PUSH -0x1
008a6f15 : PUSH 0xb3e17f
008a6f1a : MOV EAX,FS:[0x0]
008a6f20 : PUSH EAX
008a6f21 : PUSH ECX
008a6f22 : PUSH EBX
008a6f23 : PUSH ESI
008a6f24 : PUSH EDI
008a6f25 : MOV EAX,[0x00d66fa0]
008a6f2a : XOR EAX,EBP
008a6f2c : PUSH EAX
008a6f2d : LEA EAX,[EBP + -0xc]
008a6f30 : MOV FS:[0x0],EAX
008a6f36 : MOV EAX,[0x00da9894]
008a6f3b : MOV EAX,dword ptr [EAX]
008a6f3d : MOV ECX,dword ptr [EAX + 0x1c8]
008a6f43 : MOV ESI,dword ptr [ECX + 0xc8]
008a6f49 : MOVZX EDI,word ptr [ECX + 0xdc]
008a6f50 : MOV ECX,dword ptr [EBP + 0x8]
008a6f53 : SUB ECX,0x0
008a6f56 : JZ 0x008a6fd3
008a6f58 : SUB ECX,0x1
008a6f5b : JNZ 0x008a7049
008a6f61 : MOV ECX,dword ptr FS:[0x2c]
008a6f68 : MOV ECX,dword ptr [ECX]
008a6f6a : MOVZX EAX,byte ptr [ECX + 0x18]
008a6f6e : INC EAX
008a6f6f : CDQ
008a6f70 : MOV EDI,0x3
008a6f75 : IDIV EDI
008a6f77 : MOV byte ptr [ECX + 0x18],DL
008a6f7a : MOVZX EDX,DL
008a6f7d : SHL EDX,0xd
008a6f80 : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
008a6f87 : MOV dword ptr [EBP + 0x8],EAX
008a6f8a : MOV dword ptr [EBP + -0x4],0x1
008a6f91 : TEST EAX,EAX
008a6f93 : JZ 0x008a6fb7
008a6f95 : XOR ECX,ECX
008a6f97 : MOV EDX,0xe
008a6f9c : MOV byte ptr [EAX + 0x2],0x46
008a6fa0 : MOV byte ptr [EAX + 0x3],0x51
008a6fa4 : MOV dword ptr [EAX + 0x4],0x0
008a6fab : MOV dword ptr [EAX + 0x8],ESI
008a6fae : MOV word ptr [EAX + 0xc],CX
008a6fb2 : MOV word ptr [EAX],DX
008a6fb5 : JMP 0x008a6fb9
008a6fb7 : XOR EAX,EAX
008a6fb9 : MOV dword ptr [EBP + -0x4],0xffffffff
008a6fc0 : MOV EDX,dword ptr [0x017247d4]
008a6fc6 : MOV ECX,dword ptr [EDX + 0x4]
008a6fc9 : TEST ECX,ECX
008a6fcb : JZ 0x008a7049
008a6fcd : CMP byte ptr [EDX + 0x8],0x0
008a6fd1 : JMP 0x008a703d
008a6fd3 : TEST EAX,EAX
008a6fd5 : JZ 0x008a7049
008a6fd7 : MOV EAX,FS:[0x2c]
008a6fdd : MOV ECX,dword ptr [EAX]
008a6fdf : MOVZX EAX,byte ptr [ECX + 0x18]
008a6fe3 : INC EAX
008a6fe4 : CDQ
008a6fe5 : MOV EBX,0x3
008a6fea : IDIV EBX
008a6fec : MOV byte ptr [ECX + 0x18],DL
008a6fef : MOVZX EDX,DL
008a6ff2 : SHL EDX,0xd
008a6ff5 : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
008a6ffc : MOV dword ptr [EBP + 0x8],EAX
008a6fff : XOR EDX,EDX
008a7001 : MOV dword ptr [EBP + -0x4],EDX
008a7004 : CMP EAX,EDX
008a7006 : JZ 0x008a7024
008a7008 : MOV ECX,0xe
008a700d : MOV byte ptr [EAX + 0x2],0x46
008a7011 : MOV byte ptr [EAX + 0x3],0x51
008a7015 : MOV dword ptr [EAX + 0x4],EDX
008a7018 : MOV dword ptr [EAX + 0x8],ESI
008a701b : MOV word ptr [EAX + 0xc],DI
008a701f : MOV word ptr [EAX],CX
008a7022 : JMP 0x008a7026
008a7024 : XOR EAX,EAX
008a7026 : MOV dword ptr [EBP + -0x4],0xffffffff
008a702d : MOV ESI,dword ptr [0x017247d4]
008a7033 : MOV ECX,dword ptr [ESI + 0x4]
008a7036 : CMP ECX,EDX
008a7038 : JZ 0x008a7049
008a703a : CMP byte ptr [ESI + 0x8],DL
008a703d : JZ 0x008a7049
008a703f : PUSH 0xe
008a7041 : PUSH ECX
008a7042 : MOV EDI,EAX
008a7044 : CALL 0x00a0dd40
008a7049 : MOV ECX,dword ptr [EBP + -0xc]
008a704c : MOV dword ptr FS:[0x0],ECX
008a7053 : POP ECX
008a7054 : POP EDI
008a7055 : POP ESI
008a7056 : POP EBX
008a7057 : MOV ESP,EBP
008a7059 : POP EBP
008a705a : RET 0x8
