PROGRAM  : Maestia.exe
FUNCTION : FUN_005a4ae0
ENTRY    : 005a4ae0
BODY     : [[005a4ae0, 005a4f6b]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005a4ae0(undefined4 param_1,int *param_2,char param_3,char param_4)

{
  int iVar1;
  char cVar2;
  int iVar3;
  undefined4 uVar4;
  undefined4 uVar5;
  GRefCountNTSImpl *this;
  undefined4 uVar6;
  int in_ECX;
  int *piVar7;
  uint uVar8;
  int *piVar9;
  int *unaff_retaddr;
  undefined4 uVar10;
  int *local_88;
  int *piStack_84;
  int *piStack_80;
  int *local_7c;
  int *local_78;
  int *piStack_74;
  int *piStack_70;
  undefined4 uStack_6c;
  int *piStack_68;
  int *piStack_64;
  int *piStack_60;
  int *piStack_5c;
  char cStack_58;
  int *piStack_54;
  int *piStack_50;
  int *piStack_4c;
  int *piStack_48;
  int *piStack_44;
  int *piStack_40;
  undefined4 uStack_3c;
  undefined4 local_38;
  undefined4 uStack_34;
  undefined4 uStack_20;
  int iStack_14;
  int iStack_10;
  
  if (param_2 != (int *)0x0) {
    FUN_00558a00();
    local_88 = (int *)(*(float *)(in_ECX + 0x9c8) * 1024.0);
    piVar7 = (int *)0x0;
    piVar9 = param_2;
    if (param_4 != '\0') {
      iVar3 = FUN_00515840(0x44,0);
      if (iVar3 == 0) {
        local_78 = (int *)0x0;
      }
      else {
        local_78 = (int *)FUN_00559d80(0x3c8);
      }
      local_7c = local_78;
      iVar3 = in_ECX + 0x930;
      (**(code **)(*param_2 + 0x18))(iVar3,0x41200000);
      FUN_005dccb0(0x3f800000,0x447a0000,0,0);
      cVar2 = FUN_005a3270(iVar3);
      if (cVar2 == '\0') {
        local_88 = (int *)-(float)local_88;
      }
      local_88 = (int *)((float)local_88 * 0.5);
      *(int **)(in_ECX + 0x904) = local_88;
      if ((float)local_88 < 0.0) {
        local_88 = (int *)-(float)local_88;
      }
      *(int **)(in_ECX + 0x908) = local_88;
      *(undefined4 *)(in_ECX + 0x90c) = 0;
      FUN_005dd100();
      FUN_005d9050(iVar3,0xffffffff,in_ECX + 0x978,0);
      local_88 = (int *)0x0;
      piVar7 = local_7c;
      piVar9 = local_78;
      if (*(int *)(in_ECX + 0x990) != 0) {
        do {
          piVar7 = local_88;
          iVar1 = *(int *)(*(int *)(in_ECX + 0x99c) + ((uint)local_88 >> 6) * 4);
          iVar3 = iVar1 + ((uint)local_88 & 0x3f) * 0x18;
          if (2 < *(uint *)(iVar1 + 4 + ((uint)local_88 & 0x3f) * 0x18)) {
            FUN_00553650();
            local_38 = 1;
            uStack_34 = 0;
            uVar10 = 0;
            uVar4 = FUN_0063b380(0);
            uVar5 = FUN_0063b380(uVar4);
            FUN_00555690(uVar5,uVar4,uVar10);
            uVar8 = 1;
            if (1 < *(uint *)(iVar3 + 4)) {
              do {
                uVar4 = FUN_0063b380();
                uVar5 = FUN_0063b380(uVar4);
                FUN_00559cb0(uVar5,uVar4);
                uVar8 = uVar8 + 1;
                piVar7 = local_88;
              } while (uVar8 < *(uint *)(iVar3 + 4));
            }
            if (iStack_10 != 0) {
              FUN_005551b0(local_78 + 10,local_78 + 0xd);
            }
          }
          local_88 = (int *)((int)piVar7 + 1);
          piVar7 = local_7c;
          piVar9 = local_78;
        } while (local_88 < *(int **)(in_ECX + 0x990));
      }
    }
    this = (GRefCountNTSImpl *)(**(code **)(*piVar9 + 0x48))();
    cVar2 = (**(code **)(*(int *)this + 4))(&piStack_68);
    piStack_80 = piStack_68;
    piVar9 = piStack_64;
    while (cVar2 != '\0') {
      piStack_68 = piStack_80;
      piStack_64 = piVar9;
      switch(uStack_6c) {
      case 0:
        FUN_00553650();
        local_88 = piStack_80;
        uStack_3c = 1;
        local_38 = 0;
        piStack_84 = piVar9;
        if (param_4 != '\0') {
          GMatrix2D::Transform
                    ((GMatrix2D *)(in_ECX + 0x9cc),(GPoint<float> *)&local_7c,
                     (GPoint<float> *)&local_88);
          local_88 = local_7c;
          piStack_84 = local_78;
        }
        uVar10 = 0;
        uVar4 = FUN_0063b380(0);
        uVar5 = FUN_0063b380(uVar4);
        FUN_00555690(uVar5,uVar4,uVar10);
        break;
      case 1:
      case 2:
        if (iStack_14 != 0) {
          FUN_005551b0(unaff_retaddr + 10,unaff_retaddr + 0xd);
        }
        break;
      case 3:
        if (cStack_58 == '\0') {
          local_88 = piStack_60;
          piStack_84 = piStack_5c;
          if (param_4 != '\0') {
            GMatrix2D::Transform
                      ((GMatrix2D *)(in_ECX + 0x9cc),(GPoint<float> *)&piStack_54,
                       (GPoint<float> *)&local_88);
            local_88 = piStack_54;
            piStack_84 = piStack_50;
          }
          uVar4 = FUN_0063b380();
          uVar5 = FUN_0063b380(uVar4);
          FUN_00559cb0(uVar5,uVar4);
        }
        else {
          local_88 = piStack_80;
          piStack_84 = piVar9;
          piStack_74 = piStack_60;
          piStack_70 = piStack_5c;
          if (param_4 != '\0') {
            GMatrix2D::Transform
                      ((GMatrix2D *)(in_ECX + 0x9cc),(GPoint<float> *)&piStack_44,
                       (GPoint<float> *)&local_88);
            local_88 = piStack_44;
            piStack_84 = piStack_40;
            GMatrix2D::Transform
                      ((GMatrix2D *)(in_ECX + 0x9cc),(GPoint<float> *)&piStack_4c,
                       (GPoint<float> *)&piStack_74);
            piStack_74 = piStack_4c;
            piStack_70 = piStack_48;
          }
          uVar4 = FUN_0063b380();
          uVar5 = FUN_0063b380(uVar4);
          uVar10 = FUN_0063b380(uVar5);
          uVar6 = FUN_0063b380(uVar10);
          FUN_00559cd0(uVar6,uVar10,uVar5,uVar4);
        }
      }
      cVar2 = (**(code **)(*(int *)this + 4))(&uStack_6c);
      piStack_80 = piStack_68;
      piVar9 = piStack_64;
    }
    if ((param_3 != '\0') || (param_4 != '\0')) {
      (**(code **)(*unaff_retaddr + 0x14))(param_2);
    }
    GRefCountNTSImpl::Release(this);
    if (piVar7 != (int *)0x0) {
      FUN_00557b30();
    }
    FUN_00515cf0(uStack_20);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005a4ae0 : SUB ESP,0x88
005a4ae6 : PUSH EBX
005a4ae7 : PUSH EBP
005a4ae8 : PUSH EDI
005a4ae9 : MOV EDI,dword ptr [ESP + 0x9c]
005a4af0 : XOR EBP,EBP
005a4af2 : MOV EBX,ECX
005a4af4 : CMP EDI,EBP
005a4af6 : JZ 0x005a4f60
005a4afc : PUSH ESI
005a4afd : LEA ECX,[ESP + 0x60]
005a4b01 : CALL 0x00558a00
005a4b06 : FLD float ptr [EBX + 0x9c8]
005a4b0c : CMP byte ptr [ESP + 0xa8],0x0
005a4b14 : FMUL double ptr [0x00b8d8c8]
005a4b1a : FSTP float ptr [ESP + 0x10]
005a4b1e : JZ 0x005a4d0f
005a4b24 : MOV ECX,dword ptr [0x00d73250]
005a4b2a : PUSH EBP
005a4b2b : PUSH 0x44
005a4b2d : CALL 0x00515840
005a4b32 : CMP EAX,EBP
005a4b34 : JZ 0x005a4b48
005a4b36 : PUSH 0x3c8
005a4b3b : MOV ECX,EAX
005a4b3d : CALL 0x00559d80
005a4b42 : MOV dword ptr [ESP + 0x20],EAX
005a4b46 : JMP 0x005a4b4c
005a4b48 : MOV dword ptr [ESP + 0x20],EBP
005a4b4c : MOV EAX,dword ptr [ESP + 0x20]
005a4b50 : FLD float ptr [0x00b8f298]
005a4b56 : MOV EDX,dword ptr [EDI]
005a4b58 : PUSH ECX
005a4b59 : FSTP float ptr [ESP]
005a4b5c : MOV dword ptr [ESP + 0x20],EAX
005a4b60 : MOV EAX,dword ptr [EDX + 0x18]
005a4b63 : LEA ESI,[EBX + 0x930]
005a4b69 : PUSH ESI
005a4b6a : MOV ECX,EDI
005a4b6c : CALL EAX
005a4b6e : FLDZ
005a4b70 : SUB ESP,0x10
005a4b73 : FST float ptr [ESP + 0xc]
005a4b77 : FSTP float ptr [ESP + 0x8]
005a4b7b : MOV ECX,ESI
005a4b7d : FLD float ptr [0x00cdf16c]
005a4b83 : FSTP float ptr [ESP + 0x4]
005a4b87 : FLD1
005a4b89 : FSTP float ptr [ESP]
005a4b8c : CALL 0x005dccb0
005a4b91 : PUSH ESI
005a4b92 : MOV ECX,EBX
005a4b94 : CALL 0x005a3270
005a4b99 : FLD float ptr [ESP + 0x10]
005a4b9d : TEST AL,AL
005a4b9f : JNZ 0x005a4ba3
005a4ba1 : FCHS
005a4ba3 : FSTP float ptr [ESP + 0x10]
005a4ba7 : LEA EBP,[EBX + 0x904]
005a4bad : FLD float ptr [ESP + 0x10]
005a4bb1 : FMUL double ptr [0x00cdf120]
005a4bb7 : FSTP float ptr [ESP + 0x10]
005a4bbb : FLD float ptr [ESP + 0x10]
005a4bbf : FST float ptr [EBP]
005a4bc2 : FLDZ
005a4bc4 : FCOMP
005a4bc6 : FNSTSW AX
005a4bc8 : TEST AH,0x41
005a4bcb : JNZ 0x005a4bcf
005a4bcd : FCHS
005a4bcf : FSTP float ptr [ESP + 0x10]
005a4bd3 : LEA EDI,[EBX + 0x978]
005a4bd9 : FLD float ptr [ESP + 0x10]
005a4bdd : MOV ECX,EDI
005a4bdf : FSTP float ptr [EBP + 0x4]
005a4be2 : MOV dword ptr [EBX + 0x90c],0x0
005a4bec : CALL 0x005dd100
005a4bf1 : PUSH 0x0
005a4bf3 : PUSH EDI
005a4bf4 : PUSH -0x1
005a4bf6 : PUSH ESI
005a4bf7 : MOV ECX,EBP
005a4bf9 : CALL 0x005d9050
005a4bfe : XOR EBP,EBP
005a4c00 : MOV dword ptr [ESP + 0x10],EBP
005a4c04 : CMP dword ptr [EBX + 0x990],EBP
005a4c0a : JBE 0x005a4d07
005a4c10 : MOV EDX,dword ptr [EBX + 0x99c]
005a4c16 : MOV ECX,EBP
005a4c18 : MOV EAX,EBP
005a4c1a : SHR ECX,0x6
005a4c1d : MOV ECX,dword ptr [EDX + ECX*0x4]
005a4c20 : AND EAX,0x3f
005a4c23 : LEA EAX,[EAX + EAX*0x2]
005a4c26 : CMP dword ptr [ECX + EAX*0x8 + 0x4],0x2
005a4c2b : LEA ESI,[ECX + EAX*0x8]
005a4c2e : JBE 0x005a4cf6
005a4c34 : MOV EAX,dword ptr [ESI + 0x8]
005a4c37 : MOV ECX,dword ptr [ESI]
005a4c39 : MOV ECX,dword ptr [ECX + 0x14]
005a4c3c : MOV EDX,EAX
005a4c3e : SHR EDX,0x8
005a4c41 : MOV EDX,dword ptr [ECX + EDX*0x4]
005a4c44 : AND EAX,0xff
005a4c49 : LEA ECX,[ESP + 0x60]
005a4c4d : LEA EDI,[EDX + EAX*0x8]
005a4c50 : CALL 0x00553650
005a4c55 : MOV dword ptr [ESP + 0x60],0x1
005a4c5d : MOV dword ptr [ESP + 0x64],0x0
005a4c65 : FLD float ptr [EDI + 0x4]
005a4c68 : FMUL double ptr [0x00b8f290]
005a4c6e : PUSH 0x0
005a4c70 : CALL 0x0063b380
005a4c75 : FLD float ptr [EDI]
005a4c77 : PUSH EAX
005a4c78 : CALL 0x0063b380
005a4c7d : PUSH EAX
005a4c7e : LEA ECX,[ESP + 0x6c]
005a4c82 : CALL 0x00555690
005a4c87 : MOV EDI,0x1
005a4c8c : CMP dword ptr [ESI + 0x4],EDI
005a4c8f : JBE 0x005a4cd7
005a4c91 : MOV EAX,dword ptr [ESI + 0x8]
005a4c94 : MOV EDX,dword ptr [ESI]
005a4c96 : MOV EDX,dword ptr [EDX + 0x14]
005a4c99 : ADD EAX,EDI
005a4c9b : MOV ECX,EAX
005a4c9d : SHR ECX,0x8
005a4ca0 : MOV ECX,dword ptr [EDX + ECX*0x4]
005a4ca3 : AND EAX,0xff
005a4ca8 : FLD float ptr [ECX + EAX*0x8 + 0x4]
005a4cac : LEA EBP,[ECX + EAX*0x8]
005a4caf : FMUL double ptr [0x00b8f290]
005a4cb5 : CALL 0x0063b380
005a4cba : FLD float ptr [EBP]
005a4cbd : PUSH EAX
005a4cbe : CALL 0x0063b380
005a4cc3 : PUSH EAX
005a4cc4 : LEA ECX,[ESP + 0x68]
005a4cc8 : CALL 0x00559cb0
005a4ccd : INC EDI
005a4cce : CMP EDI,dword ptr [ESI + 0x4]
005a4cd1 : JC 0x005a4c91
005a4cd3 : MOV EBP,dword ptr [ESP + 0x10]
005a4cd7 : CMP dword ptr [ESP + 0x88],0x0
005a4cdf : JZ 0x005a4cf6
005a4ce1 : MOV EAX,dword ptr [ESP + 0x20]
005a4ce5 : LEA EDX,[EAX + 0x34]
005a4ce8 : PUSH EDX
005a4ce9 : ADD EAX,0x28
005a4cec : PUSH EAX
005a4ced : LEA ECX,[ESP + 0x68]
005a4cf1 : CALL 0x005551b0
005a4cf6 : INC EBP
005a4cf7 : MOV dword ptr [ESP + 0x10],EBP
005a4cfb : CMP EBP,dword ptr [EBX + 0x990]
005a4d01 : JC 0x005a4c10
005a4d07 : MOV EDI,dword ptr [ESP + 0x20]
005a4d0b : MOV EBP,dword ptr [ESP + 0x1c]
005a4d0f : MOV EAX,dword ptr [EDI]
005a4d11 : MOV EDX,dword ptr [EAX + 0x48]
005a4d14 : MOV ECX,EDI
005a4d16 : CALL EDX
005a4d18 : MOV EDI,EAX
005a4d1a : MOV EAX,dword ptr [EDI]
005a4d1c : MOV EDX,dword ptr [EAX + 0x4]
005a4d1f : LEA ECX,[ESP + 0x30]
005a4d23 : PUSH ECX
005a4d24 : MOV ECX,EDI
005a4d26 : CALL EDX
005a4d28 : TEST AL,AL
005a4d2a : JZ 0x005a4f19
005a4d30 : MOV EAX,dword ptr [ESP + 0x30]
005a4d34 : CMP EAX,0x3
005a4d37 : JA 0x005a4f03
005a4d3d : JMP dword ptr [EAX*0x4 + 0x5a4f6c]
005a4d44 : FLD float ptr [ESP + 0x34]
005a4d48 : LEA ECX,[ESP + 0x60]
005a4d4c : FSTP float ptr [ESP + 0x1c]
005a4d50 : FLD float ptr [ESP + 0x38]
005a4d54 : FSTP float ptr [ESP + 0x10]
005a4d58 : CALL 0x00553650
005a4d5d : CMP byte ptr [ESP + 0xac],0x0
005a4d65 : FLD float ptr [ESP + 0x1c]
005a4d69 : FSTP float ptr [ESP + 0x14]
005a4d6d : MOV dword ptr [ESP + 0x60],0x1
005a4d75 : FLD float ptr [ESP + 0x10]
005a4d79 : MOV dword ptr [ESP + 0x64],0x0
005a4d81 : FSTP float ptr [ESP + 0x18]
005a4d85 : JZ 0x005a4dac
005a4d87 : LEA EAX,[ESP + 0x14]
005a4d8b : PUSH EAX
005a4d8c : LEA ECX,[ESP + 0x24]
005a4d90 : PUSH ECX
005a4d91 : LEA ECX,[EBX + 0x9cc]
005a4d97 : CALL 0x00522c50
005a4d9c : FLD float ptr [ESP + 0x20]
005a4da0 : FSTP float ptr [ESP + 0x14]
005a4da4 : FLD float ptr [ESP + 0x24]
005a4da8 : FSTP float ptr [ESP + 0x18]
005a4dac : FLD float ptr [ESP + 0x18]
005a4db0 : PUSH 0x0
005a4db2 : CALL 0x0063b380
005a4db7 : FLD float ptr [ESP + 0x18]
005a4dbb : PUSH EAX
005a4dbc : CALL 0x0063b380
005a4dc1 : PUSH EAX
005a4dc2 : LEA ECX,[ESP + 0x6c]
005a4dc6 : CALL 0x00555690
005a4dcb : JMP 0x005a4f03
005a4dd0 : CMP byte ptr [ESP + 0x44],0x0
005a4dd5 : JZ 0x005a4e83
005a4ddb : CMP byte ptr [ESP + 0xac],0x0
005a4de3 : FLD float ptr [ESP + 0x34]
005a4de7 : FSTP float ptr [ESP + 0x14]
005a4deb : FLD float ptr [ESP + 0x38]
005a4def : FSTP float ptr [ESP + 0x18]
005a4df3 : FLD float ptr [ESP + 0x3c]
005a4df7 : FSTP float ptr [ESP + 0x28]
005a4dfb : FLD float ptr [ESP + 0x40]
005a4dff : FSTP float ptr [ESP + 0x2c]
005a4e03 : JZ 0x005a4e4d
005a4e05 : LEA EDX,[ESP + 0x14]
005a4e09 : PUSH EDX
005a4e0a : LEA EAX,[ESP + 0x5c]
005a4e0e : LEA ESI,[EBX + 0x9cc]
005a4e14 : PUSH EAX
005a4e15 : MOV ECX,ESI
005a4e17 : CALL 0x00522c50
005a4e1c : FLD float ptr [ESP + 0x58]
005a4e20 : LEA ECX,[ESP + 0x28]
005a4e24 : FSTP float ptr [ESP + 0x14]
005a4e28 : FLD float ptr [ESP + 0x5c]
005a4e2c : PUSH ECX
005a4e2d : LEA EDX,[ESP + 0x54]
005a4e31 : FSTP float ptr [ESP + 0x1c]
005a4e35 : PUSH EDX
005a4e36 : MOV ECX,ESI
005a4e38 : CALL 0x00522c50
005a4e3d : FLD float ptr [ESP + 0x50]
005a4e41 : FSTP float ptr [ESP + 0x28]
005a4e45 : FLD float ptr [ESP + 0x54]
005a4e49 : FSTP float ptr [ESP + 0x2c]
005a4e4d : FLD float ptr [ESP + 0x2c]
005a4e51 : CALL 0x0063b380
005a4e56 : FLD float ptr [ESP + 0x28]
005a4e5a : PUSH EAX
005a4e5b : CALL 0x0063b380
005a4e60 : FLD float ptr [ESP + 0x1c]
005a4e64 : PUSH EAX
005a4e65 : CALL 0x0063b380
005a4e6a : FLD float ptr [ESP + 0x1c]
005a4e6e : PUSH EAX
005a4e6f : CALL 0x0063b380
005a4e74 : PUSH EAX
005a4e75 : LEA ECX,[ESP + 0x70]
005a4e79 : CALL 0x00559cd0
005a4e7e : JMP 0x005a4f03
005a4e83 : CMP byte ptr [ESP + 0xac],0x0
005a4e8b : FLD float ptr [ESP + 0x3c]
005a4e8f : FSTP float ptr [ESP + 0x14]
005a4e93 : FLD float ptr [ESP + 0x40]
005a4e97 : FSTP float ptr [ESP + 0x18]
005a4e9b : JZ 0x005a4ec2
005a4e9d : LEA EAX,[ESP + 0x14]
005a4ea1 : PUSH EAX
005a4ea2 : LEA ECX,[ESP + 0x4c]
005a4ea6 : PUSH ECX
005a4ea7 : LEA ECX,[EBX + 0x9cc]
005a4ead : CALL 0x00522c50
005a4eb2 : FLD float ptr [ESP + 0x48]
005a4eb6 : FSTP float ptr [ESP + 0x14]
005a4eba : FLD float ptr [ESP + 0x4c]
005a4ebe : FSTP float ptr [ESP + 0x18]
005a4ec2 : FLD float ptr [ESP + 0x18]
005a4ec6 : CALL 0x0063b380
005a4ecb : FLD float ptr [ESP + 0x14]
005a4ecf : PUSH EAX
005a4ed0 : CALL 0x0063b380
005a4ed5 : PUSH EAX
005a4ed6 : LEA ECX,[ESP + 0x68]
005a4eda : CALL 0x00559cb0
005a4edf : JMP 0x005a4f03
005a4ee1 : CMP dword ptr [ESP + 0x88],0x0
005a4ee9 : JZ 0x005a4f03
005a4eeb : MOV EAX,dword ptr [ESP + 0x9c]
005a4ef2 : LEA EDX,[EAX + 0x34]
005a4ef5 : PUSH EDX
005a4ef6 : ADD EAX,0x28
005a4ef9 : PUSH EAX
005a4efa : LEA ECX,[ESP + 0x68]
005a4efe : CALL 0x005551b0
005a4f03 : MOV EAX,dword ptr [EDI]
005a4f05 : MOV EDX,dword ptr [EAX + 0x4]
005a4f08 : LEA ECX,[ESP + 0x30]
005a4f0c : PUSH ECX
005a4f0d : MOV ECX,EDI
005a4f0f : CALL EDX
005a4f11 : TEST AL,AL
005a4f13 : JNZ 0x005a4d30
005a4f19 : CMP byte ptr [ESP + 0xa8],0x0
005a4f21 : POP ESI
005a4f22 : JNZ 0x005a4f2e
005a4f24 : CMP byte ptr [ESP + 0xa8],0x0
005a4f2c : JZ 0x005a4f44
005a4f2e : MOV ECX,dword ptr [ESP + 0x98]
005a4f35 : MOV EAX,dword ptr [ECX]
005a4f37 : MOV EDX,dword ptr [ESP + 0xa0]
005a4f3e : MOV EAX,dword ptr [EAX + 0x14]
005a4f41 : PUSH EDX
005a4f42 : CALL EAX
005a4f44 : MOV ECX,EDI
005a4f46 : CALL 0x004ff7c0
005a4f4b : TEST EBP,EBP
005a4f4d : JZ 0x005a4f56
005a4f4f : MOV ECX,EBP
005a4f51 : CALL 0x00557b30
005a4f56 : MOV ECX,dword ptr [ESP + 0x78]
005a4f5a : PUSH ECX
005a4f5b : CALL 0x00515cf0
005a4f60 : POP EDI
005a4f61 : POP EBP
005a4f62 : POP EBX
005a4f63 : ADD ESP,0x88
005a4f69 : RET 0x14
