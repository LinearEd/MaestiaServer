PROGRAM  : Maestia.exe
FUNCTION : FUN_009f3360
ENTRY    : 009f3360
BODY     : [[009f3360, 009f3574]]

============================================================
DECOMPILED C CODE
============================================================

int * FUN_009f3360(int param_1,int param_2)

{
  uint uVar1;
  int *piVar2;
  int iVar3;
  int *piVar4;
  char cVar5;
  int unaff_EDI;
  undefined1 auStack_3c [8];
  LPCRITICAL_SECTION local_34;
  char *local_30;
  undefined4 uStack_2c;
  int iStack_28;
  undefined4 uStack_24;
  uint local_1c;
  void *local_14;
  undefined1 *puStack_10;
  undefined4 local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b46c71;
  local_14 = ExceptionList;
  uVar1 = DAT_00d66fa0 ^ (uint)&stack0xffffffb0;
  ExceptionList = &local_14;
  piVar2 = (int *)FUN_009f2740(unaff_EDI);
  if (piVar2 != (int *)0x0) {
    ExceptionList = local_14;
    return piVar2;
  }
  if (param_2 == 0) {
    iVar3 = FUN_006f0760(0x1c4,".\\Items\\AvaItemManager.cpp",0x30,0,uVar1);
    local_c = 0;
    if (iVar3 == 0) goto LAB_009f33fc;
    piVar2 = (int *)FUN_009ed1d0(iVar3,param_1);
  }
  else {
    iVar3 = FUN_006f0760(0xe4,".\\Items\\AvaItemManager.cpp",0x37,0,uVar1);
    local_c = 1;
    if (iVar3 == 0) {
LAB_009f33fc:
      piVar2 = (int *)0x0;
    }
    else {
      piVar2 = (int *)FUN_009ec950(iVar3,param_1);
    }
  }
  local_c = 0xffffffff;
  if (piVar2 == (int *)0x0) {
    FUN_00406460(L"alloc failed");
    local_c = 2;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaItemManager::CreateTypeGroup",0x3c,&local_34)
      ;
    }
    local_c = 0xffffffff;
    if (7 < local_1c) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    ExceptionList = local_14;
    return (int *)0x0;
  }
  piVar4 = (int *)FUN_004049b0();
  piVar2[7] = unaff_EDI;
  if (param_2 == 2) {
LAB_009f34c3:
    iVar3 = *(int *)(DAT_0172491c + 0x17c);
  }
  else {
    cVar5 = (char)((uint)unaff_EDI >> 0x10);
    if (9 < (byte)(cVar5 - 0x3cU)) {
      if (((cVar5 != 't') || (piVar4 == (int *)0x0)) ||
         (iVar3 = (**(code **)(*piVar4 + 0x5c))(), iVar3 == 0)) goto LAB_009f34de;
      goto LAB_009f34c3;
    }
    iVar3 = *(int *)(DAT_0172491c + 0x17c);
  }
  FUN_009ed5a0(piVar2,*(undefined4 *)(iVar3 + 0xa8),1);
LAB_009f34de:
  (**(code **)(*piVar2 + 8))();
  local_34 = (LPCRITICAL_SECTION)(param_1 + 0x18);
  iStack_28 = 0;
  local_30 = ".\\Items\\AvaItemManager.cpp";
  uStack_2c = 0x5d;
  uStack_24 = 1;
  FUN_006ef1a0(&local_34);
  local_c = 3;
  FUN_00451e00(auStack_3c,&stack0xffffffbc);
  local_c = 0xffffffff;
  if (iStack_28 != 0) {
    LeaveCriticalSection(local_34);
  }
  ExceptionList = local_14;
  return piVar2;
}



============================================================
DISASSEMBLY
============================================================
009f3360 : PUSH EBP
009f3361 : MOV EBP,ESP
009f3363 : AND ESP,0xfffffff8
009f3366 : PUSH -0x1
009f3368 : PUSH 0xb46c71
009f336d : MOV EAX,FS:[0x0]
009f3373 : PUSH EAX
009f3374 : SUB ESP,0x34
009f3377 : PUSH EBX
009f3378 : PUSH ESI
009f3379 : MOV EAX,[0x00d66fa0]
009f337e : XOR EAX,ESP
009f3380 : PUSH EAX
009f3381 : LEA EAX,[ESP + 0x40]
009f3385 : MOV FS:[0x0],EAX
009f338b : MOV ESI,dword ptr [EBP + 0x8]
009f338e : PUSH EDI
009f338f : MOV ECX,ESI
009f3391 : CALL 0x009f2740
009f3396 : XOR EBX,EBX
009f3398 : CMP EAX,EBX
009f339a : JNZ 0x009f3561
009f33a0 : PUSH EBX
009f33a1 : CMP dword ptr [EBP + 0xc],EBX
009f33a4 : JZ 0x009f33d3
009f33a6 : PUSH 0x37
009f33a8 : PUSH 0xca5164
009f33ad : PUSH 0xe4
009f33b2 : CALL 0x006f0760
009f33b7 : ADD ESP,0x10
009f33ba : MOV dword ptr [ESP + 0x10],EAX
009f33be : MOV dword ptr [ESP + 0x48],0x1
009f33c6 : CMP EAX,EBX
009f33c8 : JZ 0x009f33fc
009f33ca : PUSH ESI
009f33cb : PUSH EAX
009f33cc : CALL 0x009ec950
009f33d1 : JMP 0x009f33fe
009f33d3 : PUSH 0x30
009f33d5 : PUSH 0xca512c
009f33da : PUSH 0x1c4
009f33df : CALL 0x006f0760
009f33e4 : ADD ESP,0x10
009f33e7 : MOV dword ptr [ESP + 0x10],EAX
009f33eb : MOV dword ptr [ESP + 0x48],EBX
009f33ef : CMP EAX,EBX
009f33f1 : JZ 0x009f33fc
009f33f3 : PUSH ESI
009f33f4 : PUSH EAX
009f33f5 : CALL 0x009ed1d0
009f33fa : JMP 0x009f33fe
009f33fc : XOR EAX,EAX
009f33fe : MOV dword ptr [ESP + 0x48],0xffffffff
009f3406 : MOV ESI,EAX
009f3408 : CMP ESI,EBX
009f340a : JNZ 0x009f347f
009f340c : PUSH 0xca519c
009f3411 : LEA ECX,[ESP + 0x24]
009f3415 : CALL 0x00406460
009f341a : MOV dword ptr [ESP + 0x48],0x2
009f3422 : MOV EAX,[0x00da98e8]
009f3427 : MOV ECX,dword ptr [EAX]
009f3429 : CMP ECX,EBX
009f342b : JZ 0x009f3440
009f342d : MOV EDX,dword ptr [ECX]
009f342f : MOV EDX,dword ptr [EDX + 0x14]
009f3432 : LEA EAX,[ESP + 0x20]
009f3436 : PUSH EAX
009f3437 : PUSH 0x3c
009f3439 : PUSH 0xca51b8
009f343e : CALL EDX
009f3440 : MOV dword ptr [ESP + 0x48],0xffffffff
009f3448 : CMP dword ptr [ESP + 0x38],0x8
009f344d : JC 0x009f3458
009f344f : MOV ECX,dword ptr [ESP + 0x24]
009f3453 : CALL 0x006f04e0
009f3458 : XOR EAX,EAX
009f345a : MOV dword ptr [ESP + 0x38],0x7
009f3462 : MOV dword ptr [ESP + 0x34],EBX
009f3466 : MOV word ptr [ESP + 0x24],AX
009f346b : MOV ECX,dword ptr [ESP + 0x40]
009f346f : MOV dword ptr FS:[0x0],ECX
009f3476 : POP ECX
009f3477 : POP ESI
009f3478 : POP EBX
009f3479 : MOV ESP,EBP
009f347b : POP EBP
009f347c : RET 0x8
009f347f : MOV EBX,EDI
009f3481 : PUSH EDI
009f3482 : SHR EBX,0x10
009f3485 : CALL 0x004049b0
009f348a : ADD ESP,0x4
009f348d : CMP dword ptr [EBP + 0xc],0x2
009f3491 : MOV dword ptr [ESI + 0x1c],EDI
009f3494 : JZ 0x009f34c3
009f3496 : MOV DL,BL
009f3498 : SUB DL,0x3c
009f349b : CMP DL,0x9
009f349e : JA 0x009f34ad
009f34a0 : MOV EAX,[0x0172491c]
009f34a5 : MOV EAX,dword ptr [EAX + 0x17c]
009f34ab : JMP 0x009f34cf
009f34ad : CMP BL,0x74
009f34b0 : JNZ 0x009f34de
009f34b2 : TEST EAX,EAX
009f34b4 : JZ 0x009f34de
009f34b6 : MOV EDX,dword ptr [EAX]
009f34b8 : MOV ECX,EAX
009f34ba : MOV EAX,dword ptr [EDX + 0x5c]
009f34bd : CALL EAX
009f34bf : TEST EAX,EAX
009f34c1 : JZ 0x009f34de
009f34c3 : MOV ECX,dword ptr [0x0172491c]
009f34c9 : MOV EAX,dword ptr [ECX + 0x17c]
009f34cf : MOV EAX,dword ptr [EAX + 0xa8]
009f34d5 : PUSH 0x1
009f34d7 : PUSH EAX
009f34d8 : PUSH ESI
009f34d9 : CALL 0x009ed5a0
009f34de : MOV EDX,dword ptr [ESI]
009f34e0 : MOV EAX,dword ptr [EDX + 0x8]
009f34e3 : MOV ECX,ESI
009f34e5 : CALL EAX
009f34e7 : MOV EBX,dword ptr [EBP + 0x8]
009f34ea : LEA EDX,[ESP + 0x20]
009f34ee : LEA ECX,[EBX + 0x18]
009f34f1 : PUSH EDX
009f34f2 : MOV dword ptr [ESP + 0x30],0x0
009f34fa : MOV dword ptr [ESP + 0x24],ECX
009f34fe : MOV dword ptr [ESP + 0x28],0xca51f8
009f3506 : MOV dword ptr [ESP + 0x2c],0x5d
009f350e : MOV dword ptr [ESP + 0x34],0x1
009f3516 : CALL 0x006ef1a0
009f351b : MOV dword ptr [ESP + 0x48],0x3
009f3523 : LEA EAX,[ESP + 0x10]
009f3527 : PUSH EAX
009f3528 : LEA ECX,[ESP + 0x1c]
009f352c : PUSH ECX
009f352d : LEA EAX,[EBX + 0x4]
009f3530 : MOV dword ptr [ESP + 0x18],EDI
009f3534 : MOV dword ptr [ESP + 0x1c],ESI
009f3538 : CALL 0x00451e00
009f353d : MOV dword ptr [ESP + 0x48],0xffffffff
009f3545 : CMP dword ptr [ESP + 0x2c],0x0
009f354a : JZ 0x009f355f
009f354c : MOV EDX,dword ptr [ESP + 0x20]
009f3550 : PUSH EDX
009f3551 : CALL dword ptr [0x00b8511c]
009f3557 : MOV dword ptr [ESP + 0x2c],0x0
009f355f : MOV EAX,ESI
009f3561 : MOV ECX,dword ptr [ESP + 0x40]
009f3565 : MOV dword ptr FS:[0x0],ECX
009f356c : POP ECX
009f356d : POP ESI
009f356e : POP EBX
009f356f : MOV ESP,EBP
009f3571 : POP EBP
009f3572 : RET 0x8
