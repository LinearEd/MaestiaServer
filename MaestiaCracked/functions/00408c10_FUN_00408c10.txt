PROGRAM  : Maestia.exe
FUNCTION : FUN_00408c10
ENTRY    : 00408c10
BODY     : [[00408c10, 00408d50] [00408d62, 00408e31]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00408c10(uint param_1,void *param_2,uint param_3)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  undefined4 uVar5;
  uint uVar6;
  uint uVar7;
  undefined8 uVar8;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  iVar3 = param_1;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b7c8a0;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  iVar4 = *(int *)(param_1 + 4);
  if (iVar4 == 0) {
    uVar7 = 0;
  }
  else {
    uVar7 = *(int *)(param_1 + 0xc) - iVar4 >> 2;
  }
  if (param_3 != 0) {
    iVar2 = *(int *)(param_1 + 8);
    iVar4 = iVar2 - iVar4 >> 2;
    uVar6 = param_3;
    if (0x3fffffffU - iVar4 < param_3) {
      uVar8 = FUN_00429be0();
      uVar6 = (uint)((ulonglong)uVar8 >> 0x20);
      iVar4 = (int)uVar8;
    }
    uVar1 = iVar4 + uVar6;
    if (uVar7 < uVar1) {
      if (0x3fffffff - (uVar7 >> 1) < uVar7) {
        param_1 = 0;
      }
      else {
        param_1 = uVar7 + (uVar7 >> 1);
      }
      if (param_1 < uVar1) {
        param_1 = uVar1;
      }
      iVar4 = FUN_004c1790();
      local_8 = 0;
      FUN_004154b0();
      FUN_00461070();
      FUN_00461070();
      local_8 = 0xffffffff;
      if (*(int *)(iVar3 + 4) == 0) {
        *(uint *)(iVar3 + 0xc) = iVar4 + param_1 * 4;
        *(uint *)(iVar3 + 8) =
             iVar4 + (param_3 + (*(int *)(iVar3 + 8) - *(int *)(iVar3 + 4) >> 2)) * 4;
        *(int *)(iVar3 + 4) = iVar4;
        ExceptionList = local_10;
        return;
      }
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    if ((uint)(iVar2 - (int)param_2 >> 2) < uVar6) {
      FUN_00461070();
      local_8 = 2;
      FUN_004154b0();
      local_8 = 0xffffffff;
      *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + uVar6 * 4;
    }
    else {
      uVar5 = FUN_00461070();
      *(undefined4 *)(param_1 + 8) = uVar5;
      iVar4 = (int)((iVar2 + uVar6 * -4) - (int)param_2) >> 2;
      if (0 < iVar4) {
        _memmove_s((void *)(iVar2 + iVar4 * -4),iVar4 * 4,param_2,iVar4 * 4);
      }
    }
    FUN_00422490(param_2);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00408c10 : PUSH EBP
00408c11 : MOV EBP,ESP
00408c13 : PUSH -0x1
00408c15 : PUSH 0xb7c8a0
00408c1a : MOV EAX,FS:[0x0]
00408c20 : PUSH EAX
00408c21 : SUB ESP,0x10
00408c24 : PUSH EBX
00408c25 : PUSH ESI
00408c26 : PUSH EDI
00408c27 : MOV EAX,[0x00d66fa0]
00408c2c : XOR EAX,EBP
00408c2e : PUSH EAX
00408c2f : LEA EAX,[EBP + -0xc]
00408c32 : MOV FS:[0x0],EAX
00408c38 : MOV dword ptr [EBP + -0x10],ESP
00408c3b : MOV EBX,dword ptr [EBP + 0x8]
00408c3e : MOV ECX,dword ptr [EBX + 0x4]
00408c41 : TEST ECX,ECX
00408c43 : JNZ 0x00408c49
00408c45 : XOR EDI,EDI
00408c47 : JMP 0x00408c53
00408c49 : MOV EAX,dword ptr [EBX + 0xc]
00408c4c : SUB EAX,ECX
00408c4e : SAR EAX,0x2
00408c51 : MOV EDI,EAX
00408c53 : MOV EDX,dword ptr [EBP + 0x10]
00408c56 : TEST EDX,EDX
00408c58 : JZ 0x00408e1e
00408c5e : MOV ESI,dword ptr [EBX + 0x8]
00408c61 : MOV EAX,ESI
00408c63 : SUB EAX,ECX
00408c65 : SAR EAX,0x2
00408c68 : MOV ECX,0x3fffffff
00408c6d : SUB ECX,EAX
00408c6f : CMP ECX,EDX
00408c71 : JNC 0x00408c78
00408c73 : CALL 0x00429be0
00408c78 : LEA ECX,[EAX + EDX*0x1]
00408c7b : CMP EDI,ECX
00408c7d : JNC 0x00408d62
00408c83 : MOV EAX,EDI
00408c85 : SHR EAX,0x1
00408c87 : MOV EDX,0x3fffffff
00408c8c : SUB EDX,EAX
00408c8e : CMP EDX,EDI
00408c90 : JNC 0x00408c9e
00408c92 : MOV dword ptr [EBP + 0x8],0x0
00408c99 : MOV EDI,dword ptr [EBP + 0x8]
00408c9c : JMP 0x00408ca3
00408c9e : ADD EDI,EAX
00408ca0 : MOV dword ptr [EBP + 0x8],EDI
00408ca3 : CMP EDI,ECX
00408ca5 : JNC 0x00408cac
00408ca7 : MOV dword ptr [EBP + 0x8],ECX
00408caa : MOV EDI,ECX
00408cac : MOV ECX,EDI
00408cae : CALL 0x004c1790
00408cb3 : MOV dword ptr [EBP + -0x14],EAX
00408cb6 : MOV ECX,dword ptr [EBP + 0xc]
00408cb9 : SUB ECX,dword ptr [EBX + 0x4]
00408cbc : SAR ECX,0x2
00408cbf : MOV dword ptr [EBP + -0x1c],ECX
00408cc2 : MOV dword ptr [EBP + -0x4],0x0
00408cc9 : LEA EDI,[EAX + ECX*0x4]
00408ccc : MOV EDX,dword ptr [EBP + 0x14]
00408ccf : MOV ESI,dword ptr [EBP + 0x10]
00408cd2 : CALL 0x004154b0
00408cd7 : MOV dword ptr [EBP + -0x18],0x1
00408cde : MOV ESI,dword ptr [EBP + -0x14]
00408ce1 : MOV EDX,ESI
00408ce3 : MOV EAX,dword ptr [EBP + 0xc]
00408ce6 : MOV EDI,dword ptr [EBX + 0x4]
00408ce9 : CALL 0x00461070
00408cee : MOV dword ptr [EBP + -0x18],0x2
00408cf5 : MOV EAX,dword ptr [EBP + -0x1c]
00408cf8 : MOV ECX,dword ptr [EBP + 0x10]
00408cfb : ADD EAX,ECX
00408cfd : LEA EDX,[ESI + EAX*0x4]
00408d00 : MOV EAX,dword ptr [EBX + 0x8]
00408d03 : MOV EDI,dword ptr [EBP + 0xc]
00408d06 : CALL 0x00461070
00408d0b : MOV dword ptr [EBP + -0x4],0xffffffff
00408d12 : MOV ECX,dword ptr [EBX + 0x4]
00408d15 : MOV EDX,dword ptr [EBX + 0x8]
00408d18 : SUB EDX,ECX
00408d1a : SAR EDX,0x2
00408d1d : MOV EDI,dword ptr [EBP + 0x10]
00408d20 : ADD EDI,EDX
00408d22 : TEST ECX,ECX
00408d24 : JZ 0x00408d2b
00408d26 : CALL 0x006f04e0
00408d2b : MOV EAX,dword ptr [EBP + 0x8]
00408d2e : LEA ECX,[ESI + EAX*0x4]
00408d31 : MOV dword ptr [EBX + 0xc],ECX
00408d34 : LEA EDX,[ESI + EDI*0x4]
00408d37 : MOV dword ptr [EBX + 0x8],EDX
00408d3a : MOV dword ptr [EBX + 0x4],ESI
00408d3d : MOV ECX,dword ptr [EBP + -0xc]
00408d40 : MOV dword ptr FS:[0x0],ECX
00408d47 : POP ECX
00408d48 : POP EDI
00408d49 : POP ESI
00408d4a : POP EBX
00408d4b : MOV ESP,EBP
00408d4d : POP EBP
00408d4e : RET 0x10
00408d62 : MOV EAX,ESI
00408d64 : MOV EDI,dword ptr [EBP + 0xc]
00408d67 : SUB EAX,EDI
00408d69 : SAR EAX,0x2
00408d6c : CMP EAX,EDX
00408d6e : JNC 0x00408dc6
00408d70 : MOV ECX,dword ptr [EBP + 0x14]
00408d73 : MOV EAX,dword ptr [ECX]
00408d75 : MOV dword ptr [EBP + 0x8],EAX
00408d78 : LEA EAX,[EDX*0x4 + 0x0]
00408d7f : MOV dword ptr [EBP + 0x14],EAX
00408d82 : LEA EDX,[EAX + EDI*0x1]
00408d85 : MOV EAX,ESI
00408d87 : CALL 0x00461070
00408d8c : MOV dword ptr [EBP + -0x4],0x2
00408d93 : MOV EDI,dword ptr [EBX + 0x8]
00408d96 : MOV ECX,EDI
00408d98 : SUB ECX,dword ptr [EBP + 0xc]
00408d9b : SAR ECX,0x2
00408d9e : MOV ESI,dword ptr [EBP + 0x10]
00408da1 : SUB ESI,ECX
00408da3 : LEA EDX,[EBP + 0x8]
00408da6 : CALL 0x004154b0
00408dab : MOV dword ptr [EBP + -0x4],0xffffffff
00408db2 : MOV EAX,dword ptr [EBP + 0x14]
00408db5 : ADD dword ptr [EBX + 0x8],EAX
00408db8 : MOV ECX,dword ptr [EBX + 0x8]
00408dbb : SUB ECX,EAX
00408dbd : MOV EDX,dword ptr [EBP + 0xc]
00408dc0 : PUSH EDX
00408dc1 : LEA EDX,[EBP + 0x8]
00408dc4 : JMP 0x00408e16
00408dc6 : MOV EAX,dword ptr [EBP + 0x14]
00408dc9 : MOV ECX,dword ptr [EAX]
00408dcb : MOV dword ptr [EBP + 0x10],ECX
00408dce : LEA EAX,[EDX*0x4 + 0x0]
00408dd5 : MOV dword ptr [EBP + 0x14],EAX
00408dd8 : MOV EDI,ESI
00408dda : SUB EDI,EAX
00408ddc : MOV EDX,ESI
00408dde : MOV EAX,ESI
00408de0 : CALL 0x00461070
00408de5 : MOV dword ptr [EBX + 0x8],EAX
00408de8 : MOV EAX,dword ptr [EBP + 0xc]
00408deb : SUB EDI,EAX
00408ded : SAR EDI,0x2
00408df0 : TEST EDI,EDI
00408df2 : JLE 0x00408e0c
00408df4 : LEA ECX,[EDI*0x4 + 0x0]
00408dfb : PUSH ECX
00408dfc : PUSH EAX
00408dfd : PUSH ECX
00408dfe : SUB ESI,ECX
00408e00 : PUSH ESI
00408e01 : CALL 0x00634101
00408e06 : ADD ESP,0x10
00408e09 : MOV EAX,dword ptr [EBP + 0xc]
00408e0c : MOV EDX,dword ptr [EBP + 0x14]
00408e0f : LEA ECX,[EDX + EAX*0x1]
00408e12 : PUSH EAX
00408e13 : LEA EDX,[EBP + 0x10]
00408e16 : CALL 0x00422490
00408e1b : ADD ESP,0x4
00408e1e : MOV ECX,dword ptr [EBP + -0xc]
00408e21 : MOV dword ptr FS:[0x0],ECX
00408e28 : POP ECX
00408e29 : POP EDI
00408e2a : POP ESI
00408e2b : POP EBX
00408e2c : MOV ESP,EBP
00408e2e : POP EBP
00408e2f : RET 0x10
