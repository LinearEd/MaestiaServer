PROGRAM  : Maestia.exe
FUNCTION : FUN_005f0160
ENTRY    : 005f0160
BODY     : [[005f0160, 005f02ee]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005f0160(undefined4 *param_1)

{
  undefined4 uVar1;
  undefined4 *puVar2;
  char cVar3;
  int iVar4;
  GRefCountImpl *this;
  uint uVar5;
  undefined1 auStack_10 [4];
  int local_c;
  int *piStack_8;
  undefined4 uStack_4;
  
  puVar2 = param_1;
  iVar4 = param_1[2];
  if (iVar4 == 0) {
    return;
  }
  if (iVar4 == 0x10) {
    return;
  }
  if (*(int *)(iVar4 + 0x28) == 0) {
    return;
  }
  if (*(int *)(iVar4 + 0x2c) == 0) {
    return;
  }
  iVar4 = FUN_0051d0a0(*(int *)(iVar4 + 0x2c));
  if (iVar4 == 0) {
    return;
  }
  local_c = FUN_0054ed10();
  if (local_c == 0) {
    return;
  }
  if ((int)puVar2[7] < 1) {
    FUN_005907b0();
    return;
  }
  uVar1 = puVar2[6];
  FUN_00526260(0);
  FUN_005272e0(&param_1,uVar1,0xffffffff,0);
  if (puVar2[2] == 0) {
    iVar4 = 0;
  }
  else {
    iVar4 = puVar2[2] + -0x10;
  }
  this = (GRefCountImpl *)(**(code **)(**(int **)(puVar2[6] + 0x74) + 0x48))();
  if (this != (GRefCountImpl *)0x0) {
    GRefCountImpl::AddRef(this);
  }
  if (iVar4 != 0) {
    if (this == (GRefCountImpl *)0x0) goto LAB_005f02ca;
    piStack_8 = (int *)0x0;
    uStack_4 = 0;
    FUN_0051c480(*param_1);
    cVar3 = FUN_005649d0(&piStack_8,auStack_10);
    FUN_0045b730();
    if ((cVar3 == '\0') || (uVar5 = (**(code **)(*piStack_8 + 8))(), (uVar5 & 0xff00) != 0x400)) {
      if (piStack_8 != (int *)0x0) {
        FUN_00524240();
      }
      FUN_00524240();
      param_1[2] = param_1[2] + -1;
      if (param_1[2] != 0) {
        return;
      }
      FUN_00525340();
      return;
    }
    if ((piStack_8 != (int *)0x0) && (FUN_005908b0(piStack_8), piStack_8 != (int *)0x0)) {
      FUN_00524240();
    }
  }
  if (this != (GRefCountImpl *)0x0) {
    FUN_00524240();
  }
LAB_005f02ca:
  param_1[2] = param_1[2] + -1;
  if (param_1[2] != 0) {
    return;
  }
  FUN_00525340();
  return;
}



============================================================
DISASSEMBLY
============================================================
005f0160 : SUB ESP,0x10
005f0163 : PUSH ESI
005f0164 : MOV ESI,dword ptr [ESP + 0x18]
005f0168 : MOV EAX,dword ptr [ESI + 0x8]
005f016b : TEST EAX,EAX
005f016d : JZ 0x005f029b
005f0173 : ADD EAX,-0x10
005f0176 : JZ 0x005f029b
005f017c : MOV ECX,dword ptr [EAX + 0x38]
005f017f : TEST ECX,ECX
005f0181 : JZ 0x005f029b
005f0187 : MOV EAX,dword ptr [EAX + 0x3c]
005f018a : TEST EAX,EAX
005f018c : JZ 0x005f029b
005f0192 : PUSH EAX
005f0193 : CALL 0x0051d0a0
005f0198 : TEST EAX,EAX
005f019a : JZ 0x005f029b
005f01a0 : LEA ECX,[EAX + 0x68]
005f01a3 : CALL 0x0054ed10
005f01a8 : MOV dword ptr [ESP + 0x8],EAX
005f01ac : TEST EAX,EAX
005f01ae : JZ 0x005f029b
005f01b4 : CMP dword ptr [ESI + 0x1c],0x0
005f01b8 : JLE 0x005f02e4
005f01be : PUSH EDI
005f01bf : MOV EDI,dword ptr [ESI + 0x18]
005f01c2 : PUSH 0x0
005f01c4 : MOV ECX,ESI
005f01c6 : CALL 0x00526260
005f01cb : PUSH 0x0
005f01cd : PUSH -0x1
005f01cf : PUSH EDI
005f01d0 : LEA ECX,[ESP + 0x28]
005f01d4 : PUSH ECX
005f01d5 : MOV ECX,EAX
005f01d7 : CALL 0x005272e0
005f01dc : MOV EAX,dword ptr [ESI + 0x8]
005f01df : TEST EAX,EAX
005f01e1 : JZ 0x005f01e8
005f01e3 : LEA EDI,[EAX + -0x10]
005f01e6 : JMP 0x005f01ea
005f01e8 : XOR EDI,EDI
005f01ea : MOV EDX,dword ptr [ESI + 0x18]
005f01ed : MOV ECX,dword ptr [EDX + 0x74]
005f01f0 : MOV EAX,dword ptr [ECX]
005f01f2 : MOV EDX,dword ptr [EAX + 0x48]
005f01f5 : CALL EDX
005f01f7 : MOV ESI,EAX
005f01f9 : TEST ESI,ESI
005f01fb : JZ 0x005f0204
005f01fd : MOV ECX,ESI
005f01ff : CALL 0x00523dd0
005f0204 : TEST EDI,EDI
005f0206 : POP EDI
005f0207 : JZ 0x005f02bf
005f020d : TEST ESI,ESI
005f020f : JZ 0x005f02ca
005f0215 : MOV EAX,dword ptr [ESP + 0x18]
005f0219 : MOV dword ptr [ESP + 0xc],0x0
005f0221 : MOV dword ptr [ESP + 0x10],0x0
005f0229 : MOV ECX,dword ptr [EAX]
005f022b : PUSH EBX
005f022c : PUSH ECX
005f022d : LEA ECX,[ESP + 0xc]
005f0231 : CALL 0x0051c480
005f0236 : LEA EDX,[ESP + 0x8]
005f023a : PUSH EDX
005f023b : LEA EAX,[ESP + 0x14]
005f023f : PUSH EAX
005f0240 : MOV ECX,ESI
005f0242 : CALL 0x005649d0
005f0247 : TEST AL,AL
005f0249 : LEA ECX,[ESP + 0x8]
005f024d : SETZ BL
005f0250 : CALL 0x0045b730
005f0255 : MOV ECX,dword ptr [ESP + 0x10]
005f0259 : TEST BL,BL
005f025b : POP EBX
005f025c : JNZ 0x005f0275
005f025e : MOV EDX,dword ptr [ECX]
005f0260 : MOV EAX,dword ptr [EDX + 0x8]
005f0263 : CALL EAX
005f0265 : AND EAX,0xff00
005f026a : CMP EAX,0x400
005f026f : JZ 0x005f02a0
005f0271 : MOV ECX,dword ptr [ESP + 0xc]
005f0275 : TEST ECX,ECX
005f0277 : JZ 0x005f027e
005f0279 : CALL 0x00524240
005f027e : MOV ECX,ESI
005f0280 : CALL 0x00524240
005f0285 : MOV EAX,dword ptr [ESP + 0x18]
005f0289 : DEC dword ptr [EAX + 0x8]
005f028c : MOV ECX,EAX
005f028e : ADD EAX,0x8
005f0291 : CMP dword ptr [EAX],0x0
005f0294 : JNZ 0x005f029b
005f0296 : CALL 0x00525340
005f029b : POP ESI
005f029c : ADD ESP,0x10
005f029f : RET
005f02a0 : MOV EAX,dword ptr [ESP + 0xc]
005f02a4 : TEST EAX,EAX
005f02a6 : JZ 0x005f02bf
005f02a8 : MOV ECX,dword ptr [ESP + 0x8]
005f02ac : PUSH EAX
005f02ad : CALL 0x005908b0
005f02b2 : MOV ECX,dword ptr [ESP + 0xc]
005f02b6 : TEST ECX,ECX
005f02b8 : JZ 0x005f02bf
005f02ba : CALL 0x00524240
005f02bf : TEST ESI,ESI
005f02c1 : JZ 0x005f02ca
005f02c3 : MOV ECX,ESI
005f02c5 : CALL 0x00524240
005f02ca : MOV EAX,dword ptr [ESP + 0x18]
005f02ce : DEC dword ptr [EAX + 0x8]
005f02d1 : MOV ECX,EAX
005f02d3 : ADD EAX,0x8
005f02d6 : CMP dword ptr [EAX],0x0
005f02d9 : JNZ 0x005f029b
005f02db : POP ESI
005f02dc : ADD ESP,0x10
005f02df : JMP 0x00525340
005f02e4 : MOV ECX,EAX
005f02e6 : POP ESI
005f02e7 : ADD ESP,0x10
005f02ea : JMP 0x005907b0
