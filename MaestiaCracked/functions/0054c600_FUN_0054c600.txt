PROGRAM  : Maestia.exe
FUNCTION : FUN_0054c600
ENTRY    : 0054c600
BODY     : [[0054c600, 0054c742]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_0054c600(uint param_1,uint param_2,char param_3)

{
  uint uVar1;
  GRefCountNTSImpl *this;
  int iVar2;
  undefined4 *puVar3;
  int in_ECX;
  int iVar4;
  undefined4 uVar5;
  uint *puVar6;
  uint local_30;
  GRefCountNTSImpl *local_2c;
  uint local_28;
  uint local_24;
  GRefCountNTSImpl *local_20;
  uint local_1c;
  undefined2 *local_18;
  undefined4 local_14;
  uint local_10;
  uint local_c;
  undefined2 *local_8;
  undefined4 local_4;
  
  uVar1 = param_2;
  iVar4 = -1;
  if (((*(byte *)(in_ECX + 0x68) & 1) == 0) && (*(int *)(in_ECX + 0xc) != 0)) {
    if (param_2 < param_1) {
      param_2 = param_1;
      param_1 = uVar1;
    }
    if ((param_3 == '\0') || (*(int *)(*(int *)(in_ECX + 0xc) + 0x1c) == 0)) {
      puVar3 = (undefined4 *)FUN_005003f0();
      if (puVar3[1] != 0) {
        *(ushort *)(in_ECX + 0x68) = *(ushort *)(in_ECX + 0x68) & 0xffbf;
        local_14 = puVar3[1];
        local_18 = (undefined2 *)*puVar3;
        if (param_1 == param_2) {
          if (local_18 == (undefined2 *)0x0) {
            local_18 = &DAT_00cca49c;
          }
          local_1c = param_1;
          iVar4 = FUN_00546e40(1,&local_1c);
          return iVar4 + param_1;
        }
        if (local_18 == (undefined2 *)0x0) {
          local_18 = &DAT_00cca49c;
        }
        local_10 = param_1;
        local_c = param_2;
        local_8 = local_18;
        local_4 = local_14;
        iVar4 = FUN_00546e40(6,&local_10);
        return iVar4 + param_1;
      }
    }
    else {
      this = (GRefCountNTSImpl *)FUN_005e44c0();
      if (this != (GRefCountNTSImpl *)0x0) {
        *(int *)(this + 4) = *(int *)(this + 4) + 1;
        iVar2 = FUN_0053c470();
        if (iVar2 != 0) {
          *(ushort *)(in_ECX + 0x68) = *(ushort *)(in_ECX + 0x68) & 0xffbf;
          if (param_1 == param_2) {
            puVar6 = &local_30;
            uVar5 = 2;
            local_30 = param_1;
            local_2c = this;
          }
          else {
            local_24 = param_2;
            puVar6 = &local_28;
            uVar5 = 7;
            local_28 = param_1;
            local_20 = this;
          }
          iVar4 = FUN_00546e40(uVar5,puVar6);
          iVar4 = iVar4 + param_1;
        }
        GRefCountNTSImpl::Release(this);
      }
    }
    return iVar4;
  }
  return -1;
}



============================================================
DISASSEMBLY
============================================================
0054c600 : SUB ESP,0x30
0054c603 : PUSH EBP
0054c604 : PUSH EDI
0054c605 : MOV EBP,ECX
0054c607 : OR EDI,0xffffffff
0054c60a : TEST byte ptr [EBP + 0x68],0x1
0054c60e : JNZ 0x0054c739
0054c614 : MOV ECX,dword ptr [EBP + 0xc]
0054c617 : TEST ECX,ECX
0054c619 : JZ 0x0054c739
0054c61f : PUSH EBX
0054c620 : MOV EBX,dword ptr [ESP + 0x44]
0054c624 : PUSH ESI
0054c625 : MOV ESI,dword ptr [ESP + 0x44]
0054c629 : CMP EBX,ESI
0054c62b : JNC 0x0054c637
0054c62d : MOV dword ptr [ESP + 0x48],ESI
0054c631 : MOV ESI,EBX
0054c633 : MOV EBX,dword ptr [ESP + 0x48]
0054c637 : CMP byte ptr [ESP + 0x4c],0x0
0054c63c : JZ 0x0054c6b6
0054c63e : CMP dword ptr [ECX + 0x1c],0x0
0054c642 : JZ 0x0054c6b6
0054c644 : CALL 0x005e44c0
0054c649 : MOV EBX,EAX
0054c64b : TEST EBX,EBX
0054c64d : JZ 0x0054c6aa
0054c64f : INC dword ptr [EBX + 0x4]
0054c652 : MOV ECX,EBX
0054c654 : CALL 0x0053c470
0054c659 : TEST EAX,EAX
0054c65b : JBE 0x0054c6a3
0054c65d : MOV EAX,0xffbf
0054c662 : AND word ptr [EBP + 0x68],AX
0054c666 : MOV EAX,dword ptr [ESP + 0x48]
0054c66a : CMP ESI,EAX
0054c66c : JNZ 0x0054c682
0054c66e : MOV ECX,dword ptr [EBP + 0x8]
0054c671 : LEA EDX,[ESP + 0x10]
0054c675 : PUSH EDX
0054c676 : MOV dword ptr [ESP + 0x14],ESI
0054c67a : MOV dword ptr [ESP + 0x18],EBX
0054c67e : PUSH 0x2
0054c680 : JMP 0x0054c69a
0054c682 : MOV EBP,dword ptr [EBP + 0x8]
0054c685 : MOV dword ptr [ESP + 0x1c],EAX
0054c689 : LEA EAX,[ESP + 0x18]
0054c68d : PUSH EAX
0054c68e : MOV dword ptr [ESP + 0x1c],ESI
0054c692 : MOV dword ptr [ESP + 0x24],EBX
0054c696 : PUSH 0x7
0054c698 : MOV ECX,EBP
0054c69a : CALL 0x00546e40
0054c69f : MOV EDI,EAX
0054c6a1 : ADD EDI,ESI
0054c6a3 : MOV ECX,EBX
0054c6a5 : CALL 0x004ff7c0
0054c6aa : POP ESI
0054c6ab : POP EBX
0054c6ac : MOV EAX,EDI
0054c6ae : POP EDI
0054c6af : POP EBP
0054c6b0 : ADD ESP,0x30
0054c6b3 : RET 0xc
0054c6b6 : CALL 0x005003f0
0054c6bb : CMP dword ptr [EAX + 0x4],0x0
0054c6bf : JBE 0x0054c6aa
0054c6c1 : MOV ECX,0xffbf
0054c6c6 : AND word ptr [EBP + 0x68],CX
0054c6ca : MOV ECX,dword ptr [EAX + 0x4]
0054c6cd : MOV EAX,dword ptr [EAX]
0054c6cf : CMP ESI,EBX
0054c6d1 : JNZ 0x0054c703
0054c6d3 : TEST EAX,EAX
0054c6d5 : JNZ 0x0054c6dc
0054c6d7 : MOV EAX,0xcca49c
0054c6dc : LEA EDX,[ESP + 0x24]
0054c6e0 : PUSH EDX
0054c6e1 : MOV dword ptr [ESP + 0x30],ECX
0054c6e5 : MOV ECX,dword ptr [EBP + 0x8]
0054c6e8 : PUSH 0x1
0054c6ea : MOV dword ptr [ESP + 0x2c],ESI
0054c6ee : MOV dword ptr [ESP + 0x30],EAX
0054c6f2 : CALL 0x00546e40
0054c6f7 : ADD EAX,ESI
0054c6f9 : POP ESI
0054c6fa : POP EBX
0054c6fb : POP EDI
0054c6fc : POP EBP
0054c6fd : ADD ESP,0x30
0054c700 : RET 0xc
0054c703 : TEST EAX,EAX
0054c705 : JNZ 0x0054c70c
0054c707 : MOV EAX,0xcca49c
0054c70c : MOV EBP,dword ptr [EBP + 0x8]
0054c70f : MOV dword ptr [ESP + 0x38],EAX
0054c713 : LEA EAX,[ESP + 0x30]
0054c717 : PUSH EAX
0054c718 : MOV dword ptr [ESP + 0x40],ECX
0054c71c : PUSH 0x6
0054c71e : MOV ECX,EBP
0054c720 : MOV dword ptr [ESP + 0x38],ESI
0054c724 : MOV dword ptr [ESP + 0x3c],EBX
0054c728 : CALL 0x00546e40
0054c72d : ADD EAX,ESI
0054c72f : POP ESI
0054c730 : POP EBX
0054c731 : POP EDI
0054c732 : POP EBP
0054c733 : ADD ESP,0x30
0054c736 : RET 0xc
0054c739 : MOV EAX,EDI
0054c73b : POP EDI
0054c73c : POP EBP
0054c73d : ADD ESP,0x30
0054c740 : RET 0xc
