PROGRAM  : Maestia.exe
FUNCTION : FUN_00800250
ENTRY    : 00800250
BODY     : [[00800250, 008005c7]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00800250(int param_1)

{
  int *piVar1;
  char cVar2;
  int iVar3;
  undefined4 uVar4;
  int iVar5;
  uint *puVar6;
  undefined4 *puVar7;
  uint *puVar8;
  undefined4 *puVar9;
  wchar_t *pwVar10;
  uint local_cc;
  LPCRITICAL_SECTION local_c8;
  char *local_c4;
  undefined4 local_c0;
  int local_bc;
  undefined4 local_b8;
  undefined4 local_b4;
  uint local_b0;
  undefined4 local_ac;
  undefined4 local_a8;
  undefined4 local_a4;
  undefined4 local_a0;
  uint uStack_9c;
  undefined4 auStack_98 [4];
  int iStack_88;
  uint uStack_84;
  uint local_60 [8];
  int local_40;
  undefined4 local_30;
  undefined4 auStack_28 [5];
  void *local_14;
  undefined1 *puStack_10;
  int local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b4d806;
  local_14 = ExceptionList;
  ExceptionList = &local_14;
  FUN_008018d0(L"(!) AvaRender::ResetDevice - START",DAT_00d66fa0 ^ (uint)&stack0xffffff28);
  local_c8 = (LPCRITICAL_SECTION)(DAT_017251ac + 0x424);
  local_cc = 0;
  local_bc = 0;
  local_c4 = ".\\Render\\AvaRender.cpp";
  local_c0 = 0x603;
  local_b8 = 1;
  FUN_006ef1a0(&local_c8);
  local_c = 0;
  FUN_007ff990();
  while( true ) {
    local_cc = local_cc + 1;
    FUN_008018d0(L"AvaRender::ResetDevice - Now Reset count : %d",local_cc);
    iVar3 = *(int *)(param_1 + 0x1c);
    puVar6 = (uint *)(*(int *)(param_1 + 0x178) + 0x48);
    puVar8 = local_60;
    for (iVar5 = 0xe; iVar5 != 0; iVar5 = iVar5 + -1) {
      *puVar8 = *puVar6;
      puVar6 = puVar6 + 1;
      puVar8 = puVar8 + 1;
    }
    if (iVar3 == 0) {
      iVar3 = (**(code **)(**(int **)(param_1 + 0x18) + 0x40))(*(int **)(param_1 + 0x18),local_60);
    }
    else {
      if (local_40 == 0) {
        local_b0 = local_60[0];
        local_ac = local_60[1];
        local_b4 = 0x18;
        local_a4 = local_60[2];
        local_a8 = local_30;
        local_a0 = 1;
      }
      iVar3 = (**(code **)(**(int **)(param_1 + 0x18) + 0x210))
                        (*(int **)(param_1 + 0x18),local_60,
                         ~-(uint)(local_40 != 0) & (uint)&local_b4);
    }
    if (-1 < iVar3) break;
    iVar3 = *(int *)(param_1 + 0x178);
    puVar7 = (undefined4 *)(iVar3 + 0x48);
    puVar9 = auStack_98;
    for (iVar5 = 0xe; iVar5 != 0; iVar5 = iVar5 + -1) {
      *puVar9 = *puVar7;
      puVar7 = puVar7 + 1;
      puVar9 = puVar9 + 1;
    }
    if (iStack_88 == 0) {
      if (2 < (int)local_cc) {
        FUN_008018d0(L"(!) AvaRender::ResetDevice - FAILED");
        local_c = 0xffffffff;
        if (local_bc == 0) {
          ExceptionList = local_14;
          return;
        }
        LeaveCriticalSection(local_c8);
        ExceptionList = local_14;
        return;
      }
      Sleep(100);
    }
    else {
      if (uStack_84 < 2) {
        iStack_88 = 0;
        uStack_84 = 0;
      }
      else {
        uStack_84 = uStack_84 >> 1;
      }
      puVar7 = auStack_98;
      puVar9 = (undefined4 *)(iVar3 + 0x48);
      for (iVar5 = 0xe; iVar5 != 0; iVar5 = iVar5 + -1) {
        *puVar9 = *puVar7;
        puVar7 = puVar7 + 1;
        puVar9 = puVar9 + 1;
      }
      Sleep(100);
    }
  }
  (**(code **)(**(int **)(param_1 + 0x14) + 0x20))
            (*(int **)(param_1 + 0x14),*(undefined4 *)(param_1 + 0x28),auStack_28);
  iVar3 = (**(code **)(**(int **)(param_1 + 0x14) + 0x28))
                    (*(int **)(param_1 + 0x14),*(undefined4 *)(param_1 + 0x28),
                     *(undefined4 *)(param_1 + 0x24),auStack_28[0],2,3,0x4b);
  if (iVar3 < 0) {
    uVar4 = FUN_00404750(L"ResetDevice CheckDeviceFormat Failed (%d)",iVar3);
    local_c._0_1_ = 1;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaLib::AvaRender::ResetDevice",0x646,uVar4);
    }
    local_c = (uint)local_c._1_3_ << 8;
    if (7 < uStack_9c) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    uStack_9c = 7;
    local_a0 = 0;
    local_b0 = local_b0 & 0xffff0000;
    *(undefined1 *)(param_1 + 0x22e) = 0;
  }
  FUN_007ffdf0(param_1);
  piVar1 = *(int **)(param_1 + 0x4a4);
  DAT_01720efc = *(undefined4 *)(param_1 + 0x18);
  if (piVar1 != (int *)0x0) {
    local_cc = 5;
    if (DAT_00d6ab02 == '\0') {
      local_cc = 0xd;
    }
    if (*(int *)(param_1 + 0x20) != 0) {
      local_cc = local_cc | 0x10;
    }
    puVar7 = (undefined4 *)(*(int *)(param_1 + 0x178) + 0x48);
    puVar9 = auStack_98;
    for (iVar3 = 0xe; iVar3 != 0; iVar3 = iVar3 + -1) {
      *puVar9 = *puVar7;
      puVar7 = puVar7 + 1;
      puVar9 = puVar9 + 1;
    }
    cVar2 = (**(code **)(*piVar1 + 0x8c))(DAT_01720efc,auStack_98,local_cc,0);
    if (cVar2 == '\0') {
      pwVar10 = L"m_pGfxRenderer->SetDependentVideoMode() FAILED";
    }
    else {
      pwVar10 = L"m_pGfxRenderer->SetDependentVideoMode() OK";
    }
    FUN_008018d0(pwVar10);
  }
  FUN_008018d0(L"(!) AvaRender::ResetDevice - END");
  local_c = 0xffffffff;
  if (local_bc == 0) {
    ExceptionList = local_14;
    return;
  }
  LeaveCriticalSection(local_c8);
  ExceptionList = local_14;
  return;
}



============================================================
DISASSEMBLY
============================================================
00800250 : PUSH EBP
00800251 : MOV EBP,ESP
00800253 : AND ESP,0xfffffff8
00800256 : PUSH -0x1
00800258 : PUSH 0xb4d806
0080025d : MOV EAX,FS:[0x0]
00800263 : PUSH EAX
00800264 : SUB ESP,0xb8
0080026a : PUSH EBX
0080026b : PUSH ESI
0080026c : PUSH EDI
0080026d : MOV EAX,[0x00d66fa0]
00800272 : XOR EAX,ESP
00800274 : PUSH EAX
00800275 : LEA EAX,[ESP + 0xc8]
0080027c : MOV FS:[0x0],EAX
00800282 : MOV EBX,dword ptr [EBP + 0x8]
00800285 : MOV ESI,dword ptr [0x00da98e8]
0080028b : PUSH 0xc27bc0
00800290 : CALL 0x008018d0
00800295 : MOV EAX,[0x017251ac]
0080029a : ADD ESP,0x4
0080029d : LEA ECX,[ESP + 0x14]
008002a1 : XOR ESI,ESI
008002a3 : ADD EAX,0x424
008002a8 : PUSH ECX
008002a9 : MOV dword ptr [ESP + 0x14],ESI
008002ad : MOV dword ptr [ESP + 0x24],ESI
008002b1 : MOV dword ptr [ESP + 0x18],EAX
008002b5 : MOV dword ptr [ESP + 0x1c],0xc27c08
008002bd : MOV dword ptr [ESP + 0x20],0x603
008002c5 : MOV dword ptr [ESP + 0x28],0x1
008002cd : CALL 0x006ef1a0
008002d2 : MOV dword ptr [ESP + 0xd0],ESI
008002d9 : MOV ECX,EBX
008002db : CALL 0x007ff990
008002e0 : MOV EAX,dword ptr [ESP + 0x10]
008002e4 : MOV ESI,dword ptr [0x00da98e8]
008002ea : INC EAX
008002eb : PUSH EAX
008002ec : PUSH 0xc27c20
008002f1 : MOV dword ptr [ESP + 0x18],EAX
008002f5 : CALL 0x008018d0
008002fa : MOV EAX,dword ptr [EBX + 0x178]
00800300 : ADD ESP,0x8
00800303 : CMP dword ptr [EBX + 0x1c],0x0
00800307 : LEA ESI,[EAX + 0x48]
0080030a : MOV ECX,0xe
0080030f : LEA EDI,[ESP + 0x7c]
00800313 : MOVSD.REP ES:EDI,ESI
00800315 : JZ 0x00800380
00800317 : MOV EAX,dword ptr [ESP + 0x9c]
0080031e : TEST EAX,EAX
00800320 : JNZ 0x0080035b
00800322 : MOV EDX,dword ptr [ESP + 0x7c]
00800326 : MOV ECX,dword ptr [ESP + 0x80]
0080032d : MOV dword ptr [ESP + 0x2c],EDX
00800331 : MOV EDX,dword ptr [ESP + 0x84]
00800338 : MOV dword ptr [ESP + 0x30],ECX
0080033c : MOV ECX,dword ptr [ESP + 0xac]
00800343 : MOV dword ptr [ESP + 0x28],0x18
0080034b : MOV dword ptr [ESP + 0x38],EDX
0080034f : MOV dword ptr [ESP + 0x34],ECX
00800353 : MOV dword ptr [ESP + 0x3c],0x1
0080035b : MOV ECX,dword ptr [EBX + 0x18]
0080035e : MOV EDX,dword ptr [ECX]
00800360 : NEG EAX
00800362 : SBB EAX,EAX
00800364 : NOT EAX
00800366 : LEA ESI,[ESP + 0x28]
0080036a : AND EAX,ESI
0080036c : PUSH EAX
0080036d : LEA EAX,[ESP + 0x80]
00800374 : PUSH EAX
00800375 : PUSH ECX
00800376 : MOV ECX,dword ptr [EDX + 0x210]
0080037c : CALL ECX
0080037e : JMP 0x00800390
00800380 : MOV EAX,dword ptr [EBX + 0x18]
00800383 : MOV EDX,dword ptr [EAX]
00800385 : MOV EDX,dword ptr [EDX + 0x40]
00800388 : LEA ECX,[ESP + 0x7c]
0080038c : PUSH ECX
0080038d : PUSH EAX
0080038e : CALL EDX
00800390 : TEST EAX,EAX
00800392 : JGE 0x00800447
00800398 : MOV EAX,dword ptr [EBX + 0x178]
0080039e : LEA ESI,[EAX + 0x48]
008003a1 : MOV ECX,0xe
008003a6 : LEA EDI,[ESP + 0x44]
008003aa : MOVSD.REP ES:EDI,ESI
008003ac : XOR EDI,EDI
008003ae : CMP dword ptr [ESP + 0x54],EDI
008003b2 : JZ 0x008003e4
008003b4 : CMP dword ptr [ESP + 0x58],0x1
008003b9 : JA 0x008003de
008003bb : MOV dword ptr [ESP + 0x54],EDI
008003bf : MOV dword ptr [ESP + 0x58],EDI
008003c3 : LEA EDI,[EAX + 0x48]
008003c6 : MOV ECX,0xe
008003cb : LEA ESI,[ESP + 0x44]
008003cf : PUSH 0x64
008003d1 : MOVSD.REP ES:EDI,ESI
008003d3 : CALL dword ptr [0x00b8510c]
008003d9 : JMP 0x008002e0
008003de : SHR dword ptr [ESP + 0x58],0x1
008003e2 : JMP 0x008003c3
008003e4 : CMP dword ptr [ESP + 0x10],0x3
008003e9 : JGE 0x008003f8
008003eb : PUSH 0x64
008003ed : CALL dword ptr [0x00b8510c]
008003f3 : JMP 0x008002e0
008003f8 : MOV ESI,dword ptr [0x00da98e8]
008003fe : PUSH 0xc27cb8
00800403 : CALL 0x008018d0
00800408 : ADD ESP,0x4
0080040b : MOV dword ptr [ESP + 0xd0],0xffffffff
00800416 : CMP dword ptr [ESP + 0x20],EDI
0080041a : JZ 0x008005b0
00800420 : MOV EAX,dword ptr [ESP + 0x14]
00800424 : PUSH EAX
00800425 : CALL dword ptr [0x00b8511c]
0080042b : MOV dword ptr [ESP + 0x20],EDI
0080042f : MOV ECX,dword ptr [ESP + 0xc8]
00800436 : MOV dword ptr FS:[0x0],ECX
0080043d : POP ECX
0080043e : POP EDI
0080043f : POP ESI
00800440 : POP EBX
00800441 : MOV ESP,EBP
00800443 : POP EBP
00800444 : RET 0x4
00800447 : MOV EAX,dword ptr [EBX + 0x14]
0080044a : MOV ECX,dword ptr [EAX]
0080044c : LEA EDX,[ESP + 0xb4]
00800453 : PUSH EDX
00800454 : MOV EDX,dword ptr [EBX + 0x28]
00800457 : PUSH EDX
00800458 : PUSH EAX
00800459 : MOV EAX,dword ptr [ECX + 0x20]
0080045c : CALL EAX
0080045e : MOV EDX,dword ptr [ESP + 0xc0]
00800465 : MOV EAX,dword ptr [EBX + 0x14]
00800468 : MOV ECX,dword ptr [EAX]
0080046a : PUSH 0x4b
0080046c : PUSH 0x3
0080046e : PUSH 0x2
00800470 : PUSH EDX
00800471 : MOV EDX,dword ptr [EBX + 0x24]
00800474 : PUSH EDX
00800475 : MOV EDX,dword ptr [EBX + 0x28]
00800478 : PUSH EDX
00800479 : PUSH EAX
0080047a : MOV EAX,dword ptr [ECX + 0x28]
0080047d : CALL EAX
0080047f : TEST EAX,EAX
00800481 : JGE 0x008004f0
00800483 : PUSH EAX
00800484 : PUSH 0xc27d00
00800489 : LEA ESI,[ESP + 0x30]
0080048d : CALL 0x00404750
00800492 : ADD ESP,0x8
00800495 : MOV byte ptr [ESP + 0xd0],0x1
0080049d : MOV ECX,dword ptr [0x00da98e8]
008004a3 : MOV ECX,dword ptr [ECX]
008004a5 : TEST ECX,ECX
008004a7 : JZ 0x008004bb
008004a9 : MOV EDX,dword ptr [ECX]
008004ab : PUSH EAX
008004ac : MOV EAX,dword ptr [EDX + 0x14]
008004af : PUSH 0x646
008004b4 : PUSH 0xc27d54
008004b9 : CALL EAX
008004bb : MOV byte ptr [ESP + 0xd0],0x0
008004c3 : CMP dword ptr [ESP + 0x40],0x8
008004c8 : JC 0x008004d3
008004ca : MOV ECX,dword ptr [ESP + 0x2c]
008004ce : CALL 0x006f04e0
008004d3 : XOR ECX,ECX
008004d5 : MOV dword ptr [ESP + 0x40],0x7
008004dd : MOV dword ptr [ESP + 0x3c],0x0
008004e5 : MOV word ptr [ESP + 0x2c],CX
008004ea : MOV byte ptr [EBX + 0x22e],CL
008004f0 : PUSH EBX
008004f1 : CALL 0x007ffdf0
008004f6 : MOV EAX,dword ptr [EBX + 0x4a4]
008004fc : MOV EDX,dword ptr [EBX + 0x18]
008004ff : MOV dword ptr [0x01720efc],EDX
00800505 : TEST EAX,EAX
00800507 : JZ 0x00800578
00800509 : CMP byte ptr [0x00d6ab02],0x0
00800510 : MOV dword ptr [ESP + 0x10],0x5
00800518 : JNZ 0x00800522
0080051a : MOV dword ptr [ESP + 0x10],0xd
00800522 : CMP dword ptr [EBX + 0x20],0x0
00800526 : JZ 0x0080052d
00800528 : OR dword ptr [ESP + 0x10],0x10
0080052d : MOV EBX,dword ptr [EBX + 0x178]
00800533 : LEA ESI,[EBX + 0x48]
00800536 : MOV ECX,0xe
0080053b : LEA EDI,[ESP + 0x44]
0080053f : MOVSD.REP ES:EDI,ESI
00800541 : MOV ECX,dword ptr [ESP + 0x10]
00800545 : MOV ESI,dword ptr [EAX]
00800547 : PUSH 0x0
00800549 : PUSH ECX
0080054a : LEA ECX,[ESP + 0x4c]
0080054e : PUSH ECX
0080054f : PUSH EDX
00800550 : MOV EDX,dword ptr [ESI + 0x8c]
00800556 : MOV ECX,EAX
00800558 : CALL EDX
0080055a : MOV ESI,dword ptr [0x00da98e8]
00800560 : TEST AL,AL
00800562 : JZ 0x0080056b
00800564 : PUSH 0xc27d98
00800569 : JMP 0x00800570
0080056b : PUSH 0xc27df0
00800570 : CALL 0x008018d0
00800575 : ADD ESP,0x4
00800578 : MOV ESI,dword ptr [0x00da98e8]
0080057e : PUSH 0xc27e50
00800583 : CALL 0x008018d0
00800588 : ADD ESP,0x4
0080058b : MOV dword ptr [ESP + 0xd0],0xffffffff
00800596 : CMP dword ptr [ESP + 0x20],0x0
0080059b : JZ 0x008005b0
0080059d : MOV EAX,dword ptr [ESP + 0x14]
008005a1 : PUSH EAX
008005a2 : CALL dword ptr [0x00b8511c]
008005a8 : MOV dword ptr [ESP + 0x20],0x0
008005b0 : MOV ECX,dword ptr [ESP + 0xc8]
008005b7 : MOV dword ptr FS:[0x0],ECX
008005be : POP ECX
008005bf : POP EDI
008005c0 : POP ESI
008005c1 : POP EBX
008005c2 : MOV ESP,EBP
008005c4 : POP EBP
008005c5 : RET 0x4
