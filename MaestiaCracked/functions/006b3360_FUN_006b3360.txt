PROGRAM  : Maestia.exe
FUNCTION : FUN_006b3360
ENTRY    : 006b3360
BODY     : [[006b3360, 006b3535]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_006b3360(undefined4 param_1)

{
  int iVar1;
  int iVar2;
  int iVar3;
  short sVar4;
  uint uVar5;
  byte *pbVar6;
  int *unaff_ESI;
  undefined4 local_1c;
  int local_18;
  int local_10;
  int local_c;
  int local_8;
  int local_4;
  
  iVar1 = unaff_ESI[1];
  iVar2 = *unaff_ESI;
  iVar3 = unaff_ESI[2];
  local_1c = 0x10000;
  if ((*(byte *)(unaff_ESI + 4) & 1) == 0) {
    local_1c = *(undefined4 *)(iVar1 + 0x14);
  }
  if (*(int *)(iVar3 + 0x48) == 0x636f6d70) {
    local_10 = unaff_ESI[9];
    local_c = unaff_ESI[10];
    local_8 = unaff_ESI[0xb];
    local_4 = unaff_ESI[0xc];
  }
  else {
    FUN_00687370(iVar3 + 0x6c,&local_10);
  }
  uVar5 = unaff_ESI[0xf];
  if ((*(int *)(iVar2 + 0x1e0) != 0) && ((unaff_ESI[4] & 0x200U) == 0)) {
    uVar5 = (uint)*(ushort *)(iVar2 + 0xe2);
  }
  *(uint *)(iVar3 + 0x38) = uVar5;
  *(int *)(iVar3 + 0x20) = local_10;
  *(int *)(iVar3 + 0x24) = local_4;
  *(int *)(iVar3 + 0x28) = unaff_ESI[0x13] - unaff_ESI[0x11];
  if ((*(char *)(iVar2 + 0x128) == '\0') || (*(short *)(iVar2 + 0x14e) == 0)) {
    sVar4 = FUN_00685f30(local_4 - local_c,local_1c);
    if (*(short *)(iVar2 + 0x170) == -1) {
      uVar5 = (int)*(short *)(iVar2 + 0xdc) - (int)*(short *)(iVar2 + 0xde);
    }
    else {
      uVar5 = (int)*(short *)(iVar2 + 0x1b6) - (int)*(short *)(iVar2 + 0x1b8);
    }
    local_18 = (int)(uVar5 - (int)sVar4) / 2;
  }
  else {
    sVar4 = FUN_00685f30(unaff_ESI[0x2f] - local_4,local_1c);
    local_18 = (int)sVar4;
    if (unaff_ESI[0x31] < unaff_ESI[0x2f]) {
      uVar5 = FUN_00685f30(unaff_ESI[0x2f] - unaff_ESI[0x31],local_1c);
      uVar5 = uVar5 & 0xffff;
    }
    else {
      uVar5 = 0;
    }
  }
  *(uint *)(iVar3 + 0x3c) = uVar5;
  if ((*(byte *)(unaff_ESI + 4) & 1) == 0) {
    local_18 = FUN_00685ea0(local_18,local_1c);
    uVar5 = FUN_00685ea0(uVar5,local_1c);
  }
  *(uint *)(iVar3 + 0x34) = uVar5;
  *(int *)(iVar3 + 0x2c) = (local_10 - local_8) / 2;
  *(int *)(iVar3 + 0x30) = local_18;
  if ((*(int *)(iVar2 + 0x1e0) == 0) && ((*(byte *)(unaff_ESI + 4) & 2) == 0)) {
    pbVar6 = (byte *)FUN_006b28c0(*(undefined2 *)(iVar1 + 0xc),param_1);
    if (pbVar6 != (byte *)0x0) {
      *(uint *)(iVar3 + 0x28) = (uint)*pbVar6 << 6;
    }
  }
  *(int *)(iVar3 + 0x18) = local_8 - local_10;
  *(int *)(iVar3 + 0x1c) = local_4 - local_c;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
006b3360 : SUB ESP,0x1c
006b3363 : TEST byte ptr [ESI + 0x10],0x1
006b3367 : MOV EAX,dword ptr [ESI + 0x4]
006b336a : PUSH EBX
006b336b : MOV EBX,dword ptr [ESI]
006b336d : PUSH EBP
006b336e : MOV EBP,dword ptr [ESI + 0x8]
006b3371 : PUSH EDI
006b3372 : MOV EDI,0x10000
006b3377 : MOV dword ptr [ESP + 0x14],EAX
006b337b : MOV dword ptr [ESP + 0xc],EDI
006b337f : JNZ 0x006b338a
006b3381 : MOV EAX,dword ptr [EAX + 0x14]
006b3384 : MOV dword ptr [ESP + 0xc],EAX
006b3388 : MOV EDI,EAX
006b338a : CMP dword ptr [EBP + 0x48],0x636f6d70
006b3391 : JZ 0x006b33a6
006b3393 : LEA ECX,[ESP + 0x18]
006b3397 : PUSH ECX
006b3398 : LEA EDX,[EBP + 0x6c]
006b339b : PUSH EDX
006b339c : CALL 0x00687370
006b33a1 : ADD ESP,0x8
006b33a4 : JMP 0x006b33c2
006b33a6 : MOV EAX,dword ptr [ESI + 0x24]
006b33a9 : MOV ECX,dword ptr [ESI + 0x28]
006b33ac : MOV EDX,dword ptr [ESI + 0x2c]
006b33af : MOV dword ptr [ESP + 0x18],EAX
006b33b3 : MOV EAX,dword ptr [ESI + 0x30]
006b33b6 : MOV dword ptr [ESP + 0x1c],ECX
006b33ba : MOV dword ptr [ESP + 0x20],EDX
006b33be : MOV dword ptr [ESP + 0x24],EAX
006b33c2 : CMP dword ptr [EBX + 0x1e0],0x0
006b33c9 : MOV EAX,dword ptr [ESI + 0x3c]
006b33cc : JZ 0x006b33de
006b33ce : TEST dword ptr [ESI + 0x10],0x200
006b33d5 : JNZ 0x006b33de
006b33d7 : MOVZX EAX,word ptr [EBX + 0xe2]
006b33de : MOV dword ptr [EBP + 0x38],EAX
006b33e1 : MOV ECX,dword ptr [ESP + 0x18]
006b33e5 : MOV dword ptr [EBP + 0x20],ECX
006b33e8 : MOV EDX,dword ptr [ESP + 0x24]
006b33ec : MOV dword ptr [EBP + 0x24],EDX
006b33ef : MOV EAX,dword ptr [ESI + 0x4c]
006b33f2 : SUB EAX,dword ptr [ESI + 0x44]
006b33f5 : MOV dword ptr [EBP + 0x28],EAX
006b33f8 : CMP byte ptr [EBX + 0x128],0x0
006b33ff : JZ 0x006b344b
006b3401 : CMP word ptr [EBX + 0x14e],0x0
006b3409 : JBE 0x006b344b
006b340b : MOV ECX,dword ptr [ESI + 0xbc]
006b3411 : SUB ECX,dword ptr [ESP + 0x24]
006b3415 : PUSH EDI
006b3416 : PUSH ECX
006b3417 : CALL 0x00685f30
006b341c : MOV ECX,dword ptr [ESI + 0xc4]
006b3422 : MOVSX EDX,AX
006b3425 : MOV EAX,dword ptr [ESI + 0xbc]
006b342b : ADD ESP,0x8
006b342e : CMP EAX,ECX
006b3430 : MOV dword ptr [ESP + 0x10],EDX
006b3434 : JG 0x006b343a
006b3436 : XOR EDI,EDI
006b3438 : JMP 0x006b349d
006b343a : SUB EAX,ECX
006b343c : PUSH EDI
006b343d : PUSH EAX
006b343e : CALL 0x00685f30
006b3443 : ADD ESP,0x8
006b3446 : MOVZX EDI,AX
006b3449 : JMP 0x006b349d
006b344b : MOV EAX,dword ptr [ESP + 0x24]
006b344f : SUB EAX,dword ptr [ESP + 0x1c]
006b3453 : PUSH EDI
006b3454 : PUSH EAX
006b3455 : CALL 0x00685f30
006b345a : MOV EDX,0xffff
006b345f : ADD ESP,0x8
006b3462 : MOVSX ECX,AX
006b3465 : CMP word ptr [EBX + 0x170],DX
006b346c : JZ 0x006b3480
006b346e : MOVSX EAX,word ptr [EBX + 0x1b8]
006b3475 : MOVSX EDI,word ptr [EBX + 0x1b6]
006b347c : SUB EDI,EAX
006b347e : JMP 0x006b3490
006b3480 : MOVSX EDX,word ptr [EBX + 0xde]
006b3487 : MOVSX EDI,word ptr [EBX + 0xdc]
006b348e : SUB EDI,EDX
006b3490 : MOV EAX,EDI
006b3492 : SUB EAX,ECX
006b3494 : CDQ
006b3495 : SUB EAX,EDX
006b3497 : SAR EAX,0x1
006b3499 : MOV dword ptr [ESP + 0x10],EAX
006b349d : MOV dword ptr [EBP + 0x3c],EDI
006b34a0 : TEST byte ptr [ESI + 0x10],0x1
006b34a4 : JNZ 0x006b34c9
006b34a6 : MOV EAX,dword ptr [ESP + 0xc]
006b34aa : MOV ECX,dword ptr [ESP + 0x10]
006b34ae : PUSH EAX
006b34af : PUSH ECX
006b34b0 : CALL 0x00685ea0
006b34b5 : MOV EDX,dword ptr [ESP + 0x14]
006b34b9 : PUSH EDX
006b34ba : PUSH EDI
006b34bb : MOV dword ptr [ESP + 0x20],EAX
006b34bf : CALL 0x00685ea0
006b34c4 : ADD ESP,0x10
006b34c7 : MOV EDI,EAX
006b34c9 : MOV EAX,dword ptr [ESP + 0x18]
006b34cd : SUB EAX,dword ptr [ESP + 0x20]
006b34d1 : MOV dword ptr [EBP + 0x34],EDI
006b34d4 : CDQ
006b34d5 : SUB EAX,EDX
006b34d7 : SAR EAX,0x1
006b34d9 : MOV dword ptr [EBP + 0x2c],EAX
006b34dc : MOV EAX,dword ptr [ESP + 0x10]
006b34e0 : MOV dword ptr [EBP + 0x30],EAX
006b34e3 : CMP dword ptr [EBX + 0x1e0],0x0
006b34ea : JNZ 0x006b3517
006b34ec : TEST byte ptr [ESI + 0x10],0x2
006b34f0 : JNZ 0x006b3517
006b34f2 : MOV EDX,dword ptr [ESP + 0x14]
006b34f6 : MOVZX EAX,word ptr [EDX + 0xc]
006b34fa : MOV ECX,dword ptr [ESP + 0x2c]
006b34fe : PUSH ECX
006b34ff : PUSH EAX
006b3500 : MOV EDX,EBX
006b3502 : CALL 0x006b28c0
006b3507 : ADD ESP,0x8
006b350a : TEST EAX,EAX
006b350c : JZ 0x006b3517
006b350e : MOVZX ECX,byte ptr [EAX]
006b3511 : SHL ECX,0x6
006b3514 : MOV dword ptr [EBP + 0x28],ECX
006b3517 : MOV EDX,dword ptr [ESP + 0x20]
006b351b : SUB EDX,dword ptr [ESP + 0x18]
006b351f : POP EDI
006b3520 : MOV dword ptr [EBP + 0x18],EDX
006b3523 : MOV EAX,dword ptr [ESP + 0x20]
006b3527 : SUB EAX,dword ptr [ESP + 0x18]
006b352b : MOV dword ptr [EBP + 0x1c],EAX
006b352e : POP EBP
006b352f : XOR EAX,EAX
006b3531 : POP EBX
006b3532 : ADD ESP,0x1c
006b3535 : RET
