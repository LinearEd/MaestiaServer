PROGRAM  : Maestia.exe
FUNCTION : FUN_00a0f980
ENTRY    : 00a0f980
BODY     : [[00a0f980, 00a0fa31] [00a0fa63, 00a0fae6] [00a0fb18, 00a0fb45]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a0f980(int *param_1)

{
  int *piVar1;
  int iVar2;
  uint uVar3;
  LONG LVar4;
  uint uVar5;
  int iVar6;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  puStack_c = &LAB_00b1160f;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_8 = 1;
  if (param_1[7] != 0) {
    piVar1 = (int *)*param_1;
    uVar5 = (uint)param_1[6] >> 2;
    if (piVar1 == (int *)0x0) {
      iVar6 = 0;
    }
    else {
      iVar6 = *piVar1;
    }
    if (*(uint *)(iVar6 + 0x14) <= uVar5) {
      if (piVar1 == (int *)0x0) {
        iVar6 = 0;
      }
      else {
        iVar6 = *piVar1;
      }
      uVar5 = uVar5 - *(int *)(iVar6 + 0x14);
    }
    if (piVar1 == (int *)0x0) {
      iVar6 = 0;
    }
    else {
      iVar6 = *piVar1;
    }
    iVar6 = *(int *)(*(int *)(*(int *)(iVar6 + 0x10) + uVar5 * 4) + (param_1[6] & 3U) * 4);
    iVar2 = *(int *)(iVar6 + 4);
    LVar4 = InterlockedDecrement((LONG *)(iVar2 + 4));
    if ((LVar4 == 0) && (iVar2 != 0)) {
      if (*(int *)(iVar2 + 8) != 0) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0(uVar3);
      }
      *(undefined4 *)(iVar2 + 8) = 0;
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0(uVar3);
    }
    *(undefined4 *)(iVar6 + 4) = 0;
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0(uVar3);
  }
  if (param_1[0xf] == 0) {
    local_8 = 0;
    FUN_004101d0(param_1 + 8);
    local_8 = 0xffffffff;
    FUN_004101d0(param_1);
    ExceptionList = local_10;
    return;
  }
  piVar1 = (int *)param_1[8];
  uVar5 = (uint)param_1[0xe] >> 2;
  if (piVar1 == (int *)0x0) {
    iVar6 = 0;
  }
  else {
    iVar6 = *piVar1;
  }
  if (*(uint *)(iVar6 + 0x14) <= uVar5) {
    if (piVar1 == (int *)0x0) {
      iVar6 = 0;
    }
    else {
      iVar6 = *piVar1;
    }
    uVar5 = uVar5 - *(int *)(iVar6 + 0x14);
  }
  if (piVar1 == (int *)0x0) {
    iVar6 = 0;
  }
  else {
    iVar6 = *piVar1;
  }
  iVar6 = *(int *)(*(int *)(*(int *)(iVar6 + 0x10) + uVar5 * 4) + (param_1[0xe] & 3U) * 4);
  iVar2 = *(int *)(iVar6 + 4);
  LVar4 = InterlockedDecrement((LONG *)(iVar2 + 4));
  if ((LVar4 == 0) && (iVar2 != 0)) {
    if (*(int *)(iVar2 + 8) != 0) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0(uVar3);
    }
    *(undefined4 *)(iVar2 + 8) = 0;
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0(uVar3);
  }
  *(undefined4 *)(iVar6 + 4) = 0;
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0(uVar3);
}



============================================================
DISASSEMBLY
============================================================
00a0f980 : PUSH EBP
00a0f981 : MOV EBP,ESP
00a0f983 : PUSH -0x1
00a0f985 : PUSH 0xb1160f
00a0f98a : MOV EAX,FS:[0x0]
00a0f990 : PUSH EAX
00a0f991 : PUSH EBX
00a0f992 : PUSH ESI
00a0f993 : PUSH EDI
00a0f994 : MOV EAX,[0x00d66fa0]
00a0f999 : XOR EAX,EBP
00a0f99b : PUSH EAX
00a0f99c : LEA EAX,[EBP + -0xc]
00a0f99f : MOV FS:[0x0],EAX
00a0f9a5 : MOV ESI,dword ptr [EBP + 0x8]
00a0f9a8 : MOV dword ptr [EBP + -0x4],0x1
00a0f9af : CMP dword ptr [ESI + 0x1c],0x0
00a0f9b3 : JZ 0x00a0fa63
00a0f9b9 : MOV EAX,dword ptr [ESI + 0x18]
00a0f9bc : MOV EDX,dword ptr [ESI]
00a0f9be : MOV ECX,EAX
00a0f9c0 : SHR ECX,0x2
00a0f9c3 : AND EAX,0x3
00a0f9c6 : TEST EDX,EDX
00a0f9c8 : JZ 0x00a0f9ce
00a0f9ca : MOV EDI,dword ptr [EDX]
00a0f9cc : JMP 0x00a0f9d0
00a0f9ce : XOR EDI,EDI
00a0f9d0 : CMP dword ptr [EDI + 0x14],ECX
00a0f9d3 : JA 0x00a0f9e2
00a0f9d5 : TEST EDX,EDX
00a0f9d7 : JZ 0x00a0f9dd
00a0f9d9 : MOV EDI,dword ptr [EDX]
00a0f9db : JMP 0x00a0f9df
00a0f9dd : XOR EDI,EDI
00a0f9df : SUB ECX,dword ptr [EDI + 0x14]
00a0f9e2 : TEST EDX,EDX
00a0f9e4 : JZ 0x00a0f9ea
00a0f9e6 : MOV EDX,dword ptr [EDX]
00a0f9e8 : JMP 0x00a0f9ec
00a0f9ea : XOR EDX,EDX
00a0f9ec : MOV EDX,dword ptr [EDX + 0x10]
00a0f9ef : MOV ECX,dword ptr [EDX + ECX*0x4]
00a0f9f2 : MOV EBX,dword ptr [ECX + EAX*0x4]
00a0f9f5 : MOV EDI,dword ptr [EBX + 0x4]
00a0f9f8 : LEA EDX,[EDI + 0x4]
00a0f9fb : PUSH EDX
00a0f9fc : CALL dword ptr [0x00b851b0]
00a0fa02 : TEST EAX,EAX
00a0fa04 : JNZ 0x00a0fa24
00a0fa06 : TEST EDI,EDI
00a0fa08 : JZ 0x00a0fa24
00a0fa0a : MOV ECX,dword ptr [EDI + 0x8]
00a0fa0d : TEST ECX,ECX
00a0fa0f : JZ 0x00a0fa16
00a0fa11 : CALL 0x006f04e0
00a0fa16 : MOV ECX,EDI
00a0fa18 : MOV dword ptr [EDI + 0x8],0x0
00a0fa1f : CALL 0x006f04e0
00a0fa24 : MOV ECX,EBX
00a0fa26 : MOV dword ptr [EBX + 0x4],0x0
00a0fa2d : CALL 0x006f04e0
00a0fa63 : CMP dword ptr [ESI + 0x3c],0x0
00a0fa67 : JZ 0x00a0fb18
00a0fa6d : MOV EAX,dword ptr [ESI + 0x38]
00a0fa70 : MOV EDX,dword ptr [ESI + 0x20]
00a0fa73 : MOV ECX,EAX
00a0fa75 : SHR ECX,0x2
00a0fa78 : AND EAX,0x3
00a0fa7b : TEST EDX,EDX
00a0fa7d : JZ 0x00a0fa83
00a0fa7f : MOV EDI,dword ptr [EDX]
00a0fa81 : JMP 0x00a0fa85
00a0fa83 : XOR EDI,EDI
00a0fa85 : CMP dword ptr [EDI + 0x14],ECX
00a0fa88 : JA 0x00a0fa97
00a0fa8a : TEST EDX,EDX
00a0fa8c : JZ 0x00a0fa92
00a0fa8e : MOV EDI,dword ptr [EDX]
00a0fa90 : JMP 0x00a0fa94
00a0fa92 : XOR EDI,EDI
00a0fa94 : SUB ECX,dword ptr [EDI + 0x14]
00a0fa97 : TEST EDX,EDX
00a0fa99 : JZ 0x00a0fa9f
00a0fa9b : MOV EDX,dword ptr [EDX]
00a0fa9d : JMP 0x00a0faa1
00a0fa9f : XOR EDX,EDX
00a0faa1 : MOV EDX,dword ptr [EDX + 0x10]
00a0faa4 : MOV ECX,dword ptr [EDX + ECX*0x4]
00a0faa7 : MOV EBX,dword ptr [ECX + EAX*0x4]
00a0faaa : MOV EDI,dword ptr [EBX + 0x4]
00a0faad : LEA EDX,[EDI + 0x4]
00a0fab0 : PUSH EDX
00a0fab1 : CALL dword ptr [0x00b851b0]
00a0fab7 : TEST EAX,EAX
00a0fab9 : JNZ 0x00a0fad9
00a0fabb : TEST EDI,EDI
00a0fabd : JZ 0x00a0fad9
00a0fabf : MOV ECX,dword ptr [EDI + 0x8]
00a0fac2 : TEST ECX,ECX
00a0fac4 : JZ 0x00a0facb
00a0fac6 : CALL 0x006f04e0
00a0facb : MOV ECX,EDI
00a0facd : MOV dword ptr [EDI + 0x8],0x0
00a0fad4 : CALL 0x006f04e0
00a0fad9 : MOV ECX,EBX
00a0fadb : MOV dword ptr [EBX + 0x4],0x0
00a0fae2 : CALL 0x006f04e0
00a0fb18 : MOV byte ptr [EBP + -0x4],0x0
00a0fb1c : LEA EAX,[ESI + 0x20]
00a0fb1f : PUSH EAX
00a0fb20 : CALL 0x004101d0
00a0fb25 : MOV dword ptr [EBP + -0x4],0xffffffff
00a0fb2c : PUSH ESI
00a0fb2d : CALL 0x004101d0
00a0fb32 : MOV ECX,dword ptr [EBP + -0xc]
00a0fb35 : MOV dword ptr FS:[0x0],ECX
00a0fb3c : POP ECX
00a0fb3d : POP EDI
00a0fb3e : POP ESI
00a0fb3f : POP EBX
00a0fb40 : MOV ESP,EBP
00a0fb42 : POP EBP
00a0fb43 : RET 0x4
