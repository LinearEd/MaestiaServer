PROGRAM  : Maestia.exe
FUNCTION : FUN_0089b970
ENTRY    : 0089b970
BODY     : [[0089b970, 0089bd92]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0089b970(void)

{
  char cVar1;
  DWORD DVar2;
  int *piVar3;
  int iVar4;
  int *in_ECX;
  float fVar5;
  float fVar6;
  float fVar7;
  undefined1 local_44 [4];
  undefined2 local_40;
  undefined4 local_30;
  uint local_2c;
  float local_28;
  undefined4 local_24;
  undefined4 local_20;
  float local_1c;
  float local_18;
  float local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b5fb6a;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  if ((int *)in_ECX[0xfb] != (int *)0x0) {
    (**(code **)(*(int *)in_ECX[0xfb] + 0x68))(0,1,DAT_00d66fa0 ^ (uint)&stack0xfffffffc);
  }
  if ((char)in_ECX[0x5f] != '\0') {
    FUN_0088d210();
  }
  if (in_ECX[0xfa] != 0) {
    local_14 = (float)in_ECX[0x129] - (float)in_ECX[0x69];
    local_18 = (float)in_ECX[0x12a] - (float)in_ECX[0x6a];
    local_1c = (float)in_ECX[299] - (float)in_ECX[0x6b];
    DVar2 = timeGetTime();
    if ((400.0 < local_14 * local_14 + local_18 * local_18 + local_1c * local_1c) ||
       (999 < DVar2 - in_ECX[300])) {
      in_ECX[0x129] = in_ECX[0x69];
      in_ECX[0x12a] = in_ECX[0x6a];
      in_ECX[299] = in_ECX[0x6b];
      DVar2 = timeGetTime();
      in_ECX[300] = DVar2;
      FUN_007d6e30();
    }
    iVar4 = in_ECX[0xfa];
    fVar5 = (float)in_ECX[0x12d] - *(float *)(iVar4 + 0x68);
    fVar6 = (float)in_ECX[0x12e] - *(float *)(iVar4 + 0x6c);
    fVar7 = (float)in_ECX[0x12f] - *(float *)(iVar4 + 0x70);
    if (1.0 < fVar5 * fVar5 + fVar6 * fVar6 + fVar7 * fVar7) {
      FUN_0088d490();
    }
    (**(code **)(*in_ECX + 0x240))();
    FUN_008898e0();
    FUN_0088f770();
    cVar1 = (**(code **)(*in_ECX + 0x200))();
    if ((cVar1 == '\0') && (in_ECX[0xe3] != 0)) {
      FUN_00a6b960(in_ECX[0xe3]);
    }
    FUN_008886b0();
    FUN_00891fd0();
    FUN_00898f60(in_ECX);
    FUN_008884a0(in_ECX);
    FUN_0088aaf0(in_ECX);
    FUN_0088ac90();
  }
  FUN_0088c3f0(in_ECX);
  FUN_0088aa10();
  if (in_ECX[0x55f] == 0) {
    FUN_00876080();
  }
  in_ECX[0x55f] = 0;
  if (in_ECX[0x165] != 0) {
    FUN_00880920(in_ECX[0x165]);
  }
  if (*(char *)((int)in_ECX + 0x3ae) == '\x01') {
    FUN_00889ad0(0,1);
    cVar1 = (**(code **)(*(int *)in_ECX[0xfa] + 0x78))();
    if ((cVar1 != '\0') && (in_ECX[0xfa] != 0)) {
      FUN_007d48a0(0,0);
    }
    if ((int *)in_ECX[0xfd] != (int *)0x0) {
      (**(code **)(*(int *)in_ECX[0xfd] + 0x120))(0,0);
    }
  }
  if (in_ECX[0x59c] != 0) {
    DVar2 = timeGetTime();
    local_1c = (float)(DVar2 - in_ECX[0x59c]);
    local_14 = (float)(int)local_1c;
    if ((int)local_1c < 0) {
      local_14 = local_14 + 4.2949673e+09;
    }
    local_14 = local_14 * 0.00033333333;
    if (0.0 <= local_14) {
      if (1.0 < local_14) {
        local_14 = 1.0;
      }
    }
    else {
      local_14 = 0.0;
    }
    local_14 = 1.0 - local_14;
    if (in_ECX[0xfa] != 0) {
      FUN_007cd320(0,local_14);
    }
    if ((local_14 == 0.0) && ((int *)in_ECX[0xfd] != (int *)0x0)) {
      (**(code **)(*(int *)in_ECX[0xfd] + 0x120))(0,0);
    }
  }
  if ((char)in_ECX[0x59d] != '\0') {
    FUN_00406460(L"sword_z_fx_red.cfx");
    local_8 = 0;
    piVar3 = (int *)FUN_00a6bd50(local_44);
    local_8 = 0xffffffff;
    if (7 < local_2c) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_2c = 7;
    local_30 = 0;
    local_40 = 0;
    if (piVar3 != (int *)0x0) {
      cVar1 = (**(code **)(*piVar3 + 0x30))();
      if (cVar1 != '\0') {
        FUN_00406460(L"sword_z_fx_stop_red.cfx");
        local_8 = 1;
        FUN_008980b0(local_44,1);
        local_8 = 0xffffffff;
        FUN_00406560();
        FUN_00406460(L"sword_z_fx_stop_red.cfx");
        local_8 = 2;
        iVar4 = FUN_00a6bd50(local_44);
        local_8 = 0xffffffff;
        FUN_00406560();
        if ((iVar4 != 0) && (iVar4 = *(int *)(iVar4 + 0x14), iVar4 != 0)) {
          local_24 = *(undefined4 *)(iVar4 + 0x6c);
          local_28 = *(float *)(iVar4 + 0x68) - 2.0;
          local_20 = *(undefined4 *)(iVar4 + 0x70);
          FUN_00404130();
        }
        *(undefined1 *)(in_ECX + 0x59d) = 0;
      }
    }
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
0089b970 : PUSH EBP
0089b971 : MOV EBP,ESP
0089b973 : PUSH -0x1
0089b975 : PUSH 0xb5fb6a
0089b97a : MOV EAX,FS:[0x0]
0089b980 : PUSH EAX
0089b981 : SUB ESP,0x34
0089b984 : PUSH EBX
0089b985 : PUSH ESI
0089b986 : PUSH EDI
0089b987 : MOV EAX,[0x00d66fa0]
0089b98c : XOR EAX,EBP
0089b98e : PUSH EAX
0089b98f : LEA EAX,[EBP + -0xc]
0089b992 : MOV FS:[0x0],EAX
0089b998 : MOV EDI,ECX
0089b99a : MOV ECX,dword ptr [EDI + 0x3ec]
0089b9a0 : XOR EBX,EBX
0089b9a2 : CMP ECX,EBX
0089b9a4 : JZ 0x0089b9b0
0089b9a6 : MOV EAX,dword ptr [ECX]
0089b9a8 : MOV EDX,dword ptr [EAX + 0x68]
0089b9ab : PUSH 0x1
0089b9ad : PUSH EBX
0089b9ae : CALL EDX
0089b9b0 : CMP byte ptr [EDI + 0x17c],BL
0089b9b6 : JZ 0x0089b9bf
0089b9b8 : MOV EAX,EDI
0089b9ba : CALL 0x0088d210
0089b9bf : CMP dword ptr [EDI + 0x3e8],EBX
0089b9c5 : JZ 0x0089bb51
0089b9cb : MOVSS XMM0,dword ptr [EDI + 0x4a4]
0089b9d3 : SUBSS XMM0,dword ptr [EDI + 0x1a4]
0089b9db : MOV ESI,dword ptr [0x00b85598]
0089b9e1 : MOVSS dword ptr [EBP + -0x10],XMM0
0089b9e6 : MOVSS XMM0,dword ptr [EDI + 0x4a8]
0089b9ee : SUBSS XMM0,dword ptr [EDI + 0x1a8]
0089b9f6 : MOVSS dword ptr [EBP + -0x14],XMM0
0089b9fb : MOVSS XMM0,dword ptr [EDI + 0x4ac]
0089ba03 : SUBSS XMM0,dword ptr [EDI + 0x1ac]
0089ba0b : MOVSS dword ptr [EBP + -0x18],XMM0
0089ba10 : CALL ESI
0089ba12 : MOVSS XMM0,dword ptr [EBP + -0x10]
0089ba17 : SUB EAX,dword ptr [EDI + 0x4b0]
0089ba1d : MOVAPS XMM1,XMM0
0089ba20 : MULSS XMM1,XMM0
0089ba24 : MOVSS XMM0,dword ptr [EBP + -0x14]
0089ba29 : MOVAPS XMM2,XMM0
0089ba2c : MULSS XMM2,XMM0
0089ba30 : MOVSS XMM0,dword ptr [EBP + -0x18]
0089ba35 : ADDSS XMM1,XMM2
0089ba39 : MOVAPS XMM2,XMM0
0089ba3c : MULSS XMM2,XMM0
0089ba40 : ADDSS XMM1,XMM2
0089ba44 : COMISS XMM1,dword ptr [0x00cdf7d4]
0089ba4b : JA 0x0089ba54
0089ba4d : CMP EAX,0x3e8
0089ba52 : JC 0x0089ba8b
0089ba54 : FLD float ptr [EDI + 0x1a4]
0089ba5a : FSTP float ptr [EDI + 0x4a4]
0089ba60 : FLD float ptr [EDI + 0x1a8]
0089ba66 : FSTP float ptr [EDI + 0x4a8]
0089ba6c : FLD float ptr [EDI + 0x1ac]
0089ba72 : FSTP float ptr [EDI + 0x4ac]
0089ba78 : CALL ESI
0089ba7a : MOV ESI,dword ptr [EDI + 0x3e8]
0089ba80 : MOV dword ptr [EDI + 0x4b0],EAX
0089ba86 : CALL 0x007d6e30
0089ba8b : MOV EAX,dword ptr [EDI + 0x3e8]
0089ba91 : MOVSS XMM1,dword ptr [EAX + 0x68]
0089ba96 : MOVSS XMM0,dword ptr [EDI + 0x4b4]
0089ba9e : MOVSS XMM2,dword ptr [EAX + 0x6c]
0089baa3 : MOVSS XMM3,dword ptr [EAX + 0x70]
0089baa8 : SUBSS XMM0,XMM1
0089baac : MOVSS XMM1,dword ptr [EDI + 0x4b8]
0089bab4 : ADD EAX,0x68
0089bab7 : SUBSS XMM1,XMM2
0089babb : MOVSS XMM2,dword ptr [EDI + 0x4bc]
0089bac3 : SUBSS XMM2,XMM3
0089bac7 : MOVAPS XMM3,XMM0
0089baca : MULSS XMM3,XMM0
0089bace : MOVAPS XMM0,XMM1
0089bad1 : MULSS XMM0,XMM1
0089bad5 : ADDSS XMM3,XMM0
0089bad9 : MOVAPS XMM0,XMM2
0089badc : MULSS XMM0,XMM2
0089bae0 : ADDSS XMM3,XMM0
0089bae4 : COMISS XMM3,dword ptr [0x00c10fc4]
0089baeb : JBE 0x0089baf4
0089baed : MOV ESI,EDI
0089baef : CALL 0x0088d490
0089baf4 : MOV EAX,dword ptr [EDI]
0089baf6 : MOV EDX,dword ptr [EAX + 0x240]
0089bafc : MOV ECX,EDI
0089bafe : CALL EDX
0089bb00 : MOV ESI,EDI
0089bb02 : CALL 0x008898e0
0089bb07 : MOV EAX,EDI
0089bb09 : CALL 0x0088f770
0089bb0e : MOV EAX,dword ptr [EDI]
0089bb10 : MOV EDX,dword ptr [EAX + 0x200]
0089bb16 : MOV ECX,EDI
0089bb18 : CALL EDX
0089bb1a : TEST AL,AL
0089bb1c : JNZ 0x0089bb2e
0089bb1e : MOV EAX,dword ptr [EDI + 0x38c]
0089bb24 : CMP EAX,EBX
0089bb26 : JZ 0x0089bb2e
0089bb28 : PUSH EAX
0089bb29 : CALL 0x00a6b960
0089bb2e : CALL 0x008886b0
0089bb33 : CALL 0x00891fd0
0089bb38 : PUSH EDI
0089bb39 : CALL 0x00898f60
0089bb3e : PUSH EDI
0089bb3f : CALL 0x008884a0
0089bb44 : PUSH EDI
0089bb45 : CALL 0x0088aaf0
0089bb4a : MOV EAX,EDI
0089bb4c : CALL 0x0088ac90
0089bb51 : PUSH EDI
0089bb52 : CALL 0x0088c3f0
0089bb57 : MOV EAX,EDI
0089bb59 : CALL 0x0088aa10
0089bb5e : CMP dword ptr [EDI + 0x157c],EBX
0089bb64 : JNZ 0x0089bb7b
0089bb66 : MOV EAX,dword ptr [EDI + 0x138]
0089bb6c : MOV ECX,dword ptr [EAX + 0x4]
0089bb6f : LEA EAX,[ECX + EDI*0x1 + 0x138]
0089bb76 : CALL 0x00876080
0089bb7b : MOV EAX,dword ptr [EDI + 0x594]
0089bb81 : MOV dword ptr [EDI + 0x157c],EBX
0089bb87 : CMP EAX,EBX
0089bb89 : JZ 0x0089bb91
0089bb8b : PUSH EAX
0089bb8c : CALL 0x00880920
0089bb91 : CMP byte ptr [EDI + 0x3ae],0x1
0089bb98 : JNZ 0x0089bbdc
0089bb9a : PUSH 0x1
0089bb9c : PUSH EBX
0089bb9d : MOV ESI,EDI
0089bb9f : CALL 0x00889ad0
0089bba4 : MOV ECX,dword ptr [EDI + 0x3e8]
0089bbaa : MOV EDX,dword ptr [ECX]
0089bbac : MOV EAX,dword ptr [EDX + 0x78]
0089bbaf : CALL EAX
0089bbb1 : TEST AL,AL
0089bbb3 : JZ 0x0089bbc6
0089bbb5 : MOV ECX,dword ptr [EDI + 0x3e8]
0089bbbb : CMP ECX,EBX
0089bbbd : JZ 0x0089bbc6
0089bbbf : PUSH EBX
0089bbc0 : PUSH EBX
0089bbc1 : CALL 0x007d48a0
0089bbc6 : MOV ECX,dword ptr [EDI + 0x3f4]
0089bbcc : CMP ECX,EBX
0089bbce : JZ 0x0089bbdc
0089bbd0 : MOV EDX,dword ptr [ECX]
0089bbd2 : MOV EAX,dword ptr [EDX + 0x120]
0089bbd8 : PUSH EBX
0089bbd9 : PUSH EBX
0089bbda : CALL EAX
0089bbdc : CMP dword ptr [EDI + 0x1670],EBX
0089bbe2 : JBE 0x0089bc77
0089bbe8 : CALL dword ptr [0x00b85598]
0089bbee : SUB EAX,dword ptr [EDI + 0x1670]
0089bbf4 : MOV dword ptr [EBP + -0x18],EAX
0089bbf7 : FILD dword ptr [EBP + -0x18]
0089bbfa : TEST EAX,EAX
0089bbfc : JGE 0x0089bc04
0089bbfe : FADD float ptr [0x00cdf0e0]
0089bc04 : FMUL float ptr [0x00cdf590]
0089bc0a : MOVSS XMM0,dword ptr [0x00c10fc4]
0089bc12 : FST float ptr [EBP + -0x10]
0089bc15 : FLDZ
0089bc17 : FCOMIP ST0,ST1
0089bc19 : FSTP ST0
0089bc1b : JBE 0x0089bc22
0089bc1d : XORPS XMM1,XMM1
0089bc20 : JMP 0x0089bc2f
0089bc22 : MOVSS XMM1,dword ptr [EBP + -0x10]
0089bc27 : COMISS XMM1,XMM0
0089bc2a : JBE 0x0089bc2f
0089bc2c : MOVAPS XMM1,XMM0
0089bc2f : MOV ECX,dword ptr [EDI + 0x3e8]
0089bc35 : SUBSS XMM0,XMM1
0089bc39 : MOVSS dword ptr [EBP + -0x10],XMM0
0089bc3e : CMP ECX,EBX
0089bc40 : JZ 0x0089bc4f
0089bc42 : FLD float ptr [EBP + -0x10]
0089bc45 : PUSH ECX
0089bc46 : FSTP float ptr [ESP]
0089bc49 : PUSH EBX
0089bc4a : CALL 0x007cd320
0089bc4f : MOVSS XMM0,dword ptr [EBP + -0x10]
0089bc54 : UCOMISS XMM0,dword ptr [0x00b9b0b4]
0089bc5b : LAHF
0089bc5c : TEST AH,0x44
0089bc5f : JP 0x0089bc77
0089bc61 : MOV ECX,dword ptr [EDI + 0x3f4]
0089bc67 : CMP ECX,EBX
0089bc69 : JZ 0x0089bc77
0089bc6b : MOV EDX,dword ptr [ECX]
0089bc6d : MOV EAX,dword ptr [EDX + 0x120]
0089bc73 : PUSH EBX
0089bc74 : PUSH EBX
0089bc75 : CALL EAX
0089bc77 : CMP byte ptr [EDI + 0x1674],BL
0089bc7d : JZ 0x0089bd81
0089bc83 : PUSH 0xc4618c
0089bc88 : LEA ECX,[EBP + -0x40]
0089bc8b : CALL 0x00406460
0089bc90 : MOV dword ptr [EBP + -0x4],EBX
0089bc93 : LEA ECX,[EBP + -0x40]
0089bc96 : PUSH ECX
0089bc97 : MOV ECX,dword ptr [EDI + 0x38c]
0089bc9d : CALL 0x00a6bd50
0089bca2 : OR EBX,0xffffffff
0089bca5 : MOV ESI,EAX
0089bca7 : MOV dword ptr [EBP + -0x4],EBX
0089bcaa : CMP dword ptr [EBP + -0x28],0x8
0089bcae : JC 0x0089bcb8
0089bcb0 : MOV ECX,dword ptr [EBP + -0x3c]
0089bcb3 : CALL 0x006f04e0
0089bcb8 : XOR EDX,EDX
0089bcba : MOV dword ptr [EBP + -0x28],0x7
0089bcc1 : MOV dword ptr [EBP + -0x2c],0x0
0089bcc8 : MOV word ptr [EBP + -0x3c],DX
0089bccc : TEST ESI,ESI
0089bcce : JZ 0x0089bd81
0089bcd4 : MOV EAX,dword ptr [ESI]
0089bcd6 : MOV EDX,dword ptr [EAX + 0x30]
0089bcd9 : MOV ECX,ESI
0089bcdb : CALL EDX
0089bcdd : TEST AL,AL
0089bcdf : JZ 0x0089bd81
0089bce5 : PUSH 0xc461b4
0089bcea : LEA ECX,[EBP + -0x40]
0089bced : CALL 0x00406460
0089bcf2 : MOV dword ptr [EBP + -0x4],0x1
0089bcf9 : PUSH 0x1
0089bcfb : LEA EAX,[EBP + -0x40]
0089bcfe : PUSH EAX
0089bcff : MOV ESI,EDI
0089bd01 : CALL 0x008980b0
0089bd06 : MOV dword ptr [EBP + -0x4],EBX
0089bd09 : LEA ECX,[EBP + -0x40]
0089bd0c : CALL 0x00406560
0089bd11 : PUSH 0xc461e4
0089bd16 : LEA ECX,[EBP + -0x40]
0089bd19 : CALL 0x00406460
0089bd1e : MOV dword ptr [EBP + -0x4],0x2
0089bd25 : LEA ECX,[EBP + -0x40]
0089bd28 : PUSH ECX
0089bd29 : MOV ECX,dword ptr [EDI + 0x38c]
0089bd2f : CALL 0x00a6bd50
0089bd34 : MOV ESI,EAX
0089bd36 : MOV dword ptr [EBP + -0x4],EBX
0089bd39 : LEA ECX,[EBP + -0x40]
0089bd3c : CALL 0x00406560
0089bd41 : TEST ESI,ESI
0089bd43 : JZ 0x0089bd7a
0089bd45 : MOV EAX,dword ptr [ESI + 0x14]
0089bd48 : TEST EAX,EAX
0089bd4a : JZ 0x0089bd7a
0089bd4c : MOVSS XMM1,dword ptr [EAX + 0x6c]
0089bd51 : MOVSS XMM0,dword ptr [EAX + 0x68]
0089bd56 : SUBSS XMM0,dword ptr [0x00cdf144]
0089bd5e : MOVSS dword ptr [EBP + -0x20],XMM1
0089bd63 : MOVSS XMM1,dword ptr [EAX + 0x70]
0089bd68 : LEA ECX,[EBP + -0x24]
0089bd6b : MOVSS dword ptr [EBP + -0x1c],XMM1
0089bd70 : MOVSS dword ptr [EBP + -0x24],XMM0
0089bd75 : CALL 0x00404130
0089bd7a : MOV byte ptr [EDI + 0x1674],0x0
0089bd81 : MOV ECX,dword ptr [EBP + -0xc]
0089bd84 : MOV dword ptr FS:[0x0],ECX
0089bd8b : POP ECX
0089bd8c : POP EDI
0089bd8d : POP ESI
0089bd8e : POP EBX
0089bd8f : MOV ESP,EBP
0089bd91 : POP EBP
0089bd92 : RET
