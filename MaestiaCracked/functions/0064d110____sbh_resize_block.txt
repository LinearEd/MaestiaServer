PROGRAM  : Maestia.exe
FUNCTION : ___sbh_resize_block
ENTRY    : 0064d110
BODY     : [[0064d110, 0064d3f0]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    ___sbh_resize_block
   
   Library: Visual Studio 2008 Release */

undefined4 ___sbh_resize_block(uint *param_1,int param_2,int param_3)

{
  char *pcVar1;
  uint *puVar2;
  int iVar3;
  int *piVar4;
  int iVar5;
  int iVar6;
  char cVar7;
  uint uVar8;
  uint *puVar9;
  uint uVar10;
  uint uVar11;
  uint uVar12;
  uint uVar13;
  uint local_c;
  
  uVar8 = param_1[4];
  uVar10 = param_2 - param_1[3] >> 0xf;
  iVar5 = uVar10 * 0x204 + 0x144 + uVar8;
  uVar12 = param_3 + 0x17U & 0xfffffff0;
  param_3 = *(int *)(param_2 + -4) + -1;
  puVar9 = (uint *)(*(int *)(param_2 + -4) + -5 + param_2);
  uVar13 = *puVar9;
  if (param_3 < (int)uVar12) {
    if (((uVar13 & 1) != 0) || ((int)(uVar13 + param_3) < (int)uVar12)) {
      return 0;
    }
    local_c = ((int)uVar13 >> 4) - 1;
    if (0x3f < local_c) {
      local_c = 0x3f;
    }
    if (puVar9[1] == puVar9[2]) {
      if (local_c < 0x20) {
        pcVar1 = (char *)(local_c + 4 + uVar8);
        uVar11 = ~(0x80000000U >> ((byte)local_c & 0x1f));
        puVar2 = (uint *)(uVar8 + 0x44 + uVar10 * 4);
        *puVar2 = *puVar2 & uVar11;
        *pcVar1 = *pcVar1 + -1;
        if (*pcVar1 == '\0') {
          *param_1 = *param_1 & uVar11;
        }
      }
      else {
        pcVar1 = (char *)(local_c + 4 + uVar8);
        uVar11 = ~(0x80000000U >> ((byte)local_c - 0x20 & 0x1f));
        puVar2 = (uint *)(uVar8 + 0xc4 + uVar10 * 4);
        *puVar2 = *puVar2 & uVar11;
        *pcVar1 = *pcVar1 + -1;
        if (*pcVar1 == '\0') {
          param_1[1] = param_1[1] & uVar11;
        }
      }
    }
    *(uint *)(puVar9[2] + 4) = puVar9[1];
    *(uint *)(puVar9[1] + 8) = puVar9[2];
    iVar6 = uVar13 + (param_3 - uVar12);
    if (0 < iVar6) {
      uVar13 = (iVar6 >> 4) - 1;
      iVar3 = param_2 + -4 + uVar12;
      if (0x3f < uVar13) {
        uVar13 = 0x3f;
      }
      iVar5 = iVar5 + uVar13 * 8;
      *(undefined4 *)(iVar3 + 4) = *(undefined4 *)(iVar5 + 4);
      *(int *)(iVar3 + 8) = iVar5;
      *(int *)(iVar5 + 4) = iVar3;
      *(int *)(*(int *)(iVar3 + 4) + 8) = iVar3;
      if (*(int *)(iVar3 + 4) == *(int *)(iVar3 + 8)) {
        cVar7 = *(char *)(uVar13 + 4 + uVar8);
        *(char *)(uVar13 + 4 + uVar8) = cVar7 + '\x01';
        if (uVar13 < 0x20) {
          if (cVar7 == '\0') {
            *param_1 = *param_1 | 0x80000000U >> ((byte)uVar13 & 0x1f);
          }
          puVar9 = (uint *)(uVar8 + 0x44 + uVar10 * 4);
        }
        else {
          if (cVar7 == '\0') {
            param_1[1] = param_1[1] | 0x80000000U >> ((byte)uVar13 - 0x20 & 0x1f);
          }
          puVar9 = (uint *)(uVar8 + 0xc4 + uVar10 * 4);
          uVar13 = uVar13 - 0x20;
        }
        *puVar9 = *puVar9 | 0x80000000U >> ((byte)uVar13 & 0x1f);
      }
      piVar4 = (int *)(param_2 + -4 + uVar12);
      *piVar4 = iVar6;
      *(int *)(iVar6 + -4 + (int)piVar4) = iVar6;
    }
    *(uint *)(param_2 + -4) = uVar12 + 1;
    *(uint *)(param_2 + -8 + uVar12) = uVar12 + 1;
  }
  else if ((int)uVar12 < param_3) {
    param_3 = param_3 - uVar12;
    *(uint *)(param_2 + -4) = uVar12 + 1;
    piVar4 = (int *)(param_2 + -4 + uVar12);
    uVar11 = (param_3 >> 4) - 1;
    piVar4[-1] = uVar12 + 1;
    if (0x3f < uVar11) {
      uVar11 = 0x3f;
    }
    if ((uVar13 & 1) == 0) {
      uVar12 = ((int)uVar13 >> 4) - 1;
      if (0x3f < uVar12) {
        uVar12 = 0x3f;
      }
      if (puVar9[1] == puVar9[2]) {
        if (uVar12 < 0x20) {
          pcVar1 = (char *)(uVar12 + 4 + uVar8);
          uVar12 = ~(0x80000000U >> ((byte)uVar12 & 0x1f));
          puVar2 = (uint *)(uVar8 + 0x44 + uVar10 * 4);
          *puVar2 = *puVar2 & uVar12;
          *pcVar1 = *pcVar1 + -1;
          if (*pcVar1 == '\0') {
            *param_1 = *param_1 & uVar12;
          }
        }
        else {
          pcVar1 = (char *)(uVar12 + 4 + uVar8);
          uVar12 = ~(0x80000000U >> ((byte)uVar12 - 0x20 & 0x1f));
          puVar2 = (uint *)(uVar8 + 0xc4 + uVar10 * 4);
          *puVar2 = *puVar2 & uVar12;
          *pcVar1 = *pcVar1 + -1;
          if (*pcVar1 == '\0') {
            param_1[1] = param_1[1] & uVar12;
          }
        }
      }
      *(uint *)(puVar9[2] + 4) = puVar9[1];
      *(uint *)(puVar9[1] + 8) = puVar9[2];
      param_3 = param_3 + uVar13;
      uVar11 = (param_3 >> 4) - 1;
      if (0x3f < uVar11) {
        uVar11 = 0x3f;
      }
    }
    iVar5 = iVar5 + uVar11 * 8;
    iVar6 = *(int *)(iVar5 + 4);
    piVar4[2] = iVar5;
    piVar4[1] = iVar6;
    *(int **)(iVar5 + 4) = piVar4;
    *(int **)(piVar4[1] + 8) = piVar4;
    if (piVar4[1] == piVar4[2]) {
      cVar7 = *(char *)(uVar11 + 4 + uVar8);
      *(char *)(uVar11 + 4 + uVar8) = cVar7 + '\x01';
      if (uVar11 < 0x20) {
        if (cVar7 == '\0') {
          *param_1 = *param_1 | 0x80000000U >> ((byte)uVar11 & 0x1f);
        }
        puVar9 = (uint *)(uVar8 + 0x44 + uVar10 * 4);
      }
      else {
        if (cVar7 == '\0') {
          param_1[1] = param_1[1] | 0x80000000U >> ((byte)uVar11 - 0x20 & 0x1f);
        }
        puVar9 = (uint *)(uVar8 + 0xc4 + uVar10 * 4);
        uVar11 = uVar11 - 0x20;
      }
      *puVar9 = *puVar9 | 0x80000000U >> ((byte)uVar11 & 0x1f);
    }
    *piVar4 = param_3;
    *(int *)(param_3 + -4 + (int)piVar4) = param_3;
  }
  return 1;
}



============================================================
DISASSEMBLY
============================================================
0064d110 : MOV EDI,EDI
0064d112 : PUSH EBP
0064d113 : MOV EBP,ESP
0064d115 : SUB ESP,0xc
0064d118 : MOV ECX,dword ptr [EBP + 0x8]
0064d11b : MOV EAX,dword ptr [ECX + 0x10]
0064d11e : PUSH EBX
0064d11f : PUSH ESI
0064d120 : MOV ESI,dword ptr [EBP + 0x10]
0064d123 : PUSH EDI
0064d124 : MOV EDI,dword ptr [EBP + 0xc]
0064d127 : MOV EDX,EDI
0064d129 : SUB EDX,dword ptr [ECX + 0xc]
0064d12c : ADD ESI,0x17
0064d12f : SHR EDX,0xf
0064d132 : MOV ECX,EDX
0064d134 : IMUL ECX,ECX,0x204
0064d13a : LEA ECX,[ECX + EAX*0x1 + 0x144]
0064d141 : MOV dword ptr [EBP + -0xc],ECX
0064d144 : MOV ECX,dword ptr [EDI + -0x4]
0064d147 : AND ESI,0xfffffff0
0064d14a : DEC ECX
0064d14b : CMP ESI,ECX
0064d14d : LEA EDI,[ECX + EDI*0x1 + -0x4]
0064d151 : MOV EBX,dword ptr [EDI]
0064d153 : MOV dword ptr [EBP + 0x10],ECX
0064d156 : MOV dword ptr [EBP + -0x4],EBX
0064d159 : JLE 0x0064d2b4
0064d15f : TEST BL,0x1
0064d162 : JNZ 0x0064d2ad
0064d168 : ADD EBX,ECX
0064d16a : CMP ESI,EBX
0064d16c : JG 0x0064d2ad
0064d172 : MOV ECX,dword ptr [EBP + -0x4]
0064d175 : SAR ECX,0x4
0064d178 : DEC ECX
0064d179 : MOV dword ptr [EBP + -0x8],ECX
0064d17c : CMP ECX,0x3f
0064d17f : JBE 0x0064d187
0064d181 : PUSH 0x3f
0064d183 : POP ECX
0064d184 : MOV dword ptr [EBP + -0x8],ECX
0064d187 : MOV EBX,dword ptr [EDI + 0x4]
0064d18a : CMP EBX,dword ptr [EDI + 0x8]
0064d18d : JNZ 0x0064d1d2
0064d18f : MOV EBX,0x80000000
0064d194 : CMP ECX,0x20
0064d197 : JNC 0x0064d1b3
0064d199 : SHR EBX,CL
0064d19b : MOV ECX,dword ptr [EBP + -0x8]
0064d19e : LEA ECX,[ECX + EAX*0x1 + 0x4]
0064d1a2 : NOT EBX
0064d1a4 : AND dword ptr [EAX + EDX*0x4 + 0x44],EBX
0064d1a8 : DEC byte ptr [ECX]
0064d1aa : JNZ 0x0064d1d2
0064d1ac : MOV ECX,dword ptr [EBP + 0x8]
0064d1af : AND dword ptr [ECX],EBX
0064d1b1 : JMP 0x0064d1d2
0064d1b3 : ADD ECX,-0x20
0064d1b6 : SHR EBX,CL
0064d1b8 : MOV ECX,dword ptr [EBP + -0x8]
0064d1bb : LEA ECX,[ECX + EAX*0x1 + 0x4]
0064d1bf : NOT EBX
0064d1c1 : AND dword ptr [EAX + EDX*0x4 + 0xc4],EBX
0064d1c8 : DEC byte ptr [ECX]
0064d1ca : JNZ 0x0064d1d2
0064d1cc : MOV ECX,dword ptr [EBP + 0x8]
0064d1cf : AND dword ptr [ECX + 0x4],EBX
0064d1d2 : MOV ECX,dword ptr [EDI + 0x8]
0064d1d5 : MOV EBX,dword ptr [EDI + 0x4]
0064d1d8 : MOV dword ptr [ECX + 0x4],EBX
0064d1db : MOV ECX,dword ptr [EDI + 0x4]
0064d1de : MOV EDI,dword ptr [EDI + 0x8]
0064d1e1 : MOV dword ptr [ECX + 0x8],EDI
0064d1e4 : MOV ECX,dword ptr [EBP + 0x10]
0064d1e7 : SUB ECX,ESI
0064d1e9 : ADD dword ptr [EBP + -0x4],ECX
0064d1ec : CMP dword ptr [EBP + -0x4],0x0
0064d1f0 : JLE 0x0064d29b
0064d1f6 : MOV EDI,dword ptr [EBP + -0x4]
0064d1f9 : MOV ECX,dword ptr [EBP + 0xc]
0064d1fc : SAR EDI,0x4
0064d1ff : DEC EDI
0064d200 : LEA ECX,[ECX + ESI*0x1 + -0x4]
0064d204 : CMP EDI,0x3f
0064d207 : JBE 0x0064d20c
0064d209 : PUSH 0x3f
0064d20b : POP EDI
0064d20c : MOV EBX,dword ptr [EBP + -0xc]
0064d20f : LEA EBX,[EBX + EDI*0x8]
0064d212 : MOV dword ptr [EBP + 0x10],EBX
0064d215 : MOV EBX,dword ptr [EBX + 0x4]
0064d218 : MOV dword ptr [ECX + 0x4],EBX
0064d21b : MOV EBX,dword ptr [EBP + 0x10]
0064d21e : MOV dword ptr [ECX + 0x8],EBX
0064d221 : MOV dword ptr [EBX + 0x4],ECX
0064d224 : MOV EBX,dword ptr [ECX + 0x4]
0064d227 : MOV dword ptr [EBX + 0x8],ECX
0064d22a : MOV EBX,dword ptr [ECX + 0x4]
0064d22d : CMP EBX,dword ptr [ECX + 0x8]
0064d230 : JNZ 0x0064d289
0064d232 : MOV CL,byte ptr [EDI + EAX*0x1 + 0x4]
0064d236 : MOV byte ptr [EBP + 0x13],CL
0064d239 : INC CL
0064d23b : MOV byte ptr [EDI + EAX*0x1 + 0x4],CL
0064d23f : CMP EDI,0x20
0064d242 : JNC 0x0064d260
0064d244 : CMP byte ptr [EBP + 0x13],0x0
0064d248 : JNZ 0x0064d258
0064d24a : MOV ECX,EDI
0064d24c : MOV EBX,0x80000000
0064d251 : SHR EBX,CL
0064d253 : MOV ECX,dword ptr [EBP + 0x8]
0064d256 : OR dword ptr [ECX],EBX
0064d258 : LEA EAX,[EAX + EDX*0x4 + 0x44]
0064d25c : MOV ECX,EDI
0064d25e : JMP 0x0064d280
0064d260 : CMP byte ptr [EBP + 0x13],0x0
0064d264 : JNZ 0x0064d276
0064d266 : LEA ECX,[EDI + -0x20]
0064d269 : MOV EBX,0x80000000
0064d26e : SHR EBX,CL
0064d270 : MOV ECX,dword ptr [EBP + 0x8]
0064d273 : OR dword ptr [ECX + 0x4],EBX
0064d276 : LEA EAX,[EAX + EDX*0x4 + 0xc4]
0064d27d : LEA ECX,[EDI + -0x20]
0064d280 : MOV EDX,0x80000000
0064d285 : SHR EDX,CL
0064d287 : OR dword ptr [EAX],EDX
0064d289 : MOV EDX,dword ptr [EBP + 0xc]
0064d28c : MOV ECX,dword ptr [EBP + -0x4]
0064d28f : LEA EAX,[EDX + ESI*0x1 + -0x4]
0064d293 : MOV dword ptr [EAX],ECX
0064d295 : MOV dword ptr [ECX + EAX*0x1 + -0x4],ECX
0064d299 : JMP 0x0064d29e
0064d29b : MOV EDX,dword ptr [EBP + 0xc]
0064d29e : LEA EAX,[ESI + 0x1]
0064d2a1 : MOV dword ptr [EDX + -0x4],EAX
0064d2a4 : MOV dword ptr [EDX + ESI*0x1 + -0x8],EAX
0064d2a8 : JMP 0x0064d3e9
0064d2ad : XOR EAX,EAX
0064d2af : JMP 0x0064d3ec
0064d2b4 : JGE 0x0064d3e9
0064d2ba : MOV EBX,dword ptr [EBP + 0xc]
0064d2bd : SUB dword ptr [EBP + 0x10],ESI
0064d2c0 : LEA ECX,[ESI + 0x1]
0064d2c3 : MOV dword ptr [EBX + -0x4],ECX
0064d2c6 : LEA EBX,[EBX + ESI*0x1 + -0x4]
0064d2ca : MOV ESI,dword ptr [EBP + 0x10]
0064d2cd : SAR ESI,0x4
0064d2d0 : DEC ESI
0064d2d1 : MOV dword ptr [EBP + 0xc],EBX
0064d2d4 : MOV dword ptr [EBX + -0x4],ECX
0064d2d7 : CMP ESI,0x3f
0064d2da : JBE 0x0064d2df
0064d2dc : PUSH 0x3f
0064d2de : POP ESI
0064d2df : TEST byte ptr [EBP + -0x4],0x1
0064d2e3 : JNZ 0x0064d369
0064d2e9 : MOV ESI,dword ptr [EBP + -0x4]
0064d2ec : SAR ESI,0x4
0064d2ef : DEC ESI
0064d2f0 : CMP ESI,0x3f
0064d2f3 : JBE 0x0064d2f8
0064d2f5 : PUSH 0x3f
0064d2f7 : POP ESI
0064d2f8 : MOV ECX,dword ptr [EDI + 0x4]
0064d2fb : CMP ECX,dword ptr [EDI + 0x8]
0064d2fe : JNZ 0x0064d342
0064d300 : MOV EBX,0x80000000
0064d305 : CMP ESI,0x20
0064d308 : JNC 0x0064d323
0064d30a : MOV ECX,ESI
0064d30c : SHR EBX,CL
0064d30e : LEA ESI,[ESI + EAX*0x1 + 0x4]
0064d312 : NOT EBX
0064d314 : AND dword ptr [EAX + EDX*0x4 + 0x44],EBX
0064d318 : DEC byte ptr [ESI]
0064d31a : JNZ 0x0064d33f
0064d31c : MOV ECX,dword ptr [EBP + 0x8]
0064d31f : AND dword ptr [ECX],EBX
0064d321 : JMP 0x0064d33f
0064d323 : LEA ECX,[ESI + -0x20]
0064d326 : SHR EBX,CL
0064d328 : LEA ECX,[ESI + EAX*0x1 + 0x4]
0064d32c : NOT EBX
0064d32e : AND dword ptr [EAX + EDX*0x4 + 0xc4],EBX
0064d335 : DEC byte ptr [ECX]
0064d337 : JNZ 0x0064d33f
0064d339 : MOV ECX,dword ptr [EBP + 0x8]
0064d33c : AND dword ptr [ECX + 0x4],EBX
0064d33f : MOV EBX,dword ptr [EBP + 0xc]
0064d342 : MOV ECX,dword ptr [EDI + 0x8]
0064d345 : MOV ESI,dword ptr [EDI + 0x4]
0064d348 : MOV dword ptr [ECX + 0x4],ESI
0064d34b : MOV ESI,dword ptr [EDI + 0x8]
0064d34e : MOV ECX,dword ptr [EDI + 0x4]
0064d351 : MOV dword ptr [ECX + 0x8],ESI
0064d354 : MOV ESI,dword ptr [EBP + 0x10]
0064d357 : ADD ESI,dword ptr [EBP + -0x4]
0064d35a : MOV dword ptr [EBP + 0x10],ESI
0064d35d : SAR ESI,0x4
0064d360 : DEC ESI
0064d361 : CMP ESI,0x3f
0064d364 : JBE 0x0064d369
0064d366 : PUSH 0x3f
0064d368 : POP ESI
0064d369 : MOV ECX,dword ptr [EBP + -0xc]
0064d36c : LEA ECX,[ECX + ESI*0x8]
0064d36f : MOV EDI,dword ptr [ECX + 0x4]
0064d372 : MOV dword ptr [EBX + 0x8],ECX
0064d375 : MOV dword ptr [EBX + 0x4],EDI
0064d378 : MOV dword ptr [ECX + 0x4],EBX
0064d37b : MOV ECX,dword ptr [EBX + 0x4]
0064d37e : MOV dword ptr [ECX + 0x8],EBX
0064d381 : MOV ECX,dword ptr [EBX + 0x4]
0064d384 : CMP ECX,dword ptr [EBX + 0x8]
0064d387 : JNZ 0x0064d3e0
0064d389 : MOV CL,byte ptr [ESI + EAX*0x1 + 0x4]
0064d38d : MOV byte ptr [EBP + 0xf],CL
0064d390 : INC CL
0064d392 : MOV byte ptr [ESI + EAX*0x1 + 0x4],CL
0064d396 : CMP ESI,0x20
0064d399 : JNC 0x0064d3b7
0064d39b : CMP byte ptr [EBP + 0xf],0x0
0064d39f : JNZ 0x0064d3af
0064d3a1 : MOV ECX,ESI
0064d3a3 : MOV EDI,0x80000000
0064d3a8 : SHR EDI,CL
0064d3aa : MOV ECX,dword ptr [EBP + 0x8]
0064d3ad : OR dword ptr [ECX],EDI
0064d3af : LEA EAX,[EAX + EDX*0x4 + 0x44]
0064d3b3 : MOV ECX,ESI
0064d3b5 : JMP 0x0064d3d7
0064d3b7 : CMP byte ptr [EBP + 0xf],0x0
0064d3bb : JNZ 0x0064d3cd
0064d3bd : LEA ECX,[ESI + -0x20]
0064d3c0 : MOV EDI,0x80000000
0064d3c5 : SHR EDI,CL
0064d3c7 : MOV ECX,dword ptr [EBP + 0x8]
0064d3ca : OR dword ptr [ECX + 0x4],EDI
0064d3cd : LEA EAX,[EAX + EDX*0x4 + 0xc4]
0064d3d4 : LEA ECX,[ESI + -0x20]
0064d3d7 : MOV EDX,0x80000000
0064d3dc : SHR EDX,CL
0064d3de : OR dword ptr [EAX],EDX
0064d3e0 : MOV EAX,dword ptr [EBP + 0x10]
0064d3e3 : MOV dword ptr [EBX],EAX
0064d3e5 : MOV dword ptr [EAX + EBX*0x1 + -0x4],EAX
0064d3e9 : XOR EAX,EAX
0064d3eb : INC EAX
0064d3ec : POP EDI
0064d3ed : POP ESI
0064d3ee : POP EBX
0064d3ef : LEAVE
0064d3f0 : RET
