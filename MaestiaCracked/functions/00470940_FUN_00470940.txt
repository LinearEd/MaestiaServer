PROGRAM  : Maestia.exe
FUNCTION : FUN_00470940
ENTRY    : 00470940
BODY     : [[00470940, 00470a6e]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00470940(int param_1,int *param_2)

{
  undefined8 *puVar1;
  int *piVar2;
  int iVar3;
  int *piVar4;
  int *piVar5;
  int iVar6;
  int unaff_ESI;
  int iStack_20;
  int local_1c;
  uint uStack_18;
  int local_10;
  int local_8;
  
  local_10 = 0;
  if (0 < *param_2) {
    local_8 = 0;
    do {
      iVar6 = 0;
      piVar4 = (int *)(param_2[1] + local_8);
      iVar3 = *piVar4;
      uStack_18 = 0;
      if (*(char *)(unaff_ESI + 0x1078) == '\0') {
        iStack_20 = *(int *)(unaff_ESI + 0x1004) + piVar4[1] * 6;
        local_1c = piVar4[2] * 6;
        uStack_18 = (uint)(*(int *)(unaff_ESI + 0x1004) * 2) / 3;
        iVar6 = piVar4[2] * 4;
      }
      else {
        iStack_20 = *(int *)(unaff_ESI + 0xfe4) + piVar4[1] * 4;
        local_1c = piVar4[2] * 4;
      }
      puVar1 = (undefined8 *)
               (*(int *)(unaff_ESI + 0xe54) + (*(int *)(unaff_ESI + 0xe48) * iVar3 + param_1) * 0x14
               );
      *puVar1 = CONCAT44(iStack_20,iVar3);
      puVar1[1] = CONCAT44(uStack_18,local_1c);
      *(int *)(puVar1 + 2) = iVar6;
      *(undefined1 *)(*(int *)(unaff_ESI + 0xe68) + 1 + param_1) = 1;
      piVar5 = (int *)FUN_00471e30();
      piVar4 = *(int **)(unaff_ESI + 0xe7c);
      piVar2 = piVar4 + *(int *)(unaff_ESI + 0xe80);
      if (piVar5 == piVar2) {
        if ((*(int *)(unaff_ESI + 0xe80) == 0) || (*piVar4 <= iVar3)) {
LAB_00470a39:
          piVar4 = piVar5;
        }
      }
      else {
        piVar4 = piVar5 + 1;
        if (iVar3 <= *piVar5) goto LAB_00470a39;
      }
      if ((piVar5 == piVar2) || (piVar5 != piVar4)) {
        FUN_00471e80(piVar4);
      }
      local_8 = local_8 + 0x14;
      local_10 = local_10 + 1;
    } while (local_10 < *param_2);
  }
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00470940 : PUSH EBP
00470941 : MOV EBP,ESP
00470943 : SUB ESP,0x20
00470946 : MOV EAX,dword ptr [EBP + 0xc]
00470949 : XOR ECX,ECX
0047094b : CMP dword ptr [EAX],ECX
0047094d : MOV dword ptr [EBP + -0xc],ECX
00470950 : JLE 0x00470a67
00470956 : PUSH EBX
00470957 : PUSH EDI
00470958 : LEA EDI,[ESI + 0xe78]
0047095e : MOV dword ptr [EBP + -0x4],ECX
00470961 : JMP 0x00470965
00470963 : XOR ECX,ECX
00470965 : MOV EAX,dword ptr [EAX + 0x4]
00470968 : ADD EAX,dword ptr [EBP + -0x4]
0047096b : CMP byte ptr [ESI + 0x1078],0x0
00470972 : MOV EDX,dword ptr [EAX]
00470974 : MOV dword ptr [EBP + -0x14],ECX
00470977 : MOV dword ptr [EBP + -0x10],ECX
0047097a : MOV dword ptr [EBP + -0x20],EDX
0047097d : JZ 0x0047099a
0047097f : MOV EDX,dword ptr [EAX + 0x4]
00470982 : MOV EAX,dword ptr [EAX + 0x8]
00470985 : MOV EBX,dword ptr [ESI + 0xfe4]
0047098b : ADD EAX,EAX
0047098d : LEA EDX,[EBX + EDX*0x4]
00470990 : ADD EAX,EAX
00470992 : MOV dword ptr [EBP + -0x1c],EDX
00470995 : MOV dword ptr [EBP + -0x18],EAX
00470998 : JMP 0x004709cc
0047099a : MOV ECX,dword ptr [EAX + 0x4]
0047099d : MOV EDX,dword ptr [ESI + 0x1004]
004709a3 : LEA ECX,[ECX + ECX*0x2]
004709a6 : LEA ECX,[EDX + ECX*0x2]
004709a9 : MOV dword ptr [EBP + -0x1c],ECX
004709ac : MOV ECX,dword ptr [EAX + 0x8]
004709af : LEA EAX,[ECX + ECX*0x2]
004709b2 : ADD EAX,EAX
004709b4 : MOV dword ptr [EBP + -0x18],EAX
004709b7 : ADD EDX,EDX
004709b9 : MOV EAX,0xaaaaaaab
004709be : MUL EDX
004709c0 : SHR EDX,0x1
004709c2 : ADD ECX,ECX
004709c4 : ADD ECX,ECX
004709c6 : MOV dword ptr [EBP + -0x14],EDX
004709c9 : MOV dword ptr [EBP + -0x10],ECX
004709cc : MOV EAX,dword ptr [ESI + 0xe48]
004709d2 : IMUL EAX,dword ptr [EBP + -0x20]
004709d6 : MOV EDX,dword ptr [EBP + 0x8]
004709d9 : MOV EBX,dword ptr [ESI + 0xe54]
004709df : MOVQ XMM0,qword ptr [EBP + -0x20]
004709e4 : ADD EAX,EDX
004709e6 : LEA EAX,[EAX + EAX*0x4]
004709e9 : LEA EAX,[EBX + EAX*0x4]
004709ec : MOVQ qword ptr [EAX],XMM0
004709f0 : MOVQ XMM0,qword ptr [EBP + -0x18]
004709f5 : MOVQ qword ptr [EAX + 0x8],XMM0
004709fa : MOV dword ptr [EAX + 0x10],ECX
004709fd : MOV ECX,dword ptr [ESI + 0xe68]
00470a03 : MOV byte ptr [ECX + EDX*0x1 + 0x1],0x1
00470a08 : LEA EDX,[EBP + -0x20]
00470a0b : MOV ECX,EDI
00470a0d : CALL 0x00471e30
00470a12 : MOV EDX,dword ptr [EDI + 0x8]
00470a15 : MOV ECX,dword ptr [EDI + 0x4]
00470a18 : LEA EBX,[ECX + EDX*0x4]
00470a1b : MOV dword ptr [EBP + -0x8],EAX
00470a1e : CMP EAX,EBX
00470a20 : JNZ 0x00470a2f
00470a22 : TEST EDX,EDX
00470a24 : JBE 0x00470a39
00470a26 : MOV EDX,dword ptr [EBP + -0x20]
00470a29 : CMP EDX,dword ptr [ECX]
00470a2b : JGE 0x00470a39
00470a2d : JMP 0x00470a3c
00470a2f : MOV ECX,dword ptr [EBP + -0x20]
00470a32 : CMP dword ptr [EAX],ECX
00470a34 : LEA ECX,[EAX + 0x4]
00470a37 : JL 0x00470a3c
00470a39 : MOV ECX,dword ptr [EBP + -0x8]
00470a3c : CMP EAX,EBX
00470a3e : JZ 0x00470a44
00470a40 : CMP EAX,ECX
00470a42 : JZ 0x00470a4f
00470a44 : PUSH ECX
00470a45 : LEA ECX,[EBP + -0x20]
00470a48 : MOV EAX,EDI
00470a4a : CALL 0x00471e80
00470a4f : MOV ECX,dword ptr [EBP + -0xc]
00470a52 : MOV EAX,dword ptr [EBP + 0xc]
00470a55 : ADD dword ptr [EBP + -0x4],0x14
00470a59 : INC ECX
00470a5a : CMP ECX,dword ptr [EAX]
00470a5c : MOV dword ptr [EBP + -0xc],ECX
00470a5f : JL 0x00470963
00470a65 : POP EDI
00470a66 : POP EBX
00470a67 : MOV AL,0x1
00470a69 : MOV ESP,EBP
00470a6b : POP EBP
00470a6c : RET 0x8
