PROGRAM  : Maestia.exe
FUNCTION : FUN_007bef40
ENTRY    : 007bef40
BODY     : [[007bef40, 007bf359]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_007bef40(void)

{
  BOOL BVar1;
  undefined4 uVar2;
  int iVar3;
  uint uVar4;
  uint uVar5;
  undefined4 *unaff_EDI;
  LPCRITICAL_SECTION local_12c;
  char *local_128;
  undefined4 local_124;
  int local_120;
  undefined4 local_11c;
  CHAR local_114 [256];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  puStack_c = &LAB_00b285e6;
  local_10 = ExceptionList;
  local_14 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_8 = 0;
  DAT_01725208 = unaff_EDI;
  *unaff_EDI = &PTR_FUN_00cdec94;
  BVar1 = InitializeCriticalSectionAndSpinCount((LPCRITICAL_SECTION)(unaff_EDI + 1),4000);
  if (BVar1 == 0) {
    InitializeCriticalSection((LPCRITICAL_SECTION)(unaff_EDI + 1));
  }
  unaff_EDI[9] = 0;
  unaff_EDI[10] = 0;
  unaff_EDI[0xb] = 0;
  unaff_EDI[0xc] = 0;
  unaff_EDI[0xd] = 0;
  unaff_EDI[0xe] = 0;
  unaff_EDI[0x10] = 0;
  unaff_EDI[0x11] = 0;
  unaff_EDI[0x12] = 0;
  unaff_EDI[0x14] = 0;
  unaff_EDI[0x15] = 0;
  unaff_EDI[0x16] = 0;
  unaff_EDI[0x18] = 0;
  unaff_EDI[0x19] = 0;
  unaff_EDI[0x1a] = 0;
  local_8._1_3_ = (undefined3)((uint)local_8 >> 8);
  unaff_EDI[0x1c] = 0;
  unaff_EDI[0x1d] = 0;
  unaff_EDI[0x1e] = 0;
  local_8._0_1_ = 5;
  FUN_0043a7e0(unaff_EDI + 0x21);
  local_8._0_1_ = 6;
  FUN_0043a7e0(unaff_EDI + 0x24);
  unaff_EDI[0x39] = 0;
  unaff_EDI[0x3a] = 0;
  unaff_EDI[0x3b] = 0;
  unaff_EDI[0x42] = 7;
  unaff_EDI[0x41] = 0;
  *(undefined2 *)(unaff_EDI + 0x3d) = 0;
  local_8._0_1_ = 9;
  local_12c = (LPCRITICAL_SECTION)(unaff_EDI + 1);
  local_120 = 0;
  local_128 = ".\\mss\\AvaMssMgr.cpp";
  local_124 = 0x26;
  local_11c = 1;
  FUN_006ef1a0(&local_12c);
  local_8._0_1_ = 10;
  unaff_EDI[0x33] = 0;
  unaff_EDI[0x35] = 0;
  (*(code *)PTR_FUN_00d6d240)(0x3c,6,"MSS OFF");
  unaff_EDI[8] = 0;
  *(undefined1 *)(unaff_EDI + 7) = 0;
  GetCurrentDirectoryA(0x100,local_114);
  lstrcatA(local_114,"\\MssRedist");
  uVar2 = _AIL_set_redist_directory_4(local_114);
  (*(code *)PTR_FUN_00d6d23c)("set miles sound directory %s\n",uVar2);
  uVar2 = _AIL_startup_0();
  (*(code *)PTR_FUN_00d6d23c)("AIL_startup %d\n",uVar2);
  iVar3 = _AIL_open_digital_driver_16(0xc000,0x10,2,0);
  unaff_EDI[8] = iVar3;
  if (iVar3 == 0) {
    FUN_008018d0(L"pDigdriver Create Failed !!!!");
  }
  else {
    iVar3 = _AIL_get_preference_4(1);
    unaff_EDI[0x2e] = iVar3;
    uVar4 = iVar3 - 0x17;
    unaff_EDI[0x2f] = 8;
    unaff_EDI[0x31] = 5;
    if (0x32 < (int)uVar4) {
      uVar4 = 0x32;
    }
    unaff_EDI[0x30] = uVar4;
    uVar5 = 0x1f;
    if (uVar4 < 0x20) {
      uVar5 = uVar4;
    }
    unaff_EDI[0x32] = uVar5;
    if (uVar4 == 0) {
      FUN_007bec00();
    }
    else {
      FUN_004644b0(5);
      FUN_004644b0(unaff_EDI[0x32]);
      uVar2 = DAT_00d72c24;
      uVar4 = DAT_01725270 >> 3;
      unaff_EDI[0x27] = DAT_00d72c24;
      unaff_EDI[0x28] = uVar2;
      unaff_EDI[0x29] = 0x3f800000;
      unaff_EDI[0x2a] = 0x41f00000;
      unaff_EDI[0x2b] = 0x43960000;
      unaff_EDI[0x2c] = 0x3fe00000;
      unaff_EDI[0x2d] = 0x3dcccccd;
      *(undefined1 *)(unaff_EDI + 0x36) = 1;
      *(undefined1 *)((int)unaff_EDI + 0xd9) = 1;
      *(undefined1 *)((int)unaff_EDI + 0xdb) = 1;
      *(undefined1 *)((int)unaff_EDI + 0xda) = 1;
      iVar3 = FUN_006f0760(0x78,"",0,(uVar4 & 1) == 0);
      local_8._0_1_ = 0xb;
      if (iVar3 == 0) {
        uVar2 = 0;
      }
      else {
        uVar2 = FUN_007543a0(iVar3,unaff_EDI);
      }
      local_8._0_1_ = 10;
      unaff_EDI[0x1f] = uVar2;
      iVar3 = FUN_006f0760(0x78,"",0,(DAT_01725270 >> 3 & 1) == 0);
      local_8._0_1_ = 0xc;
      if (iVar3 == 0) {
        uVar2 = 0;
      }
      else {
        uVar2 = FUN_007543a0(iVar3,unaff_EDI);
      }
      local_8._0_1_ = 10;
      unaff_EDI[0x20] = uVar2;
      (*(code *)PTR_FUN_00d6d240)(0x3c,6,"MSS ON ");
      unaff_EDI[0x34] = 0;
      unaff_EDI[0x35] = 1;
      unaff_EDI[0x33] = 1;
      _AIL_set_3D_distance_factor_8(unaff_EDI[8],unaff_EDI[0x2d]);
      _AIL_set_3D_rolloff_factor_8(unaff_EDI[8],unaff_EDI[0x2c]);
    }
  }
  if (local_120 != 0) {
    local_8 = CONCAT31(local_8._1_3_,9);
    LeaveCriticalSection(local_12c);
    local_120 = 0;
  }
  local_8 = 0xffffffff;
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
007bef40 : PUSH EBP
007bef41 : MOV EBP,ESP
007bef43 : PUSH -0x1
007bef45 : PUSH 0xb285e6
007bef4a : MOV EAX,FS:[0x0]
007bef50 : PUSH EAX
007bef51 : SUB ESP,0x120
007bef57 : MOV EAX,[0x00d66fa0]
007bef5c : XOR EAX,EBP
007bef5e : MOV dword ptr [EBP + -0x10],EAX
007bef61 : PUSH EBX
007bef62 : PUSH ESI
007bef63 : PUSH EAX
007bef64 : LEA EAX,[EBP + -0xc]
007bef67 : MOV FS:[0x0],EAX
007bef6d : MOV dword ptr [EBP + 0xfffffeec],EDI
007bef73 : MOV dword ptr [0x01725208],EDI
007bef79 : XOR EBX,EBX
007bef7b : MOV dword ptr [EBP + -0x4],EBX
007bef7e : PUSH 0xfa0
007bef83 : LEA ESI,[EDI + 0x4]
007bef86 : PUSH ESI
007bef87 : MOV dword ptr [EDI],0xcdec94
007bef8d : CALL dword ptr [0x00b85110]
007bef93 : TEST EAX,EAX
007bef95 : JNZ 0x007bef9e
007bef97 : PUSH ESI
007bef98 : CALL dword ptr [0x00b85114]
007bef9e : MOV byte ptr [EBP + -0x4],0x1
007befa2 : XORPS XMM0,XMM0
007befa5 : LEA ESI,[EDI + 0x3c]
007befa8 : MOVSS dword ptr [EDI + 0x24],XMM0
007befad : MOVSS dword ptr [EDI + 0x28],XMM0
007befb2 : MOVSS dword ptr [EDI + 0x2c],XMM0
007befb7 : MOVSS dword ptr [EDI + 0x30],XMM0
007befbc : MOVSS dword ptr [EDI + 0x34],XMM0
007befc1 : MOVSS dword ptr [EDI + 0x38],XMM0
007befc6 : MOV dword ptr [ESI + 0x4],EBX
007befc9 : MOV dword ptr [ESI + 0x8],EBX
007befcc : MOV dword ptr [ESI + 0xc],EBX
007befcf : MOV byte ptr [EBP + -0x4],0x2
007befd3 : MOV dword ptr [EDI + 0x50],EBX
007befd6 : MOV dword ptr [EDI + 0x54],EBX
007befd9 : MOV dword ptr [EDI + 0x58],EBX
007befdc : MOV byte ptr [EBP + -0x4],0x3
007befe0 : MOV dword ptr [EDI + 0x60],EBX
007befe3 : MOV dword ptr [EDI + 0x64],EBX
007befe6 : MOV dword ptr [EDI + 0x68],EBX
007befe9 : MOV byte ptr [EBP + -0x4],0x4
007befed : MOV dword ptr [EDI + 0x70],EBX
007beff0 : MOV dword ptr [EDI + 0x74],EBX
007beff3 : MOV dword ptr [EDI + 0x78],EBX
007beff6 : MOV byte ptr [EBP + -0x4],0x5
007beffa : LEA EAX,[EDI + 0x84]
007bf000 : PUSH EAX
007bf001 : CALL 0x0043a7e0
007bf006 : MOV byte ptr [EBP + -0x4],0x6
007bf00a : LEA ECX,[EDI + 0x90]
007bf010 : PUSH ECX
007bf011 : CALL 0x0043a7e0
007bf016 : MOV EAX,0x7
007bf01b : MOV byte ptr [EBP + -0x4],AL
007bf01e : MOV dword ptr [EDI + 0xe4],EBX
007bf024 : MOV dword ptr [EDI + 0xe8],EBX
007bf02a : MOV dword ptr [EDI + 0xec],EBX
007bf030 : MOV byte ptr [EBP + -0x4],0x8
007bf034 : XOR EDX,EDX
007bf036 : MOV dword ptr [EDI + 0x108],EAX
007bf03c : MOV dword ptr [EDI + 0x104],EBX
007bf042 : MOV word ptr [EDI + 0xf4],DX
007bf049 : MOV byte ptr [EBP + -0x4],0x9
007bf04d : LEA EAX,[EDI + 0x4]
007bf050 : MOV dword ptr [EBP + 0xfffffed8],EAX
007bf056 : LEA EAX,[EBP + 0xfffffed8]
007bf05c : PUSH EAX
007bf05d : MOV dword ptr [EBP + 0xfffffee4],EBX
007bf063 : MOV dword ptr [EBP + 0xfffffedc],0xc18b2c
007bf06d : MOV dword ptr [EBP + 0xfffffee0],0x26
007bf077 : MOV dword ptr [EBP + 0xfffffee8],0x1
007bf081 : CALL 0x006ef1a0
007bf086 : MOV byte ptr [EBP + -0x4],0xa
007bf08a : PUSH 0xc18bbc
007bf08f : PUSH 0x6
007bf091 : PUSH 0x3c
007bf093 : MOV dword ptr [EDI + 0xcc],EBX
007bf099 : MOV dword ptr [EDI + 0xd4],EBX
007bf09f : CALL dword ptr [0x00d6d240]
007bf0a5 : ADD ESP,0xc
007bf0a8 : LEA ECX,[EBP + 0xfffffef0]
007bf0ae : PUSH ECX
007bf0af : PUSH 0x100
007bf0b4 : MOV dword ptr [EDI + 0x20],EBX
007bf0b7 : MOV byte ptr [EDI + 0x1c],BL
007bf0ba : CALL dword ptr [0x00b85214]
007bf0c0 : PUSH 0xc18bc4
007bf0c5 : LEA EDX,[EBP + 0xfffffef0]
007bf0cb : PUSH EDX
007bf0cc : CALL dword ptr [0x00b85348]
007bf0d2 : LEA EAX,[EBP + 0xfffffef0]
007bf0d8 : PUSH EAX
007bf0d9 : CALL dword ptr [0x00b85724]
007bf0df : PUSH EAX
007bf0e0 : PUSH 0xc18bd0
007bf0e5 : CALL dword ptr [0x00d6d23c]
007bf0eb : ADD ESP,0x8
007bf0ee : CALL dword ptr [0x00b85720]
007bf0f4 : PUSH EAX
007bf0f5 : PUSH 0xc18bf0
007bf0fa : CALL dword ptr [0x00d6d23c]
007bf100 : ADD ESP,0x8
007bf103 : PUSH EBX
007bf104 : PUSH 0x2
007bf106 : PUSH 0x10
007bf108 : PUSH 0xc000
007bf10d : CALL dword ptr [0x00b8571c]
007bf113 : MOV dword ptr [EDI + 0x20],EAX
007bf116 : CMP EAX,EBX
007bf118 : JNZ 0x007bf132
007bf11a : MOV ESI,dword ptr [0x00da98e8]
007bf120 : PUSH 0xc18c00
007bf125 : CALL 0x008018d0
007bf12a : ADD ESP,0x4
007bf12d : JMP 0x007bf317
007bf132 : PUSH 0x1
007bf134 : CALL dword ptr [0x00b85718]
007bf13a : MOV dword ptr [EDI + 0xb8],EAX
007bf140 : ADD EAX,-0x17
007bf143 : CMP EAX,0x32
007bf146 : MOV dword ptr [EDI + 0xbc],0x8
007bf150 : MOV dword ptr [EDI + 0xc4],0x5
007bf15a : JLE 0x007bf161
007bf15c : MOV EAX,0x32
007bf161 : MOV dword ptr [EDI + 0xc0],EAX
007bf167 : MOV ECX,0x1f
007bf16c : CMP EAX,0x1f
007bf16f : JA 0x007bf173
007bf171 : MOV ECX,EAX
007bf173 : MOV dword ptr [EDI + 0xc8],ECX
007bf179 : CMP EAX,EBX
007bf17b : JA 0x007bf1a0
007bf17d : MOV ECX,EDI
007bf17f : CALL 0x007bec00
007bf184 : MOV byte ptr [EBP + -0x4],0x9
007bf188 : CMP dword ptr [EBP + 0xfffffee4],EBX
007bf18e : JZ 0x007bf336
007bf194 : MOV EDX,dword ptr [EBP + 0xfffffed8]
007bf19a : PUSH EDX
007bf19b : JMP 0x007bf32a
007bf1a0 : PUSH 0x5
007bf1a2 : MOV ECX,ESI
007bf1a4 : CALL 0x004644b0
007bf1a9 : MOV EAX,dword ptr [EDI + 0xc8]
007bf1af : PUSH EAX
007bf1b0 : LEA ECX,[EDI + 0x4c]
007bf1b3 : CALL 0x004644b0
007bf1b8 : MOV ECX,dword ptr [0x01725270]
007bf1be : MOVSS XMM0,dword ptr [0x00d72c24]
007bf1c6 : SHR ECX,0x3
007bf1c9 : MOV ESI,0x1
007bf1ce : MOV EDX,0x0
007bf1d3 : AND ECX,ESI
007bf1d5 : SETZ DL
007bf1d8 : MOVSS dword ptr [EDI + 0x9c],XMM0
007bf1e0 : MOVSS dword ptr [EDI + 0xa0],XMM0
007bf1e8 : MOVSS XMM0,dword ptr [0x00c10fc4]
007bf1f0 : MOVSS dword ptr [EDI + 0xa4],XMM0
007bf1f8 : MOVSS XMM0,dword ptr [0x00cdf12c]
007bf200 : MOVSS dword ptr [EDI + 0xa8],XMM0
007bf208 : MOVSS XMM0,dword ptr [0x00cdf220]
007bf210 : PUSH EDX
007bf211 : MOVSS dword ptr [EDI + 0xac],XMM0
007bf219 : MOVSS XMM0,dword ptr [0x00cdf660]
007bf221 : PUSH EBX
007bf222 : MOVSS dword ptr [EDI + 0xb0],XMM0
007bf22a : MOVSS XMM0,dword ptr [0x00cdf0f0]
007bf232 : PUSH 0xbf1a4a
007bf237 : PUSH 0x78
007bf239 : MOVSS dword ptr [EDI + 0xb4],XMM0
007bf241 : MOV byte ptr [EDI + 0xd8],0x1
007bf248 : MOV byte ptr [EDI + 0xd9],0x1
007bf24f : MOV byte ptr [EDI + 0xdb],0x1
007bf256 : MOV byte ptr [EDI + 0xda],0x1
007bf25d : CALL 0x006f0760
007bf262 : ADD ESP,0x10
007bf265 : MOV dword ptr [EBP + 0xfffffeec],EAX
007bf26b : MOV byte ptr [EBP + -0x4],0xb
007bf26f : CMP EAX,EBX
007bf271 : JZ 0x007bf27c
007bf273 : PUSH EDI
007bf274 : PUSH EAX
007bf275 : CALL 0x007543a0
007bf27a : JMP 0x007bf27e
007bf27c : XOR EAX,EAX
007bf27e : MOV byte ptr [EBP + -0x4],0xa
007bf282 : MOV dword ptr [EDI + 0x7c],EAX
007bf285 : MOV EAX,[0x01725270]
007bf28a : SHR EAX,0x3
007bf28d : MOV ECX,0x0
007bf292 : AND EAX,ESI
007bf294 : SETZ CL
007bf297 : PUSH ECX
007bf298 : PUSH EBX
007bf299 : PUSH 0xbf1a4a
007bf29e : PUSH 0x78
007bf2a0 : CALL 0x006f0760
007bf2a5 : ADD ESP,0x10
007bf2a8 : MOV dword ptr [EBP + 0xfffffeec],EAX
007bf2ae : MOV byte ptr [EBP + -0x4],0xc
007bf2b2 : CMP EAX,EBX
007bf2b4 : JZ 0x007bf2bf
007bf2b6 : PUSH EDI
007bf2b7 : PUSH EAX
007bf2b8 : CALL 0x007543a0
007bf2bd : JMP 0x007bf2c1
007bf2bf : XOR EAX,EAX
007bf2c1 : MOV byte ptr [EBP + -0x4],0xa
007bf2c5 : PUSH 0xc18c3c
007bf2ca : PUSH 0x6
007bf2cc : PUSH 0x3c
007bf2ce : MOV dword ptr [EDI + 0x80],EAX
007bf2d4 : CALL dword ptr [0x00d6d240]
007bf2da : FLD float ptr [EDI + 0xb4]
007bf2e0 : MOV EDX,dword ptr [EDI + 0x20]
007bf2e3 : FSTP float ptr [ESP + 0x8]
007bf2e7 : ADD ESP,0x8
007bf2ea : PUSH EDX
007bf2eb : MOV dword ptr [EDI + 0xd0],EBX
007bf2f1 : MOV dword ptr [EDI + 0xd4],ESI
007bf2f7 : MOV dword ptr [EDI + 0xcc],ESI
007bf2fd : CALL dword ptr [0x00b85714]
007bf303 : FLD float ptr [EDI + 0xb0]
007bf309 : MOV EAX,dword ptr [EDI + 0x20]
007bf30c : PUSH ECX
007bf30d : FSTP float ptr [ESP]
007bf310 : PUSH EAX
007bf311 : CALL dword ptr [0x00b85710]
007bf317 : MOV byte ptr [EBP + -0x4],0x9
007bf31b : CMP dword ptr [EBP + 0xfffffee4],EBX
007bf321 : JZ 0x007bf336
007bf323 : MOV ECX,dword ptr [EBP + 0xfffffed8]
007bf329 : PUSH ECX
007bf32a : CALL dword ptr [0x00b8511c]
007bf330 : MOV dword ptr [EBP + 0xfffffee4],EBX
007bf336 : MOV dword ptr [EBP + -0x4],0xffffffff
007bf33d : MOV EAX,EDI
007bf33f : MOV ECX,dword ptr [EBP + -0xc]
007bf342 : MOV dword ptr FS:[0x0],ECX
007bf349 : POP ECX
007bf34a : POP ESI
007bf34b : POP EBX
007bf34c : MOV ECX,dword ptr [EBP + -0x10]
007bf34f : XOR ECX,EBP
007bf351 : CALL 0x00633e6b
007bf356 : MOV ESP,EBP
007bf358 : POP EBP
007bf359 : RET
