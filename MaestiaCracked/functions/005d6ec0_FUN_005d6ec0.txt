PROGRAM  : Maestia.exe
FUNCTION : FUN_005d6ec0
ENTRY    : 005d6ec0
BODY     : [[005d6ec0, 005d702f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005d6ec0(int param_1,int param_2)

{
  undefined1 uVar1;
  undefined1 uVar2;
  int iVar3;
  ushort uVar4;
  ushort uVar5;
  byte *pbVar6;
  int in_ECX;
  int iVar7;
  byte local_28 [4];
  GRefCountImpl *local_24;
  int local_20;
  int local_1c;
  GMatrix2D local_18 [24];
  
  iVar7 = *(int *)(param_1 + 0x314);
  if (iVar7 == 0) {
    iVar7 = param_1 + 0x28;
  }
  *(undefined1 *)(iVar7 + 0x15) = 0;
  if (*(int *)(iVar7 + 0x30) - *(int *)(iVar7 + 0x2c) < 2) {
    FUN_00539fb0(2);
  }
  iVar3 = *(int *)(iVar7 + 0x2c);
  uVar1 = *(undefined1 *)(*(int *)(iVar7 + 0x3c) + 1 + iVar3);
  uVar2 = *(undefined1 *)(*(int *)(iVar7 + 0x3c) + iVar3);
  *(int *)(iVar7 + 0x2c) = iVar3 + 2;
  uVar4 = 0;
  *(ushort *)(in_ECX + 4) = CONCAT11(uVar1,uVar2);
  if (param_2 == 0x53) {
    uVar4 = FUN_00500140();
    *(ushort *)(in_ECX + 0x10) = uVar4;
    if ((uVar4 & 0x20) != 0) {
      uVar5 = FUN_00500140();
      *(float *)(in_ECX + 0x14) = (float)uVar5 * 0.00390625;
    }
  }
  if ((uVar4 & 8) == 0) {
    FUN_005a0260(in_ECX + 8,param_2);
  }
  else {
    local_20 = 0;
    local_1c = 0;
    GMatrix2D::SetIdentity(local_18);
    local_28[0] = 0;
    local_28[1] = 2;
    local_24 = (GRefCountImpl *)0x0;
    pbVar6 = (byte *)FUN_00515840(0x28,0);
    if (pbVar6 == (byte *)0x0) {
      pbVar6 = (byte *)0x0;
    }
    else {
      pbVar6[8] = 0;
      pbVar6[9] = 0;
      pbVar6[10] = 0;
      pbVar6[0xb] = 0;
      pbVar6[0xc] = 0;
      pbVar6[0xd] = 0;
      pbVar6[0xe] = 0;
      pbVar6[0xf] = 0;
      GMatrix2D::SetIdentity((GMatrix2D *)(pbVar6 + 0x10));
      *pbVar6 = 0;
      pbVar6[1] = 2;
      pbVar6[4] = 0;
      pbVar6[5] = 0;
      pbVar6[6] = 0;
      pbVar6[7] = 0;
    }
    *(byte **)(in_ECX + 0xc) = pbVar6;
    if (pbVar6 == (byte *)0x0) {
      pbVar6 = local_28;
    }
    FUN_005d67b0(param_1,param_2);
    if (*pbVar6 == 0) {
      *(undefined4 *)(in_ECX + 8) = *(undefined4 *)(pbVar6 + 4);
    }
    else if ((((*pbVar6 & 0x10) != 0) && (iVar7 = *(int *)(pbVar6 + 4), iVar7 != 0)) &&
            (*(short *)(iVar7 + 10) != 0)) {
      *(undefined4 *)(in_ECX + 8) = *(undefined4 *)(*(int *)(iVar7 + 0xc) + 4);
    }
    if (((local_28[0] & 0x10) != 0) && (local_24 != (GRefCountImpl *)0x0)) {
      GRefCountImpl::Release(local_24);
    }
    if ((local_20 == 0) && (local_1c != 0)) {
      FUN_00524240();
      return;
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005d6ec0 : SUB ESP,0x28
005d6ec3 : PUSH EBX
005d6ec4 : PUSH EBP
005d6ec5 : PUSH ESI
005d6ec6 : PUSH EDI
005d6ec7 : MOV EDI,dword ptr [ESP + 0x3c]
005d6ecb : MOV ESI,dword ptr [EDI + 0x314]
005d6ed1 : MOV EBP,ECX
005d6ed3 : TEST ESI,ESI
005d6ed5 : JNZ 0x005d6eda
005d6ed7 : LEA ESI,[EDI + 0x28]
005d6eda : MOV EAX,dword ptr [ESI + 0x30]
005d6edd : SUB EAX,dword ptr [ESI + 0x2c]
005d6ee0 : MOV byte ptr [ESI + 0x15],0x0
005d6ee4 : CMP EAX,0x2
005d6ee7 : JGE 0x005d6ef2
005d6ee9 : PUSH 0x2
005d6eeb : MOV ECX,ESI
005d6eed : CALL 0x00539fb0
005d6ef2 : MOV EAX,dword ptr [ESI + 0x2c]
005d6ef5 : MOV ECX,dword ptr [ESI + 0x3c]
005d6ef8 : MOVZX DX,byte ptr [ECX + EAX*0x1 + 0x1]
005d6efe : ADD ECX,EAX
005d6f00 : MOVZX CX,byte ptr [ECX]
005d6f04 : SHL DX,0x8
005d6f08 : OR DX,CX
005d6f0b : ADD EAX,0x2
005d6f0e : MOV dword ptr [ESI + 0x2c],EAX
005d6f11 : MOV ESI,dword ptr [ESP + 0x40]
005d6f15 : MOVZX ECX,DX
005d6f18 : XOR EBX,EBX
005d6f1a : MOV word ptr [EBP + 0x4],CX
005d6f1e : CMP ESI,0x53
005d6f21 : JNZ 0x005d6f51
005d6f23 : MOV ECX,EDI
005d6f25 : CALL 0x00500140
005d6f2a : MOVZX EBX,AX
005d6f2d : MOV word ptr [EBP + 0x10],BX
005d6f31 : TEST BL,0x20
005d6f34 : JZ 0x005d6f51
005d6f36 : MOV ECX,EDI
005d6f38 : CALL 0x00500140
005d6f3d : MOVZX EDX,AX
005d6f40 : MOV dword ptr [ESP + 0x3c],EDX
005d6f44 : FILD dword ptr [ESP + 0x3c]
005d6f48 : FMUL double ptr [0x00b86f00]
005d6f4e : FSTP float ptr [EBP + 0x14]
005d6f51 : TEST BL,0x8
005d6f54 : JZ 0x005d701a
005d6f5a : XOR EBX,EBX
005d6f5c : LEA ECX,[ESP + 0x20]
005d6f60 : MOV dword ptr [ESP + 0x18],EBX
005d6f64 : MOV dword ptr [ESP + 0x1c],EBX
005d6f68 : CALL 0x00522b80
005d6f6d : MOV EAX,dword ptr [EDI + 0x20]
005d6f70 : PUSH EBX
005d6f71 : MOV byte ptr [ESP + 0x14],BL
005d6f75 : MOV byte ptr [ESP + 0x15],0x2
005d6f7a : MOV dword ptr [ESP + 0x18],EBX
005d6f7e : MOV ECX,dword ptr [EAX + 0x1c]
005d6f81 : PUSH 0x28
005d6f83 : CALL 0x00515840
005d6f88 : MOV ESI,EAX
005d6f8a : CMP ESI,EBX
005d6f8c : JZ 0x005d6fa7
005d6f8e : LEA ECX,[ESI + 0x10]
005d6f91 : MOV dword ptr [ESI + 0x8],EBX
005d6f94 : MOV dword ptr [ESI + 0xc],EBX
005d6f97 : CALL 0x00522b80
005d6f9c : MOV byte ptr [ESI],BL
005d6f9e : MOV byte ptr [ESI + 0x1],0x2
005d6fa2 : MOV dword ptr [ESI + 0x4],EBX
005d6fa5 : JMP 0x005d6fa9
005d6fa7 : XOR ESI,ESI
005d6fa9 : MOV dword ptr [EBP + 0xc],ESI
005d6fac : CMP ESI,EBX
005d6fae : JNZ 0x005d6fb4
005d6fb0 : LEA ESI,[ESP + 0x10]
005d6fb4 : MOV ECX,dword ptr [ESP + 0x40]
005d6fb8 : PUSH ECX
005d6fb9 : PUSH EDI
005d6fba : MOV ECX,ESI
005d6fbc : CALL 0x005d67b0
005d6fc1 : MOV AL,byte ptr [ESI]
005d6fc3 : TEST AL,AL
005d6fc5 : JNZ 0x005d6fcf
005d6fc7 : MOV EDX,dword ptr [ESI + 0x4]
005d6fca : MOV dword ptr [EBP + 0x8],EDX
005d6fcd : JMP 0x005d6fe9
005d6fcf : TEST AL,0x10
005d6fd1 : JZ 0x005d6fe9
005d6fd3 : MOV ESI,dword ptr [ESI + 0x4]
005d6fd6 : CMP ESI,EBX
005d6fd8 : JZ 0x005d6fe9
005d6fda : CMP word ptr [ESI + 0xa],BX
005d6fde : JBE 0x005d6fe9
005d6fe0 : MOV EAX,dword ptr [ESI + 0xc]
005d6fe3 : MOV ECX,dword ptr [EAX + 0x4]
005d6fe6 : MOV dword ptr [EBP + 0x8],ECX
005d6fe9 : TEST byte ptr [ESP + 0x10],0x10
005d6fee : JZ 0x005d6ffd
005d6ff0 : MOV ECX,dword ptr [ESP + 0x14]
005d6ff4 : CMP ECX,EBX
005d6ff6 : JZ 0x005d6ffd
005d6ff8 : CALL 0x004ff7e0
005d6ffd : CMP dword ptr [ESP + 0x18],EBX
005d7001 : JNZ 0x005d7026
005d7003 : MOV ECX,dword ptr [ESP + 0x1c]
005d7007 : CMP ECX,EBX
005d7009 : JZ 0x005d7026
005d700b : CALL 0x00524240
005d7010 : POP EDI
005d7011 : POP ESI
005d7012 : POP EBP
005d7013 : POP EBX
005d7014 : ADD ESP,0x28
005d7017 : RET 0x8
005d701a : PUSH ESI
005d701b : ADD EBP,0x8
005d701e : PUSH EBP
005d701f : MOV ECX,EDI
005d7021 : CALL 0x005a0260
005d7026 : POP EDI
005d7027 : POP ESI
005d7028 : POP EBP
005d7029 : POP EBX
005d702a : ADD ESP,0x28
005d702d : RET 0x8
