PROGRAM  : Maestia.exe
FUNCTION : FUN_006a1350
ENTRY    : 006a1350
BODY     : [[006a1350, 006a169b]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_006a1350(undefined4 param_1)

{
  short sVar1;
  longlong lVar2;
  char cVar3;
  int iVar4;
  undefined4 uVar5;
  short *psVar6;
  int iVar7;
  undefined4 uVar8;
  short sVar9;
  short sVar10;
  undefined4 *unaff_EDI;
  int local_c;
  undefined4 local_8;
  undefined4 local_4;
  
  local_8 = unaff_EDI[0x19];
  sVar9 = 0;
  local_c = 0;
  local_c = FUN_006a03e0(param_1);
  if ((((local_c == 0) && (local_c = FUN_006a0780(), local_c == 0)) &&
      ((cVar3 = FUN_006a06e0(), cVar3 != '\0' || (local_c = FUN_006a1020(2), local_c == 0)))) &&
     ((((local_c = FUN_006a0a60(param_1), local_c == 0 && (local_c = FUN_006a0c10(), local_c == 0))
       && (local_c = FUN_006a0dc0(), local_c == 0)) &&
      ((iVar4 = 0, cVar3 == '\0' || (iVar4 = FUN_006a1020(0x100), iVar4 == 0)))))) {
    local_c = iVar4;
    *unaff_EDI = 1;
    unaff_EDI[1] = 0;
    unaff_EDI[2] = 0x92;
    if (*(char *)((int)unaff_EDI + 199) != '\0') {
      unaff_EDI[2] = 0x96;
    }
    local_c = FUN_006a1170();
    if (local_c == 0) {
      iVar4 = FUN_006a0700("FAMILY_NAME");
      if ((iVar4 == 0) || (*(char *)(iVar4 + 4) == '\0')) {
        unaff_EDI[5] = 0;
      }
      else {
        uVar5 = FUN_00687fb0(local_8,*(undefined4 *)(iVar4 + 8),&local_c);
        unaff_EDI[5] = uVar5;
        if (local_c != 0) {
          return 3;
        }
      }
      unaff_EDI[4] = unaff_EDI[0x48] + 1;
      unaff_EDI[7] = 1;
      psVar6 = (short *)FUN_0068a220(local_8,0x10,0,1,0,&local_c);
      unaff_EDI[8] = psVar6;
      if (local_c == 0) {
        psVar6[0] = 0;
        psVar6[1] = 0;
        psVar6[2] = 0;
        psVar6[3] = 0;
        psVar6[4] = 0;
        psVar6[5] = 0;
        psVar6[6] = 0;
        psVar6[7] = 0;
        sVar10 = *(short *)(unaff_EDI + 0x34);
        sVar1 = *(short *)(unaff_EDI + 0x33);
        local_4 = 0;
        *psVar6 = sVar10 + sVar1;
        iVar4 = FUN_006a0700("AVERAGE_WIDTH");
        if (iVar4 == 0) {
          lVar2 = (longlong)((short)(sVar10 + sVar1) * 2) * 0x55555556;
          psVar6[1] = (short)((ulonglong)lVar2 >> 0x20) - (short)(lVar2 >> 0x3f);
        }
        else {
          iVar4 = *(int *)(iVar4 + 8) + 5;
          psVar6[1] = ((short)(iVar4 / 10) + (short)(iVar4 >> 0x1f)) -
                      (short)((longlong)iVar4 * 0x66666667 >> 0x3f);
        }
        iVar4 = FUN_006a0700("POINT_SIZE");
        if (iVar4 != 0) {
          *(int *)(psVar6 + 2) = (*(int *)(iVar4 + 8) * 0x70800 + 0x8d27) / 0x11a4e;
        }
        iVar4 = FUN_006a0700("PIXEL_SIZE");
        if (iVar4 != 0) {
          *(int *)(psVar6 + 6) = (int)*(short *)(iVar4 + 8) << 6;
        }
        iVar4 = FUN_006a0700("RESOLUTION_X");
        if (iVar4 == 0) {
          sVar10 = (short)local_4;
        }
        else {
          sVar10 = *(short *)(iVar4 + 8);
        }
        iVar4 = FUN_006a0700("RESOLUTION_Y");
        if (iVar4 != 0) {
          sVar9 = *(short *)(iVar4 + 8);
        }
        if (*(int *)(psVar6 + 6) == 0) {
          *(int *)(psVar6 + 6) = *(int *)(psVar6 + 2);
          if (sVar9 != 0) {
            *(int *)(psVar6 + 6) = ((int)sVar9 * *(int *)(psVar6 + 2)) / 0x48;
          }
        }
        if ((sVar10 == 0) || (sVar9 == 0)) {
          *(undefined4 *)(psVar6 + 4) = *(undefined4 *)(psVar6 + 6);
        }
        else {
          *(int *)(psVar6 + 4) = ((int)sVar10 * *(int *)(psVar6 + 6)) / (int)sVar9;
        }
        iVar4 = FUN_006a0700("CHARSET_REGISTRY");
        iVar7 = FUN_006a0700("CHARSET_ENCODING");
        uVar5 = local_8;
        if ((((iVar4 != 0) && (*(char *)(iVar4 + 4) != '\0')) && (iVar7 != 0)) &&
           (*(char *)(iVar7 + 4) != '\0')) {
          uVar8 = FUN_00687fb0(local_8,*(undefined4 *)(iVar7 + 8),&local_c);
          unaff_EDI[0x2c] = uVar8;
          if (local_c != 0) {
            return 3;
          }
          uVar5 = FUN_00687fb0(uVar5,*(undefined4 *)(iVar4 + 8),&local_c);
          unaff_EDI[0x2d] = uVar5;
        }
        if (local_c == 0) {
          return 0;
        }
      }
    }
  }
  return 3;
}



============================================================
DISASSEMBLY
============================================================
006a1350 : SUB ESP,0x10
006a1353 : MOV EAX,dword ptr [EDI + 0x64]
006a1356 : PUSH EBX
006a1357 : PUSH EBP
006a1358 : MOV EBP,dword ptr [ESP + 0x1c]
006a135c : PUSH ESI
006a135d : PUSH EDI
006a135e : XOR EBX,EBX
006a1360 : PUSH EBP
006a1361 : MOV dword ptr [ESP + 0x18],EBX
006a1365 : MOV dword ptr [ESP + 0x1c],EAX
006a1369 : CALL 0x006a03e0
006a136e : ADD ESP,0x8
006a1371 : MOV dword ptr [ESP + 0x10],EAX
006a1375 : CMP EAX,EBX
006a1377 : JNZ 0x006a1690
006a137d : PUSH EDI
006a137e : MOV EAX,EBP
006a1380 : CALL 0x006a0780
006a1385 : ADD ESP,0x4
006a1388 : MOV dword ptr [ESP + 0x10],EAX
006a138c : CMP EAX,EBX
006a138e : JNZ 0x006a1690
006a1394 : MOV EDX,dword ptr [EDI + 0xbc]
006a139a : MOV ECX,dword ptr [EDI + 0xc0]
006a13a0 : MOV ESI,0x100
006a13a5 : CALL 0x006a06e0
006a13aa : MOV byte ptr [ESP + 0xf],AL
006a13ae : TEST AL,AL
006a13b0 : JNZ 0x006a13cc
006a13b2 : PUSH 0x2
006a13b4 : MOV ECX,EDI
006a13b6 : MOV EAX,EBP
006a13b8 : CALL 0x006a1020
006a13bd : ADD ESP,0x4
006a13c0 : MOV dword ptr [ESP + 0x10],EAX
006a13c4 : CMP EAX,EBX
006a13c6 : JNZ 0x006a1690
006a13cc : PUSH EDI
006a13cd : PUSH EBP
006a13ce : CALL 0x006a0a60
006a13d3 : ADD ESP,0x8
006a13d6 : MOV dword ptr [ESP + 0x10],EAX
006a13da : CMP EAX,EBX
006a13dc : JNZ 0x006a1690
006a13e2 : PUSH EDI
006a13e3 : MOV EAX,EBP
006a13e5 : CALL 0x006a0c10
006a13ea : ADD ESP,0x4
006a13ed : MOV dword ptr [ESP + 0x10],EAX
006a13f1 : CMP EAX,EBX
006a13f3 : JNZ 0x006a1690
006a13f9 : PUSH EDI
006a13fa : MOV EAX,EBP
006a13fc : CALL 0x006a0dc0
006a1401 : ADD ESP,0x4
006a1404 : MOV dword ptr [ESP + 0x10],EAX
006a1408 : CMP EAX,EBX
006a140a : JNZ 0x006a1690
006a1410 : CMP byte ptr [ESP + 0xf],BL
006a1414 : JZ 0x006a1433
006a1416 : PUSH 0x100
006a141b : MOV ECX,EDI
006a141d : MOV EAX,EBP
006a141f : CALL 0x006a1020
006a1424 : ADD ESP,0x4
006a1427 : MOV dword ptr [ESP + 0x10],EAX
006a142b : CMP EAX,EBX
006a142d : JNZ 0x006a1690
006a1433 : MOV dword ptr [EDI],0x1
006a1439 : MOV dword ptr [EDI + 0x4],EBX
006a143c : MOV dword ptr [EDI + 0x8],0x92
006a1443 : CMP byte ptr [EDI + 0xc7],BL
006a1449 : JZ 0x006a1452
006a144b : MOV dword ptr [EDI + 0x8],0x96
006a1452 : PUSH EDI
006a1453 : CALL 0x006a1170
006a1458 : ADD ESP,0x4
006a145b : MOV dword ptr [ESP + 0x10],EAX
006a145f : CMP EAX,EBX
006a1461 : JNZ 0x006a1690
006a1467 : PUSH 0xbd89cc
006a146c : MOV EAX,EDI
006a146e : CALL 0x006a0700
006a1473 : ADD ESP,0x4
006a1476 : CMP EAX,EBX
006a1478 : JZ 0x006a14a4
006a147a : CMP byte ptr [EAX + 0x4],BL
006a147d : JZ 0x006a14a4
006a147f : MOV EDX,dword ptr [EAX + 0x8]
006a1482 : MOV EAX,dword ptr [ESP + 0x14]
006a1486 : LEA ECX,[ESP + 0x10]
006a148a : PUSH ECX
006a148b : PUSH EDX
006a148c : PUSH EAX
006a148d : CALL 0x00687fb0
006a1492 : ADD ESP,0xc
006a1495 : MOV dword ptr [EDI + 0x14],EAX
006a1498 : CMP dword ptr [ESP + 0x10],EBX
006a149c : JNZ 0x006a1690
006a14a2 : JMP 0x006a14a7
006a14a4 : MOV dword ptr [EDI + 0x14],EBX
006a14a7 : MOV ECX,dword ptr [EDI + 0x120]
006a14ad : MOV EAX,dword ptr [ESP + 0x14]
006a14b1 : LEA EDX,[ESP + 0x10]
006a14b5 : PUSH EDX
006a14b6 : PUSH EBX
006a14b7 : PUSH 0x1
006a14b9 : PUSH EBX
006a14ba : INC ECX
006a14bb : PUSH 0x10
006a14bd : PUSH EAX
006a14be : MOV dword ptr [EDI + 0x10],ECX
006a14c1 : MOV dword ptr [EDI + 0x1c],0x1
006a14c8 : CALL 0x0068a220
006a14cd : ADD ESP,0x18
006a14d0 : MOV ESI,EAX
006a14d2 : MOV dword ptr [EDI + 0x20],ESI
006a14d5 : CMP dword ptr [ESP + 0x10],EBX
006a14d9 : JNZ 0x006a1690
006a14df : XOR EAX,EAX
006a14e1 : MOV dword ptr [ESI],EAX
006a14e3 : MOV dword ptr [ESI + 0x4],EAX
006a14e6 : MOV dword ptr [ESI + 0x8],EAX
006a14e9 : MOV dword ptr [ESI + 0xc],EAX
006a14ec : MOV BP,word ptr [EDI + 0xd0]
006a14f3 : ADD BP,word ptr [EDI + 0xcc]
006a14fa : PUSH 0xbd8aa4
006a14ff : MOV EAX,EDI
006a1501 : MOV dword ptr [ESP + 0x1c],EBX
006a1505 : MOV word ptr [ESI],BP
006a1508 : CALL 0x006a0700
006a150d : ADD ESP,0x4
006a1510 : TEST EAX,EAX
006a1512 : JZ 0x006a1531
006a1514 : MOV ECX,dword ptr [EAX + 0x8]
006a1517 : ADD ECX,0x5
006a151a : MOV EAX,0x66666667
006a151f : IMUL ECX
006a1521 : SAR EDX,0x2
006a1524 : MOV ECX,EDX
006a1526 : SHR ECX,0x1f
006a1529 : ADD ECX,EDX
006a152b : MOV word ptr [ESI + 0x2],CX
006a152f : JMP 0x006a1548
006a1531 : MOVSX ECX,BP
006a1534 : ADD ECX,ECX
006a1536 : MOV EAX,0x55555556
006a153b : IMUL ECX
006a153d : MOV EAX,EDX
006a153f : SHR EAX,0x1f
006a1542 : ADD EAX,EDX
006a1544 : MOV word ptr [ESI + 0x2],AX
006a1548 : PUSH 0xbd8924
006a154d : MOV EAX,EDI
006a154f : CALL 0x006a0700
006a1554 : ADD ESP,0x4
006a1557 : TEST EAX,EAX
006a1559 : JZ 0x006a157e
006a155b : MOV ECX,dword ptr [EAX + 0x8]
006a155e : IMUL ECX,ECX,0x70800
006a1564 : ADD ECX,0x8d27
006a156a : MOV EAX,0x3a095da3
006a156f : IMUL ECX
006a1571 : SAR EDX,0xe
006a1574 : MOV ECX,EDX
006a1576 : SHR ECX,0x1f
006a1579 : ADD ECX,EDX
006a157b : MOV dword ptr [ESI + 0x4],ECX
006a157e : PUSH 0xbd8930
006a1583 : MOV EAX,EDI
006a1585 : CALL 0x006a0700
006a158a : ADD ESP,0x4
006a158d : TEST EAX,EAX
006a158f : JZ 0x006a159b
006a1591 : MOVSX EDX,word ptr [EAX + 0x8]
006a1595 : SHL EDX,0x6
006a1598 : MOV dword ptr [ESI + 0xc],EDX
006a159b : PUSH 0xbd86d0
006a15a0 : MOV EAX,EDI
006a15a2 : CALL 0x006a0700
006a15a7 : ADD ESP,0x4
006a15aa : TEST EAX,EAX
006a15ac : JZ 0x006a15b4
006a15ae : MOVZX EBP,word ptr [EAX + 0x8]
006a15b2 : JMP 0x006a15b8
006a15b4 : MOV EBP,dword ptr [ESP + 0x18]
006a15b8 : PUSH 0xbd86c0
006a15bd : MOV EAX,EDI
006a15bf : CALL 0x006a0700
006a15c4 : ADD ESP,0x4
006a15c7 : TEST EAX,EAX
006a15c9 : JZ 0x006a15cf
006a15cb : MOVZX EBX,word ptr [EAX + 0x8]
006a15cf : CMP dword ptr [ESI + 0xc],0x0
006a15d3 : JNZ 0x006a15fa
006a15d5 : MOV EAX,dword ptr [ESI + 0x4]
006a15d8 : MOV dword ptr [ESI + 0xc],EAX
006a15db : TEST BX,BX
006a15de : JZ 0x006a15fa
006a15e0 : MOVSX ECX,BX
006a15e3 : IMUL ECX,EAX
006a15e6 : MOV EAX,0x38e38e39
006a15eb : IMUL ECX
006a15ed : SAR EDX,0x4
006a15f0 : MOV EAX,EDX
006a15f2 : SHR EAX,0x1f
006a15f5 : ADD EAX,EDX
006a15f7 : MOV dword ptr [ESI + 0xc],EAX
006a15fa : TEST BP,BP
006a15fd : JZ 0x006a1616
006a15ff : TEST BX,BX
006a1602 : JZ 0x006a1616
006a1604 : MOVSX EAX,BP
006a1607 : IMUL EAX,dword ptr [ESI + 0xc]
006a160b : MOVSX ECX,BX
006a160e : CDQ
006a160f : IDIV ECX
006a1611 : MOV dword ptr [ESI + 0x8],EAX
006a1614 : JMP 0x006a161c
006a1616 : MOV EDX,dword ptr [ESI + 0xc]
006a1619 : MOV dword ptr [ESI + 0x8],EDX
006a161c : PUSH 0xbd8a34
006a1621 : MOV EAX,EDI
006a1623 : CALL 0x006a0700
006a1628 : MOV ESI,EAX
006a162a : PUSH 0xbd8a48
006a162f : MOV EAX,EDI
006a1631 : CALL 0x006a0700
006a1636 : ADD ESP,0x8
006a1639 : TEST ESI,ESI
006a163b : JZ 0x006a1688
006a163d : CMP byte ptr [ESI + 0x4],0x0
006a1641 : JZ 0x006a1688
006a1643 : TEST EAX,EAX
006a1645 : JZ 0x006a1688
006a1647 : CMP byte ptr [EAX + 0x4],0x0
006a164b : JZ 0x006a1688
006a164d : MOV EDX,dword ptr [EAX + 0x8]
006a1650 : MOV EBX,dword ptr [ESP + 0x14]
006a1654 : LEA ECX,[ESP + 0x10]
006a1658 : PUSH ECX
006a1659 : PUSH EDX
006a165a : PUSH EBX
006a165b : CALL 0x00687fb0
006a1660 : ADD ESP,0xc
006a1663 : CMP dword ptr [ESP + 0x10],0x0
006a1668 : MOV dword ptr [EDI + 0xb0],EAX
006a166e : JNZ 0x006a1690
006a1670 : MOV ECX,dword ptr [ESI + 0x8]
006a1673 : LEA EAX,[ESP + 0x10]
006a1677 : PUSH EAX
006a1678 : PUSH ECX
006a1679 : PUSH EBX
006a167a : CALL 0x00687fb0
006a167f : ADD ESP,0xc
006a1682 : MOV dword ptr [EDI + 0xb4],EAX
006a1688 : MOV EAX,dword ptr [ESP + 0x10]
006a168c : TEST EAX,EAX
006a168e : JZ 0x006a1695
006a1690 : MOV EAX,0x3
006a1695 : POP ESI
006a1696 : POP EBP
006a1697 : POP EBX
006a1698 : ADD ESP,0x10
006a169b : RET
