PROGRAM  : Maestia.exe
FUNCTION : FUN_0080c120
ENTRY    : 0080c120
BODY     : [[0080c120, 0080c351]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0080c120(int *param_1,int param_2)

{
  undefined2 uVar1;
  undefined2 uVar2;
  int iVar3;
  char cVar4;
  int iVar5;
  undefined4 uVar6;
  int *piVar7;
  undefined1 local_2c [28];
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b43996;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  if (((char)param_1[2] != '\0') && (iVar3 = *(int *)(param_1[1] + 0x128), iVar3 != 0)) {
    iVar5 = (**(code **)(*param_1 + 0x74))(param_2,0,DAT_00d66fa0 ^ (uint)&stack0xfffffffc);
    if (*(int *)(iVar3 + 0x40) == -1) {
      FUN_0097fb30(iVar5,param_2,0);
      ExceptionList = local_10;
      return;
    }
    if (param_2 == 0) {
      if (iVar5 != 0) {
        param_2 = 1;
        iVar5 = (**(code **)(*param_1 + 0x74))(1,0);
        if (iVar5 != 0) {
          FUN_0097fa60();
          ExceptionList = local_10;
          return;
        }
      }
    }
    else if ((param_2 == 1) && (iVar5 != 0)) goto LAB_0080c313;
    iVar5 = FUN_008eb580();
    if (iVar5 != 0) {
      uVar1 = *(undefined2 *)(iVar3 + 0x44);
      uVar2 = *(undefined2 *)(iVar3 + 0x46);
      if ((*(int **)(iVar3 + 0x4c) != (int *)0x0) &&
         (cVar4 = (**(code **)(**(int **)(iVar3 + 0x4c) + 0x30))(), cVar4 != '\0')) {
        if (DAT_0172491c == 0) {
          ExceptionList = local_10;
          return;
        }
        if (*DAT_00da9894 == 0) {
          ExceptionList = local_10;
          return;
        }
        if (*(int *)(*DAT_00da9894 + 0x1a8) == 0) {
          ExceptionList = local_10;
          return;
        }
        FUN_00406460(L"IDS_ITEM_UNIDENTIFIED_ITEM");
        local_8 = 0;
        piVar7 = *(int **)(*DAT_00da9894 + 0x1a8);
        uVar6 = FUN_0081d120(local_2c);
        local_8._0_1_ = 1;
        (**(code **)(*piVar7 + 0x44))(uVar6,3);
        local_8 = (uint)local_8._1_3_ << 8;
        FUN_00406560();
        local_8 = 0xffffffff;
        FUN_00406560();
        ExceptionList = local_10;
        return;
      }
      if (*(int *)(iVar3 + 0x4c) == 0) {
        uVar6 = 0;
      }
      else {
        uVar6 = *(undefined4 *)(*(int *)(iVar3 + 0x4c) + 0x10);
      }
      piVar7 = (int *)FUN_004049b0(uVar6);
      if (piVar7 != (int *)0x0) {
        iVar5 = (**(code **)(*piVar7 + 0x3c))();
        if (iVar5 != 0) {
          FUN_008efa90(*(undefined4 *)(iVar3 + 0x40),uVar1,uVar2,0xd4,param_2,0);
          FUN_0097fa60();
          ExceptionList = local_10;
          return;
        }
        FUN_008ef980(*(undefined4 *)(iVar3 + 0x40),uVar1,uVar2,0xd4,param_2,0,1);
LAB_0080c313:
        FUN_0097fa60();
        ExceptionList = local_10;
        return;
      }
    }
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
0080c120 : PUSH EBP
0080c121 : MOV EBP,ESP
0080c123 : PUSH -0x1
0080c125 : PUSH 0xb43996
0080c12a : MOV EAX,FS:[0x0]
0080c130 : PUSH EAX
0080c131 : SUB ESP,0x3c
0080c134 : PUSH EBX
0080c135 : PUSH ESI
0080c136 : PUSH EDI
0080c137 : MOV EAX,[0x00d66fa0]
0080c13c : XOR EAX,EBP
0080c13e : PUSH EAX
0080c13f : LEA EAX,[EBP + -0xc]
0080c142 : MOV FS:[0x0],EAX
0080c148 : MOV EBX,dword ptr [EBP + 0x8]
0080c14b : MOV AL,byte ptr [EBX + 0x8]
0080c14e : TEST AL,AL
0080c150 : JZ 0x0080c33e
0080c156 : MOV EAX,dword ptr [EBX + 0x4]
0080c159 : MOV ESI,dword ptr [EAX + 0x128]
0080c15f : TEST ESI,ESI
0080c161 : JZ 0x0080c33e
0080c167 : MOV EDX,dword ptr [EBX]
0080c169 : MOV EDI,dword ptr [EBP + 0xc]
0080c16c : MOV EAX,dword ptr [EDX + 0x74]
0080c16f : PUSH 0x0
0080c171 : PUSH EDI
0080c172 : MOV ECX,EBX
0080c174 : CALL EAX
0080c176 : CMP dword ptr [ESI + 0x40],-0x1
0080c17a : JZ 0x0080c32e
0080c180 : TEST EDI,EDI
0080c182 : JNZ 0x0080c1ba
0080c184 : TEST EAX,EAX
0080c186 : JZ 0x0080c1c7
0080c188 : MOV EDX,dword ptr [EBX]
0080c18a : MOV EAX,dword ptr [EDX + 0x74]
0080c18d : PUSH EDI
0080c18e : PUSH 0x1
0080c190 : MOV ECX,EBX
0080c192 : MOV dword ptr [EBP + 0xc],0x1
0080c199 : CALL EAX
0080c19b : TEST EAX,EAX
0080c19d : JZ 0x0080c1c7
0080c19f : MOV ECX,ESI
0080c1a1 : CALL 0x0097fa60
0080c1a6 : MOV ECX,dword ptr [EBP + -0xc]
0080c1a9 : MOV dword ptr FS:[0x0],ECX
0080c1b0 : POP ECX
0080c1b1 : POP EDI
0080c1b2 : POP ESI
0080c1b3 : POP EBX
0080c1b4 : MOV ESP,EBP
0080c1b6 : POP EBP
0080c1b7 : RET 0x8
0080c1ba : CMP EDI,0x1
0080c1bd : JNZ 0x0080c1c7
0080c1bf : TEST EAX,EAX
0080c1c1 : JNZ 0x0080c313
0080c1c7 : MOV EDI,dword ptr [ESI + 0x40]
0080c1ca : MOV EAX,dword ptr [EBX + 0x4]
0080c1cd : CALL 0x008eb580
0080c1d2 : TEST EAX,EAX
0080c1d4 : JZ 0x0080c33e
0080c1da : MOV ECX,dword ptr [ESI + 0x4c]
0080c1dd : MOVZX EDI,word ptr [ESI + 0x44]
0080c1e1 : MOVZX EBX,word ptr [ESI + 0x46]
0080c1e5 : TEST ECX,ECX
0080c1e7 : JZ 0x0080c298
0080c1ed : MOV EDX,dword ptr [ECX]
0080c1ef : MOV EAX,dword ptr [EDX + 0x30]
0080c1f2 : CALL EAX
0080c1f4 : TEST AL,AL
0080c1f6 : JZ 0x0080c298
0080c1fc : CMP dword ptr [0x0172491c],0x0
0080c203 : JZ 0x0080c33e
0080c209 : MOV ECX,dword ptr [0x00da9894]
0080c20f : MOV EAX,dword ptr [ECX]
0080c211 : TEST EAX,EAX
0080c213 : JZ 0x0080c33e
0080c219 : CMP dword ptr [EAX + 0x1a8],0x0
0080c220 : JZ 0x0080c33e
0080c226 : PUSH 0xc2d5d0
0080c22b : LEA ECX,[EBP + -0x28]
0080c22e : CALL 0x00406460
0080c233 : MOV dword ptr [EBP + -0x4],0x0
0080c23a : MOV EDX,dword ptr [0x00da9894]
0080c240 : MOV EAX,dword ptr [EDX]
0080c242 : MOV ESI,dword ptr [EAX + 0x1a8]
0080c248 : MOV ECX,dword ptr [0x0172491c]
0080c24e : LEA EAX,[EBP + -0x28]
0080c251 : PUSH EAX
0080c252 : LEA EDI,[EBP + -0x44]
0080c255 : CALL 0x0081d120
0080c25a : MOV byte ptr [EBP + -0x4],0x1
0080c25e : MOV EDX,dword ptr [ESI]
0080c260 : PUSH 0x3
0080c262 : PUSH EAX
0080c263 : MOV EAX,dword ptr [EDX + 0x44]
0080c266 : MOV ECX,ESI
0080c268 : CALL EAX
0080c26a : MOV byte ptr [EBP + -0x4],0x0
0080c26e : MOV ECX,EDI
0080c270 : CALL 0x00406560
0080c275 : MOV dword ptr [EBP + -0x4],0xffffffff
0080c27c : LEA ECX,[EBP + -0x28]
0080c27f : CALL 0x00406560
0080c284 : MOV ECX,dword ptr [EBP + -0xc]
0080c287 : MOV dword ptr FS:[0x0],ECX
0080c28e : POP ECX
0080c28f : POP EDI
0080c290 : POP ESI
0080c291 : POP EBX
0080c292 : MOV ESP,EBP
0080c294 : POP EBP
0080c295 : RET 0x8
0080c298 : MOV EAX,dword ptr [ESI + 0x4c]
0080c29b : TEST EAX,EAX
0080c29d : JZ 0x0080c2a4
0080c29f : MOV EAX,dword ptr [EAX + 0x10]
0080c2a2 : JMP 0x0080c2a6
0080c2a4 : XOR EAX,EAX
0080c2a6 : PUSH EAX
0080c2a7 : CALL 0x004049b0
0080c2ac : ADD ESP,0x4
0080c2af : TEST EAX,EAX
0080c2b1 : JZ 0x0080c33e
0080c2b7 : MOV EDX,dword ptr [EAX]
0080c2b9 : MOV ECX,EAX
0080c2bb : MOV EAX,dword ptr [EDX + 0x3c]
0080c2be : CALL EAX
0080c2c0 : TEST EAX,EAX
0080c2c2 : JZ 0x0080c2f8
0080c2c4 : MOV ECX,dword ptr [EBP + 0xc]
0080c2c7 : MOV EDX,dword ptr [ESI + 0x40]
0080c2ca : PUSH 0x0
0080c2cc : PUSH ECX
0080c2cd : PUSH 0xd4
0080c2d2 : PUSH EBX
0080c2d3 : PUSH EDI
0080c2d4 : PUSH EDX
0080c2d5 : CALL 0x008efa90
0080c2da : ADD ESP,0x18
0080c2dd : MOV ECX,ESI
0080c2df : CALL 0x0097fa60
0080c2e4 : MOV ECX,dword ptr [EBP + -0xc]
0080c2e7 : MOV dword ptr FS:[0x0],ECX
0080c2ee : POP ECX
0080c2ef : POP EDI
0080c2f0 : POP ESI
0080c2f1 : POP EBX
0080c2f2 : MOV ESP,EBP
0080c2f4 : POP EBP
0080c2f5 : RET 0x8
0080c2f8 : MOV EAX,dword ptr [EBP + 0xc]
0080c2fb : MOV ECX,dword ptr [ESI + 0x40]
0080c2fe : PUSH 0x1
0080c300 : PUSH 0x0
0080c302 : PUSH EAX
0080c303 : PUSH 0xd4
0080c308 : PUSH EBX
0080c309 : PUSH EDI
0080c30a : PUSH ECX
0080c30b : CALL 0x008ef980
0080c310 : ADD ESP,0x1c
0080c313 : MOV ECX,ESI
0080c315 : CALL 0x0097fa60
0080c31a : MOV ECX,dword ptr [EBP + -0xc]
0080c31d : MOV dword ptr FS:[0x0],ECX
0080c324 : POP ECX
0080c325 : POP EDI
0080c326 : POP ESI
0080c327 : POP EBX
0080c328 : MOV ESP,EBP
0080c32a : POP EBP
0080c32b : RET 0x8
0080c32e : PUSH 0x0
0080c330 : PUSH EDI
0080c331 : PUSH EAX
0080c332 : MOV EAX,0xd4
0080c337 : MOV ECX,ESI
0080c339 : CALL 0x0097fb30
0080c33e : MOV ECX,dword ptr [EBP + -0xc]
0080c341 : MOV dword ptr FS:[0x0],ECX
0080c348 : POP ECX
0080c349 : POP EDI
0080c34a : POP ESI
0080c34b : POP EBX
0080c34c : MOV ESP,EBP
0080c34e : POP EBP
0080c34f : RET 0x8
