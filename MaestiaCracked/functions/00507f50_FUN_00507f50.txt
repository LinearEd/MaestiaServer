PROGRAM  : Maestia.exe
FUNCTION : FUN_00507f50
ENTRY    : 00507f50
BODY     : [[00507f50, 00508059] [00508060, 005080b5]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00507f50(undefined4 param_1,int param_2,uint param_3)

{
  uint *puVar1;
  int iVar2;
  int *piVar3;
  uint uVar4;
  uint *puVar5;
  int *in_ECX;
  int iVar6;
  uint uVar7;
  int iVar8;
  
  piVar3 = (int *)*in_ECX;
  if (piVar3 == (int *)0x0) {
    iVar8 = 8;
  }
  else {
    if ((uint)(*piVar3 * 5) <= piVar3[1] * 4 + 4U) goto LAB_00507f8c;
    iVar8 = piVar3[1] * 2 + 2;
  }
  FUN_005072f0(param_1,iVar8);
LAB_00507f8c:
  piVar3 = (int *)*in_ECX;
  param_3 = param_3 & piVar3[1];
  *piVar3 = *piVar3 + 1;
  iVar8 = *in_ECX;
  puVar1 = (uint *)(param_3 * 0x10 + 8 + iVar8);
  if (*puVar1 == 0xfffffffe) {
    *puVar1 = 0xffffffff;
    FUN_0051c2c0(param_2);
    if (*(int *)(param_2 + 4) != 0) {
      piVar3 = (int *)(*(int *)(param_2 + 4) + 4);
      *piVar3 = *piVar3 + 1;
    }
    puVar1[3] = *(uint *)(param_2 + 4);
    puVar1[1] = param_3;
    return;
  }
  uVar7 = param_3;
  do {
    uVar7 = uVar7 + 1 & *(uint *)(iVar8 + 4);
  } while (*(int *)(uVar7 * 0x10 + 8 + iVar8) != -2);
  iVar2 = uVar7 * 0x10 + 8 + iVar8;
  if (puVar1[1] == param_3) {
    if (iVar2 != 0) {
      FUN_005035b0(puVar1);
    }
    FUN_0051bc20(param_2);
    if (*(int *)(param_2 + 4) != 0) {
      piVar3 = (int *)(*(int *)(param_2 + 4) + 4);
      *piVar3 = *piVar3 + 1;
    }
    if ((GRefCountNTSImpl *)puVar1[3] != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release((GRefCountNTSImpl *)puVar1[3]);
    }
    puVar1[3] = *(uint *)(param_2 + 4);
    *puVar1 = uVar7;
    puVar1[1] = param_3;
    return;
  }
  iVar6 = puVar1[1] * 0x10;
  uVar4 = *(uint *)(iVar6 + 8 + iVar8);
  while (puVar5 = (uint *)(iVar6 + 8 + iVar8), uVar4 != param_3) {
    iVar6 = *puVar5 * 0x10;
    uVar4 = *(uint *)(iVar6 + 8 + iVar8);
  }
  if (iVar2 != 0) {
    FUN_005035b0(puVar1);
  }
  *puVar5 = uVar7;
  FUN_0051bc20(param_2);
  if (*(int *)(param_2 + 4) != 0) {
    piVar3 = (int *)(*(int *)(param_2 + 4) + 4);
    *piVar3 = *piVar3 + 1;
  }
  if ((GRefCountNTSImpl *)puVar1[3] != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release((GRefCountNTSImpl *)puVar1[3]);
  }
  puVar1[3] = *(uint *)(param_2 + 4);
  puVar1[1] = param_3;
  *puVar1 = 0xffffffff;
  return;
}



============================================================
DISASSEMBLY
============================================================
00507f50 : PUSH EBX
00507f51 : PUSH EBP
00507f52 : PUSH ESI
00507f53 : MOV ESI,ECX
00507f55 : MOV EAX,dword ptr [ESI]
00507f57 : PUSH EDI
00507f58 : TEST EAX,EAX
00507f5a : JNZ 0x00507f65
00507f5c : MOV EAX,dword ptr [ESP + 0x14]
00507f60 : PUSH 0x8
00507f62 : PUSH EAX
00507f63 : JMP 0x00507f87
00507f65 : MOV ECX,dword ptr [EAX + 0x4]
00507f68 : LEA EDX,[ECX*0x4 + 0x4]
00507f6f : MOV ECX,dword ptr [EAX]
00507f71 : LEA ECX,[ECX + ECX*0x4]
00507f74 : CMP ECX,EDX
00507f76 : JBE 0x00507f8c
00507f78 : MOV EDX,dword ptr [EAX + 0x4]
00507f7b : MOV ECX,dword ptr [ESP + 0x14]
00507f7f : LEA EAX,[EDX + EDX*0x1 + 0x2]
00507f83 : PUSH EAX
00507f84 : PUSH ECX
00507f85 : MOV ECX,ESI
00507f87 : CALL 0x005072f0
00507f8c : MOV EAX,dword ptr [ESI]
00507f8e : MOV EBP,dword ptr [ESP + 0x1c]
00507f92 : AND EBP,dword ptr [EAX + 0x4]
00507f95 : INC dword ptr [EAX]
00507f97 : MOV EAX,dword ptr [ESI]
00507f99 : MOV EDX,EBP
00507f9b : SHL EDX,0x4
00507f9e : LEA ESI,[EDX + EAX*0x1 + 0x8]
00507fa2 : MOV EDX,0xfffffffe
00507fa7 : CMP dword ptr [ESI],EDX
00507fa9 : JNZ 0x00507fdf
00507fab : MOV EBX,dword ptr [ESP + 0x18]
00507faf : LEA EDI,[ESI + 0x8]
00507fb2 : PUSH EBX
00507fb3 : MOV ECX,EDI
00507fb5 : MOV dword ptr [ESI],0xffffffff
00507fbb : MOV byte ptr [ESP + 0x18],0x0
00507fc0 : CALL 0x0051c2c0
00507fc5 : MOV EAX,dword ptr [EBX + 0x4]
00507fc8 : TEST EAX,EAX
00507fca : JZ 0x00507fcf
00507fcc : INC dword ptr [EAX + 0x4]
00507fcf : MOV EAX,dword ptr [EBX + 0x4]
00507fd2 : MOV dword ptr [EDI + 0x4],EAX
00507fd5 : POP EDI
00507fd6 : MOV dword ptr [ESI + 0x4],EBP
00507fd9 : POP ESI
00507fda : POP EBP
00507fdb : POP EBX
00507fdc : RET 0xc
00507fdf : MOV ECX,dword ptr [EAX + 0x4]
00507fe2 : MOV EDI,EBP
00507fe4 : INC EDI
00507fe5 : AND EDI,ECX
00507fe7 : MOV EBX,EDI
00507fe9 : SHL EBX,0x4
00507fec : CMP dword ptr [EBX + EAX*0x1 + 0x8],EDX
00507ff0 : JNZ 0x00507fe4
00507ff2 : MOV EDX,dword ptr [ESI + 0x4]
00507ff5 : MOV ECX,EDI
00507ff7 : SHL ECX,0x4
00507ffa : LEA ECX,[ECX + EAX*0x1 + 0x8]
00507ffe : CMP EDX,EBP
00508000 : JNZ 0x0050804b
00508002 : TEST ECX,ECX
00508004 : JZ 0x0050800c
00508006 : PUSH ESI
00508007 : CALL 0x005035b0
0050800c : MOV EDX,dword ptr [ESP + 0x18]
00508010 : LEA EBX,[ESI + 0x8]
00508013 : PUSH EDX
00508014 : MOV ECX,EBX
00508016 : CALL 0x0051bc20
0050801b : MOV EAX,dword ptr [ESP + 0x18]
0050801f : MOV EAX,dword ptr [EAX + 0x4]
00508022 : TEST EAX,EAX
00508024 : JZ 0x00508029
00508026 : INC dword ptr [EAX + 0x4]
00508029 : MOV ECX,dword ptr [EBX + 0x4]
0050802c : TEST ECX,ECX
0050802e : JZ 0x00508035
00508030 : CALL 0x004ff7c0
00508035 : MOV ECX,dword ptr [ESP + 0x18]
00508039 : MOV EDX,dword ptr [ECX + 0x4]
0050803c : MOV dword ptr [EBX + 0x4],EDX
0050803f : MOV dword ptr [ESI],EDI
00508041 : POP EDI
00508042 : MOV dword ptr [ESI + 0x4],EBP
00508045 : POP ESI
00508046 : POP EBP
00508047 : POP EBX
00508048 : RET 0xc
0050804b : SHL EDX,0x4
0050804e : CMP dword ptr [EDX + EAX*0x1 + 0x8],EBP
00508052 : LEA EBX,[EDX + EAX*0x1 + 0x8]
00508056 : JZ 0x0050806f
00508058 : JMP 0x00508060
00508060 : MOV EDX,dword ptr [EBX]
00508062 : SHL EDX,0x4
00508065 : CMP dword ptr [EDX + EAX*0x1 + 0x8],EBP
00508069 : LEA EBX,[EDX + EAX*0x1 + 0x8]
0050806d : JNZ 0x00508060
0050806f : TEST ECX,ECX
00508071 : JZ 0x00508079
00508073 : PUSH ESI
00508074 : CALL 0x005035b0
00508079 : MOV dword ptr [EBX],EDI
0050807b : MOV EBX,dword ptr [ESP + 0x18]
0050807f : LEA EDI,[ESI + 0x8]
00508082 : PUSH EBX
00508083 : MOV ECX,EDI
00508085 : CALL 0x0051bc20
0050808a : MOV EAX,dword ptr [EBX + 0x4]
0050808d : TEST EAX,EAX
0050808f : JZ 0x00508094
00508091 : INC dword ptr [EAX + 0x4]
00508094 : MOV ECX,dword ptr [EDI + 0x4]
00508097 : TEST ECX,ECX
00508099 : JZ 0x005080a0
0050809b : CALL 0x004ff7c0
005080a0 : MOV EAX,dword ptr [EBX + 0x4]
005080a3 : MOV dword ptr [EDI + 0x4],EAX
005080a6 : POP EDI
005080a7 : MOV dword ptr [ESI + 0x4],EBP
005080aa : MOV dword ptr [ESI],0xffffffff
005080b0 : POP ESI
005080b1 : POP EBP
005080b2 : POP EBX
005080b3 : RET 0xc
