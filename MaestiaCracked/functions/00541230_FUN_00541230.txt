PROGRAM  : Maestia.exe
FUNCTION : FUN_00541230
ENTRY    : 00541230
BODY     : [[00541230, 005412a6] [005412b0, 00541532]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00541230(int param_1,int param_2)

{
  byte bVar1;
  uint uVar2;
  int *piVar3;
  void *_Dst;
  int iVar4;
  int iVar5;
  int *in_ECX;
  uint uVar6;
  short *psVar7;
  short sVar8;
  int unaff_EDI;
  uint uVar9;
  int unaff_retaddr;
  int iVar10;
  int *local_18;
  short *psStack_10;
  short *psStack_8;
  uint local_4;
  
  sVar8 = 0;
  if (param_2 == -1) {
    param_2 = FUN_0051c9d0(param_1);
  }
  local_4 = param_1 + param_2 * 2;
  iVar10 = in_ECX[4] + -1;
  if ((iVar10 < 0) || (in_ECX[4] <= iVar10)) {
    piVar3 = (int *)0x0;
    local_18 = (int *)0x0;
  }
  else {
    piVar3 = *(int **)(in_ECX[3] + iVar10 * 4);
    if (piVar3 == (int *)0x0) {
      local_18 = (int *)0x0;
    }
    else {
      local_18 = (int *)piVar3[7];
    }
  }
  (**(code **)(*in_ECX + 8))(local_18,param_2,param_1);
  iVar10 = 0;
  iVar5 = 0;
  do {
    if ((iVar5 == 0) && (piVar3 != (int *)0x0)) {
      FUN_00540100();
      uVar2 = piVar3[1];
      if (uVar2 != 0) {
        if ((*piVar3 == 0) || (uVar2 <= uVar2 - 1)) {
          psVar7 = (short *)0x0;
        }
        else {
          psVar7 = (short *)(*piVar3 + (uVar2 - 1) * 2);
        }
        if (*psVar7 == 0) {
          uVar2 = uVar2 - 1;
        }
      }
      if ((uVar2 == 0) && (param_2 != 0)) {
        FUN_0053c230(in_ECX[2],param_2);
      }
    }
    else {
      piVar3 = (int *)FUN_00540b60(param_2);
      uVar2 = 0;
      piVar3[7] = unaff_EDI;
    }
    uVar9 = 0;
    if (((unaff_retaddr == 0) && (sVar8 == 0xd)) && (*psStack_8 == 10)) {
      psStack_8 = psStack_8 + 1;
      local_4 = local_4 - 1;
      if (local_4 == 0) {
LAB_005414c8:
        if (sVar8 == (ushort)((-(ushort)((*(byte *)(in_ECX + 8) & 2) != 0) & 3) + 10)) {
          FUN_00540b60(param_2);
        }
        FUN_005406c0(in_ECX[2],param_1);
        if ((*(ushort *)(param_1 + 0x2a) & 0x100) != 0) {
          iVar5 = FUN_0051b1a0();
          if (iVar5 != 0) {
            *(byte *)(in_ECX + 8) = *(byte *)(in_ECX + 8) | 1;
            return iVar10;
          }
        }
        return iVar10;
      }
    }
    if (local_4 != 0) {
      uVar9 = 0;
      do {
        sVar8 = psStack_8[uVar9];
        if (sVar8 == 10) goto LAB_00541381;
      } while (((sVar8 != 0xd) && (sVar8 != 0)) && (uVar9 = uVar9 + 1, uVar9 < local_4));
    }
    if ((sVar8 == 10) || (sVar8 == 0xd)) {
LAB_00541381:
      uVar9 = uVar9 + 1;
    }
    if (uVar9 == 0) {
      _Dst = (void *)0x0;
    }
    else {
      iVar4 = piVar3[1];
      uVar6 = iVar4 + uVar9;
      if ((uint)piVar3[2] < uVar6) {
        if (*piVar3 == 0) {
          iVar4 = FUN_00515840(uVar6 * 2,0);
        }
        else {
          iVar4 = FUN_00515c80(*piVar3,uVar6 * 2);
        }
        *piVar3 = iVar4;
        iVar4 = piVar3[1];
        piVar3[2] = iVar4 + uVar9;
      }
      if (iVar4 - uVar2 != 0) {
        _memmove((void *)(*piVar3 + (uVar9 + uVar2) * 2),(void *)(*piVar3 + uVar2 * 2),
                 (iVar4 - uVar2) * 2);
      }
      piVar3[1] = piVar3[1] + uVar9;
      _Dst = (void *)(*piVar3 + uVar2 * 2);
      FUN_0053d280(uVar2,uVar9);
      *(short *)(piVar3 + 9) = (short)piVar3[9] + 1;
    }
    _memcpy(_Dst,psStack_8,uVar9 * 2);
    psStack_8 = psStack_8 + uVar9;
    local_4 = local_4 - uVar9;
    if (((sVar8 == 10) || (sVar8 == 0xd)) &&
       (bVar1 = *(byte *)(local_18 + 8) >> 1 & 1,
       sVar8 != (ushort)((-(ushort)(bVar1 != 0) & 3) + 10))) {
      uVar6 = piVar3[1];
      if (uVar6 != 0) {
        if ((*piVar3 == 0) || (uVar6 <= uVar6 - 1)) {
          psVar7 = (short *)0x0;
        }
        else {
          psVar7 = (short *)(*piVar3 + (uVar6 - 1) * 2);
        }
        if (*psVar7 == 0) {
          uVar6 = uVar6 - 1;
        }
        if (uVar6 != 0) {
          *(ushort *)(*piVar3 + -2 + uVar6 * 2) = (ushort)(byte)((-(bVar1 != 0) & 3U) + 10);
        }
      }
      sVar8 = (-(ushort)((*(byte *)(local_18 + 8) & 2) != 0) & 3) + 10;
    }
    FUN_00540450(local_18[2],param_1,uVar2,0xffffffff);
    iVar10 = iVar10 + uVar9;
    unaff_EDI = unaff_EDI + uVar9 + uVar2;
    in_ECX = local_18;
    if ((psStack_10 <= psStack_8) || (iVar5 = iVar5 + 1, sVar8 == 0)) goto LAB_005414c8;
  } while( true );
}



============================================================
DISASSEMBLY
============================================================
00541230 : SUB ESP,0x18
00541233 : MOV EDX,dword ptr [ESP + 0x20]
00541237 : PUSH EBX
00541238 : PUSH EBP
00541239 : MOV EBX,ECX
0054123b : XOR EBP,EBP
0054123d : PUSH EDI
0054123e : MOV EDI,dword ptr [ESP + 0x28]
00541242 : MOV dword ptr [ESP + 0x18],EBX
00541246 : CMP EDX,-0x1
00541249 : JNZ 0x0054125a
0054124b : PUSH EDI
0054124c : CALL 0x0051c9d0
00541251 : ADD ESP,0x4
00541254 : MOV dword ptr [ESP + 0x2c],EAX
00541258 : MOV EDX,EAX
0054125a : MOV ECX,dword ptr [EBX + 0x10]
0054125d : LEA EAX,[EDI + EDX*0x2]
00541260 : MOV dword ptr [ESP + 0x20],EAX
00541264 : LEA EAX,[ECX + -0x1]
00541267 : PUSH ESI
00541268 : TEST EAX,EAX
0054126a : JL 0x00541280
0054126c : CMP EAX,ECX
0054126e : JGE 0x00541280
00541270 : MOV ECX,dword ptr [EBX + 0xc]
00541273 : MOV ESI,dword ptr [ECX + EAX*0x4]
00541276 : TEST ESI,ESI
00541278 : JNZ 0x00541288
0054127a : MOV dword ptr [ESP + 0x10],EBP
0054127e : JMP 0x0054128f
00541280 : XOR ESI,ESI
00541282 : MOV dword ptr [ESP + 0x10],EBP
00541286 : JMP 0x0054128f
00541288 : MOV EAX,dword ptr [ESI + 0x1c]
0054128b : MOV dword ptr [ESP + 0x10],EAX
0054128f : MOV ECX,dword ptr [ESP + 0x10]
00541293 : MOV EAX,dword ptr [EBX]
00541295 : PUSH EDI
00541296 : PUSH EDX
00541297 : MOV EDX,dword ptr [EAX + 0x8]
0054129a : PUSH ECX
0054129b : MOV ECX,EBX
0054129d : CALL EDX
0054129f : XOR EAX,EAX
005412a1 : MOV dword ptr [ESP + 0x14],EAX
005412a5 : JMP 0x005412b8
005412b0 : MOV EBX,dword ptr [ESP + 0x1c]
005412b4 : MOV EAX,dword ptr [ESP + 0x20]
005412b8 : MOV ECX,EAX
005412ba : INC EAX
005412bb : MOV dword ptr [ESP + 0x20],EAX
005412bf : TEST ECX,ECX
005412c1 : JA 0x0054130e
005412c3 : TEST ESI,ESI
005412c5 : JZ 0x0054130e
005412c7 : MOV ECX,ESI
005412c9 : CALL 0x00540100
005412ce : MOV EAX,dword ptr [ESI + 0x4]
005412d1 : TEST EAX,EAX
005412d3 : JBE 0x005412f0
005412d5 : MOV ECX,dword ptr [ESI]
005412d7 : LEA EDX,[EAX + -0x1]
005412da : TEST ECX,ECX
005412dc : JZ 0x005412e7
005412de : CMP EDX,EAX
005412e0 : JNC 0x005412e7
005412e2 : LEA ECX,[ECX + EDX*0x2]
005412e5 : JMP 0x005412e9
005412e7 : XOR ECX,ECX
005412e9 : CMP word ptr [ECX],0x0
005412ed : JNZ 0x005412f0
005412ef : DEC EAX
005412f0 : MOV dword ptr [ESP + 0x18],EAX
005412f4 : TEST EAX,EAX
005412f6 : JNZ 0x0054132b
005412f8 : MOV EAX,dword ptr [ESP + 0x3c]
005412fc : TEST EAX,EAX
005412fe : JZ 0x0054132b
00541300 : MOV EDX,dword ptr [EBX + 0x8]
00541303 : PUSH EAX
00541304 : PUSH EDX
00541305 : MOV ECX,ESI
00541307 : CALL 0x0053c230
0054130c : JMP 0x0054132b
0054130e : MOV EAX,dword ptr [ESP + 0x3c]
00541312 : PUSH EAX
00541313 : MOV ECX,EBX
00541315 : CALL 0x00540b60
0054131a : MOV ECX,dword ptr [ESP + 0x10]
0054131e : MOV ESI,EAX
00541320 : MOV dword ptr [ESP + 0x18],0x0
00541328 : MOV dword ptr [ESI + 0x1c],ECX
0054132b : XOR EDI,EDI
0054132d : CMP dword ptr [ESP + 0x34],EDI
00541331 : JNZ 0x00541352
00541333 : CMP EBP,0xd
00541336 : JNZ 0x00541352
00541338 : MOV EDX,dword ptr [ESP + 0x2c]
0054133c : CMP word ptr [EDX],0xa
00541340 : JNZ 0x00541352
00541342 : ADD dword ptr [ESP + 0x2c],0x2
00541347 : SUB dword ptr [ESP + 0x30],0x1
0054134c : JZ 0x005414c8
00541352 : MOV ECX,dword ptr [ESP + 0x30]
00541356 : TEST ECX,ECX
00541358 : JBE 0x00541377
0054135a : MOV EAX,dword ptr [ESP + 0x2c]
0054135e : MOV EDI,EDI
00541360 : MOVZX EBP,word ptr [EAX + EDI*0x2]
00541364 : CMP EBP,0xa
00541367 : JZ 0x00541381
00541369 : CMP EBP,0xd
0054136c : JZ 0x00541377
0054136e : TEST EBP,EBP
00541370 : JZ 0x00541377
00541372 : INC EDI
00541373 : CMP EDI,ECX
00541375 : JC 0x00541360
00541377 : CMP EBP,0xa
0054137a : JZ 0x00541381
0054137c : CMP EBP,0xd
0054137f : JNZ 0x00541382
00541381 : INC EDI
00541382 : TEST EDI,EDI
00541384 : JNZ 0x0054138a
00541386 : XOR EAX,EAX
00541388 : JMP 0x005413fe
0054138a : MOV EAX,dword ptr [ESI + 0x4]
0054138d : LEA EDX,[EAX + EDI*0x1]
00541390 : CMP dword ptr [ESI + 0x8],EDX
00541393 : JNC 0x005413c2
00541395 : MOV EAX,dword ptr [ESI]
00541397 : TEST EAX,EAX
00541399 : JNZ 0x005413ad
0054139b : MOV EAX,dword ptr [EBX + 0x8]
0054139e : MOV ECX,dword ptr [EAX + 0x1c]
005413a1 : PUSH 0x0
005413a3 : ADD EDX,EDX
005413a5 : PUSH EDX
005413a6 : CALL 0x00515840
005413ab : JMP 0x005413b7
005413ad : LEA ECX,[EDX + EDX*0x1]
005413b0 : PUSH ECX
005413b1 : PUSH EAX
005413b2 : CALL 0x00515c80
005413b7 : MOV dword ptr [ESI],EAX
005413b9 : MOV EAX,dword ptr [ESI + 0x4]
005413bc : LEA EDX,[EAX + EDI*0x1]
005413bf : MOV dword ptr [ESI + 0x8],EDX
005413c2 : MOV EBX,dword ptr [ESP + 0x18]
005413c6 : SUB EAX,EBX
005413c8 : JZ 0x005413e2
005413ca : MOV ECX,dword ptr [ESI]
005413cc : ADD EAX,EAX
005413ce : PUSH EAX
005413cf : LEA EDX,[ECX + EBX*0x2]
005413d2 : LEA EAX,[EDI + EBX*0x1]
005413d5 : PUSH EDX
005413d6 : LEA ECX,[ECX + EAX*0x2]
005413d9 : PUSH ECX
005413da : CALL 0x00636880
005413df : ADD ESP,0xc
005413e2 : MOV EAX,dword ptr [ESP + 0x18]
005413e6 : MOV EDX,dword ptr [ESI]
005413e8 : ADD dword ptr [ESI + 0x4],EDI
005413eb : PUSH EDI
005413ec : PUSH EAX
005413ed : LEA ECX,[ESI + 0x10]
005413f0 : LEA EBX,[EDX + EBX*0x2]
005413f3 : CALL 0x0053d280
005413f8 : INC word ptr [ESI + 0x24]
005413fc : MOV EAX,EBX
005413fe : MOV ECX,dword ptr [ESP + 0x2c]
00541402 : LEA EBX,[EDI + EDI*0x1]
00541405 : PUSH EBX
00541406 : PUSH ECX
00541407 : PUSH EAX
00541408 : CALL 0x0063ae40
0054140d : ADD dword ptr [ESP + 0x38],EBX
00541411 : SUB dword ptr [ESP + 0x3c],EDI
00541415 : ADD ESP,0xc
00541418 : CMP EBP,0xa
0054141b : JZ 0x00541422
0054141d : CMP EBP,0xd
00541420 : JNZ 0x0054148c
00541422 : MOV EDX,dword ptr [ESP + 0x1c]
00541426 : MOV AL,byte ptr [EDX + 0x20]
00541429 : SHR AL,0x1
0054142b : AND AL,0x1
0054142d : MOVZX ECX,AL
00541430 : NEG ECX
00541432 : SBB ECX,ECX
00541434 : AND ECX,0x3
00541437 : ADD ECX,0xa
0054143a : CMP EBP,ECX
0054143c : JZ 0x00541490
0054143e : MOV ECX,dword ptr [ESI + 0x4]
00541441 : TEST ECX,ECX
00541443 : JBE 0x00541477
00541445 : MOV EBX,dword ptr [ESI]
00541447 : LEA EBP,[ECX + -0x1]
0054144a : TEST EBX,EBX
0054144c : JZ 0x00541457
0054144e : CMP EBP,ECX
00541450 : JNC 0x00541457
00541452 : LEA EBX,[EBX + EBP*0x2]
00541455 : JMP 0x00541459
00541457 : XOR EBX,EBX
00541459 : CMP word ptr [EBX],0x0
0054145d : JNZ 0x00541460
0054145f : DEC ECX
00541460 : TEST ECX,ECX
00541462 : JBE 0x00541477
00541464 : MOV EBX,dword ptr [ESI]
00541466 : NEG AL
00541468 : SBB AL,AL
0054146a : AND AL,0x3
0054146c : ADD AL,0xa
0054146e : MOVZX AX,AL
00541472 : MOV word ptr [EBX + ECX*0x2 + -0x2],AX
00541477 : MOV CL,byte ptr [EDX + 0x20]
0054147a : AND CL,0x2
0054147d : MOVZX EBP,CL
00541480 : NEG EBP
00541482 : SBB EBP,EBP
00541484 : AND EBP,0x3
00541487 : ADD EBP,0xa
0054148a : JMP 0x00541490
0054148c : MOV EDX,dword ptr [ESP + 0x1c]
00541490 : MOV EBX,dword ptr [ESP + 0x18]
00541494 : MOV EAX,dword ptr [ESP + 0x38]
00541498 : MOV ECX,dword ptr [EDX + 0x8]
0054149b : PUSH -0x1
0054149d : PUSH EBX
0054149e : PUSH EAX
0054149f : PUSH ECX
005414a0 : MOV ECX,ESI
005414a2 : CALL 0x00540450
005414a7 : MOV EAX,dword ptr [ESP + 0x24]
005414ab : ADD dword ptr [ESP + 0x14],EDI
005414af : LEA EDX,[EDI + EBX*0x1]
005414b2 : ADD dword ptr [ESP + 0x10],EDX
005414b6 : CMP dword ptr [ESP + 0x2c],EAX
005414ba : JNC 0x005414c4
005414bc : TEST EBP,EBP
005414be : JNZ 0x005412b0
005414c4 : MOV EBX,dword ptr [ESP + 0x1c]
005414c8 : MOV CL,byte ptr [EBX + 0x20]
005414cb : AND CL,0x2
005414ce : MOVZX EDX,CL
005414d1 : NEG EDX
005414d3 : SBB EDX,EDX
005414d5 : AND EDX,0x3
005414d8 : ADD EDX,0xa
005414db : CMP EBP,EDX
005414dd : JNZ 0x005414ed
005414df : MOV EAX,dword ptr [ESP + 0x3c]
005414e3 : PUSH EAX
005414e4 : MOV ECX,EBX
005414e6 : CALL 0x00540b60
005414eb : MOV ESI,EAX
005414ed : MOV EDI,dword ptr [ESP + 0x38]
005414f1 : MOV ECX,dword ptr [EBX + 0x8]
005414f4 : PUSH EDI
005414f5 : PUSH ECX
005414f6 : MOV ECX,ESI
005414f8 : CALL 0x005406c0
005414fd : MOV EDX,0x100
00541502 : POP ESI
00541503 : TEST word ptr [EDI + 0x2a],DX
00541507 : JZ 0x00541526
00541509 : LEA ECX,[EDI + 0x10]
0054150c : CALL 0x0051b1a0
00541511 : TEST EAX,EAX
00541513 : MOV EAX,dword ptr [ESP + 0x10]
00541517 : JZ 0x0054152a
00541519 : OR byte ptr [EBX + 0x20],0x1
0054151d : POP EDI
0054151e : POP EBP
0054151f : POP EBX
00541520 : ADD ESP,0x18
00541523 : RET 0x14
00541526 : MOV EAX,dword ptr [ESP + 0x10]
0054152a : POP EDI
0054152b : POP EBP
0054152c : POP EBX
0054152d : ADD ESP,0x18
00541530 : RET 0x14
