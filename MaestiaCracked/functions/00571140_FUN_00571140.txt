PROGRAM  : Maestia.exe
FUNCTION : FUN_00571140
ENTRY    : 00571140
BODY     : [[00571140, 005712a1]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00571140(int param_1,undefined4 param_2)

{
  char cVar1;
  int iVar2;
  undefined4 uVar3;
  undefined4 uVar4;
  GRefCountImpl *this;
  LONG LVar5;
  undefined4 *in_ECX;
  uint unaff_retaddr;
  undefined4 in_stack_ffffffdc;
  undefined4 in_stack_ffffffe0;
  undefined4 uVar6;
  
  in_ECX[1] = 0;
  in_ECX[2] = 0;
  in_ECX[3] = param_2;
  in_ECX[4] = param_1;
  *in_ECX = &PTR_FUN_00b8d1fc;
  in_ECX[5] = 0;
  in_ECX[6] = 0;
  iVar2 = FUN_00515840(0x54,0);
  if (iVar2 == 0) {
    uVar4 = 0;
  }
  else {
    uVar4 = *(undefined4 *)(*(int *)(in_ECX[3] + 0x6c) + 0x14);
    uVar6 = 0;
    uVar3 = (*(code *)**(undefined4 **)(in_ECX[3] + 8))(0);
    in_stack_ffffffe0 = 0x571198;
    uVar4 = FUN_005a19f0(uVar4,uVar3,uVar6);
  }
  if ((GRefCountImpl *)in_ECX[6] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)in_ECX[6]);
  }
  in_ECX[6] = uVar4;
  FUN_0051b6e0();
  if (*(int *)(in_ECX[3] + 0x68) != 0) {
    uVar4 = (**(code **)(**(int **)(in_ECX[3] + 0x6c) + 0x30))();
    FUN_0051bb20(uVar4);
    cVar1 = FUN_005a23d0(&param_2);
    if (cVar1 != '\0') goto LAB_005711ee;
  }
  FUN_0051bf30();
LAB_005711ee:
  uVar3 = 0x24;
  uVar4 = 0x5711fc;
  iVar2 = FUN_00515840(0x24,0);
  if (iVar2 == 0) {
    uVar4 = 0;
  }
  else {
    FUN_005266c0(param_1 + 0x50);
    if (*(GRefCountImpl **)(param_1 + 0x60) != (GRefCountImpl *)0x0) {
      GRefCountImpl::AddRef(*(GRefCountImpl **)(param_1 + 0x60));
    }
    uVar4 = FUN_0056f410(in_ECX[6],&param_2,param_1 + 0xc,in_stack_ffffffdc,in_stack_ffffffe0,uVar4,
                         uVar3,*(undefined4 *)(param_1 + 0x60));
  }
  if ((GRefCountImpl *)in_ECX[5] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)in_ECX[5]);
  }
  in_ECX[5] = uVar4;
  this = (GRefCountImpl *)(**(code **)(*(int *)(in_ECX[3] + 8) + 0xc))(0x17);
  (**(code **)(*(int *)this + 4))(in_ECX[5]);
  GRefCountImpl::Release(this);
  LVar5 = InterlockedExchangeAdd((LONG *)((unaff_retaddr & 0xfffffffc) + 4),-1);
  if (LVar5 == 1) {
    FUN_00515cf0(unaff_retaddr & 0xfffffffc);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00571140 : MOV EAX,dword ptr [ESP + 0x8]
00571144 : PUSH EBX
00571145 : PUSH EBP
00571146 : PUSH ESI
00571147 : MOV ESI,ECX
00571149 : MOV ECX,dword ptr [ESP + 0x10]
0057114d : XOR EBP,EBP
0057114f : PUSH EDI
00571150 : MOV dword ptr [ESI + 0x4],EBP
00571153 : MOV dword ptr [ESI + 0x8],EBP
00571156 : MOV dword ptr [ESI + 0xc],EAX
00571159 : MOV dword ptr [ESI + 0x10],ECX
0057115c : MOV dword ptr [ESI],0xb8d1fc
00571162 : MOV dword ptr [ESI + 0x14],EBP
00571165 : PUSH EBP
00571166 : MOV dword ptr [ESI + 0x18],EBP
00571169 : MOV ECX,dword ptr [0x00d73250]
0057116f : PUSH 0x54
00571171 : CALL 0x00515840
00571176 : MOV EDI,EAX
00571178 : CMP EDI,EBP
0057117a : JZ 0x0057119c
0057117c : MOV EAX,dword ptr [ESI + 0xc]
0057117f : MOV EDX,dword ptr [EAX + 0x6c]
00571182 : MOV EBX,dword ptr [EDX + 0x14]
00571185 : LEA ECX,[EAX + 0x8]
00571188 : MOV EAX,dword ptr [ECX]
0057118a : MOV EDX,dword ptr [EAX]
0057118c : PUSH EBP
0057118d : CALL EDX
0057118f : PUSH EAX
00571190 : PUSH EBX
00571191 : MOV ECX,EDI
00571193 : CALL 0x005a19f0
00571198 : MOV EDI,EAX
0057119a : JMP 0x0057119e
0057119c : XOR EDI,EDI
0057119e : MOV ECX,dword ptr [ESI + 0x18]
005711a1 : CMP ECX,EBP
005711a3 : JZ 0x005711aa
005711a5 : CALL 0x004ff7e0
005711aa : LEA ECX,[ESP + 0x18]
005711ae : MOV dword ptr [ESI + 0x18],EDI
005711b1 : CALL 0x0051b6e0
005711b6 : MOV EAX,dword ptr [ESI + 0xc]
005711b9 : CMP dword ptr [EAX + 0x68],EBP
005711bc : JZ 0x005711e5
005711be : MOV EAX,dword ptr [EAX + 0x6c]
005711c1 : MOV EDX,dword ptr [EAX]
005711c3 : MOV ECX,EAX
005711c5 : MOV EAX,dword ptr [EDX + 0x30]
005711c8 : CALL EAX
005711ca : PUSH EAX
005711cb : LEA ECX,[ESP + 0x1c]
005711cf : CALL 0x0051bb20
005711d4 : LEA ECX,[ESP + 0x18]
005711d8 : PUSH ECX
005711d9 : CALL 0x005a23d0
005711de : ADD ESP,0x4
005711e1 : TEST AL,AL
005711e3 : JNZ 0x005711ee
005711e5 : LEA ECX,[ESP + 0x18]
005711e9 : CALL 0x0051bf30
005711ee : MOV ECX,dword ptr [0x00d73250]
005711f4 : PUSH EBP
005711f5 : PUSH 0x24
005711f7 : CALL 0x00515840
005711fc : MOV EBP,EAX
005711fe : TEST EBP,EBP
00571200 : JZ 0x00571244
00571202 : MOV EDI,dword ptr [ESP + 0x14]
00571206 : SUB ESP,0x14
00571209 : MOV EBX,ESP
0057120b : ADD EDI,0x50
0057120e : PUSH EDI
0057120f : MOV ECX,EBX
00571211 : CALL 0x005266c0
00571216 : MOV ECX,dword ptr [EDI + 0x10]
00571219 : TEST ECX,ECX
0057121b : JZ 0x00571222
0057121d : CALL 0x00523dd0
00571222 : MOV EDX,dword ptr [EDI + 0x10]
00571225 : MOV ECX,dword ptr [ESP + 0x28]
00571229 : ADD ECX,0xc
0057122c : MOV dword ptr [EBX + 0x10],EDX
0057122f : MOV EAX,dword ptr [ESI + 0x18]
00571232 : PUSH ECX
00571233 : LEA EDX,[ESP + 0x30]
00571237 : PUSH EDX
00571238 : PUSH EAX
00571239 : MOV ECX,EBP
0057123b : CALL 0x0056f410
00571240 : MOV EDI,EAX
00571242 : JMP 0x00571246
00571244 : XOR EDI,EDI
00571246 : MOV ECX,dword ptr [ESI + 0x14]
00571249 : TEST ECX,ECX
0057124b : JZ 0x00571252
0057124d : CALL 0x004ff7e0
00571252 : MOV dword ptr [ESI + 0x14],EDI
00571255 : MOV ECX,dword ptr [ESI + 0xc]
00571258 : MOV EAX,dword ptr [ECX + 0x8]
0057125b : MOV EDX,dword ptr [EAX + 0xc]
0057125e : ADD ECX,0x8
00571261 : PUSH 0x17
00571263 : CALL EDX
00571265 : MOV ECX,dword ptr [ESI + 0x14]
00571268 : MOV EDI,EAX
0057126a : MOV EAX,dword ptr [EDI]
0057126c : MOV EDX,dword ptr [EAX + 0x4]
0057126f : PUSH ECX
00571270 : MOV ECX,EDI
00571272 : CALL EDX
00571274 : MOV ECX,EDI
00571276 : CALL 0x004ff7e0
0057127b : MOV EDI,dword ptr [ESP + 0x18]
0057127f : AND EDI,0xfffffffc
00571282 : PUSH -0x1
00571284 : LEA EAX,[EDI + 0x4]
00571287 : PUSH EAX
00571288 : CALL dword ptr [0x00b851cc]
0057128e : SUB EAX,0x1
00571291 : JNZ 0x00571299
00571293 : PUSH EDI
00571294 : CALL 0x00515cf0
00571299 : POP EDI
0057129a : MOV EAX,ESI
0057129c : POP ESI
0057129d : POP EBP
0057129e : POP EBX
0057129f : RET 0x8
