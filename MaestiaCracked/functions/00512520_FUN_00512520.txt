PROGRAM  : Maestia.exe
FUNCTION : FUN_00512520
ENTRY    : 00512520
BODY     : [[00512520, 005125eb]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00512520(int *param_1)

{
  undefined4 *puVar1;
  char cVar2;
  int iVar3;
  LONG LVar4;
  int in_ECX;
  
  iVar3 = *(int *)(in_ECX + 0xc);
  if (iVar3 == 0) {
    if (*(int *)(in_ECX + 0x14) == 0) {
      return 0;
    }
    iVar3 = (**(code **)(*param_1 + 8))();
    puVar1 = *(undefined4 **)(in_ECX + 0xc);
    if (puVar1 != (undefined4 *)0x0) {
      LVar4 = InterlockedExchangeAdd(puVar1 + 1,-1);
      if ((LVar4 == 1) && (puVar1 != (undefined4 *)0x0)) {
        (**(code **)*puVar1)(1);
      }
    }
    *(int *)(in_ECX + 0xc) = iVar3;
    if (iVar3 != 0) {
      cVar2 = (**(code **)(*(int *)(in_ECX + 8) + 8))(param_1);
      if (cVar2 == '\0') {
        puVar1 = *(undefined4 **)(in_ECX + 0xc);
        if (puVar1 != (undefined4 *)0x0) {
          LVar4 = InterlockedExchangeAdd(puVar1 + 1,-1);
          if ((LVar4 == 1) && (puVar1 != (undefined4 *)0x0)) {
            (**(code **)*puVar1)(1);
          }
        }
        *(undefined4 *)(in_ECX + 0xc) = 0;
      }
      else {
        (**(code **)(**(int **)(in_ECX + 0xc) + 0x2c))(in_ECX + 8);
      }
    }
    if ((*(int *)(in_ECX + 0xc) != 0) && (*(char *)(in_ECX + 0x20) != '\0')) {
      if (*(GRefCountNTSImpl **)(in_ECX + 0x14) != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(in_ECX + 0x14));
      }
      *(undefined4 *)(in_ECX + 0x14) = 0;
    }
    iVar3 = *(int *)(in_ECX + 0xc);
  }
  return iVar3;
}



============================================================
DISASSEMBLY
============================================================
00512520 : PUSH ESI
00512521 : MOV ESI,ECX
00512523 : MOV EAX,dword ptr [ESI + 0xc]
00512526 : TEST EAX,EAX
00512528 : JNZ 0x005125e8
0051252e : CMP dword ptr [ESI + 0x14],EAX
00512531 : JNZ 0x00512537
00512533 : POP ESI
00512534 : RET 0x4
00512537 : PUSH EBX
00512538 : PUSH EBP
00512539 : MOV EBP,dword ptr [ESP + 0x10]
0051253d : MOV EAX,dword ptr [EBP]
00512540 : MOV EDX,dword ptr [EAX + 0x8]
00512543 : PUSH EDI
00512544 : MOV ECX,EBP
00512546 : CALL EDX
00512548 : MOV EDI,dword ptr [ESI + 0xc]
0051254b : MOV EBX,EAX
0051254d : TEST EDI,EDI
0051254f : JZ 0x00512570
00512551 : PUSH -0x1
00512553 : LEA EAX,[EDI + 0x4]
00512556 : PUSH EAX
00512557 : CALL dword ptr [0x00b851cc]
0051255d : SUB EAX,0x1
00512560 : JNZ 0x00512570
00512562 : TEST EDI,EDI
00512564 : JZ 0x00512570
00512566 : MOV EDX,dword ptr [EDI]
00512568 : MOV EAX,dword ptr [EDX]
0051256a : PUSH 0x1
0051256c : MOV ECX,EDI
0051256e : CALL EAX
00512570 : MOV dword ptr [ESI + 0xc],EBX
00512573 : TEST EBX,EBX
00512575 : JZ 0x005125c3
00512577 : MOV EDX,dword ptr [ESI + 0x8]
0051257a : MOV EAX,dword ptr [EDX + 0x8]
0051257d : LEA EDI,[ESI + 0x8]
00512580 : PUSH EBP
00512581 : MOV ECX,EDI
00512583 : CALL EAX
00512585 : TEST AL,AL
00512587 : JZ 0x00512596
00512589 : MOV ECX,dword ptr [ESI + 0xc]
0051258c : MOV EDX,dword ptr [ECX]
0051258e : MOV EAX,dword ptr [EDX + 0x2c]
00512591 : PUSH EDI
00512592 : CALL EAX
00512594 : JMP 0x005125c3
00512596 : MOV EDI,dword ptr [ESI + 0xc]
00512599 : TEST EDI,EDI
0051259b : JZ 0x005125bc
0051259d : PUSH -0x1
0051259f : LEA ECX,[EDI + 0x4]
005125a2 : PUSH ECX
005125a3 : CALL dword ptr [0x00b851cc]
005125a9 : SUB EAX,0x1
005125ac : JNZ 0x005125bc
005125ae : TEST EDI,EDI
005125b0 : JZ 0x005125bc
005125b2 : MOV EDX,dword ptr [EDI]
005125b4 : MOV EAX,dword ptr [EDX]
005125b6 : PUSH 0x1
005125b8 : MOV ECX,EDI
005125ba : CALL EAX
005125bc : MOV dword ptr [ESI + 0xc],0x0
005125c3 : CMP dword ptr [ESI + 0xc],0x0
005125c7 : POP EDI
005125c8 : POP EBP
005125c9 : POP EBX
005125ca : JZ 0x005125e5
005125cc : CMP byte ptr [ESI + 0x20],0x0
005125d0 : JZ 0x005125e5
005125d2 : MOV ECX,dword ptr [ESI + 0x14]
005125d5 : TEST ECX,ECX
005125d7 : JZ 0x005125de
005125d9 : CALL 0x004ff7c0
005125de : MOV dword ptr [ESI + 0x14],0x0
005125e5 : MOV EAX,dword ptr [ESI + 0xc]
005125e8 : POP ESI
005125e9 : RET 0x4
