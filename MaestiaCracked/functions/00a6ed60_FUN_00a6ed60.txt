PROGRAM  : Maestia.exe
FUNCTION : FUN_00a6ed60
ENTRY    : 00a6ed60
BODY     : [[00a6ed60, 00a6ef95]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00a6ed60(int param_1,undefined4 param_2)

{
  uint uVar1;
  int iVar2;
  ulong uVar3;
  wchar_t *_Str;
  undefined1 local_3c [4];
  undefined2 local_38;
  undefined4 local_28;
  uint local_24;
  undefined1 local_20 [4];
  int local_1c;
  int local_18;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b44301;
  local_10 = ExceptionList;
  uVar1 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_24 = 7;
  local_28 = 0;
  local_38 = 0;
  FUN_00406360(&DAT_00c440e0,3);
  local_8 = 0;
  FUN_00ab63e0(local_20,param_2,local_3c,1,uVar1);
  local_8._0_1_ = 2;
  if (7 < local_24) {
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  local_24 = 7;
  local_38 = 0;
  local_28 = 0;
  iVar2 = FUN_00405bb0(L"index");
  if (iVar2 == 0) {
    if (1 < (uint)((local_18 - local_1c) / 0x1c)) {
      if (*(uint *)(local_1c + 0x34) < 8) {
        _Str = (wchar_t *)(local_1c + 0x20);
      }
      else {
        _Str = *(wchar_t **)(local_1c + 0x20);
      }
      uVar3 = _wcstoul(_Str,(wchar_t **)0x0,10);
      *(ulong *)(param_1 + 0x34) = uVar3;
      if (local_1c != local_18) {
        iVar2 = FUN_00404250(local_18);
        FUN_00405450(param_1);
        local_18 = iVar2;
      }
      goto LAB_00a6ef71;
    }
    FUN_00406460(L"No Proto Number");
    local_8._0_1_ = 3;
    FUN_00a6e600(local_3c);
    local_8 = CONCAT31(local_8._1_3_,2);
    if (7 < local_24) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
  }
  else {
    iVar2 = FUN_00405bb0(L"animation");
    if (iVar2 == 0) {
      iVar2 = FUN_006f0760(0x10,"",0,(DAT_01725270 >> 3 & 1) == 0);
      if (iVar2 == 0) {
        iVar2 = 0;
      }
      else {
        *(undefined4 *)(iVar2 + 4) = 0;
        *(undefined4 *)(iVar2 + 8) = 0;
        *(undefined4 *)(iVar2 + 0xc) = 0;
      }
      *(int *)(param_1 + 0x54) = iVar2;
      *(undefined4 *)(param_1 + 0x2c) = 2;
      local_8 = 0xffffffff;
      FUN_004042c0();
      ExceptionList = local_10;
      return 1;
    }
    FUN_00406460(L"Bad Command");
    local_8._0_1_ = 5;
    FUN_00a6e600(local_3c);
    local_8 = CONCAT31(local_8._1_3_,2);
    if (7 < local_24) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
  }
  local_28 = 0;
  local_38 = 0;
  local_24 = 7;
LAB_00a6ef71:
  local_8 = 0xffffffff;
  FUN_004042c0();
  ExceptionList = local_10;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
00a6ed60 : PUSH EBP
00a6ed61 : MOV EBP,ESP
00a6ed63 : PUSH -0x1
00a6ed65 : PUSH 0xb44301
00a6ed6a : MOV EAX,FS:[0x0]
00a6ed70 : PUSH EAX
00a6ed71 : SUB ESP,0x2c
00a6ed74 : PUSH EBX
00a6ed75 : PUSH ESI
00a6ed76 : PUSH EDI
00a6ed77 : MOV EAX,[0x00d66fa0]
00a6ed7c : XOR EAX,EBP
00a6ed7e : PUSH EAX
00a6ed7f : LEA EAX,[EBP + -0xc]
00a6ed82 : MOV FS:[0x0],EAX
00a6ed88 : MOV EBX,dword ptr [EBP + 0x8]
00a6ed8b : PUSH 0x3
00a6ed8d : XOR EAX,EAX
00a6ed8f : MOV EDI,0x7
00a6ed94 : XOR ESI,ESI
00a6ed96 : PUSH 0xc440e0
00a6ed9b : LEA ECX,[EBP + -0x38]
00a6ed9e : MOV dword ptr [EBP + -0x20],EDI
00a6eda1 : MOV dword ptr [EBP + -0x24],ESI
00a6eda4 : MOV word ptr [EBP + -0x34],AX
00a6eda8 : CALL 0x00406360
00a6edad : MOV dword ptr [EBP + -0x4],ESI
00a6edb0 : MOV EDX,dword ptr [EBP + 0xc]
00a6edb3 : PUSH 0x1
00a6edb5 : LEA ECX,[EBP + -0x38]
00a6edb8 : PUSH ECX
00a6edb9 : PUSH EDX
00a6edba : LEA EAX,[EBP + -0x1c]
00a6edbd : PUSH EAX
00a6edbe : CALL 0x00ab63e0
00a6edc3 : ADD ESP,0x10
00a6edc6 : MOV byte ptr [EBP + -0x4],0x2
00a6edca : CMP dword ptr [EBP + -0x20],0x8
00a6edce : JC 0x00a6edd8
00a6edd0 : MOV ECX,dword ptr [EBP + -0x34]
00a6edd3 : CALL 0x006f04e0
00a6edd8 : XOR ECX,ECX
00a6edda : MOV dword ptr [EBP + -0x20],EDI
00a6eddd : MOV word ptr [EBP + -0x34],CX
00a6ede1 : LEA EDI,[ECX + 0x5]
00a6ede4 : MOV ECX,dword ptr [EBP + -0x18]
00a6ede7 : MOV EAX,dword ptr [ECX + 0x14]
00a6edea : PUSH 0xc440e8
00a6edef : MOV dword ptr [EBP + -0x24],ESI
00a6edf2 : CALL 0x00405bb0
00a6edf7 : TEST EAX,EAX
00a6edf9 : JNZ 0x00a6eeab
00a6edff : MOV ECX,dword ptr [EBP + -0x14]
00a6ee02 : MOV ESI,dword ptr [EBP + -0x18]
00a6ee05 : SUB ECX,ESI
00a6ee07 : MOV EAX,0x92492493
00a6ee0c : IMUL ECX
00a6ee0e : ADD EDX,ECX
00a6ee10 : SAR EDX,0x4
00a6ee13 : MOV EAX,EDX
00a6ee15 : SHR EAX,0x1f
00a6ee18 : ADD EAX,EDX
00a6ee1a : CMP EAX,0x2
00a6ee1d : JNC 0x00a6ee5d
00a6ee1f : PUSH 0xc440f4
00a6ee24 : LEA ECX,[EBP + -0x38]
00a6ee27 : CALL 0x00406460
00a6ee2c : MOV byte ptr [EBP + -0x4],0x3
00a6ee30 : LEA EDX,[EBP + -0x38]
00a6ee33 : LEA ECX,[EBX + 0xc]
00a6ee36 : PUSH EDX
00a6ee37 : CALL 0x00a6e600
00a6ee3c : ADD ESP,0x4
00a6ee3f : MOV byte ptr [EBP + -0x4],0x2
00a6ee43 : CMP dword ptr [EBP + -0x20],0x8
00a6ee47 : JC 0x00a6ee51
00a6ee49 : MOV ECX,dword ptr [EBP + -0x34]
00a6ee4c : CALL 0x006f04e0
00a6ee51 : MOV dword ptr [EBP + -0x24],0x0
00a6ee58 : JMP 0x00a6ef64
00a6ee5d : CMP dword ptr [ESI + 0x34],0x8
00a6ee61 : JC 0x00a6ee68
00a6ee63 : MOV ESI,dword ptr [ESI + 0x20]
00a6ee66 : JMP 0x00a6ee6b
00a6ee68 : ADD ESI,0x20
00a6ee6b : PUSH 0xa
00a6ee6d : PUSH 0x0
00a6ee6f : PUSH ESI
00a6ee70 : CALL 0x00637daf
00a6ee75 : MOV ECX,dword ptr [EBP + -0x18]
00a6ee78 : MOV dword ptr [EBX + 0x34],EAX
00a6ee7b : MOV EAX,dword ptr [EBP + -0x14]
00a6ee7e : ADD ESP,0xc
00a6ee81 : CMP ECX,EAX
00a6ee83 : JZ 0x00a6ef71
00a6ee89 : PUSH EAX
00a6ee8a : CALL 0x00404250
00a6ee8f : MOV ECX,dword ptr [EBP + 0x8]
00a6ee92 : MOV EDI,dword ptr [EBP + -0x14]
00a6ee95 : ADD ESP,0x4
00a6ee98 : PUSH ECX
00a6ee99 : MOV ESI,EAX
00a6ee9b : CALL 0x00405450
00a6eea0 : ADD ESP,0x4
00a6eea3 : MOV dword ptr [EBP + -0x14],ESI
00a6eea6 : JMP 0x00a6ef71
00a6eeab : MOV ECX,dword ptr [EBP + -0x18]
00a6eeae : MOV EAX,dword ptr [ECX + 0x14]
00a6eeb1 : PUSH 0xc44114
00a6eeb6 : MOV EDI,0x9
00a6eebb : CALL 0x00405bb0
00a6eec0 : TEST EAX,EAX
00a6eec2 : JNZ 0x00a6ef2f
00a6eec4 : MOV EDX,dword ptr [0x01725270]
00a6eeca : SHR EDX,0x3
00a6eecd : AND EDX,0x1
00a6eed0 : SETZ AL
00a6eed3 : PUSH EAX
00a6eed4 : PUSH ESI
00a6eed5 : PUSH 0xbf1a4a
00a6eeda : PUSH 0x10
00a6eedc : CALL 0x006f0760
00a6eee1 : ADD ESP,0x10
00a6eee4 : MOV dword ptr [EBP + 0x8],EAX
00a6eee7 : MOV byte ptr [EBP + -0x4],0x4
00a6eeeb : CMP EAX,ESI
00a6eeed : JZ 0x00a6eefa
00a6eeef : MOV dword ptr [EAX + 0x4],ESI
00a6eef2 : MOV dword ptr [EAX + 0x8],ESI
00a6eef5 : MOV dword ptr [EAX + 0xc],ESI
00a6eef8 : JMP 0x00a6eefc
00a6eefa : XOR EAX,EAX
00a6eefc : MOV byte ptr [EBP + -0x4],0x2
00a6ef00 : MOV dword ptr [EBX + 0x54],EAX
00a6ef03 : MOV dword ptr [EBX + 0x2c],0x2
00a6ef0a : MOV dword ptr [EBP + -0x4],0xffffffff
00a6ef11 : LEA ESI,[EBP + -0x1c]
00a6ef14 : CALL 0x004042c0
00a6ef19 : MOV AL,0x1
00a6ef1b : MOV ECX,dword ptr [EBP + -0xc]
00a6ef1e : MOV dword ptr FS:[0x0],ECX
00a6ef25 : POP ECX
00a6ef26 : POP EDI
00a6ef27 : POP ESI
00a6ef28 : POP EBX
00a6ef29 : MOV ESP,EBP
00a6ef2b : POP EBP
00a6ef2c : RET 0x8
00a6ef2f : PUSH 0xc44128
00a6ef34 : LEA ECX,[EBP + -0x38]
00a6ef37 : CALL 0x00406460
00a6ef3c : MOV byte ptr [EBP + -0x4],0x5
00a6ef40 : LEA EDX,[EBP + -0x38]
00a6ef43 : LEA ECX,[EBX + 0xc]
00a6ef46 : PUSH EDX
00a6ef47 : CALL 0x00a6e600
00a6ef4c : ADD ESP,0x4
00a6ef4f : MOV byte ptr [EBP + -0x4],0x2
00a6ef53 : CMP dword ptr [EBP + -0x20],0x8
00a6ef57 : JC 0x00a6ef61
00a6ef59 : MOV ECX,dword ptr [EBP + -0x34]
00a6ef5c : CALL 0x006f04e0
00a6ef61 : MOV dword ptr [EBP + -0x24],ESI
00a6ef64 : XOR EAX,EAX
00a6ef66 : MOV word ptr [EBP + -0x34],AX
00a6ef6a : MOV dword ptr [EBP + -0x20],0x7
00a6ef71 : MOV dword ptr [EBP + -0x4],0xffffffff
00a6ef78 : LEA ESI,[EBP + -0x1c]
00a6ef7b : CALL 0x004042c0
00a6ef80 : XOR AL,AL
00a6ef82 : MOV ECX,dword ptr [EBP + -0xc]
00a6ef85 : MOV dword ptr FS:[0x0],ECX
00a6ef8c : POP ECX
00a6ef8d : POP EDI
00a6ef8e : POP ESI
00a6ef8f : POP EBX
00a6ef90 : MOV ESP,EBP
00a6ef92 : POP EBP
00a6ef93 : RET 0x8
