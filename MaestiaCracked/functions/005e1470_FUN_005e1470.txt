PROGRAM  : Maestia.exe
FUNCTION : FUN_005e1470
ENTRY    : 005e1470
BODY     : [[005e1470, 005e1625]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005e1470(GThread *param_1,int param_2)

{
  undefined1 uVar1;
  int iVar2;
  code *pcVar3;
  float fVar4;
  GThread *pGVar5;
  int iVar6;
  undefined4 uVar7;
  int *in_ECX;
  GThread *this;
  GThread *this_00;
  undefined1 *puVar8;
  int iVar9;
  int local_18;
  
  this = param_1;
  pGVar5 = *(GThread **)(param_1 + 0x314);
  if (*(GThread **)(param_1 + 0x314) == (GThread *)0x0) {
    this = param_1 + 0x28;
    pGVar5 = param_1 + 0x28;
  }
  param_1 = pGVar5;
  GThread::OnExit(this);
  iVar9 = *(int *)(param_2 + 8) + -2;
  FUN_005de180(0x1000,0);
  FUN_005dea80(iVar9,0);
  param_2 = 0;
  while( true ) {
    local_18 = 0x1000;
    if (iVar9 - param_2 < 0x1001) {
      local_18 = iVar9 - param_2;
    }
    iVar6 = FUN_0053a0f0(0,local_18);
    param_2 = param_2 + iVar6;
    if ((0 < iVar6) && (puVar8 = (undefined1 *)0x0, 0 < iVar6)) {
      do {
        iVar2 = in_ECX[8];
        in_ECX[8] = iVar2 + 1;
        uVar1 = *puVar8;
        puVar8 = puVar8 + 1;
        *(undefined1 *)(in_ECX[7] + iVar2) = uVar1;
      } while ((int)puVar8 < iVar6);
    }
    if (iVar6 != local_18) break;
    if (iVar9 <= param_2) {
LAB_005e156f:
      FUN_005e0a30(0);
      iVar9 = in_ECX[0x15];
      if (iVar9 != 0) {
        fVar4 = (float)iVar9;
        if (iVar9 < 0) {
          fVar4 = fVar4 + 4.2949673e+09;
        }
        fVar4 = 1024.0 / fVar4;
        pcVar3 = *(code **)(*in_ECX + 0x3c);
        in_ECX[4] = (int)(fVar4 * (float)in_ECX[0x18]);
        in_ECX[2] = (int)((float)in_ECX[0x16] * fVar4);
        in_ECX[3] = (int)(fVar4 * (float)in_ECX[0x17]);
        (*pcVar3)();
        GThread::OnExit(this_00);
        in_ECX[5] = in_ECX[0x14];
        FUN_00515cf0(0);
        return;
      }
      uVar7 = (**(code **)(*in_ECX + 0x3c))();
      FUN_0058c420(param_1,
                   "Invalid nominal size for DefineCompactedFont, font %s. Broken gfx file.\n",uVar7
                  );
      in_ECX[4] = 0;
      in_ECX[2] = 0x44700000;
      in_ECX[3] = 0x42800000;
      FUN_00515cf0(0);
      return;
    }
  }
  FUN_0058c420(param_1,"Could not read tag DefineCompactedFont. Broken gfx file.\n");
  goto LAB_005e156f;
}



============================================================
DISASSEMBLY
============================================================
005e1470 : SUB ESP,0x18
005e1473 : PUSH EBX
005e1474 : PUSH ESI
005e1475 : MOV ESI,ECX
005e1477 : MOV ECX,dword ptr [ESP + 0x24]
005e147b : MOV EAX,dword ptr [ECX + 0x314]
005e1481 : XOR EBX,EBX
005e1483 : PUSH EDI
005e1484 : MOV dword ptr [ESP + 0x14],ESI
005e1488 : CMP EAX,EBX
005e148a : JNZ 0x005e1495
005e148c : ADD ECX,0x28
005e148f : MOV dword ptr [ESP + 0x28],ECX
005e1493 : JMP 0x005e1499
005e1495 : MOV dword ptr [ESP + 0x28],EAX
005e1499 : MOV EAX,dword ptr [ESP + 0x28]
005e149d : PUSH EBP
005e149e : PUSH 0xb93b18
005e14a3 : PUSH EAX
005e14a4 : CALL 0x0051d420
005e14a9 : MOV ECX,dword ptr [ESP + 0x38]
005e14ad : MOV EBP,dword ptr [ECX + 0x8]
005e14b0 : ADD ESP,0x8
005e14b3 : PUSH EBX
005e14b4 : SUB EBP,0x2
005e14b7 : PUSH 0x1000
005e14bc : LEA ECX,[ESP + 0x24]
005e14c0 : MOV dword ptr [ESP + 0x1c],EBP
005e14c4 : MOV dword ptr [ESP + 0x24],EBX
005e14c8 : MOV dword ptr [ESP + 0x28],EBX
005e14cc : MOV dword ptr [ESP + 0x2c],EBX
005e14d0 : CALL 0x005de180
005e14d5 : PUSH EBX
005e14d6 : LEA EDI,[ESI + 0x1c]
005e14d9 : PUSH EBP
005e14da : MOV ECX,EDI
005e14dc : CALL 0x005dea80
005e14e1 : MOV dword ptr [ESP + 0x30],EBX
005e14e5 : MOV EBX,dword ptr [ESP + 0x1c]
005e14e9 : LEA ESP,[ESP]
005e14f0 : MOV EAX,EBP
005e14f2 : SUB EAX,dword ptr [ESP + 0x30]
005e14f6 : MOV dword ptr [ESP + 0x10],0x1000
005e14fe : CMP EAX,0x1000
005e1503 : JG 0x005e1509
005e1505 : MOV dword ptr [ESP + 0x10],EAX
005e1509 : MOV EDX,dword ptr [ESP + 0x10]
005e150d : MOV ECX,dword ptr [ESP + 0x2c]
005e1511 : PUSH EDX
005e1512 : PUSH EBX
005e1513 : CALL 0x0053a0f0
005e1518 : MOV EBP,EAX
005e151a : ADD dword ptr [ESP + 0x30],EBP
005e151e : TEST EBP,EBP
005e1520 : JLE 0x005e1541
005e1522 : XOR EDX,EDX
005e1524 : TEST EBP,EBP
005e1526 : JLE 0x005e1541
005e1528 : MOV ESI,dword ptr [EDI + 0x4]
005e152b : MOV ECX,dword ptr [EDI]
005e152d : ADD ECX,ESI
005e152f : INC ESI
005e1530 : MOV dword ptr [EDI + 0x4],ESI
005e1533 : MOV AL,byte ptr [EBX + EDX*0x1]
005e1536 : INC EDX
005e1537 : CMP EDX,EBP
005e1539 : MOV byte ptr [ECX],AL
005e153b : JL 0x005e1528
005e153d : MOV ESI,dword ptr [ESP + 0x18]
005e1541 : CMP EBP,dword ptr [ESP + 0x10]
005e1545 : JNZ 0x005e1557
005e1547 : MOV ECX,dword ptr [ESP + 0x30]
005e154b : CMP ECX,dword ptr [ESP + 0x14]
005e154f : JGE 0x005e156b
005e1551 : MOV EBP,dword ptr [ESP + 0x14]
005e1555 : JMP 0x005e14f0
005e1557 : MOV EDI,dword ptr [ESP + 0x2c]
005e155b : PUSH 0xb93adc
005e1560 : PUSH EDI
005e1561 : CALL 0x0058c420
005e1566 : ADD ESP,0x8
005e1569 : JMP 0x005e156f
005e156b : MOV EDI,dword ptr [ESP + 0x2c]
005e156f : PUSH 0x0
005e1571 : LEA ECX,[ESI + 0x28]
005e1574 : CALL 0x005e0a30
005e1579 : MOV EAX,dword ptr [ESI + 0x54]
005e157c : POP EBP
005e157d : TEST EAX,EAX
005e157f : JA 0x005e15bf
005e1581 : MOV EDX,dword ptr [ESI]
005e1583 : MOV EAX,dword ptr [EDX + 0x3c]
005e1586 : MOV ECX,ESI
005e1588 : CALL EAX
005e158a : PUSH EAX
005e158b : PUSH 0xb93a90
005e1590 : PUSH EDI
005e1591 : CALL 0x0058c420
005e1596 : FLDZ
005e1598 : FSTP float ptr [ESI + 0x10]
005e159b : ADD ESP,0xc
005e159e : FLD float ptr [0x00cdf204]
005e15a4 : PUSH EBX
005e15a5 : FSTP float ptr [ESI + 0x8]
005e15a8 : FLD float ptr [0x00cdf150]
005e15ae : FSTP float ptr [ESI + 0xc]
005e15b1 : CALL 0x00515cf0
005e15b6 : POP EDI
005e15b7 : POP ESI
005e15b8 : POP EBX
005e15b9 : ADD ESP,0x18
005e15bc : RET 0x8
005e15bf : MOV dword ptr [ESP + 0x28],EAX
005e15c3 : FILD dword ptr [ESP + 0x28]
005e15c7 : TEST EAX,EAX
005e15c9 : JGE 0x005e15d1
005e15cb : FADD float ptr [0x00cdf0e0]
005e15d1 : FDIVR double ptr [0x00b8d8c8]
005e15d7 : MOV EDX,dword ptr [ESI]
005e15d9 : MOV EAX,dword ptr [EDX + 0x3c]
005e15dc : MOV ECX,ESI
005e15de : FSTP float ptr [ESP + 0x28]
005e15e2 : FLD float ptr [ESI + 0x60]
005e15e5 : FLD float ptr [ESP + 0x28]
005e15e9 : FLD ST0
005e15eb : FMULP ST2
005e15ed : FXCH
005e15ef : FSTP float ptr [ESI + 0x10]
005e15f2 : FLD float ptr [ESI + 0x58]
005e15f5 : FMUL ST1
005e15f7 : FSTP float ptr [ESI + 0x8]
005e15fa : FMUL float ptr [ESI + 0x5c]
005e15fd : FSTP float ptr [ESI + 0xc]
005e1600 : CALL EAX
005e1602 : PUSH EAX
005e1603 : PUSH 0xb93a80
005e1608 : PUSH EDI
005e1609 : CALL 0x0051d420
005e160e : MOV ECX,dword ptr [ESI + 0x50]
005e1611 : ADD ESP,0xc
005e1614 : PUSH EBX
005e1615 : MOV dword ptr [ESI + 0x14],ECX
005e1618 : CALL 0x00515cf0
005e161d : POP EDI
005e161e : POP ESI
005e161f : POP EBX
005e1620 : ADD ESP,0x18
005e1623 : RET 0x8
