PROGRAM  : Maestia.exe
FUNCTION : FUN_0057d320
ENTRY    : 0057d320
BODY     : [[0057d320, 0057d392]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0057d320(void)

{
  undefined4 *puVar1;
  LONG LVar2;
  int *in_ECX;
  int iVar3;
  uint uVar4;
  int local_8;
  
  if (*in_ECX != 0) {
    iVar3 = 0;
    local_8 = *(int *)(*in_ECX + 4) + 1;
    do {
      puVar1 = (undefined4 *)(iVar3 + 8 + *in_ECX);
      if (*(int *)(iVar3 + 8 + *in_ECX) != -2) {
        uVar4 = puVar1[2] & 0xfffffffc;
        LVar2 = InterlockedExchangeAdd((LONG *)(uVar4 + 4),-1);
        if (LVar2 == 1) {
          FUN_00515cf0(uVar4);
        }
        *puVar1 = 0xfffffffe;
      }
      iVar3 = iVar3 + 0x14;
      local_8 = local_8 + -1;
    } while (local_8 != 0);
    FUN_00515cf0(*in_ECX);
    *in_ECX = 0;
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
0057d320 : SUB ESP,0x8
0057d323 : PUSH ESI
0057d324 : MOV ESI,ECX
0057d326 : MOV EAX,dword ptr [ESI]
0057d328 : MOV dword ptr [ESP + 0x8],ESI
0057d32c : TEST EAX,EAX
0057d32e : JZ 0x0057d38e
0057d330 : MOV EAX,dword ptr [EAX + 0x4]
0057d333 : PUSH EBX
0057d334 : PUSH EBP
0057d335 : MOV EBP,dword ptr [0x00b851cc]
0057d33b : XOR EBX,EBX
0057d33d : INC EAX
0057d33e : PUSH EDI
0057d33f : MOV dword ptr [ESP + 0x10],EAX
0057d343 : MOV EAX,dword ptr [ESI]
0057d345 : CMP dword ptr [EBX + EAX*0x1 + 0x8],-0x2
0057d34a : LEA EDI,[EBX + EAX*0x1 + 0x8]
0057d34e : JZ 0x0057d373
0057d350 : MOV ESI,dword ptr [EDI + 0x8]
0057d353 : AND ESI,0xfffffffc
0057d356 : PUSH -0x1
0057d358 : LEA ECX,[ESI + 0x4]
0057d35b : PUSH ECX
0057d35c : CALL EBP
0057d35e : SUB EAX,0x1
0057d361 : JNZ 0x0057d369
0057d363 : PUSH ESI
0057d364 : CALL 0x00515cf0
0057d369 : MOV ESI,dword ptr [ESP + 0x14]
0057d36d : MOV dword ptr [EDI],0xfffffffe
0057d373 : ADD EBX,0x14
0057d376 : SUB dword ptr [ESP + 0x10],0x1
0057d37b : JNZ 0x0057d343
0057d37d : MOV EDX,dword ptr [ESI]
0057d37f : PUSH EDX
0057d380 : CALL 0x00515cf0
0057d385 : POP EDI
0057d386 : POP EBP
0057d387 : MOV dword ptr [ESI],0x0
0057d38d : POP EBX
0057d38e : POP ESI
0057d38f : ADD ESP,0x8
0057d392 : RET
