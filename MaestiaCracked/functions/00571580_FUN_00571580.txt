PROGRAM  : Maestia.exe
FUNCTION : FUN_00571580
ENTRY    : 00571580
BODY     : [[00571580, 00571788]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00571580(char *param_1,undefined4 param_2,undefined4 param_3)

{
  char *pcVar1;
  bool bVar2;
  undefined4 uVar3;
  int iVar4;
  int iVar5;
  uint uVar6;
  LONG LVar7;
  GRefCountImpl *this;
  int in_ECX;
  undefined4 *puVar8;
  undefined4 uVar9;
  char *pcStack_4;
  
  uVar3 = param_1;
  bVar2 = false;
  param_1 = (char *)FUN_00525530(param_1);
  *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + 1;
  if ((*(int *)(in_ECX + 0x68) == 0) || (*(int *)(param_1 + 0x10) == 0)) {
    iVar4 = 0;
  }
  else {
    uVar9 = 0;
    puVar8 = &param_1;
    (**(code **)(**(int **)(in_ECX + 0x68) + 0x5c))(puVar8,0);
    iVar4 = FUN_0052add0(puVar8,uVar9);
  }
  *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + -1;
  if (*(int *)(param_1 + 8) == 0) {
    FUN_00525340();
  }
  if (iVar4 == 0) {
    param_1 = "";
    uVar6 = FUN_0051cf20();
    pcStack_4 = (char *)CONCAT31(pcStack_4._1_3_,6 < uVar6);
    iVar5 = FUN_0056a360(uVar3,&param_1,pcStack_4);
    if (*param_1 != '\0') {
      return;
    }
    if (iVar5 == -1) {
      return;
    }
LAB_005716e2:
    iVar4 = FUN_00515840(0x68,0);
    if (iVar4 == 0) {
      iVar5 = 0;
      goto LAB_00571749;
    }
    FUN_0051c480(param_2);
    iVar5 = FUN_0056ebb0(iVar5,&param_1,param_3,1,0);
    pcVar1 = param_1;
  }
  else {
    iVar5 = FUN_0054ed10();
    if ((iVar5 != 0) && (iVar5 = *(int *)(iVar5 + 0x1a0), iVar5 != -1)) goto LAB_005716e2;
    iVar5 = FUN_00515840(0x68,0);
    if (iVar5 == 0) {
      iVar5 = 0;
    }
    else {
      FUN_0051c480(param_2);
      iVar4 = *(int *)(iVar4 + 0x80);
      bVar2 = true;
      if (iVar4 == 0) {
        iVar4 = FUN_00520df0();
      }
      FUN_0051b6e0();
      *(undefined4 *)(iVar5 + 0x14) = 0;
      *(undefined1 *)(iVar5 + 0x1c) = 0;
      *(undefined1 *)(iVar5 + 0x2c) = 0;
      *(undefined1 *)(iVar5 + 0x3c) = 0;
      *(undefined4 *)(iVar5 + 0x4c) = 0;
      *(undefined1 *)(iVar5 + 0x50) = 0;
      *(undefined4 *)(iVar5 + 0x60) = 0;
      FUN_0056eaa0(4,iVar4,0xffffffff,&pcStack_4,param_3,0);
    }
    pcVar1 = pcStack_4;
    if (!bVar2) goto LAB_00571749;
  }
  LVar7 = InterlockedExchangeAdd((LONG *)(((uint)pcVar1 & 0xfffffffc) + 4),-1);
  if (LVar7 == 1) {
    FUN_00515cf0((uint)pcVar1 & 0xfffffffc);
  }
LAB_00571749:
  if (iVar5 != 0) {
    this = (GRefCountImpl *)(**(code **)(*(int *)(in_ECX + 8) + 0xc))(0x17);
    if (this != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(this);
      FUN_00571350(iVar5);
      return;
    }
    FUN_0056a440(iVar5);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00571580 : SUB ESP,0x8
00571583 : PUSH EBX
00571584 : PUSH EBP
00571585 : PUSH ESI
00571586 : MOV ESI,dword ptr [ESP + 0x18]
0057158a : PUSH EDI
0057158b : MOV EDI,ECX
0057158d : MOV EAX,dword ptr [EDI + 0x9e8]
00571593 : XOR EBX,EBX
00571595 : PUSH ESI
00571596 : LEA ECX,[EAX + 0x254]
0057159c : MOV dword ptr [ESP + 0x14],EBX
005715a0 : CALL 0x00525530
005715a5 : MOV dword ptr [ESP + 0x1c],EAX
005715a9 : INC dword ptr [EAX + 0x8]
005715ac : MOV EAX,dword ptr [ESP + 0x1c]
005715b0 : CMP dword ptr [EDI + 0x68],EBX
005715b3 : JZ 0x005715d9
005715b5 : CMP dword ptr [EAX + 0x10],EBX
005715b8 : JZ 0x005715d9
005715ba : MOV ECX,dword ptr [EDI + 0x68]
005715bd : MOV EDX,dword ptr [ECX]
005715bf : PUSH EBX
005715c0 : LEA EAX,[ESP + 0x20]
005715c4 : PUSH EAX
005715c5 : MOV EAX,dword ptr [EDX + 0x5c]
005715c8 : CALL EAX
005715ca : MOV ECX,EAX
005715cc : CALL 0x0052add0
005715d1 : MOV EBP,EAX
005715d3 : MOV EAX,dword ptr [ESP + 0x1c]
005715d7 : JMP 0x005715db
005715d9 : XOR EBP,EBP
005715db : DEC dword ptr [EAX + 0x8]
005715de : MOV ECX,EAX
005715e0 : ADD EAX,0x8
005715e3 : CMP dword ptr [EAX],EBX
005715e5 : JNZ 0x005715ec
005715e7 : CALL 0x00525340
005715ec : CMP EBP,EBX
005715ee : JZ 0x0057169e
005715f4 : LEA ECX,[EBP + 0x68]
005715f7 : CALL 0x0054ed10
005715fc : CMP EAX,EBX
005715fe : JZ 0x0057160f
00571600 : MOV ESI,dword ptr [EAX + 0x1a0]
00571606 : CMP ESI,-0x1
00571609 : JNZ 0x005716e2
0057160f : MOV ECX,dword ptr [EDI + 0x14]
00571612 : PUSH EBX
00571613 : PUSH 0x68
00571615 : CALL 0x00515840
0057161a : MOV ESI,EAX
0057161c : CMP ESI,EBX
0057161e : JZ 0x0057167f
00571620 : MOV ECX,dword ptr [ESP + 0x20]
00571624 : PUSH ECX
00571625 : LEA ECX,[ESP + 0x18]
00571629 : CALL 0x0051c480
0057162e : MOV EAX,dword ptr [EBP + 0x80]
00571634 : MOV dword ptr [ESP + 0x10],0x1
0057163c : CMP EAX,EBX
0057163e : JNZ 0x00571647
00571640 : MOV ECX,EBP
00571642 : CALL 0x00520df0
00571647 : LEA ECX,[ESI + 0xc]
0057164a : MOV EBP,EAX
0057164c : CALL 0x0051b6e0
00571651 : MOV EDX,dword ptr [ESP + 0x24]
00571655 : PUSH EBX
00571656 : PUSH EDX
00571657 : MOV dword ptr [ESI + 0x14],EBX
0057165a : MOV byte ptr [ESI + 0x1c],BL
0057165d : LEA EAX,[ESP + 0x1c]
00571661 : PUSH EAX
00571662 : MOV byte ptr [ESI + 0x2c],BL
00571665 : PUSH -0x1
00571667 : MOV byte ptr [ESI + 0x3c],BL
0057166a : MOV dword ptr [ESI + 0x4c],EBX
0057166d : PUSH EBP
0057166e : MOV byte ptr [ESI + 0x50],BL
00571671 : PUSH 0x4
00571673 : MOV ECX,ESI
00571675 : MOV dword ptr [ESI + 0x60],EBX
00571678 : CALL 0x0056eaa0
0057167d : JMP 0x00571681
0057167f : XOR ESI,ESI
00571681 : TEST byte ptr [ESP + 0x10],0x1
00571686 : JZ 0x00571749
0057168c : MOV EBP,dword ptr [ESP + 0x14]
00571690 : AND EBP,0xfffffffc
00571693 : PUSH -0x1
00571695 : LEA ECX,[EBP + 0x4]
00571698 : PUSH ECX
00571699 : JMP 0x00571738
0057169e : MOV ECX,dword ptr [EDI + 0x68]
005716a1 : MOV dword ptr [ESP + 0x1c],0xcca874
005716a9 : CALL 0x0051cf20
005716ae : CMP EAX,0x6
005716b1 : SETA DL
005716b4 : MOV byte ptr [ESP + 0x14],DL
005716b8 : MOV EAX,dword ptr [ESP + 0x14]
005716bc : PUSH EAX
005716bd : LEA ECX,[ESP + 0x20]
005716c1 : PUSH ECX
005716c2 : PUSH ESI
005716c3 : CALL 0x0056a360
005716c8 : MOV EDX,dword ptr [ESP + 0x28]
005716cc : ADD ESP,0xc
005716cf : MOV ESI,EAX
005716d1 : CMP byte ptr [EDX],BL
005716d3 : JNZ 0x0057177f
005716d9 : CMP ESI,-0x1
005716dc : JZ 0x0057177f
005716e2 : MOV ECX,dword ptr [EDI + 0x14]
005716e5 : PUSH EBX
005716e6 : PUSH 0x68
005716e8 : CALL 0x00515840
005716ed : MOV EBP,EAX
005716ef : CMP EBP,EBX
005716f1 : JZ 0x00571722
005716f3 : MOV EAX,dword ptr [ESP + 0x20]
005716f7 : PUSH EAX
005716f8 : LEA ECX,[ESP + 0x20]
005716fc : CALL 0x0051c480
00571701 : MOV ECX,dword ptr [ESP + 0x24]
00571705 : PUSH EBX
00571706 : PUSH 0x1
00571708 : PUSH ECX
00571709 : LEA EDX,[ESP + 0x28]
0057170d : PUSH EDX
0057170e : PUSH ESI
0057170f : MOV ECX,EBP
00571711 : MOV dword ptr [ESP + 0x24],0x2
00571719 : CALL 0x0056ebb0
0057171e : MOV ESI,EAX
00571720 : JMP 0x00571724
00571722 : XOR ESI,ESI
00571724 : TEST byte ptr [ESP + 0x10],0x2
00571729 : JZ 0x00571749
0057172b : MOV EBP,dword ptr [ESP + 0x1c]
0057172f : AND EBP,0xfffffffc
00571732 : PUSH -0x1
00571734 : LEA EAX,[EBP + 0x4]
00571737 : PUSH EAX
00571738 : CALL dword ptr [0x00b851cc]
0057173e : SUB EAX,0x1
00571741 : JNZ 0x00571749
00571743 : PUSH EBP
00571744 : CALL 0x00515cf0
00571749 : CMP ESI,EBX
0057174b : JZ 0x0057177f
0057174d : MOV EDX,dword ptr [EDI + 0x8]
00571750 : MOV EAX,dword ptr [EDX + 0xc]
00571753 : LEA ECX,[EDI + 0x8]
00571756 : PUSH 0x17
00571758 : CALL EAX
0057175a : CMP EAX,EBX
0057175c : JZ 0x00571777
0057175e : MOV ECX,EAX
00571760 : CALL 0x004ff7e0
00571765 : PUSH ESI
00571766 : MOV ECX,EDI
00571768 : CALL 0x00571350
0057176d : POP EDI
0057176e : POP ESI
0057176f : POP EBP
00571770 : POP EBX
00571771 : ADD ESP,0x8
00571774 : RET 0xc
00571777 : PUSH ESI
00571778 : MOV ECX,EDI
0057177a : CALL 0x0056a440
0057177f : POP EDI
00571780 : POP ESI
00571781 : POP EBP
00571782 : POP EBX
00571783 : ADD ESP,0x8
00571786 : RET 0xc
