PROGRAM  : Maestia.exe
FUNCTION : FUN_0060bb30
ENTRY    : 0060bb30
BODY     : [[0060bb30, 0060bc62]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_0060bb30(short param_1,short param_2,undefined4 param_3,undefined4 param_4)

{
  uint *puVar1;
  int *piVar2;
  undefined4 uVar3;
  uint uVar4;
  int iVar5;
  int in_ECX;
  undefined4 local_4;
  
  uVar4 = *(int *)(in_ECX + 0x28) - 1;
  if (*(int *)(*(int *)(*(int *)(in_ECX + 0x34) + (uVar4 >> 6) * 4) + 4 + (uVar4 & 0x3f) * 8) != 0)
  {
    uVar4 = *(int *)(in_ECX + 0x18) - 1;
    uVar3 = *(undefined4 *)
             (*(int *)(*(int *)(in_ECX + 0x24) + (uVar4 >> 6) * 4) + (uVar4 & 0x3f) * 4);
    local_4._2_2_ = (short)((uint)uVar3 >> 0x10);
    iVar5 = ((int)param_1 - (int)(short)param_3) * ((int)(short)param_4 - (int)local_4._2_2_) -
            ((int)param_2 - (int)(short)param_4) *
            ((int)(short)param_3 - (int)(short)((short)uVar3 >> 1));
    if (iVar5 < 0) {
      iVar5 = -iVar5;
    }
    if (iVar5 < 6) {
      iVar5 = FUN_0060ba80(param_3,param_4);
      return iVar5;
    }
  }
  puVar1 = (uint *)(in_ECX + 0x18);
  uVar4 = *(uint *)(in_ECX + 0x18) >> 6;
  local_4 = CONCAT22(param_2,param_1 * 2) | 1;
  if (*(uint *)(in_ECX + 0x1c) <= uVar4) {
    FUN_00609500(uVar4);
  }
  *(uint *)(*(int *)(*(int *)(in_ECX + 0x24) + uVar4 * 4) + (*puVar1 & 0x3f) * 4) = local_4;
  *puVar1 = *puVar1 + 1;
  uVar4 = *puVar1 >> 6;
  local_4 = CONCAT22((short)param_4,(short)param_3 * 2) | 1;
  if (*(uint *)(in_ECX + 0x1c) <= uVar4) {
    FUN_00609500(uVar4);
  }
  *(uint *)(*(int *)(*(int *)(in_ECX + 0x24) + uVar4 * 4) + (*puVar1 & 0x3f) * 4) = local_4;
  *puVar1 = *puVar1 + 1;
  uVar4 = *(int *)(in_ECX + 0x28) - 1;
  iVar5 = *(int *)(*(int *)(in_ECX + 0x34) + (uVar4 >> 6) * 4);
  uVar4 = uVar4 & 0x3f;
  piVar2 = (int *)(iVar5 + 4 + uVar4 * 8);
  *piVar2 = *piVar2 + 2;
  return iVar5 + 4 + uVar4 * 8;
}



============================================================
DISASSEMBLY
============================================================
0060bb30 : PUSH ECX
0060bb31 : PUSH EBX
0060bb32 : PUSH ESI
0060bb33 : PUSH EDI
0060bb34 : MOV EDI,ECX
0060bb36 : MOV EAX,dword ptr [EDI + 0x28]
0060bb39 : MOV EDX,dword ptr [EDI + 0x34]
0060bb3c : DEC EAX
0060bb3d : MOV ECX,EAX
0060bb3f : SHR ECX,0x6
0060bb42 : MOV ECX,dword ptr [EDX + ECX*0x4]
0060bb45 : AND EAX,0x3f
0060bb48 : CMP dword ptr [ECX + EAX*0x8 + 0x4],0x0
0060bb4d : JZ 0x0060bbbf
0060bb4f : MOV EAX,dword ptr [EDI + 0x18]
0060bb52 : MOV ECX,dword ptr [EDI + 0x24]
0060bb55 : DEC EAX
0060bb56 : MOV EDX,EAX
0060bb58 : SHR EDX,0x6
0060bb5b : MOV EDX,dword ptr [ECX + EDX*0x4]
0060bb5e : MOVSX ECX,word ptr [ESP + 0x1c]
0060bb63 : AND EAX,0x3f
0060bb66 : MOV EAX,dword ptr [EDX + EAX*0x4]
0060bb69 : MOVSX EDX,word ptr [ESP + 0x20]
0060bb6e : MOV dword ptr [ESP + 0xc],EAX
0060bb72 : MOVSX EBX,word ptr [ESP + 0xe]
0060bb77 : PUSH EBP
0060bb78 : MOV EBP,EDX
0060bb7a : SUB EBP,EBX
0060bb7c : MOVSX EBX,word ptr [ESP + 0x1c]
0060bb81 : MOV SI,AX
0060bb84 : MOVSX EAX,word ptr [ESP + 0x18]
0060bb89 : SAR SI,0x1
0060bb8c : SUB EBX,EDX
0060bb8e : MOVSX EDX,SI
0060bb91 : SUB EAX,ECX
0060bb93 : SUB ECX,EDX
0060bb95 : IMUL EAX,EBP
0060bb98 : IMUL EBX,ECX
0060bb9b : SUB EAX,EBX
0060bb9d : POP EBP
0060bb9e : JNS 0x0060bba2
0060bba0 : NEG EAX
0060bba2 : CMP EAX,0x5
0060bba5 : JG 0x0060bbbf
0060bba7 : MOV EAX,dword ptr [ESP + 0x20]
0060bbab : MOV ECX,dword ptr [ESP + 0x1c]
0060bbaf : PUSH EAX
0060bbb0 : PUSH ECX
0060bbb1 : MOV ECX,EDI
0060bbb3 : CALL 0x0060ba80
0060bbb8 : POP EDI
0060bbb9 : POP ESI
0060bbba : POP EBX
0060bbbb : POP ECX
0060bbbc : RET 0x10
0060bbbf : MOV EDX,dword ptr [ESP + 0x14]
0060bbc3 : MOV EBX,dword ptr [EDI + 0x18]
0060bbc6 : MOV CX,word ptr [ESP + 0x18]
0060bbcb : LEA ESI,[EDI + 0x18]
0060bbce : LEA EAX,[EDX + EDX*0x1]
0060bbd1 : OR EAX,0x1
0060bbd4 : SHR EBX,0x6
0060bbd7 : MOV word ptr [ESP + 0xc],AX
0060bbdc : MOV word ptr [ESP + 0xe],CX
0060bbe1 : CMP EBX,dword ptr [ESI + 0x4]
0060bbe4 : JC 0x0060bbee
0060bbe6 : PUSH EBX
0060bbe7 : MOV ECX,ESI
0060bbe9 : CALL 0x00609500
0060bbee : MOV EDX,dword ptr [ESI + 0xc]
0060bbf1 : MOV ECX,dword ptr [EDX + EBX*0x4]
0060bbf4 : MOV EAX,dword ptr [ESI]
0060bbf6 : MOV EDX,dword ptr [ESP + 0xc]
0060bbfa : AND EAX,0x3f
0060bbfd : MOV dword ptr [ECX + EAX*0x4],EDX
0060bc00 : INC dword ptr [ESI]
0060bc02 : MOV EAX,dword ptr [ESP + 0x1c]
0060bc06 : MOV EBX,dword ptr [ESI]
0060bc08 : MOV DX,word ptr [ESP + 0x20]
0060bc0d : LEA ECX,[EAX + EAX*0x1]
0060bc10 : OR ECX,0x1
0060bc13 : SHR EBX,0x6
0060bc16 : MOV word ptr [ESP + 0xc],CX
0060bc1b : MOV word ptr [ESP + 0xe],DX
0060bc20 : CMP EBX,dword ptr [ESI + 0x4]
0060bc23 : JC 0x0060bc2d
0060bc25 : PUSH EBX
0060bc26 : MOV ECX,ESI
0060bc28 : CALL 0x00609500
0060bc2d : MOV EAX,dword ptr [ESI + 0xc]
0060bc30 : MOV EDX,dword ptr [EAX + EBX*0x4]
0060bc33 : MOV ECX,dword ptr [ESI]
0060bc35 : MOV EAX,dword ptr [ESP + 0xc]
0060bc39 : AND ECX,0x3f
0060bc3c : MOV dword ptr [EDX + ECX*0x4],EAX
0060bc3f : INC dword ptr [ESI]
0060bc41 : MOV EAX,dword ptr [EDI + 0x28]
0060bc44 : MOV EDX,dword ptr [EDI + 0x34]
0060bc47 : DEC EAX
0060bc48 : MOV ECX,EAX
0060bc4a : SHR ECX,0x6
0060bc4d : MOV ECX,dword ptr [EDX + ECX*0x4]
0060bc50 : AND EAX,0x3f
0060bc53 : ADD dword ptr [ECX + EAX*0x8 + 0x4],0x2
0060bc58 : POP EDI
0060bc59 : LEA EAX,[ECX + EAX*0x8 + 0x4]
0060bc5d : POP ESI
0060bc5e : POP EBX
0060bc5f : POP ECX
0060bc60 : RET 0x10
