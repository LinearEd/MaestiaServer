PROGRAM  : Maestia.exe
FUNCTION : FUN_00891810
ENTRY    : 00891810
BODY     : [[00891810, 00891c5b]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00891810(void)

{
  float fVar1;
  code *pcVar2;
  bool bVar3;
  char cVar4;
  DWORD DVar5;
  int iVar6;
  int *in_ECX;
  float fVar7;
  float fStack_3c;
  undefined4 uStack_38;
  float local_34;
  float local_30;
  int local_2c;
  float local_28;
  int local_24;
  int local_20;
  int local_1c;
  undefined1 local_18 [20];
  
  local_24 = in_ECX[0x58e];
  iVar6 = in_ECX[0x59b];
  local_20 = in_ECX[0x58f];
  local_1c = in_ECX[0x590];
  uStack_38._3_1_ = 0xff;
  local_2c = iVar6;
  DVar5 = timeGetTime();
  in_ECX[0x59b] = DVar5;
  iVar6 = DVar5 - iVar6;
  fVar7 = (float)iVar6;
  if (iVar6 < 0) {
    fVar7 = fVar7 + 4.2949673e+09;
  }
  fVar7 = fVar7 * (float)in_ECX[0x594] * 0.015;
  if (*(char *)((int)in_ECX + 0x1667) == '\0') {
    fVar7 = fVar7 * DAT_00d72c24;
  }
  local_30 = fVar7 * (float)in_ECX[0x590] + (float)in_ECX[0x593];
  local_28 = fVar7 * (float)in_ECX[0x58e] + (float)in_ECX[0x591];
  in_ECX[0x593] = (int)local_30;
  in_ECX[0x591] = (int)local_28;
  local_34 = 0.0;
  bVar3 = true;
  cVar4 = FUN_00891380(in_ECX,local_28,local_30,&local_34,(int)&uStack_38 + 3,local_18,1);
  if ((cVar4 == '\0') &&
     ((((iVar6 = *(int *)(*(int *)(DAT_0172491c + 0x90) + 0xf0), iVar6 == 0 ||
        (*(byte *)(iVar6 + 0x274 + (uint)uStack_38._3_1_ * 0x28) != uStack_38._3_1_)) ||
       ((*(byte *)(iVar6 + (uint)uStack_38._3_1_ * 0x28 + 0x294) & 0x80) == 0)) ||
      ((D3DXVec3Normalize(&local_24,&local_24), in_ECX[0xfa] != 0 &&
       (iVar6 = FUN_00890f30(in_ECX), iVar6 == 2)))))) {
    bVar3 = false;
  }
  if ((*(char *)((int)in_ECX + 0x1667) != '\0') && (!bVar3)) {
    in_ECX[0x58e] = in_ECX[0x58e] ^ 0x80000000;
    fVar7 = (float)in_ECX[0x594] * DAT_00d72c24;
    in_ECX[0x590] = in_ECX[0x590] ^ 0x80000000;
    in_ECX[0x594] = (int)fVar7;
    *(undefined1 *)((int)in_ECX + 0x1667) = 0;
  }
  fVar7 = (float)in_ECX[0x596];
  if ((local_34 <= fVar7) || ((char)in_ECX[0x59a] != '\0')) {
    if ((local_34 <= fVar7) &&
       ((3.0 <= fVar7 - local_34 &&
        ((float)in_ECX[0x594] <= (float)in_ECX[0x595] * DAT_00d72c24 &&
         (float)in_ECX[0x595] * DAT_00d72c24 != (float)in_ECX[0x594])))) {
      *(undefined1 *)(in_ECX + 0x59a) = 1;
    }
  }
  else {
    in_ECX[0x596] = (int)local_34;
  }
  if ((char)in_ECX[0x59a] != '\0') {
    local_28 = (float)(in_ECX[0x59b] - local_2c);
    fVar7 = (float)(int)local_28;
    if ((int)local_28 < 0) {
      fVar7 = fVar7 + 4.2949673e+09;
    }
    fVar7 = (float)in_ECX[0x596] - fVar7 * (float)in_ECX[0x597];
    in_ECX[0x596] = (int)fVar7;
    if (fVar7 < local_34) {
      in_ECX[0x596] = (int)local_34;
    }
  }
  if ((float)in_ECX[0x594] <= (float)in_ECX[0x595] * 0.3 &&
      (float)in_ECX[0x595] * 0.3 != (float)in_ECX[0x594]) {
    *(undefined1 *)((int)in_ECX + 0x1667) = 0;
  }
  pcVar2 = *(code **)(*in_ECX + 0x2a0);
  in_ECX[0x592] = (int)local_34;
  (*pcVar2)(in_ECX + 0x591,1);
  DVar5 = timeGetTime();
  fVar7 = (float)in_ECX[0x594];
  uStack_38 = *(float *)(DAT_00da93ec + 0x458);
  if (fVar7 < (float)in_ECX[0x595] * 0.6666667) {
    fVar1 = *(float *)(DAT_00da93ec + 0x45c);
    in_ECX[0x598] = (int)fVar1;
    uStack_38 = fVar1 * uStack_38;
    *(undefined1 *)((int)in_ECX + 0x1666) = 1;
  }
  if (*(char *)((int)in_ECX + 0x1666) != '\0') {
    fVar1 = (float)in_ECX[0x598];
    in_ECX[0x598] = (int)(fVar1 + 0.15);
    uStack_38 = (fVar1 + 0.15) * uStack_38;
  }
  local_34 = (float)(in_ECX[0x59b] - (int)local_34);
  fVar1 = (float)(int)local_34;
  if ((int)local_34 < 0) {
    fVar1 = fVar1 + 4.2949673e+09;
  }
  fVar1 = fVar1 * fVar7 * uStack_38;
  if (fVar1 <= fVar7) {
    in_ECX[0x594] = (int)(fVar7 - fVar1);
  }
  else {
    in_ECX[0x594] = 0;
  }
  local_30 = (float)(DVar5 - in_ECX[0x59c]);
  fVar7 = (float)(int)local_30;
  if ((int)local_30 < 0) {
    fVar7 = fVar7 + 4.2949673e+09;
  }
  if (((float)in_ECX[0x55b] * 1000.0 < fVar7) || ((float)in_ECX[0x55c] == 0.0)) {
    (**(code **)(*in_ECX + 0x188))(9,0,0,0,0,0x3f800000);
  }
  if (0.2 < (float)in_ECX[0x594]) {
    if ((char)in_ECX[0x59a] == '\0') goto LAB_00891c34;
  }
  else if ((char)in_ECX[0x59a] == '\0') {
    in_ECX[0x594] = 0;
    return 1;
  }
  if (((float)in_ECX[0x596] <= fStack_3c && fStack_3c != (float)in_ECX[0x596]) &&
     ((float)in_ECX[0x594] <= 0.2)) {
    return 1;
  }
LAB_00891c34:
  if ((DVar5 - in_ECX[0x59c] < 0x9c5) && ((float)in_ECX[0x55c] != 0.0)) {
    return 0;
  }
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00891810 : PUSH EBP
00891811 : MOV EBP,ESP
00891813 : AND ESP,0xfffffff8
00891816 : SUB ESP,0x34
00891819 : PUSH EBX
0089181a : PUSH ESI
0089181b : PUSH EDI
0089181c : MOV EDI,ECX
0089181e : MOVSS XMM0,dword ptr [EDI + 0x1638]
00891826 : MOV ESI,dword ptr [EDI + 0x166c]
0089182c : MOVSS dword ptr [ESP + 0x24],XMM0
00891832 : MOVSS XMM0,dword ptr [EDI + 0x163c]
0089183a : MOVSS dword ptr [ESP + 0x28],XMM0
00891840 : MOVSS XMM0,dword ptr [EDI + 0x1640]
00891848 : MOV byte ptr [ESP + 0x13],0xff
0089184d : MOVSS dword ptr [ESP + 0x2c],XMM0
00891853 : MOV dword ptr [ESP + 0x1c],ESI
00891857 : CALL dword ptr [0x00b85598]
0089185d : MOV dword ptr [EDI + 0x166c],EAX
00891863 : SUB EAX,ESI
00891865 : MOV dword ptr [ESP + 0x20],EAX
00891869 : FILD dword ptr [ESP + 0x20]
0089186d : TEST EAX,EAX
0089186f : JGE 0x00891877
00891871 : FADD float ptr [0x00cdf0e0]
00891877 : CMP byte ptr [EDI + 0x1667],0x0
0089187e : FMUL float ptr [EDI + 0x1650]
00891884 : FMUL float ptr [0x00cdf36c]
0089188a : FSTP float ptr [ESP + 0x18]
0089188e : MOVSS XMM0,dword ptr [ESP + 0x18]
00891894 : JNZ 0x0089189e
00891896 : MULSS XMM0,dword ptr [0x00d72c24]
0089189e : PUSH 0x1
008918a0 : MOVAPS XMM1,XMM0
008918a3 : MULSS XMM0,dword ptr [EDI + 0x1640]
008918ab : ADDSS XMM0,dword ptr [EDI + 0x164c]
008918b3 : MULSS XMM1,dword ptr [EDI + 0x1638]
008918bb : ADDSS XMM1,dword ptr [EDI + 0x1644]
008918c3 : LEA EAX,[ESP + 0x34]
008918c7 : PUSH EAX
008918c8 : LEA ECX,[ESP + 0x1b]
008918cc : PUSH ECX
008918cd : LEA EDX,[ESP + 0x20]
008918d1 : MOVSS dword ptr [ESP + 0x24],XMM0
008918d7 : FLD float ptr [ESP + 0x24]
008918db : PUSH EDX
008918dc : SUB ESP,0x8
008918df : FSTP float ptr [ESP + 0x4]
008918e3 : MOVSS dword ptr [ESP + 0x38],XMM1
008918e9 : FLD float ptr [ESP + 0x38]
008918ed : MOVSS dword ptr [EDI + 0x164c],XMM0
008918f5 : XORPS XMM0,XMM0
008918f8 : FSTP float ptr [ESP]
008918fb : PUSH EDI
008918fc : MOVSS dword ptr [EDI + 0x1644],XMM1
00891904 : MOVSS dword ptr [ESP + 0x30],XMM0
0089190a : MOV BL,0x1
0089190c : CALL 0x00891380
00891911 : TEST AL,AL
00891913 : JNZ 0x00891976
00891915 : MOV EAX,[0x0172491c]
0089191a : MOV ECX,dword ptr [EAX + 0x90]
00891920 : MOV EDX,dword ptr [ECX + 0xf0]
00891926 : TEST EDX,EDX
00891928 : JZ 0x00891974
0089192a : MOV CL,byte ptr [ESP + 0x13]
0089192e : MOVZX EAX,CL
00891931 : LEA EAX,[EAX + EAX*0x4]
00891934 : CMP byte ptr [EDX + EAX*0x8 + 0x274],CL
0089193b : LEA EAX,[EDX + EAX*0x8]
0089193e : JNZ 0x00891974
00891940 : TEST byte ptr [EAX + 0x294],0x80
00891947 : JZ 0x00891974
00891949 : LEA ECX,[ESP + 0x24]
0089194d : PUSH ECX
0089194e : MOV EDX,ECX
00891950 : PUSH EDX
00891951 : CALL 0x004ff722
00891956 : CMP dword ptr [EDI + 0x3e8],0x0
0089195d : JZ 0x00891976
0089195f : LEA ESI,[EDI + 0x1580]
00891965 : PUSH EDI
00891966 : LEA ECX,[ESP + 0x28]
0089196a : CALL 0x00890f30
0089196f : CMP EAX,0x2
00891972 : JNZ 0x00891976
00891974 : XOR BL,BL
00891976 : CMP byte ptr [EDI + 0x1667],0x0
0089197d : JZ 0x008919cf
0089197f : TEST BL,BL
00891981 : JNZ 0x008919cf
00891983 : MOVSS XMM0,dword ptr [0x00cdf0c0]
0089198b : MOVSS XMM1,dword ptr [EDI + 0x1638]
00891993 : XORPS XMM1,XMM0
00891996 : MOVSS dword ptr [EDI + 0x1638],XMM1
0089199e : MOVSS XMM1,dword ptr [EDI + 0x1640]
008919a6 : XORPS XMM1,XMM0
008919a9 : MOVSS XMM0,dword ptr [EDI + 0x1650]
008919b1 : MULSS XMM0,dword ptr [0x00d72c24]
008919b9 : MOVSS dword ptr [EDI + 0x1640],XMM1
008919c1 : MOVSS dword ptr [EDI + 0x1650],XMM0
008919c9 : MOV byte ptr [EDI + 0x1667],BL
008919cf : MOVSS XMM0,dword ptr [EDI + 0x1658]
008919d7 : MOVSS XMM1,dword ptr [ESP + 0x14]
008919dd : COMISS XMM1,XMM0
008919e0 : JBE 0x008919f5
008919e2 : CMP byte ptr [EDI + 0x1668],0x0
008919e9 : JNZ 0x008919f5
008919eb : MOVSS dword ptr [EDI + 0x1658],XMM1
008919f3 : JMP 0x00891a27
008919f5 : COMISS XMM0,XMM1
008919f8 : JC 0x00891a27
008919fa : SUBSS XMM0,XMM1
008919fe : COMISS XMM0,dword ptr [0x00cdf19c]
00891a05 : JC 0x00891a27
00891a07 : MOVSS XMM0,dword ptr [EDI + 0x1654]
00891a0f : MULSS XMM0,dword ptr [0x00d72c24]
00891a17 : COMISS XMM0,dword ptr [EDI + 0x1650]
00891a1e : JBE 0x00891a27
00891a20 : MOV byte ptr [EDI + 0x1668],0x1
00891a27 : CMP byte ptr [EDI + 0x1668],0x0
00891a2e : JZ 0x00891a70
00891a30 : MOV EAX,dword ptr [EDI + 0x166c]
00891a36 : SUB EAX,dword ptr [ESP + 0x1c]
00891a3a : MOV dword ptr [ESP + 0x20],EAX
00891a3e : FILD dword ptr [ESP + 0x20]
00891a42 : TEST EAX,EAX
00891a44 : JGE 0x00891a4c
00891a46 : FADD float ptr [0x00cdf0e0]
00891a4c : FMUL float ptr [EDI + 0x165c]
00891a52 : FSUBR float ptr [EDI + 0x1658]
00891a58 : FST float ptr [EDI + 0x1658]
00891a5e : FLD float ptr [ESP + 0x14]
00891a62 : FCOMIP ST0,ST1
00891a64 : FSTP ST0
00891a66 : JBE 0x00891a70
00891a68 : MOVSS dword ptr [EDI + 0x1658],XMM1
00891a70 : MOVSS XMM0,dword ptr [EDI + 0x1654]
00891a78 : MULSS XMM0,dword ptr [0x00cdf0e8]
00891a80 : COMISS XMM0,dword ptr [EDI + 0x1650]
00891a87 : JBE 0x00891a90
00891a89 : MOV byte ptr [EDI + 0x1667],0x0
00891a90 : MOV EDX,dword ptr [EDI]
00891a92 : PUSH 0x1
00891a94 : LEA EAX,[EDI + 0x1644]
00891a9a : PUSH EAX
00891a9b : MOV EAX,dword ptr [EDX + 0x2a0]
00891aa1 : MOV ECX,EDI
00891aa3 : MOVSS dword ptr [EDI + 0x1648],XMM1
00891aab : CALL EAX
00891aad : CALL dword ptr [0x00b85598]
00891ab3 : MOVSS XMM2,dword ptr [EDI + 0x1650]
00891abb : MOVSS XMM0,dword ptr [EDI + 0x1654]
00891ac3 : MULSS XMM0,dword ptr [0x00cdf314]
00891acb : COMISS XMM0,XMM2
00891ace : MOV ESI,EAX
00891ad0 : MOV EAX,[0x00da93ec]
00891ad5 : MOVSS XMM1,dword ptr [EAX + 0x458]
00891add : MOVSS dword ptr [ESP + 0x18],XMM1
00891ae3 : MOVSS dword ptr [ESP + 0x20],XMM2
00891ae9 : JBE 0x00891b0f
00891aeb : MOVSS XMM0,dword ptr [EAX + 0x45c]
00891af3 : MOVSS dword ptr [EDI + 0x1660],XMM0
00891afb : MULSS XMM0,XMM1
00891aff : MOVAPS XMM1,XMM0
00891b02 : MOVSS dword ptr [ESP + 0x18],XMM1
00891b08 : MOV byte ptr [EDI + 0x1666],0x1
00891b0f : CMP byte ptr [EDI + 0x1666],0x0
00891b16 : JZ 0x00891b3a
00891b18 : MOVSS XMM0,dword ptr [EDI + 0x1660]
00891b20 : ADDSS XMM0,dword ptr [0x00cdf4fc]
00891b28 : MOVSS dword ptr [EDI + 0x1660],XMM0
00891b30 : MULSS XMM0,XMM1
00891b34 : MOVSS dword ptr [ESP + 0x18],XMM0
00891b3a : MOV ECX,dword ptr [EDI + 0x166c]
00891b40 : SUB ECX,dword ptr [ESP + 0x1c]
00891b44 : MOV dword ptr [ESP + 0x1c],ECX
00891b48 : FILD dword ptr [ESP + 0x1c]
00891b4c : TEST ECX,ECX
00891b4e : JGE 0x00891b56
00891b50 : FADD float ptr [0x00cdf0e0]
00891b56 : FLD float ptr [ESP + 0x20]
00891b5a : FMUL ST1
00891b5c : FXCH
00891b5e : FMUL float ptr [ESP + 0x18]
00891b62 : FST float ptr [ESP + 0x20]
00891b66 : FCOMIP ST0,ST1
00891b68 : FSTP ST0
00891b6a : JBE 0x00891b79
00891b6c : XORPS XMM2,XMM2
00891b6f : MOVSS dword ptr [EDI + 0x1650],XMM2
00891b77 : JMP 0x00891b8a
00891b79 : SUBSS XMM2,dword ptr [ESP + 0x20]
00891b7f : MOVSS dword ptr [EDI + 0x1650],XMM2
00891b87 : XORPS XMM2,XMM2
00891b8a : MOV EDX,ESI
00891b8c : SUB EDX,dword ptr [EDI + 0x1670]
00891b92 : MOV dword ptr [ESP + 0x20],EDX
00891b96 : FILD dword ptr [ESP + 0x20]
00891b9a : TEST EDX,EDX
00891b9c : JGE 0x00891ba4
00891b9e : FADD float ptr [0x00cdf0e0]
00891ba4 : FLD float ptr [EDI + 0x156c]
00891baa : FMUL float ptr [0x00cdf16c]
00891bb0 : FXCH
00891bb2 : FCOMIP ST0,ST1
00891bb4 : FSTP ST0
00891bb6 : JA 0x00891bc9
00891bb8 : MOVSS XMM0,dword ptr [EDI + 0x1570]
00891bc0 : UCOMISS XMM0,XMM2
00891bc3 : LAHF
00891bc4 : TEST AH,0x44
00891bc7 : JP 0x00891be8
00891bc9 : FLD1
00891bcb : MOV EAX,dword ptr [EDI]
00891bcd : MOV EDX,dword ptr [EAX + 0x188]
00891bd3 : PUSH ECX
00891bd4 : FSTP float ptr [ESP]
00891bd7 : PUSH 0x0
00891bd9 : PUSH 0x0
00891bdb : PUSH 0x0
00891bdd : PUSH 0x0
00891bdf : PUSH 0x9
00891be1 : MOV ECX,EDI
00891be3 : CALL EDX
00891be5 : XORPS XMM2,XMM2
00891be8 : MOVSS XMM0,dword ptr [EDI + 0x1650]
00891bf0 : MOVSS XMM1,dword ptr [0x00cdf0e4]
00891bf8 : COMISS XMM1,XMM0
00891bfb : JC 0x00891c17
00891bfd : CMP byte ptr [EDI + 0x1668],0x0
00891c04 : JNZ 0x00891c20
00891c06 : MOVSS dword ptr [EDI + 0x1650],XMM2
00891c0e : MOV AL,0x1
00891c10 : POP EDI
00891c11 : POP ESI
00891c12 : POP EBX
00891c13 : MOV ESP,EBP
00891c15 : POP EBP
00891c16 : RET
00891c17 : CMP byte ptr [EDI + 0x1668],0x0
00891c1e : JZ 0x00891c34
00891c20 : MOVSS XMM3,dword ptr [ESP + 0x14]
00891c26 : COMISS XMM3,dword ptr [EDI + 0x1658]
00891c2d : JBE 0x00891c34
00891c2f : COMISS XMM1,XMM0
00891c32 : JNC 0x00891c0e
00891c34 : SUB ESI,dword ptr [EDI + 0x1670]
00891c3a : CMP ESI,0x9c4
00891c40 : JA 0x00891c0e
00891c42 : MOVSS XMM0,dword ptr [EDI + 0x1570]
00891c4a : UCOMISS XMM0,XMM2
00891c4d : LAHF
00891c4e : TEST AH,0x44
00891c51 : JNP 0x00891c0e
00891c53 : POP EDI
00891c54 : POP ESI
00891c55 : XOR AL,AL
00891c57 : POP EBX
00891c58 : MOV ESP,EBP
00891c5a : POP EBP
00891c5b : RET
