PROGRAM  : Maestia.exe
FUNCTION : FUN_00a0f4c0
ENTRY    : 00a0f4c0
BODY     : [[00a0f4c0, 00a0f71d]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a0f4c0(int param_1,int param_2)

{
  uint uVar1;
  undefined4 ***pppuVar2;
  int iVar3;
  int in_ECX;
  int in_EDX;
  int iVar4;
  undefined4 local_444 [2];
  undefined4 **local_43c [4];
  undefined4 local_42c;
  uint local_428;
  undefined1 local_424 [520];
  undefined1 local_21c [520];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b25fcf;
  local_10 = ExceptionList;
  uVar1 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_43c[0] = (undefined4 **)((uint)local_43c[0] & 0xffff0000);
  local_428 = 7;
  local_42c = 0;
  local_14 = uVar1;
  FUN_00406360(L"Error_Report",0xc);
  local_8 = 0;
  pppuVar2 = (undefined4 ***)local_43c[0];
  if (local_428 < 8) {
    pppuVar2 = local_43c;
  }
  iVar3 = InternetOpenW(pppuVar2,0,0,0,0);
  *(int *)(in_ECX + 4) = iVar3;
  if (iVar3 == 0) {
    local_8 = 0xffffffff;
    if (7 < local_428) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0(uVar1);
    }
    local_428 = 7;
    local_42c = 0;
    local_43c[0] = (undefined4 **)((uint)local_43c[0] & 0xffff0000);
  }
  else {
    if (*(uint *)(in_EDX + 0x18) < 8) {
      iVar4 = in_EDX + 4;
    }
    else {
      iVar4 = *(int *)(in_EDX + 4);
    }
    if (*(uint *)(param_2 + 0x18) < 8) {
      param_2 = param_2 + 4;
    }
    else {
      param_2 = *(int *)(param_2 + 4);
    }
    if (*(uint *)(param_1 + 0x18) < 8) {
      param_1 = param_1 + 4;
    }
    else {
      param_1 = *(int *)(param_1 + 4);
    }
    iVar3 = InternetConnectW(iVar3,param_1,0x15,param_2,iVar4,1,0x8000000,0);
    *(int *)(in_ECX + 8) = iVar3;
    if (iVar3 == 0) {
      InternetCloseHandle(*(undefined4 *)(in_ECX + 4));
      local_8 = 0xffffffff;
      if (7 < local_428) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0(uVar1);
      }
      local_428 = 7;
      local_42c = 0;
      local_43c[0] = (undefined4 **)((uint)local_43c[0] & 0xffff0000);
    }
    else {
      local_444[0] = 0x104;
      _memset(local_424,0,0x104);
      iVar3 = FtpGetCurrentDirectoryW(iVar3,local_424,local_444);
      if (iVar3 == 1) {
        _memset(local_21c,0,0x104);
        FUN_0040e4a0(L"%sClient_Dump",local_424);
        iVar3 = FtpSetCurrentDirectoryW(*(undefined4 *)(in_ECX + 8),local_21c);
        if (iVar3 != 0) {
          FUN_00405c00(in_ECX + 0xc);
        }
        local_8 = 0xffffffff;
        FUN_00406560();
      }
      else {
        GetLastError();
        InternetCloseHandle(*(undefined4 *)(in_ECX + 8));
        InternetCloseHandle(*(undefined4 *)(in_ECX + 4));
        local_8 = 0xffffffff;
        FUN_00406560();
      }
    }
  }
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00a0f4c0 : PUSH EBP
00a0f4c1 : MOV EBP,ESP
00a0f4c3 : PUSH -0x1
00a0f4c5 : PUSH 0xb25fcf
00a0f4ca : MOV EAX,FS:[0x0]
00a0f4d0 : PUSH EAX
00a0f4d1 : SUB ESP,0x438
00a0f4d7 : MOV EAX,[0x00d66fa0]
00a0f4dc : XOR EAX,EBP
00a0f4de : MOV dword ptr [EBP + -0x10],EAX
00a0f4e1 : PUSH EBX
00a0f4e2 : PUSH ESI
00a0f4e3 : PUSH EDI
00a0f4e4 : PUSH EAX
00a0f4e5 : LEA EAX,[EBP + -0xc]
00a0f4e8 : MOV FS:[0x0],EAX
00a0f4ee : MOV EAX,dword ptr [EBP + 0x8]
00a0f4f1 : MOV EBX,dword ptr [EBP + 0xc]
00a0f4f4 : MOV EDI,ECX
00a0f4f6 : XOR ECX,ECX
00a0f4f8 : PUSH 0xc
00a0f4fa : MOV word ptr [EBP + 0xfffffbc8],CX
00a0f501 : PUSH 0xcbd81c
00a0f506 : LEA ECX,[EBP + 0xfffffbc4]
00a0f50c : MOV dword ptr [EBP + 0xfffffbbc],EAX
00a0f512 : MOV ESI,EDX
00a0f514 : MOV dword ptr [EBP + 0xfffffbdc],0x7
00a0f51e : MOV dword ptr [EBP + 0xfffffbd8],0x0
00a0f528 : CALL 0x00406360
00a0f52d : MOV dword ptr [EBP + -0x4],0x0
00a0f534 : CMP dword ptr [EBP + 0xfffffbdc],0x8
00a0f53b : MOV EAX,dword ptr [EBP + 0xfffffbc8]
00a0f541 : JNC 0x00a0f549
00a0f543 : LEA EAX,[EBP + 0xfffffbc8]
00a0f549 : PUSH 0x0
00a0f54b : PUSH 0x0
00a0f54d : PUSH 0x0
00a0f54f : PUSH 0x0
00a0f551 : PUSH EAX
00a0f552 : CALL dword ptr [0x00b85584]
00a0f558 : MOV dword ptr [EDI + 0x4],EAX
00a0f55b : TEST EAX,EAX
00a0f55d : JNZ 0x00a0f59c
00a0f55f : MOV dword ptr [EBP + -0x4],0xffffffff
00a0f566 : CMP dword ptr [EBP + 0xfffffbdc],0x8
00a0f56d : JC 0x00a0f57a
00a0f56f : MOV ECX,dword ptr [EBP + 0xfffffbc8]
00a0f575 : CALL 0x006f04e0
00a0f57a : XOR EDX,EDX
00a0f57c : MOV dword ptr [EBP + 0xfffffbdc],0x7
00a0f586 : MOV dword ptr [EBP + 0xfffffbd8],0x0
00a0f590 : MOV word ptr [EBP + 0xfffffbc8],DX
00a0f597 : JMP 0x00a0f6fe
00a0f59c : MOV EDX,0x8
00a0f5a1 : CMP dword ptr [ESI + 0x18],EDX
00a0f5a4 : JC 0x00a0f5ab
00a0f5a6 : MOV ESI,dword ptr [ESI + 0x4]
00a0f5a9 : JMP 0x00a0f5ae
00a0f5ab : ADD ESI,0x4
00a0f5ae : CMP dword ptr [EBX + 0x18],EDX
00a0f5b1 : JC 0x00a0f5b8
00a0f5b3 : MOV EBX,dword ptr [EBX + 0x4]
00a0f5b6 : JMP 0x00a0f5bb
00a0f5b8 : ADD EBX,0x4
00a0f5bb : MOV ECX,dword ptr [EBP + 0xfffffbbc]
00a0f5c1 : CMP dword ptr [ECX + 0x18],EDX
00a0f5c4 : JC 0x00a0f5cb
00a0f5c6 : MOV ECX,dword ptr [ECX + 0x4]
00a0f5c9 : JMP 0x00a0f5ce
00a0f5cb : ADD ECX,0x4
00a0f5ce : PUSH 0x0
00a0f5d0 : PUSH 0x8000000
00a0f5d5 : PUSH 0x1
00a0f5d7 : PUSH ESI
00a0f5d8 : PUSH EBX
00a0f5d9 : PUSH 0x15
00a0f5db : PUSH ECX
00a0f5dc : PUSH EAX
00a0f5dd : CALL dword ptr [0x00b85588]
00a0f5e3 : MOV ESI,EAX
00a0f5e5 : MOV dword ptr [EDI + 0x8],ESI
00a0f5e8 : TEST ESI,ESI
00a0f5ea : JNZ 0x00a0f633
00a0f5ec : MOV EAX,dword ptr [EDI + 0x4]
00a0f5ef : PUSH EAX
00a0f5f0 : CALL dword ptr [0x00b8558c]
00a0f5f6 : MOV dword ptr [EBP + -0x4],0xffffffff
00a0f5fd : CMP dword ptr [EBP + 0xfffffbdc],0x8
00a0f604 : JC 0x00a0f611
00a0f606 : MOV ECX,dword ptr [EBP + 0xfffffbc8]
00a0f60c : CALL 0x006f04e0
00a0f611 : XOR ECX,ECX
00a0f613 : MOV dword ptr [EBP + 0xfffffbdc],0x7
00a0f61d : MOV dword ptr [EBP + 0xfffffbd8],0x0
00a0f627 : MOV word ptr [EBP + 0xfffffbc8],CX
00a0f62e : JMP 0x00a0f6fe
00a0f633 : PUSH 0x104
00a0f638 : LEA EDX,[EBP + 0xfffffbe0]
00a0f63e : PUSH 0x0
00a0f640 : PUSH EDX
00a0f641 : MOV dword ptr [EBP + 0xfffffbc0],0x104
00a0f64b : CALL 0x0063b700
00a0f650 : ADD ESP,0xc
00a0f653 : LEA EAX,[EBP + 0xfffffbc0]
00a0f659 : PUSH EAX
00a0f65a : LEA ECX,[EBP + 0xfffffbe0]
00a0f660 : PUSH ECX
00a0f661 : PUSH ESI
00a0f662 : CALL dword ptr [0x00b85580]
00a0f668 : CMP EAX,0x1
00a0f66b : JNZ 0x00a0f6d4
00a0f66d : PUSH 0x104
00a0f672 : LEA EDX,[EBP + 0xfffffde8]
00a0f678 : PUSH 0x0
00a0f67a : PUSH EDX
00a0f67b : CALL 0x0063b700
00a0f680 : LEA EAX,[EBP + 0xfffffbe0]
00a0f686 : PUSH EAX
00a0f687 : PUSH 0xcbd838
00a0f68c : LEA EDX,[EBP + 0xfffffde8]
00a0f692 : CALL 0x0040e4a0
00a0f697 : MOV EDX,dword ptr [EDI + 0x8]
00a0f69a : ADD ESP,0x14
00a0f69d : LEA ECX,[EBP + 0xfffffde8]
00a0f6a3 : PUSH ECX
00a0f6a4 : PUSH EDX
00a0f6a5 : CALL dword ptr [0x00b8557c]
00a0f6ab : TEST EAX,EAX
00a0f6ad : JZ 0x00a0f6be
00a0f6af : ADD EDI,0xc
00a0f6b2 : PUSH EDI
00a0f6b3 : LEA EDX,[EBP + 0xfffffde8]
00a0f6b9 : CALL 0x00405c00
00a0f6be : MOV dword ptr [EBP + -0x4],0xffffffff
00a0f6c5 : LEA ECX,[EBP + 0xfffffbc4]
00a0f6cb : CALL 0x00406560
00a0f6d0 : MOV AL,0x1
00a0f6d2 : JMP 0x00a0f700
00a0f6d4 : CALL dword ptr [0x00b85128]
00a0f6da : MOV EAX,dword ptr [EDI + 0x8]
00a0f6dd : MOV ESI,dword ptr [0x00b8558c]
00a0f6e3 : PUSH EAX
00a0f6e4 : CALL ESI
00a0f6e6 : MOV ECX,dword ptr [EDI + 0x4]
00a0f6e9 : PUSH ECX
00a0f6ea : CALL ESI
00a0f6ec : MOV dword ptr [EBP + -0x4],0xffffffff
00a0f6f3 : LEA ECX,[EBP + 0xfffffbc4]
00a0f6f9 : CALL 0x00406560
00a0f6fe : XOR AL,AL
00a0f700 : MOV ECX,dword ptr [EBP + -0xc]
00a0f703 : MOV dword ptr FS:[0x0],ECX
00a0f70a : POP ECX
00a0f70b : POP EDI
00a0f70c : POP ESI
00a0f70d : POP EBX
00a0f70e : MOV ECX,dword ptr [EBP + -0x10]
00a0f711 : XOR ECX,EBP
00a0f713 : CALL 0x00633e6b
00a0f718 : MOV ESP,EBP
00a0f71a : POP EBP
00a0f71b : RET 0x8
