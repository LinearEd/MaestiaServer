PROGRAM  : Maestia.exe
FUNCTION : FUN_0067e4e0
ENTRY    : 0067e4e0
BODY     : [[0067e4e0, 0067e737]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0067e4e0(void)

{
  short sVar1;
  UnwindMapEntry *pUVar2;
  GRefCountImpl *this;
  HIMC pHVar3;
  DWORD dwBufLen;
  LPVOID lpBuf;
  int iVar4;
  LONG LVar5;
  int in_ECX;
  int unaff_EBX;
  int iVar6;
  int *unaff_retaddr;
  undefined4 uStack_14;
  uint uStack_10;
  undefined4 uStack_c;
  
  this = (GRefCountImpl *)(**(code **)(*(int *)(*(int *)(in_ECX + 4) + 8) + 0xc))(0x1b);
  uStack_14 = 0;
  uStack_10 = 0;
  pHVar3 = ImmGetContext(*(HWND *)(in_ECX + 0x14));
  dwBufLen = ImmGetCompositionStringW(pHVar3,8,(LPVOID)0x0,0);
  lpBuf = (LPVOID)FUN_00515840(dwBufLen * 2 + 2,0);
  ImmGetCompositionStringW(pHVar3,8,lpBuf,dwBufLen);
  iVar6 = (int)dwBufLen / 2;
  iVar4 = 0;
  *(undefined2 *)((int)lpBuf + iVar6 * 2) = 0;
  if (0 < iVar6) {
    do {
      sVar1 = *(short *)((int)lpBuf + iVar4 * 2);
      if ((sVar1 == 0x20) || (sVar1 == 0x3000)) {
        *(undefined2 *)((int)lpBuf + iVar4 * 2) = 0xa0;
      }
      iVar4 = iVar4 + 1;
    } while (iVar4 < iVar6);
  }
  pUVar2 = *(UnwindMapEntry **)(unaff_EBX + 0x5c);
  if ((int)pUVar2 < 0x101) {
    if (pUVar2 != (UnwindMapEntry *)0x100) {
      switch(pUVar2) {
      case (UnwindMapEntry *)0x1:
      case (UnwindMapEntry *)0x3:
      case (UnwindMapEntry *)0x5:
      case (UnwindMapEntry *)0x7:
        goto switchD_0067e59d_caseD_1;
      case (UnwindMapEntry *)0x2:
      case (UnwindMapEntry *)0x4:
      case (UnwindMapEntry *)0x6:
        break;
      default:
        goto switchD_0067e59d_default;
      }
    }
  }
  else if ((int)pUVar2 < 0x110001) {
    if (pUVar2 == (UnwindMapEntry *)0x110000) {
LAB_0067e66a:
      FUN_005973b0(lpBuf,0xffffffff);
      *unaff_retaddr = iVar6;
      LVar5 = ImmGetCompositionStringW(pHVar3,0x80,(LPVOID)0x0,0);
      FUN_00597400(LVar5);
      *(int *)(unaff_EBX + 0x34) = iVar6 - LVar5;
      FUN_00597440(0,iVar6,0,0);
      goto switchD_0067e59d_default;
    }
    if ((int)pUVar2 < 0x20001) {
      if (pUVar2 != (UnwindMapEntry *)0x20000) {
        if ((int)pUVar2 < 0x401) {
          if (((pUVar2 != (UnwindMapEntry *)0x400) && (pUVar2 != (UnwindMapEntry *)0x200)) &&
             (pUVar2 != (UnwindMapEntry *)0x300)) goto switchD_0067e59d_default;
          goto switchD_0067e59d_caseD_2;
        }
        if (pUVar2 != (UnwindMapEntry *)0x10000) goto switchD_0067e59d_default;
      }
switchD_0067e59d_caseD_1:
      FUN_005973b0(&DAT_00cca49c,0xffffffff);
      *unaff_retaddr = 0;
      goto switchD_0067e59d_default;
    }
    if ((int)pUVar2 < 0x60001) {
      if ((pUVar2 == (UnwindMapEntry *)0x60000) || (pUVar2 == (UnwindMapEntry *)0x30000))
      goto switchD_0067e59d_caseD_1;
      if (pUVar2 != (UnwindMapEntry *)0x40000) goto switchD_0067e59d_default;
    }
    else if (pUVar2 != (UnwindMapEntry *)0x70000) goto switchD_0067e59d_default;
  }
  else {
    if ((int)pUVar2 < 0xc10001) {
      if (pUVar2 != (UnwindMapEntry *)0xc10000) {
        if ((int)pUVar2 < 0x810001) {
          if (((pUVar2 != (UnwindMapEntry *)FUN_00810000) && (pUVar2 != (UnwindMapEntry *)0x210000))
             && (pUVar2 != (UnwindMapEntry *)0x410000)) goto switchD_0067e59d_default;
        }
        else if (pUVar2 != (UnwindMapEntry *)0x910000) goto switchD_0067e59d_default;
      }
      goto LAB_0067e66a;
    }
    if ((int)pUVar2 < 0xd00801) {
      if (pUVar2 != (UnwindMapEntry *)0xd00800) {
        if (pUVar2 == (UnwindMapEntry *)0xd00001) goto switchD_0067e59d_caseD_1;
        if (pUVar2 != (UnwindMapEntry *)0xd00002) goto switchD_0067e59d_default;
      }
    }
    else if (pUVar2 != &UnwindMapEntry_00d00900) goto switchD_0067e59d_default;
  }
switchD_0067e59d_caseD_2:
  FUN_005973b0(lpBuf,0xffffffff);
  *unaff_retaddr = iVar6;
switchD_0067e59d_default:
  ImmReleaseContext(*(HWND *)(unaff_EBX + 0x14),pHVar3);
  if (lpBuf != (LPVOID)0x0) {
    FUN_00515cf0(lpBuf);
  }
  if ((uStack_10 >> 6 & 1) != 0) {
    FUN_00588b40(&uStack_14,uStack_c);
    uStack_14 = 0;
  }
  if (this != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release(this);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
0067e4e0 : SUB ESP,0x18
0067e4e3 : PUSH EBX
0067e4e4 : PUSH EBP
0067e4e5 : PUSH ESI
0067e4e6 : MOV ESI,ECX
0067e4e8 : MOV ECX,dword ptr [ESI + 0x4]
0067e4eb : MOV EAX,dword ptr [ECX + 0x8]
0067e4ee : MOV EDX,dword ptr [EAX + 0xc]
0067e4f1 : ADD ECX,0x8
0067e4f4 : PUSH EDI
0067e4f5 : PUSH 0x1b
0067e4f7 : MOV dword ptr [ESP + 0x14],ESI
0067e4fb : CALL EDX
0067e4fd : MOV EBP,EAX
0067e4ff : MOV EAX,dword ptr [ESI + 0x14]
0067e502 : XOR EDI,EDI
0067e504 : PUSH EAX
0067e505 : MOV dword ptr [ESP + 0x1c],EDI
0067e509 : MOV dword ptr [ESP + 0x20],EDI
0067e50d : CALL 0x00611450
0067e512 : PUSH EDI
0067e513 : PUSH EDI
0067e514 : MOV EBX,EAX
0067e516 : PUSH 0x8
0067e518 : PUSH EBX
0067e519 : MOV dword ptr [ESP + 0x24],EBX
0067e51d : CALL 0x00685b84
0067e522 : MOV ESI,EAX
0067e524 : PUSH EDI
0067e525 : LEA ECX,[ESI + ESI*0x1 + 0x2]
0067e529 : PUSH ECX
0067e52a : MOV ECX,dword ptr [0x00d73250]
0067e530 : CALL 0x00515840
0067e535 : PUSH ESI
0067e536 : MOV EDI,EAX
0067e538 : PUSH EDI
0067e539 : PUSH 0x8
0067e53b : PUSH EBX
0067e53c : CALL 0x00685b84
0067e541 : MOV EAX,ESI
0067e543 : CDQ
0067e544 : SUB EAX,EDX
0067e546 : MOV ESI,EAX
0067e548 : SAR ESI,0x1
0067e54a : XOR EDX,EDX
0067e54c : XOR EAX,EAX
0067e54e : MOV word ptr [EDI + ESI*0x2],DX
0067e552 : TEST ESI,ESI
0067e554 : JLE 0x0067e578
0067e556 : MOVZX ECX,word ptr [EDI + EAX*0x2]
0067e55a : CMP CX,0x20
0067e55e : JZ 0x0067e56a
0067e560 : MOV EDX,0x3000
0067e565 : CMP CX,DX
0067e568 : JNZ 0x0067e573
0067e56a : MOV ECX,0xa0
0067e56f : MOV word ptr [EDI + EAX*0x2],CX
0067e573 : INC EAX
0067e574 : CMP EAX,ESI
0067e576 : JL 0x0067e556
0067e578 : MOV EDX,dword ptr [ESP + 0x10]
0067e57c : MOV EAX,dword ptr [EDX + 0x5c]
0067e57f : CMP EAX,0x100
0067e584 : JG 0x0067e5a4
0067e586 : JZ 0x0067e6d4
0067e58c : DEC EAX
0067e58d : CMP EAX,0x6
0067e590 : JA 0x0067e6e4
0067e596 : MOVZX EAX,byte ptr [EAX + 0x67e740]
0067e59d : JMP dword ptr [EAX*0x4 + 0x67e738]
0067e5a4 : CMP EAX,0x110000
0067e5a9 : JG 0x0067e63e
0067e5af : JZ 0x0067e66a
0067e5b5 : CMP EAX,0x20000
0067e5ba : JG 0x0067e60e
0067e5bc : JZ 0x0067e5f1
0067e5be : CMP EAX,0x400
0067e5c3 : JG 0x0067e5e6
0067e5c5 : JZ 0x0067e6d4
0067e5cb : CMP EAX,0x200
0067e5d0 : JZ 0x0067e6d4
0067e5d6 : CMP EAX,0x300
0067e5db : JZ 0x0067e6d4
0067e5e1 : JMP 0x0067e6e4
0067e5e6 : CMP EAX,0x10000
0067e5eb : JNZ 0x0067e6e4
0067e5f1 : PUSH -0x1
0067e5f3 : PUSH 0xcca49c
0067e5f8 : MOV ECX,EBP
0067e5fa : CALL 0x005973b0
0067e5ff : MOV ECX,dword ptr [ESP + 0x2c]
0067e603 : MOV dword ptr [ECX],0x0
0067e609 : JMP 0x0067e6e4
0067e60e : CMP EAX,0x60000
0067e613 : JG 0x0067e62e
0067e615 : JZ 0x0067e5f1
0067e617 : CMP EAX,0x30000
0067e61c : JZ 0x0067e5f1
0067e61e : CMP EAX,0x40000
0067e623 : JZ 0x0067e6d4
0067e629 : JMP 0x0067e6e4
0067e62e : CMP EAX,0x70000
0067e633 : JZ 0x0067e6d4
0067e639 : JMP 0x0067e6e4
0067e63e : CMP EAX,0xc10000
0067e643 : JG 0x0067e6b2
0067e645 : JZ 0x0067e66a
0067e647 : CMP EAX,0x810000
0067e64c : JG 0x0067e663
0067e64e : JZ 0x0067e66a
0067e650 : CMP EAX,0x210000
0067e655 : JZ 0x0067e66a
0067e657 : CMP EAX,0x410000
0067e65c : JZ 0x0067e66a
0067e65e : JMP 0x0067e6e4
0067e663 : CMP EAX,0x910000
0067e668 : JNZ 0x0067e6e4
0067e66a : PUSH -0x1
0067e66c : PUSH EDI
0067e66d : MOV ECX,EBP
0067e66f : CALL 0x005973b0
0067e674 : MOV ECX,dword ptr [ESP + 0x2c]
0067e678 : PUSH 0x0
0067e67a : PUSH 0x0
0067e67c : PUSH 0x80
0067e681 : PUSH EBX
0067e682 : MOV dword ptr [ECX],ESI
0067e684 : CALL 0x00685b84
0067e689 : MOV EBX,EAX
0067e68b : PUSH EBX
0067e68c : MOV ECX,EBP
0067e68e : CALL 0x00597400
0067e693 : MOV EAX,dword ptr [ESP + 0x10]
0067e697 : PUSH 0x0
0067e699 : PUSH 0x0
0067e69b : MOV EDX,ESI
0067e69d : PUSH ESI
0067e69e : SUB EDX,EBX
0067e6a0 : PUSH 0x0
0067e6a2 : MOV ECX,EBP
0067e6a4 : MOV dword ptr [EAX + 0x34],EDX
0067e6a7 : CALL 0x00597440
0067e6ac : MOV EBX,dword ptr [ESP + 0x14]
0067e6b0 : JMP 0x0067e6e4
0067e6b2 : CMP EAX,0xd00800
0067e6b7 : JG 0x0067e6cd
0067e6b9 : JZ 0x0067e6d4
0067e6bb : SUB EAX,0xd00001
0067e6c0 : JZ 0x0067e5f1
0067e6c6 : SUB EAX,0x1
0067e6c9 : JZ 0x0067e6d4
0067e6cb : JMP 0x0067e6e4
0067e6cd : CMP EAX,0xd00900
0067e6d2 : JNZ 0x0067e6e4
0067e6d4 : PUSH -0x1
0067e6d6 : PUSH EDI
0067e6d7 : MOV ECX,EBP
0067e6d9 : CALL 0x005973b0
0067e6de : MOV EDX,dword ptr [ESP + 0x2c]
0067e6e2 : MOV dword ptr [EDX],ESI
0067e6e4 : MOV EAX,dword ptr [ESP + 0x10]
0067e6e8 : MOV ECX,dword ptr [EAX + 0x14]
0067e6eb : PUSH EBX
0067e6ec : PUSH ECX
0067e6ed : CALL 0x00611462
0067e6f2 : TEST EDI,EDI
0067e6f4 : JZ 0x0067e6fc
0067e6f6 : PUSH EDI
0067e6f7 : CALL 0x00515cf0
0067e6fc : MOV EDX,dword ptr [ESP + 0x1c]
0067e700 : SHR EDX,0x6
0067e703 : TEST DL,0x1
0067e706 : JZ 0x0067e723
0067e708 : MOV EAX,dword ptr [ESP + 0x20]
0067e70c : PUSH EAX
0067e70d : LEA ECX,[ESP + 0x1c]
0067e711 : PUSH ECX
0067e712 : MOV ECX,dword ptr [ESP + 0x20]
0067e716 : CALL 0x00588b40
0067e71b : MOV dword ptr [ESP + 0x18],0x0
0067e723 : TEST EBP,EBP
0067e725 : JZ 0x0067e72e
0067e727 : MOV ECX,EBP
0067e729 : CALL 0x004ff7e0
0067e72e : POP EDI
0067e72f : POP ESI
0067e730 : POP EBP
0067e731 : POP EBX
0067e732 : ADD ESP,0x18
0067e735 : RET 0x4
