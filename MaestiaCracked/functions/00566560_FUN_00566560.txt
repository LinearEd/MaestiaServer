PROGRAM  : Maestia.exe
FUNCTION : FUN_00566560
ENTRY    : 00566560
BODY     : [[00566560, 0056658a] [00566590, 005666e2]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00566560(int *param_1)

{
  undefined4 *puVar1;
  int iVar2;
  GRefCountImpl *this;
  int in_ECX;
  int *piVar3;
  int iVar4;
  uint *puVar5;
  uint uVar6;
  int *piVar7;
  uint uVar8;
  uint local_14;
  int local_8;
  int local_4;
  
  iVar4 = 0;
  local_14 = 0;
  if (param_1[1] != 0) {
    do {
      puVar5 = (uint *)(*param_1 + iVar4);
      local_8 = 0;
      local_4 = in_ECX + 0x18;
      iVar2 = FUN_00515840(0x40,0);
      if (iVar2 == 0) {
        this = (GRefCountImpl *)0x0;
      }
      else {
        this = (GRefCountImpl *)FUN_005e4530((*puVar5 & 0xfffffffc) + 8,0);
      }
      *(uint *)(this + 0x14) = *(uint *)(this + 0x14) | 0x40;
      iVar2 = FUN_00515840(0x2c,0);
      if (iVar2 == 0) {
        iVar2 = 0;
      }
      else {
        iVar2 = FUN_005e03a0(this,in_ECX + 0x18);
      }
      if (local_8 != 0) {
        FUN_00524240();
      }
      local_8 = iVar2;
      FUN_00565eb0(puVar5[1],&local_8,(*puVar5 & 0xfffffffc) + 8);
      GRefCountImpl::Release(this);
      if (local_8 != 0) {
        FUN_00524240();
      }
      local_14 = local_14 + 1;
      iVar4 = iVar4 + 0xc;
    } while (local_14 < (uint)param_1[1]);
  }
  EnterCriticalSection((LPCRITICAL_SECTION)(in_ECX + 0x50));
  piVar7 = (int *)(in_ECX + 0x44);
  uVar6 = *(int *)(in_ECX + 0x48) + 1;
  if (uVar6 < *(uint *)(in_ECX + 0x48)) {
    iVar4 = *(uint *)(in_ECX + 0x48) - uVar6;
    piVar3 = (int *)(*piVar7 + -4 + (iVar4 + uVar6) * 4);
    for (; iVar4 != 0; iVar4 = iVar4 + -1) {
      if (*piVar3 != 0) {
        FUN_00524240();
      }
      piVar3 = piVar3 + -1;
    }
    uVar8 = uVar6;
    if (*(uint *)(in_ECX + 0x4c) >> 1 <= uVar6) goto LAB_005666bd;
  }
  else {
    if (uVar6 < *(uint *)(in_ECX + 0x4c)) goto LAB_005666bd;
    uVar8 = (uVar6 >> 2) + uVar6;
  }
  FUN_00561d60(piVar7,uVar8);
LAB_005666bd:
  puVar1 = (undefined4 *)(*piVar7 + -4 + uVar6 * 4);
  *(uint *)(in_ECX + 0x48) = uVar6;
  if (puVar1 != (undefined4 *)0x0) {
    *puVar1 = 0;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)(in_ECX + 0x50));
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00566560 : SUB ESP,0x14
00566563 : MOV EAX,dword ptr [ESP + 0x18]
00566567 : MOV EAX,dword ptr [EAX + 0x4]
0056656a : PUSH EBX
0056656b : PUSH EBP
0056656c : PUSH ESI
0056656d : XOR EBP,EBP
0056656f : PUSH EDI
00566570 : MOV EDI,ECX
00566572 : MOV dword ptr [ESP + 0x14],EDI
00566576 : MOV dword ptr [ESP + 0x10],EBP
0056657a : CMP EAX,EBP
0056657c : JBE 0x0056665a
00566582 : LEA EBX,[EDI + 0x18]
00566585 : MOV dword ptr [ESP + 0x18],EBX
00566589 : JMP 0x00566594
00566590 : MOV EBX,dword ptr [ESP + 0x18]
00566594 : MOV ECX,dword ptr [ESP + 0x28]
00566598 : MOV ESI,dword ptr [ECX]
0056659a : MOV ECX,dword ptr [0x00d73250]
005665a0 : PUSH 0x0
005665a2 : PUSH 0x40
005665a4 : ADD ESI,EBP
005665a6 : MOV dword ptr [ESP + 0x24],0x0
005665ae : MOV dword ptr [ESP + 0x28],EBX
005665b2 : CALL 0x00515840
005665b7 : TEST EAX,EAX
005665b9 : JZ 0x005665d1
005665bb : MOV EDX,dword ptr [ESI]
005665bd : AND EDX,0xfffffffc
005665c0 : PUSH 0x0
005665c2 : ADD EDX,0x8
005665c5 : PUSH EDX
005665c6 : MOV ECX,EAX
005665c8 : CALL 0x005e4530
005665cd : MOV EDI,EAX
005665cf : JMP 0x005665d3
005665d1 : XOR EDI,EDI
005665d3 : OR dword ptr [EDI + 0x14],0x40
005665d7 : MOV ECX,dword ptr [0x00d73250]
005665dd : PUSH 0x0
005665df : PUSH 0x2c
005665e1 : CALL 0x00515840
005665e6 : TEST EAX,EAX
005665e8 : JZ 0x005665f7
005665ea : PUSH EBX
005665eb : PUSH EDI
005665ec : MOV ECX,EAX
005665ee : CALL 0x005e03a0
005665f3 : MOV EBX,EAX
005665f5 : JMP 0x005665f9
005665f7 : XOR EBX,EBX
005665f9 : MOV ECX,dword ptr [ESP + 0x1c]
005665fd : TEST ECX,ECX
005665ff : JZ 0x00566606
00566601 : CALL 0x00524240
00566606 : MOV dword ptr [ESP + 0x1c],EBX
0056660a : MOV EAX,dword ptr [ESI]
0056660c : AND EAX,0xfffffffc
0056660f : ADD EAX,0x8
00566612 : PUSH EAX
00566613 : LEA EDX,[ESP + 0x20]
00566617 : PUSH EDX
00566618 : PUSH ECX
00566619 : MOV ECX,dword ptr [ESI + 0x4]
0056661c : MOV EAX,ESP
0056661e : MOV dword ptr [EAX],ECX
00566620 : MOV ECX,dword ptr [ESP + 0x20]
00566624 : CALL 0x00565eb0
00566629 : MOV ECX,EDI
0056662b : CALL 0x004ff7e0
00566630 : MOV ECX,dword ptr [ESP + 0x1c]
00566634 : TEST ECX,ECX
00566636 : JZ 0x0056663d
00566638 : CALL 0x00524240
0056663d : MOV EAX,dword ptr [ESP + 0x10]
00566641 : MOV EDX,dword ptr [ESP + 0x28]
00566645 : INC EAX
00566646 : ADD EBP,0xc
00566649 : MOV dword ptr [ESP + 0x10],EAX
0056664d : CMP EAX,dword ptr [EDX + 0x4]
00566650 : JC 0x00566590
00566656 : MOV EDI,dword ptr [ESP + 0x14]
0056665a : LEA EBP,[EDI + 0x50]
0056665d : PUSH EBP
0056665e : MOV dword ptr [ESP + 0x2c],EBP
00566662 : CALL dword ptr [0x00b85118]
00566668 : MOV ESI,dword ptr [EDI + 0x48]
0056666b : MOV EAX,dword ptr [EDI + 0x48]
0056666e : ADD EDI,0x44
00566671 : INC ESI
00566672 : CMP ESI,EAX
00566674 : JNC 0x005666a8
00566676 : MOV EDX,dword ptr [EDI]
00566678 : SUB EAX,ESI
0056667a : LEA ECX,[EAX + ESI*0x1]
0056667d : LEA EBX,[EDX + ECX*0x4 + -0x4]
00566681 : JZ 0x0056669c
00566683 : MOV EBP,EAX
00566685 : MOV ECX,dword ptr [EBX]
00566687 : TEST ECX,ECX
00566689 : JZ 0x00566690
0056668b : CALL 0x00524240
00566690 : SUB EBX,0x4
00566693 : SUB EBP,0x1
00566696 : JNZ 0x00566685
00566698 : MOV EBP,dword ptr [ESP + 0x28]
0056669c : MOV EAX,dword ptr [EDI + 0x8]
0056669f : SHR EAX,0x1
005666a1 : CMP ESI,EAX
005666a3 : JNC 0x005666bd
005666a5 : PUSH ESI
005666a6 : JMP 0x005666b5
005666a8 : CMP ESI,dword ptr [EDI + 0x8]
005666ab : JC 0x005666bd
005666ad : MOV ECX,ESI
005666af : SHR ECX,0x2
005666b2 : ADD ECX,ESI
005666b4 : PUSH ECX
005666b5 : PUSH EDI
005666b6 : MOV ECX,EDI
005666b8 : CALL 0x00561d60
005666bd : MOV EDX,dword ptr [EDI]
005666bf : LEA EAX,[EDX + ESI*0x4 + -0x4]
005666c3 : MOV dword ptr [EDI + 0x4],ESI
005666c6 : TEST EAX,EAX
005666c8 : JZ 0x005666d0
005666ca : MOV dword ptr [EAX],0x0
005666d0 : PUSH EBP
005666d1 : CALL dword ptr [0x00b8511c]
005666d7 : POP EDI
005666d8 : POP ESI
005666d9 : POP EBP
005666da : MOV AL,0x1
005666dc : POP EBX
005666dd : ADD ESP,0x14
005666e0 : RET 0x4
