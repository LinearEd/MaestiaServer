PROGRAM  : Maestia.exe
FUNCTION : FUN_00407e00
ENTRY    : 00407e00
BODY     : [[00407e00, 00407f48] [00407f4c, 00407f5a]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00407e00(void)

{
  void *pvVar1;
  rsize_t _DstSize;
  uint uVar2;
  undefined4 *_Dst;
  int iVar3;
  int iVar4;
  uint uVar5;
  int unaff_ESI;
  undefined4 *puVar6;
  undefined4 *puVar7;
  uint local_8;
  
  uVar2 = *(uint *)(unaff_ESI + 0x14);
  local_8 = 1;
  if (uVar2 == 0x15555555) {
    uVar2 = FUN_00476830();
  }
  uVar5 = uVar2 >> 1;
  if (uVar5 < 8) {
    uVar5 = 8;
  }
  else if (uVar5 < 2) goto LAB_00407e48;
  if (uVar2 <= 0x15555555 - uVar5) {
    local_8 = uVar5;
  }
LAB_00407e48:
  uVar2 = *(uint *)(unaff_ESI + 0x18);
  _Dst = (undefined4 *)FUN_004c1790();
  iVar4 = uVar2 * 4;
  pvVar1 = (void *)(*(int *)(unaff_ESI + 0x10) + iVar4);
  iVar3 = (*(int *)(unaff_ESI + 0x14) * 4 - (int)pvVar1) + *(int *)(unaff_ESI + 0x10) >> 2;
  puVar7 = _Dst + uVar2 + iVar3;
  if (iVar3 != 0) {
    _memmove_s(_Dst + uVar2,iVar3 * 4,pvVar1,iVar3 * 4);
  }
  if (local_8 < uVar2) {
    iVar3 = (int)(local_8 * 4) >> 2;
    if (iVar3 != 0) {
      _DstSize = iVar3 * 4;
      _memmove_s(puVar7,_DstSize,*(void **)(unaff_ESI + 0x10),_DstSize);
    }
    pvVar1 = (void *)(*(int *)(unaff_ESI + 0x10) + local_8 * 4);
    iVar4 = (*(int *)(unaff_ESI + 0x10) - (int)pvVar1) + iVar4 >> 2;
    puVar7 = _Dst + iVar4;
    uVar2 = local_8;
    if (iVar4 != 0) {
      _memmove_s(_Dst,iVar4 * 4,pvVar1,iVar4 * 4);
    }
  }
  else {
    iVar4 = iVar4 >> 2;
    puVar6 = puVar7 + iVar4;
    if (iVar4 != 0) {
      _memmove_s(puVar7,iVar4 * 4,*(void **)(unaff_ESI + 0x10),iVar4 * 4);
    }
    iVar4 = local_8 - uVar2;
    puVar7 = _Dst;
    if (iVar4 != 0) {
      for (; iVar4 != 0; iVar4 = iVar4 + -1) {
        *puVar6 = 0;
        puVar6 = puVar6 + 1;
      }
    }
  }
  if (uVar2 != 0) {
    for (; uVar2 != 0; uVar2 = uVar2 - 1) {
      *puVar7 = 0;
      puVar7 = puVar7 + 1;
    }
  }
  if (*(int *)(unaff_ESI + 0x10) == 0) {
    *(int *)(unaff_ESI + 0x14) = *(int *)(unaff_ESI + 0x14) + local_8;
    *(undefined4 **)(unaff_ESI + 0x10) = _Dst;
    return;
  }
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
00407e00 : PUSH EBP
00407e01 : MOV EBP,ESP
00407e03 : SUB ESP,0x10
00407e06 : MOV EAX,dword ptr [ESI + 0x14]
00407e09 : MOV ECX,0x15555555
00407e0e : MOV EDX,0x1
00407e13 : SUB ECX,EAX
00407e15 : PUSH EBX
00407e16 : PUSH EDI
00407e17 : MOV dword ptr [EBP + -0x4],EDX
00407e1a : CMP ECX,EDX
00407e1c : JNC 0x00407e23
00407e1e : CALL 0x00476830
00407e23 : MOV ECX,EAX
00407e25 : SHR ECX,0x1
00407e27 : CMP ECX,0x8
00407e2a : JNC 0x00407e33
00407e2c : MOV ECX,0x8
00407e31 : JMP 0x00407e38
00407e33 : CMP ECX,0x1
00407e36 : JBE 0x00407e48
00407e38 : MOV EDI,0x15555555
00407e3d : SUB EDI,ECX
00407e3f : CMP EAX,EDI
00407e41 : JA 0x00407e48
00407e43 : MOV EDX,ECX
00407e45 : MOV dword ptr [EBP + -0x4],ECX
00407e48 : MOV EDI,dword ptr [ESI + 0x18]
00407e4b : LEA ECX,[EAX + EDX*0x1]
00407e4e : MOV dword ptr [EBP + -0xc],EDI
00407e51 : CALL 0x004c1790
00407e56 : MOV ECX,dword ptr [ESI + 0x10]
00407e59 : MOV dword ptr [EBP + -0x8],EAX
00407e5c : ADD EDI,EDI
00407e5e : ADD EDI,EDI
00407e60 : LEA EDX,[EDI + EAX*0x1]
00407e63 : MOV EAX,dword ptr [ESI + 0x14]
00407e66 : ADD EAX,EAX
00407e68 : LEA EBX,[ECX + EDI*0x1]
00407e6b : ADD EAX,EAX
00407e6d : SUB EAX,EBX
00407e6f : ADD EAX,ECX
00407e71 : SAR EAX,0x2
00407e74 : LEA ECX,[EAX*0x4 + 0x0]
00407e7b : MOV dword ptr [EBP + -0x10],EBX
00407e7e : LEA EBX,[ECX + EDX*0x1]
00407e81 : TEST EAX,EAX
00407e83 : JBE 0x00407e94
00407e85 : MOV EAX,dword ptr [EBP + -0x10]
00407e88 : PUSH ECX
00407e89 : PUSH EAX
00407e8a : PUSH ECX
00407e8b : PUSH EDX
00407e8c : CALL 0x00634101
00407e91 : ADD ESP,0x10
00407e94 : MOV EDX,dword ptr [EBP + -0x4]
00407e97 : MOV ECX,dword ptr [ESI + 0x10]
00407e9a : CMP dword ptr [EBP + -0xc],EDX
00407e9d : JA 0x00407ee3
00407e9f : MOV EAX,ECX
00407ea1 : SUB EAX,ECX
00407ea3 : ADD EAX,EDI
00407ea5 : SAR EAX,0x2
00407ea8 : LEA EDI,[EAX*0x4 + 0x0]
00407eaf : LEA EDX,[EDI + EBX*0x1]
00407eb2 : MOV dword ptr [EBP + -0x10],EDX
00407eb5 : TEST EAX,EAX
00407eb7 : JBE 0x00407ec5
00407eb9 : PUSH EDI
00407eba : PUSH ECX
00407ebb : PUSH EDI
00407ebc : PUSH EBX
00407ebd : CALL 0x00634101
00407ec2 : ADD ESP,0x10
00407ec5 : MOV EDX,dword ptr [EBP + -0x4]
00407ec8 : MOV EBX,dword ptr [EBP + -0xc]
00407ecb : MOV ECX,EDX
00407ecd : SUB ECX,EBX
00407ecf : JZ 0x00407ed8
00407ed1 : MOV EDI,dword ptr [EBP + -0x10]
00407ed4 : XOR EAX,EAX
00407ed6 : STOSD.REP ES:EDI
00407ed8 : TEST EBX,EBX
00407eda : JBE 0x00407f3d
00407edc : MOV EDI,dword ptr [EBP + -0x8]
00407edf : MOV ECX,EBX
00407ee1 : JMP 0x00407f39
00407ee3 : LEA EAX,[EDX*0x4 + 0x0]
00407eea : SAR EAX,0x2
00407eed : TEST EAX,EAX
00407eef : JBE 0x00407f04
00407ef1 : ADD EAX,EAX
00407ef3 : ADD EAX,EAX
00407ef5 : PUSH EAX
00407ef6 : PUSH ECX
00407ef7 : PUSH EAX
00407ef8 : PUSH EBX
00407ef9 : CALL 0x00634101
00407efe : MOV EDX,dword ptr [EBP + -0x4]
00407f01 : ADD ESP,0x10
00407f04 : MOV EAX,dword ptr [ESI + 0x10]
00407f07 : LEA EBX,[EAX + EDX*0x4]
00407f0a : SUB EAX,EBX
00407f0c : ADD EAX,EDI
00407f0e : MOV EDI,dword ptr [EBP + -0x8]
00407f11 : SAR EAX,0x2
00407f14 : LEA ECX,[EAX*0x4 + 0x0]
00407f1b : ADD EDI,ECX
00407f1d : TEST EAX,EAX
00407f1f : JBE 0x00407f33
00407f21 : MOV EAX,dword ptr [EBP + -0x8]
00407f24 : PUSH ECX
00407f25 : PUSH EBX
00407f26 : PUSH ECX
00407f27 : PUSH EAX
00407f28 : CALL 0x00634101
00407f2d : MOV EDX,dword ptr [EBP + -0x4]
00407f30 : ADD ESP,0x10
00407f33 : TEST EDX,EDX
00407f35 : JBE 0x00407f3d
00407f37 : MOV ECX,EDX
00407f39 : XOR EAX,EAX
00407f3b : STOSD.REP ES:EDI
00407f3d : MOV ECX,dword ptr [ESI + 0x10]
00407f40 : TEST ECX,ECX
00407f42 : JZ 0x00407f4c
00407f44 : CALL 0x006f04e0
00407f4c : MOV ECX,dword ptr [EBP + -0x8]
00407f4f : ADD dword ptr [ESI + 0x14],EDX
00407f52 : POP EDI
00407f53 : MOV dword ptr [ESI + 0x10],ECX
00407f56 : POP EBX
00407f57 : MOV ESP,EBP
00407f59 : POP EBP
00407f5a : RET
