PROGRAM  : Maestia.exe
FUNCTION : FUN_0055e1e0
ENTRY    : 0055e1e0
BODY     : [[0055e1e0, 0055e3c8]]

============================================================
DECOMPILED C CODE
============================================================

int * FUN_0055e1e0(undefined4 param_1,uint param_2,int *param_3)

{
  int *piVar1;
  int *piVar2;
  int *piVar3;
  int iVar4;
  undefined4 uVar5;
  uint in_ECX;
  int local_10;
  uint local_c;
  int local_8;
  uint local_4;
  
  piVar1 = param_3;
  local_8 = 0;
  if (param_3 != (int *)0x0) {
    local_8 = *param_3;
    FUN_0055c6d0("Searching for font: \"",param_1,&DAT_00b8c94c,param_2,&DAT_00cca874);
  }
  local_10 = 0;
  piVar2 = (int *)FUN_0055d810(param_1,param_2,&local_10,piVar1);
  if ((piVar2 == (int *)0x0) && (local_4 = param_2 & 3, local_4 != 0)) {
    local_c = param_2 & 0xfffffffc;
    if (piVar1 != (int *)0x0) {
      *piVar1 = *piVar1 + 1;
      FUN_0055c6d0("Searching for font: \"",param_1,&DAT_00b8c94c,local_c,&DAT_00cca874);
    }
    piVar3 = (int *)FUN_0055d810(param_1,local_c,0,piVar1);
    if (piVar3 != (int *)0x0) {
      param_3 = (int *)0x146;
      iVar4 = FUN_00515d60(in_ECX,0x1c,&param_3);
      if (iVar4 == 0) {
        piVar2 = (int *)0x0;
      }
      else {
        piVar2 = (int *)FUN_0055caf0(piVar3);
      }
      piVar2[2] = piVar2[2] | local_4;
      param_3 = piVar2;
      if (piVar1 == (int *)0x0) {
        FUN_0055d680(&param_3);
      }
      else {
        FUN_0055c770("Font \"",param_1,&DAT_00b8c94c,param_2," will be generated from \"",param_1,
                     &DAT_00b8ba98,local_c);
      }
      *piVar3 = *piVar3 + -1;
      if (*piVar3 == 0) {
        FUN_00500860();
        FUN_00515cf0(piVar3);
      }
    }
  }
  if (piVar1 != (int *)0x0) {
    *piVar1 = local_8;
  }
  if (piVar2 == (int *)0x0) {
    if (local_10 != 0) {
      FUN_0055c660("Empty font: \"",param_1,"\" is created");
      param_2 = 0x146;
      iVar4 = FUN_00515d60(in_ECX,0x1c,&param_2);
      if (iVar4 == 0) {
        piVar3 = (int *)0x0;
      }
      else {
        piVar3 = (int *)FUN_005007e0(~-(uint)(piVar1 != (int *)0x0) & in_ECX,local_10,param_1,0,0);
      }
      param_3 = piVar3;
      if (piVar1 == (int *)0x0) {
        uVar5 = FUN_0055c430(piVar3);
        FUN_0055d120(in_ECX + 8,&param_3,uVar5);
      }
      piVar2 = (int *)0x0;
      if (piVar3 != (int *)0x0) {
        return piVar3;
      }
    }
    FUN_0055c5d0("Font not found.");
  }
  return piVar2;
}



============================================================
DISASSEMBLY
============================================================
0055e1e0 : SUB ESP,0x10
0055e1e3 : PUSH EBX
0055e1e4 : PUSH EBP
0055e1e5 : PUSH ESI
0055e1e6 : MOV ESI,dword ptr [ESP + 0x20]
0055e1ea : PUSH EDI
0055e1eb : MOV EDI,dword ptr [ESP + 0x2c]
0055e1ef : XOR EBX,EBX
0055e1f1 : MOV EBP,ECX
0055e1f3 : MOV dword ptr [ESP + 0x18],EBX
0055e1f7 : CMP EDI,EBX
0055e1f9 : JZ 0x0055e220
0055e1fb : MOV ECX,dword ptr [ESP + 0x28]
0055e1ff : MOV EAX,dword ptr [EDI]
0055e201 : PUSH 0xcca874
0055e206 : PUSH ECX
0055e207 : PUSH 0xb8c94c
0055e20c : MOV dword ptr [ESP + 0x24],EAX
0055e210 : PUSH ESI
0055e211 : PUSH 0xb8c9d4
0055e216 : MOV EAX,EDI
0055e218 : CALL 0x0055c6d0
0055e21d : ADD ESP,0x14
0055e220 : MOV EAX,dword ptr [ESP + 0x28]
0055e224 : PUSH EDI
0055e225 : LEA EDX,[ESP + 0x14]
0055e229 : PUSH EDX
0055e22a : PUSH EAX
0055e22b : PUSH ESI
0055e22c : MOV ECX,EBP
0055e22e : MOV dword ptr [ESP + 0x20],EBX
0055e232 : CALL 0x0055d810
0055e237 : MOV EBX,EAX
0055e239 : TEST EBX,EBX
0055e23b : JNZ 0x0055e323
0055e241 : MOV EAX,dword ptr [ESP + 0x28]
0055e245 : MOV ECX,EAX
0055e247 : AND ECX,0x3
0055e24a : MOV dword ptr [ESP + 0x1c],ECX
0055e24e : JZ 0x0055e323
0055e254 : AND EAX,0xfffffffc
0055e257 : MOV dword ptr [ESP + 0x14],EAX
0055e25b : TEST EDI,EDI
0055e25d : JZ 0x0055e280
0055e25f : INC dword ptr [EDI]
0055e261 : PUSH 0xcca874
0055e266 : PUSH EAX
0055e267 : PUSH 0xb8c94c
0055e26c : PUSH ESI
0055e26d : PUSH 0xb8c9d4
0055e272 : MOV EAX,EDI
0055e274 : CALL 0x0055c6d0
0055e279 : MOV EAX,dword ptr [ESP + 0x28]
0055e27d : ADD ESP,0x14
0055e280 : PUSH EDI
0055e281 : PUSH 0x0
0055e283 : PUSH EAX
0055e284 : PUSH ESI
0055e285 : MOV ECX,EBP
0055e287 : CALL 0x0055d810
0055e28c : MOV dword ptr [ESP + 0x24],EAX
0055e290 : TEST EAX,EAX
0055e292 : JZ 0x0055e323
0055e298 : LEA ECX,[ESP + 0x2c]
0055e29c : PUSH ECX
0055e29d : PUSH 0x1c
0055e29f : PUSH EBP
0055e2a0 : MOV dword ptr [ESP + 0x38],0x146
0055e2a8 : CALL 0x00515d60
0055e2ad : TEST EAX,EAX
0055e2af : JZ 0x0055e2c1
0055e2b1 : MOV EDX,dword ptr [ESP + 0x24]
0055e2b5 : PUSH EDX
0055e2b6 : MOV ECX,EAX
0055e2b8 : CALL 0x0055caf0
0055e2bd : MOV EBX,EAX
0055e2bf : JMP 0x0055e2c3
0055e2c1 : XOR EBX,EBX
0055e2c3 : MOV EAX,dword ptr [ESP + 0x1c]
0055e2c7 : OR dword ptr [EBX + 0x8],EAX
0055e2ca : MOV dword ptr [ESP + 0x2c],EBX
0055e2ce : TEST EDI,EDI
0055e2d0 : JNZ 0x0055e2e1
0055e2d2 : LEA ECX,[ESP + 0x2c]
0055e2d6 : PUSH ECX
0055e2d7 : LEA ECX,[EBP + 0x8]
0055e2da : CALL 0x0055d680
0055e2df : JMP 0x0055e30b
0055e2e1 : MOV EDX,dword ptr [ESP + 0x14]
0055e2e5 : MOV EAX,dword ptr [ESP + 0x28]
0055e2e9 : PUSH EDX
0055e2ea : PUSH 0xb8ba98
0055e2ef : PUSH ESI
0055e2f0 : PUSH 0xb8c9b8
0055e2f5 : PUSH EAX
0055e2f6 : PUSH 0xb8c94c
0055e2fb : PUSH ESI
0055e2fc : PUSH 0xb8c9b0
0055e301 : MOV EAX,EDI
0055e303 : CALL 0x0055c770
0055e308 : ADD ESP,0x20
0055e30b : MOV ECX,dword ptr [ESP + 0x24]
0055e30f : ADD dword ptr [ECX],-0x1
0055e312 : JNZ 0x0055e323
0055e314 : CALL 0x00500860
0055e319 : MOV ECX,dword ptr [ESP + 0x24]
0055e31d : PUSH ECX
0055e31e : CALL 0x00515cf0
0055e323 : TEST EDI,EDI
0055e325 : JZ 0x0055e32d
0055e327 : MOV EDX,dword ptr [ESP + 0x18]
0055e32b : MOV dword ptr [EDI],EDX
0055e32d : TEST EBX,EBX
0055e32f : JNZ 0x0055e3bd
0055e335 : CMP dword ptr [ESP + 0x10],EBX
0055e339 : JZ 0x0055e3b0
0055e33b : PUSH 0xb8c9a0
0055e340 : PUSH ESI
0055e341 : PUSH 0xb8c990
0055e346 : MOV EAX,EDI
0055e348 : CALL 0x0055c660
0055e34d : ADD ESP,0xc
0055e350 : LEA EAX,[ESP + 0x28]
0055e354 : PUSH EAX
0055e355 : PUSH 0x1c
0055e357 : PUSH EBP
0055e358 : MOV dword ptr [ESP + 0x34],0x146
0055e360 : CALL 0x00515d60
0055e365 : TEST EAX,EAX
0055e367 : JZ 0x0055e387
0055e369 : MOV ECX,dword ptr [ESP + 0x10]
0055e36d : PUSH EBX
0055e36e : MOV EDX,EDI
0055e370 : NEG EDX
0055e372 : PUSH EBX
0055e373 : SBB EDX,EDX
0055e375 : PUSH ESI
0055e376 : NOT EDX
0055e378 : PUSH ECX
0055e379 : AND EDX,EBP
0055e37b : PUSH EDX
0055e37c : MOV ECX,EAX
0055e37e : CALL 0x005007e0
0055e383 : MOV EBX,EAX
0055e385 : JMP 0x0055e389
0055e387 : XOR EBX,EBX
0055e389 : MOV dword ptr [ESP + 0x2c],EBX
0055e38d : TEST EDI,EDI
0055e38f : JNZ 0x0055e3ac
0055e391 : PUSH EBX
0055e392 : LEA ECX,[ESP + 0x2c]
0055e396 : ADD EBP,0x8
0055e399 : CALL 0x0055c430
0055e39e : PUSH EAX
0055e39f : LEA EAX,[ESP + 0x30]
0055e3a3 : PUSH EAX
0055e3a4 : PUSH EBP
0055e3a5 : MOV ECX,EBP
0055e3a7 : CALL 0x0055d120
0055e3ac : TEST EBX,EBX
0055e3ae : JNZ 0x0055e3bd
0055e3b0 : PUSH 0xb8c980
0055e3b5 : CALL 0x0055c5d0
0055e3ba : ADD ESP,0x4
0055e3bd : POP EDI
0055e3be : POP ESI
0055e3bf : POP EBP
0055e3c0 : MOV EAX,EBX
0055e3c2 : POP EBX
0055e3c3 : ADD ESP,0x10
0055e3c6 : RET 0xc
