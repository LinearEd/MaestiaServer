PROGRAM  : Maestia.exe
FUNCTION : FUN_00592820
ENTRY    : 00592820
BODY     : [[00592820, 00592ae4]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00592820(void)

{
  int *piVar1;
  GRefCountNTSImpl *this;
  undefined4 uVar2;
  char cVar3;
  int iVar4;
  int in_ECX;
  uint uVar5;
  int *piVar6;
  uint uVar7;
  undefined4 *puVar8;
  int iVar9;
  int *piVar10;
  uint uVar11;
  uint uVar12;
  int *local_10;
  int *local_c;
  uint local_8;
  uint local_4;
  
  iVar9 = *(int *)(in_ECX + 0x1ac);
  if (iVar9 != 0) {
    uVar5 = 0;
    local_c = (int *)0x0;
    local_8 = 0;
    local_4 = 0;
    if (*(int *)(iVar9 + 0xc) != 0) {
      do {
        uVar12 = local_8;
        uVar7 = local_8 + 1;
        local_10 = (int *)(*(int *)(iVar9 + 8) + uVar5 * 4);
        if (uVar7 < local_8) {
          iVar9 = local_8 - uVar7;
          piVar6 = local_c + iVar9 + uVar7 + -1;
          for (; iVar9 != 0; iVar9 = iVar9 + -1) {
            if ((GRefCountNTSImpl *)*piVar6 != (GRefCountNTSImpl *)0x0) {
              GRefCountNTSImpl::Release((GRefCountNTSImpl *)*piVar6);
            }
            piVar6 = piVar6 + -1;
          }
          uVar11 = uVar7;
          if (uVar7 < local_4 >> 1) {
LAB_005928ab:
            FUN_0057c3a0(&local_c,uVar11);
          }
        }
        else if (local_4 <= uVar7) {
          uVar11 = (uVar7 >> 2) + uVar7;
          goto LAB_005928ab;
        }
        if (local_c + uVar12 != (int *)0x0) {
          if (*local_10 != 0) {
            piVar6 = (int *)(*local_10 + 4);
            *piVar6 = *piVar6 + 1;
          }
          local_c[uVar12] = *local_10;
        }
        iVar9 = *(int *)(in_ECX + 0x1ac);
        uVar5 = uVar5 + 1;
        local_8 = uVar7;
      } while (uVar5 < *(uint *)(iVar9 + 0xc));
    }
    uVar7 = 0;
    uVar5 = local_8;
    if (local_8 != 0) {
      do {
        piVar6 = local_c + uVar7;
        if (local_c[uVar7] != 0) {
          piVar10 = (int *)(local_c[uVar7] + 4);
          *piVar10 = *piVar10 + 1;
          uVar5 = local_8;
        }
        this = (GRefCountNTSImpl *)*piVar6;
        cVar3 = (**(code **)(**(int **)(this + 8) + 0x14))();
        if (cVar3 == '\0') {
          if (*(int *)(this + 0xc) != 0) {
            FUN_005f0780();
          }
          piVar10 = local_c;
          if (uVar5 == 1) {
            if ((GRefCountNTSImpl *)*local_c != (GRefCountNTSImpl *)0x0) {
              GRefCountNTSImpl::Release((GRefCountNTSImpl *)*local_c);
            }
            if ((local_4 & 0xfffffffe) != 0) {
              if (piVar10 != (int *)0x0) {
                FUN_00515cf0(piVar10);
                local_c = (int *)0x0;
              }
              local_4 = 0;
            }
            uVar5 = 0;
          }
          else {
            if ((GRefCountNTSImpl *)*piVar6 != (GRefCountNTSImpl *)0x0) {
              GRefCountNTSImpl::Release((GRefCountNTSImpl *)*piVar6);
            }
            _memcpy(piVar6,piVar6 + 1,(uVar5 - uVar7) * 4 - 4);
            uVar5 = uVar5 - 1;
          }
          uVar2 = *(undefined4 *)(in_ECX + 0xa0);
          local_10 = (int *)(CONCAT31(local_10._1_3_,(char)(*(uint *)(in_ECX + 0x8c) >> 0x13)) &
                            0xffffff01);
          local_8 = uVar5;
          iVar9 = FUN_0058ca10(local_10);
          if (iVar9 == -1) {
            FUN_0051d620(uVar2);
          }
          else if (iVar9 == 1) {
            FUN_0051d5a0(uVar2);
          }
        }
        else {
          uVar7 = uVar7 + 1;
        }
        GRefCountNTSImpl::Release(this);
      } while (uVar7 < uVar5);
    }
    if (*(int *)(in_ECX + 0x1ac) != 0) {
      FUN_005b64b0(*(int *)(in_ECX + 0x1ac) + 8,0);
      uVar7 = uVar5;
      piVar6 = local_c;
      for (; uVar7 != 0; uVar7 = uVar7 - 1) {
        iVar9 = *(int *)(in_ECX + 0x1ac);
        piVar10 = (int *)(iVar9 + 8);
        uVar5 = *(int *)(iVar9 + 0xc) + 1;
        if (uVar5 < *(uint *)(iVar9 + 0xc)) {
          iVar4 = *(uint *)(iVar9 + 0xc) - uVar5;
          puVar8 = (undefined4 *)(*piVar10 + -4 + (iVar4 + uVar5) * 4);
          for (; iVar4 != 0; iVar4 = iVar4 + -1) {
            if ((GRefCountNTSImpl *)*puVar8 != (GRefCountNTSImpl *)0x0) {
              GRefCountNTSImpl::Release((GRefCountNTSImpl *)*puVar8);
            }
            puVar8 = puVar8 + -1;
          }
          uVar12 = uVar5;
          if (uVar5 < *(uint *)(iVar9 + 0x10) >> 1) {
LAB_00592a78:
            FUN_005b5ef0(piVar10,uVar12);
          }
        }
        else if (*(uint *)(iVar9 + 0x10) <= uVar5) {
          uVar12 = (uVar5 >> 2) + uVar5;
          goto LAB_00592a78;
        }
        piVar10 = (int *)(*piVar10 + -4 + uVar5 * 4);
        *(uint *)(iVar9 + 0xc) = uVar5;
        if (piVar10 != (int *)0x0) {
          if (*piVar6 != 0) {
            piVar1 = (int *)(*piVar6 + 4);
            *piVar1 = *piVar1 + 1;
          }
          *piVar10 = *piVar6;
        }
        piVar6 = piVar6 + 1;
        uVar5 = local_8;
      }
    }
    piVar6 = local_c + (uVar5 - 1);
    for (; uVar5 != 0; uVar5 = uVar5 - 1) {
      if ((GRefCountNTSImpl *)*piVar6 != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release((GRefCountNTSImpl *)*piVar6);
      }
      piVar6 = piVar6 + -1;
    }
    FUN_00515cf0(local_c);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00592820 : SUB ESP,0x18
00592823 : MOV EAX,dword ptr [ECX + 0x1ac]
00592829 : PUSH ESI
0059282a : XOR ESI,ESI
0059282c : MOV dword ptr [ESP + 0x4],ECX
00592830 : CMP EAX,ESI
00592832 : JZ 0x00592ae0
00592838 : PUSH EBX
00592839 : PUSH EBP
0059283a : XOR EBX,EBX
0059283c : PUSH EDI
0059283d : MOV dword ptr [ESP + 0x1c],ESI
00592841 : MOV dword ptr [ESP + 0x20],ESI
00592845 : MOV dword ptr [ESP + 0x24],ESI
00592849 : CMP dword ptr [EAX + 0xc],ESI
0059284c : JBE 0x005928ef
00592852 : MOV EAX,dword ptr [EAX + 0x8]
00592855 : LEA EDI,[ESI + 0x1]
00592858 : LEA ECX,[EAX + EBX*0x4]
0059285b : MOV dword ptr [ESP + 0x18],ECX
0059285f : CMP EDI,ESI
00592861 : JNC 0x00592898
00592863 : MOV EAX,dword ptr [ESP + 0x1c]
00592867 : SUB ESI,EDI
00592869 : LEA EDX,[ESI + EDI*0x1]
0059286c : LEA EBP,[EAX + EDX*0x4 + -0x4]
00592870 : JZ 0x00592886
00592872 : MOV ECX,dword ptr [EBP]
00592875 : TEST ECX,ECX
00592877 : JZ 0x0059287e
00592879 : CALL 0x004ff7c0
0059287e : SUB EBP,0x4
00592881 : SUB ESI,0x1
00592884 : JNZ 0x00592872
00592886 : MOV ECX,dword ptr [ESP + 0x24]
0059288a : SHR ECX,0x1
0059288c : CMP EDI,ECX
0059288e : JNC 0x005928b4
00592890 : PUSH EDI
00592891 : LEA EDX,[ESP + 0x20]
00592895 : PUSH EDX
00592896 : JMP 0x005928ab
00592898 : CMP EDI,dword ptr [ESP + 0x24]
0059289c : JC 0x005928b4
0059289e : MOV EAX,EDI
005928a0 : SHR EAX,0x2
005928a3 : ADD EAX,EDI
005928a5 : PUSH EAX
005928a6 : LEA ECX,[ESP + 0x20]
005928aa : PUSH ECX
005928ab : LEA ECX,[ESP + 0x24]
005928af : CALL 0x0057c3a0
005928b4 : MOV EDX,dword ptr [ESP + 0x1c]
005928b8 : LEA ECX,[EDX + EDI*0x4 + -0x4]
005928bc : MOV ESI,EDI
005928be : MOV dword ptr [ESP + 0x20],ESI
005928c2 : TEST ECX,ECX
005928c4 : JZ 0x005928db
005928c6 : MOV EDX,dword ptr [ESP + 0x18]
005928ca : MOV EAX,dword ptr [EDX]
005928cc : TEST EAX,EAX
005928ce : JZ 0x005928d7
005928d0 : INC dword ptr [EAX + 0x4]
005928d3 : MOV ESI,dword ptr [ESP + 0x20]
005928d7 : MOV EAX,dword ptr [EDX]
005928d9 : MOV dword ptr [ECX],EAX
005928db : MOV ECX,dword ptr [ESP + 0x10]
005928df : MOV EAX,dword ptr [ECX + 0x1ac]
005928e5 : INC EBX
005928e6 : CMP EBX,dword ptr [EAX + 0xc]
005928e9 : JC 0x00592852
005928ef : XOR EBP,EBP
005928f1 : TEST ESI,ESI
005928f3 : JBE 0x005929ef
005928f9 : LEA ESP,[ESP]
00592900 : MOV EDX,dword ptr [ESP + 0x1c]
00592904 : MOV EAX,dword ptr [EDX + EBP*0x4]
00592907 : LEA EDI,[EDX + EBP*0x4]
0059290a : TEST EAX,EAX
0059290c : JZ 0x00592915
0059290e : INC dword ptr [EAX + 0x4]
00592911 : MOV ESI,dword ptr [ESP + 0x20]
00592915 : MOV EBX,dword ptr [EDI]
00592917 : MOV ECX,dword ptr [EBX + 0x8]
0059291a : MOV EAX,dword ptr [ECX]
0059291c : MOV EDX,dword ptr [EAX + 0x14]
0059291f : CALL EDX
00592921 : TEST AL,AL
00592923 : JNZ 0x005929df
00592929 : MOV ECX,dword ptr [EBX + 0xc]
0059292c : TEST ECX,ECX
0059292e : JZ 0x00592935
00592930 : CALL 0x005f0780
00592935 : CMP ESI,0x1
00592938 : JNZ 0x00592971
0059293a : MOV ESI,dword ptr [ESP + 0x1c]
0059293e : MOV ECX,dword ptr [ESI]
00592940 : TEST ECX,ECX
00592942 : JZ 0x00592949
00592944 : CALL 0x004ff7c0
00592949 : TEST dword ptr [ESP + 0x24],0xfffffffe
00592951 : JBE 0x0059296d
00592953 : TEST ESI,ESI
00592955 : JZ 0x00592965
00592957 : PUSH ESI
00592958 : CALL 0x00515cf0
0059295d : MOV dword ptr [ESP + 0x1c],0x0
00592965 : MOV dword ptr [ESP + 0x24],0x0
0059296d : XOR ESI,ESI
0059296f : JMP 0x00592996
00592971 : MOV ECX,dword ptr [EDI]
00592973 : TEST ECX,ECX
00592975 : JZ 0x0059297c
00592977 : CALL 0x004ff7c0
0059297c : MOV EAX,ESI
0059297e : SUB EAX,EBP
00592980 : LEA ECX,[EAX*0x4 + 0xfffffffc]
00592987 : PUSH ECX
00592988 : LEA EDX,[EDI + 0x4]
0059298b : PUSH EDX
0059298c : PUSH EDI
0059298d : CALL 0x0063ae40
00592992 : ADD ESP,0xc
00592995 : DEC ESI
00592996 : MOV ECX,dword ptr [ESP + 0x10]
0059299a : MOV EAX,dword ptr [ECX + 0x8c]
005929a0 : MOV EDI,dword ptr [ECX + 0xa0]
005929a6 : SHR EAX,0x13
005929a9 : AND AL,0x1
005929ab : MOV byte ptr [ESP + 0x18],AL
005929af : MOV EDX,dword ptr [ESP + 0x18]
005929b3 : PUSH EDX
005929b4 : MOV dword ptr [ESP + 0x24],ESI
005929b8 : CALL 0x0058ca10
005929bd : CMP EAX,-0x1
005929c0 : JZ 0x005929d3
005929c2 : CMP EAX,0x1
005929c5 : JNZ 0x005929e0
005929c7 : MOV ECX,dword ptr [ESP + 0x10]
005929cb : PUSH EDI
005929cc : CALL 0x0051d5a0
005929d1 : JMP 0x005929e0
005929d3 : MOV ECX,dword ptr [ESP + 0x10]
005929d7 : PUSH EDI
005929d8 : CALL 0x0051d620
005929dd : JMP 0x005929e0
005929df : INC EBP
005929e0 : MOV ECX,EBX
005929e2 : CALL 0x004ff7c0
005929e7 : CMP EBP,ESI
005929e9 : JC 0x00592900
005929ef : MOV EAX,dword ptr [ESP + 0x10]
005929f3 : MOV EAX,dword ptr [EAX + 0x1ac]
005929f9 : TEST EAX,EAX
005929fb : JZ 0x00592ab0
00592a01 : LEA ECX,[EAX + 0x8]
00592a04 : PUSH 0x0
00592a06 : PUSH ECX
00592a07 : CALL 0x005b64b0
00592a0c : TEST ESI,ESI
00592a0e : JBE 0x00592ab0
00592a14 : MOV EBX,dword ptr [ESP + 0x1c]
00592a18 : MOV dword ptr [ESP + 0x14],EBX
00592a1c : MOV dword ptr [ESP + 0x18],ESI
00592a20 : MOV ECX,dword ptr [ESP + 0x10]
00592a24 : MOV ESI,dword ptr [ECX + 0x1ac]
00592a2a : MOV EDI,dword ptr [ESI + 0xc]
00592a2d : MOV EAX,dword ptr [ESI + 0xc]
00592a30 : ADD ESI,0x8
00592a33 : INC EDI
00592a34 : CMP EDI,EAX
00592a36 : JNC 0x00592a6b
00592a38 : MOV ECX,dword ptr [ESI]
00592a3a : SUB EAX,EDI
00592a3c : LEA EDX,[EAX + EDI*0x1]
00592a3f : LEA EBP,[ECX + EDX*0x4 + -0x4]
00592a43 : JZ 0x00592a5f
00592a45 : MOV EBX,EAX
00592a47 : MOV ECX,dword ptr [EBP]
00592a4a : TEST ECX,ECX
00592a4c : JZ 0x00592a53
00592a4e : CALL 0x004ff7c0
00592a53 : SUB EBP,0x4
00592a56 : SUB EBX,0x1
00592a59 : JNZ 0x00592a47
00592a5b : MOV EBX,dword ptr [ESP + 0x14]
00592a5f : MOV EDX,dword ptr [ESI + 0x8]
00592a62 : SHR EDX,0x1
00592a64 : CMP EDI,EDX
00592a66 : JNC 0x00592a80
00592a68 : PUSH EDI
00592a69 : JMP 0x00592a78
00592a6b : CMP EDI,dword ptr [ESI + 0x8]
00592a6e : JC 0x00592a80
00592a70 : MOV EAX,EDI
00592a72 : SHR EAX,0x2
00592a75 : ADD EAX,EDI
00592a77 : PUSH EAX
00592a78 : PUSH ESI
00592a79 : MOV ECX,ESI
00592a7b : CALL 0x005b5ef0
00592a80 : MOV ECX,dword ptr [ESI]
00592a82 : LEA ECX,[ECX + EDI*0x4 + -0x4]
00592a86 : MOV dword ptr [ESI + 0x4],EDI
00592a89 : TEST ECX,ECX
00592a8b : JZ 0x00592a9a
00592a8d : MOV EAX,dword ptr [EBX]
00592a8f : TEST EAX,EAX
00592a91 : JZ 0x00592a96
00592a93 : INC dword ptr [EAX + 0x4]
00592a96 : MOV EDX,dword ptr [EBX]
00592a98 : MOV dword ptr [ECX],EDX
00592a9a : ADD EBX,0x4
00592a9d : SUB dword ptr [ESP + 0x18],0x1
00592aa2 : MOV dword ptr [ESP + 0x14],EBX
00592aa6 : JNZ 0x00592a20
00592aac : MOV ESI,dword ptr [ESP + 0x20]
00592ab0 : MOV EAX,dword ptr [ESP + 0x1c]
00592ab4 : LEA EDI,[EAX + ESI*0x4 + -0x4]
00592ab8 : TEST ESI,ESI
00592aba : JBE 0x00592ad3
00592abc : LEA ESP,[ESP]
00592ac0 : MOV ECX,dword ptr [EDI]
00592ac2 : TEST ECX,ECX
00592ac4 : JZ 0x00592acb
00592ac6 : CALL 0x004ff7c0
00592acb : SUB EDI,0x4
00592ace : SUB ESI,0x1
00592ad1 : JNZ 0x00592ac0
00592ad3 : MOV ECX,dword ptr [ESP + 0x1c]
00592ad7 : PUSH ECX
00592ad8 : CALL 0x00515cf0
00592add : POP EDI
00592ade : POP EBP
00592adf : POP EBX
00592ae0 : POP ESI
00592ae1 : ADD ESP,0x18
00592ae4 : RET
