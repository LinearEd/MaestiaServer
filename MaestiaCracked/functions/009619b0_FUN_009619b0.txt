PROGRAM  : Maestia.exe
FUNCTION : FUN_009619b0
ENTRY    : 009619b0
BODY     : [[009619b0, 00961bc6]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_009619b0(void)

{
  short sVar1;
  int iVar2;
  short *psVar3;
  int in_ECX;
  undefined4 ***pppuVar4;
  short *psVar5;
  int iVar6;
  undefined1 auStack_7c [4];
  int local_78;
  int local_74;
  undefined1 local_70 [4];
  undefined2 uStack_6c;
  undefined4 uStack_5c;
  uint uStack_58;
  undefined4 **appuStack_50 [4];
  undefined4 uStack_40;
  uint uStack_3c;
  undefined1 auStack_38 [4];
  undefined2 uStack_34;
  undefined4 uStack_24;
  uint uStack_20;
  uint local_1c;
  void *local_14;
  undefined1 *puStack_10;
  undefined4 uStack_c;
  
  uStack_c = 0xffffffff;
  puStack_10 = &LAB_00b53c30;
  local_14 = ExceptionList;
  local_1c = DAT_00d66fa0 ^ (uint)auStack_7c;
  ExceptionList = &local_14;
  local_78 = 0;
  local_74 = in_ECX;
  if (*(char *)(in_ECX + 0x4c) != '\0') {
    iVar6 = *DAT_00da9894;
    if ((iVar6 != 0) && (*(int *)(iVar6 + 0x114) != 0)) {
      (**(code **)**(undefined4 **)(iVar6 + 0x114))
                ("SetPosition",DAT_00d66fa0 ^ (uint)&stack0xffffff78);
    }
    *(undefined1 *)(in_ECX + 0x4c) = 0;
  }
  iVar6 = *(int *)(in_ECX + 0x40);
  if (iVar6 != *(int *)(in_ECX + 0x44)) {
    do {
      iVar2 = FUN_006f0c10(local_70,1);
      uStack_c = 0;
      if (*(uint *)(iVar2 + 0x18) < 8) {
        psVar5 = (short *)(iVar2 + 4);
      }
      else {
        psVar5 = *(short **)(iVar2 + 4);
      }
      uStack_34 = 0;
      uStack_20 = 7;
      uStack_24 = 0;
      psVar3 = psVar5;
      do {
        sVar1 = *psVar3;
        psVar3 = psVar3 + 1;
      } while (sVar1 != 0);
      FUN_00406360(psVar5,(int)psVar3 - (int)(psVar5 + 1) >> 1);
      uStack_c._0_1_ = 2;
      if (7 < uStack_58) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      uStack_6c = 0;
      uStack_58 = 7;
      uStack_5c = 0;
      uStack_3c = 7;
      uStack_40 = 0;
      appuStack_50[0] = (undefined4 **)((uint)appuStack_50[0] & 0xffff0000);
      FUN_00406360(&DAT_00c79a34,0);
      uStack_c = CONCAT31(uStack_c._1_3_,3);
      FUN_00848d40(auStack_38,0);
      FUN_00846540(0);
      iVar2 = *DAT_00da9894;
      if ((iVar2 != 0) && (*(int *)(iVar2 + 0x114) != 0)) {
        pppuVar4 = (undefined4 ***)appuStack_50[0];
        if (uStack_3c < 8) {
          pppuVar4 = appuStack_50;
        }
        (**(code **)(**(int **)(iVar2 + 0x114) + 4))
                  (*(int **)(iVar2 + 0x114),"AddTalkButtonText","%ls%ls%d",pppuVar4,L"0xe0c17e",
                   local_78);
      }
      uStack_c = CONCAT31(uStack_c._1_3_,2);
      if (7 < uStack_3c) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      uStack_3c = 7;
      uStack_40 = 0;
      appuStack_50[0] = (undefined4 **)((uint)appuStack_50[0] & 0xffff0000);
      uStack_c = 0xffffffff;
      if (7 < uStack_20) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      local_78 = local_78 + 1;
      iVar6 = iVar6 + 8;
      uStack_20 = 7;
      uStack_24 = 0;
      uStack_34 = 0;
    } while (iVar6 != *(int *)(local_74 + 0x44));
  }
  ExceptionList = local_14;
  __security_check_cookie(local_1c ^ (uint)auStack_7c);
  return;
}



============================================================
DISASSEMBLY
============================================================
009619b0 : PUSH EBP
009619b1 : MOV EBP,ESP
009619b3 : AND ESP,0xfffffff8
009619b6 : PUSH -0x1
009619b8 : PUSH 0xb53c30
009619bd : MOV EAX,FS:[0x0]
009619c3 : PUSH EAX
009619c4 : SUB ESP,0x68
009619c7 : MOV EAX,[0x00d66fa0]
009619cc : XOR EAX,ESP
009619ce : MOV dword ptr [ESP + 0x60],EAX
009619d2 : PUSH EBX
009619d3 : PUSH ESI
009619d4 : PUSH EDI
009619d5 : MOV EAX,[0x00d66fa0]
009619da : XOR EAX,ESP
009619dc : PUSH EAX
009619dd : LEA EAX,[ESP + 0x78]
009619e1 : MOV FS:[0x0],EAX
009619e7 : MOV ESI,ECX
009619e9 : XOR EBX,EBX
009619eb : MOV dword ptr [ESP + 0x18],ESI
009619ef : MOV dword ptr [ESP + 0x14],EBX
009619f3 : CMP byte ptr [ESI + 0x4c],BL
009619f6 : JZ 0x00961a21
009619f8 : MOV EAX,[0x00da9894]
009619fd : MOV EAX,dword ptr [EAX]
009619ff : CMP EAX,EBX
00961a01 : JZ 0x00961a1e
00961a03 : CMP dword ptr [EAX + 0x114],EBX
00961a09 : JZ 0x00961a1e
00961a0b : MOV EAX,dword ptr [EAX + 0x114]
00961a11 : MOV EDX,dword ptr [EAX]
00961a13 : MOV ECX,EAX
00961a15 : MOV EAX,dword ptr [EDX]
00961a17 : PUSH 0xc79a28
00961a1c : CALL EAX
00961a1e : MOV byte ptr [ESI + 0x4c],BL
00961a21 : MOV EDI,dword ptr [ESI + 0x40]
00961a24 : CMP EDI,dword ptr [ESI + 0x44]
00961a27 : JZ 0x00961ba9
00961a2d : LEA ECX,[ECX]
00961a30 : MOV EDX,dword ptr [EDI + 0x4]
00961a33 : PUSH 0x1
00961a35 : LEA ECX,[ESP + 0x20]
00961a39 : PUSH ECX
00961a3a : MOV ECX,0x1724628
00961a3f : CALL 0x006f0c10
00961a44 : MOV dword ptr [ESP + 0x80],EBX
00961a4b : CMP dword ptr [EAX + 0x18],0x8
00961a4f : JC 0x00961a56
00961a51 : MOV EDX,dword ptr [EAX + 0x4]
00961a54 : JMP 0x00961a59
00961a56 : LEA EDX,[EAX + 0x4]
00961a59 : XOR EAX,EAX
00961a5b : MOV word ptr [ESP + 0x58],AX
00961a60 : MOV EAX,EDX
00961a62 : MOV dword ptr [ESP + 0x6c],0x7
00961a6a : MOV dword ptr [ESP + 0x68],EBX
00961a6e : LEA ESI,[EAX + 0x2]
00961a71 : MOV CX,word ptr [EAX]
00961a74 : ADD EAX,0x2
00961a77 : CMP CX,BX
00961a7a : JNZ 0x00961a71
00961a7c : SUB EAX,ESI
00961a7e : SAR EAX,0x1
00961a80 : PUSH EAX
00961a81 : PUSH EDX
00961a82 : LEA ECX,[ESP + 0x5c]
00961a86 : CALL 0x00406360
00961a8b : MOV byte ptr [ESP + 0x80],0x2
00961a93 : CMP dword ptr [ESP + 0x34],0x8
00961a98 : JC 0x00961aa3
00961a9a : MOV ECX,dword ptr [ESP + 0x20]
00961a9e : CALL 0x006f04e0
00961aa3 : XOR ECX,ECX
00961aa5 : PUSH EBX
00961aa6 : MOV ESI,0x7
00961aab : MOV word ptr [ESP + 0x24],CX
00961ab0 : XOR EDX,EDX
00961ab2 : PUSH 0xc79a34
00961ab7 : LEA ECX,[ESP + 0x40]
00961abb : MOV dword ptr [ESP + 0x3c],ESI
00961abf : MOV dword ptr [ESP + 0x38],EBX
00961ac3 : MOV dword ptr [ESP + 0x58],ESI
00961ac7 : MOV dword ptr [ESP + 0x54],EBX
00961acb : MOV word ptr [ESP + 0x44],DX
00961ad0 : CALL 0x00406360
00961ad5 : MOV byte ptr [ESP + 0x80],0x3
00961add : PUSH EBX
00961ade : LEA EAX,[ESP + 0x58]
00961ae2 : PUSH EAX
00961ae3 : LEA ECX,[ESP + 0x40]
00961ae7 : CALL 0x00848d40
00961aec : PUSH EBX
00961aed : LEA ECX,[ESP + 0x3c]
00961af1 : CALL 0x00846540
00961af6 : MOV ECX,dword ptr [0x00da9894]
00961afc : MOV EAX,dword ptr [ECX]
00961afe : CMP EAX,EBX
00961b00 : JZ 0x00961b44
00961b02 : CMP dword ptr [EAX + 0x114],EBX
00961b08 : JZ 0x00961b44
00961b0a : CMP dword ptr [ESP + 0x50],0x8
00961b0f : MOV EAX,dword ptr [EAX + 0x114]
00961b15 : MOV ECX,dword ptr [ESP + 0x3c]
00961b19 : JNC 0x00961b1f
00961b1b : LEA ECX,[ESP + 0x3c]
00961b1f : MOV ESI,dword ptr [ESP + 0x14]
00961b23 : MOV EDX,dword ptr [EAX]
00961b25 : PUSH ESI
00961b26 : PUSH 0xc79a38
00961b2b : PUSH ECX
00961b2c : PUSH 0xc79a4c
00961b31 : PUSH 0xc79a58
00961b36 : PUSH EAX
00961b37 : MOV EAX,dword ptr [EDX + 0x4]
00961b3a : CALL EAX
00961b3c : ADD ESP,0x18
00961b3f : MOV ESI,0x7
00961b44 : MOV byte ptr [ESP + 0x80],0x2
00961b4c : CMP dword ptr [ESP + 0x50],0x8
00961b51 : JC 0x00961b5c
00961b53 : MOV ECX,dword ptr [ESP + 0x3c]
00961b57 : CALL 0x006f04e0
00961b5c : XOR ECX,ECX
00961b5e : MOV dword ptr [ESP + 0x50],ESI
00961b62 : MOV dword ptr [ESP + 0x4c],EBX
00961b66 : MOV word ptr [ESP + 0x3c],CX
00961b6b : MOV dword ptr [ESP + 0x80],0xffffffff
00961b76 : CMP dword ptr [ESP + 0x6c],0x8
00961b7b : JC 0x00961b86
00961b7d : MOV ECX,dword ptr [ESP + 0x58]
00961b81 : CALL 0x006f04e0
00961b86 : MOV EAX,dword ptr [ESP + 0x18]
00961b8a : INC dword ptr [ESP + 0x14]
00961b8e : XOR EDX,EDX
00961b90 : ADD EDI,0x8
00961b93 : MOV dword ptr [ESP + 0x6c],ESI
00961b97 : MOV dword ptr [ESP + 0x68],EBX
00961b9b : MOV word ptr [ESP + 0x58],DX
00961ba0 : CMP EDI,dword ptr [EAX + 0x44]
00961ba3 : JNZ 0x00961a30
00961ba9 : MOV ECX,dword ptr [ESP + 0x78]
00961bad : MOV dword ptr FS:[0x0],ECX
00961bb4 : POP ECX
00961bb5 : POP EDI
00961bb6 : POP ESI
00961bb7 : POP EBX
00961bb8 : MOV ECX,dword ptr [ESP + 0x60]
00961bbc : XOR ECX,ESP
00961bbe : CALL 0x00633e6b
00961bc3 : MOV ESP,EBP
00961bc5 : POP EBP
00961bc6 : RET
