PROGRAM  : Maestia.exe
FUNCTION : FUN_00520df0
ENTRY    : 00520df0
BODY     : [[00520df0, 00520f46]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00520df0(void)

{
  int *piVar1;
  int *piVar2;
  int iVar3;
  int *in_ECX;
  int *piStack_4;
  
  if (in_ECX[0x20] == 0) {
    piStack_4 = in_ECX;
    (**(code **)(*in_ECX + 0x40))();
    iVar3 = (**(code **)(in_ECX[0x1a] + 8))();
    if ((iVar3 == 2) && ((*(byte *)((int)in_ECX + 0x66) & 0x10) != 0)) {
      iVar3 = FUN_00515840(0x14,0);
      if (iVar3 == 0) {
        iVar3 = 0;
      }
      else {
        iVar3 = (**(code **)(*in_ECX + 0x58))();
        iVar3 = FUN_00520b80(*(int *)(iVar3 + 0x78) + 8,0,0);
      }
      piVar2 = (int *)in_ECX[0x20];
      if ((piVar2 != (int *)0x0) && (*piVar2 = *piVar2 + -1, *piVar2 < 1)) {
        piVar1 = (int *)(piVar2[4] + 8);
        *piVar1 = *piVar1 + -1;
        if (*piVar1 == 0) {
          FUN_00525340();
        }
        piVar1 = (int *)(piVar2[3] + 8);
        *piVar1 = *piVar1 + -1;
        if (*piVar1 == 0) {
          FUN_00525340();
        }
        piVar1 = (int *)(piVar2[2] + 8);
        *piVar1 = *piVar1 + -1;
        if (*piVar1 == 0) {
          FUN_00525340();
        }
        FUN_00515cf0(piVar2);
      }
      in_ECX[0x20] = iVar3;
      return iVar3;
    }
    FUN_005712b0(&piStack_4);
    iVar3 = FUN_00515840(0x14,0);
    if (iVar3 == 0) {
      iVar3 = 0;
    }
    else {
      iVar3 = FUN_00520b80(&piStack_4,in_ECX[8],in_ECX);
    }
    piVar2 = (int *)in_ECX[0x20];
    if ((piVar2 != (int *)0x0) && (*piVar2 = *piVar2 + -1, *piVar2 < 1)) {
      piVar1 = (int *)(piVar2[4] + 8);
      *piVar1 = *piVar1 + -1;
      if (*piVar1 == 0) {
        FUN_00525340();
      }
      piVar1 = (int *)(piVar2[3] + 8);
      *piVar1 = *piVar1 + -1;
      if (*piVar1 == 0) {
        FUN_00525340();
      }
      piVar1 = (int *)(piVar2[2] + 8);
      *piVar1 = *piVar1 + -1;
      if (*piVar1 == 0) {
        FUN_00525340();
      }
      FUN_00515cf0(piVar2);
    }
    piStack_4 = piStack_4 + 2;
    in_ECX[0x20] = iVar3;
    *piStack_4 = *piStack_4 + -1;
    if (*piStack_4 == 0) {
      FUN_00525340();
    }
  }
  return in_ECX[0x20];
}



============================================================
DISASSEMBLY
============================================================
00520df0 : PUSH ECX
00520df1 : PUSH EBX
00520df2 : PUSH EBP
00520df3 : PUSH ESI
00520df4 : PUSH EDI
00520df5 : MOV EDI,ECX
00520df7 : CMP dword ptr [EDI + 0x80],0x0
00520dfe : JNZ 0x00520f3b
00520e04 : MOV EAX,dword ptr [EDI]
00520e06 : MOV EDX,dword ptr [EAX + 0x40]
00520e09 : CALL EDX
00520e0b : LEA ECX,[EDI + 0x68]
00520e0e : MOV ESI,EAX
00520e10 : MOV EAX,dword ptr [ECX]
00520e12 : MOV EDX,dword ptr [EAX + 0x8]
00520e15 : CALL EDX
00520e17 : CMP EAX,0x2
00520e1a : JNZ 0x00520eac
00520e20 : TEST byte ptr [EDI + 0x66],0x10
00520e24 : JZ 0x00520eac
00520e2a : MOV ECX,dword ptr [ESI + 0x14]
00520e2d : PUSH 0x0
00520e2f : PUSH 0x14
00520e31 : CALL 0x00515840
00520e36 : MOV ESI,EAX
00520e38 : TEST ESI,ESI
00520e3a : JZ 0x00520e5b
00520e3c : MOV EAX,dword ptr [EDI]
00520e3e : MOV EDX,dword ptr [EAX + 0x58]
00520e41 : MOV ECX,EDI
00520e43 : CALL EDX
00520e45 : MOV EAX,dword ptr [EAX + 0x78]
00520e48 : PUSH 0x0
00520e4a : PUSH 0x0
00520e4c : ADD EAX,0x8
00520e4f : PUSH EAX
00520e50 : MOV ECX,ESI
00520e52 : CALL 0x00520b80
00520e57 : MOV EBP,EAX
00520e59 : JMP 0x00520e5d
00520e5b : XOR EBP,EBP
00520e5d : MOV ESI,dword ptr [EDI + 0x80]
00520e63 : TEST ESI,ESI
00520e65 : JZ 0x00520e9e
00520e67 : OR EBX,0xffffffff
00520e6a : ADD dword ptr [ESI],EBX
00520e6c : CMP dword ptr [ESI],0x0
00520e6f : JG 0x00520e9e
00520e71 : MOV ECX,dword ptr [ESI + 0x10]
00520e74 : ADD dword ptr [ECX + 0x8],EBX
00520e77 : JNZ 0x00520e7e
00520e79 : CALL 0x00525340
00520e7e : MOV ECX,dword ptr [ESI + 0xc]
00520e81 : ADD dword ptr [ECX + 0x8],EBX
00520e84 : JNZ 0x00520e8b
00520e86 : CALL 0x00525340
00520e8b : MOV ECX,dword ptr [ESI + 0x8]
00520e8e : ADD dword ptr [ECX + 0x8],EBX
00520e91 : JNZ 0x00520e98
00520e93 : CALL 0x00525340
00520e98 : PUSH ESI
00520e99 : CALL 0x00515cf0
00520e9e : MOV dword ptr [EDI + 0x80],EBP
00520ea4 : POP EDI
00520ea5 : POP ESI
00520ea6 : MOV EAX,EBP
00520ea8 : POP EBP
00520ea9 : POP EBX
00520eaa : POP ECX
00520eab : RET
00520eac : LEA EAX,[ESP + 0x10]
00520eb0 : PUSH EAX
00520eb1 : MOV ECX,ESI
00520eb3 : CALL 0x005712b0
00520eb8 : MOV ECX,dword ptr [ESI + 0x14]
00520ebb : PUSH 0x0
00520ebd : PUSH 0x14
00520ebf : CALL 0x00515840
00520ec4 : TEST EAX,EAX
00520ec6 : JZ 0x00520edd
00520ec8 : MOV ECX,dword ptr [EDI + 0x20]
00520ecb : PUSH EDI
00520ecc : PUSH ECX
00520ecd : LEA EDX,[ESP + 0x18]
00520ed1 : PUSH EDX
00520ed2 : MOV ECX,EAX
00520ed4 : CALL 0x00520b80
00520ed9 : MOV EBP,EAX
00520edb : JMP 0x00520edf
00520edd : XOR EBP,EBP
00520edf : MOV ESI,dword ptr [EDI + 0x80]
00520ee5 : OR EBX,0xffffffff
00520ee8 : TEST ESI,ESI
00520eea : JZ 0x00520f20
00520eec : ADD dword ptr [ESI],EBX
00520eee : CMP dword ptr [ESI],0x0
00520ef1 : JG 0x00520f20
00520ef3 : MOV ECX,dword ptr [ESI + 0x10]
00520ef6 : ADD dword ptr [ECX + 0x8],EBX
00520ef9 : JNZ 0x00520f00
00520efb : CALL 0x00525340
00520f00 : MOV ECX,dword ptr [ESI + 0xc]
00520f03 : ADD dword ptr [ECX + 0x8],EBX
00520f06 : JNZ 0x00520f0d
00520f08 : CALL 0x00525340
00520f0d : MOV ECX,dword ptr [ESI + 0x8]
00520f10 : ADD dword ptr [ECX + 0x8],EBX
00520f13 : JNZ 0x00520f1a
00520f15 : CALL 0x00525340
00520f1a : PUSH ESI
00520f1b : CALL 0x00515cf0
00520f20 : MOV EAX,dword ptr [ESP + 0x10]
00520f24 : MOV ECX,EAX
00520f26 : ADD EAX,0x8
00520f29 : MOV dword ptr [EDI + 0x80],EBP
00520f2f : ADD dword ptr [EAX],EBX
00520f31 : CMP dword ptr [EAX],0x0
00520f34 : JNZ 0x00520f3b
00520f36 : CALL 0x00525340
00520f3b : MOV EAX,dword ptr [EDI + 0x80]
00520f41 : POP EDI
00520f42 : POP ESI
00520f43 : POP EBP
00520f44 : POP EBX
00520f45 : POP ECX
00520f46 : RET
