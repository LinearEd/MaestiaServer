PROGRAM  : Maestia.exe
FUNCTION : __putwch_nolock
ENTRY    : 0065d56b
BODY     : [[0065d56b, 0065d62f]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    __putwch_nolock
   
   Library: Visual Studio 2008 Release */

wint_t __cdecl __putwch_nolock(wchar_t _WCh)

{
  wint_t wVar1;
  BOOL BVar2;
  DWORD DVar3;
  UINT CodePage;
  wchar_t *lpWideCharStr;
  int cchWideChar;
  CHAR *lpMultiByteStr;
  int cbMultiByte;
  LPCSTR lpDefaultChar;
  LPBOOL lpUsedDefaultChar;
  DWORD local_14;
  CHAR local_10 [8];
  uint local_8;
  
  local_8 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  if (DAT_00d68280 != 0) {
    if (DAT_00d686b4 == (HANDLE)0xfffffffe) {
      ___initconout();
    }
    if (DAT_00d686b4 == (HANDLE)0xffffffff) goto LAB_0065d617;
    BVar2 = WriteConsoleW(DAT_00d686b4,&_WCh,1,&local_14,(LPVOID)0x0);
    if (BVar2 != 0) {
      DAT_00d68280 = 1;
      goto LAB_0065d617;
    }
    if ((DAT_00d68280 != 2) || (DVar3 = GetLastError(), DVar3 != 0x78)) goto LAB_0065d617;
    DAT_00d68280 = 0;
  }
  lpUsedDefaultChar = (LPBOOL)0x0;
  lpDefaultChar = (LPCSTR)0x0;
  cbMultiByte = 5;
  lpMultiByteStr = local_10;
  cchWideChar = 1;
  lpWideCharStr = &_WCh;
  DVar3 = 0;
  CodePage = GetConsoleOutputCP();
  DVar3 = WideCharToMultiByte(CodePage,DVar3,lpWideCharStr,cchWideChar,lpMultiByteStr,cbMultiByte,
                              lpDefaultChar,lpUsedDefaultChar);
  if (DAT_00d686b4 != (HANDLE)0xffffffff) {
    WriteConsoleA(DAT_00d686b4,local_10,DVar3,&local_14,(LPVOID)0x0);
  }
LAB_0065d617:
  wVar1 = __security_check_cookie(local_8 ^ (uint)&stack0xfffffffc);
  return wVar1;
}



============================================================
DISASSEMBLY
============================================================
0065d56b : MOV EDI,EDI
0065d56d : PUSH EBP
0065d56e : MOV EBP,ESP
0065d570 : SUB ESP,0x10
0065d573 : MOV EAX,[0x00d66fa0]
0065d578 : XOR EAX,EBP
0065d57a : MOV dword ptr [EBP + -0x4],EAX
0065d57d : PUSH ESI
0065d57e : XOR ESI,ESI
0065d580 : CMP dword ptr [0x00d68280],ESI
0065d586 : JZ 0x0065d5d7
0065d588 : CMP dword ptr [0x00d686b4],-0x2
0065d58f : JNZ 0x0065d596
0065d591 : CALL 0x006602b9
0065d596 : MOV EAX,[0x00d686b4]
0065d59b : CMP EAX,-0x1
0065d59e : JNZ 0x0065d5a7
0065d5a0 : MOV EAX,0xffff
0065d5a5 : JMP 0x0065d617
0065d5a7 : PUSH ESI
0065d5a8 : LEA ECX,[EBP + -0x10]
0065d5ab : PUSH ECX
0065d5ac : PUSH 0x1
0065d5ae : LEA ECX,[EBP + 0x8]
0065d5b1 : PUSH ECX
0065d5b2 : PUSH EAX
0065d5b3 : CALL dword ptr [0x00b852a8]
0065d5b9 : TEST EAX,EAX
0065d5bb : JNZ 0x0065d624
0065d5bd : CMP dword ptr [0x00d68280],0x2
0065d5c4 : JNZ 0x0065d5a0
0065d5c6 : CALL dword ptr [0x00b85128]
0065d5cc : CMP EAX,0x78
0065d5cf : JNZ 0x0065d5a0
0065d5d1 : MOV dword ptr [0x00d68280],ESI
0065d5d7 : PUSH ESI
0065d5d8 : PUSH ESI
0065d5d9 : PUSH 0x5
0065d5db : LEA EAX,[EBP + -0xc]
0065d5de : PUSH EAX
0065d5df : PUSH 0x1
0065d5e1 : LEA EAX,[EBP + 0x8]
0065d5e4 : PUSH EAX
0065d5e5 : PUSH ESI
0065d5e6 : CALL dword ptr [0x00b85364]
0065d5ec : PUSH EAX
0065d5ed : CALL dword ptr [0x00b85130]
0065d5f3 : MOV ECX,dword ptr [0x00d686b4]
0065d5f9 : CMP ECX,-0x1
0065d5fc : JZ 0x0065d5a0
0065d5fe : PUSH ESI
0065d5ff : LEA EDX,[EBP + -0x10]
0065d602 : PUSH EDX
0065d603 : PUSH EAX
0065d604 : LEA EAX,[EBP + -0xc]
0065d607 : PUSH EAX
0065d608 : PUSH ECX
0065d609 : CALL dword ptr [0x00b85360]
0065d60f : TEST EAX,EAX
0065d611 : JZ 0x0065d5a0
0065d613 : MOV AX,word ptr [EBP + 0x8]
0065d617 : MOV ECX,dword ptr [EBP + -0x4]
0065d61a : XOR ECX,EBP
0065d61c : POP ESI
0065d61d : CALL 0x00633e6b
0065d622 : LEAVE
0065d623 : RET
0065d624 : MOV dword ptr [0x00d68280],0x1
0065d62e : JMP 0x0065d613
