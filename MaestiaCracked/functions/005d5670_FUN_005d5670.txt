PROGRAM  : Maestia.exe
FUNCTION : FUN_005d5670
ENTRY    : 005d5670
BODY     : [[005d5670, 005d56fc] [005d5700, 005d57ea] [005d57f0, 005d59c6]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005d5670(ushort *param_1,uint param_2,float param_3)

{
  byte bVar1;
  uint uVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  undefined4 *puVar6;
  undefined4 *in_ECX;
  ushort uVar7;
  int iVar8;
  int iVar9;
  uint uVar10;
  uint uVar11;
  int iVar12;
  undefined2 in_FPUControlWord;
  float10 fVar13;
  float local_248;
  uint local_244;
  ushort local_240;
  ushort local_23e;
  ushort local_23c;
  undefined2 local_23a;
  ushort local_238;
  ushort local_236;
  undefined4 local_234;
  undefined4 *local_230;
  ushort *local_22c;
  undefined4 local_228;
  undefined4 local_224;
  uint local_220;
  uint local_21c;
  float local_218;
  int local_214;
  int local_210;
  int local_20c;
  undefined1 local_208 [2];
  ushort auStack_206 [257];
  uint local_4;
  
  local_4 = DAT_00d66fa0 ^ (uint)&local_248;
  if ((param_2 == 0) || (param_1 == (ushort *)0x0)) {
    local_238 = local_238 & 0xff00;
    local_234 = 0xff000000;
    param_1 = &local_238;
  }
  else if (1 < param_2) {
    local_218 = 1.0;
    local_230 = in_ECX;
    if (param_3 == 1.0) {
      uVar2 = 0;
      do {
        auStack_206[uVar2 + 1] = (ushort)((uVar2 & 0xffff) << 8) | (ushort)uVar2;
        uVar2 = uVar2 + 1;
      } while (uVar2 < 0x100);
    }
    else {
      uVar2 = 0;
      do {
        local_248 = (float)(int)uVar2;
        if ((int)uVar2 < 0) {
          local_248 = local_248 + 4.2949673e+09;
        }
        local_248 = local_248 / 255.0;
        local_21c = uVar2;
        fVar13 = (float10)FUN_0063cd40();
        local_248 = (float)fVar13 * 65535.0 + 0.5;
        fVar13 = (float10)FUN_0063bc90((double)local_248);
        local_244 = CONCAT22(local_244._2_2_,in_FPUControlWord);
        uVar2 = uVar2 + 1;
        local_248 = (float)(int)ROUND(fVar13);
        auStack_206[uVar2] = local_248._0_2_;
      } while (uVar2 < 0x100);
      local_218 = 1.0 / param_3;
    }
    uVar10 = (uint)(byte)*param_1;
    local_224 = *(undefined4 *)(param_1 + 2);
    uVar2 = uVar10;
    puVar6 = in_ECX;
    if (uVar10 != 0) {
      for (; in_ECX = local_230, uVar2 != 0; uVar2 = uVar2 - 1) {
        *puVar6 = local_224;
        puVar6 = puVar6 + 1;
      }
    }
    uVar2 = 0;
    if (1 < param_2) {
      local_22c = param_1 + 3;
      local_248 = (float)(param_2 - 1);
      do {
        local_244 = (uint)(byte)local_22c[1];
        if ((byte)local_22c[1] < uVar10) {
          local_244 = uVar10;
        }
        local_240 = auStack_206[(byte)*local_22c + 1];
        local_23e = auStack_206[*(byte *)((int)local_22c + -1) + 1];
        bVar1 = *(byte *)((int)local_22c + 1);
        local_238 = auStack_206[(byte)local_22c[4] + 1];
        local_23c = auStack_206[(byte)local_22c[-1] + 1];
        local_23a = CONCAT11(bVar1,bVar1);
        local_236 = auStack_206[*(byte *)((int)local_22c + 7) + 1];
        uVar7 = CONCAT11(*(byte *)((int)local_22c + 9),*(byte *)((int)local_22c + 9));
        uVar2 = local_244 - uVar10;
        local_234 = CONCAT22(uVar7,auStack_206[(byte)local_22c[3] + 1]);
        if (param_3 == 1.0) {
          if (uVar10 < local_244) {
            local_21c = (uint)uVar7 - (uint)CONCAT11(bVar1,bVar1);
            local_210 = (uint)auStack_206[(byte)local_22c[3] + 1] - (uint)local_23c;
            uVar2 = uVar2 * 0x100 | uVar2;
            local_20c = (uint)local_236 - (uint)local_23e;
            local_214 = (uint)local_238 - (uint)local_240;
            iVar8 = local_210;
            iVar9 = local_20c;
            uVar11 = uVar10;
            iVar12 = local_214;
            local_220 = local_21c;
            do {
              iVar3 = iVar12 / (int)uVar2;
              iVar12 = iVar12 + local_214;
              uVar10 = uVar11 + 1;
              iVar4 = iVar9 / (int)uVar2;
              iVar9 = iVar9 + local_20c;
              iVar5 = iVar8 / (int)uVar2;
              iVar8 = iVar8 + local_210;
              local_228 = CONCAT13((char)((int)local_220 / (int)uVar2) + bVar1,
                                   CONCAT21(CONCAT11((char)iVar3 + (char)local_240,
                                                     (char)iVar4 + (char)local_23e),
                                            (char)iVar5 + (char)local_23c));
              local_230[uVar11] = local_228;
              local_224 = local_228;
              local_220 = local_220 + local_21c;
              uVar11 = uVar10;
            } while (uVar10 < local_244);
          }
        }
        else if (uVar10 < local_244) {
          iVar8 = 1;
          do {
            puVar6 = (undefined4 *)
                     FUN_005d55b0(local_208,&local_240,&local_238,iVar8,uVar2,local_218);
            local_224 = *puVar6;
            local_230[uVar10] = local_224;
            uVar10 = uVar10 + 1;
            iVar8 = iVar8 + 1;
          } while (uVar10 < local_244);
        }
        local_22c = local_22c + 4;
        local_248 = (float)((int)local_248 + -1);
      } while (local_248 != 0.0);
      local_248 = 0.0;
      uVar2 = local_244;
      in_ECX = local_230;
      if (0xff < local_244) goto LAB_005d56c5;
    }
    puVar6 = in_ECX + uVar2;
    for (iVar8 = 0x100 - uVar2; iVar8 != 0; iVar8 = iVar8 + -1) {
      *puVar6 = local_224;
      puVar6 = puVar6 + 1;
    }
    goto LAB_005d56c5;
  }
  uVar2 = 0;
  do {
    in_ECX[uVar2] = *(undefined4 *)(param_1 + 2);
    uVar2 = uVar2 + 1;
  } while (uVar2 < 0x100);
LAB_005d56c5:
  __security_check_cookie(local_4 ^ (uint)&local_248);
  return;
}



============================================================
DISASSEMBLY
============================================================
005d5670 : SUB ESP,0x248
005d5676 : MOV EAX,[0x00d66fa0]
005d567b : XOR EAX,ESP
005d567d : MOV dword ptr [ESP + 0x244],EAX
005d5684 : PUSH EBX
005d5685 : MOV EBX,dword ptr [ESP + 0x250]
005d568c : PUSH EBP
005d568d : MOV EBP,dword ptr [ESP + 0x258]
005d5694 : PUSH ESI
005d5695 : PUSH EDI
005d5696 : MOV EDI,ECX
005d5698 : MOV dword ptr [ESP + 0x28],EDI
005d569c : TEST EBP,EBP
005d569e : JZ 0x005d56a4
005d56a0 : TEST EBX,EBX
005d56a2 : JNZ 0x005d56e0
005d56a4 : MOV byte ptr [ESP + 0x20],0x0
005d56a9 : MOV dword ptr [ESP + 0x24],0xff000000
005d56b1 : LEA EBX,[ESP + 0x20]
005d56b5 : XOR EAX,EAX
005d56b7 : MOV EDX,dword ptr [EBX + 0x4]
005d56ba : MOV dword ptr [EDI + EAX*0x4],EDX
005d56bd : INC EAX
005d56be : CMP EAX,0x100
005d56c3 : JC 0x005d56b7
005d56c5 : MOV ECX,dword ptr [ESP + 0x254]
005d56cc : POP EDI
005d56cd : POP ESI
005d56ce : POP EBP
005d56cf : POP EBX
005d56d0 : XOR ECX,ESP
005d56d2 : CALL 0x00633e6b
005d56d7 : ADD ESP,0x248
005d56dd : RET 0xc
005d56e0 : CMP EBP,0x1
005d56e3 : JBE 0x005d56b5
005d56e5 : FLD1
005d56e7 : FST float ptr [ESP + 0x40]
005d56eb : FCOMP float ptr [ESP + 0x264]
005d56f2 : FNSTSW AX
005d56f4 : TEST AH,0x44
005d56f7 : JP 0x005d571c
005d56f9 : XOR EAX,EAX
005d56fb : JMP 0x005d5700
005d5700 : MOVZX ECX,AX
005d5703 : MOV EDX,ECX
005d5705 : SHL EDX,0x8
005d5708 : OR EDX,ECX
005d570a : MOV word ptr [ESP + EAX*0x2 + 0x54],DX
005d570f : INC EAX
005d5710 : CMP EAX,0x100
005d5715 : JC 0x005d5700
005d5717 : JMP 0x005d57bc
005d571c : XOR ESI,ESI
005d571e : MOV EDI,EDI
005d5720 : MOV EAX,ESI
005d5722 : MOV dword ptr [ESP + 0x3c],EAX
005d5726 : FILD dword ptr [ESP + 0x3c]
005d572a : TEST EAX,EAX
005d572c : JGE 0x005d5734
005d572e : FADD float ptr [0x00cdf0e0]
005d5734 : FDIV double ptr [0x00b86b48]
005d573a : FSTP float ptr [ESP + 0x10]
005d573e : FLD float ptr [ESP + 0x10]
005d5742 : FLD float ptr [ESP + 0x264]
005d5749 : CALL 0x0063cd40
005d574e : FSTP float ptr [ESP + 0x10]
005d5752 : FLD float ptr [ESP + 0x10]
005d5756 : SUB ESP,0x8
005d5759 : FMUL double ptr [0x00b8d220]
005d575f : FADD double ptr [0x00cdf120]
005d5765 : FSTP float ptr [ESP + 0x18]
005d5769 : FLD float ptr [ESP + 0x18]
005d576d : FSTP double ptr [ESP]
005d5770 : CALL 0x0063bc90
005d5775 : FNSTCW word ptr [ESP + 0x1c]
005d5779 : INC ESI
005d577a : MOVZX EAX,word ptr [ESP + 0x1c]
005d577f : OR EAX,0xc00
005d5784 : MOV dword ptr [ESP + 0x18],EAX
005d5788 : ADD ESP,0x8
005d578b : FLDCW word ptr [ESP + 0x10]
005d578f : FISTP dword ptr [ESP + 0x10]
005d5793 : MOV CX,word ptr [ESP + 0x10]
005d5798 : MOV word ptr [ESP + ESI*0x2 + 0x52],CX
005d579d : FLDCW word ptr [ESP + 0x14]
005d57a1 : CMP ESI,0x100
005d57a7 : JC 0x005d5720
005d57ad : FLD float ptr [ESP + 0x264]
005d57b4 : FLD1
005d57b6 : FDIVRP
005d57b8 : FSTP float ptr [ESP + 0x40]
005d57bc : MOVZX ESI,byte ptr [EBX]
005d57bf : MOV EAX,dword ptr [EBX + 0x4]
005d57c2 : XOR EDX,EDX
005d57c4 : MOV dword ptr [ESP + 0x34],EAX
005d57c8 : TEST ESI,ESI
005d57ca : JBE 0x005d57d4
005d57cc : MOV ECX,ESI
005d57ce : STOSD.REP ES:EDI
005d57d0 : MOV EDI,dword ptr [ESP + 0x28]
005d57d4 : CMP EBP,0x1
005d57d7 : JBE 0x005d59b6
005d57dd : LEA ECX,[EBX + 0x6]
005d57e0 : DEC EBP
005d57e1 : MOV dword ptr [ESP + 0x2c],ECX
005d57e5 : MOV dword ptr [ESP + 0x10],EBP
005d57e9 : JMP 0x005d57f4
005d57f0 : MOV ECX,dword ptr [ESP + 0x2c]
005d57f4 : MOVZX EDI,byte ptr [ECX + 0x2]
005d57f8 : MOV dword ptr [ESP + 0x14],EDI
005d57fc : CMP EDI,ESI
005d57fe : JNC 0x005d5806
005d5800 : MOV dword ptr [ESP + 0x14],ESI
005d5804 : MOV EDI,ESI
005d5806 : MOVZX EDX,byte ptr [ECX]
005d5809 : FLD1
005d580b : MOV BP,word ptr [ESP + EDX*0x2 + 0x54]
005d5810 : FCOMP float ptr [ESP + 0x264]
005d5817 : MOVZX EDX,byte ptr [ECX + -0x1]
005d581b : MOVZX EDX,word ptr [ESP + EDX*0x2 + 0x54]
005d5820 : MOVZX EAX,byte ptr [ECX + 0x1]
005d5824 : MOVZX EBX,byte ptr [ECX + 0x8]
005d5828 : MOVZX EBX,word ptr [ESP + EBX*0x2 + 0x54]
005d582d : MOV word ptr [ESP + 0x1a],DX
005d5832 : MOVZX EDX,byte ptr [ECX + -0x2]
005d5836 : MOVZX EDX,word ptr [ESP + EDX*0x2 + 0x54]
005d583b : MOV word ptr [ESP + 0x1c],DX
005d5840 : MOV EDX,EAX
005d5842 : SHL EDX,0x8
005d5845 : OR EDX,EAX
005d5847 : MOVZX EAX,byte ptr [ECX + 0x9]
005d584b : MOV word ptr [ESP + 0x20],BX
005d5850 : MOVZX EBX,byte ptr [ECX + 0x7]
005d5854 : MOVZX EBX,word ptr [ESP + EBX*0x2 + 0x54]
005d5859 : MOV word ptr [ESP + 0x22],BX
005d585e : MOVZX EBX,byte ptr [ECX + 0x6]
005d5862 : MOVZX EBX,word ptr [ESP + EBX*0x2 + 0x54]
005d5867 : MOV word ptr [ESP + 0x24],BX
005d586c : MOV EBX,EAX
005d586e : SHL EBX,0x8
005d5871 : OR EBX,EAX
005d5873 : SUB EDI,ESI
005d5875 : FNSTSW AX
005d5877 : MOV word ptr [ESP + 0x18],BP
005d587c : MOV word ptr [ESP + 0x1e],DX
005d5881 : MOV word ptr [ESP + 0x26],BX
005d5886 : TEST AH,0x44
005d5889 : JP 0x005d5943
005d588f : CMP ESI,dword ptr [ESP + 0x14]
005d5893 : JNC 0x005d598a
005d5899 : MOVZX EDX,DX
005d589c : MOVZX EAX,BX
005d589f : MOVZX EBX,word ptr [ESP + 0x24]
005d58a4 : SUB EAX,EDX
005d58a6 : MOVZX EDX,word ptr [ESP + 0x1c]
005d58ab : MOV ECX,EDI
005d58ad : SHL ECX,0x8
005d58b0 : SUB EBX,EDX
005d58b2 : MOVZX EDX,word ptr [ESP + 0x22]
005d58b7 : OR ECX,EDI
005d58b9 : MOVZX EDI,word ptr [ESP + 0x1a]
005d58be : SUB EDX,EDI
005d58c0 : MOVZX EDI,word ptr [ESP + 0x20]
005d58c5 : MOVZX EBP,BP
005d58c8 : SUB EDI,EBP
005d58ca : MOV dword ptr [ESP + 0x3c],EAX
005d58ce : MOV dword ptr [ESP + 0x48],EBX
005d58d2 : MOV dword ptr [ESP + 0x4c],EDX
005d58d6 : MOV dword ptr [ESP + 0x44],EDI
005d58da : MOV dword ptr [ESP + 0x38],EAX
005d58de : MOV EBP,EDX
005d58e0 : MOV EAX,EDI
005d58e2 : CDQ
005d58e3 : IDIV ECX
005d58e5 : ADD EDI,dword ptr [ESP + 0x44]
005d58e9 : INC ESI
005d58ea : ADD AL,byte ptr [ESP + 0x18]
005d58ee : MOV byte ptr [ESP + 0x32],AL
005d58f2 : MOV EAX,EBP
005d58f4 : CDQ
005d58f5 : IDIV ECX
005d58f7 : ADD EBP,dword ptr [ESP + 0x4c]
005d58fb : ADD AL,byte ptr [ESP + 0x1a]
005d58ff : MOV byte ptr [ESP + 0x31],AL
005d5903 : MOV EAX,EBX
005d5905 : CDQ
005d5906 : IDIV ECX
005d5908 : ADD EBX,dword ptr [ESP + 0x48]
005d590c : ADD AL,byte ptr [ESP + 0x1c]
005d5910 : MOV byte ptr [ESP + 0x30],AL
005d5914 : MOV EAX,dword ptr [ESP + 0x38]
005d5918 : CDQ
005d5919 : IDIV ECX
005d591b : MOV EDX,dword ptr [ESP + 0x28]
005d591f : ADD AL,byte ptr [ESP + 0x1e]
005d5923 : MOV byte ptr [ESP + 0x33],AL
005d5927 : MOV EAX,dword ptr [ESP + 0x30]
005d592b : MOV dword ptr [EDX + ESI*0x4 + -0x4],EAX
005d592f : MOV dword ptr [ESP + 0x34],EAX
005d5933 : MOV EAX,dword ptr [ESP + 0x3c]
005d5937 : ADD dword ptr [ESP + 0x38],EAX
005d593b : CMP ESI,dword ptr [ESP + 0x14]
005d593f : JC 0x005d58e0
005d5941 : JMP 0x005d5986
005d5943 : CMP ESI,dword ptr [ESP + 0x14]
005d5947 : JNC 0x005d598a
005d5949 : MOV EBX,0x1
005d594e : MOV EDI,EDI
005d5950 : FLD float ptr [ESP + 0x40]
005d5954 : PUSH ECX
005d5955 : FSTP float ptr [ESP]
005d5958 : PUSH EDI
005d5959 : PUSH EBX
005d595a : LEA ECX,[ESP + 0x2c]
005d595e : PUSH ECX
005d595f : LEA EDX,[ESP + 0x28]
005d5963 : PUSH EDX
005d5964 : LEA EAX,[ESP + 0x64]
005d5968 : PUSH EAX
005d5969 : CALL 0x005d55b0
005d596e : MOV EAX,dword ptr [EAX]
005d5970 : MOV ECX,dword ptr [ESP + 0x40]
005d5974 : MOV dword ptr [ECX + ESI*0x4],EAX
005d5977 : INC ESI
005d5978 : ADD ESP,0x18
005d597b : INC EBX
005d597c : MOV dword ptr [ESP + 0x34],EAX
005d5980 : CMP ESI,dword ptr [ESP + 0x14]
005d5984 : JC 0x005d5950
005d5986 : MOV ECX,dword ptr [ESP + 0x2c]
005d598a : ADD ECX,0x8
005d598d : SUB dword ptr [ESP + 0x10],0x1
005d5992 : MOV dword ptr [ESP + 0x2c],ECX
005d5996 : JNZ 0x005d57f0
005d599c : CMP dword ptr [ESP + 0x14],0x100
005d59a4 : JNC 0x005d56c5
005d59aa : MOV EDX,dword ptr [ESP + 0x14]
005d59ae : MOV EAX,dword ptr [ESP + 0x34]
005d59b2 : MOV EDI,dword ptr [ESP + 0x28]
005d59b6 : MOV ECX,0x100
005d59bb : LEA EDI,[EDI + EDX*0x4]
005d59be : SUB ECX,EDX
005d59c0 : STOSD.REP ES:EDI
005d59c2 : JMP 0x005d56c5
