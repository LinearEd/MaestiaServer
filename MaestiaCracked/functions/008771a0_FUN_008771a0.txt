PROGRAM  : Maestia.exe
FUNCTION : FUN_008771a0
ENTRY    : 008771a0
BODY     : [[008771a0, 008773e8]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008771a0(void)

{
  float *pfVar1;
  int iVar2;
  int in_EAX;
  float unaff_ESI;
  float unaff_EDI;
  float fVar3;
  double dVar4;
  float fVar5;
  float fVar6;
  float local_4c;
  float local_48;
  float local_44;
  undefined4 local_40;
  undefined4 uStack_3c;
  undefined4 uStack_38;
  undefined4 uStack_34;
  undefined4 uStack_30;
  
  if (*(char *)(in_EAX + 0x8d) != '\0') {
    pfVar1 = (float *)(in_EAX + 0x98);
    local_48 = 0.0;
    local_44 = 0.0;
    local_40 = 0;
    local_4c = *(float *)(in_EAX + 0xa0);
    D3DXVec3Normalize(pfVar1);
    D3DXVec3Normalize(&stack0xffffffa4,&stack0xffffffa4);
    fVar5 = *(float *)(in_EAX + 0x9c) * unaff_ESI - *(float *)(in_EAX + 0xa0) * unaff_EDI;
    fVar3 = *(float *)(in_EAX + 0xa0) * (float)pfVar1 - *pfVar1 * unaff_ESI;
    local_40 = 0;
    uStack_3c = 0;
    uStack_38 = 0;
    uStack_34 = 0x3f800000;
    fVar6 = *pfVar1 * unaff_EDI - *(float *)(in_EAX + 0x9c) * (float)pfVar1;
    dVar4 = (double)(*(float *)(in_EAX + 0xa0) * unaff_ESI + *(float *)(in_EAX + 0x9c) * unaff_EDI +
                    *pfVar1 * (float)pfVar1);
    local_4c = fVar5;
    local_48 = fVar3;
    local_44 = fVar6;
    FUN_00b0abbf();
    D3DXQuaternionRotationAxis(&local_40,&stack0xffffffa8,-(float)dVar4);
    iVar2 = *(int *)(in_EAX + 0x48);
    uStack_38 = *(undefined4 *)(iVar2 + 0x78);
    uStack_34 = *(undefined4 *)(iVar2 + 0x7c);
    uStack_30 = *(undefined4 *)(iVar2 + 0x80);
    uStack_3c = *(undefined4 *)(iVar2 + 0x74);
    D3DXQuaternionMultiply(&uStack_3c,&uStack_3c,&local_4c);
    iVar2 = *(int *)(in_EAX + 0x48);
    *(ulonglong *)(iVar2 + 0x74) = CONCAT44(local_44,local_48);
    *(ulonglong *)(iVar2 + 0x7c) = CONCAT44(uStack_3c,local_40);
    *(undefined1 *)(iVar2 + 0x5d) = 1;
    *(undefined1 *)(iVar2 + 0x134) = 1;
    *(undefined1 *)(iVar2 + 0x5c) = 1;
    if (*(int **)(iVar2 + 0x2c) != (int *)0x0) {
      (**(code **)(**(int **)(iVar2 + 0x2c) + 0x60))(iVar2);
    }
    if (*(int *)(in_EAX + 0x50) != 0) {
      FUN_007cc7f0(fVar5,fVar3,fVar6,local_4c);
    }
    iVar2 = *(int *)(in_EAX + 0x54);
    if (iVar2 != 0) {
      *(ulonglong *)(iVar2 + 0x74) = CONCAT44(fVar3,fVar5);
      *(ulonglong *)(iVar2 + 0x7c) = CONCAT44(local_4c,fVar6);
      *(undefined1 *)(iVar2 + 0x5d) = 1;
      *(undefined1 *)(iVar2 + 0x134) = 1;
      *(undefined1 *)(iVar2 + 0x5c) = 1;
      if (*(int **)(iVar2 + 0x2c) != (int *)0x0) {
        (**(code **)(**(int **)(iVar2 + 0x2c) + 0x60))(iVar2);
      }
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
008771a0 : PUSH EBP
008771a1 : MOV EBP,ESP
008771a3 : AND ESP,0xfffffff0
008771a6 : SUB ESP,0x44
008771a9 : PUSH EBX
008771aa : PUSH ESI
008771ab : PUSH EDI
008771ac : MOV EDI,EAX
008771ae : CMP byte ptr [EDI + 0x8d],0x0
008771b5 : JZ 0x008773e2
008771bb : XORPS XMM0,XMM0
008771be : MOVSS XMM1,dword ptr [EDI + 0x98]
008771c6 : LEA ESI,[EDI + 0x98]
008771cc : PUSH ESI
008771cd : MOVSS dword ptr [ESP + 0x1c],XMM0
008771d3 : MOVSS dword ptr [ESP + 0x20],XMM0
008771d9 : MOVSS dword ptr [ESP + 0x24],XMM0
008771df : MOVSS dword ptr [ESP + 0x14],XMM0
008771e5 : MOVSS XMM0,dword ptr [EDI + 0xa0]
008771ed : PUSH ESI
008771ee : MOVSS dword ptr [ESP + 0x14],XMM1
008771f4 : MOVSS dword ptr [ESP + 0x1c],XMM0
008771fa : CALL 0x004ff722
008771ff : LEA EAX,[ESP + 0xc]
00877203 : PUSH EAX
00877204 : MOV ECX,EAX
00877206 : PUSH ECX
00877207 : CALL 0x004ff722
0087720c : MOVSS XMM2,dword ptr [ESI + 0x4]
00877211 : MOVSS XMM0,dword ptr [ESI + 0x8]
00877216 : MOVSS XMM3,dword ptr [ESP + 0x14]
0087721c : MOVSS XMM4,dword ptr [ESP + 0x10]
00877222 : MOVAPS XMM5,XMM0
00877225 : MOVAPS XMM1,XMM2
00877228 : MULSS XMM1,XMM3
0087722c : MULSS XMM5,XMM4
00877230 : SUBSS XMM1,XMM5
00877234 : MOVSS XMM5,dword ptr [ESP + 0xc]
0087723a : MOVSS dword ptr [ESP + 0x24],XMM1
00877240 : MOVSS XMM1,dword ptr [ESI]
00877244 : MULSS XMM0,XMM5
00877248 : MOVAPS XMM6,XMM1
0087724b : MULSS XMM6,XMM3
0087724f : SUBSS XMM0,XMM6
00877253 : MOVSS dword ptr [ESP + 0x28],XMM0
00877259 : MOVQ XMM0,qword ptr [ESP + 0x24]
0087725f : MOVQ qword ptr [ESP + 0x18],XMM0
00877265 : XORPS XMM0,XMM0
00877268 : MOVSS dword ptr [ESP + 0x30],XMM0
0087726e : MOVSS dword ptr [ESP + 0x34],XMM0
00877274 : MOVSS dword ptr [ESP + 0x38],XMM0
0087727a : MOVSS XMM0,dword ptr [0x00c10fc4]
00877282 : MULSS XMM1,XMM4
00877286 : MOVSS dword ptr [ESP + 0x3c],XMM0
0087728c : MOVSS XMM0,dword ptr [ESI + 0x8]
00877291 : MULSS XMM2,XMM5
00877295 : SUBSS XMM1,XMM2
00877299 : MOVSS dword ptr [ESP + 0x2c],XMM1
0087729f : MOVSS XMM1,dword ptr [ESI + 0x4]
008772a4 : MOV EDX,dword ptr [ESP + 0x2c]
008772a8 : MULSS XMM0,XMM3
008772ac : MULSS XMM1,XMM4
008772b0 : ADDSS XMM0,XMM1
008772b4 : MOVSS XMM1,dword ptr [ESI]
008772b8 : MULSS XMM1,XMM5
008772bc : ADDSS XMM0,XMM1
008772c0 : MOV dword ptr [ESP + 0x20],EDX
008772c4 : CVTPS2PD XMM0,XMM0
008772c7 : CALL 0x00b0abbf
008772cc : PUSH ECX
008772cd : CVTSD2SS XMM0,XMM0
008772d1 : XORPS XMM0,xmmword ptr [0x00cdf0c0]
008772d8 : MOVSS dword ptr [ESP],XMM0
008772dd : LEA EAX,[ESP + 0x1c]
008772e1 : PUSH EAX
008772e2 : LEA ECX,[ESP + 0x38]
008772e6 : PUSH ECX
008772e7 : CALL 0x004ff710
008772ec : MOV EAX,dword ptr [EDI + 0x48]
008772ef : MOVSS XMM0,dword ptr [EAX + 0x78]
008772f4 : MOVSS XMM1,dword ptr [EAX + 0x7c]
008772f9 : MOVSS XMM2,dword ptr [EAX + 0x80]
00877301 : MOVSS XMM3,dword ptr [EAX + 0x74]
00877306 : ADD EAX,0x74
00877309 : LEA EDX,[ESP + 0x30]
0087730d : MOVSS dword ptr [ESP + 0x40],XMM3
00877313 : MOVSS dword ptr [ESP + 0x44],XMM0
00877319 : MOVSS dword ptr [ESP + 0x48],XMM1
0087731f : MOVSS dword ptr [ESP + 0x4c],XMM2
00877325 : PUSH EDX
00877326 : LEA EAX,[ESP + 0x44]
0087732a : PUSH EAX
0087732b : MOV ECX,EAX
0087732d : PUSH ECX
0087732e : CALL 0x004ff716
00877333 : MOV EAX,dword ptr [EDI + 0x48]
00877336 : MOVQ XMM0,qword ptr [ESP + 0x40]
0087733c : MOV ECX,dword ptr [EAX + 0x2c]
0087733f : MOV BL,0x1
00877341 : MOVQ qword ptr [EAX + 0x74],XMM0
00877346 : MOVQ XMM0,qword ptr [ESP + 0x48]
0087734c : MOVQ qword ptr [EAX + 0x7c],XMM0
00877351 : MOV byte ptr [EAX + 0x5d],BL
00877354 : MOV byte ptr [EAX + 0x134],BL
0087735a : MOV byte ptr [EAX + 0x5c],BL
0087735d : TEST ECX,ECX
0087735f : JZ 0x00877369
00877361 : MOV EDX,dword ptr [ECX]
00877363 : PUSH EAX
00877364 : MOV EAX,dword ptr [EDX + 0x60]
00877367 : CALL EAX
00877369 : CMP dword ptr [EDI + 0x50],0x0
0087736d : JZ 0x008773aa
0087736f : MOVSS XMM0,dword ptr [ESP + 0x34]
00877375 : MOVSS XMM1,dword ptr [ESP + 0x38]
0087737b : MOVSS XMM2,dword ptr [ESP + 0x3c]
00877381 : MOVSS XMM3,dword ptr [ESP + 0x30]
00877387 : SUB ESP,0x10
0087738a : MOV EAX,ESP
0087738c : MOVSS dword ptr [EAX],XMM3
00877390 : MOVSS dword ptr [EAX + 0x4],XMM0
00877395 : MOVSS dword ptr [EAX + 0x8],XMM1
0087739a : MOVSS dword ptr [EAX + 0xc],XMM2
0087739f : MOV ECX,dword ptr [EDI + 0x50]
008773a2 : MOV ECX,dword ptr [ECX + 0x14]
008773a5 : CALL 0x007cc7f0
008773aa : MOV EDI,dword ptr [EDI + 0x54]
008773ad : TEST EDI,EDI
008773af : JZ 0x008773e2
008773b1 : MOVQ XMM0,qword ptr [ESP + 0x30]
008773b7 : MOV ECX,dword ptr [EDI + 0x2c]
008773ba : MOVQ qword ptr [EDI + 0x74],XMM0
008773bf : MOVQ XMM0,qword ptr [ESP + 0x38]
008773c5 : MOVQ qword ptr [EDI + 0x7c],XMM0
008773ca : MOV byte ptr [EDI + 0x5d],BL
008773cd : MOV byte ptr [EDI + 0x134],BL
008773d3 : MOV byte ptr [EDI + 0x5c],BL
008773d6 : TEST ECX,ECX
008773d8 : JZ 0x008773e2
008773da : MOV EDX,dword ptr [ECX]
008773dc : MOV EAX,dword ptr [EDX + 0x60]
008773df : PUSH EDI
008773e0 : CALL EAX
008773e2 : POP EDI
008773e3 : POP ESI
008773e4 : POP EBX
008773e5 : MOV ESP,EBP
008773e7 : POP EBP
008773e8 : RET
