PROGRAM  : Maestia.exe
FUNCTION : FUN_009f0580
ENTRY    : 009f0580
BODY     : [[009f0580, 009f0a00]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_009f0580(undefined4 param_1)

{
  uint uVar1;
  int iVar2;
  int iVar3;
  undefined4 uVar4;
  int *in_ECX;
  ushort uVar5;
  float fVar6;
  double dVar7;
  float fVar8;
  double dVar9;
  float fVar10;
  undefined8 uVar11;
  float local_cc;
  float local_c8;
  undefined1 auStack_c0 [56];
  undefined1 auStack_88 [56];
  undefined1 auStack_50 [60];
  void *local_14;
  undefined1 *puStack_10;
  int iStack_c;
  
  iStack_c = 0xffffffff;
  puStack_10 = &LAB_00b390e4;
  local_14 = ExceptionList;
  uVar1 = DAT_00d66fa0 ^ (uint)&stack0xffffff28;
  ExceptionList = &local_14;
  FUN_00406360(&DAT_00ca4c10,0);
  iVar3 = DAT_00d7c54c;
  if (in_ECX != (int *)0x0) {
    local_cc = (float)in_ECX[4];
    FUN_004437f0(&local_cc);
    if (local_c8 == (float)*(int *)(iVar3 + 0x44)) {
      iVar3 = 0;
    }
    else {
      iVar3 = *(int *)((int)local_c8 + 0x10);
    }
    iVar2 = (**(code **)(*in_ECX + 0x20))(uVar1);
    if ((iVar2 == 2) || (iVar2 = (**(code **)(*in_ECX + 0x20))(), iVar2 == 3)) {
      FUN_00406360(&DAT_00ca4c14,0);
    }
    else if ((iVar3 != 0) && ((*(uint *)(iVar3 + 0x48) & 8) == 0)) {
      iVar2 = FUN_008eb260(DAT_00d6f0f4);
      iVar3 = FUN_00443990(iVar3 + 0x15c);
      fVar8 = 10.0;
      fVar10 = 10.0;
      uVar1 = 5;
      fVar6 = 1.0;
      while( true ) {
        if ((uVar1 & 1) != 0) {
          fVar6 = fVar6 * fVar10;
        }
        uVar1 = uVar1 >> 1;
        if (uVar1 == 0) break;
        fVar10 = fVar10 * fVar10;
      }
      uVar1 = 5;
      fVar10 = 1.0;
      while( true ) {
        if ((uVar1 & 1) != 0) {
          fVar10 = fVar10 * fVar8;
        }
        uVar1 = uVar1 >> 1;
        if (uVar1 == 0) break;
        fVar8 = fVar8 * fVar8;
      }
      dVar9 = (double)(fVar6 * (float)*(ushort *)(iVar3 + 0x18) * 0.0001 + DAT_00d72c24);
      uVar1 = (uint)((ulonglong)dVar9 >> 0x20) & 0x80000000;
      dVar7 = (double)((ulonglong)uVar1 << 0x20 | 0x4330000000000000);
      dVar7 = (dVar9 + dVar7) - dVar7;
      local_c8 = (float)((dVar7 - (double)(-(ulonglong)
                                            ((double)((ulonglong)uVar1 << 0x20) < dVar7 - dVar9) &
                                          0x3ff0000000000000)) / (double)fVar10);
      local_cc = 1.0;
      uVar5 = 10000;
      if ((iVar2 != 0) && (iVar3 = FUN_004049b0(*(undefined4 *)(iVar2 + 0x70)), iVar3 != 0)) {
        uVar5 = *(ushort *)(iVar3 + 0x44);
        local_cc = (float)uVar5 * 0.0001;
      }
      uVar11 = FUN_0063b3b6();
      uVar11 = __allmul(uVar11,uVar5,0);
      iVar3 = __alldiv(uVar11,10000,0);
      if (iVar3 == 0) {
        iVar3 = 1;
      }
      FUN_00406460(L"IDS_ITEMEQUIP_SALE2");
      iStack_c = 0;
      uVar4 = FUN_0070c2d0(iVar3,0);
      iStack_c._0_1_ = 1;
      FUN_0081d120(auStack_c0);
      iStack_c._0_1_ = 2;
      uVar4 = FUN_00403450(auStack_50,uVar4);
      iStack_c._0_1_ = 3;
      FUN_00405d70(uVar4);
      iStack_c._0_1_ = 2;
      FUN_00406560();
      iStack_c._0_1_ = 1;
      FUN_00406560();
      iStack_c = (uint)iStack_c._1_3_ << 8;
      FUN_00406560();
      iStack_c = 0xffffffff;
      FUN_00406560();
      iVar3 = FUN_0081cbe0(DAT_0172491c);
      iStack_c = 4;
      if (*(uint *)(iVar3 + 0x18) < 8) {
        iVar3 = iVar3 + 4;
      }
      else {
        iVar3 = *(int *)(iVar3 + 4);
      }
      uVar4 = FUN_00404750(L" %s@N",iVar3);
      iStack_c._0_1_ = 5;
      FUN_00405d50(uVar4);
      iStack_c = CONCAT31(iStack_c._1_3_,4);
      FUN_00406560();
      iStack_c = 0xffffffff;
      FUN_00406560();
      iVar3 = (int)ABS((1.0 - local_cc) * 100.0);
      if (0 < iVar3) {
        FUN_00406460(L"IDS_APPLY_SELL_TAX");
        iStack_c = 6;
        iVar2 = FUN_0081d120(auStack_c0);
        iStack_c._0_1_ = 7;
        if (*(uint *)(iVar2 + 0x18) < 8) {
          iVar2 = iVar2 + 4;
        }
        else {
          iVar2 = *(int *)(iVar2 + 4);
        }
        uVar4 = FUN_00404750(iVar2,iVar3);
        iStack_c._0_1_ = 8;
        uVar4 = FUN_00403380(auStack_88,uVar4);
        iStack_c._0_1_ = 9;
        FUN_00405d50(uVar4);
        iStack_c._0_1_ = 8;
        FUN_00406560();
        iStack_c._0_1_ = 7;
        FUN_00406560();
        iStack_c = CONCAT31(iStack_c._1_3_,6);
        FUN_00406560();
        iStack_c = 0xffffffff;
        FUN_00406560();
      }
      FUN_00404980(param_1);
      ExceptionList = local_14;
      return;
    }
  }
  ExceptionList = local_14;
  return;
}



============================================================
DISASSEMBLY
============================================================
009f0580 : PUSH EBP
009f0581 : MOV EBP,ESP
009f0583 : AND ESP,0xfffffff8
009f0586 : PUSH -0x1
009f0588 : PUSH 0xb390e4
009f058d : MOV EAX,FS:[0x0]
009f0593 : PUSH EAX
009f0594 : SUB ESP,0xb8
009f059a : PUSH EBX
009f059b : PUSH ESI
009f059c : PUSH EDI
009f059d : MOV EAX,[0x00d66fa0]
009f05a2 : XOR EAX,ESP
009f05a4 : PUSH EAX
009f05a5 : LEA EAX,[ESP + 0xc8]
009f05ac : MOV FS:[0x0],EAX
009f05b2 : MOV ESI,ECX
009f05b4 : MOV EBX,dword ptr [EBP + 0x8]
009f05b7 : PUSH 0x0
009f05b9 : PUSH 0xca4c10
009f05be : MOV ECX,EBX
009f05c0 : CALL 0x00406360
009f05c5 : TEST ESI,ESI
009f05c7 : JZ 0x009f09eb
009f05cd : MOV EAX,dword ptr [ESI + 0x10]
009f05d0 : MOV EDI,dword ptr [0x00d7c54c]
009f05d6 : LEA ECX,[ESP + 0x10]
009f05da : MOV dword ptr [ESP + 0x10],EAX
009f05de : PUSH ECX
009f05df : LEA ECX,[EDI + 0x40]
009f05e2 : LEA EAX,[ESP + 0x18]
009f05e6 : CALL 0x004437f0
009f05eb : MOV EDI,dword ptr [EDI + 0x44]
009f05ee : MOV EAX,dword ptr [ESP + 0x14]
009f05f2 : CMP EAX,EDI
009f05f4 : JZ 0x009f05fb
009f05f6 : MOV EDI,dword ptr [EAX + 0x10]
009f05f9 : JMP 0x009f05fd
009f05fb : XOR EDI,EDI
009f05fd : MOV EDX,dword ptr [ESI]
009f05ff : MOV EAX,dword ptr [EDX + 0x20]
009f0602 : MOV ECX,ESI
009f0604 : CALL EAX
009f0606 : CMP EAX,0x2
009f0609 : JZ 0x009f09dd
009f060f : MOV EDX,dword ptr [ESI]
009f0611 : MOV EAX,dword ptr [EDX + 0x20]
009f0614 : MOV ECX,ESI
009f0616 : CALL EAX
009f0618 : CMP EAX,0x3
009f061b : JZ 0x009f09dd
009f0621 : TEST EDI,EDI
009f0623 : JZ 0x009f09eb
009f0629 : MOV EAX,dword ptr [EDI + 0x48]
009f062c : AND EAX,0x8
009f062f : XOR ECX,ECX
009f0631 : OR EAX,ECX
009f0633 : JNZ 0x009f09eb
009f0639 : MOV ECX,dword ptr [0x00da9894]
009f063f : MOV EDX,dword ptr [0x00d6f0f4]
009f0645 : MOV ESI,dword ptr [ECX]
009f0647 : PUSH EDX
009f0648 : CALL 0x008eb260
009f064d : MOV EBX,EAX
009f064f : LEA EAX,[EDI + 0x15c]
009f0655 : PUSH EAX
009f0656 : CALL 0x00443990
009f065b : MOVZX ECX,word ptr [EAX + 0x18]
009f065f : MOVSS XMM3,dword ptr [0x00c18874]
009f0667 : MOVSS XMM5,dword ptr [0x00c10fc4]
009f066f : CVTSI2SS XMM1,ECX
009f0673 : MULSS XMM1,dword ptr [0x00cdf398]
009f067b : MOVAPS XMM2,XMM3
009f067e : MOV EAX,0x5
009f0683 : MOVAPS XMM0,XMM5
009f0686 : TEST AL,0x1
009f0688 : JZ 0x009f068e
009f068a : MULSS XMM0,XMM2
009f068e : SHR EAX,0x1
009f0690 : JZ 0x009f069e
009f0692 : MOVAPS XMM4,XMM2
009f0695 : MULSS XMM4,XMM2
009f0699 : MOVAPS XMM2,XMM4
009f069c : JMP 0x009f0686
009f069e : MOV EAX,0x5
009f06a3 : MOVAPS XMM4,XMM5
009f06a6 : MOVAPS XMM2,XMM3
009f06a9 : TEST AL,0x1
009f06ab : JZ 0x009f06b7
009f06ad : MOVAPS XMM3,XMM4
009f06b0 : MULSS XMM3,XMM2
009f06b4 : MOVAPS XMM4,XMM3
009f06b7 : SHR EAX,0x1
009f06b9 : JZ 0x009f06c4
009f06bb : MOVAPS XMM3,XMM2
009f06be : MULSS XMM3,XMM2
009f06c2 : JMP 0x009f06a6
009f06c4 : MOVSD XMM2,qword ptr [0x00cdf110]
009f06cc : MOVSD XMM6,qword ptr [0x00cdf108]
009f06d4 : MULSS XMM0,XMM1
009f06d8 : ADDSS XMM0,dword ptr [0x00d72c24]
009f06e0 : MOVSD XMM1,qword ptr [0x00cdf118]
009f06e8 : CVTSS2SD XMM3,XMM0
009f06ec : ANDPD XMM1,XMM3
009f06f0 : ORPD XMM2,XMM1
009f06f4 : MOVAPD XMM0,XMM3
009f06f8 : ADDSD XMM0,XMM2
009f06fc : SUBSD XMM0,XMM2
009f0700 : MOVAPD XMM2,XMM0
009f0704 : SUBSD XMM2,XMM3
009f0708 : CMPNLESD XMM2,XMM1
009f070d : ANDPD XMM2,XMM6
009f0711 : SUBSD XMM0,XMM2
009f0715 : CVTSS2SD XMM1,XMM4
009f0719 : DIVSD XMM0,XMM1
009f071d : CVTSD2SS XMM0,XMM0
009f0721 : MOVSS dword ptr [ESP + 0x14],XMM0
009f0727 : MOVSS dword ptr [ESP + 0x10],XMM5
009f072d : MOV ESI,0x2710
009f0732 : TEST EBX,EBX
009f0734 : JZ 0x009f0762
009f0736 : MOV EAX,dword ptr [EBX + 0x70]
009f0739 : PUSH EAX
009f073a : CALL 0x004049b0
009f073f : ADD ESP,0x4
009f0742 : TEST EAX,EAX
009f0744 : JZ 0x009f0762
009f0746 : MOVZX EAX,word ptr [EAX + 0x44]
009f074a : MOVZX EDX,AX
009f074d : CVTSI2SS XMM0,EDX
009f0751 : MULSS XMM0,dword ptr [0x00cdf398]
009f0759 : MOVSS dword ptr [ESP + 0x10],XMM0
009f075f : MOVZX ESI,AX
009f0762 : MOV EAX,dword ptr [EDI + 0x54]
009f0765 : FILD dword ptr [EDI + 0x54]
009f0768 : TEST EAX,EAX
009f076a : JGE 0x009f0772
009f076c : FADD float ptr [0x00cdf0e0]
009f0772 : FMUL float ptr [ESP + 0x14]
009f0776 : CALL 0x0063b3b6
009f077b : MOV ECX,EAX
009f077d : MOVZX EAX,SI
009f0780 : MOV EDI,EDX
009f0782 : CDQ
009f0783 : PUSH EDX
009f0784 : PUSH EAX
009f0785 : PUSH EDI
009f0786 : PUSH ECX
009f0787 : CALL 0x0063c720
009f078c : PUSH 0x0
009f078e : PUSH 0x2710
009f0793 : PUSH EDX
009f0794 : PUSH EAX
009f0795 : CALL 0x0063c760
009f079a : MOV ESI,EAX
009f079c : TEST ESI,ESI
009f079e : JA 0x009f07a5
009f07a0 : MOV ESI,0x1
009f07a5 : PUSH 0xca4c18
009f07aa : LEA ECX,[ESP + 0x20]
009f07ae : CALL 0x00406460
009f07b3 : MOV dword ptr [ESP + 0xd0],0x0
009f07be : PUSH 0x0
009f07c0 : PUSH ESI
009f07c1 : LEA ECX,[ESP + 0x40]
009f07c5 : CALL 0x0070c2d0
009f07ca : ADD ESP,0x8
009f07cd : MOV ESI,EAX
009f07cf : MOV byte ptr [ESP + 0xd0],0x1
009f07d7 : MOV ECX,dword ptr [0x0172491c]
009f07dd : LEA EDX,[ESP + 0x1c]
009f07e1 : PUSH EDX
009f07e2 : LEA EDI,[ESP + 0xac]
009f07e9 : CALL 0x0081d120
009f07ee : MOV byte ptr [ESP + 0xd0],0x2
009f07f6 : LEA ECX,[ESP + 0x8c]
009f07fd : PUSH ESI
009f07fe : PUSH ECX
009f07ff : MOV ECX,EAX
009f0801 : CALL 0x00403450
009f0806 : ADD ESP,0x8
009f0809 : MOV byte ptr [ESP + 0xd0],0x3
009f0811 : MOV ECX,dword ptr [EBP + 0x8]
009f0814 : PUSH EAX
009f0815 : CALL 0x00405d70
009f081a : MOV byte ptr [ESP + 0xd0],0x2
009f0822 : LEA ECX,[ESP + 0x8c]
009f0829 : CALL 0x00406560
009f082e : MOV byte ptr [ESP + 0xd0],0x1
009f0836 : MOV ECX,EDI
009f0838 : CALL 0x00406560
009f083d : MOV byte ptr [ESP + 0xd0],0x0
009f0845 : LEA ECX,[ESP + 0x38]
009f0849 : CALL 0x00406560
009f084e : OR EBX,0xffffffff
009f0851 : MOV dword ptr [ESP + 0xd0],EBX
009f0858 : LEA ECX,[ESP + 0x1c]
009f085c : CALL 0x00406560
009f0861 : MOV EDX,dword ptr [0x0172491c]
009f0867 : PUSH EDX
009f0868 : MOV ECX,0xca4c40
009f086d : LEA ESI,[ESP + 0x58]
009f0871 : CALL 0x0081cbe0
009f0876 : MOV dword ptr [ESP + 0xd0],0x4
009f0881 : CMP dword ptr [EAX + 0x18],0x8
009f0885 : JC 0x009f088c
009f0887 : MOV EAX,dword ptr [EAX + 0x4]
009f088a : JMP 0x009f088f
009f088c : ADD EAX,0x4
009f088f : PUSH EAX
009f0890 : PUSH 0xca4c48
009f0895 : LEA ESI,[ESP + 0x78]
009f0899 : CALL 0x00404750
009f089e : ADD ESP,0x8
009f08a1 : MOV byte ptr [ESP + 0xd0],0x5
009f08a9 : MOV ECX,dword ptr [EBP + 0x8]
009f08ac : PUSH EAX
009f08ad : CALL 0x00405d50
009f08b2 : MOV byte ptr [ESP + 0xd0],0x4
009f08ba : MOV ECX,ESI
009f08bc : CALL 0x00406560
009f08c1 : MOV dword ptr [ESP + 0xd0],EBX
009f08c8 : LEA ECX,[ESP + 0x54]
009f08cc : CALL 0x00406560
009f08d1 : MOVSS XMM0,dword ptr [0x00c10fc4]
009f08d9 : SUBSS XMM0,dword ptr [ESP + 0x10]
009f08df : MULSS XMM0,dword ptr [0x00cdf230]
009f08e7 : MOVSS XMM1,dword ptr [0x00cdf350]
009f08ef : ANDPS XMM0,XMM1
009f08f2 : CVTTSS2SI ESI,XMM0
009f08f6 : TEST ESI,ESI
009f08f8 : JLE 0x009f09b9
009f08fe : PUSH 0xca4c54
009f0903 : LEA ECX,[ESP + 0x20]
009f0907 : CALL 0x00406460
009f090c : MOV dword ptr [ESP + 0xd0],0x6
009f0917 : MOV ECX,dword ptr [0x0172491c]
009f091d : LEA EAX,[ESP + 0x1c]
009f0921 : PUSH EAX
009f0922 : LEA EDI,[ESP + 0x3c]
009f0926 : CALL 0x0081d120
009f092b : MOV byte ptr [ESP + 0xd0],0x7
009f0933 : CMP dword ptr [EAX + 0x18],0x8
009f0937 : JC 0x009f093e
009f0939 : MOV EAX,dword ptr [EAX + 0x4]
009f093c : JMP 0x009f0941
009f093e : ADD EAX,0x4
009f0941 : PUSH ESI
009f0942 : PUSH EAX
009f0943 : LEA ESI,[ESP + 0x78]
009f0947 : CALL 0x00404750
009f094c : MOV byte ptr [ESP + 0xd8],0x8
009f0954 : PUSH EAX
009f0955 : LEA ECX,[ESP + 0x60]
009f0959 : PUSH ECX
009f095a : MOV EDX,0xca4c7c
009f095f : CALL 0x00403380
009f0964 : ADD ESP,0x10
009f0967 : MOV byte ptr [ESP + 0xd0],0x9
009f096f : MOV ECX,dword ptr [EBP + 0x8]
009f0972 : PUSH EAX
009f0973 : CALL 0x00405d50
009f0978 : MOV byte ptr [ESP + 0xd0],0x8
009f0980 : LEA ECX,[ESP + 0x54]
009f0984 : CALL 0x00406560
009f0989 : MOV byte ptr [ESP + 0xd0],0x7
009f0991 : MOV ECX,ESI
009f0993 : CALL 0x00406560
009f0998 : MOV byte ptr [ESP + 0xd0],0x6
009f09a0 : LEA ECX,[ESP + 0x38]
009f09a4 : CALL 0x00406560
009f09a9 : MOV dword ptr [ESP + 0xd0],EBX
009f09b0 : LEA ECX,[ESP + 0x1c]
009f09b4 : CALL 0x00406560
009f09b9 : MOV EDX,dword ptr [EBP + 0x8]
009f09bc : PUSH EDX
009f09bd : MOV EDX,0xca4c80
009f09c2 : CALL 0x00404980
009f09c7 : MOV ECX,dword ptr [ESP + 0xc8]
009f09ce : MOV dword ptr FS:[0x0],ECX
009f09d5 : POP ECX
009f09d6 : POP EDI
009f09d7 : POP ESI
009f09d8 : POP EBX
009f09d9 : MOV ESP,EBP
009f09db : POP EBP
009f09dc : RET
009f09dd : PUSH 0x0
009f09df : PUSH 0xca4c14
009f09e4 : MOV ECX,EBX
009f09e6 : CALL 0x00406360
009f09eb : MOV ECX,dword ptr [ESP + 0xc8]
009f09f2 : MOV dword ptr FS:[0x0],ECX
009f09f9 : POP ECX
009f09fa : POP EDI
009f09fb : POP ESI
009f09fc : POP EBX
009f09fd : MOV ESP,EBP
009f09ff : POP EBP
009f0a00 : RET
