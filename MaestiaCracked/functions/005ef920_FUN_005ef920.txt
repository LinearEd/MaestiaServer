PROGRAM  : Maestia.exe
FUNCTION : FUN_005ef920
ENTRY    : 005ef920
BODY     : [[005ef920, 005ef959] [005ef960, 005ef968] [005ef970, 005efc3e]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Removing unreachable block (ram,0x005efa73) */
/* WARNING: Removing unreachable block (ram,0x005efa8d) */
/* WARNING: Removing unreachable block (ram,0x005efb55) */
/* WARNING: Removing unreachable block (ram,0x005efb62) */
/* WARNING: Removing unreachable block (ram,0x005efb6a) */
/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void FUN_005ef920(GRefCountNTSImpl *param_1)

{
  int *piVar1;
  ushort uVar2;
  bool bVar3;
  float fVar4;
  char cVar5;
  uint uVar6;
  int iVar7;
  int *in_ECX;
  uint uVar8;
  ushort *puVar9;
  undefined4 *puVar10;
  float local_84;
  int local_80;
  int local_74;
  ushort *local_70;
  uint local_c;
  
  if (param_1 != (GRefCountNTSImpl *)0x0) {
    *(int *)(param_1 + 4) = *(int *)(param_1 + 4) + 1;
  }
  local_84 = 0.0;
  local_74 = 0;
  bVar3 = true;
  local_c = 0;
  while (((param_1 + 0x6c != (GRefCountNTSImpl *)0x0 && (local_c < *(uint *)(param_1 + 0x70))) &&
         (-1 < (int)local_c))) {
    piVar1 = *(int **)(*(int *)(param_1 + 0x6c) + local_c * 4);
    if (*piVar1 < 0) {
      local_80 = piVar1[3];
    }
    else {
      local_80 = piVar1[3];
    }
    fVar4 = (float)local_80;
    if ((!bVar3) && (fVar4 = local_84, local_84 == (float)local_80)) {
      FUN_0051b7e0(10);
    }
    local_84 = fVar4;
    puVar9 = (ushort *)((int)piVar1 + 0x1e);
    if (*piVar1 < 0) {
      uVar8 = (uint)*(byte *)(piVar1 + 7);
    }
    else {
      uVar8 = piVar1[1];
      puVar9 = (ushort *)((int)piVar1 + 0x2a);
    }
    FUN_00599240();
    uVar2 = 0;
    FUN_0059a4d0();
    piVar1 = piRam0000000c;
    local_70 = puVar9;
    if (piRam0000000c != (int *)0x0) {
      while ((local_70 != (ushort *)0x0 && (local_70 < puVar9 + uVar8 * 4))) {
        uVar6 = (uint)*local_70;
        if (*local_70 == 0xffff) {
          uVar6 = 0xffffffff;
        }
        iVar7 = (**(code **)(*piVar1 + 0x34))(uVar6);
        if (iVar7 != -1) {
          local_74 = local_74 + 1;
          FUN_0051b7e0(iVar7);
        }
        if (local_70 == (ushort *)0x0) break;
        if (local_70 < puVar9 + uVar8 * 4) {
          if (uVar2 == 0) {
            uVar2 = local_70[2] >> 0xc;
          }
          if ((((local_70[6] & 0xf000) != 0) && (uVar2 != 0)) &&
             (cVar5 = FUN_005d2b10(), cVar5 == '\0')) {
            FUN_005d30b0(uVar2);
            uVar2 = 0;
          }
          FUN_0059a4d0();
          local_70 = local_70 + 4;
        }
      }
      bVar3 = false;
    }
    if (local_c < *(uint *)(param_1 + 0x70)) {
      local_c = local_c + 1;
    }
  }
  uVar8 = in_ECX[1] + 1;
  if (uVar8 < (uint)in_ECX[1]) {
    iVar7 = in_ECX[1] - uVar8;
    puVar10 = (undefined4 *)(*in_ECX + -8 + (iVar7 + uVar8) * 8);
    for (; iVar7 != 0; iVar7 = iVar7 + -1) {
      if ((GRefCountNTSImpl *)*puVar10 != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release((GRefCountNTSImpl *)*puVar10);
      }
      puVar10 = puVar10 + -2;
    }
    uVar6 = uVar8;
    if ((uint)in_ECX[2] >> 1 <= uVar8) goto LAB_005efc09;
  }
  else {
    if (uVar8 < (uint)in_ECX[2]) goto LAB_005efc09;
    uVar6 = (uVar8 >> 2) + uVar8;
  }
  FUN_00561ce0(in_ECX,uVar6);
LAB_005efc09:
  in_ECX[1] = uVar8;
  puVar10 = (undefined4 *)(*in_ECX + -8 + uVar8 * 8);
  if (puVar10 != (undefined4 *)0x0) {
    if (param_1 != (GRefCountNTSImpl *)0x0) {
      *(int *)(param_1 + 4) = *(int *)(param_1 + 4) + 1;
    }
    *puVar10 = param_1;
    puVar10[1] = local_74;
  }
  if (param_1 != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release(param_1);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005ef920 : SUB ESP,0x88
005ef926 : MOV EDX,dword ptr [ESP + 0x8c]
005ef92d : PUSH EBX
005ef92e : PUSH EBP
005ef92f : XOR EBX,EBX
005ef931 : MOV EBP,ECX
005ef933 : PUSH ESI
005ef934 : MOV dword ptr [ESP + 0x18],EBP
005ef938 : CMP EDX,EBX
005ef93a : JZ 0x005ef93f
005ef93c : INC dword ptr [EDX + 0x4]
005ef93f : FLDZ
005ef941 : XOR ECX,ECX
005ef943 : FSTP float ptr [ESP + 0x10]
005ef947 : PUSH EDI
005ef948 : MOV dword ptr [ESP + 0x24],EBX
005ef94c : MOV byte ptr [ESP + 0x13],0x1
005ef951 : MOV dword ptr [ESP + 0x8c],ECX
005ef958 : JMP 0x005ef970
005ef960 : MOV ECX,dword ptr [ESP + 0x8c]
005ef967 : JMP 0x005ef970
005ef970 : LEA EAX,[EDX + 0x6c]
005ef973 : CMP EAX,EBX
005ef975 : JZ 0x005efba8
005ef97b : CMP ECX,dword ptr [EAX + 0x4]
005ef97e : JNC 0x005efba8
005ef984 : CMP ECX,EBX
005ef986 : JL 0x005efba8
005ef98c : MOV EAX,dword ptr [EAX]
005ef98e : MOV ESI,dword ptr [EAX + ECX*0x4]
005ef991 : MOV ECX,dword ptr [ESI]
005ef993 : SHR ECX,0x1f
005ef996 : TEST CL,0x1
005ef999 : JZ 0x005ef9a4
005ef99b : MOV EDX,dword ptr [ESI + 0xc]
005ef99e : MOV dword ptr [ESP + 0x18],EDX
005ef9a2 : JMP 0x005ef9ab
005ef9a4 : MOV EAX,dword ptr [ESI + 0xc]
005ef9a7 : MOV dword ptr [ESP + 0x18],EAX
005ef9ab : FILD dword ptr [ESP + 0x18]
005ef9af : FSTP float ptr [ESP + 0x18]
005ef9b3 : CMP byte ptr [ESP + 0x13],BL
005ef9b7 : JNZ 0x005ef9d6
005ef9b9 : FLD float ptr [ESP + 0x18]
005ef9bd : FLD float ptr [ESP + 0x14]
005ef9c1 : FUCOMPP
005ef9c3 : FNSTSW AX
005ef9c5 : TEST AH,0x44
005ef9c8 : JP 0x005ef9de
005ef9ca : PUSH 0xa
005ef9cc : LEA ECX,[EBP + 0xc]
005ef9cf : CALL 0x0051b7e0
005ef9d4 : JMP 0x005ef9de
005ef9d6 : FLD float ptr [ESP + 0x18]
005ef9da : FSTP float ptr [ESP + 0x14]
005ef9de : MOV EAX,dword ptr [ESI]
005ef9e0 : SHR EAX,0x1f
005ef9e3 : AND AL,0x1
005ef9e5 : JZ 0x005ef9ed
005ef9e7 : MOVZX EBP,byte ptr [ESI + 0x1c]
005ef9eb : JMP 0x005ef9f0
005ef9ed : MOV EBP,dword ptr [ESI + 0x4]
005ef9f0 : LEA EDI,[ESI + 0x1e]
005ef9f3 : CMP AL,BL
005ef9f5 : JNZ 0x005ef9fa
005ef9f7 : LEA EDI,[ESI + 0x2a]
005ef9fa : MOV ECX,ESI
005ef9fc : CALL 0x00599240
005efa01 : LEA ECX,[EDI + EBP*0x8]
005efa04 : OR ESI,0xffffffff
005efa07 : MOV dword ptr [ESP + 0x2c],ECX
005efa0b : LEA ECX,[ESP + 0x28]
005efa0f : MOV dword ptr [ESP + 0x40],ESI
005efa13 : MOV dword ptr [ESP + 0x44],EBX
005efa17 : MOV dword ptr [ESP + 0x48],ESI
005efa1b : MOV dword ptr [ESP + 0x4c],EBX
005efa1f : MOV dword ptr [ESP + 0x50],EBX
005efa23 : MOV dword ptr [ESP + 0x54],EBX
005efa27 : MOV dword ptr [ESP + 0x60],EBX
005efa2b : MOV dword ptr [ESP + 0x5c],EBX
005efa2f : MOV dword ptr [ESP + 0x58],EBX
005efa33 : MOV byte ptr [ESP + 0x64],BL
005efa37 : MOV dword ptr [ESP + 0x3c],EBX
005efa3b : MOV dword ptr [ESP + 0x38],EBX
005efa3f : MOV dword ptr [ESP + 0x68],EBX
005efa43 : MOV dword ptr [ESP + 0x6c],EBX
005efa47 : MOV dword ptr [ESP + 0x70],EBX
005efa4b : MOV dword ptr [ESP + 0x74],EBX
005efa4f : MOV dword ptr [ESP + 0x78],EBX
005efa53 : MOV dword ptr [ESP + 0x7c],EBX
005efa57 : MOV dword ptr [ESP + 0x80],EBX
005efa5e : MOV dword ptr [ESP + 0x28],EDI
005efa62 : MOV dword ptr [ESP + 0x30],EAX
005efa66 : CALL 0x0059a4d0
005efa6b : MOV EAX,dword ptr [ESP + 0x74]
005efa6f : CMP EAX,EBX
005efa71 : JZ 0x005efa78
005efa73 : MOV ECX,dword ptr [EAX + 0x14]
005efa76 : JMP 0x005efa7a
005efa78 : XOR ECX,ECX
005efa7a : MOV EDI,dword ptr [ECX + 0xc]
005efa7d : CMP EDI,EBX
005efa7f : JNZ 0x005efa92
005efa81 : MOV ECX,dword ptr [ESP + 0x78]
005efa85 : CMP ECX,EBX
005efa87 : JZ 0x005efb5e
005efa8d : JMP 0x005efb55
005efa92 : MOV EAX,dword ptr [ESP + 0x28]
005efa96 : CMP EAX,EBX
005efa98 : JZ 0x005efb49
005efa9e : CMP EAX,dword ptr [ESP + 0x2c]
005efaa2 : JNC 0x005efb49
005efaa8 : MOVZX EAX,word ptr [EAX]
005efaab : MOV EDX,0xffff
005efab0 : CMP AX,DX
005efab3 : MOVZX EAX,AX
005efab6 : JC 0x005efaba
005efab8 : MOV EAX,ESI
005efaba : MOV EDX,dword ptr [EDI]
005efabc : PUSH EAX
005efabd : MOV EAX,dword ptr [EDX + 0x34]
005efac0 : MOV ECX,EDI
005efac2 : CALL EAX
005efac4 : CMP EAX,ESI
005efac6 : JZ 0x005efad9
005efac8 : MOV ECX,dword ptr [ESP + 0x1c]
005efacc : INC dword ptr [ESP + 0x24]
005efad0 : PUSH EAX
005efad1 : ADD ECX,0xc
005efad4 : CALL 0x0051b7e0
005efad9 : MOV EAX,dword ptr [ESP + 0x28]
005efadd : CMP EAX,EBX
005efadf : JZ 0x005efb49
005efae1 : CMP EAX,dword ptr [ESP + 0x2c]
005efae5 : JNC 0x005efa96
005efae7 : MOV ECX,dword ptr [ESP + 0x80]
005efaee : CMP ECX,EBX
005efaf0 : JNZ 0x005efb00
005efaf2 : MOVZX ECX,word ptr [EAX + 0x4]
005efaf6 : SHR ECX,0xc
005efaf9 : MOV dword ptr [ESP + 0x80],ECX
005efb00 : ADD EAX,0x8
005efb03 : MOV EDX,0xf000
005efb08 : MOV dword ptr [ESP + 0x28],EAX
005efb0c : TEST word ptr [EAX + 0x4],DX
005efb10 : JBE 0x005efb3b
005efb12 : CMP ECX,EBX
005efb14 : JBE 0x005efb3b
005efb16 : LEA ECX,[ESP + 0x34]
005efb1a : CALL 0x005d2b10
005efb1f : TEST AL,AL
005efb21 : JNZ 0x005efb3b
005efb23 : MOV EAX,dword ptr [ESP + 0x80]
005efb2a : PUSH EAX
005efb2b : LEA ECX,[ESP + 0x38]
005efb2f : CALL 0x005d30b0
005efb34 : MOV dword ptr [ESP + 0x80],EBX
005efb3b : LEA ECX,[ESP + 0x28]
005efb3f : CALL 0x0059a4d0
005efb44 : JMP 0x005efa92
005efb49 : MOV ECX,dword ptr [ESP + 0x78]
005efb4d : MOV byte ptr [ESP + 0x13],BL
005efb51 : CMP ECX,EBX
005efb53 : JZ 0x005efb5a
005efb55 : CALL 0x004ff7c0
005efb5a : MOV EAX,dword ptr [ESP + 0x74]
005efb5e : CMP EAX,EBX
005efb60 : JZ 0x005efb77
005efb62 : DEC dword ptr [EAX]
005efb64 : MOV ESI,EAX
005efb66 : CMP dword ptr [ESI],EBX
005efb68 : JNZ 0x005efb77
005efb6a : MOV ECX,ESI
005efb6c : CALL 0x00500860
005efb71 : PUSH ESI
005efb72 : CALL 0x00515cf0
005efb77 : MOV EAX,dword ptr [ESP + 0x9c]
005efb7e : MOV ECX,dword ptr [ESP + 0x8c]
005efb85 : MOV EBP,dword ptr [ESP + 0x1c]
005efb89 : MOV EDX,dword ptr [ESP + 0x9c]
005efb90 : ADD EAX,0x6c
005efb93 : CMP ECX,dword ptr [EAX + 0x4]
005efb96 : JNC 0x005ef960
005efb9c : INC dword ptr [ESP + 0x8c]
005efba3 : JMP 0x005ef960
005efba8 : MOV ESI,dword ptr [EBP + 0x4]
005efbab : MOV EAX,dword ptr [EBP + 0x4]
005efbae : INC ESI
005efbaf : CMP ESI,EAX
005efbb1 : JNC 0x005efbed
005efbb3 : MOV EDI,dword ptr [EBP]
005efbb6 : SUB EAX,ESI
005efbb8 : LEA ECX,[EAX + ESI*0x1]
005efbbb : LEA EDI,[EDI + ECX*0x8 + -0x8]
005efbbf : JZ 0x005efbe1
005efbc1 : MOV dword ptr [ESP + 0x14],EAX
005efbc5 : MOV ECX,dword ptr [EDI]
005efbc7 : CMP ECX,EBX
005efbc9 : JZ 0x005efbd7
005efbcb : CALL 0x004ff7c0
005efbd0 : MOV EDX,dword ptr [ESP + 0x9c]
005efbd7 : SUB EDI,0x8
005efbda : SUB dword ptr [ESP + 0x14],0x1
005efbdf : JNZ 0x005efbc5
005efbe1 : MOV EAX,dword ptr [EBP + 0x8]
005efbe4 : SHR EAX,0x1
005efbe6 : CMP ESI,EAX
005efbe8 : JNC 0x005efc09
005efbea : PUSH ESI
005efbeb : JMP 0x005efbfa
005efbed : CMP ESI,dword ptr [EBP + 0x8]
005efbf0 : JC 0x005efc09
005efbf2 : MOV ECX,ESI
005efbf4 : SHR ECX,0x2
005efbf7 : ADD ECX,ESI
005efbf9 : PUSH ECX
005efbfa : PUSH EBP
005efbfb : MOV ECX,EBP
005efbfd : CALL 0x00561ce0
005efc02 : MOV EDX,dword ptr [ESP + 0x9c]
005efc09 : MOV EAX,dword ptr [EBP]
005efc0c : MOV dword ptr [EBP + 0x4],ESI
005efc0f : LEA ESI,[EAX + ESI*0x8 + -0x8]
005efc13 : POP EDI
005efc14 : CMP ESI,EBX
005efc16 : JZ 0x005efc28
005efc18 : CMP EDX,EBX
005efc1a : JZ 0x005efc1f
005efc1c : INC dword ptr [EDX + 0x4]
005efc1f : MOV ECX,dword ptr [ESP + 0x20]
005efc23 : MOV dword ptr [ESI],EDX
005efc25 : MOV dword ptr [ESI + 0x4],ECX
005efc28 : POP ESI
005efc29 : POP EBP
005efc2a : CMP EDX,EBX
005efc2c : POP EBX
005efc2d : JZ 0x005efc36
005efc2f : MOV ECX,EDX
005efc31 : CALL 0x004ff7c0
005efc36 : ADD ESP,0x88
005efc3c : RET 0x4
