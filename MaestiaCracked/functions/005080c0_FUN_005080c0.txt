PROGRAM  : Maestia.exe
FUNCTION : FUN_005080c0
ENTRY    : 005080c0
BODY     : [[005080c0, 0050814c] [00508150, 005081f7]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005080c0(undefined4 param_1,int param_2,uint param_3)

{
  uint *puVar1;
  int iVar2;
  int *piVar3;
  uint uVar4;
  uint *puVar5;
  int *in_ECX;
  int iVar6;
  uint uVar7;
  int iVar8;
  
  piVar3 = (int *)*in_ECX;
  if (piVar3 == (int *)0x0) {
    iVar8 = 8;
  }
  else {
    if ((uint)(*piVar3 * 5) <= piVar3[1] * 4 + 4U) goto LAB_005080fc;
    iVar8 = piVar3[1] * 2 + 2;
  }
  FUN_005074a0(param_1,iVar8);
LAB_005080fc:
  piVar3 = (int *)*in_ECX;
  param_3 = param_3 & piVar3[1];
  *piVar3 = *piVar3 + 1;
  iVar8 = *in_ECX;
  puVar1 = (uint *)(param_3 * 0x10 + 8 + iVar8);
  if (*puVar1 == 0xfffffffe) {
    *puVar1 = 0xffffffff;
    FUN_0051c600(param_2);
    FUN_0051c600(param_2 + 4);
    puVar1[1] = param_3;
    return;
  }
  uVar7 = param_3;
  do {
    uVar7 = uVar7 + 1 & *(uint *)(iVar8 + 4);
  } while (*(int *)(iVar8 + 8 + uVar7 * 0x10) != -2);
  iVar2 = uVar7 * 0x10 + 8 + iVar8;
  if (puVar1[1] != param_3) {
    iVar6 = puVar1[1] * 0x10;
    uVar4 = *(uint *)(iVar6 + 8 + iVar8);
    while (puVar5 = (uint *)(iVar6 + 8 + iVar8), uVar4 != param_3) {
      iVar6 = *puVar5 * 0x10;
      uVar4 = *(uint *)(iVar6 + 8 + iVar8);
    }
    if (iVar2 != 0) {
      FUN_00503700(puVar1);
    }
    *puVar5 = uVar7;
    FUN_0051bc20(param_2);
    FUN_0051bc20(param_2 + 4);
    puVar1[1] = param_3;
    *puVar1 = 0xffffffff;
    return;
  }
  if (iVar2 != 0) {
    FUN_00503700(puVar1);
  }
  FUN_0051bc20(param_2);
  FUN_0051bc20(param_2 + 4);
  puVar1[1] = param_3;
  *puVar1 = uVar7;
  return;
}



============================================================
DISASSEMBLY
============================================================
005080c0 : PUSH EBX
005080c1 : PUSH EBP
005080c2 : PUSH ESI
005080c3 : MOV ESI,ECX
005080c5 : MOV EAX,dword ptr [ESI]
005080c7 : PUSH EDI
005080c8 : TEST EAX,EAX
005080ca : JNZ 0x005080d5
005080cc : MOV EAX,dword ptr [ESP + 0x14]
005080d0 : PUSH 0x8
005080d2 : PUSH EAX
005080d3 : JMP 0x005080f7
005080d5 : MOV ECX,dword ptr [EAX + 0x4]
005080d8 : LEA EDX,[ECX*0x4 + 0x4]
005080df : MOV ECX,dword ptr [EAX]
005080e1 : LEA ECX,[ECX + ECX*0x4]
005080e4 : CMP ECX,EDX
005080e6 : JBE 0x005080fc
005080e8 : MOV EDX,dword ptr [EAX + 0x4]
005080eb : MOV ECX,dword ptr [ESP + 0x14]
005080ef : LEA EAX,[EDX + EDX*0x1 + 0x2]
005080f3 : PUSH EAX
005080f4 : PUSH ECX
005080f5 : MOV ECX,ESI
005080f7 : CALL 0x005074a0
005080fc : MOV EAX,dword ptr [ESI]
005080fe : MOV EDI,dword ptr [ESP + 0x1c]
00508102 : AND EDI,dword ptr [EAX + 0x4]
00508105 : INC dword ptr [EAX]
00508107 : MOV EAX,dword ptr [ESI]
00508109 : MOV EDX,EDI
0050810b : SHL EDX,0x4
0050810e : LEA ESI,[EDX + EAX*0x1 + 0x8]
00508112 : MOV EDX,0xfffffffe
00508117 : CMP dword ptr [ESI],EDX
00508119 : JNZ 0x00508146
0050811b : MOV EBP,dword ptr [ESP + 0x18]
0050811f : LEA EBX,[ESI + 0x8]
00508122 : PUSH EBP
00508123 : MOV ECX,EBX
00508125 : MOV dword ptr [ESI],0xffffffff
0050812b : CALL 0x0051c600
00508130 : ADD EBP,0x4
00508133 : PUSH EBP
00508134 : LEA ECX,[EBX + 0x4]
00508137 : CALL 0x0051c600
0050813c : MOV dword ptr [ESI + 0x4],EDI
0050813f : POP EDI
00508140 : POP ESI
00508141 : POP EBP
00508142 : POP EBX
00508143 : RET 0xc
00508146 : MOV ECX,dword ptr [EAX + 0x4]
00508149 : MOV EBX,EDI
0050814b : JMP 0x00508150
00508150 : INC EBX
00508151 : AND EBX,ECX
00508153 : MOV EBP,EBX
00508155 : SHL EBP,0x4
00508158 : CMP dword ptr [EAX + EBP*0x1 + 0x8],EDX
0050815c : JNZ 0x00508150
0050815e : MOV EDX,dword ptr [ESI + 0x4]
00508161 : MOV ECX,EBX
00508163 : SHL ECX,0x4
00508166 : LEA ECX,[ECX + EAX*0x1 + 0x8]
0050816a : CMP EDX,EDI
0050816c : JNZ 0x005081a3
0050816e : TEST ECX,ECX
00508170 : JZ 0x00508178
00508172 : PUSH ESI
00508173 : CALL 0x00503700
00508178 : MOV EDX,dword ptr [ESP + 0x18]
0050817c : LEA EBP,[ESI + 0x8]
0050817f : PUSH EDX
00508180 : MOV ECX,EBP
00508182 : CALL 0x0051bc20
00508187 : MOV EAX,dword ptr [ESP + 0x18]
0050818b : ADD EAX,0x4
0050818e : PUSH EAX
0050818f : LEA ECX,[EBP + 0x4]
00508192 : CALL 0x0051bc20
00508197 : MOV dword ptr [ESI + 0x4],EDI
0050819a : POP EDI
0050819b : MOV dword ptr [ESI],EBX
0050819d : POP ESI
0050819e : POP EBP
0050819f : POP EBX
005081a0 : RET 0xc
005081a3 : SHL EDX,0x4
005081a6 : CMP dword ptr [EDX + EAX*0x1 + 0x8],EDI
005081aa : LEA EBP,[EDX + EAX*0x1 + 0x8]
005081ae : JZ 0x005081c0
005081b0 : MOV EDX,dword ptr [EBP]
005081b3 : SHL EDX,0x4
005081b6 : CMP dword ptr [EDX + EAX*0x1 + 0x8],EDI
005081ba : LEA EBP,[EDX + EAX*0x1 + 0x8]
005081be : JNZ 0x005081b0
005081c0 : TEST ECX,ECX
005081c2 : JZ 0x005081ca
005081c4 : PUSH ESI
005081c5 : CALL 0x00503700
005081ca : MOV dword ptr [EBP],EBX
005081cd : MOV EBP,dword ptr [ESP + 0x18]
005081d1 : LEA EBX,[ESI + 0x8]
005081d4 : PUSH EBP
005081d5 : MOV ECX,EBX
005081d7 : CALL 0x0051bc20
005081dc : ADD EBP,0x4
005081df : PUSH EBP
005081e0 : LEA ECX,[EBX + 0x4]
005081e3 : CALL 0x0051bc20
005081e8 : MOV dword ptr [ESI + 0x4],EDI
005081eb : POP EDI
005081ec : MOV dword ptr [ESI],0xffffffff
005081f2 : POP ESI
005081f3 : POP EBP
005081f4 : POP EBX
005081f5 : RET 0xc
