PROGRAM  : Maestia.exe
FUNCTION : FUN_008a7060
ENTRY    : 008a7060
BODY     : [[008a7060, 008a7200]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008a7060(int param_1)

{
  int iVar1;
  undefined4 uVar2;
  uint8_t *puVar3;
  byte bVar4;
  int *piVar5;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  piVar5 = DAT_00da9894;
  puStack_c = &LAB_00b3e1b0;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  if (param_1 == 0) {
    if (*DAT_00da9894 != 0) {
      iVar1 = *(int *)ThreadLocalStoragePointer;
      bVar4 = (byte)((ulonglong)(*(byte *)(iVar1 + 0x18) + 1) % 3);
      *(byte *)(iVar1 + 0x18) = bVar4;
      puVar3 = (uint8_t *)((uint)bVar4 * 0x2000 + 0x122cb8 + iVar1);
      if (puVar3 == (uint8_t *)0x0) {
        puVar3 = (uint8_t *)0x0;
      }
      else {
        *(undefined4 *)(puVar3 + 8) = *(undefined4 *)(*(int *)(*piVar5 + 0x1c8) + 0xc0);
        puVar3[2] = 'F';
        puVar3[3] = 'S';
        puVar3[4] = '\0';
        puVar3[5] = '\0';
        puVar3[6] = '\0';
        puVar3[7] = '\0';
        puVar3[0xc] = '\x01';
        puVar3[0xd] = '\0';
        puVar3[0xe] = '\0';
        puVar3[0xf] = '\0';
        puVar3[0] = '\x10';
        puVar3[1] = '\0';
      }
      local_8 = 0xffffffff;
      if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
        FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),0x10,puVar3);
        piVar5 = DAT_00da9894;
      }
      *(undefined4 *)(*(int *)(*piVar5 + 0x1c8) + 0xc0) = 0;
    }
  }
  else if (param_1 == 1) {
    iVar1 = *(int *)ThreadLocalStoragePointer;
    bVar4 = (byte)((ulonglong)(*(byte *)(iVar1 + 0x18) + 1) % 3);
    *(byte *)(iVar1 + 0x18) = bVar4;
    puVar3 = (uint8_t *)((uint)bVar4 * 0x2000 + 0x122cb8 + iVar1);
    if (puVar3 == (uint8_t *)0x0) {
      puVar3 = (uint8_t *)0x0;
    }
    else {
      uVar2 = *(undefined4 *)(*(int *)(*DAT_00da9894 + 0x1c8) + 0xc0);
      puVar3[2] = 'F';
      puVar3[3] = 'S';
      puVar3[4] = '\0';
      puVar3[5] = '\0';
      puVar3[6] = '\0';
      puVar3[7] = '\0';
      *(undefined4 *)(puVar3 + 8) = uVar2;
      puVar3[0xc] = '\0';
      puVar3[0xd] = '\0';
      puVar3[0xe] = '\0';
      puVar3[0xf] = '\0';
      puVar3[0] = '\x10';
      puVar3[1] = '\0';
    }
    local_8 = 0xffffffff;
    if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
      FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),0x10,puVar3);
    }
    *(undefined4 *)(*(int *)(*DAT_00da9894 + 0x1c8) + 0xc0) = 0;
    ExceptionList = local_10;
    return;
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
008a7060 : PUSH EBP
008a7061 : MOV EBP,ESP
008a7063 : PUSH -0x1
008a7065 : PUSH 0xb3e1b0
008a706a : MOV EAX,FS:[0x0]
008a7070 : PUSH EAX
008a7071 : PUSH ECX
008a7072 : PUSH EBX
008a7073 : PUSH ESI
008a7074 : PUSH EDI
008a7075 : MOV EAX,[0x00d66fa0]
008a707a : XOR EAX,EBP
008a707c : PUSH EAX
008a707d : LEA EAX,[EBP + -0xc]
008a7080 : MOV FS:[0x0],EAX
008a7086 : MOV EAX,dword ptr [EBP + 0x8]
008a7089 : XOR EBX,EBX
008a708b : SUB EAX,EBX
008a708d : JZ 0x008a714a
008a7093 : SUB EAX,0x1
008a7096 : JNZ 0x008a71ed
008a709c : MOV EAX,FS:[0x2c]
008a70a2 : MOV ECX,dword ptr [EAX]
008a70a4 : MOVZX EAX,byte ptr [ECX + 0x18]
008a70a8 : INC EAX
008a70a9 : CDQ
008a70aa : MOV ESI,0x3
008a70af : IDIV ESI
008a70b1 : MOV byte ptr [ECX + 0x18],DL
008a70b4 : MOVZX EDX,DL
008a70b7 : SHL EDX,0xd
008a70ba : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
008a70c1 : MOV dword ptr [EBP + 0x8],EAX
008a70c4 : MOV dword ptr [EBP + -0x4],0x1
008a70cb : CMP EAX,EBX
008a70cd : JZ 0x008a70fe
008a70cf : MOV ECX,dword ptr [0x00da9894]
008a70d5 : MOV ECX,dword ptr [ECX]
008a70d7 : MOV ECX,dword ptr [ECX + 0x1c8]
008a70dd : MOV ECX,dword ptr [ECX + 0xc0]
008a70e3 : MOV EDX,0x10
008a70e8 : MOV byte ptr [EAX + 0x2],0x46
008a70ec : MOV byte ptr [EAX + 0x3],0x53
008a70f0 : MOV dword ptr [EAX + 0x4],EBX
008a70f3 : MOV dword ptr [EAX + 0x8],ECX
008a70f6 : MOV dword ptr [EAX + 0xc],EBX
008a70f9 : MOV word ptr [EAX],DX
008a70fc : JMP 0x008a7100
008a70fe : XOR EAX,EAX
008a7100 : MOV dword ptr [EBP + -0x4],0xffffffff
008a7107 : MOV EDX,dword ptr [0x017247d4]
008a710d : MOV ECX,dword ptr [EDX + 0x4]
008a7110 : CMP ECX,EBX
008a7112 : JZ 0x008a7123
008a7114 : CMP byte ptr [EDX + 0x8],BL
008a7117 : JZ 0x008a7123
008a7119 : PUSH 0x10
008a711b : PUSH ECX
008a711c : MOV EDI,EAX
008a711e : CALL 0x00a0dd40
008a7123 : MOV EAX,[0x00da9894]
008a7128 : MOV ECX,dword ptr [EAX]
008a712a : MOV EDX,dword ptr [ECX + 0x1c8]
008a7130 : MOV dword ptr [EDX + 0xc0],EBX
008a7136 : MOV ECX,dword ptr [EBP + -0xc]
008a7139 : MOV dword ptr FS:[0x0],ECX
008a7140 : POP ECX
008a7141 : POP EDI
008a7142 : POP ESI
008a7143 : POP EBX
008a7144 : MOV ESP,EBP
008a7146 : POP EBP
008a7147 : RET 0x8
008a714a : MOV ESI,dword ptr [0x00da9894]
008a7150 : CMP dword ptr [ESI],EBX
008a7152 : JZ 0x008a71ed
008a7158 : MOV EAX,FS:[0x2c]
008a715e : MOV ECX,dword ptr [EAX]
008a7160 : MOVZX EAX,byte ptr [ECX + 0x18]
008a7164 : INC EAX
008a7165 : CDQ
008a7166 : MOV EDI,0x3
008a716b : IDIV EDI
008a716d : MOV byte ptr [ECX + 0x18],DL
008a7170 : MOVZX EDX,DL
008a7173 : SHL EDX,0xd
008a7176 : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
008a717d : MOV dword ptr [EBP + 0x8],EAX
008a7180 : MOV dword ptr [EBP + -0x4],EBX
008a7183 : CMP EAX,EBX
008a7185 : JZ 0x008a71b4
008a7187 : MOV ECX,dword ptr [ESI]
008a7189 : MOV ECX,dword ptr [ECX + 0x1c8]
008a718f : MOV ECX,dword ptr [ECX + 0xc0]
008a7195 : MOV dword ptr [EAX + 0x8],ECX
008a7198 : MOV ECX,0x10
008a719d : MOV byte ptr [EAX + 0x2],0x46
008a71a1 : MOV byte ptr [EAX + 0x3],0x53
008a71a5 : MOV dword ptr [EAX + 0x4],EBX
008a71a8 : MOV dword ptr [EAX + 0xc],0x1
008a71af : MOV word ptr [EAX],CX
008a71b2 : JMP 0x008a71b6
008a71b4 : XOR EAX,EAX
008a71b6 : MOV dword ptr [EBP + -0x4],0xffffffff
008a71bd : MOV EDX,dword ptr [0x017247d4]
008a71c3 : MOV ECX,dword ptr [EDX + 0x4]
008a71c6 : CMP ECX,EBX
008a71c8 : JZ 0x008a71df
008a71ca : CMP byte ptr [EDX + 0x8],BL
008a71cd : JZ 0x008a71df
008a71cf : PUSH 0x10
008a71d1 : PUSH ECX
008a71d2 : MOV EDI,EAX
008a71d4 : CALL 0x00a0dd40
008a71d9 : MOV ESI,dword ptr [0x00da9894]
008a71df : MOV EDX,dword ptr [ESI]
008a71e1 : MOV EAX,dword ptr [EDX + 0x1c8]
008a71e7 : MOV dword ptr [EAX + 0xc0],EBX
008a71ed : MOV ECX,dword ptr [EBP + -0xc]
008a71f0 : MOV dword ptr FS:[0x0],ECX
008a71f7 : POP ECX
008a71f8 : POP EDI
008a71f9 : POP ESI
008a71fa : POP EBX
008a71fb : MOV ESP,EBP
008a71fd : POP EBP
008a71fe : RET 0x8
