PROGRAM  : Maestia.exe
FUNCTION : FUN_00697270
ENTRY    : 00697270
BODY     : [[00697270, 00697486]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00697270(int param_1,int param_2)

{
  int *piVar1;
  undefined2 uVar2;
  uint uVar3;
  int iVar4;
  uint uVar5;
  ushort uVar6;
  ushort uVar7;
  uint uVar8;
  int iVar9;
  undefined4 *puVar10;
  undefined4 uVar11;
  int local_18;
  undefined4 local_14;
  undefined4 *local_10;
  int local_c;
  uint local_8;
  uint local_4;
  
  uVar11 = *(undefined4 *)(param_2 + 0x1c);
  local_10 = (undefined4 *)0x0;
  local_14 = uVar11;
  uVar3 = FUN_00687a80(param_2,&local_18);
  uVar3 = uVar3 & 0xffff;
  if (local_18 != 0) {
    return local_18;
  }
  if (*(ushort *)(param_1 + 0x108) < uVar3) {
    return 3;
  }
  local_8 = uVar3;
  iVar4 = FUN_0068a220(uVar11,2,0,uVar3,0,&local_18);
  local_c = iVar4;
  if ((local_18 == 0) && (local_18 = FUN_00688900(param_2,uVar3 * 2), local_18 == 0)) {
    iVar9 = 0;
    if (uVar3 != 0) {
      do {
        uVar2 = FUN_00687940(param_2);
        *(undefined2 *)(iVar4 + iVar9 * 2) = uVar2;
        iVar9 = iVar9 + 1;
      } while (iVar9 < (int)uVar3);
    }
    FUN_006889b0(param_2);
    uVar8 = 0;
    iVar9 = 0;
    if (uVar3 != 0) {
      do {
        uVar5 = (uint)*(ushort *)(iVar4 + iVar9 * 2);
        if ((0x101 < uVar5) && (uVar5 = uVar5 - 0x101, (int)uVar8 < (int)uVar5)) {
          uVar8 = uVar5 & 0xffff;
        }
        iVar9 = iVar9 + 1;
      } while (iVar9 < (int)uVar3);
    }
    local_4 = uVar8;
    local_10 = (undefined4 *)FUN_0068a220(local_14,4,0,uVar8,0,&local_18);
    uVar11 = local_14;
    if (local_18 == 0) {
      uVar7 = (ushort)uVar8;
      if (uVar7 != 0) {
        uVar6 = 0;
        do {
          uVar8 = FUN_00687a20(param_2,&local_18);
          uVar8 = uVar8 & 0xff;
          puVar10 = local_10;
          uVar3 = local_4;
          if (local_18 != 0) goto LAB_00697440;
          iVar4 = FUN_0068a220(local_14,1,0,uVar8 + 1,0,&local_18);
          piVar1 = local_10 + uVar6;
          *piVar1 = iVar4;
          puVar10 = local_10;
          uVar3 = local_4;
          if ((local_18 != 0) ||
             (local_18 = FUN_006888a0(param_2,iVar4,uVar8), puVar10 = local_10, uVar3 = local_4,
             local_18 != 0)) goto LAB_00697440;
          uVar6 = uVar6 + 1;
          *(undefined1 *)(uVar8 + *piVar1) = 0;
          uVar3 = local_8;
        } while (uVar6 < uVar7);
      }
      *(short *)(param_1 + 0x278) = (short)uVar3;
      *(ushort *)(param_1 + 0x27a) = uVar7;
      *(int *)(param_1 + 0x27c) = local_c;
      *(undefined4 **)(param_1 + 0x280) = local_10;
      return 0;
    }
  }
LAB_00697466:
  FUN_00687f30(uVar11,local_10);
  FUN_00687f30(uVar11,iVar4);
  return local_18;
LAB_00697440:
  do {
    FUN_00687f30(local_14,*puVar10);
    *puVar10 = 0;
    uVar3 = uVar3 - 1;
    iVar4 = local_c;
    puVar10 = puVar10 + 1;
    uVar11 = local_14;
  } while (uVar3 != 0);
  goto LAB_00697466;
}



============================================================
DISASSEMBLY
============================================================
00697270 : SUB ESP,0x18
00697273 : PUSH EBX
00697274 : PUSH EBP
00697275 : MOV EBP,dword ptr [ESP + 0x28]
00697279 : PUSH ESI
0069727a : MOV ESI,dword ptr [EBP + 0x1c]
0069727d : PUSH EDI
0069727e : LEA EAX,[ESP + 0x10]
00697282 : PUSH EAX
00697283 : PUSH EBP
00697284 : MOV dword ptr [ESP + 0x1c],ESI
00697288 : MOV dword ptr [ESP + 0x20],0x0
00697290 : CALL 0x00687a80
00697295 : MOVZX EDI,AX
00697298 : MOV EAX,dword ptr [ESP + 0x18]
0069729c : ADD ESP,0x8
0069729f : MOV dword ptr [ESP + 0x20],EDI
006972a3 : TEST EAX,EAX
006972a5 : JNZ 0x0069747f
006972ab : MOV ECX,dword ptr [ESP + 0x2c]
006972af : MOVZX EDX,word ptr [ECX + 0x108]
006972b6 : CMP EDI,EDX
006972b8 : JLE 0x006972c7
006972ba : POP EDI
006972bb : POP ESI
006972bc : POP EBP
006972bd : MOV EAX,0x3
006972c2 : POP EBX
006972c3 : ADD ESP,0x18
006972c6 : RET
006972c7 : LEA EAX,[ESP + 0x10]
006972cb : PUSH EAX
006972cc : PUSH 0x0
006972ce : PUSH EDI
006972cf : PUSH 0x0
006972d1 : PUSH 0x2
006972d3 : PUSH ESI
006972d4 : CALL 0x0068a220
006972d9 : ADD ESP,0x18
006972dc : CMP dword ptr [ESP + 0x10],0x0
006972e1 : MOV EBX,EAX
006972e3 : MOV dword ptr [ESP + 0x1c],EBX
006972e7 : JNZ 0x00697466
006972ed : LEA ECX,[EDI + EDI*0x1]
006972f0 : PUSH ECX
006972f1 : PUSH EBP
006972f2 : CALL 0x00688900
006972f7 : ADD ESP,0x8
006972fa : MOV dword ptr [ESP + 0x10],EAX
006972fe : TEST EAX,EAX
00697300 : JNZ 0x00697466
00697306 : XOR ESI,ESI
00697308 : TEST EDI,EDI
0069730a : JLE 0x00697322
0069730c : LEA ESP,[ESP]
00697310 : PUSH EBP
00697311 : CALL 0x00687940
00697316 : MOV word ptr [EBX + ESI*0x2],AX
0069731a : INC ESI
0069731b : ADD ESP,0x4
0069731e : CMP ESI,EDI
00697320 : JL 0x00697310
00697322 : PUSH EBP
00697323 : CALL 0x006889b0
00697328 : ADD ESP,0x4
0069732b : XOR EBP,EBP
0069732d : XOR ECX,ECX
0069732f : TEST EDI,EDI
00697331 : JLE 0x00697352
00697333 : MOVZX EAX,word ptr [EBX + ECX*0x2]
00697337 : CMP EAX,0x102
0069733c : JL 0x0069734d
0069733e : MOVZX EDX,BP
00697341 : SUB EAX,0x101
00697346 : CMP EAX,EDX
00697348 : JLE 0x0069734d
0069734a : MOVZX EBP,AX
0069734d : INC ECX
0069734e : CMP ECX,EDI
00697350 : JL 0x00697333
00697352 : MOV EDX,dword ptr [ESP + 0x14]
00697356 : LEA ECX,[ESP + 0x10]
0069735a : PUSH ECX
0069735b : MOVZX EAX,BP
0069735e : PUSH 0x0
00697360 : PUSH EAX
00697361 : PUSH 0x0
00697363 : PUSH 0x4
00697365 : PUSH EDX
00697366 : MOV dword ptr [ESP + 0x3c],EAX
0069736a : CALL 0x0068a220
0069736f : ADD ESP,0x18
00697372 : CMP dword ptr [ESP + 0x10],0x0
00697377 : MOV dword ptr [ESP + 0x18],EAX
0069737b : JNZ 0x00697462
00697381 : XOR EAX,EAX
00697383 : XOR EBX,EBX
00697385 : CMP AX,BP
00697388 : JNC 0x00697405
0069738a : LEA EBX,[EBX]
00697390 : MOV EDX,dword ptr [ESP + 0x30]
00697394 : LEA ECX,[ESP + 0x10]
00697398 : PUSH ECX
00697399 : PUSH EDX
0069739a : CALL 0x00687a20
0069739f : ADD ESP,0x8
006973a2 : CMP dword ptr [ESP + 0x10],0x0
006973a7 : MOVZX ESI,AL
006973aa : JNZ 0x00697435
006973b0 : MOV EDX,dword ptr [ESP + 0x14]
006973b4 : LEA EAX,[ESP + 0x10]
006973b8 : PUSH EAX
006973b9 : PUSH 0x0
006973bb : LEA ECX,[ESI + 0x1]
006973be : PUSH ECX
006973bf : PUSH 0x0
006973c1 : PUSH 0x1
006973c3 : PUSH EDX
006973c4 : CALL 0x0068a220
006973c9 : MOV EDX,dword ptr [ESP + 0x30]
006973cd : MOVZX ECX,BX
006973d0 : LEA EDI,[EDX + ECX*0x4]
006973d3 : ADD ESP,0x18
006973d6 : MOV dword ptr [EDI],EAX
006973d8 : CMP dword ptr [ESP + 0x10],0x0
006973dd : JNZ 0x00697435
006973df : PUSH ESI
006973e0 : PUSH EAX
006973e1 : MOV EAX,dword ptr [ESP + 0x38]
006973e5 : PUSH EAX
006973e6 : CALL 0x006888a0
006973eb : ADD ESP,0xc
006973ee : MOV dword ptr [ESP + 0x10],EAX
006973f2 : TEST EAX,EAX
006973f4 : JNZ 0x00697435
006973f6 : MOV ECX,dword ptr [EDI]
006973f8 : INC EBX
006973f9 : MOV byte ptr [ESI + ECX*0x1],AL
006973fc : CMP BX,BP
006973ff : JC 0x00697390
00697401 : MOV EDI,dword ptr [ESP + 0x20]
00697405 : MOV EAX,dword ptr [ESP + 0x2c]
00697409 : MOV ECX,dword ptr [ESP + 0x1c]
0069740d : MOV EDX,dword ptr [ESP + 0x18]
00697411 : MOV word ptr [EAX + 0x278],DI
00697418 : POP EDI
00697419 : POP ESI
0069741a : MOV word ptr [EAX + 0x27a],BP
00697421 : POP EBP
00697422 : MOV dword ptr [EAX + 0x27c],ECX
00697428 : MOV dword ptr [EAX + 0x280],EDX
0069742e : XOR EAX,EAX
00697430 : POP EBX
00697431 : ADD ESP,0x18
00697434 : RET
00697435 : MOV ESI,dword ptr [ESP + 0x18]
00697439 : MOV EDI,dword ptr [ESP + 0x24]
0069743d : LEA ECX,[ECX]
00697440 : MOV EDX,dword ptr [ESI]
00697442 : MOV EAX,dword ptr [ESP + 0x14]
00697446 : PUSH EDX
00697447 : PUSH EAX
00697448 : CALL 0x00687f30
0069744d : MOV dword ptr [ESI],0x0
00697453 : ADD ESP,0x8
00697456 : ADD ESI,0x4
00697459 : SUB EDI,0x1
0069745c : JNZ 0x00697440
0069745e : MOV EBX,dword ptr [ESP + 0x1c]
00697462 : MOV ESI,dword ptr [ESP + 0x14]
00697466 : MOV EAX,dword ptr [ESP + 0x18]
0069746a : PUSH EAX
0069746b : PUSH ESI
0069746c : CALL 0x00687f30
00697471 : PUSH EBX
00697472 : PUSH ESI
00697473 : CALL 0x00687f30
00697478 : MOV EAX,dword ptr [ESP + 0x20]
0069747c : ADD ESP,0x10
0069747f : POP EDI
00697480 : POP ESI
00697481 : POP EBP
00697482 : POP EBX
00697483 : ADD ESP,0x18
00697486 : RET
