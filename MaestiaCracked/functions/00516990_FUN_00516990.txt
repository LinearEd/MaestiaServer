PROGRAM  : Maestia.exe
FUNCTION : FUN_00516990
ENTRY    : 00516990
BODY     : [[00516990, 00516a8f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00516990(undefined4 param_1,uint *param_2,uint param_3)

{
  uint *puVar1;
  uint *puVar2;
  int *piVar3;
  int iVar4;
  uint uVar5;
  int *in_ECX;
  uint uVar6;
  int iVar7;
  
  piVar3 = (int *)*in_ECX;
  if (piVar3 == (int *)0x0) {
    iVar7 = 8;
  }
  else {
    if ((uint)(*piVar3 * 5) <= piVar3[1] * 4 + 4U) goto LAB_005169ca;
    iVar7 = piVar3[1] * 2 + 2;
  }
  FUN_00516bc0(param_1,iVar7);
LAB_005169ca:
  piVar3 = (int *)*in_ECX;
  param_3 = param_3 & piVar3[1];
  *piVar3 = *piVar3 + 1;
  iVar7 = *in_ECX;
  iVar4 = *(int *)(iVar7 + 8 + param_3 * 0xc);
  puVar1 = (uint *)(iVar7 + 8 + param_3 * 0xc);
  if (iVar4 == -2) {
    *puVar1 = 0xffffffff;
    puVar1[2] = *param_2;
    puVar1[1] = param_3;
    return;
  }
  uVar6 = param_3;
  do {
    uVar6 = uVar6 + 1 & *(uint *)(iVar7 + 4);
  } while (*(int *)(iVar7 + 8 + uVar6 * 0xc) != -2);
  piVar3 = (int *)(iVar7 + 8 + uVar6 * 0xc);
  uVar5 = puVar1[1];
  if (uVar5 != param_3) {
    puVar2 = (uint *)(iVar7 + 8 + uVar5 * 0xc);
    for (uVar5 = *(uint *)(iVar7 + 8 + uVar5 * 0xc); uVar5 != param_3;
        uVar5 = *(uint *)(iVar7 + 8 + uVar5 * 0xc)) {
      uVar5 = *puVar2;
      puVar2 = (uint *)(iVar7 + 8 + uVar5 * 0xc);
    }
    if (piVar3 != (int *)0x0) {
      *piVar3 = iVar4;
      piVar3[1] = puVar1[1];
      piVar3[2] = puVar1[2];
    }
    *puVar2 = uVar6;
    puVar1[2] = *param_2;
    *puVar1 = 0xffffffff;
    puVar1[1] = param_3;
    return;
  }
  if (piVar3 != (int *)0x0) {
    *piVar3 = iVar4;
    piVar3[1] = puVar1[1];
    piVar3[2] = puVar1[2];
  }
  puVar1[2] = *param_2;
  *puVar1 = uVar6;
  puVar1[1] = param_3;
  return;
}



============================================================
DISASSEMBLY
============================================================
00516990 : PUSH EBP
00516991 : PUSH ESI
00516992 : MOV ESI,ECX
00516994 : MOV EAX,dword ptr [ESI]
00516996 : TEST EAX,EAX
00516998 : JNZ 0x005169a3
0051699a : MOV EAX,dword ptr [ESP + 0xc]
0051699e : PUSH 0x8
005169a0 : PUSH EAX
005169a1 : JMP 0x005169c5
005169a3 : MOV ECX,dword ptr [EAX + 0x4]
005169a6 : LEA EDX,[ECX*0x4 + 0x4]
005169ad : MOV ECX,dword ptr [EAX]
005169af : LEA ECX,[ECX + ECX*0x4]
005169b2 : CMP ECX,EDX
005169b4 : JBE 0x005169ca
005169b6 : MOV EDX,dword ptr [EAX + 0x4]
005169b9 : MOV ECX,dword ptr [ESP + 0xc]
005169bd : LEA EAX,[EDX + EDX*0x1 + 0x2]
005169c1 : PUSH EAX
005169c2 : PUSH ECX
005169c3 : MOV ECX,ESI
005169c5 : CALL 0x00516bc0
005169ca : MOV ECX,dword ptr [ESI]
005169cc : MOV EAX,dword ptr [ESP + 0x14]
005169d0 : AND EAX,dword ptr [ECX + 0x4]
005169d3 : INC dword ptr [ECX]
005169d5 : MOV ESI,dword ptr [ESI]
005169d7 : LEA EDX,[EAX + EAX*0x2]
005169da : MOV EBP,dword ptr [ESI + EDX*0x4 + 0x8]
005169de : LEA ECX,[ESI + EDX*0x4 + 0x8]
005169e2 : CMP EBP,-0x2
005169e5 : JNZ 0x005169fe
005169e7 : MOV EDX,dword ptr [ESP + 0x10]
005169eb : MOV dword ptr [ECX],0xffffffff
005169f1 : MOV EDX,dword ptr [EDX]
005169f3 : POP ESI
005169f4 : MOV dword ptr [ECX + 0x8],EDX
005169f7 : MOV dword ptr [ECX + 0x4],EAX
005169fa : POP EBP
005169fb : RET 0xc
005169fe : PUSH EDI
005169ff : MOV EDI,dword ptr [ESI + 0x4]
00516a02 : MOV EDX,EAX
00516a04 : PUSH EBX
00516a05 : INC EDX
00516a06 : AND EDX,EDI
00516a08 : LEA EBX,[EDX + EDX*0x2]
00516a0b : CMP dword ptr [ESI + EBX*0x4 + 0x8],-0x2
00516a10 : JNZ 0x00516a05
00516a12 : LEA EDI,[EDX + EDX*0x2]
00516a15 : LEA EBX,[ESI + EDI*0x4 + 0x8]
00516a19 : MOV EDI,dword ptr [ECX + 0x4]
00516a1c : CMP EDI,EAX
00516a1e : JNZ 0x00516a47
00516a20 : TEST EBX,EBX
00516a22 : JZ 0x00516a32
00516a24 : MOV dword ptr [EBX],EBP
00516a26 : MOV ESI,dword ptr [ECX + 0x4]
00516a29 : MOV dword ptr [EBX + 0x4],ESI
00516a2c : MOV ESI,dword ptr [ECX + 0x8]
00516a2f : MOV dword ptr [EBX + 0x8],ESI
00516a32 : MOV ESI,dword ptr [ESP + 0x18]
00516a36 : MOV ESI,dword ptr [ESI]
00516a38 : POP EBX
00516a39 : POP EDI
00516a3a : MOV dword ptr [ECX + 0x8],ESI
00516a3d : POP ESI
00516a3e : MOV dword ptr [ECX],EDX
00516a40 : MOV dword ptr [ECX + 0x4],EAX
00516a43 : POP EBP
00516a44 : RET 0xc
00516a47 : LEA EDI,[EDI + EDI*0x2]
00516a4a : CMP dword ptr [ESI + EDI*0x4 + 0x8],EAX
00516a4e : LEA EDI,[ESI + EDI*0x4 + 0x8]
00516a52 : JZ 0x00516a63
00516a54 : MOV EDI,dword ptr [EDI]
00516a56 : LEA EDI,[EDI + EDI*0x2]
00516a59 : CMP dword ptr [ESI + EDI*0x4 + 0x8],EAX
00516a5d : LEA EDI,[ESI + EDI*0x4 + 0x8]
00516a61 : JNZ 0x00516a54
00516a63 : TEST EBX,EBX
00516a65 : JZ 0x00516a75
00516a67 : MOV dword ptr [EBX],EBP
00516a69 : MOV ESI,dword ptr [ECX + 0x4]
00516a6c : MOV dword ptr [EBX + 0x4],ESI
00516a6f : MOV ESI,dword ptr [ECX + 0x8]
00516a72 : MOV dword ptr [EBX + 0x8],ESI
00516a75 : MOV dword ptr [EDI],EDX
00516a77 : MOV EDX,dword ptr [ESP + 0x18]
00516a7b : MOV EDX,dword ptr [EDX]
00516a7d : POP EBX
00516a7e : POP EDI
00516a7f : POP ESI
00516a80 : MOV dword ptr [ECX + 0x8],EDX
00516a83 : MOV dword ptr [ECX],0xffffffff
00516a89 : MOV dword ptr [ECX + 0x4],EAX
00516a8c : POP EBP
00516a8d : RET 0xc
