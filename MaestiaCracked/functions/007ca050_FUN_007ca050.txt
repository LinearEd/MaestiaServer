PROGRAM  : Maestia.exe
FUNCTION : FUN_007ca050
ENTRY    : 007ca050
BODY     : [[007ca050, 007ca2d6]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_007ca050(void)

{
  int *piVar1;
  int iVar2;
  BOOL BVar3;
  uint uVar4;
  int unaff_EDI;
  tagMSG local_30;
  undefined4 local_14;
  undefined4 local_10;
  undefined1 local_c [4];
  int local_8;
  
  piVar1 = *(int **)(unaff_EDI + 4);
  if ((piVar1 != (int *)0x0) && (iVar2 = (**(code **)(*piVar1 + 0x1c))(piVar1), -1 < iVar2)) {
    ShowCursor(0);
    piVar1 = *(int **)(unaff_EDI + 0xc);
    if ((piVar1 != (int *)0x0) && (iVar2 = (**(code **)(*piVar1 + 0x1c))(piVar1,local_c), iVar2 < 0)
       ) {
      piVar1 = *(int **)(unaff_EDI + 4);
      if (piVar1 != (int *)0x0) {
        (**(code **)(*piVar1 + 0x24))(piVar1);
      }
      *(undefined1 *)(unaff_EDI + 0x34) = 0;
      FUN_007c9a60();
      *(undefined1 *)(unaff_EDI + 0x34) = 0;
      ShowCursor(1);
      FUN_008018d0(L"Failed getEvemtGamdle");
    }
    if (*(char *)(unaff_EDI + 0x34) == '\x01') {
      while( true ) {
        WaitForSingleObject(local_c,0xffffffff);
        piVar1 = *(int **)(unaff_EDI + 0xc);
        if ((piVar1 != (int *)0x0) &&
           (iVar2 = (**(code **)(*piVar1 + 0x20))(piVar1,&local_8,&local_14,&local_10,0),
           iVar2 == -0x7fffbffb)) {
          FUN_008018d0(L"FAILED_GetEvent");
          piVar1 = *(int **)(unaff_EDI + 4);
          if (piVar1 != (int *)0x0) {
            (**(code **)(*piVar1 + 0x24))(piVar1);
          }
          *(undefined1 *)(unaff_EDI + 0x34) = 0;
          FUN_007c9a60();
          ShowCursor(1);
          *(undefined1 *)(unaff_EDI + 0x34) = 0;
        }
        BVar3 = PeekMessageW(&local_30,(HWND)0x0,0,0,1);
        if (BVar3 != 0) {
          if (local_30.message == 0x12) {
            piVar1 = *(int **)(unaff_EDI + 4);
            if (piVar1 != (int *)0x0) {
              (**(code **)(*piVar1 + 0x24))(piVar1);
            }
            *(undefined1 *)(unaff_EDI + 0x34) = 0;
            FUN_007c9a60();
            *(undefined1 *)(unaff_EDI + 0x34) = 0;
            ShowCursor(1);
            PostMessageW(*(HWND *)(unaff_EDI + 0x28),0x12,0,0);
            return;
          }
          TranslateMessage(&local_30);
          DispatchMessageW(&local_30);
        }
        if ((local_8 == 1) || (*(int *)(unaff_EDI + 0x30) == 3)) {
          piVar1 = *(int **)(unaff_EDI + 4);
          if (piVar1 != (int *)0x0) {
            (**(code **)(*piVar1 + 0x24))(piVar1);
          }
          *(undefined1 *)(unaff_EDI + 0x34) = 0;
          FUN_007c9a60();
          *(undefined1 *)(unaff_EDI + 0x34) = 0;
          ShowCursor(1);
        }
        else {
          piVar1 = *(int **)(unaff_EDI + 8);
          if (piVar1 != (int *)0x0) {
            (**(code **)(*piVar1 + 0x3c))(piVar1,unaff_EDI + 0x20,0);
          }
          if (*(int *)(unaff_EDI + 0x4c) != *(int *)(unaff_EDI + 0x50)) {
            uVar4 = *(int *)(unaff_EDI + 0x7c) * 10000;
            if ((*(uint *)(unaff_EDI + 0x24) < 0x80000000) &&
               ((0 < (int)*(uint *)(unaff_EDI + 0x24) ||
                (uVar4 < *(uint *)(unaff_EDI + 0x20) || uVar4 - *(uint *)(unaff_EDI + 0x20) == 0))))
            {
              *(int *)(unaff_EDI + 0xb8) = *(int *)(unaff_EDI + 0x7c);
              FUN_00405eb0(unaff_EDI + 0x80,0,0xffffffff);
              if (*(int *)(unaff_EDI + 0x58) != *(int *)(unaff_EDI + 0x50) + -0x3c) {
                *(int *)(unaff_EDI + 0x58) = *(int *)(unaff_EDI + 0x58) + 0x3c;
                *(undefined4 *)(unaff_EDI + 0x7c) = **(undefined4 **)(unaff_EDI + 0x58);
                FUN_00405eb0(*(undefined4 **)(unaff_EDI + 0x58) + 1,0,0xffffffff);
              }
            }
          }
          if (*(int *)(unaff_EDI + 0x30) != 2) {
            iVar2 = (*(int *)(unaff_EDI + 0x1c) - *(int *)(unaff_EDI + 0x24)) -
                    (uint)(*(uint *)(unaff_EDI + 0x18) < *(uint *)(unaff_EDI + 0x20));
            if ((iVar2 < 1) &&
               ((iVar2 < 0 || (*(uint *)(unaff_EDI + 0x18) - *(uint *)(unaff_EDI + 0x20) < 0x989681)
                ))) {
              *(undefined4 *)(unaff_EDI + 0x30) = 2;
            }
          }
        }
        piVar1 = *(int **)(unaff_EDI + 0xc);
        if ((piVar1 != (int *)0x0) &&
           (iVar2 = (**(code **)(*piVar1 + 0x30))(piVar1,local_8,local_14,local_10),
           iVar2 == -0x7fffbffb)) break;
        if (*(char *)(unaff_EDI + 0x34) != '\x01') {
          return;
        }
      }
      piVar1 = *(int **)(unaff_EDI + 4);
      if (piVar1 != (int *)0x0) {
        (**(code **)(*piVar1 + 0x24))(piVar1);
      }
      *(undefined1 *)(unaff_EDI + 0x34) = 0;
      FUN_007c9a60();
      *(undefined1 *)(unaff_EDI + 0x34) = 0;
      ShowCursor(1);
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
007ca050 : PUSH EBP
007ca051 : MOV EBP,ESP
007ca053 : MOV EAX,dword ptr [EDI + 0x4]
007ca056 : SUB ESP,0x2c
007ca059 : PUSH EBX
007ca05a : XOR EBX,EBX
007ca05c : CMP EAX,EBX
007ca05e : JZ 0x007ca2d2
007ca064 : MOV ECX,dword ptr [EAX]
007ca066 : MOV EDX,dword ptr [ECX + 0x1c]
007ca069 : PUSH EAX
007ca06a : CALL EDX
007ca06c : TEST EAX,EAX
007ca06e : JL 0x007ca2d2
007ca074 : PUSH ESI
007ca075 : PUSH EBX
007ca076 : CALL dword ptr [0x00b85510]
007ca07c : MOV EAX,dword ptr [EDI + 0xc]
007ca07f : CMP EAX,EBX
007ca081 : JZ 0x007ca0ca
007ca083 : MOV ECX,dword ptr [EAX]
007ca085 : LEA EDX,[EBP + -0x8]
007ca088 : PUSH EDX
007ca089 : PUSH EAX
007ca08a : MOV EAX,dword ptr [ECX + 0x1c]
007ca08d : CALL EAX
007ca08f : TEST EAX,EAX
007ca091 : JGE 0x007ca0ca
007ca093 : MOV EAX,dword ptr [EDI + 0x4]
007ca096 : CMP EAX,EBX
007ca098 : JZ 0x007ca0a2
007ca09a : MOV ECX,dword ptr [EAX]
007ca09c : MOV EDX,dword ptr [ECX + 0x24]
007ca09f : PUSH EAX
007ca0a0 : CALL EDX
007ca0a2 : MOV ESI,EDI
007ca0a4 : MOV byte ptr [EDI + 0x34],BL
007ca0a7 : CALL 0x007c9a60
007ca0ac : PUSH 0x1
007ca0ae : MOV byte ptr [EDI + 0x34],BL
007ca0b1 : CALL dword ptr [0x00b85510]
007ca0b7 : MOV ESI,dword ptr [0x00da98e8]
007ca0bd : PUSH 0xc1e74c
007ca0c2 : CALL 0x008018d0
007ca0c7 : ADD ESP,0x4
007ca0ca : CMP byte ptr [EDI + 0x34],0x1
007ca0ce : JNZ 0x007ca2d1
007ca0d4 : PUSH -0x1
007ca0d6 : LEA EAX,[EBP + -0x8]
007ca0d9 : PUSH EAX
007ca0da : CALL dword ptr [0x00b85100]
007ca0e0 : MOV EAX,dword ptr [EDI + 0xc]
007ca0e3 : CMP EAX,EBX
007ca0e5 : JZ 0x007ca13a
007ca0e7 : MOV ECX,dword ptr [EAX]
007ca0e9 : PUSH EBX
007ca0ea : LEA EDX,[EBP + -0xc]
007ca0ed : PUSH EDX
007ca0ee : LEA EDX,[EBP + -0x10]
007ca0f1 : PUSH EDX
007ca0f2 : LEA EDX,[EBP + -0x4]
007ca0f5 : PUSH EDX
007ca0f6 : PUSH EAX
007ca0f7 : MOV EAX,dword ptr [ECX + 0x20]
007ca0fa : CALL EAX
007ca0fc : CMP EAX,0x80004005
007ca101 : JNZ 0x007ca13a
007ca103 : MOV ESI,dword ptr [0x00da98e8]
007ca109 : PUSH 0xc1e97c
007ca10e : CALL 0x008018d0
007ca113 : MOV EAX,dword ptr [EDI + 0x4]
007ca116 : ADD ESP,0x4
007ca119 : CMP EAX,EBX
007ca11b : JZ 0x007ca125
007ca11d : MOV ECX,dword ptr [EAX]
007ca11f : MOV EDX,dword ptr [ECX + 0x24]
007ca122 : PUSH EAX
007ca123 : CALL EDX
007ca125 : MOV ESI,EDI
007ca127 : MOV byte ptr [EDI + 0x34],BL
007ca12a : CALL 0x007c9a60
007ca12f : PUSH 0x1
007ca131 : CALL dword ptr [0x00b85510]
007ca137 : MOV byte ptr [EDI + 0x34],BL
007ca13a : PUSH 0x1
007ca13c : PUSH EBX
007ca13d : PUSH EBX
007ca13e : PUSH EBX
007ca13f : LEA EAX,[EBP + -0x2c]
007ca142 : PUSH EAX
007ca143 : CALL dword ptr [0x00b8549c]
007ca149 : TEST EAX,EAX
007ca14b : JZ 0x007ca16b
007ca14d : CMP dword ptr [EBP + -0x28],0x12
007ca151 : JZ 0x007ca275
007ca157 : LEA ECX,[EBP + -0x2c]
007ca15a : PUSH ECX
007ca15b : CALL dword ptr [0x00b854f4]
007ca161 : LEA EDX,[EBP + -0x2c]
007ca164 : PUSH EDX
007ca165 : CALL dword ptr [0x00b854f8]
007ca16b : MOV EAX,dword ptr [EBP + -0x4]
007ca16e : SUB EAX,0x1
007ca171 : JZ 0x007ca21f
007ca177 : CMP dword ptr [EDI + 0x30],0x3
007ca17b : JZ 0x007ca21f
007ca181 : MOV EAX,dword ptr [EDI + 0x8]
007ca184 : CMP EAX,EBX
007ca186 : JZ 0x007ca195
007ca188 : MOV ECX,dword ptr [EAX]
007ca18a : PUSH EBX
007ca18b : LEA EDX,[EDI + 0x20]
007ca18e : PUSH EDX
007ca18f : PUSH EAX
007ca190 : MOV EAX,dword ptr [ECX + 0x3c]
007ca193 : CALL EAX
007ca195 : MOV ECX,dword ptr [EDI + 0x4c]
007ca198 : CMP ECX,dword ptr [EDI + 0x50]
007ca19b : JZ 0x007ca1f6
007ca19d : MOV ECX,dword ptr [EDI + 0x7c]
007ca1a0 : MOV EAX,ECX
007ca1a2 : XOR EDX,EDX
007ca1a4 : IMUL EAX,EAX,0x2710
007ca1aa : CMP EDX,dword ptr [EDI + 0x24]
007ca1ad : JG 0x007ca1f6
007ca1af : JL 0x007ca1b6
007ca1b1 : CMP EAX,dword ptr [EDI + 0x20]
007ca1b4 : JA 0x007ca1f6
007ca1b6 : PUSH -0x1
007ca1b8 : PUSH EBX
007ca1b9 : MOV dword ptr [EDI + 0xb8],ECX
007ca1bf : LEA ESI,[EDI + 0x80]
007ca1c5 : PUSH ESI
007ca1c6 : LEA ECX,[EDI + 0xbc]
007ca1cc : CALL 0x00405eb0
007ca1d1 : MOV EAX,dword ptr [EDI + 0x50]
007ca1d4 : SUB EAX,0x3c
007ca1d7 : CMP dword ptr [EDI + 0x58],EAX
007ca1da : JZ 0x007ca1f6
007ca1dc : ADD dword ptr [EDI + 0x58],0x3c
007ca1e0 : MOV EAX,dword ptr [EDI + 0x58]
007ca1e3 : MOV EDX,dword ptr [EAX]
007ca1e5 : PUSH -0x1
007ca1e7 : PUSH EBX
007ca1e8 : ADD EAX,0x4
007ca1eb : PUSH EAX
007ca1ec : MOV ECX,ESI
007ca1ee : MOV dword ptr [EDI + 0x7c],EDX
007ca1f1 : CALL 0x00405eb0
007ca1f6 : MOV EDX,0x2
007ca1fb : CMP dword ptr [EDI + 0x30],EDX
007ca1fe : JZ 0x007ca243
007ca200 : MOV ECX,dword ptr [EDI + 0x18]
007ca203 : SUB ECX,dword ptr [EDI + 0x20]
007ca206 : MOV EAX,dword ptr [EDI + 0x1c]
007ca209 : SBB EAX,dword ptr [EDI + 0x24]
007ca20c : CMP EAX,EBX
007ca20e : JG 0x007ca243
007ca210 : JL 0x007ca21a
007ca212 : CMP ECX,0x989680
007ca218 : JA 0x007ca243
007ca21a : MOV dword ptr [EDI + 0x30],EDX
007ca21d : JMP 0x007ca243
007ca21f : MOV EAX,dword ptr [EDI + 0x4]
007ca222 : CMP EAX,EBX
007ca224 : JZ 0x007ca22e
007ca226 : MOV ECX,dword ptr [EAX]
007ca228 : MOV EDX,dword ptr [ECX + 0x24]
007ca22b : PUSH EAX
007ca22c : CALL EDX
007ca22e : MOV ESI,EDI
007ca230 : MOV byte ptr [EDI + 0x34],BL
007ca233 : CALL 0x007c9a60
007ca238 : PUSH 0x1
007ca23a : MOV byte ptr [EDI + 0x34],BL
007ca23d : CALL dword ptr [0x00b85510]
007ca243 : MOV EAX,dword ptr [EDI + 0xc]
007ca246 : CMP EAX,EBX
007ca248 : JZ 0x007ca265
007ca24a : MOV EDX,dword ptr [EBP + -0xc]
007ca24d : MOV ECX,dword ptr [EAX]
007ca24f : PUSH EDX
007ca250 : MOV EDX,dword ptr [EBP + -0x10]
007ca253 : PUSH EDX
007ca254 : MOV EDX,dword ptr [EBP + -0x4]
007ca257 : PUSH EDX
007ca258 : PUSH EAX
007ca259 : MOV EAX,dword ptr [ECX + 0x30]
007ca25c : CALL EAX
007ca25e : CMP EAX,0x80004005
007ca263 : JZ 0x007ca2ad
007ca265 : CMP byte ptr [EDI + 0x34],0x1
007ca269 : JZ 0x007ca0d4
007ca26f : POP ESI
007ca270 : POP EBX
007ca271 : MOV ESP,EBP
007ca273 : POP EBP
007ca274 : RET
007ca275 : MOV EAX,dword ptr [EDI + 0x4]
007ca278 : CMP EAX,EBX
007ca27a : JZ 0x007ca284
007ca27c : MOV ECX,dword ptr [EAX]
007ca27e : MOV EDX,dword ptr [ECX + 0x24]
007ca281 : PUSH EAX
007ca282 : CALL EDX
007ca284 : MOV ESI,EDI
007ca286 : MOV byte ptr [EDI + 0x34],BL
007ca289 : CALL 0x007c9a60
007ca28e : PUSH 0x1
007ca290 : MOV byte ptr [EDI + 0x34],BL
007ca293 : CALL dword ptr [0x00b85510]
007ca299 : MOV EAX,dword ptr [EDI + 0x28]
007ca29c : PUSH EBX
007ca29d : PUSH EBX
007ca29e : PUSH 0x12
007ca2a0 : PUSH EAX
007ca2a1 : CALL dword ptr [0x00b85508]
007ca2a7 : POP ESI
007ca2a8 : POP EBX
007ca2a9 : MOV ESP,EBP
007ca2ab : POP EBP
007ca2ac : RET
007ca2ad : MOV EAX,dword ptr [EDI + 0x4]
007ca2b0 : CMP EAX,EBX
007ca2b2 : JZ 0x007ca2bc
007ca2b4 : MOV ECX,dword ptr [EAX]
007ca2b6 : MOV EDX,dword ptr [ECX + 0x24]
007ca2b9 : PUSH EAX
007ca2ba : CALL EDX
007ca2bc : MOV ESI,EDI
007ca2be : MOV byte ptr [EDI + 0x34],BL
007ca2c1 : CALL 0x007c9a60
007ca2c6 : PUSH 0x1
007ca2c8 : MOV byte ptr [EDI + 0x34],BL
007ca2cb : CALL dword ptr [0x00b85510]
007ca2d1 : POP ESI
007ca2d2 : POP EBX
007ca2d3 : MOV ESP,EBP
007ca2d5 : POP EBP
007ca2d6 : RET
