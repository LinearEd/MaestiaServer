PROGRAM  : Maestia.exe
FUNCTION : FUN_00520b80
ENTRY    : 00520b80
BODY     : [[00520b80, 00520c62]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00520b80(uint *param_1,int param_2,undefined4 param_3)

{
  int *piVar1;
  int iVar2;
  LONG LVar3;
  undefined4 *in_ECX;
  uint uVar4;
  
  uVar4 = *param_1;
  in_ECX[2] = uVar4;
  piVar1 = (int *)(uVar4 + 8);
  *piVar1 = *piVar1 + 1;
  iVar2 = *(int *)(*(int *)(*param_1 & 0xfffffc00) + 0x18);
  in_ECX[3] = iVar2;
  piVar1 = (int *)(iVar2 + 8);
  *piVar1 = *piVar1 + 1;
  uVar4 = *param_1;
  in_ECX[4] = uVar4;
  piVar1 = (int *)(uVar4 + 8);
  *piVar1 = *piVar1 + 1;
  *in_ECX = 1;
  in_ECX[1] = param_3;
  FUN_0051b6e0();
  if (param_2 != 0) {
    FUN_0051fc70(&param_1);
    FUN_0051b950(&DAT_00b8ab70,0xffffffff);
  }
  FUN_0051b950(*(undefined4 *)in_ECX[2],0xffffffff);
  iVar2 = FUN_00525450(((uint)param_1 & 0xfffffffc) + 8,
                       *(uint *)((uint)param_1 & 0xfffffffc) & 0x7fffffff);
  *(int *)(iVar2 + 8) = *(int *)(iVar2 + 8) + 2;
  piVar1 = (int *)(in_ECX[3] + 8);
  *piVar1 = *piVar1 + -1;
  if (*piVar1 == 0) {
    FUN_00525340();
  }
  in_ECX[3] = iVar2;
  piVar1 = (int *)(iVar2 + 8);
  *piVar1 = *piVar1 + -1;
  if (*piVar1 == 0) {
    FUN_00525340();
  }
  uVar4 = (uint)param_1 & 0xfffffffc;
  LVar3 = InterlockedExchangeAdd((LONG *)(uVar4 + 4),-1);
  if (LVar3 == 1) {
    FUN_00515cf0(uVar4);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00520b80 : MOV EDX,dword ptr [ESP + 0xc]
00520b84 : PUSH ESI
00520b85 : MOV ESI,ECX
00520b87 : PUSH EDI
00520b88 : MOV EDI,dword ptr [ESP + 0xc]
00520b8c : MOV EAX,dword ptr [EDI]
00520b8e : MOV dword ptr [ESI + 0x8],EAX
00520b91 : INC dword ptr [EAX + 0x8]
00520b94 : MOV EAX,dword ptr [EDI]
00520b96 : AND EAX,0xfffffc00
00520b9b : MOV ECX,dword ptr [EAX]
00520b9d : MOV EAX,dword ptr [ECX + 0x18]
00520ba0 : MOV dword ptr [ESI + 0xc],EAX
00520ba3 : INC dword ptr [EAX + 0x8]
00520ba6 : MOV EAX,dword ptr [EDI]
00520ba8 : MOV dword ptr [ESI + 0x10],EAX
00520bab : INC dword ptr [EAX + 0x8]
00520bae : LEA ECX,[ESP + 0xc]
00520bb2 : MOV dword ptr [ESI],0x1
00520bb8 : MOV dword ptr [ESI + 0x4],EDX
00520bbb : CALL 0x0051b6e0
00520bc0 : MOV ECX,dword ptr [ESP + 0x10]
00520bc4 : TEST ECX,ECX
00520bc6 : JZ 0x00520be2
00520bc8 : LEA EAX,[ESP + 0xc]
00520bcc : PUSH EAX
00520bcd : CALL 0x0051fc70
00520bd2 : PUSH -0x1
00520bd4 : PUSH 0xb8ab70
00520bd9 : LEA ECX,[ESP + 0x14]
00520bdd : CALL 0x0051b950
00520be2 : MOV ECX,dword ptr [ESI + 0x8]
00520be5 : MOV EDX,dword ptr [ECX]
00520be7 : PUSH -0x1
00520be9 : PUSH EDX
00520bea : LEA ECX,[ESP + 0x14]
00520bee : CALL 0x0051b950
00520bf3 : MOV EAX,dword ptr [EDI]
00520bf5 : AND EAX,0xfffffc00
00520bfa : MOV ECX,dword ptr [EAX]
00520bfc : MOV EAX,dword ptr [ESP + 0xc]
00520c00 : MOV EDX,EAX
00520c02 : AND EDX,0xfffffffc
00520c05 : MOV EDX,dword ptr [EDX]
00520c07 : AND EDX,0x7fffffff
00520c0d : AND EAX,0xfffffffc
00520c10 : PUSH EDX
00520c11 : ADD EAX,0x8
00520c14 : PUSH EAX
00520c15 : CALL 0x00525450
00520c1a : MOV EDI,EAX
00520c1c : ADD dword ptr [EDI + 0x8],0x2
00520c20 : MOV ECX,dword ptr [ESI + 0xc]
00520c23 : ADD dword ptr [ECX + 0x8],-0x1
00520c27 : JNZ 0x00520c2e
00520c29 : CALL 0x00525340
00520c2e : MOV dword ptr [ESI + 0xc],EDI
00520c31 : ADD dword ptr [EDI + 0x8],-0x1
00520c35 : JNZ 0x00520c3e
00520c37 : MOV ECX,EDI
00520c39 : CALL 0x00525340
00520c3e : MOV EDI,dword ptr [ESP + 0xc]
00520c42 : AND EDI,0xfffffffc
00520c45 : PUSH -0x1
00520c47 : LEA EAX,[EDI + 0x4]
00520c4a : PUSH EAX
00520c4b : CALL dword ptr [0x00b851cc]
00520c51 : SUB EAX,0x1
00520c54 : JNZ 0x00520c5c
00520c56 : PUSH EDI
00520c57 : CALL 0x00515cf0
00520c5c : POP EDI
00520c5d : MOV EAX,ESI
00520c5f : POP ESI
00520c60 : RET 0xc
