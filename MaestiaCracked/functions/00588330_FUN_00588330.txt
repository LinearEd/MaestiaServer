PROGRAM  : Maestia.exe
FUNCTION : FUN_00588330
ENTRY    : 00588330
BODY     : [[00588330, 0058864d]]

============================================================
DECOMPILED C CODE
============================================================

undefined4
FUN_00588330(int *param_1,undefined4 param_2,uint param_3,int param_4,int *param_5,int param_6)

{
  undefined4 *puVar1;
  bool bVar2;
  int *piVar3;
  undefined4 uVar4;
  int iVar5;
  int iVar6;
  GRefCountImpl *pGVar7;
  GRefCountImpl *this;
  GRefCountImpl *this_00;
  int in_ECX;
  undefined4 uVar8;
  int local_34;
  uint local_30;
  uint local_2c;
  GRefCountImpl *pGStack_28;
  GRefCountImpl *pGStack_24;
  GRefCountImpl *pGStack_20;
  int local_1c;
  GRefCountImpl *pGStack_18;
  undefined4 uStack_14;
  GFxLoader aGStack_10 [4];
  undefined4 uStack_c;
  
  piVar3 = *(int **)(in_ECX + 0xc);
  if (piVar3 == (int *)0x0) {
    return 0;
  }
  local_30 = 0;
  local_34 = 0;
  bVar2 = false;
  local_2c = 0;
  local_1c = in_ECX;
  if (piVar3[1] != 0) {
    do {
      if (bVar2) goto LAB_0058841d;
      local_34 = *(int *)(*piVar3 + local_2c * 4);
      FUN_00561690();
      iVar6 = *(int *)(*(int *)(local_34 + 0x20) + 0x98);
      if (iVar6 != 0) {
        do {
          if (((*(int **)(iVar6 + 4))[5] &
              (-(uint)((param_3 & 0x300) != 0) & 0x300 | param_3 & 0x10 | 3)) == (param_3 & 0x313))
          {
            uVar8 = param_2;
            uVar4 = (**(code **)(**(int **)(iVar6 + 4) + 0x3c))(param_2);
            iVar5 = FUN_0051b280(uVar4,uVar8);
            if (iVar5 == 0) {
              local_30 = *(uint *)(iVar6 + 8);
              bVar2 = true;
              break;
            }
          }
          iVar6 = *(int *)(iVar6 + 0xc);
        } while (iVar6 != 0);
      }
      piVar3 = *(int **)(local_1c + 0xc);
      local_2c = local_2c + 1;
    } while (local_2c < (uint)piVar3[1]);
    if (bVar2) {
LAB_0058841d:
      if (param_4 == 0) {
        if (param_6 == 0) {
          return 0;
        }
        pGStack_24 = (GRefCountImpl *)(**(code **)(*param_5 + 0xc))(0x1d);
        (**(code **)(*param_5 + 0xc))(0x1e);
        pGStack_28 = (GRefCountImpl *)(**(code **)(*param_5 + 0xc))(10);
        FUN_005a2940(&pGStack_28,&pGStack_24,&pGStack_20);
        if (pGStack_28 != (GRefCountImpl *)0x0) {
          GRefCountImpl::Release(pGStack_28);
        }
        if (pGStack_24 != (GRefCountImpl *)0x0) {
          GRefCountImpl::Release(pGStack_24);
        }
        if (pGStack_20 != (GRefCountImpl *)0x0) {
          GRefCountImpl::Release(pGStack_20);
        }
        FUN_005a2550(*(undefined4 *)(param_6 + 8));
        iVar6 = FUN_00515840(0x2c,0);
        if (iVar6 == 0) {
          pGVar7 = (GRefCountImpl *)0x0;
        }
        else {
          pGVar7 = (GRefCountImpl *)FUN_00588160(param_5);
        }
        iVar6 = FUN_00515840(0x54,0);
        if (iVar6 == 0) {
          this_00 = (GRefCountImpl *)0x0;
        }
        else {
          this_00 = (GRefCountImpl *)FUN_005a19f0(uStack_c,param_5,pGVar7);
        }
        this = (GRefCountImpl *)FUN_005132b0(this_00,local_34,1,0);
        if (this_00 != (GRefCountImpl *)0x0) {
          GRefCountImpl::Release(this_00);
        }
        if (pGVar7 != (GRefCountImpl *)0x0) {
          GRefCountImpl::Release(pGVar7);
        }
        GFxLoader::~GFxLoader(aGStack_10);
      }
      else {
        iVar6 = FUN_00515840(0x54,0);
        if (iVar6 == 0) {
          pGVar7 = (GRefCountImpl *)0x0;
        }
        else {
          pGVar7 = (GRefCountImpl *)
                   FUN_005a19f0(*(undefined4 *)(param_4 + 0x14),param_5,
                                *(undefined4 *)(param_4 + 0x18));
        }
        this = (GRefCountImpl *)
               FUN_005132b0(pGVar7,local_34,*(uint *)(*(int *)(param_4 + 0x1c) + 0x14) | 1,0);
        if (pGVar7 != (GRefCountImpl *)0x0) {
          GRefCountImpl::Release(pGVar7);
        }
      }
      if (this != (GRefCountImpl *)0x0) {
        pGStack_18 = (GRefCountImpl *)0x0;
        uStack_14 = 0;
        iVar6 = *(int *)(this + 0x1c);
        if ((*(char *)(iVar6 + 0x3c) == '\0') || (*(uint *)(iVar6 + 0x1c) <= local_30)) {
          FUN_00569f80(&pGStack_18,local_30);
        }
        else {
          puVar1 = (undefined4 *)(*(int *)(iVar6 + 0x20) + local_30 * 8);
          if (((GRefCountImpl *)*puVar1 != (GRefCountImpl *)0x0) &&
             (GRefCountImpl::AddRef((GRefCountImpl *)*puVar1), pGStack_18 != (GRefCountImpl *)0x0))
          {
            FUN_00524240();
          }
          pGStack_18 = (GRefCountImpl *)*puVar1;
          uStack_14 = puVar1[1];
        }
        pGVar7 = pGStack_18;
        if (pGStack_18 != (GRefCountImpl *)0x0) {
          GRefCountImpl::AddRef(this);
          if (pGVar7 != (GRefCountImpl *)0x0) {
            GRefCountImpl::AddRef(pGVar7);
          }
          if (*param_1 != 0) {
            FUN_00524240();
          }
          if (param_1[1] != 0) {
            FUN_00524240();
          }
          *param_1 = (int)this;
          param_1[1] = (int)pGVar7;
          if (pGStack_18 != (GRefCountImpl *)0x0) {
            FUN_00524240();
          }
          FUN_00524240();
          return 1;
        }
        FUN_00524240();
      }
    }
  }
  return 0;
}



============================================================
DISASSEMBLY
============================================================
00588330 : SUB ESP,0x34
00588333 : MOV EAX,dword ptr [ECX + 0xc]
00588336 : PUSH EBX
00588337 : MOV EBX,dword ptr [ESP + 0x44]
0058833b : MOV dword ptr [ESP + 0x1c],ECX
0058833f : XOR ECX,ECX
00588341 : AND EBX,0x313
00588347 : CMP EAX,ECX
00588349 : JNZ 0x00588354
0058834b : XOR AL,AL
0058834d : POP EBX
0058834e : ADD ESP,0x34
00588351 : RET 0x18
00588354 : PUSH EBP
00588355 : PUSH ESI
00588356 : PUSH EDI
00588357 : MOV dword ptr [ESP + 0x14],ECX
0058835b : MOV dword ptr [ESP + 0x10],ECX
0058835f : MOV byte ptr [ESP + 0x50],CL
00588363 : MOV dword ptr [ESP + 0x18],ECX
00588367 : CMP dword ptr [EAX + 0x4],ECX
0058836a : JBE 0x00588642
00588370 : CMP byte ptr [ESP + 0x50],0x0
00588375 : JNZ 0x0058841d
0058837b : MOV EAX,dword ptr [EAX]
0058837d : MOV ESI,dword ptr [EAX + ECX*0x4]
00588380 : MOV ECX,dword ptr [ESI + 0x20]
00588383 : MOV dword ptr [ESP + 0x10],ESI
00588387 : CALL 0x00561690
0058838c : MOV EAX,dword ptr [ESI + 0x20]
0058838f : MOV EDI,dword ptr [EAX + 0x98]
00588395 : ADD EAX,0x98
0058839a : TEST EDI,EDI
0058839c : JZ 0x005883f9
0058839e : MOV ESI,EBX
005883a0 : AND ESI,0x300
005883a6 : NEG ESI
005883a8 : SBB ESI,ESI
005883aa : AND ESI,0x300
005883b0 : MOV ECX,EBX
005883b2 : AND ECX,0x10
005883b5 : OR ESI,ECX
005883b7 : MOV EBP,EBX
005883b9 : OR ESI,0x3
005883bc : AND EBP,0x313
005883c2 : MOV ECX,dword ptr [EDI + 0x4]
005883c5 : MOV EDX,dword ptr [ECX + 0x14]
005883c8 : AND EDX,ESI
005883ca : CMP EDX,EBP
005883cc : JNZ 0x005883e4
005883ce : MOV EAX,dword ptr [ESP + 0x4c]
005883d2 : MOV EDX,dword ptr [ECX]
005883d4 : PUSH EAX
005883d5 : MOV EAX,dword ptr [EDX + 0x3c]
005883d8 : CALL EAX
005883da : PUSH EAX
005883db : CALL 0x0051b280
005883e0 : TEST EAX,EAX
005883e2 : JZ 0x005883ed
005883e4 : MOV EDI,dword ptr [EDI + 0xc]
005883e7 : TEST EDI,EDI
005883e9 : JNZ 0x005883c2
005883eb : JMP 0x005883f9
005883ed : MOV ECX,dword ptr [EDI + 0x8]
005883f0 : MOV dword ptr [ESP + 0x14],ECX
005883f4 : MOV byte ptr [ESP + 0x50],0x1
005883f9 : MOV ECX,dword ptr [ESP + 0x18]
005883fd : MOV EDX,dword ptr [ESP + 0x28]
00588401 : MOV EAX,dword ptr [EDX + 0xc]
00588404 : INC ECX
00588405 : MOV dword ptr [ESP + 0x18],ECX
00588409 : CMP ECX,dword ptr [EAX + 0x4]
0058840c : JC 0x00588370
00588412 : CMP byte ptr [ESP + 0x50],0x0
00588417 : JZ 0x00588642
0058841d : MOV EDI,dword ptr [ESP + 0x54]
00588421 : XOR EBP,EBP
00588423 : CMP EDI,EBP
00588425 : JZ 0x00588482
00588427 : MOV ECX,dword ptr [0x00d73250]
0058842d : PUSH EBP
0058842e : PUSH 0x54
00588430 : CALL 0x00515840
00588435 : CMP EAX,EBP
00588437 : JZ 0x00588451
00588439 : MOV EDX,dword ptr [EDI + 0x18]
0058843c : MOV ECX,dword ptr [ESP + 0x58]
00588440 : MOV ESI,dword ptr [EDI + 0x14]
00588443 : PUSH EDX
00588444 : PUSH ECX
00588445 : PUSH ESI
00588446 : MOV ECX,EAX
00588448 : CALL 0x005a19f0
0058844d : MOV ESI,EAX
0058844f : JMP 0x00588453
00588451 : XOR ESI,ESI
00588453 : MOV EDX,dword ptr [EDI + 0x1c]
00588456 : MOV EAX,dword ptr [EDX + 0x14]
00588459 : PUSH EBP
0058845a : OR EAX,0x1
0058845d : PUSH EAX
0058845e : MOV EAX,dword ptr [ESP + 0x18]
00588462 : PUSH EAX
00588463 : PUSH ESI
00588464 : CALL 0x005132b0
00588469 : ADD ESP,0x10
0058846c : MOV EDI,EAX
0058846e : CMP ESI,EBP
00588470 : JZ 0x00588583
00588476 : MOV ECX,ESI
00588478 : CALL 0x004ff7e0
0058847d : JMP 0x00588583
00588482 : MOV EDI,dword ptr [ESP + 0x5c]
00588486 : CMP EDI,EBP
00588488 : JZ 0x00588642
0058848e : MOV ESI,dword ptr [ESP + 0x58]
00588492 : MOV EDX,dword ptr [ESI]
00588494 : MOV EAX,dword ptr [EDX + 0xc]
00588497 : PUSH 0x1d
00588499 : MOV ECX,ESI
0058849b : CALL EAX
0058849d : MOV EDX,dword ptr [ESI]
0058849f : MOV dword ptr [ESP + 0x24],EAX
005884a3 : MOV EAX,dword ptr [EDX + 0xc]
005884a6 : PUSH 0x1e
005884a8 : MOV ECX,ESI
005884aa : CALL EAX
005884ac : MOV EDX,dword ptr [ESI]
005884ae : MOV dword ptr [ESP + 0x20],EAX
005884b2 : MOV EAX,dword ptr [EDX + 0xc]
005884b5 : PUSH 0xa
005884b7 : MOV ECX,ESI
005884b9 : CALL EAX
005884bb : LEA ECX,[ESP + 0x24]
005884bf : PUSH ECX
005884c0 : LEA EDX,[ESP + 0x24]
005884c4 : MOV dword ptr [ESP + 0x20],EAX
005884c8 : PUSH EDX
005884c9 : LEA EAX,[ESP + 0x24]
005884cd : PUSH EAX
005884ce : LEA ECX,[ESP + 0x40]
005884d2 : CALL 0x005a2940
005884d7 : MOV ECX,dword ptr [ESP + 0x1c]
005884db : CMP ECX,EBP
005884dd : JZ 0x005884e4
005884df : CALL 0x004ff7e0
005884e4 : MOV ECX,dword ptr [ESP + 0x20]
005884e8 : CMP ECX,EBP
005884ea : JZ 0x005884f1
005884ec : CALL 0x004ff7e0
005884f1 : MOV ECX,dword ptr [ESP + 0x24]
005884f5 : CMP ECX,EBP
005884f7 : JZ 0x005884fe
005884f9 : CALL 0x004ff7e0
005884fe : MOV ECX,dword ptr [EDI + 0x8]
00588501 : PUSH ECX
00588502 : LEA ECX,[ESP + 0x38]
00588506 : CALL 0x005a2550
0058850b : MOV ECX,dword ptr [0x00d73250]
00588511 : PUSH EBP
00588512 : PUSH 0x2c
00588514 : CALL 0x00515840
00588519 : CMP EAX,EBP
0058851b : JZ 0x00588529
0058851d : PUSH ESI
0058851e : MOV ECX,EAX
00588520 : CALL 0x00588160
00588525 : MOV EBX,EAX
00588527 : JMP 0x0058852b
00588529 : XOR EBX,EBX
0058852b : MOV ECX,dword ptr [0x00d73250]
00588531 : PUSH EBP
00588532 : PUSH 0x54
00588534 : CALL 0x00515840
00588539 : CMP EAX,EBP
0058853b : JZ 0x0058854f
0058853d : MOV EDX,dword ptr [ESP + 0x38]
00588541 : PUSH EBX
00588542 : PUSH ESI
00588543 : PUSH EDX
00588544 : MOV ECX,EAX
00588546 : CALL 0x005a19f0
0058854b : MOV ESI,EAX
0058854d : JMP 0x00588551
0058854f : XOR ESI,ESI
00588551 : MOV EAX,dword ptr [ESP + 0x10]
00588555 : PUSH EBP
00588556 : PUSH 0x1
00588558 : PUSH EAX
00588559 : PUSH ESI
0058855a : CALL 0x005132b0
0058855f : ADD ESP,0x10
00588562 : MOV EDI,EAX
00588564 : CMP ESI,EBP
00588566 : JZ 0x0058856f
00588568 : MOV ECX,ESI
0058856a : CALL 0x004ff7e0
0058856f : CMP EBX,EBP
00588571 : JZ 0x0058857a
00588573 : MOV ECX,EBX
00588575 : CALL 0x004ff7e0
0058857a : LEA ECX,[ESP + 0x34]
0058857e : CALL 0x005a2160
00588583 : CMP EDI,EBP
00588585 : JZ 0x00588642
0058858b : MOV EAX,dword ptr [ESP + 0x14]
0058858f : MOV dword ptr [ESP + 0x2c],EBP
00588593 : MOV dword ptr [ESP + 0x30],EBP
00588597 : MOV ECX,dword ptr [EDI + 0x1c]
0058859a : MOV DL,byte ptr [ECX + 0x3c]
0058859d : ADD ECX,0x18
005885a0 : TEST DL,DL
005885a2 : JZ 0x005885d8
005885a4 : MOV EDX,dword ptr [ECX + 0x4]
005885a7 : CMP EAX,EDX
005885a9 : JNC 0x005885d8
005885ab : MOV ECX,dword ptr [ECX + 0x8]
005885ae : LEA ESI,[ECX + EAX*0x8]
005885b1 : MOV ECX,dword ptr [ESI]
005885b3 : CMP ECX,EBP
005885b5 : JZ 0x005885c9
005885b7 : CALL 0x00523dd0
005885bc : MOV ECX,dword ptr [ESP + 0x2c]
005885c0 : CMP ECX,EBP
005885c2 : JZ 0x005885c9
005885c4 : CALL 0x00524240
005885c9 : MOV EBP,dword ptr [ESI]
005885cb : MOV dword ptr [ESP + 0x2c],EBP
005885cf : MOV EDX,dword ptr [ESI + 0x4]
005885d2 : MOV dword ptr [ESP + 0x30],EDX
005885d6 : JMP 0x005885e7
005885d8 : PUSH EAX
005885d9 : LEA EAX,[ESP + 0x30]
005885dd : PUSH EAX
005885de : CALL 0x00569f80
005885e3 : MOV EBP,dword ptr [ESP + 0x2c]
005885e7 : MOV ECX,EDI
005885e9 : TEST EBP,EBP
005885eb : JZ 0x0058863d
005885ed : CALL 0x00523dd0
005885f2 : TEST EBP,EBP
005885f4 : JZ 0x005885fd
005885f6 : MOV ECX,EBP
005885f8 : CALL 0x00523dd0
005885fd : MOV ESI,dword ptr [ESP + 0x48]
00588601 : MOV ECX,dword ptr [ESI]
00588603 : TEST ECX,ECX
00588605 : JZ 0x0058860c
00588607 : CALL 0x00524240
0058860c : MOV ECX,dword ptr [ESI + 0x4]
0058860f : TEST ECX,ECX
00588611 : JZ 0x00588618
00588613 : CALL 0x00524240
00588618 : MOV ECX,dword ptr [ESP + 0x2c]
0058861c : MOV dword ptr [ESI],EDI
0058861e : MOV dword ptr [ESI + 0x4],EBP
00588621 : TEST ECX,ECX
00588623 : JZ 0x0058862a
00588625 : CALL 0x00524240
0058862a : MOV ECX,EDI
0058862c : CALL 0x00524240
00588631 : POP EDI
00588632 : POP ESI
00588633 : POP EBP
00588634 : MOV AL,0x1
00588636 : POP EBX
00588637 : ADD ESP,0x34
0058863a : RET 0x18
0058863d : CALL 0x00524240
00588642 : POP EDI
00588643 : POP ESI
00588644 : POP EBP
00588645 : XOR AL,AL
00588647 : POP EBX
00588648 : ADD ESP,0x34
0058864b : RET 0x18
