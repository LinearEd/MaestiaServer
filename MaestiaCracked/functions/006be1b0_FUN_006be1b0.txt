PROGRAM  : Maestia.exe
FUNCTION : FUN_006be1b0
ENTRY    : 006be1b0
BODY     : [[006be1b0, 006be43b]]

============================================================
DECOMPILED C CODE
============================================================

short * FUN_006be1b0(int param_1,int param_2)

{
  int *piVar1;
  short *psVar2;
  int iVar3;
  short *psVar4;
  short *psVar5;
  int iVar6;
  short *psVar7;
  short *psVar8;
  int iVar9;
  byte *pbVar10;
  short *psVar11;
  undefined4 local_c;
  short *local_8;
  
  iVar9 = param_2;
  psVar2 = *(short **)(param_1 + 0x44 + param_2 * 0x1c);
  psVar11 = psVar2 + *(int *)(param_1 + param_2 * 0x1c + 0x3c) * 0x18;
  local_8 = (short *)0x0;
  local_c = 0;
  param_2 = 0;
  for (psVar5 = psVar2; psVar5 < psVar11; psVar5 = psVar5 + 0x18) {
    if ((*(byte *)(psVar5 + 6) & 4) == 0) {
      psVar4 = *(short **)(psVar5 + 0xc);
      if (psVar4 == (short *)0x0) {
        param_2 = param_2 + 1;
      }
      else if (psVar4 < psVar5) {
        FUN_006bdff0(iVar9);
        *(byte *)(psVar5 + 6) = *(byte *)(psVar5 + 6) | 4;
      }
      else {
        if ((iVar9 == 1) || (local_8 != (short *)0x0)) {
          FUN_006be010(psVar5,psVar4,local_c);
        }
        else {
          local_c = FUN_006be010(psVar5,psVar4,0);
        }
        *(byte *)(psVar5 + 6) = *(byte *)(psVar5 + 6) | 4;
        *(byte *)(psVar4 + 6) = *(byte *)(psVar4 + 6) | 4;
        local_8 = psVar5;
      }
    }
  }
  iVar6 = (int)psVar11 - (int)psVar2;
  psVar5 = (short *)(iVar6 * 0x2aaaaaab);
  iVar3 = iVar6 / 0x30;
  if (iVar9 == 0) {
    if (iVar3 == 6) {
      psVar4 = psVar2 + 0x30;
      psVar7 = psVar2 + 0x60;
      psVar8 = psVar2;
    }
    else {
      if (iVar3 != 0xc) goto LAB_006be328;
      psVar4 = psVar2 + 0x78;
      psVar7 = psVar2 + 0xd8;
      psVar8 = psVar2 + 0x18;
    }
    psVar5 = (short *)((*(int *)(psVar4 + 2) * 2 - *(int *)(psVar7 + 2)) - *(int *)(psVar8 + 2));
    if ((int)psVar5 < 0) {
      psVar5 = (short *)-(int)psVar5;
    }
    if ((((*(short **)(psVar8 + 0xc) == psVar8 + 0x18) &&
         (*(short **)(psVar4 + 0xc) == psVar4 + 0x18)) &&
        (*(short **)(psVar7 + 0xc) == psVar7 + 0x18)) && ((int)psVar5 < 8)) {
      psVar5 = (short *)(*(int *)(psVar8 + 4) + *(int *)(psVar4 + 4) * -2 + *(int *)(psVar7 + 4));
      *(int *)(psVar7 + 4) = *(int *)(psVar7 + 4) - (int)psVar5;
      if (*(int *)(psVar7 + 0xc) != 0) {
        piVar1 = (int *)(*(int *)(psVar7 + 0xc) + 8);
        *piVar1 = *piVar1 - (int)psVar5;
      }
      if (iVar3 == 0xc) {
        *(int *)(psVar2 + 0xc4) = *(int *)(psVar2 + 0xc4) - (int)psVar5;
        *(int *)(psVar2 + 0x10c) = *(int *)(psVar2 + 0x10c) - (int)psVar5;
      }
      *(byte *)(psVar7 + 6) = *(byte *)(psVar7 + 6) | 4;
      if (*(int *)(psVar7 + 0xc) != 0) {
        pbVar10 = (byte *)(*(int *)(psVar7 + 0xc) + 0xc);
        *pbVar10 = *pbVar10 | 4;
      }
    }
  }
LAB_006be328:
  if (param_2 != 0) {
    if (psVar2 < psVar11) {
      psVar5 = (short *)((iVar6 - 1U) * -0x55555555);
      pbVar10 = (byte *)(psVar2 + 6);
      iVar9 = (iVar6 - 1U) / 0x30 + 1;
      do {
        if (((*pbVar10 & 4) == 0) && (*(int *)(pbVar10 + 0x10) != 0)) {
          psVar5 = (short *)FUN_006bd1a0();
          *pbVar10 = *pbVar10 | 4;
          param_2 = param_2 + -1;
        }
        pbVar10 = pbVar10 + 0x30;
        iVar9 = iVar9 + -1;
      } while (iVar9 != 0);
    }
    if ((param_2 != 0) && (psVar2 < psVar11)) {
      psVar4 = psVar2 + -0x18;
      do {
        psVar5 = psVar4;
        if ((*(byte *)(psVar4 + 0x1e) & 4) == 0) {
          for (; (psVar2 <= psVar5 && ((*(byte *)(psVar5 + 6) & 4) == 0)); psVar5 = psVar5 + -0x18)
          {
          }
          for (psVar7 = psVar4 + 0x30; (psVar7 < psVar11 && ((*(byte *)(psVar7 + 6) & 4) == 0));
              psVar7 = psVar7 + 0x18) {
          }
          if (psVar5 < psVar2) {
            if (psVar7 < psVar11) {
              FUN_006bd1a0();
            }
          }
          else if (psVar7 < psVar11) {
            iVar9 = FUN_00685d60((int)psVar4[0x18] - (int)*psVar5,
                                 *(int *)(psVar7 + 4) - *(int *)(psVar5 + 4),
                                 (int)*psVar7 - (int)*psVar5);
            *(int *)(psVar4 + 0x1c) = iVar9 + *(int *)(psVar5 + 4);
          }
          else {
            FUN_006bd1a0();
          }
        }
        psVar5 = psVar4 + 0x30;
        psVar4 = psVar4 + 0x18;
      } while (psVar5 < psVar11);
    }
  }
  return psVar5;
}



============================================================
DISASSEMBLY
============================================================
006be1b0 : SUB ESP,0x10
006be1b3 : MOV EDX,dword ptr [ESP + 0x14]
006be1b7 : PUSH EBX
006be1b8 : PUSH EBP
006be1b9 : MOV EBP,dword ptr [ESP + 0x20]
006be1bd : LEA EAX,[EBP*0x8 + 0x0]
006be1c4 : SUB EAX,EBP
006be1c6 : MOV EBX,dword ptr [EDX + EAX*0x4 + 0x44]
006be1ca : LEA EAX,[EDX + EAX*0x4 + 0x30]
006be1ce : MOV EAX,dword ptr [EAX + 0xc]
006be1d1 : PUSH ESI
006be1d2 : PUSH EDI
006be1d3 : LEA EDI,[EAX + EAX*0x2]
006be1d6 : SHL EDI,0x4
006be1d9 : XOR EAX,EAX
006be1db : ADD EDI,EBX
006be1dd : MOV dword ptr [ESP + 0x10],EDI
006be1e1 : MOV dword ptr [ESP + 0x18],EAX
006be1e5 : MOV dword ptr [ESP + 0x14],EAX
006be1e9 : MOV dword ptr [ESP + 0x28],EAX
006be1ed : MOV ESI,EBX
006be1ef : CMP EBX,EDI
006be1f1 : JNC 0x006be264
006be1f3 : TEST byte ptr [ESI + 0xc],0x4
006be1f7 : JNZ 0x006be25d
006be1f9 : MOV EDI,dword ptr [ESI + 0x18]
006be1fc : TEST EDI,EDI
006be1fe : JNZ 0x006be206
006be200 : INC dword ptr [ESP + 0x28]
006be204 : JMP 0x006be259
006be206 : CMP EDI,ESI
006be208 : JNC 0x006be21b
006be20a : PUSH EBP
006be20b : MOV ECX,EDX
006be20d : CALL 0x006bdff0
006be212 : ADD ESP,0x4
006be215 : OR byte ptr [ESI + 0xc],0x4
006be219 : JMP 0x006be255
006be21b : CMP EBP,0x1
006be21e : JZ 0x006be238
006be220 : CMP dword ptr [ESP + 0x18],0x0
006be225 : JNZ 0x006be238
006be227 : PUSH 0x0
006be229 : PUSH EDI
006be22a : PUSH ESI
006be22b : XOR ECX,ECX
006be22d : CALL 0x006be010
006be232 : MOV dword ptr [ESP + 0x20],EAX
006be236 : JMP 0x006be246
006be238 : MOV ECX,dword ptr [ESP + 0x14]
006be23c : PUSH ECX
006be23d : PUSH EDI
006be23e : PUSH ESI
006be23f : MOV ECX,EBP
006be241 : CALL 0x006be010
006be246 : OR byte ptr [ESI + 0xc],0x4
006be24a : ADD ESP,0xc
006be24d : OR byte ptr [EDI + 0xc],0x4
006be251 : MOV dword ptr [ESP + 0x18],ESI
006be255 : MOV EDX,dword ptr [ESP + 0x24]
006be259 : MOV EDI,dword ptr [ESP + 0x10]
006be25d : ADD ESI,0x30
006be260 : CMP ESI,EDI
006be262 : JC 0x006be1f3
006be264 : MOV ECX,EDI
006be266 : SUB ECX,EBX
006be268 : MOV EAX,0x2aaaaaab
006be26d : IMUL ECX
006be26f : SAR EDX,0x3
006be272 : MOV ESI,EDX
006be274 : SHR ESI,0x1f
006be277 : ADD ESI,EDX
006be279 : MOV dword ptr [ESP + 0x1c],ECX
006be27d : TEST EBP,EBP
006be27f : JNZ 0x006be328
006be285 : CMP ESI,0x6
006be288 : JZ 0x006be3d7
006be28e : CMP ESI,0xc
006be291 : JNZ 0x006be328
006be297 : LEA EDX,[EBX + 0x30]
006be29a : MOV dword ptr [ESP + 0x18],EDX
006be29e : LEA EAX,[EBX + 0xf0]
006be2a4 : LEA ECX,[EBX + 0x1b0]
006be2aa : MOV dword ptr [ESP + 0x24],EAX
006be2ae : MOV EAX,dword ptr [EAX + 0x4]
006be2b1 : ADD EAX,EAX
006be2b3 : SUB EAX,dword ptr [ECX + 0x4]
006be2b6 : SUB EAX,dword ptr [EDX + 0x4]
006be2b9 : JNS 0x006be2bd
006be2bb : NEG EAX
006be2bd : LEA EBP,[EDX + 0x30]
006be2c0 : CMP dword ptr [EDX + 0x18],EBP
006be2c3 : JNZ 0x006be328
006be2c5 : MOV EDX,dword ptr [ESP + 0x24]
006be2c9 : LEA EBP,[EDX + 0x30]
006be2cc : CMP dword ptr [EDX + 0x18],EBP
006be2cf : JNZ 0x006be328
006be2d1 : MOV EDX,dword ptr [ECX + 0x18]
006be2d4 : LEA EBP,[ECX + 0x30]
006be2d7 : CMP EDX,EBP
006be2d9 : JNZ 0x006be328
006be2db : CMP EAX,0x8
006be2de : JGE 0x006be328
006be2e0 : MOV EAX,dword ptr [ESP + 0x24]
006be2e4 : MOV EAX,dword ptr [EAX + 0x8]
006be2e7 : MOV EDX,dword ptr [ECX + 0x8]
006be2ea : ADD EAX,EAX
006be2ec : MOV EBP,EAX
006be2ee : MOV EAX,dword ptr [ESP + 0x18]
006be2f2 : MOV EAX,dword ptr [EAX + 0x8]
006be2f5 : SUB EAX,EBP
006be2f7 : ADD EAX,EDX
006be2f9 : SUB EDX,EAX
006be2fb : MOV dword ptr [ECX + 0x8],EDX
006be2fe : MOV EDX,dword ptr [ECX + 0x18]
006be301 : TEST EDX,EDX
006be303 : JZ 0x006be308
006be305 : SUB dword ptr [EDX + 0x8],EAX
006be308 : CMP ESI,0xc
006be30b : JNZ 0x006be319
006be30d : SUB dword ptr [EBX + 0x188],EAX
006be313 : SUB dword ptr [EBX + 0x218],EAX
006be319 : OR byte ptr [ECX + 0xc],0x4
006be31d : MOV ECX,dword ptr [ECX + 0x18]
006be320 : TEST ECX,ECX
006be322 : JZ 0x006be328
006be324 : OR byte ptr [ECX + 0xc],0x4
006be328 : CMP dword ptr [ESP + 0x28],0x0
006be32d : JZ 0x006be434
006be333 : CMP EBX,EDI
006be335 : JNC 0x006be373
006be337 : MOV ECX,dword ptr [ESP + 0x1c]
006be33b : DEC ECX
006be33c : MOV EAX,0xaaaaaaab
006be341 : MUL ECX
006be343 : MOV EBP,EDX
006be345 : SHR EBP,0x5
006be348 : LEA ESI,[EBX + 0xc]
006be34b : INC EBP
006be34c : LEA ESP,[ESP]
006be350 : TEST byte ptr [ESI],0x4
006be353 : JNZ 0x006be36b
006be355 : MOV ECX,dword ptr [ESI + 0x10]
006be358 : TEST ECX,ECX
006be35a : JZ 0x006be36b
006be35c : LEA EAX,[ESI + -0xc]
006be35f : CALL 0x006bd1a0
006be364 : OR byte ptr [ESI],0x4
006be367 : DEC dword ptr [ESP + 0x28]
006be36b : ADD ESI,0x30
006be36e : SUB EBP,0x1
006be371 : JNZ 0x006be350
006be373 : CMP dword ptr [ESP + 0x28],0x0
006be378 : JZ 0x006be434
006be37e : CMP EBX,EDI
006be380 : JNC 0x006be434
006be386 : LEA EDI,[EBX + -0x30]
006be389 : LEA ESP,[ESP]
006be390 : TEST byte ptr [EDI + 0x3c],0x4
006be394 : JNZ 0x006be422
006be39a : MOV ESI,EDI
006be39c : CMP EDI,EBX
006be39e : JC 0x006be3ad
006be3a0 : TEST byte ptr [ESI + 0xc],0x4
006be3a4 : JNZ 0x006be3ad
006be3a6 : SUB ESI,0x30
006be3a9 : CMP ESI,EBX
006be3ab : JNC 0x006be3a0
006be3ad : MOV EBP,dword ptr [ESP + 0x10]
006be3b1 : LEA ECX,[EDI + 0x60]
006be3b4 : CMP ECX,EBP
006be3b6 : JNC 0x006be3c5
006be3b8 : TEST byte ptr [ECX + 0xc],0x4
006be3bc : JNZ 0x006be3c5
006be3be : ADD ECX,0x30
006be3c1 : CMP ECX,EBP
006be3c3 : JC 0x006be3b8
006be3c5 : CMP ESI,EBX
006be3c7 : JNC 0x006be3eb
006be3c9 : CMP ECX,EBP
006be3cb : JNC 0x006be426
006be3cd : LEA EAX,[EDI + 0x30]
006be3d0 : CALL 0x006bd1a0
006be3d5 : JMP 0x006be426
006be3d7 : MOV EDX,EBX
006be3d9 : MOV dword ptr [ESP + 0x18],EBX
006be3dd : LEA EAX,[EBX + 0x60]
006be3e0 : LEA ECX,[EBX + 0xc0]
006be3e6 : JMP 0x006be2aa
006be3eb : CMP ECX,EBP
006be3ed : JC 0x006be3fb
006be3ef : LEA EAX,[EDI + 0x30]
006be3f2 : MOV ECX,ESI
006be3f4 : CALL 0x006bd1a0
006be3f9 : JMP 0x006be426
006be3fb : MOVSX EDX,word ptr [ECX]
006be3fe : MOVSX EAX,word ptr [ESI]
006be401 : MOV ECX,dword ptr [ECX + 0x8]
006be404 : SUB ECX,dword ptr [ESI + 0x8]
006be407 : SUB EDX,EAX
006be409 : PUSH EDX
006be40a : MOVSX EDX,word ptr [EDI + 0x30]
006be40e : PUSH ECX
006be40f : SUB EDX,EAX
006be411 : PUSH EDX
006be412 : CALL 0x00685d60
006be417 : ADD ESP,0xc
006be41a : ADD EAX,dword ptr [ESI + 0x8]
006be41d : MOV dword ptr [EDI + 0x38],EAX
006be420 : JMP 0x006be426
006be422 : MOV EBP,dword ptr [ESP + 0x10]
006be426 : ADD EDI,0x30
006be429 : LEA EAX,[EDI + 0x30]
006be42c : CMP EAX,EBP
006be42e : JC 0x006be390
006be434 : POP EDI
006be435 : POP ESI
006be436 : POP EBP
006be437 : POP EBX
006be438 : ADD ESP,0x10
006be43b : RET
