PROGRAM  : Maestia.exe
FUNCTION : FUN_00989b60
ENTRY    : 00989b60
BODY     : [[00989b60, 00989d2e]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00989b60(void)

{
  char cVar1;
  undefined4 uVar2;
  undefined4 uVar3;
  ulonglong uVar4;
  uint uVar5;
  int iVar6;
  uint8_t *packet;
  int in_ECX;
  int iVar7;
  undefined1 local_58 [28];
  uint8_t *local_3c;
  undefined4 local_38;
  undefined4 local_34;
  undefined1 local_30 [28];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b40b48;
  local_10 = ExceptionList;
  uVar5 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_14 = uVar5;
  if (*(int *)(in_ECX + 0x5c) != -1) {
    iVar7 = *(int *)(*(int *)(in_ECX + 0x3c) + 0x18);
    if (iVar7 < 0) {
      iVar7 = 0;
    }
    else {
      iVar7 = *(int *)(*(int *)(*(int *)(in_ECX + 0x3c) + 0x10) + iVar7 * 4);
    }
    iVar7 = *(int *)(iVar7 + 8);
    if (iVar7 != 0) {
      local_34 = 0;
      local_38 = 0;
      iVar6 = FUN_00a96690(*(undefined4 *)(*(int *)(in_ECX + 4) + 0x130),iVar7,&local_34,&local_38);
      if (iVar6 < 5) {
        iVar6 = *(int *)ThreadLocalStoragePointer;
        uVar4 = (ulonglong)(*(byte *)(iVar6 + 0x18) + 1) % 3;
        local_3c = (uint8_t *)((int)uVar4 * 0x2000 + 0x122cb8 + iVar6);
        *(char *)(iVar6 + 0x18) = (char)uVar4;
        if (local_3c == (uint8_t *)0x0) {
          packet = (uint8_t *)0x0;
        }
        else {
          uVar2 = *(undefined4 *)(iVar7 + 0xc);
          uVar3 = *(undefined4 *)(in_ECX + 0x5c);
          local_3c[0] = '\0';
          local_3c[1] = '\0';
          local_3c[2] = '6';
          local_3c[3] = '!';
          *(undefined4 *)(local_3c + 4) = uVar3;
          *(undefined4 *)(local_3c + 8) = uVar2;
          packet = local_3c;
        }
        local_8 = 0xffffffff;
        iVar7 = *(int *)(DAT_017247d4 + 4);
        if (iVar7 == 0) goto LAB_00989d13;
        cVar1 = *(char *)(DAT_017247d4 + 8);
      }
      else {
        iVar6 = FUN_00a96560(*(undefined4 *)(*(int *)(in_ECX + 4) + 0x130),&local_34,&local_38);
        if (4 < iVar6) {
          FUN_00406460(L"IDS_GUI_DONT_HAVE_SPACE");
          local_8 = 2;
          FUN_0081d120(local_58);
          local_8 = CONCAT31(local_8._1_3_,4);
          FUN_00406560(uVar5);
          FUN_0096b1e0(local_30,0xffff0000,0x12);
          local_8 = 0xffffffff;
          FUN_00406560();
          goto LAB_00989d13;
        }
        local_3c = (uint8_t *)FUN_006f4590();
        if (local_3c == (uint8_t *)0x0) {
          packet = (uint8_t *)0x0;
        }
        else {
          uVar2 = *(undefined4 *)(iVar7 + 0xc);
          uVar3 = *(undefined4 *)(in_ECX + 0x5c);
          local_3c[0] = '\0';
          local_3c[1] = '\0';
          local_3c[2] = '6';
          local_3c[3] = '!';
          *(undefined4 *)(local_3c + 4) = uVar3;
          *(undefined4 *)(local_3c + 8) = uVar2;
          packet = local_3c;
        }
        local_8 = 0xffffffff;
        iVar7 = *(int *)(DAT_017247d4 + 4);
        if (iVar7 == 0) goto LAB_00989d13;
        cVar1 = *(char *)(DAT_017247d4 + 8);
      }
      local_8 = 0xffffffff;
      if (cVar1 != '\0') {
        FUN_00a0dd40(iVar7,0xc,packet);
      }
    }
  }
LAB_00989d13:
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00989b60 : PUSH EBP
00989b61 : MOV EBP,ESP
00989b63 : PUSH -0x1
00989b65 : PUSH 0xb40b48
00989b6a : MOV EAX,FS:[0x0]
00989b70 : PUSH EAX
00989b71 : SUB ESP,0x48
00989b74 : MOV EAX,[0x00d66fa0]
00989b79 : XOR EAX,EBP
00989b7b : MOV dword ptr [EBP + -0x10],EAX
00989b7e : PUSH EBX
00989b7f : PUSH ESI
00989b80 : PUSH EDI
00989b81 : PUSH EAX
00989b82 : LEA EAX,[EBP + -0xc]
00989b85 : MOV FS:[0x0],EAX
00989b8b : MOV ESI,ECX
00989b8d : CMP dword ptr [ESI + 0x5c],-0x1
00989b91 : JZ 0x00989d13
00989b97 : MOV EAX,dword ptr [ESI + 0x3c]
00989b9a : MOV ECX,dword ptr [EAX + 0x18]
00989b9d : XOR EBX,EBX
00989b9f : CMP ECX,EBX
00989ba1 : JGE 0x00989ba7
00989ba3 : XOR ECX,ECX
00989ba5 : JMP 0x00989bad
00989ba7 : MOV EAX,dword ptr [EAX + 0x10]
00989baa : MOV ECX,dword ptr [EAX + ECX*0x4]
00989bad : MOV EDI,dword ptr [ECX + 0x8]
00989bb0 : CMP EDI,EBX
00989bb2 : JZ 0x00989d13
00989bb8 : MOV ECX,dword ptr [ESI + 0x4]
00989bbb : MOV dword ptr [EBP + -0x30],EBX
00989bbe : MOV dword ptr [EBP + -0x34],EBX
00989bc1 : MOV EAX,dword ptr [ECX + 0x130]
00989bc7 : LEA EDX,[EBP + -0x34]
00989bca : PUSH EDX
00989bcb : LEA ECX,[EBP + -0x30]
00989bce : PUSH ECX
00989bcf : PUSH EDI
00989bd0 : PUSH EAX
00989bd1 : CALL 0x00a96690
00989bd6 : CMP EAX,0x5
00989bd9 : JGE 0x00989c4a
00989bdb : MOV EDX,dword ptr FS:[0x2c]
00989be2 : MOV ECX,dword ptr [EDX]
00989be4 : MOVZX EAX,byte ptr [ECX + 0x18]
00989be8 : INC EAX
00989be9 : CDQ
00989bea : MOV EBX,0x3
00989bef : IDIV EBX
00989bf1 : MOVZX EAX,DL
00989bf4 : SHL EAX,0xd
00989bf7 : LEA EAX,[EAX + ECX*0x1 + 0x122cb8]
00989bfe : MOV byte ptr [ECX + 0x18],DL
00989c01 : MOV dword ptr [EBP + -0x38],EAX
00989c04 : MOV dword ptr [EBP + -0x4],0x0
00989c0b : TEST EAX,EAX
00989c0d : JZ 0x00989c2a
00989c0f : MOV EDI,dword ptr [EDI + 0xc]
00989c12 : MOV ESI,dword ptr [ESI + 0x5c]
00989c15 : XOR ECX,ECX
00989c17 : MOV word ptr [EAX],CX
00989c1a : MOV byte ptr [EAX + 0x2],0x36
00989c1e : MOV byte ptr [EAX + 0x3],0x21
00989c22 : MOV dword ptr [EAX + 0x4],ESI
00989c25 : MOV dword ptr [EAX + 0x8],EDI
00989c28 : JMP 0x00989c2c
00989c2a : XOR EAX,EAX
00989c2c : MOV dword ptr [EBP + -0x4],0xffffffff
00989c33 : MOV EDX,dword ptr [0x017247d4]
00989c39 : MOV ECX,dword ptr [EDX + 0x4]
00989c3c : TEST ECX,ECX
00989c3e : JZ 0x00989d13
00989c44 : CMP byte ptr [EDX + 0x8],0x0
00989c48 : JMP 0x00989cad
00989c4a : MOV EDX,dword ptr [ESI + 0x4]
00989c4d : MOV EAX,dword ptr [EDX + 0x130]
00989c53 : LEA ECX,[EBP + -0x34]
00989c56 : PUSH ECX
00989c57 : LEA EDX,[EBP + -0x30]
00989c5a : PUSH EDX
00989c5b : PUSH EAX
00989c5c : CALL 0x00a96560
00989c61 : CMP EAX,0x5
00989c64 : JGE 0x00989cbb
00989c66 : CALL 0x006f4590
00989c6b : MOV dword ptr [EBP + -0x38],EAX
00989c6e : MOV dword ptr [EBP + -0x4],0x1
00989c75 : CMP EAX,EBX
00989c77 : JZ 0x00989c94
00989c79 : MOV EDI,dword ptr [EDI + 0xc]
00989c7c : MOV ESI,dword ptr [ESI + 0x5c]
00989c7f : XOR ECX,ECX
00989c81 : MOV word ptr [EAX],CX
00989c84 : MOV byte ptr [EAX + 0x2],0x36
00989c88 : MOV byte ptr [EAX + 0x3],0x21
00989c8c : MOV dword ptr [EAX + 0x4],ESI
00989c8f : MOV dword ptr [EAX + 0x8],EDI
00989c92 : JMP 0x00989c96
00989c94 : XOR EAX,EAX
00989c96 : MOV dword ptr [EBP + -0x4],0xffffffff
00989c9d : MOV EDX,dword ptr [0x017247d4]
00989ca3 : MOV ECX,dword ptr [EDX + 0x4]
00989ca6 : CMP ECX,EBX
00989ca8 : JZ 0x00989d13
00989caa : CMP byte ptr [EDX + 0x8],BL
00989cad : JZ 0x00989d13
00989caf : PUSH 0xc
00989cb1 : PUSH ECX
00989cb2 : MOV EDI,EAX
00989cb4 : CALL 0x00a0dd40
00989cb9 : JMP 0x00989d13
00989cbb : PUSH 0xc827c8
00989cc0 : LEA ECX,[EBP + -0x54]
00989cc3 : CALL 0x00406460
00989cc8 : MOV dword ptr [EBP + -0x4],0x2
00989ccf : MOV ECX,dword ptr [0x0172491c]
00989cd5 : LEA EDX,[EBP + -0x54]
00989cd8 : PUSH EDX
00989cd9 : LEA EDI,[EBP + -0x2c]
00989cdc : CALL 0x0081d120
00989ce1 : MOV byte ptr [EBP + -0x4],0x4
00989ce5 : LEA ECX,[EBP + -0x54]
00989ce8 : CALL 0x00406560
00989ced : MOV EAX,dword ptr [ESI + 0x4]
00989cf0 : MOV ECX,dword ptr [EAX + 0x134]
00989cf6 : PUSH 0x12
00989cf8 : PUSH 0xffff0000
00989cfd : MOV EDX,EDI
00989cff : PUSH EDX
00989d00 : CALL 0x0096b1e0
00989d05 : MOV dword ptr [EBP + -0x4],0xffffffff
00989d0c : MOV ECX,EDI
00989d0e : CALL 0x00406560
00989d13 : MOV ECX,dword ptr [EBP + -0xc]
00989d16 : MOV dword ptr FS:[0x0],ECX
00989d1d : POP ECX
00989d1e : POP EDI
00989d1f : POP ESI
00989d20 : POP EBX
00989d21 : MOV ECX,dword ptr [EBP + -0x10]
00989d24 : XOR ECX,EBP
00989d26 : CALL 0x00633e6b
00989d2b : MOV ESP,EBP
00989d2d : POP EBP
00989d2e : RET
