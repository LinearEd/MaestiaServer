PROGRAM  : Maestia.exe
FUNCTION : Open
ENTRY    : 005aa5b0
BODY     : [[005aa5b0, 005aa670]]

============================================================
DECOMPILED C CODE
============================================================

/* public: bool __thiscall GSysFile::Open(class GString const &,int,int) */

bool __thiscall GSysFile::Open(GSysFile *this,GString *param_1,int param_2,int param_3)

{
  char cVar1;
  int *piVar2;
  GBufferedFile *this_00;
  undefined4 uVar3;
  undefined4 *puVar4;
  
                    /* 0x1aa5b0  126  ?Open@GSysFile@@QAE_NABVGString@@HH@Z */
  piVar2 = (int *)FUN_005f7bf0(param_1,param_2,param_3);
  if (*(GRefCountImpl **)(this + 8) != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release(*(GRefCountImpl **)(this + 8));
  }
  *(int **)(this + 8) = piVar2;
  if (piVar2 != (int *)0x0) {
    cVar1 = (**(code **)(*piVar2 + 8))();
    if (cVar1 != '\0') {
      if ((param_2 & 0x20U) != 0) {
        this_00 = (GBufferedFile *)FUN_00515840(0x28,0);
        if (this_00 == (GBufferedFile *)0x0) {
          uVar3 = 0;
        }
        else {
          uVar3 = GBufferedFile::GBufferedFile(this_00,*(GFile **)(this + 8));
        }
        if (*(GRefCountImpl **)(this + 8) != (GRefCountImpl *)0x0) {
          GRefCountImpl::Release(*(GRefCountImpl **)(this + 8));
        }
        *(undefined4 *)(this + 8) = uVar3;
      }
      return true;
    }
  }
  puVar4 = (undefined4 *)FUN_00515840(8,0);
  if (puVar4 == (undefined4 *)0x0) {
    puVar4 = (undefined4 *)0x0;
  }
  else {
    *puVar4 = &PTR_FUN_00cd3f2c;
    puVar4[1] = 1;
    *puVar4 = &PTR_FUN_00b8f3a8;
  }
  if (*(GRefCountImpl **)(this + 8) != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release(*(GRefCountImpl **)(this + 8));
  }
  *(undefined4 **)(this + 8) = puVar4;
  return false;
}



============================================================
DISASSEMBLY
============================================================
005aa5b0 : MOV EAX,dword ptr [ESP + 0xc]
005aa5b4 : PUSH EBX
005aa5b5 : MOV EBX,dword ptr [ESP + 0xc]
005aa5b9 : PUSH ESI
005aa5ba : PUSH EDI
005aa5bb : PUSH EAX
005aa5bc : MOV ESI,ECX
005aa5be : MOV ECX,dword ptr [ESP + 0x14]
005aa5c2 : PUSH EBX
005aa5c3 : PUSH ECX
005aa5c4 : CALL 0x005f7bf0
005aa5c9 : MOV ECX,dword ptr [ESI + 0x8]
005aa5cc : ADD ESP,0xc
005aa5cf : MOV EDI,EAX
005aa5d1 : TEST ECX,ECX
005aa5d3 : JZ 0x005aa5da
005aa5d5 : CALL 0x004ff7e0
005aa5da : MOV ECX,EDI
005aa5dc : MOV dword ptr [ESI + 0x8],EDI
005aa5df : TEST ECX,ECX
005aa5e1 : JZ 0x005aa62e
005aa5e3 : MOV EDX,dword ptr [ECX]
005aa5e5 : MOV EAX,dword ptr [EDX + 0x8]
005aa5e8 : CALL EAX
005aa5ea : TEST AL,AL
005aa5ec : JZ 0x005aa62e
005aa5ee : TEST BL,0x20
005aa5f1 : JZ 0x005aa626
005aa5f3 : MOV ECX,dword ptr [0x00d73250]
005aa5f9 : PUSH 0x0
005aa5fb : PUSH 0x28
005aa5fd : CALL 0x00515840
005aa602 : TEST EAX,EAX
005aa604 : JZ 0x005aa615
005aa606 : MOV EDX,dword ptr [ESI + 0x8]
005aa609 : PUSH EDX
005aa60a : MOV ECX,EAX
005aa60c : CALL 0x005ea570
005aa611 : MOV EDI,EAX
005aa613 : JMP 0x005aa617
005aa615 : XOR EDI,EDI
005aa617 : MOV ECX,dword ptr [ESI + 0x8]
005aa61a : TEST ECX,ECX
005aa61c : JZ 0x005aa623
005aa61e : CALL 0x004ff7e0
005aa623 : MOV dword ptr [ESI + 0x8],EDI
005aa626 : POP EDI
005aa627 : POP ESI
005aa628 : MOV AL,0x1
005aa62a : POP EBX
005aa62b : RET 0xc
005aa62e : MOV ECX,dword ptr [0x00d73250]
005aa634 : PUSH 0x0
005aa636 : PUSH 0x8
005aa638 : CALL 0x00515840
005aa63d : TEST EAX,EAX
005aa63f : JZ 0x005aa658
005aa641 : MOV dword ptr [EAX],0xcd3f2c
005aa647 : MOV dword ptr [EAX + 0x4],0x1
005aa64e : MOV dword ptr [EAX],0xb8f3a8
005aa654 : MOV EDI,EAX
005aa656 : JMP 0x005aa65a
005aa658 : XOR EDI,EDI
005aa65a : MOV ECX,dword ptr [ESI + 0x8]
005aa65d : TEST ECX,ECX
005aa65f : JZ 0x005aa666
005aa661 : CALL 0x004ff7e0
005aa666 : MOV dword ptr [ESI + 0x8],EDI
005aa669 : POP EDI
005aa66a : POP ESI
005aa66b : XOR AL,AL
005aa66d : POP EBX
005aa66e : RET 0xc
