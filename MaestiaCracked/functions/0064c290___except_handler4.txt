PROGRAM  : Maestia.exe
FUNCTION : __except_handler4
ENTRY    : 0064c290
BODY     : [[0064c290, 0064c41b]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    __except_handler4
   
   Library: Visual Studio 2008 Release */

undefined4 __except_handler4(int *param_1,int param_2,undefined4 param_3)

{
  int iVar1;
  int iVar2;
  BOOL BVar3;
  int iVar4;
  int *piVar5;
  int *local_1c;
  undefined4 local_18;
  int *local_14;
  undefined4 local_10;
  int local_c;
  char local_5;
  
  piVar5 = (int *)(*(uint *)(param_2 + 8) ^ DAT_00d66fa0);
  local_5 = '\0';
  local_10 = 1;
  iVar1 = param_2 + 0x10;
  if (*piVar5 != -2) {
    __security_check_cookie(piVar5[1] + iVar1 ^ *(uint *)(*piVar5 + iVar1));
  }
  __security_check_cookie(piVar5[3] + iVar1 ^ *(uint *)(piVar5[2] + iVar1));
  iVar4 = param_2;
  if ((*(byte *)(param_1 + 1) & 0x66) == 0) {
    *(int ***)(param_2 + -4) = &local_1c;
    iVar4 = *(int *)(param_2 + 0xc);
    local_1c = param_1;
    local_18 = param_3;
    if (iVar4 == -2) {
      return local_10;
    }
    do {
      local_14 = piVar5 + iVar4 * 3 + 4;
      local_c = *local_14;
      if (piVar5[iVar4 * 3 + 5] != 0) {
        iVar2 = _EH4_CallFilterFunc(piVar5[iVar4 * 3 + 5],iVar1);
        local_5 = '\x01';
        if (iVar2 < 0) {
          local_10 = 0;
          goto LAB_0064c338;
        }
        if (0 < iVar2) {
          if ((*param_1 == -0x1f928c9d) &&
             (BVar3 = __IsNonwritableInCurrentImage((PBYTE)&PTR____DestructExceptionObject_00b9b094)
             , BVar3 != 0)) {
            ___DestructExceptionObject(param_1,1);
          }
          _EH4_GlobalUnwind(param_2);
          if (*(int *)(param_2 + 0xc) != iVar4) {
            _EH4_LocalUnwind(param_2,iVar4,iVar1,&DAT_00d66fa0);
          }
          *(int *)(param_2 + 0xc) = local_c;
          if (*piVar5 != -2) {
            __security_check_cookie(piVar5[1] + iVar1 ^ *(uint *)(*piVar5 + iVar1));
          }
          __security_check_cookie(piVar5[3] + iVar1 ^ *(uint *)(piVar5[2] + iVar1));
          _EH4_TransferToHandler(local_14[2],iVar1);
          goto LAB_0064c3fc;
        }
      }
      iVar4 = local_c;
    } while (local_c != -2);
    if (local_5 == '\0') {
      return local_10;
    }
  }
  else {
LAB_0064c3fc:
    if (*(int *)(iVar4 + 0xc) == -2) {
      return local_10;
    }
    _EH4_LocalUnwind(iVar4,0xfffffffe,iVar1,&DAT_00d66fa0);
  }
LAB_0064c338:
  if (*piVar5 != -2) {
    __security_check_cookie(piVar5[1] + iVar1 ^ *(uint *)(*piVar5 + iVar1));
  }
  __security_check_cookie(piVar5[3] + iVar1 ^ *(uint *)(piVar5[2] + iVar1));
  return local_10;
}



============================================================
DISASSEMBLY
============================================================
0064c290 : MOV EDI,EDI
0064c292 : PUSH EBP
0064c293 : MOV EBP,ESP
0064c295 : SUB ESP,0x18
0064c298 : PUSH EBX
0064c299 : MOV EBX,dword ptr [EBP + 0xc]
0064c29c : PUSH ESI
0064c29d : MOV ESI,dword ptr [EBX + 0x8]
0064c2a0 : XOR ESI,dword ptr [0x00d66fa0]
0064c2a6 : PUSH EDI
0064c2a7 : MOV EAX,dword ptr [ESI]
0064c2a9 : MOV byte ptr [EBP + -0x1],0x0
0064c2ad : MOV dword ptr [EBP + -0xc],0x1
0064c2b4 : LEA EDI,[EBX + 0x10]
0064c2b7 : CMP EAX,-0x2
0064c2ba : JZ 0x0064c2c9
0064c2bc : MOV ECX,dword ptr [ESI + 0x4]
0064c2bf : ADD ECX,EDI
0064c2c1 : XOR ECX,dword ptr [EAX + EDI*0x1]
0064c2c4 : CALL 0x00633e6b
0064c2c9 : MOV ECX,dword ptr [ESI + 0xc]
0064c2cc : MOV EAX,dword ptr [ESI + 0x8]
0064c2cf : ADD ECX,EDI
0064c2d1 : XOR ECX,dword ptr [EAX + EDI*0x1]
0064c2d4 : CALL 0x00633e6b
0064c2d9 : MOV EAX,dword ptr [EBP + 0x8]
0064c2dc : TEST byte ptr [EAX + 0x4],0x66
0064c2e0 : JNZ 0x0064c3fc
0064c2e6 : MOV ECX,dword ptr [EBP + 0x10]
0064c2e9 : LEA EDX,[EBP + -0x18]
0064c2ec : MOV dword ptr [EBX + -0x4],EDX
0064c2ef : MOV EBX,dword ptr [EBX + 0xc]
0064c2f2 : MOV dword ptr [EBP + -0x18],EAX
0064c2f5 : MOV dword ptr [EBP + -0x14],ECX
0064c2f8 : CMP EBX,-0x2
0064c2fb : JZ 0x0064c35c
0064c2fd : LEA ECX,[ECX]
0064c300 : LEA EAX,[EBX + EBX*0x2]
0064c303 : MOV ECX,dword ptr [ESI + EAX*0x4 + 0x14]
0064c307 : LEA EAX,[ESI + EAX*0x4 + 0x10]
0064c30b : MOV dword ptr [EBP + -0x10],EAX
0064c30e : MOV EAX,dword ptr [EAX]
0064c310 : MOV dword ptr [EBP + -0x8],EAX
0064c313 : TEST ECX,ECX
0064c315 : JZ 0x0064c32b
0064c317 : MOV EDX,EDI
0064c319 : CALL 0x0064dbe6
0064c31e : MOV byte ptr [EBP + -0x1],0x1
0064c322 : TEST EAX,EAX
0064c324 : JL 0x0064c366
0064c326 : JG 0x0064c36f
0064c328 : MOV EAX,dword ptr [EBP + -0x8]
0064c32b : MOV EBX,EAX
0064c32d : CMP EAX,-0x2
0064c330 : JNZ 0x0064c300
0064c332 : CMP byte ptr [EBP + -0x1],0x0
0064c336 : JZ 0x0064c35c
0064c338 : MOV EAX,dword ptr [ESI]
0064c33a : CMP EAX,-0x2
0064c33d : JZ 0x0064c34c
0064c33f : MOV ECX,dword ptr [ESI + 0x4]
0064c342 : ADD ECX,EDI
0064c344 : XOR ECX,dword ptr [EAX + EDI*0x1]
0064c347 : CALL 0x00633e6b
0064c34c : MOV ECX,dword ptr [ESI + 0xc]
0064c34f : MOV EDX,dword ptr [ESI + 0x8]
0064c352 : ADD ECX,EDI
0064c354 : XOR ECX,dword ptr [EDX + EDI*0x1]
0064c357 : CALL 0x00633e6b
0064c35c : MOV EAX,dword ptr [EBP + -0xc]
0064c35f : POP EDI
0064c360 : POP ESI
0064c361 : POP EBX
0064c362 : MOV ESP,EBP
0064c364 : POP EBP
0064c365 : RET
0064c366 : MOV dword ptr [EBP + -0xc],0x0
0064c36d : JMP 0x0064c338
0064c36f : MOV ECX,dword ptr [EBP + 0x8]
0064c372 : CMP dword ptr [ECX],0xe06d7363
0064c378 : JNZ 0x0064c3a3
0064c37a : CMP dword ptr [0x00b9b094],0x0
0064c381 : JZ 0x0064c3a3
0064c383 : PUSH 0xb9b094
0064c388 : CALL 0x0064c6d0
0064c38d : ADD ESP,0x4
0064c390 : TEST EAX,EAX
0064c392 : JZ 0x0064c3a3
0064c394 : MOV EDX,dword ptr [EBP + 0x8]
0064c397 : PUSH 0x1
0064c399 : PUSH EDX
0064c39a : CALL dword ptr [0x00b9b094]
0064c3a0 : ADD ESP,0x8
0064c3a3 : MOV ECX,dword ptr [EBP + 0xc]
0064c3a6 : CALL 0x0064dc16
0064c3ab : MOV EAX,dword ptr [EBP + 0xc]
0064c3ae : CMP dword ptr [EAX + 0xc],EBX
0064c3b1 : JZ 0x0064c3c5
0064c3b3 : PUSH 0xd66fa0
0064c3b8 : PUSH EDI
0064c3b9 : MOV EDX,EBX
0064c3bb : MOV ECX,EAX
0064c3bd : CALL 0x0064dc30
0064c3c2 : MOV EAX,dword ptr [EBP + 0xc]
0064c3c5 : MOV ECX,dword ptr [EBP + -0x8]
0064c3c8 : MOV dword ptr [EAX + 0xc],ECX
0064c3cb : MOV EAX,dword ptr [ESI]
0064c3cd : CMP EAX,-0x2
0064c3d0 : JZ 0x0064c3df
0064c3d2 : MOV ECX,dword ptr [ESI + 0x4]
0064c3d5 : ADD ECX,EDI
0064c3d7 : XOR ECX,dword ptr [EAX + EDI*0x1]
0064c3da : CALL 0x00633e6b
0064c3df : MOV ECX,dword ptr [ESI + 0xc]
0064c3e2 : MOV EDX,dword ptr [ESI + 0x8]
0064c3e5 : ADD ECX,EDI
0064c3e7 : XOR ECX,dword ptr [EDX + EDI*0x1]
0064c3ea : CALL 0x00633e6b
0064c3ef : MOV EAX,dword ptr [EBP + -0x10]
0064c3f2 : MOV ECX,dword ptr [EAX + 0x8]
0064c3f5 : MOV EDX,EDI
0064c3f7 : CALL 0x0064dbfd
0064c3fc : MOV EDX,0xfffffffe
0064c401 : CMP dword ptr [EBX + 0xc],EDX
0064c404 : JZ 0x0064c35c
0064c40a : PUSH 0xd66fa0
0064c40f : PUSH EDI
0064c410 : MOV ECX,EBX
0064c412 : CALL 0x0064dc30
0064c417 : JMP 0x0064c338
