PROGRAM  : Maestia.exe
FUNCTION : FUN_00684b20
ENTRY    : 00684b20
BODY     : [[00684b20, 00684bb7] [00684bc0, 00684cbd]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00684b20(undefined4 param_1,char *param_2,undefined4 param_3,char *param_4)

{
  int *piVar1;
  char cVar2;
  char *_Dst;
  LONG LVar3;
  undefined4 uVar4;
  int in_ECX;
  uint uVar5;
  int iVar6;
  rsize_t _MaxCount;
  uint local_18;
  char *local_14;
  int local_10;
  int local_c;
  int local_8;
  int local_4;
  
  switch((int)param_2 + -0xf1) {
  case 0:
    *(undefined1 *)(in_ECX + 8) = 0;
    return 1;
  case 1:
    uVar4 = FUN_00634f2c(param_4);
    *(undefined4 *)(in_ECX + 0x820) = uVar4;
    FUN_00684870();
    return 1;
  case 2:
    break;
  default:
    return 0;
  case 5:
    uVar4 = FUN_00634f2c(param_4);
    *(undefined4 *)(in_ECX + 0x830) = uVar4;
    return 1;
  }
  piVar1 = (int *)(in_ECX + 0x808);
  local_8 = in_ECX;
  FUN_00684960(piVar1,0);
  local_4 = in_ECX + 0x814;
  FUN_006849c0(local_4,0);
  param_2 = (char *)0x0;
  iVar6 = in_ECX;
  if (*param_4 != '\0') {
    local_c = 1 - (int)param_4;
    local_14 = param_4;
    local_10 = 0;
LAB_00684bc8:
    do {
      cVar2 = local_14[1];
      local_14 = local_14 + 1;
      local_10 = local_10 + 1;
      if ((cVar2 != ',') && (cVar2 != ':')) {
        if (cVar2 != '\0') goto LAB_00684bc8;
      }
      _MaxCount = local_10 - (int)param_2;
      _Dst = _malloc(_MaxCount + 1);
      _strncpy_s(_Dst,_MaxCount + 1,param_2 + (int)param_4,_MaxCount);
      _Dst[_MaxCount] = '\0';
      FUN_0051c480(_Dst);
      FUN_00684960(piVar1,*(int *)(in_ECX + 0x80c) + 1);
      if (*piVar1 + -4 + *(int *)(in_ECX + 0x80c) * 4 != 0) {
        FUN_0051c600(&local_18);
      }
      uVar5 = local_18 & 0xfffffffc;
      LVar3 = InterlockedExchangeAdd((LONG *)(uVar5 + 4),-1);
      if (LVar3 == 1) {
        FUN_00515cf0(uVar5);
      }
      _free(_Dst);
      param_2 = local_14 + local_c;
      iVar6 = local_8;
    } while (*local_14 != '\0');
  }
  FUN_00684a90(*(undefined4 *)(iVar6 + 0x80c));
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00684b20 : SUB ESP,0x18
00684b23 : MOV EAX,dword ptr [ESP + 0x20]
00684b27 : PUSH EBX
00684b28 : ADD EAX,0xffffff0f
00684b2d : MOV EBX,ECX
00684b2f : MOV dword ptr [ESP + 0x14],EBX
00684b33 : CMP EAX,0x5
00684b36 : JA 0x00684cb5
00684b3c : JMP dword ptr [EAX*0x4 + 0x684cc0]
00684b43 : MOV byte ptr [EBX + 0x8],0x0
00684b47 : MOV AL,0x1
00684b49 : POP EBX
00684b4a : ADD ESP,0x18
00684b4d : RET 0x10
00684b50 : MOV EAX,dword ptr [ESP + 0x2c]
00684b54 : PUSH EAX
00684b55 : CALL 0x00634f2c
00684b5a : ADD ESP,0x4
00684b5d : MOV ECX,EBX
00684b5f : MOV dword ptr [EBX + 0x820],EAX
00684b65 : CALL 0x00684870
00684b6a : MOV AL,0x1
00684b6c : POP EBX
00684b6d : ADD ESP,0x18
00684b70 : RET 0x10
00684b73 : PUSH EBP
00684b74 : PUSH ESI
00684b75 : PUSH EDI
00684b76 : XOR EBP,EBP
00684b78 : LEA ESI,[EBX + 0x808]
00684b7e : PUSH EBP
00684b7f : PUSH ESI
00684b80 : MOV ECX,ESI
00684b82 : CALL 0x00684960
00684b87 : LEA EDI,[EBX + 0x814]
00684b8d : PUSH EBP
00684b8e : PUSH EDI
00684b8f : MOV ECX,EDI
00684b91 : MOV dword ptr [ESP + 0x2c],EDI
00684b95 : CALL 0x006849c0
00684b9a : MOV ECX,dword ptr [ESP + 0x38]
00684b9e : CMP byte ptr [ECX],0x0
00684ba1 : MOV dword ptr [ESP + 0x30],EBP
00684ba5 : JZ 0x00684c7f
00684bab : MOV EAX,0x1
00684bb0 : SUB EAX,ECX
00684bb2 : MOV dword ptr [ESP + 0x1c],EAX
00684bb6 : JMP 0x00684bc8
00684bc0 : MOV EBP,dword ptr [ESP + 0x18]
00684bc4 : MOV ECX,dword ptr [ESP + 0x14]
00684bc8 : MOV AL,byte ptr [ECX + 0x1]
00684bcb : INC ECX
00684bcc : INC EBP
00684bcd : MOV dword ptr [ESP + 0x18],EBP
00684bd1 : MOV dword ptr [ESP + 0x14],ECX
00684bd5 : CMP AL,0x2c
00684bd7 : JZ 0x00684be1
00684bd9 : CMP AL,0x3a
00684bdb : JZ 0x00684be1
00684bdd : TEST AL,AL
00684bdf : JNZ 0x00684bc8
00684be1 : SUB EBP,dword ptr [ESP + 0x30]
00684be5 : LEA EBX,[EBP + 0x1]
00684be8 : PUSH EBX
00684be9 : CALL 0x00636043
00684bee : MOV EDX,dword ptr [ESP + 0x3c]
00684bf2 : MOV ECX,dword ptr [ESP + 0x34]
00684bf6 : PUSH EBP
00684bf7 : ADD ECX,EDX
00684bf9 : PUSH ECX
00684bfa : MOV EDI,EAX
00684bfc : PUSH EBX
00684bfd : PUSH EDI
00684bfe : CALL 0x0063c196
00684c03 : ADD ESP,0x14
00684c06 : PUSH EDI
00684c07 : LEA ECX,[ESP + 0x14]
00684c0b : MOV byte ptr [EDI + EBX*0x1 + -0x1],0x0
00684c10 : CALL 0x0051c480
00684c15 : MOV EAX,dword ptr [ESI + 0x4]
00684c18 : INC EAX
00684c19 : PUSH EAX
00684c1a : PUSH ESI
00684c1b : MOV ECX,ESI
00684c1d : CALL 0x00684960
00684c22 : MOV ECX,dword ptr [ESI + 0x4]
00684c25 : MOV EDX,dword ptr [ESI]
00684c27 : LEA ECX,[EDX + ECX*0x4 + -0x4]
00684c2b : TEST ECX,ECX
00684c2d : JZ 0x00684c39
00684c2f : LEA EAX,[ESP + 0x10]
00684c33 : PUSH EAX
00684c34 : CALL 0x0051c600
00684c39 : MOV EBX,dword ptr [ESP + 0x10]
00684c3d : AND EBX,0xfffffffc
00684c40 : PUSH -0x1
00684c42 : LEA ECX,[EBX + 0x4]
00684c45 : PUSH ECX
00684c46 : CALL dword ptr [0x00b851cc]
00684c4c : SUB EAX,0x1
00684c4f : JNZ 0x00684c57
00684c51 : PUSH EBX
00684c52 : CALL 0x00515cf0
00684c57 : PUSH EDI
00684c58 : CALL 0x0063610d
00684c5d : MOV EAX,dword ptr [ESP + 0x18]
00684c61 : MOV EDX,dword ptr [ESP + 0x20]
00684c65 : ADD EDX,EAX
00684c67 : ADD ESP,0x4
00684c6a : CMP byte ptr [EAX],0x0
00684c6d : MOV dword ptr [ESP + 0x30],EDX
00684c71 : JNZ 0x00684bc0
00684c77 : MOV EBX,dword ptr [ESP + 0x20]
00684c7b : MOV EDI,dword ptr [ESP + 0x24]
00684c7f : MOV EAX,dword ptr [EBX + 0x80c]
00684c85 : PUSH EAX
00684c86 : MOV ECX,EDI
00684c88 : CALL 0x00684a90
00684c8d : POP EDI
00684c8e : POP ESI
00684c8f : POP EBP
00684c90 : MOV AL,0x1
00684c92 : POP EBX
00684c93 : ADD ESP,0x18
00684c96 : RET 0x10
00684c99 : MOV ECX,dword ptr [ESP + 0x2c]
00684c9d : PUSH ECX
00684c9e : CALL 0x00634f2c
00684ca3 : ADD ESP,0x4
00684ca6 : MOV dword ptr [EBX + 0x830],EAX
00684cac : MOV AL,0x1
00684cae : POP EBX
00684caf : ADD ESP,0x18
00684cb2 : RET 0x10
00684cb5 : XOR AL,AL
00684cb7 : POP EBX
00684cb8 : ADD ESP,0x18
00684cbb : RET 0x10
