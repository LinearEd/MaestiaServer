PROGRAM  : Maestia.exe
FUNCTION : FUN_005520e0
ENTRY    : 005520e0
BODY     : [[005520e0, 00552474]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

undefined1 FUN_005520e0(char *param_1,int *param_2,char *param_3,byte *param_4)

{
  char *pcVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  char *pcVar5;
  char cVar6;
  undefined1 uVar7;
  uint *puVar8;
  GRefCountNTSImpl *this;
  GRefCountNTSImpl *pGVar9;
  undefined4 uVar10;
  int *in_ECX;
  bool bVar11;
  byte local_49;
  uint *local_48;
  int local_44;
  uint *local_40;
  int local_3c;
  int local_38;
  int local_34;
  byte local_30;
  int local_2c;
  int local_28;
  byte local_24;
  char local_20 [32];
  
  pcVar5 = param_3;
  iVar4 = (int)param_1;
  if ((_DAT_00d73284 & 1) == 0) {
    _DAT_00d73284 = _DAT_00d73284 | 1;
    DAT_00d73274 = 10;
    _atexit((_func_4879 *)&LAB_00b84b80);
  }
  local_49 = 0;
  FUN_00530180(&local_48,param_2,6 < *(byte *)((int)param_1 + 0x7c));
  puVar8 = local_48;
  if (((local_48 == (uint *)0x0) || (*local_48 == 0)) || (*(int *)(*local_48 + 4) < local_44)) {
    for (iVar2 = in_ECX[1]; iVar2 != 0; iVar2 = *(int *)(iVar2 + 0x14)) {
      if (((*(char *)(iVar2 + 0x2c) != '\0') &&
          (FUN_00530180(&local_40,param_2,6 < *(byte *)((int)param_1 + 0x7c)), puVar8 = local_48,
          local_40 != (uint *)0x0)) && ((*local_40 != 0 && (local_3c <= *(int *)(*local_40 + 4)))))
      {
        if (*(char *)(*local_40 + 0x10 + local_3c * 0x18) == '\t') {
          local_48 = local_40;
          local_44 = local_3c;
          puVar8 = local_40;
        }
        break;
      }
    }
  }
  if (((puVar8 == (uint *)0x0) || (*puVar8 == 0)) || (*(int *)(*puVar8 + 4) < local_44)) {
    local_49 = *param_4;
    param_1 = (char *)0x0;
  }
  else {
    pcVar1 = (char *)(*puVar8 + 0x10 + local_44 * 0x18);
    local_49 = pcVar1[1];
    if (*pcVar1 == '\t') {
      FUN_005266c0(pcVar1);
      this = (GRefCountNTSImpl *)(**(code **)(in_ECX[-4] + 0x1c))();
      if (this == (GRefCountNTSImpl *)0x0) {
        pGVar9 = (GRefCountNTSImpl *)(-(uint)(in_ECX != (int *)0x10) & (uint)in_ECX);
      }
      else {
        *(int *)(this + 4) = *(int *)(this + 4) + 1;
        pGVar9 = this + 0x68;
      }
      FUN_00527fe0(param_1,pGVar9,param_3);
      if (this != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release(this);
      }
      FUN_00526bc0();
      return 1;
    }
    param_1 = pcVar1;
    if ((local_49 & 4) != 0) {
      return 0;
    }
  }
  local_20[0] = '\0';
  if ((in_ECX[6] != 0) && (cVar6 = FUN_005519d0(iVar4,param_2,param_3,local_20), cVar6 != '\0')) {
    param_3 = local_20;
  }
  if (param_1 == (char *)0x0) {
    uVar7 = (**(code **)(*in_ECX + 0x28))(iVar4 + 0x78,param_2,param_3,&local_49);
    FUN_00526bc0();
    return uVar7;
  }
  if (*pcVar5 == '\t') {
    *(undefined1 *)(in_ECX + 7) = 1;
  }
  iVar2 = *param_2;
  if (*(byte *)(iVar4 + 0x7c) < 7) {
    if (*(int *)(iVar2 + 4) == 0) {
      FUN_00525a80();
    }
    iVar2 = *(int *)(iVar4 + 0x78);
    iVar3 = *(int *)(*param_2 + 4);
    if (*(int *)(*(int *)(iVar2 + 0x134) + 4) != iVar3) {
      if (*(int *)(*(int *)(iVar2 + 0x144) + 4) != iVar3) {
        bVar11 = *param_2 == *(int *)(iVar2 + 0x194);
        goto LAB_00552449;
      }
      if (*pcVar5 != '\n') {
        uVar10 = FUN_00527140(&local_2c,iVar4);
        FUN_00568a50(uVar10);
        if (((local_24 & 2) == 0) && (local_2c != 0)) {
          FUN_00503db0();
        }
        local_2c = 0;
        if (((local_24 & 1) == 0) && (local_28 != 0)) {
          FUN_00503db0();
        }
      }
      goto LAB_00552439;
    }
    if (*pcVar5 != '\n') {
      iVar2 = *in_ECX;
      uVar10 = FUN_00526fa0(iVar4);
      (**(code **)(iVar2 + 0x34))(iVar4 + 0x78,uVar10);
      FUN_0052a3a0();
    }
  }
  else {
    iVar3 = *(int *)(iVar4 + 0x78);
    if (iVar2 != *(int *)(iVar3 + 0x134)) {
      if (iVar2 != *(int *)(iVar3 + 0x144)) {
        bVar11 = iVar2 == *(int *)(iVar3 + 0x194);
LAB_00552449:
        if (bVar11) {
          FUN_0052a3a0();
        }
        goto LAB_00552452;
      }
      if (*pcVar5 != '\n') {
        uVar10 = FUN_00527140(&local_38,iVar4);
        FUN_00568a50(uVar10);
        if (((local_30 & 2) == 0) && (local_38 != 0)) {
          FUN_00503db0();
        }
        local_38 = 0;
        if (((local_30 & 1) == 0) && (local_34 != 0)) {
          FUN_00503db0();
          param_3 = &DAT_00d73274;
          goto LAB_00552452;
        }
      }
LAB_00552439:
      param_3 = &DAT_00d73274;
      goto LAB_00552452;
    }
    if (*pcVar5 != '\n') {
      iVar2 = *in_ECX;
      uVar10 = FUN_00526fa0(iVar4);
      (**(code **)(iVar2 + 0x34))(iVar4 + 0x78,uVar10);
      FUN_0052a3a0();
      param_3 = &DAT_00d73274;
      goto LAB_00552452;
    }
  }
  param_3 = &DAT_00d73274;
LAB_00552452:
  FUN_005268b0(param_3);
  FUN_00526bc0();
  return 1;
}



============================================================
DISASSEMBLY
============================================================
005520e0 : SUB ESP,0x4c
005520e3 : TEST byte ptr [0x00d73284],0x1
005520ea : PUSH EBX
005520eb : PUSH EBP
005520ec : PUSH ESI
005520ed : PUSH EDI
005520ee : MOV EBP,ECX
005520f0 : JNZ 0x0055210d
005520f2 : OR dword ptr [0x00d73284],0x1
005520f9 : PUSH 0xb84b80
005520fe : MOV byte ptr [0x00d73274],0xa
00552105 : CALL 0x006356bc
0055210a : ADD ESP,0x4
0055210d : MOV ESI,dword ptr [ESP + 0x60]
00552111 : CMP byte ptr [ESI + 0x7c],0x6
00552115 : MOV EBX,dword ptr [ESP + 0x64]
00552119 : SETA AL
0055211c : MOVZX ECX,AL
0055211f : PUSH ECX
00552120 : PUSH EBX
00552121 : LEA EDX,[ESP + 0x1c]
00552125 : PUSH EDX
00552126 : LEA ECX,[EBP + 0x8]
00552129 : MOV byte ptr [ESP + 0x1f],0x0
0055212e : CALL 0x00530180
00552133 : MOV EAX,dword ptr [ESP + 0x14]
00552137 : TEST EAX,EAX
00552139 : JZ 0x0055214b
0055213b : CMP dword ptr [EAX],0x0
0055213e : JZ 0x0055214b
00552140 : MOV ECX,dword ptr [EAX]
00552142 : MOV EDX,dword ptr [ESP + 0x18]
00552146 : CMP EDX,dword ptr [ECX + 0x4]
00552149 : JLE 0x005521ae
0055214b : MOV EDI,dword ptr [EBP + 0x4]
0055214e : TEST EDI,EDI
00552150 : JZ 0x005521ae
00552152 : CMP byte ptr [EDI + 0x2c],0x0
00552156 : JZ 0x0055218d
00552158 : CMP byte ptr [ESI + 0x7c],0x6
0055215c : LEA EDX,[ESP + 0x1c]
00552160 : SETA AL
00552163 : MOVZX ECX,AL
00552166 : PUSH ECX
00552167 : PUSH EBX
00552168 : PUSH EDX
00552169 : LEA ECX,[EDI + 0x18]
0055216c : CALL 0x00530180
00552171 : MOV EAX,dword ptr [ESP + 0x1c]
00552175 : TEST EAX,EAX
00552177 : JZ 0x00552189
00552179 : CMP dword ptr [EAX],0x0
0055217c : JZ 0x00552189
0055217e : MOV EDX,dword ptr [EAX]
00552180 : MOV ECX,dword ptr [ESP + 0x20]
00552184 : CMP ECX,dword ptr [EDX + 0x4]
00552187 : JLE 0x00552196
00552189 : MOV EAX,dword ptr [ESP + 0x14]
0055218d : MOV EDI,dword ptr [EDI + 0x14]
00552190 : TEST EDI,EDI
00552192 : JNZ 0x00552152
00552194 : JMP 0x005521ae
00552196 : MOV EDI,dword ptr [EAX]
00552198 : LEA EDX,[ECX + ECX*0x2]
0055219b : CMP byte ptr [EDI + EDX*0x8 + 0x10],0x9
005521a0 : JNZ 0x005521aa
005521a2 : MOV dword ptr [ESP + 0x14],EAX
005521a6 : MOV dword ptr [ESP + 0x18],ECX
005521aa : MOV EAX,dword ptr [ESP + 0x14]
005521ae : TEST EAX,EAX
005521b0 : JZ 0x00552251
005521b6 : CMP dword ptr [EAX],0x0
005521b9 : JZ 0x00552251
005521bf : MOV EAX,dword ptr [EAX]
005521c1 : MOV ECX,dword ptr [ESP + 0x18]
005521c5 : CMP ECX,dword ptr [EAX + 0x4]
005521c8 : JG 0x00552251
005521ce : LEA ECX,[ECX + ECX*0x2]
005521d1 : LEA ECX,[EAX + ECX*0x8 + 0x10]
005521d5 : MOV AL,byte ptr [ECX + 0x1]
005521d8 : MOV byte ptr [ESP + 0x13],AL
005521dc : CMP byte ptr [ECX],0x9
005521df : MOV dword ptr [ESP + 0x60],ECX
005521e3 : JNZ 0x00552241
005521e5 : PUSH ECX
005521e6 : LEA ECX,[ESP + 0x50]
005521ea : CALL 0x005266c0
005521ef : MOV EDX,dword ptr [EBP + -0x10]
005521f2 : MOV EAX,dword ptr [EDX + 0x1c]
005521f5 : LEA ECX,[EBP + -0x10]
005521f8 : CALL EAX
005521fa : MOV EDI,EAX
005521fc : TEST EDI,EDI
005521fe : JZ 0x00552208
00552200 : INC dword ptr [EDI + 0x4]
00552203 : LEA EAX,[EDI + 0x68]
00552206 : JMP 0x00552211
00552208 : LEA EAX,[EBP + -0x10]
0055220b : NEG EAX
0055220d : SBB EAX,EAX
0055220f : AND EAX,EBP
00552211 : MOV ECX,dword ptr [ESP + 0x68]
00552215 : PUSH ECX
00552216 : PUSH EAX
00552217 : PUSH ESI
00552218 : LEA ECX,[ESP + 0x58]
0055221c : CALL 0x00527fe0
00552221 : TEST EDI,EDI
00552223 : JZ 0x0055222c
00552225 : MOV ECX,EDI
00552227 : CALL 0x004ff7c0
0055222c : LEA ECX,[ESP + 0x4c]
00552230 : CALL 0x00526bc0
00552235 : POP EDI
00552236 : POP ESI
00552237 : POP EBP
00552238 : MOV AL,0x1
0055223a : POP EBX
0055223b : ADD ESP,0x4c
0055223e : RET 0x10
00552241 : TEST AL,0x4
00552243 : JZ 0x00552263
00552245 : POP EDI
00552246 : POP ESI
00552247 : POP EBP
00552248 : XOR AL,AL
0055224a : POP EBX
0055224b : ADD ESP,0x4c
0055224e : RET 0x10
00552251 : MOV EDX,dword ptr [ESP + 0x6c]
00552255 : MOV AL,byte ptr [EDX]
00552257 : MOV byte ptr [ESP + 0x13],AL
0055225b : MOV dword ptr [ESP + 0x60],0x0
00552263 : CMP dword ptr [EBP + 0x18],0x0
00552267 : MOV EDI,dword ptr [ESP + 0x68]
0055226b : MOV byte ptr [ESP + 0x3c],0x0
00552270 : MOV dword ptr [ESP + 0x68],EDI
00552274 : JZ 0x00552292
00552276 : LEA ECX,[ESP + 0x3c]
0055227a : PUSH ECX
0055227b : PUSH EDI
0055227c : PUSH EBX
0055227d : PUSH ESI
0055227e : LEA ECX,[EBP + -0x10]
00552281 : CALL 0x005519d0
00552286 : TEST AL,AL
00552288 : JZ 0x00552292
0055228a : LEA EDX,[ESP + 0x3c]
0055228e : MOV dword ptr [ESP + 0x68],EDX
00552292 : CMP dword ptr [ESP + 0x60],0x0
00552297 : JNZ 0x005522c9
00552299 : MOV EDX,dword ptr [ESP + 0x68]
0055229d : MOV EAX,dword ptr [EBP]
005522a0 : MOV EAX,dword ptr [EAX + 0x28]
005522a3 : LEA ECX,[ESP + 0x13]
005522a7 : PUSH ECX
005522a8 : PUSH EDX
005522a9 : PUSH EBX
005522aa : ADD ESI,0x78
005522ad : PUSH ESI
005522ae : MOV ECX,EBP
005522b0 : CALL EAX
005522b2 : LEA ECX,[ESP + 0x3c]
005522b6 : MOV BL,AL
005522b8 : CALL 0x00526bc0
005522bd : POP EDI
005522be : POP ESI
005522bf : POP EBP
005522c0 : MOV AL,BL
005522c2 : POP EBX
005522c3 : ADD ESP,0x4c
005522c6 : RET 0x10
005522c9 : CMP byte ptr [EDI],0x9
005522cc : JNZ 0x005522d2
005522ce : MOV byte ptr [EBP + 0x1c],0x1
005522d2 : CMP byte ptr [ESI + 0x7c],0x6
005522d6 : MOV ECX,dword ptr [EBX]
005522d8 : JBE 0x00552396
005522de : MOV EAX,dword ptr [ESI + 0x78]
005522e1 : CMP ECX,dword ptr [EAX + 0x134]
005522e7 : JNZ 0x0055231f
005522e9 : CMP byte ptr [EDI],0xa
005522ec : JZ 0x005523d9
005522f2 : MOV EBX,dword ptr [EBP]
005522f5 : PUSH ESI
005522f6 : MOV ECX,EDI
005522f8 : ADD EBX,0x34
005522fb : CALL 0x00526fa0
00552300 : MOV EDX,dword ptr [EBX]
00552302 : PUSH EAX
00552303 : LEA EAX,[ESI + 0x78]
00552306 : PUSH EAX
00552307 : MOV ECX,EBP
00552309 : CALL EDX
0055230b : MOV ECX,ESI
0055230d : CALL 0x0052a3a0
00552312 : MOV dword ptr [ESP + 0x68],0xd73274
0055231a : JMP 0x00552452
0055231f : CMP ECX,dword ptr [EAX + 0x144]
00552325 : JNZ 0x0055238b
00552327 : CMP byte ptr [EDI],0xa
0055232a : JZ 0x00552439
00552330 : PUSH ESI
00552331 : LEA EAX,[ESP + 0x28]
00552335 : PUSH EAX
00552336 : MOV ECX,EDI
00552338 : CALL 0x00527140
0055233d : PUSH EAX
0055233e : LEA ECX,[EBP + 0xc]
00552341 : CALL 0x00568a50
00552346 : TEST byte ptr [ESP + 0x2c],0x2
0055234b : JNZ 0x0055235a
0055234d : MOV ECX,dword ptr [ESP + 0x24]
00552351 : TEST ECX,ECX
00552353 : JZ 0x0055235a
00552355 : CALL 0x00503db0
0055235a : TEST byte ptr [ESP + 0x2c],0x1
0055235f : MOV dword ptr [ESP + 0x24],0x0
00552367 : JNZ 0x00552439
0055236d : MOV ECX,dword ptr [ESP + 0x28]
00552371 : TEST ECX,ECX
00552373 : JZ 0x00552439
00552379 : CALL 0x00503db0
0055237e : MOV dword ptr [ESP + 0x68],0xd73274
00552386 : JMP 0x00552452
0055238b : CMP ECX,dword ptr [EAX + 0x194]
00552391 : JMP 0x00552449
00552396 : CMP dword ptr [ECX + 0x4],0x0
0055239a : JNZ 0x005523a1
0055239c : CALL 0x00525a80
005523a1 : MOV EAX,dword ptr [ESI + 0x78]
005523a4 : MOV EBX,dword ptr [EBX]
005523a6 : MOV ECX,dword ptr [EBX + 0x4]
005523a9 : MOV EDX,dword ptr [EAX + 0x134]
005523af : CMP dword ptr [EDX + 0x4],ECX
005523b2 : JNZ 0x005523e3
005523b4 : CMP byte ptr [EDI],0xa
005523b7 : JZ 0x005523d9
005523b9 : MOV EBX,dword ptr [EBP]
005523bc : PUSH ESI
005523bd : MOV ECX,EDI
005523bf : ADD EBX,0x34
005523c2 : CALL 0x00526fa0
005523c7 : PUSH EAX
005523c8 : LEA EAX,[ESI + 0x78]
005523cb : PUSH EAX
005523cc : MOV EAX,dword ptr [EBX]
005523ce : MOV ECX,EBP
005523d0 : CALL EAX
005523d2 : MOV ECX,ESI
005523d4 : CALL 0x0052a3a0
005523d9 : MOV dword ptr [ESP + 0x68],0xd73274
005523e1 : JMP 0x00552452
005523e3 : MOV EDX,dword ptr [EAX + 0x144]
005523e9 : CMP dword ptr [EDX + 0x4],ECX
005523ec : JNZ 0x00552443
005523ee : CMP byte ptr [EDI],0xa
005523f1 : JZ 0x00552439
005523f3 : PUSH ESI
005523f4 : LEA EAX,[ESP + 0x34]
005523f8 : PUSH EAX
005523f9 : MOV ECX,EDI
005523fb : CALL 0x00527140
00552400 : PUSH EAX
00552401 : LEA ECX,[EBP + 0xc]
00552404 : CALL 0x00568a50
00552409 : TEST byte ptr [ESP + 0x38],0x2
0055240e : JNZ 0x0055241d
00552410 : MOV ECX,dword ptr [ESP + 0x30]
00552414 : TEST ECX,ECX
00552416 : JZ 0x0055241d
00552418 : CALL 0x00503db0
0055241d : TEST byte ptr [ESP + 0x38],0x1
00552422 : MOV dword ptr [ESP + 0x30],0x0
0055242a : JNZ 0x00552439
0055242c : MOV ECX,dword ptr [ESP + 0x34]
00552430 : TEST ECX,ECX
00552432 : JZ 0x00552439
00552434 : CALL 0x00503db0
00552439 : MOV dword ptr [ESP + 0x68],0xd73274
00552441 : JMP 0x00552452
00552443 : CMP EBX,dword ptr [EAX + 0x194]
00552449 : JNZ 0x00552452
0055244b : MOV ECX,ESI
0055244d : CALL 0x0052a3a0
00552452 : MOV ECX,dword ptr [ESP + 0x68]
00552456 : PUSH ECX
00552457 : MOV ECX,dword ptr [ESP + 0x64]
0055245b : CALL 0x005268b0
00552460 : LEA ECX,[ESP + 0x3c]
00552464 : CALL 0x00526bc0
00552469 : POP EDI
0055246a : POP ESI
0055246b : POP EBP
0055246c : MOV AL,0x1
0055246e : POP EBX
0055246f : ADD ESP,0x4c
00552472 : RET 0x10
