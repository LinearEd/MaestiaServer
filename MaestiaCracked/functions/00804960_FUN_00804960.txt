PROGRAM  : Maestia.exe
FUNCTION : FUN_00804960
ENTRY    : 00804960
BODY     : [[00804960, 00804b11]]

============================================================
DECOMPILED C CODE
============================================================

uint FUN_00804960(void)

{
  uint *puVar1;
  uint uVar2;
  int iVar3;
  ushort uVar4;
  uint in_EAX;
  int iVar5;
  uint uVar6;
  int iVar7;
  int *unaff_ESI;
  
  if (unaff_ESI[2] + 8U <= (uint)unaff_ESI[1]) {
    iVar5 = FUN_004575f0();
    unaff_ESI[7] = iVar5;
    iVar5 = FUN_004575f0();
    unaff_ESI[10] = iVar5;
    iVar5 = FUN_004575f0();
    unaff_ESI[0xd] = iVar5;
    iVar5 = FUN_004575f0();
    unaff_ESI[0x10] = iVar5;
    iVar5 = FUN_004575f0();
    iVar3 = unaff_ESI[7];
    unaff_ESI[0x13] = iVar5;
    iVar5 = unaff_ESI[0xd] + (unaff_ESI[0x10] + (iVar3 + unaff_ESI[10] + iVar5) * 2) * 2;
    in_EAX = unaff_ESI[2];
    unaff_ESI[0x14] = iVar5;
    uVar6 = iVar5 + in_EAX;
    if (uVar6 <= (uint)unaff_ESI[1]) {
      iVar7 = *unaff_ESI + in_EAX;
      unaff_ESI[2] = uVar6;
      unaff_ESI[5] = iVar7;
      unaff_ESI[6] = iVar7;
      iVar5 = iVar7 + iVar3 * 4;
      unaff_ESI[8] = iVar5;
      unaff_ESI[9] = iVar5;
      iVar5 = iVar5 + unaff_ESI[10] * 4;
      unaff_ESI[0xb] = iVar5;
      unaff_ESI[0xc] = iVar5;
      iVar5 = iVar5 + unaff_ESI[0xd];
      unaff_ESI[0xe] = iVar5;
      unaff_ESI[0xf] = iVar5;
      uVar6 = iVar5 + unaff_ESI[0x10] * 2;
      unaff_ESI[4] = iVar7;
      unaff_ESI[0x11] = uVar6;
      unaff_ESI[0x12] = uVar6;
      if ((char)unaff_ESI[0x17] != '\0') {
        if (0 < iVar3) {
          iVar5 = 0;
          do {
            uVar2 = *(uint *)(unaff_ESI[5] + iVar5 * 4);
            iVar3 = iVar5 * 4;
            uVar6 = uVar2 << 0x10;
            iVar5 = iVar5 + 1;
            *(uint *)(unaff_ESI[5] + iVar3) =
                 (uVar2 & 0xff0000 | uVar2 >> 0x10) >> 8 | (uVar2 & 0xff00 | uVar6) << 8;
          } while (iVar5 < unaff_ESI[7]);
        }
        iVar5 = 0;
        if (0 < unaff_ESI[10]) {
          do {
            puVar1 = (uint *)(unaff_ESI[8] + iVar5 * 4);
            uVar2 = *puVar1;
            uVar6 = uVar2 << 0x10;
            iVar5 = iVar5 + 1;
            *puVar1 = (uVar2 & 0xff0000 | uVar2 >> 0x10) >> 8 | (uVar2 & 0xff00 | uVar6) << 8;
          } while (iVar5 < unaff_ESI[10]);
        }
        iVar5 = 0;
        if (0 < unaff_ESI[0x10]) {
          do {
            uVar4 = *(ushort *)(unaff_ESI[0xe] + iVar5 * 2);
            iVar3 = iVar5 * 2;
            uVar4 = uVar4 << 8 | uVar4 >> 8;
            uVar6 = (uint)uVar4;
            iVar5 = iVar5 + 1;
            *(ushort *)(unaff_ESI[0xe] + iVar3) = uVar4;
          } while (iVar5 < unaff_ESI[0x10]);
        }
        iVar5 = 0;
        if (0 < unaff_ESI[0x13]) {
          do {
            puVar1 = (uint *)(unaff_ESI[0x12] + iVar5 * 4);
            uVar2 = *puVar1;
            uVar6 = uVar2 << 0x10;
            iVar5 = iVar5 + 1;
            *puVar1 = (uVar2 & 0xff0000 | uVar2 >> 0x10) >> 8 | (uVar2 & 0xff00 | uVar6) << 8;
          } while (iVar5 < unaff_ESI[0x13]);
        }
      }
      return CONCAT31((int3)(uVar6 >> 8),1);
    }
  }
  return in_EAX & 0xffffff00;
}



============================================================
DISASSEMBLY
============================================================
00804960 : PUSH ECX
00804961 : MOV ECX,dword ptr [ESI + 0x8]
00804964 : ADD ECX,0x8
00804967 : XOR AL,AL
00804969 : CMP ECX,dword ptr [ESI + 0x4]
0080496c : JA 0x00804b10
00804972 : PUSH EBX
00804973 : PUSH EBP
00804974 : PUSH EDI
00804975 : MOV EAX,ESI
00804977 : CALL 0x004575f0
0080497c : MOV dword ptr [ESI + 0x1c],EAX
0080497f : MOV EAX,ESI
00804981 : CALL 0x004575f0
00804986 : MOV dword ptr [ESI + 0x28],EAX
00804989 : MOV EAX,ESI
0080498b : CALL 0x004575f0
00804990 : MOV dword ptr [ESI + 0x34],EAX
00804993 : MOV EAX,ESI
00804995 : CALL 0x004575f0
0080499a : MOV dword ptr [ESI + 0x40],EAX
0080499d : MOV EAX,ESI
0080499f : CALL 0x004575f0
008049a4 : MOV ECX,dword ptr [ESI + 0x28]
008049a7 : MOV EDX,dword ptr [ESI + 0x1c]
008049aa : MOV EDI,dword ptr [ESI + 0x40]
008049ad : MOV EBP,dword ptr [ESI + 0x34]
008049b0 : LEA EBX,[EDX + ECX*0x1]
008049b3 : ADD EBX,EAX
008049b5 : MOV dword ptr [ESI + 0x4c],EAX
008049b8 : LEA EAX,[EDI + EBX*0x2]
008049bb : LEA EBX,[EBP + EAX*0x2]
008049bf : MOV EAX,dword ptr [ESI + 0x8]
008049c2 : MOV dword ptr [ESI + 0x50],EBX
008049c5 : ADD EBX,EAX
008049c7 : MOV dword ptr [ESP + 0xc],EBX
008049cb : CMP EBX,dword ptr [ESI + 0x4]
008049ce : JA 0x00804b0b
008049d4 : MOV EBX,dword ptr [ESI]
008049d6 : ADD EBX,EAX
008049d8 : MOV EAX,dword ptr [ESP + 0xc]
008049dc : MOV dword ptr [ESI + 0x8],EAX
008049df : MOV EAX,EBX
008049e1 : MOV dword ptr [ESI + 0x14],EAX
008049e4 : MOV dword ptr [ESI + 0x18],EAX
008049e7 : LEA EAX,[EAX + EDX*0x4]
008049ea : MOV dword ptr [ESI + 0x20],EAX
008049ed : MOV dword ptr [ESI + 0x24],EAX
008049f0 : LEA EAX,[EAX + ECX*0x4]
008049f3 : MOV dword ptr [ESI + 0x2c],EAX
008049f6 : MOV dword ptr [ESI + 0x30],EAX
008049f9 : ADD EAX,EBP
008049fb : CMP byte ptr [ESI + 0x5c],0x0
008049ff : MOV dword ptr [ESI + 0x38],EAX
00804a02 : MOV dword ptr [ESI + 0x3c],EAX
00804a05 : LEA EAX,[EAX + EDI*0x2]
00804a08 : MOV dword ptr [ESI + 0x10],EBX
00804a0b : MOV dword ptr [ESI + 0x44],EAX
00804a0e : MOV dword ptr [ESI + 0x48],EAX
00804a11 : JZ 0x00804b04
00804a17 : XOR ECX,ECX
00804a19 : TEST EDX,EDX
00804a1b : JLE 0x00804a6d
00804a1d : LEA ECX,[ECX]
00804a20 : MOV EDX,dword ptr [ESI + 0x14]
00804a23 : MOVSS XMM0,dword ptr [EDX + ECX*0x4]
00804a28 : LEA EDX,[EDX + ECX*0x4]
00804a2b : MOVSS dword ptr [ESP + 0xc],XMM0
00804a31 : MOV EAX,dword ptr [ESP + 0xc]
00804a35 : MOV EDI,EAX
00804a37 : AND EDI,0xff0000
00804a3d : MOV EBX,EAX
00804a3f : SHR EBX,0x10
00804a42 : OR EDI,EBX
00804a44 : MOV EBX,EAX
00804a46 : AND EBX,0xff00
00804a4c : SHL EAX,0x10
00804a4f : OR EBX,EAX
00804a51 : SHR EDI,0x8
00804a54 : SHL EBX,0x8
00804a57 : OR EDI,EBX
00804a59 : MOV dword ptr [ESP + 0xc],EDI
00804a5d : MOVSS XMM0,dword ptr [ESP + 0xc]
00804a63 : INC ECX
00804a64 : MOVSS dword ptr [EDX],XMM0
00804a68 : CMP ECX,dword ptr [ESI + 0x1c]
00804a6b : JL 0x00804a20
00804a6d : XOR ECX,ECX
00804a6f : CMP dword ptr [ESI + 0x28],ECX
00804a72 : JLE 0x00804aa8
00804a74 : MOV EAX,dword ptr [ESI + 0x20]
00804a77 : LEA EDX,[EAX + ECX*0x4]
00804a7a : MOV EAX,dword ptr [EDX]
00804a7c : MOV EDI,EAX
00804a7e : AND EDI,0xff0000
00804a84 : MOV EBX,EAX
00804a86 : SHR EBX,0x10
00804a89 : OR EDI,EBX
00804a8b : MOV EBX,EAX
00804a8d : AND EBX,0xff00
00804a93 : SHL EAX,0x10
00804a96 : OR EBX,EAX
00804a98 : SHR EDI,0x8
00804a9b : SHL EBX,0x8
00804a9e : OR EDI,EBX
00804aa0 : INC ECX
00804aa1 : MOV dword ptr [EDX],EDI
00804aa3 : CMP ECX,dword ptr [ESI + 0x28]
00804aa6 : JL 0x00804a74
00804aa8 : XOR ECX,ECX
00804aaa : CMP dword ptr [ESI + 0x40],ECX
00804aad : JLE 0x00804ac7
00804aaf : NOP
00804ab0 : MOV EDX,dword ptr [ESI + 0x38]
00804ab3 : MOVZX EAX,word ptr [EDX + ECX*0x2]
00804ab7 : LEA EDX,[EDX + ECX*0x2]
00804aba : ROL AX,0x8
00804abe : INC ECX
00804abf : MOV word ptr [EDX],AX
00804ac2 : CMP ECX,dword ptr [ESI + 0x40]
00804ac5 : JL 0x00804ab0
00804ac7 : XOR ECX,ECX
00804ac9 : CMP dword ptr [ESI + 0x4c],ECX
00804acc : JLE 0x00804b04
00804ace : MOV EDI,EDI
00804ad0 : MOV EAX,dword ptr [ESI + 0x48]
00804ad3 : LEA EDX,[EAX + ECX*0x4]
00804ad6 : MOV EAX,dword ptr [EDX]
00804ad8 : MOV EDI,EAX
00804ada : AND EDI,0xff0000
00804ae0 : MOV EBX,EAX
00804ae2 : SHR EBX,0x10
00804ae5 : OR EDI,EBX
00804ae7 : MOV EBX,EAX
00804ae9 : AND EBX,0xff00
00804aef : SHL EAX,0x10
00804af2 : OR EBX,EAX
00804af4 : SHR EDI,0x8
00804af7 : SHL EBX,0x8
00804afa : OR EDI,EBX
00804afc : INC ECX
00804afd : MOV dword ptr [EDX],EDI
00804aff : CMP ECX,dword ptr [ESI + 0x4c]
00804b02 : JL 0x00804ad0
00804b04 : POP EDI
00804b05 : POP EBP
00804b06 : MOV AL,0x1
00804b08 : POP EBX
00804b09 : POP ECX
00804b0a : RET
00804b0b : POP EDI
00804b0c : POP EBP
00804b0d : XOR AL,AL
00804b0f : POP EBX
00804b10 : POP ECX
00804b11 : RET
