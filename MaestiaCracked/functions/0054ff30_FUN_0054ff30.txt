PROGRAM  : Maestia.exe
FUNCTION : FUN_0054ff30
ENTRY    : 0054ff30
BODY     : [[0054ff30, 0055004d]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0054ff30(undefined4 param_1,uint *param_2,uint param_3)

{
  uint *puVar1;
  int iVar2;
  uint *puVar3;
  int *piVar4;
  int *in_ECX;
  uint uVar5;
  uint uVar6;
  int iVar7;
  
  piVar4 = (int *)*in_ECX;
  if (piVar4 == (int *)0x0) {
    iVar7 = 8;
  }
  else {
    if ((uint)(*piVar4 * 5) <= piVar4[1] * 4 + 4U) goto LAB_0054ff6b;
    iVar7 = piVar4[1] * 2 + 2;
  }
  FUN_0054fa60(param_1,iVar7);
LAB_0054ff6b:
  piVar4 = (int *)*in_ECX;
  param_3 = param_3 & piVar4[1];
  *piVar4 = *piVar4 + 1;
  iVar7 = *in_ECX;
  puVar1 = (uint *)(iVar7 + 8 + param_3 * 0x18);
  if (*puVar1 == 0xfffffffe) {
    *puVar1 = 0xffffffff;
    uVar6 = *param_2;
    puVar1[1] = uVar6;
    piVar4 = (int *)(uVar6 + 8);
    *piVar4 = *piVar4 + 1;
    FUN_005266c0(param_2 + 1);
    *(undefined1 *)((int)puVar1 + 9) = *(undefined1 *)((int)param_2 + 5);
    return;
  }
  uVar6 = param_3;
  do {
    uVar6 = uVar6 + 1 & *(uint *)(iVar7 + 4);
  } while (*(int *)(iVar7 + 8 + uVar6 * 0x18) != -2);
  iVar2 = iVar7 + 8 + uVar6 * 0x18;
  uVar5 = *(uint *)(puVar1[1] + 0xc) & *(uint *)(iVar7 + 4);
  if (uVar5 != param_3) {
    puVar3 = (uint *)(iVar7 + 8 + uVar5 * 0x18);
    for (uVar5 = *(uint *)(iVar7 + 8 + uVar5 * 0x18); uVar5 != param_3;
        uVar5 = *(uint *)(iVar7 + 8 + uVar5 * 0x18)) {
      uVar5 = *puVar3;
      puVar3 = (uint *)(iVar7 + 8 + uVar5 * 0x18);
    }
    if (iVar2 != 0) {
      FUN_0054f130(puVar1);
    }
    *puVar3 = uVar6;
    FUN_0054f1f0(param_2);
    *puVar1 = 0xffffffff;
    return;
  }
  if (iVar2 != 0) {
    FUN_0054f130(puVar1);
  }
  FUN_0054f1f0(param_2);
  *puVar1 = uVar6;
  return;
}



============================================================
DISASSEMBLY
============================================================
0054ff30 : PUSH EBX
0054ff31 : PUSH ESI
0054ff32 : MOV ESI,ECX
0054ff34 : MOV EAX,dword ptr [ESI]
0054ff36 : PUSH EDI
0054ff37 : TEST EAX,EAX
0054ff39 : JNZ 0x0054ff44
0054ff3b : MOV EAX,dword ptr [ESP + 0x10]
0054ff3f : PUSH 0x8
0054ff41 : PUSH EAX
0054ff42 : JMP 0x0054ff66
0054ff44 : MOV ECX,dword ptr [EAX + 0x4]
0054ff47 : LEA EDX,[ECX*0x4 + 0x4]
0054ff4e : MOV ECX,dword ptr [EAX]
0054ff50 : LEA ECX,[ECX + ECX*0x4]
0054ff53 : CMP ECX,EDX
0054ff55 : JBE 0x0054ff6b
0054ff57 : MOV EDX,dword ptr [EAX + 0x4]
0054ff5a : MOV ECX,dword ptr [ESP + 0x10]
0054ff5e : LEA EAX,[EDX + EDX*0x1 + 0x2]
0054ff62 : PUSH EAX
0054ff63 : PUSH ECX
0054ff64 : MOV ECX,ESI
0054ff66 : CALL 0x0054fa60
0054ff6b : MOV ECX,dword ptr [ESI]
0054ff6d : MOV EAX,dword ptr [ESP + 0x18]
0054ff71 : AND EAX,dword ptr [ECX + 0x4]
0054ff74 : INC dword ptr [ECX]
0054ff76 : MOV EDX,dword ptr [ESI]
0054ff78 : LEA ECX,[EAX + EAX*0x2]
0054ff7b : LEA EDI,[EDX + ECX*0x8 + 0x8]
0054ff7f : MOV EBX,0xfffffffe
0054ff84 : CMP dword ptr [EDI],EBX
0054ff86 : JNZ 0x0054ffb4
0054ff88 : MOV ECX,dword ptr [ESP + 0x14]
0054ff8c : MOV dword ptr [EDI],0xffffffff
0054ff92 : MOV EAX,dword ptr [ECX]
0054ff94 : MOV dword ptr [EDI + 0x4],EAX
0054ff97 : INC dword ptr [EAX + 0x8]
0054ff9a : LEA ESI,[ECX + 0x4]
0054ff9d : ADD EDI,0x8
0054ffa0 : PUSH ESI
0054ffa1 : MOV ECX,EDI
0054ffa3 : CALL 0x005266c0
0054ffa8 : MOV DL,byte ptr [ESI + 0x1]
0054ffab : MOV byte ptr [EDI + 0x1],DL
0054ffae : POP EDI
0054ffaf : POP ESI
0054ffb0 : POP EBX
0054ffb1 : RET 0xc
0054ffb4 : MOV ECX,dword ptr [EDX + 0x4]
0054ffb7 : MOV ESI,EAX
0054ffb9 : PUSH EBP
0054ffba : LEA EBX,[EBX]
0054ffc0 : INC ESI
0054ffc1 : AND ESI,ECX
0054ffc3 : LEA EBP,[ESI + ESI*0x2]
0054ffc6 : CMP dword ptr [EDX + EBP*0x8 + 0x8],EBX
0054ffca : JNZ 0x0054ffc0
0054ffcc : LEA EBX,[ESI + ESI*0x2]
0054ffcf : LEA EBX,[EDX + EBX*0x8 + 0x8]
0054ffd3 : MOV dword ptr [ESP + 0x14],EBX
0054ffd7 : MOV EBX,dword ptr [EDI + 0x4]
0054ffda : MOV EBX,dword ptr [EBX + 0xc]
0054ffdd : LEA EBP,[EDI + 0x4]
0054ffe0 : AND EBX,ECX
0054ffe2 : CMP EBX,EAX
0054ffe4 : JNZ 0x00550009
0054ffe6 : MOV ECX,dword ptr [ESP + 0x14]
0054ffea : TEST ECX,ECX
0054ffec : JZ 0x0054fff4
0054ffee : PUSH EDI
0054ffef : CALL 0x0054f130
0054fff4 : MOV EAX,dword ptr [ESP + 0x18]
0054fff8 : PUSH EAX
0054fff9 : MOV ECX,EBP
0054fffb : CALL 0x0054f1f0
00550000 : POP EBP
00550001 : MOV dword ptr [EDI],ESI
00550003 : POP EDI
00550004 : POP ESI
00550005 : POP EBX
00550006 : RET 0xc
00550009 : LEA ECX,[EBX + EBX*0x2]
0055000c : CMP dword ptr [EDX + ECX*0x8 + 0x8],EAX
00550010 : LEA EBX,[EDX + ECX*0x8 + 0x8]
00550014 : JZ 0x00550025
00550016 : MOV EBX,dword ptr [EBX]
00550018 : LEA ECX,[EBX + EBX*0x2]
0055001b : CMP dword ptr [EDX + ECX*0x8 + 0x8],EAX
0055001f : LEA EBX,[EDX + ECX*0x8 + 0x8]
00550023 : JNZ 0x00550016
00550025 : MOV ECX,dword ptr [ESP + 0x14]
00550029 : TEST ECX,ECX
0055002b : JZ 0x00550033
0055002d : PUSH EDI
0055002e : CALL 0x0054f130
00550033 : MOV EDX,dword ptr [ESP + 0x18]
00550037 : PUSH EDX
00550038 : MOV ECX,EBP
0055003a : MOV dword ptr [EBX],ESI
0055003c : CALL 0x0054f1f0
00550041 : POP EBP
00550042 : MOV dword ptr [EDI],0xffffffff
00550048 : POP EDI
00550049 : POP ESI
0055004a : POP EBX
0055004b : RET 0xc
