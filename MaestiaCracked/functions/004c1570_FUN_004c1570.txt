PROGRAM  : Maestia.exe
FUNCTION : FUN_004c1570
ENTRY    : 004c1570
BODY     : [[004c1570, 004c15dc] [004c15e0, 004c170d]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Removing unreachable block (ram,0x004c168a) */

void FUN_004c1570(void)

{
  ushort *puVar1;
  int iVar2;
  undefined4 *puVar3;
  undefined4 uVar4;
  uint uVar5;
  uint uVar6;
  ushort *puVar7;
  int unaff_ESI;
  undefined4 *puVar8;
  undefined4 *puVar9;
  undefined8 uVar10;
  
  if (*(uint *)(unaff_ESI + 0x24) <
      (*(int *)(unaff_ESI + 0x18) - *(int *)(unaff_ESI + 0x14) >> 2) - 1U) {
    if (*(uint *)(unaff_ESI + 0x20) < *(uint *)(unaff_ESI + 0x24)) {
      *(uint *)(unaff_ESI + 0x20) = *(uint *)(unaff_ESI + 0x20) * 2 + 1;
    }
  }
  else {
    *(int *)(unaff_ESI + 0x20) =
         (*(int *)(unaff_ESI + 0x18) - *(int *)(unaff_ESI + 0x14) >> 2) * 2 + -3;
    FUN_0044f4a0(*(undefined4 *)(unaff_ESI + 8));
  }
  uVar5 = (*(int *)(unaff_ESI + 0x24) - (*(uint *)(unaff_ESI + 0x20) >> 1)) - 1;
  puVar8 = *(undefined4 **)(uVar5 * 4 + *(int *)(unaff_ESI + 0x14));
  if (puVar8 != *(undefined4 **)(uVar5 * 4 + *(int *)(unaff_ESI + 0x14) + 4)) {
    do {
      if ((uint)puVar8[8] < 8) {
        puVar7 = (ushort *)(puVar8 + 3);
      }
      else {
        puVar7 = (ushort *)puVar8[3];
      }
      puVar1 = puVar7 + puVar8[7];
      uVar6 = 0x811c9dc5;
      for (; puVar7 != puVar1; puVar7 = puVar7 + 1) {
        uVar6 = uVar6 * 0x1000193 ^ (uint)*puVar7;
      }
      uVar10 = FUN_0063871f(uVar6 & 0x7fffffff,0x1f31d);
      uVar6 = (int)((ulonglong)uVar10 >> 0x20) * 0x41a7 + (int)uVar10 * -0xb14;
      if ((int)uVar6 < 0) {
        uVar6 = uVar6 + 0x7fffffff;
      }
      if ((*(uint *)(unaff_ESI + 0x20) & uVar6) == uVar5) {
        puVar9 = (undefined4 *)*puVar8;
      }
      else {
        puVar9 = (undefined4 *)*puVar8;
        if (puVar9 != *(undefined4 **)(unaff_ESI + 8)) {
          iVar2 = uVar5 * 4;
          puVar3 = *(undefined4 **)(iVar2 + *(int *)(unaff_ESI + 0x14));
          uVar6 = uVar5;
          while ((puVar8 == puVar3 &&
                 (*(undefined4 **)(iVar2 + *(int *)(unaff_ESI + 0x14)) = puVar9, uVar6 != 0))) {
            uVar6 = uVar6 - 1;
            iVar2 = uVar6 * 4;
            puVar3 = *(undefined4 **)(iVar2 + *(int *)(unaff_ESI + 0x14));
          }
          iVar2 = *(int *)(unaff_ESI + 8);
          *(undefined4 **)puVar8[1] = puVar9;
          *(int *)puVar9[1] = iVar2;
          **(undefined4 **)(iVar2 + 4) = puVar8;
          uVar4 = *(undefined4 *)(iVar2 + 4);
          *(undefined4 *)(iVar2 + 4) = puVar9[1];
          puVar9[1] = puVar8[1];
          puVar8[1] = uVar4;
          puVar8 = *(undefined4 **)(*(int *)(unaff_ESI + 8) + 4);
          *(int *)(*(int *)(unaff_ESI + 0x14) + 4 + *(int *)(unaff_ESI + 0x24) * 4) =
               *(int *)(unaff_ESI + 8);
        }
        for (uVar6 = *(uint *)(unaff_ESI + 0x24);
            (uVar5 < uVar6 &&
            (*(int *)(*(int *)(unaff_ESI + 0x14) + uVar6 * 4) == *(int *)(unaff_ESI + 8)));
            uVar6 = uVar6 - 1) {
          *(undefined4 **)(*(int *)(unaff_ESI + 0x14) + uVar6 * 4) = puVar8;
        }
        if (puVar9 == *(undefined4 **)(unaff_ESI + 8)) break;
      }
      puVar8 = puVar9;
    } while (puVar9 != *(undefined4 **)(uVar5 * 4 + 4 + *(int *)(unaff_ESI + 0x14)));
  }
  *(int *)(unaff_ESI + 0x24) = *(int *)(unaff_ESI + 0x24) + 1;
  return;
}



============================================================
DISASSEMBLY
============================================================
004c1570 : PUSH EBP
004c1571 : MOV EBP,ESP
004c1573 : MOV EDX,dword ptr [ESI + 0x18]
004c1576 : SUB EDX,dword ptr [ESI + 0x14]
004c1579 : MOV ECX,dword ptr [ESI + 0x24]
004c157c : LEA EAX,[ESI + 0x10]
004c157f : SUB ESP,0x8
004c1582 : SAR EDX,0x2
004c1585 : DEC EDX
004c1586 : PUSH EBX
004c1587 : PUSH EDI
004c1588 : CMP EDX,ECX
004c158a : JA 0x004c15aa
004c158c : MOV ECX,dword ptr [EAX + 0x8]
004c158f : SUB ECX,dword ptr [EAX + 0x4]
004c1592 : MOV EDX,dword ptr [ESI + 0x8]
004c1595 : SAR ECX,0x2
004c1598 : LEA ECX,[ECX + ECX*0x1 + -0x3]
004c159c : MOV dword ptr [ESI + 0x20],ECX
004c159f : PUSH EDX
004c15a0 : ADD ECX,0x2
004c15a3 : CALL 0x0044f4a0
004c15a8 : JMP 0x004c15b8
004c15aa : MOV EAX,dword ptr [ESI + 0x20]
004c15ad : CMP EAX,ECX
004c15af : JNC 0x004c15b8
004c15b1 : LEA EAX,[EAX + EAX*0x1 + 0x1]
004c15b5 : MOV dword ptr [ESI + 0x20],EAX
004c15b8 : MOV ECX,dword ptr [ESI + 0x20]
004c15bb : MOV EAX,dword ptr [ESI + 0x24]
004c15be : MOV EDX,dword ptr [ESI + 0x14]
004c15c1 : SHR ECX,0x1
004c15c3 : SUB EAX,ECX
004c15c5 : DEC EAX
004c15c6 : MOV dword ptr [EBP + -0x4],EAX
004c15c9 : ADD EAX,EAX
004c15cb : ADD EAX,EAX
004c15cd : MOV EDI,dword ptr [EAX + EDX*0x1]
004c15d0 : ADD EAX,EDX
004c15d2 : CMP EDI,dword ptr [EAX + 0x4]
004c15d5 : JZ 0x004c1705
004c15db : JMP 0x004c15e0
004c15e0 : CMP dword ptr [EDI + 0x20],0x8
004c15e4 : JC 0x004c15eb
004c15e6 : MOV ECX,dword ptr [EDI + 0xc]
004c15e9 : JMP 0x004c15ee
004c15eb : LEA ECX,[EDI + 0xc]
004c15ee : MOV EDX,dword ptr [EDI + 0x1c]
004c15f1 : LEA EDX,[ECX + EDX*0x2]
004c15f4 : MOV EAX,0x811c9dc5
004c15f9 : CMP ECX,EDX
004c15fb : JZ 0x004c1612
004c15fd : LEA ECX,[ECX]
004c1600 : MOVZX EBX,word ptr [ECX]
004c1603 : IMUL EAX,EAX,0x1000193
004c1609 : ADD ECX,0x2
004c160c : XOR EAX,EBX
004c160e : CMP ECX,EDX
004c1610 : JNZ 0x004c1600
004c1612 : AND EAX,0x7fffffff
004c1617 : PUSH 0x1f31d
004c161c : PUSH EAX
004c161d : CALL 0x0063871f
004c1622 : IMUL EDX,EDX,0x41a7
004c1628 : IMUL EAX,EAX,0xb14
004c162e : ADD ESP,0x8
004c1631 : SUB EDX,EAX
004c1633 : JNS 0x004c163b
004c1635 : ADD EDX,0x7fffffff
004c163b : MOV EAX,dword ptr [ESI + 0x20]
004c163e : MOV ECX,dword ptr [EBP + -0x4]
004c1641 : AND EAX,EDX
004c1643 : CMP EAX,ECX
004c1645 : JNZ 0x004c164e
004c1647 : MOV EDI,dword ptr [EDI]
004c1649 : JMP 0x004c16f1
004c164e : MOV EDX,dword ptr [EDI]
004c1650 : MOV dword ptr [EBP + -0x8],EDX
004c1653 : CMP EDX,dword ptr [ESI + 0x8]
004c1656 : JZ 0x004c16ca
004c1658 : MOV EBX,dword ptr [ESI + 0x14]
004c165b : MOV EAX,ECX
004c165d : ADD ECX,ECX
004c165f : ADD ECX,ECX
004c1661 : CMP EDI,dword ptr [ECX + EBX*0x1]
004c1664 : JNZ 0x004c1680
004c1666 : MOV EBX,dword ptr [ESI + 0x14]
004c1669 : MOV dword ptr [ECX + EBX*0x1],EDX
004c166c : TEST EAX,EAX
004c166e : JZ 0x004c1680
004c1670 : MOV EBX,dword ptr [ESI + 0x14]
004c1673 : DEC EAX
004c1674 : LEA ECX,[EAX*0x4 + 0x0]
004c167b : CMP EDI,dword ptr [ECX + EBX*0x1]
004c167e : JZ 0x004c1666
004c1680 : MOV EBX,dword ptr [ESI + 0x8]
004c1683 : LEA EAX,[ESI + 0x4]
004c1686 : CMP EAX,EAX
004c1688 : JZ 0x004c1696
004c168a : XOR ECX,ECX
004c168c : MOV EDX,EAX
004c168e : CALL 0x0044f4f0
004c1693 : MOV EDX,dword ptr [EBP + -0x8]
004c1696 : MOV ECX,dword ptr [EDI + 0x4]
004c1699 : MOV dword ptr [ECX],EDX
004c169b : MOV EAX,dword ptr [EDX + 0x4]
004c169e : MOV dword ptr [EAX],EBX
004c16a0 : MOV ECX,dword ptr [EBX + 0x4]
004c16a3 : MOV dword ptr [ECX],EDI
004c16a5 : MOV EAX,dword ptr [EBX + 0x4]
004c16a8 : MOV ECX,dword ptr [EDX + 0x4]
004c16ab : MOV dword ptr [EBX + 0x4],ECX
004c16ae : MOV ECX,dword ptr [EDI + 0x4]
004c16b1 : MOV dword ptr [EDX + 0x4],ECX
004c16b4 : MOV dword ptr [EDI + 0x4],EAX
004c16b7 : MOV EAX,dword ptr [ESI + 0x8]
004c16ba : MOV ECX,dword ptr [ESI + 0x24]
004c16bd : MOV EBX,dword ptr [ESI + 0x14]
004c16c0 : MOV EDI,dword ptr [EAX + 0x4]
004c16c3 : MOV dword ptr [EBX + ECX*0x4 + 0x4],EAX
004c16c7 : MOV ECX,dword ptr [EBP + -0x4]
004c16ca : MOV EAX,dword ptr [ESI + 0x24]
004c16cd : CMP ECX,EAX
004c16cf : JNC 0x004c16ea
004c16d1 : MOV ECX,dword ptr [ESI + 0x14]
004c16d4 : MOV EBX,dword ptr [ECX + EAX*0x4]
004c16d7 : LEA ECX,[ECX + EAX*0x4]
004c16da : CMP EBX,dword ptr [ESI + 0x8]
004c16dd : JNZ 0x004c16e7
004c16df : DEC EAX
004c16e0 : MOV dword ptr [ECX],EDI
004c16e2 : CMP dword ptr [EBP + -0x4],EAX
004c16e5 : JC 0x004c16d1
004c16e7 : MOV ECX,dword ptr [EBP + -0x4]
004c16ea : CMP EDX,dword ptr [ESI + 0x8]
004c16ed : JZ 0x004c1705
004c16ef : MOV EDI,EDX
004c16f1 : MOV EDX,dword ptr [ESI + 0x14]
004c16f4 : LEA EAX,[ECX*0x4 + 0x0]
004c16fb : CMP EDI,dword ptr [EAX + EDX*0x1 + 0x4]
004c16ff : JNZ 0x004c15e0
004c1705 : INC dword ptr [ESI + 0x24]
004c1708 : POP EDI
004c1709 : POP EBX
004c170a : MOV ESP,EBP
004c170c : POP EBP
004c170d : RET
