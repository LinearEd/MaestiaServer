PROGRAM  : Maestia.exe
FUNCTION : FUN_00996300
ENTRY    : 00996300
BODY     : [[00996300, 009964d6]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00996300(void)

{
  ushort uVar1;
  uint uVar2;
  int iVar3;
  int iVar4;
  uint8_t *packet;
  ushort in_CX;
  int in_EDX;
  undefined1 local_30 [4];
  undefined2 local_2c;
  undefined4 local_1c;
  uint local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b40e65;
  local_10 = ExceptionList;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_14 = uVar2;
  uVar1 = FUN_00995440(*(undefined4 *)(in_EDX + 0x38));
  if (uVar1 == 0) {
    FUN_00406460(L"Can\'t find GachaBox item~!");
    local_8 = 0;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaGuiGachaBox::OnReqStart",0x2ca,local_30);
    }
    local_8 = 0xffffffff;
    if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_18 = 7;
    local_1c = 0;
    local_2c = 0;
  }
  else if (uVar1 < in_CX) {
    FUN_00404750(L"Invalid User Input Count ->[%u]",in_CX);
    local_8 = 1;
    if ((int *)*DAT_00da98e8 != (int *)0x0) {
      (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaGuiGachaBox::OnReqStart",0x2d4,local_30);
    }
    local_8 = 0xffffffff;
    if (7 < local_18) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
    local_18 = 7;
    local_1c = 0;
    local_2c = 0;
  }
  else {
    iVar3 = FUN_00995350(in_EDX);
    if (iVar3 == 0) {
      FUN_00404750(L"Can\'t Find Gacha Item");
      local_8 = 2;
      if ((int *)*DAT_00da98e8 != (int *)0x0) {
        (**(code **)(*(int *)*DAT_00da98e8 + 0x14))(L"AvaGuiGachaBox::OnReqStart",0x2e3,local_30);
      }
      local_8 = 0xffffffff;
      FUN_00406560();
    }
    else if (*(int *)(iVar3 + 0x28) != 0) {
      iVar4 = FUN_006f4590(uVar2);
      local_8 = 3;
      if (iVar4 == 0) {
        packet = (uint8_t *)0x0;
      }
      else {
        packet = (uint8_t *)
                 FUN_00413020(*(undefined2 *)(iVar3 + 0x2c),*(undefined2 *)(iVar3 + 0x2e));
      }
      local_8 = 0xffffffff;
      if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
        FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),10,packet);
      }
    }
  }
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00996300 : PUSH EBP
00996301 : MOV EBP,ESP
00996303 : PUSH -0x1
00996305 : PUSH 0xb40e65
0099630a : MOV EAX,FS:[0x0]
00996310 : PUSH EAX
00996311 : SUB ESP,0x28
00996314 : MOV EAX,[0x00d66fa0]
00996319 : XOR EAX,EBP
0099631b : MOV dword ptr [EBP + -0x10],EAX
0099631e : PUSH ESI
0099631f : PUSH EDI
00996320 : PUSH EAX
00996321 : LEA EAX,[EBP + -0xc]
00996324 : MOV FS:[0x0],EAX
0099632a : MOV DI,CX
0099632d : MOV ESI,EDX
0099632f : MOV EAX,dword ptr [ESI + 0x38]
00996332 : PUSH EAX
00996333 : CALL 0x00995440
00996338 : MOVZX EAX,AX
0099633b : XOR ECX,ECX
0099633d : CMP CX,AX
00996340 : JNZ 0x009963a5
00996342 : PUSH 0xc868e8
00996347 : LEA ECX,[EBP + -0x2c]
0099634a : CALL 0x00406460
0099634f : MOV dword ptr [EBP + -0x4],0x0
00996356 : MOV EDX,dword ptr [0x00da98e8]
0099635c : MOV ECX,dword ptr [EDX]
0099635e : TEST ECX,ECX
00996360 : JZ 0x00996377
00996362 : MOV EAX,dword ptr [ECX]
00996364 : MOV EAX,dword ptr [EAX + 0x14]
00996367 : LEA EDX,[EBP + -0x2c]
0099636a : PUSH EDX
0099636b : PUSH 0x2ca
00996370 : PUSH 0xc86920
00996375 : CALL EAX
00996377 : MOV dword ptr [EBP + -0x4],0xffffffff
0099637e : CMP dword ptr [EBP + -0x14],0x8
00996382 : JC 0x0099638c
00996384 : MOV ECX,dword ptr [EBP + -0x28]
00996387 : CALL 0x006f04e0
0099638c : XOR ECX,ECX
0099638e : MOV dword ptr [EBP + -0x14],0x7
00996395 : MOV dword ptr [EBP + -0x18],0x0
0099639c : MOV word ptr [EBP + -0x28],CX
009963a0 : JMP 0x009964bc
009963a5 : CMP DI,AX
009963a8 : JBE 0x00996412
009963aa : MOVZX EDX,DI
009963ad : PUSH EDX
009963ae : PUSH 0xc86958
009963b3 : LEA ESI,[EBP + -0x2c]
009963b6 : CALL 0x00404750
009963bb : ADD ESP,0x8
009963be : MOV dword ptr [EBP + -0x4],0x1
009963c5 : MOV EAX,[0x00da98e8]
009963ca : MOV ECX,dword ptr [EAX]
009963cc : TEST ECX,ECX
009963ce : JZ 0x009963e4
009963d0 : MOV EDX,dword ptr [ECX]
009963d2 : MOV EDX,dword ptr [EDX + 0x14]
009963d5 : MOV EAX,ESI
009963d7 : PUSH EAX
009963d8 : PUSH 0x2d4
009963dd : PUSH 0xc86998
009963e2 : CALL EDX
009963e4 : MOV dword ptr [EBP + -0x4],0xffffffff
009963eb : CMP dword ptr [EBP + -0x14],0x8
009963ef : JC 0x009963f9
009963f1 : MOV ECX,dword ptr [EBP + -0x28]
009963f4 : CALL 0x006f04e0
009963f9 : XOR EAX,EAX
009963fb : MOV dword ptr [EBP + -0x14],0x7
00996402 : MOV dword ptr [EBP + -0x18],0x0
00996409 : MOV word ptr [EBP + -0x28],AX
0099640d : JMP 0x009964bc
00996412 : PUSH ESI
00996413 : CALL 0x00995350
00996418 : MOV ESI,EAX
0099641a : TEST ESI,ESI
0099641c : JNZ 0x00996466
0099641e : PUSH 0xc86794
00996423 : LEA ESI,[EBP + -0x2c]
00996426 : CALL 0x00404750
0099642b : ADD ESP,0x4
0099642e : MOV dword ptr [EBP + -0x4],0x2
00996435 : MOV ECX,dword ptr [0x00da98e8]
0099643b : MOV ECX,dword ptr [ECX]
0099643d : TEST ECX,ECX
0099643f : JZ 0x00996455
00996441 : MOV EDX,dword ptr [ECX]
00996443 : MOV EDX,dword ptr [EDX + 0x14]
00996446 : MOV EAX,ESI
00996448 : PUSH EAX
00996449 : PUSH 0x2e3
0099644e : PUSH 0xc869d0
00996453 : CALL EDX
00996455 : MOV dword ptr [EBP + -0x4],0xffffffff
0099645c : LEA ECX,[EBP + -0x2c]
0099645f : CALL 0x00406560
00996464 : JMP 0x009964bc
00996466 : CMP dword ptr [ESI + 0x28],0x0
0099646a : JZ 0x009964bc
0099646c : CALL 0x006f4590
00996471 : MOV dword ptr [EBP + -0x30],EAX
00996474 : MOV dword ptr [EBP + -0x4],0x3
0099647b : TEST EAX,EAX
0099647d : JZ 0x00996496
0099647f : MOVZX ECX,word ptr [ESI + 0x2e]
00996483 : MOVZX EDI,word ptr [ESI + 0x2c]
00996487 : MOV ESI,dword ptr [ESI + 0x28]
0099648a : MOV EDX,dword ptr [ESI + 0x2c]
0099648d : PUSH ECX
0099648e : PUSH EDI
0099648f : CALL 0x00413020
00996494 : JMP 0x00996498
00996496 : XOR EAX,EAX
00996498 : MOV dword ptr [EBP + -0x4],0xffffffff
0099649f : MOV EDX,dword ptr [0x017247d4]
009964a5 : MOV ECX,dword ptr [EDX + 0x4]
009964a8 : TEST ECX,ECX
009964aa : JZ 0x009964bc
009964ac : CMP byte ptr [EDX + 0x8],0x0
009964b0 : JZ 0x009964bc
009964b2 : PUSH 0xa
009964b4 : PUSH ECX
009964b5 : MOV EDI,EAX
009964b7 : CALL 0x00a0dd40
009964bc : MOV ECX,dword ptr [EBP + -0xc]
009964bf : MOV dword ptr FS:[0x0],ECX
009964c6 : POP ECX
009964c7 : POP EDI
009964c8 : POP ESI
009964c9 : MOV ECX,dword ptr [EBP + -0x10]
009964cc : XOR ECX,EBP
009964ce : CALL 0x00633e6b
009964d3 : MOV ESP,EBP
009964d5 : POP EBP
009964d6 : RET
