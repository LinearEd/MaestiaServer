PROGRAM  : Maestia.exe
FUNCTION : __control87
ENTRY    : 00658d9d
BODY     : [[00658d9d, 006590ab]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    __control87
   
   Library: Visual Studio 2008 Release */

uint __cdecl __control87(uint _NewValue,uint _Mask)

{
  ushort uVar1;
  uint uVar2;
  uint uVar3;
  undefined4 uVar4;
  uint uVar5;
  ushort in_FPUControlWord;
  
  uVar5 = 0;
  if ((in_FPUControlWord & 1) != 0) {
    uVar5 = 0x10;
  }
  if ((in_FPUControlWord & 4) != 0) {
    uVar5 = uVar5 | 8;
  }
  if ((in_FPUControlWord & 8) != 0) {
    uVar5 = uVar5 | 4;
  }
  if ((in_FPUControlWord & 0x10) != 0) {
    uVar5 = uVar5 | 2;
  }
  if ((in_FPUControlWord & 0x20) != 0) {
    uVar5 = uVar5 | 1;
  }
  if ((in_FPUControlWord & 2) != 0) {
    uVar5 = uVar5 | 0x80000;
  }
  uVar1 = in_FPUControlWord & 0xc00;
  if ((in_FPUControlWord & 0xc00) != 0) {
    if (uVar1 == 0x400) {
      uVar5 = uVar5 | 0x100;
    }
    else if (uVar1 == 0x800) {
      uVar5 = uVar5 | 0x200;
    }
    else if (uVar1 == 0xc00) {
      uVar5 = uVar5 | 0x300;
    }
  }
  if ((in_FPUControlWord & 0x300) == 0) {
    uVar5 = uVar5 | 0x20000;
  }
  else if ((in_FPUControlWord & 0x300) == 0x200) {
    uVar5 = uVar5 | 0x10000;
  }
  if ((in_FPUControlWord & 0x1000) != 0) {
    uVar5 = uVar5 | 0x40000;
  }
  uVar2 = ~_Mask & uVar5 | _NewValue & _Mask;
  if (uVar2 != uVar5) {
    uVar5 = __hw_cw();
    uVar2 = 0;
    if ((uVar5 & 1) != 0) {
      uVar2 = 0x10;
    }
    if ((uVar5 & 4) != 0) {
      uVar2 = uVar2 | 8;
    }
    if ((uVar5 & 8) != 0) {
      uVar2 = uVar2 | 4;
    }
    if ((uVar5 & 0x10) != 0) {
      uVar2 = uVar2 | 2;
    }
    if ((uVar5 & 0x20) != 0) {
      uVar2 = uVar2 | 1;
    }
    if ((uVar5 & 2) != 0) {
      uVar2 = uVar2 | 0x80000;
    }
    uVar3 = uVar5 & 0xc00;
    if (uVar3 != 0) {
      if (uVar3 == 0x400) {
        uVar2 = uVar2 | 0x100;
      }
      else if (uVar3 == 0x800) {
        uVar2 = uVar2 | 0x200;
      }
      else if (uVar3 == 0xc00) {
        uVar2 = uVar2 | 0x300;
      }
    }
    if ((uVar5 & 0x300) == 0) {
      uVar2 = uVar2 | 0x20000;
    }
    else if ((uVar5 & 0x300) == 0x200) {
      uVar2 = uVar2 | 0x10000;
    }
    if ((uVar5 & 0x1000) != 0) {
      uVar2 = uVar2 | 0x40000;
    }
  }
  uVar5 = 0;
  if (DAT_01728c2c != 0) {
    if ((char)MXCSR < '\0') {
      uVar5 = 0x10;
    }
    if ((MXCSR & 0x200) != 0) {
      uVar5 = uVar5 | 8;
    }
    if ((MXCSR & 0x400) != 0) {
      uVar5 = uVar5 | 4;
    }
    if ((MXCSR & 0x800) != 0) {
      uVar5 = uVar5 | 2;
    }
    if ((MXCSR & 0x1000) != 0) {
      uVar5 = uVar5 | 1;
    }
    if ((MXCSR & 0x100) != 0) {
      uVar5 = uVar5 | 0x80000;
    }
    uVar3 = MXCSR & 0x6000;
    if (uVar3 != 0) {
      if (uVar3 == 0x2000) {
        uVar5 = uVar5 | 0x100;
      }
      else if (uVar3 == 0x4000) {
        uVar5 = uVar5 | 0x200;
      }
      else if (uVar3 == 0x6000) {
        uVar5 = uVar5 | 0x300;
      }
    }
    uVar3 = MXCSR & 0x8040;
    if (uVar3 == 0x40) {
      uVar5 = uVar5 | 0x2000000;
    }
    else if (uVar3 == 0x8000) {
      uVar5 = uVar5 | 0x3000000;
    }
    else if (uVar3 == 0x8040) {
      uVar5 = uVar5 | 0x1000000;
    }
    if ((~(_Mask & 0x308031f) & uVar5 | _Mask & 0x308031f & _NewValue) != uVar5) {
      uVar4 = ___hw_cw_sse2();
      ___set_fpsr_sse2(uVar4);
      uVar5 = 0;
      if ((char)MXCSR < '\0') {
        uVar5 = 0x10;
      }
      if ((MXCSR & 0x200) != 0) {
        uVar5 = uVar5 | 8;
      }
      if ((MXCSR & 0x400) != 0) {
        uVar5 = uVar5 | 4;
      }
      if ((MXCSR & 0x800) != 0) {
        uVar5 = uVar5 | 2;
      }
      if ((MXCSR & 0x1000) != 0) {
        uVar5 = uVar5 | 1;
      }
      if ((MXCSR & 0x100) != 0) {
        uVar5 = uVar5 | 0x80000;
      }
      uVar3 = MXCSR & 0x6000;
      if (uVar3 != 0) {
        if (uVar3 == 0x2000) {
          uVar5 = uVar5 | 0x100;
        }
        else if (uVar3 == 0x4000) {
          uVar5 = uVar5 | 0x200;
        }
        else if (uVar3 == 0x6000) {
          uVar5 = uVar5 | 0x300;
        }
      }
      uVar3 = MXCSR & 0x8040;
      if (uVar3 == 0x40) {
        uVar5 = uVar5 | 0x2000000;
      }
      else if (uVar3 == 0x8000) {
        uVar5 = uVar5 | 0x3000000;
      }
      else if (uVar3 == 0x8040) {
        uVar5 = uVar5 | 0x1000000;
      }
    }
    uVar3 = uVar5 ^ uVar2;
    uVar2 = uVar5 | uVar2;
    if ((uVar3 & 0x8031f) != 0) {
      uVar2 = uVar2 | 0x80000000;
    }
  }
  return uVar2;
}



============================================================
DISASSEMBLY
============================================================
00658d9d : MOV EDI,EDI
00658d9f : PUSH EBP
00658da0 : MOV EBP,ESP
00658da2 : SUB ESP,0x14
00658da5 : PUSH EBX
00658da6 : PUSH ESI
00658da7 : PUSH EDI
00658da8 : FSTCW word ptr [EBP + -0x8]
00658dac : MOV EBX,dword ptr [EBP + -0x8]
00658daf : XOR EDX,EDX
00658db1 : TEST BL,0x1
00658db4 : JZ 0x00658db9
00658db6 : PUSH 0x10
00658db8 : POP EDX
00658db9 : TEST BL,0x4
00658dbc : JZ 0x00658dc1
00658dbe : OR EDX,0x8
00658dc1 : TEST BL,0x8
00658dc4 : JZ 0x00658dc9
00658dc6 : OR EDX,0x4
00658dc9 : TEST BL,0x10
00658dcc : JZ 0x00658dd1
00658dce : OR EDX,0x2
00658dd1 : TEST BL,0x20
00658dd4 : JZ 0x00658dd9
00658dd6 : OR EDX,0x1
00658dd9 : TEST BL,0x2
00658ddc : JZ 0x00658de4
00658dde : OR EDX,0x80000
00658de4 : MOVZX ECX,BX
00658de7 : MOV EAX,ECX
00658de9 : MOV ESI,0xc00
00658dee : AND EAX,ESI
00658df0 : MOV EDI,0x300
00658df5 : JZ 0x00658e1b
00658df7 : CMP EAX,0x400
00658dfc : JZ 0x00658e15
00658dfe : CMP EAX,0x800
00658e03 : JZ 0x00658e0d
00658e05 : CMP EAX,ESI
00658e07 : JNZ 0x00658e1b
00658e09 : OR EDX,EDI
00658e0b : JMP 0x00658e1b
00658e0d : OR EDX,0x200
00658e13 : JMP 0x00658e1b
00658e15 : OR EDX,0x100
00658e1b : AND ECX,EDI
00658e1d : JZ 0x00658e2f
00658e1f : CMP ECX,0x200
00658e25 : JNZ 0x00658e35
00658e27 : OR EDX,0x10000
00658e2d : JMP 0x00658e35
00658e2f : OR EDX,0x20000
00658e35 : TEST EBX,0x1000
00658e3b : JZ 0x00658e43
00658e3d : OR EDX,0x40000
00658e43 : MOV EDI,dword ptr [EBP + 0xc]
00658e46 : MOV ECX,dword ptr [EBP + 0x8]
00658e49 : MOV EAX,EDI
00658e4b : NOT EAX
00658e4d : AND EAX,EDX
00658e4f : AND ECX,EDI
00658e51 : OR EAX,ECX
00658e53 : MOV dword ptr [EBP + 0xc],EAX
00658e56 : CMP EAX,EDX
00658e58 : JZ 0x00658f0c
00658e5e : MOV EBX,EAX
00658e60 : CALL 0x00658c6f
00658e65 : MOVZX EAX,AX
00658e68 : MOV dword ptr [EBP + -0x4],EAX
00658e6b : FLDCW word ptr [EBP + -0x4]
00658e6e : FSTCW word ptr [EBP + -0x4]
00658e72 : MOV EBX,dword ptr [EBP + -0x4]
00658e75 : XOR EDX,EDX
00658e77 : TEST BL,0x1
00658e7a : JZ 0x00658e7f
00658e7c : PUSH 0x10
00658e7e : POP EDX
00658e7f : TEST BL,0x4
00658e82 : JZ 0x00658e87
00658e84 : OR EDX,0x8
00658e87 : TEST BL,0x8
00658e8a : JZ 0x00658e8f
00658e8c : OR EDX,0x4
00658e8f : TEST BL,0x10
00658e92 : JZ 0x00658e97
00658e94 : OR EDX,0x2
00658e97 : TEST BL,0x20
00658e9a : JZ 0x00658e9f
00658e9c : OR EDX,0x1
00658e9f : TEST BL,0x2
00658ea2 : JZ 0x00658eaa
00658ea4 : OR EDX,0x80000
00658eaa : MOVZX ECX,BX
00658ead : MOV EAX,ECX
00658eaf : AND EAX,ESI
00658eb1 : JZ 0x00658edb
00658eb3 : CMP EAX,0x400
00658eb8 : JZ 0x00658ed5
00658eba : CMP EAX,0x800
00658ebf : JZ 0x00658ecd
00658ec1 : CMP EAX,ESI
00658ec3 : JNZ 0x00658edb
00658ec5 : OR EDX,0x300
00658ecb : JMP 0x00658edb
00658ecd : OR EDX,0x200
00658ed3 : JMP 0x00658edb
00658ed5 : OR EDX,0x100
00658edb : AND ECX,0x300
00658ee1 : JZ 0x00658ef3
00658ee3 : CMP ECX,0x200
00658ee9 : JNZ 0x00658ef9
00658eeb : OR EDX,0x10000
00658ef1 : JMP 0x00658ef9
00658ef3 : OR EDX,0x20000
00658ef9 : TEST EBX,0x1000
00658eff : JZ 0x00658f07
00658f01 : OR EDX,0x40000
00658f07 : MOV dword ptr [EBP + 0xc],EDX
00658f0a : MOV EAX,EDX
00658f0c : XOR ESI,ESI
00658f0e : CMP dword ptr [0x01728c2c],ESI
00658f14 : JZ 0x006590a7
00658f1a : AND EDI,0x308031f
00658f20 : MOV dword ptr [EBP + -0x14],EDI
00658f23 : STMXCSR dword ptr [EBP + -0x10]
00658f27 : MOV EAX,dword ptr [EBP + -0x10]
00658f2a : TEST AL,AL
00658f2c : JNS 0x00658f31
00658f2e : PUSH 0x10
00658f30 : POP ESI
00658f31 : TEST EAX,0x200
00658f36 : JZ 0x00658f3b
00658f38 : OR ESI,0x8
00658f3b : TEST EAX,0x400
00658f40 : JZ 0x00658f45
00658f42 : OR ESI,0x4
00658f45 : TEST EAX,0x800
00658f4a : JZ 0x00658f4f
00658f4c : OR ESI,0x2
00658f4f : TEST EAX,0x1000
00658f54 : JZ 0x00658f59
00658f56 : OR ESI,0x1
00658f59 : TEST EAX,0x100
00658f5e : JZ 0x00658f66
00658f60 : OR ESI,0x80000
00658f66 : MOV ECX,EAX
00658f68 : MOV EBX,0x6000
00658f6d : AND ECX,EBX
00658f6f : JZ 0x00658f9b
00658f71 : CMP ECX,0x2000
00658f77 : JZ 0x00658f95
00658f79 : CMP ECX,0x4000
00658f7f : JZ 0x00658f8d
00658f81 : CMP ECX,EBX
00658f83 : JNZ 0x00658f9b
00658f85 : OR ESI,0x300
00658f8b : JMP 0x00658f9b
00658f8d : OR ESI,0x200
00658f93 : JMP 0x00658f9b
00658f95 : OR ESI,0x100
00658f9b : MOV EDI,0x8040
00658fa0 : AND EAX,EDI
00658fa2 : SUB EAX,0x40
00658fa5 : JZ 0x00658fc3
00658fa7 : SUB EAX,0x7fc0
00658fac : JZ 0x00658fbb
00658fae : SUB EAX,0x40
00658fb1 : JNZ 0x00658fc9
00658fb3 : OR ESI,0x1000000
00658fb9 : JMP 0x00658fc9
00658fbb : OR ESI,0x3000000
00658fc1 : JMP 0x00658fc9
00658fc3 : OR ESI,0x2000000
00658fc9 : MOV EAX,dword ptr [EBP + -0x14]
00658fcc : MOV EDX,EAX
00658fce : AND EAX,dword ptr [EBP + 0x8]
00658fd1 : NOT EDX
00658fd3 : AND EDX,ESI
00658fd5 : OR EDX,EAX
00658fd7 : CMP EDX,ESI
00658fd9 : JNZ 0x00658fe2
00658fdb : MOV EAX,ESI
00658fdd : JMP 0x00659092
00658fe2 : CALL 0x00658cfd
00658fe7 : PUSH EAX
00658fe8 : MOV dword ptr [EBP + -0xc],EAX
00658feb : CALL 0x0065e0e5
00658ff0 : POP ECX
00658ff1 : STMXCSR dword ptr [EBP + -0xc]
00658ff5 : MOV ECX,dword ptr [EBP + -0xc]
00658ff8 : XOR EDX,EDX
00658ffa : TEST CL,CL
00658ffc : JNS 0x00659001
00658ffe : PUSH 0x10
00659000 : POP EDX
00659001 : TEST ECX,0x200
00659007 : JZ 0x0065900c
00659009 : OR EDX,0x8
0065900c : TEST ECX,0x400
00659012 : JZ 0x00659017
00659014 : OR EDX,0x4
00659017 : TEST ECX,0x800
0065901d : JZ 0x00659022
0065901f : OR EDX,0x2
00659022 : TEST ECX,0x1000
00659028 : JZ 0x0065902d
0065902a : OR EDX,0x1
0065902d : MOV ESI,0x100
00659032 : TEST ESI,ECX
00659034 : JZ 0x0065903c
00659036 : OR EDX,0x80000
0065903c : MOV EAX,ECX
0065903e : AND EAX,EBX
00659040 : JZ 0x00659066
00659042 : CMP EAX,0x2000
00659047 : JZ 0x00659064
00659049 : CMP EAX,0x4000
0065904e : JZ 0x0065905c
00659050 : CMP EAX,EBX
00659052 : JNZ 0x00659066
00659054 : OR EDX,0x300
0065905a : JMP 0x00659066
0065905c : OR EDX,0x200
00659062 : JMP 0x00659066
00659064 : OR EDX,ESI
00659066 : AND ECX,EDI
00659068 : SUB ECX,0x40
0065906b : JZ 0x0065908a
0065906d : SUB ECX,0x7fc0
00659073 : JZ 0x00659082
00659075 : SUB ECX,0x40
00659078 : JNZ 0x00659090
0065907a : OR EDX,0x1000000
00659080 : JMP 0x00659090
00659082 : OR EDX,0x3000000
00659088 : JMP 0x00659090
0065908a : OR EDX,0x2000000
00659090 : MOV EAX,EDX
00659092 : MOV ECX,EAX
00659094 : XOR ECX,dword ptr [EBP + 0xc]
00659097 : OR EAX,dword ptr [EBP + 0xc]
0065909a : TEST ECX,0x8031f
006590a0 : JZ 0x006590a7
006590a2 : OR EAX,0x80000000
006590a7 : POP EDI
006590a8 : POP ESI
006590a9 : POP EBX
006590aa : LEAVE
006590ab : RET
