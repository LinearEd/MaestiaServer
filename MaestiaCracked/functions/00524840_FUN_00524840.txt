PROGRAM  : Maestia.exe
FUNCTION : FUN_00524840
ENTRY    : 00524840
BODY     : [[00524840, 0052492e]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00524840(void)

{
  GRefCountImplCore *pGVar1;
  uint uVar2;
  uint uVar3;
  GRefCountImplCore *in_ECX;
  int *piVar4;
  GRefCountImplCore *pGVar5;
  int iVar6;
  int iVar7;
  
  *(undefined ***)in_ECX = &PTR_FUN_00b8ae1c;
  EnterCriticalSection((LPCRITICAL_SECTION)(in_ECX + 0xc));
  iVar7 = *(int *)(in_ECX + 0x24);
  pGVar1 = in_ECX + 0x24;
  if (iVar7 == 0) {
    uVar3 = 0;
    pGVar5 = (GRefCountImplCore *)0x0;
  }
  else {
    uVar3 = 0;
    piVar4 = (int *)(iVar7 + 8);
    do {
      pGVar5 = pGVar1;
      if (*piVar4 != -2) break;
      uVar3 = uVar3 + 1;
      piVar4 = piVar4 + 4;
    } while (uVar3 <= *(uint *)(iVar7 + 4));
  }
  do {
    do {
      if (((pGVar5 == (GRefCountImplCore *)0x0) || (iVar7 = *(int *)pGVar5, iVar7 == 0)) ||
         (*(int *)(iVar7 + 4) < (int)uVar3)) {
        LeaveCriticalSection((LPCRITICAL_SECTION)(in_ECX + 0xc));
        if (*(int *)(in_ECX + 0x28) != 0) {
          FUN_00515b80();
        }
        if (*(int *)pGVar1 != 0) {
          iVar6 = 0;
          iVar7 = *(int *)(*(int *)pGVar1 + 4) + 1;
          do {
            if (*(int *)(iVar6 + 8 + *(int *)pGVar1) != -2) {
              *(undefined4 *)(iVar6 + 8 + *(int *)pGVar1) = 0xfffffffe;
            }
            iVar6 = iVar6 + 0x10;
            iVar7 = iVar7 + -1;
          } while (iVar7 != 0);
          FUN_00515cf0(*(int *)pGVar1);
          *(int *)pGVar1 = 0;
        }
        FUN_005a20f0();
        GRefCountImplCore::~GRefCountImplCore(in_ECX);
        return;
      }
      *(undefined4 *)(*(int *)(uVar3 * 0x10 + 0x14 + iVar7) + 8) = 0;
      uVar2 = *(uint *)(*(int *)pGVar5 + 4);
    } while (((int)uVar2 < (int)uVar3) || (uVar3 = uVar3 + 1, uVar2 < uVar3));
    piVar4 = (int *)(*(int *)pGVar5 + 8 + uVar3 * 0x10);
    do {
      if (*piVar4 != -2) break;
      uVar3 = uVar3 + 1;
      piVar4 = piVar4 + 4;
    } while (uVar3 <= uVar2);
  } while( true );
}



============================================================
DISASSEMBLY
============================================================
00524840 : PUSH EBX
00524841 : MOV EBX,ECX
00524843 : PUSH EDI
00524844 : LEA EAX,[EBX + 0xc]
00524847 : PUSH EAX
00524848 : MOV dword ptr [EBX],0xb8ae1c
0052484e : CALL dword ptr [0x00b85118]
00524854 : MOV ECX,dword ptr [EBX + 0x24]
00524857 : LEA EDI,[EBX + 0x24]
0052485a : TEST ECX,ECX
0052485c : JNZ 0x00524862
0052485e : XOR EAX,EAX
00524860 : JMP 0x0052487f
00524862 : MOV EDX,dword ptr [ECX + 0x4]
00524865 : XOR EAX,EAX
00524867 : ADD ECX,0x8
0052486a : LEA EBX,[EBX]
00524870 : CMP dword ptr [ECX],-0x2
00524873 : JNZ 0x0052487d
00524875 : INC EAX
00524876 : ADD ECX,0x10
00524879 : CMP EAX,EDX
0052487b : JBE 0x00524870
0052487d : MOV ECX,EDI
0052487f : PUSH EBP
00524880 : PUSH ESI
00524881 : MOV ESI,ECX
00524883 : TEST ESI,ESI
00524885 : JZ 0x005248cf
00524887 : MOV ECX,dword ptr [ESI]
00524889 : TEST ECX,ECX
0052488b : JZ 0x005248cf
0052488d : CMP EAX,dword ptr [ECX + 0x4]
00524890 : JG 0x005248cf
00524892 : MOV EDX,EAX
00524894 : SHL EDX,0x4
00524897 : MOV ECX,dword ptr [EDX + ECX*0x1 + 0x14]
0052489b : MOV dword ptr [ECX + 0x8],0x0
005248a2 : MOV EDX,dword ptr [ESI]
005248a4 : MOV ECX,dword ptr [EDX + 0x4]
005248a7 : CMP EAX,ECX
005248a9 : JG 0x00524883
005248ab : INC EAX
005248ac : CMP EAX,ECX
005248ae : JA 0x00524883
005248b0 : MOV EBP,EAX
005248b2 : SHL EBP,0x4
005248b5 : LEA EDX,[EDX + EBP*0x1 + 0x8]
005248b9 : LEA ESP,[ESP]
005248c0 : CMP dword ptr [EDX],-0x2
005248c3 : JNZ 0x00524883
005248c5 : INC EAX
005248c6 : ADD EDX,0x10
005248c9 : CMP EAX,ECX
005248cb : JBE 0x005248c0
005248cd : JMP 0x00524883
005248cf : LEA EAX,[EBX + 0xc]
005248d2 : PUSH EAX
005248d3 : CALL dword ptr [0x00b8511c]
005248d9 : MOV ECX,dword ptr [EBX + 0x28]
005248dc : POP ESI
005248dd : POP EBP
005248de : TEST ECX,ECX
005248e0 : JZ 0x005248e7
005248e2 : CALL 0x00515b80
005248e7 : MOV EAX,dword ptr [EDI]
005248e9 : TEST EAX,EAX
005248eb : JZ 0x0052491e
005248ed : MOV EAX,dword ptr [EAX + 0x4]
005248f0 : XOR ECX,ECX
005248f2 : LEA EDX,[EAX + 0x1]
005248f5 : MOV EAX,dword ptr [EDI]
005248f7 : CMP dword ptr [ECX + EAX*0x1 + 0x8],-0x2
005248fc : LEA EAX,[ECX + EAX*0x1 + 0x8]
00524900 : JZ 0x00524908
00524902 : MOV dword ptr [EAX],0xfffffffe
00524908 : ADD ECX,0x10
0052490b : SUB EDX,0x1
0052490e : JNZ 0x005248f5
00524910 : MOV ECX,dword ptr [EDI]
00524912 : PUSH ECX
00524913 : CALL 0x00515cf0
00524918 : MOV dword ptr [EDI],0x0
0052491e : LEA ECX,[EBX + 0xc]
00524921 : CALL 0x005a20f0
00524926 : POP EDI
00524927 : MOV ECX,EBX
00524929 : POP EBX
0052492a : JMP 0x004ff7b0
