PROGRAM  : Maestia.exe
FUNCTION : FUN_006f2640
ENTRY    : 006f2640
BODY     : [[006f2640, 006f27bd]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 * FUN_006f2640(void)

{
  int in_ECX;
  undefined4 *puVar1;
  LPCRITICAL_SECTION local_38;
  char *local_34;
  undefined4 local_30;
  int local_2c;
  undefined4 local_28;
  LPCRITICAL_SECTION local_24;
  char *local_20;
  undefined4 local_1c;
  int local_18;
  undefined4 local_14;
  void *local_10;
  undefined1 *puStack_c;
  uint local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b0cefe;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  local_24 = (LPCRITICAL_SECTION)(in_ECX + 0xe98);
  local_18 = 0;
  local_20 = ".\\AvSocket.cpp";
  local_1c = 0x658;
  local_14 = 1;
  FUN_006ef1a0(&local_24);
  local_8 = 0;
  puVar1 = *(undefined4 **)(in_ECX + 0xeb8);
  if (puVar1 == (undefined4 *)0x0) {
    local_38 = (LPCRITICAL_SECTION)(in_ECX + 0xe7c);
    local_2c = 0;
    local_34 = ".\\AvSocket.cpp";
    local_30 = 0x663;
    local_28 = 1;
    FUN_006ef1a0(&local_38);
    puVar1 = *(undefined4 **)(in_ECX + 0xeb0);
    *(undefined4 **)(in_ECX + 0xeb8) = puVar1;
    *(undefined4 *)(in_ECX + 0xeb4) = 0;
    *(undefined4 *)(in_ECX + 0xeb0) = 0;
    if (puVar1 == (undefined4 *)0x0) {
      *(undefined4 *)(in_ECX + 0xebc) = 1;
      local_8 = (local_8 >> 8) << 8;
      if (local_2c != 0) {
        LeaveCriticalSection(local_38);
        local_2c = 0;
      }
      local_8 = 0xffffffff;
      if (local_18 != 0) {
        LeaveCriticalSection(local_24);
      }
      ExceptionList = local_10;
      return (undefined4 *)0x0;
    }
    *(undefined4 *)(in_ECX + 0xeb8) = *puVar1;
    *puVar1 = 0;
    local_8 = (local_8 >> 8) << 8;
    if (local_2c != 0) {
      LeaveCriticalSection(local_38);
      local_2c = 0;
    }
    local_8 = 0xffffffff;
    if (local_18 != 0) {
      LeaveCriticalSection(local_24);
      ExceptionList = local_10;
      return puVar1;
    }
  }
  else {
    *(undefined4 *)(in_ECX + 0xeb8) = *puVar1;
    *puVar1 = 0;
    local_8 = 0xffffffff;
    if (local_18 != 0) {
      LeaveCriticalSection(local_24);
    }
  }
  ExceptionList = local_10;
  return puVar1;
}



============================================================
DISASSEMBLY
============================================================
006f2640 : PUSH EBP
006f2641 : MOV EBP,ESP
006f2643 : PUSH -0x1
006f2645 : PUSH 0xb0cefe
006f264a : MOV EAX,FS:[0x0]
006f2650 : PUSH EAX
006f2651 : SUB ESP,0x28
006f2654 : PUSH EBX
006f2655 : PUSH ESI
006f2656 : PUSH EDI
006f2657 : MOV EAX,[0x00d66fa0]
006f265c : XOR EAX,EBP
006f265e : PUSH EAX
006f265f : LEA EAX,[EBP + -0xc]
006f2662 : MOV FS:[0x0],EAX
006f2668 : MOV ESI,ECX
006f266a : LEA ECX,[EBP + -0x20]
006f266d : LEA EAX,[ESI + 0xe98]
006f2673 : XOR EBX,EBX
006f2675 : PUSH ECX
006f2676 : MOV dword ptr [EBP + -0x14],EBX
006f2679 : MOV dword ptr [EBP + -0x20],EAX
006f267c : MOV dword ptr [EBP + -0x1c],0xbf7434
006f2683 : MOV dword ptr [EBP + -0x18],0x658
006f268a : MOV dword ptr [EBP + -0x10],0x1
006f2691 : CALL 0x006ef1a0
006f2696 : MOV dword ptr [EBP + -0x4],EBX
006f2699 : MOV EDI,dword ptr [ESI + 0xeb8]
006f269f : CMP EDI,EBX
006f26a1 : JZ 0x006f26da
006f26a3 : MOV EDX,dword ptr [EDI]
006f26a5 : MOV dword ptr [ESI + 0xeb8],EDX
006f26ab : MOV dword ptr [EDI],EBX
006f26ad : MOV dword ptr [EBP + -0x4],0xffffffff
006f26b4 : CMP dword ptr [EBP + -0x14],EBX
006f26b7 : JZ 0x006f26c6
006f26b9 : MOV EAX,dword ptr [EBP + -0x20]
006f26bc : PUSH EAX
006f26bd : CALL dword ptr [0x00b8511c]
006f26c3 : MOV dword ptr [EBP + -0x14],EBX
006f26c6 : MOV EAX,EDI
006f26c8 : MOV ECX,dword ptr [EBP + -0xc]
006f26cb : MOV dword ptr FS:[0x0],ECX
006f26d2 : POP ECX
006f26d3 : POP EDI
006f26d4 : POP ESI
006f26d5 : POP EBX
006f26d6 : MOV ESP,EBP
006f26d8 : POP EBP
006f26d9 : RET
006f26da : LEA EDX,[EBP + -0x34]
006f26dd : LEA ECX,[ESI + 0xe7c]
006f26e3 : PUSH EDX
006f26e4 : MOV dword ptr [EBP + -0x28],EBX
006f26e7 : MOV dword ptr [EBP + -0x34],ECX
006f26ea : MOV dword ptr [EBP + -0x30],0xbf7444
006f26f1 : MOV dword ptr [EBP + -0x2c],0x663
006f26f8 : MOV dword ptr [EBP + -0x24],0x1
006f26ff : CALL 0x006ef1a0
006f2704 : MOV byte ptr [EBP + -0x4],0x1
006f2708 : MOV EAX,dword ptr [ESI + 0xeb0]
006f270e : MOV EDI,EAX
006f2710 : MOV dword ptr [ESI + 0xeb8],EAX
006f2716 : MOV dword ptr [ESI + 0xeb4],EBX
006f271c : MOV dword ptr [ESI + 0xeb0],EBX
006f2722 : CMP EDI,EBX
006f2724 : JZ 0x006f2774
006f2726 : MOV ECX,dword ptr [EDI]
006f2728 : MOV dword ptr [ESI + 0xeb8],ECX
006f272e : MOV dword ptr [EDI],EBX
006f2730 : MOV byte ptr [EBP + -0x4],BL
006f2733 : MOV ESI,dword ptr [0x00b8511c]
006f2739 : CMP dword ptr [EBP + -0x28],EBX
006f273c : JZ 0x006f2747
006f273e : MOV EDX,dword ptr [EBP + -0x34]
006f2741 : PUSH EDX
006f2742 : CALL ESI
006f2744 : MOV dword ptr [EBP + -0x28],EBX
006f2747 : MOV dword ptr [EBP + -0x4],0xffffffff
006f274e : CMP dword ptr [EBP + -0x14],EBX
006f2751 : JZ 0x006f26c6
006f2757 : MOV EAX,dword ptr [EBP + -0x20]
006f275a : PUSH EAX
006f275b : CALL ESI
006f275d : MOV dword ptr [EBP + -0x14],EBX
006f2760 : MOV EAX,EDI
006f2762 : MOV ECX,dword ptr [EBP + -0xc]
006f2765 : MOV dword ptr FS:[0x0],ECX
006f276c : POP ECX
006f276d : POP EDI
006f276e : POP ESI
006f276f : POP EBX
006f2770 : MOV ESP,EBP
006f2772 : POP EBP
006f2773 : RET
006f2774 : MOV dword ptr [ESI + 0xebc],0x1
006f277e : MOV byte ptr [EBP + -0x4],BL
006f2781 : MOV ESI,dword ptr [0x00b8511c]
006f2787 : CMP dword ptr [EBP + -0x28],EBX
006f278a : JZ 0x006f2795
006f278c : MOV ECX,dword ptr [EBP + -0x34]
006f278f : PUSH ECX
006f2790 : CALL ESI
006f2792 : MOV dword ptr [EBP + -0x28],EBX
006f2795 : MOV dword ptr [EBP + -0x4],0xffffffff
006f279c : CMP dword ptr [EBP + -0x14],EBX
006f279f : JZ 0x006f27aa
006f27a1 : MOV EDX,dword ptr [EBP + -0x20]
006f27a4 : PUSH EDX
006f27a5 : CALL ESI
006f27a7 : MOV dword ptr [EBP + -0x14],EBX
006f27aa : XOR EAX,EAX
006f27ac : MOV ECX,dword ptr [EBP + -0xc]
006f27af : MOV dword ptr FS:[0x0],ECX
006f27b6 : POP ECX
006f27b7 : POP EDI
006f27b8 : POP ESI
006f27b9 : POP EBX
006f27ba : MOV ESP,EBP
006f27bc : POP EBP
006f27bd : RET
