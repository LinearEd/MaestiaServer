PROGRAM  : Maestia.exe
FUNCTION : FUN_009d6240
ENTRY    : 009d6240
BODY     : [[009d6240, 009d62d2] [009d62d6, 009d64b9]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Removing unreachable block (ram,0x009d6308) */

void FUN_009d6240(int param_1,ushort *param_2)

{
  int iVar1;
  undefined4 *puVar2;
  char cVar3;
  uint uVar4;
  undefined4 *puVar5;
  uint uVar6;
  int *piVar7;
  undefined4 *local_20;
  int local_1c;
  ushort *local_18;
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b61027;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_18 = param_2 + 3;
  local_1c = (*param_2 & 0x1fff) - 6;
  if ((char)param_2[2] != '\0') {
    piVar7 = *(int **)(param_1 + 0xd4);
    if (piVar7 != *(int **)(param_1 + 0xd8)) {
      do {
        iVar1 = *piVar7;
        if (iVar1 != 0) {
          if (*(int *)(iVar1 + 0xa0) != 0) {
            *(undefined4 *)(*(int *)(iVar1 + 0xa0) + 0x24) = 0;
          }
          if (*(int **)(iVar1 + 0xa0) != (int *)0x0) {
            (**(code **)(**(int **)(iVar1 + 0xa0) + 0x18))(1);
            *(undefined4 *)(iVar1 + 0xa0) = 0;
          }
                    /* WARNING: Subroutine does not return */
          FUN_006f04e0();
        }
        piVar7 = piVar7 + 1;
      } while (piVar7 != *(int **)(param_1 + 0xd8));
    }
    if (*(int *)(param_1 + 0xd4) != *(int *)(param_1 + 0xd8)) {
      *(int *)(param_1 + 0xd8) = *(int *)(param_1 + 0xd4);
    }
  }
  local_14 = 0;
  if (*(char *)((int)param_2 + 5) != '\0') {
    do {
      puVar5 = (undefined4 *)FUN_006f0760(0xa8,"",0,(DAT_01725270 >> 3 & 1) == 0,uVar4);
      if (puVar5 == (undefined4 *)0x0) {
        puVar5 = (undefined4 *)0x0;
      }
      else {
        *puVar5 = 0;
        puVar5[1] = 0;
        puVar5[2] = 0;
        puVar5[3] = 0;
        puVar5[4] = 0;
        puVar5[6] = 0;
        puVar5[7] = 0;
        *(undefined1 *)(puVar5 + 8) = 0;
        puVar5[9] = 0;
        puVar5[10] = 0;
        puVar5[0xb] = 0;
        puVar5[0xc] = 0;
        puVar5[0xd] = 0;
        *(undefined2 *)(puVar5 + 0xe) = 0;
        *(undefined1 *)((int)puVar5 + 0x3a) = 0;
        *(undefined2 *)(puVar5 + 0xf) = 0;
        puVar5[0x24] = 0;
        puVar5[0x25] = 0;
        puVar5[0x26] = 0;
        *(undefined2 *)(puVar5 + 0x27) = 0;
        puVar5[0x28] = 0;
      }
      local_8 = 0xffffffff;
      local_20 = puVar5;
      FUN_0041b8b0(puVar5,&local_18);
      iVar1 = *(int *)(param_1 + 0xd4);
      if (iVar1 == 0) {
        uVar6 = 0;
      }
      else {
        uVar6 = *(int *)(param_1 + 0xdc) - iVar1 >> 2;
      }
      puVar2 = *(undefined4 **)(param_1 + 0xd8);
      if ((uint)((int)puVar2 - iVar1 >> 2) < uVar6) {
        *puVar2 = puVar5;
        *(undefined4 **)(param_1 + 0xd8) = puVar2 + 1;
      }
      else {
        FUN_0042fe80(param_1 + 0xd0,puVar2,&local_20);
      }
      FUN_009d39e0(param_1);
      local_14 = local_14 + 1;
    } while (local_14 < (int)(uint)*(byte *)((int)param_2 + 5));
  }
  piVar7 = *(int **)(param_1 + 0xe4);
  *(undefined1 *)(param_1 + 0xf0) = 0;
  if (piVar7 != *(int **)(param_1 + 0xe8)) {
    do {
      puVar5 = (undefined4 *)*piVar7;
      cVar3 = FUN_009d0370(*puVar5,puVar5[1]);
      if ((cVar3 == '\x01') && (0 < (int)puVar5[10])) {
        puVar5[10] = -puVar5[10];
      }
      piVar7 = piVar7 + 1;
    } while (piVar7 != *(int **)(param_1 + 0xe8));
  }
  if (*(int *)(param_1 + 0x138) == 0) {
    FUN_009d5930();
    FUN_009d4fe0(param_1);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
009d6240 : PUSH EBP
009d6241 : MOV EBP,ESP
009d6243 : PUSH -0x1
009d6245 : PUSH 0xb61027
009d624a : MOV EAX,FS:[0x0]
009d6250 : PUSH EAX
009d6251 : SUB ESP,0x14
009d6254 : PUSH EBX
009d6255 : PUSH ESI
009d6256 : PUSH EDI
009d6257 : MOV EAX,[0x00d66fa0]
009d625c : XOR EAX,EBP
009d625e : PUSH EAX
009d625f : LEA EAX,[EBP + -0xc]
009d6262 : MOV FS:[0x0],EAX
009d6268 : MOV EAX,dword ptr [EBP + 0xc]
009d626b : MOVZX EDX,word ptr [EAX]
009d626e : AND EDX,0x1fff
009d6274 : LEA ECX,[EAX + 0x6]
009d6277 : SUB EDX,0x6
009d627a : XOR EBX,EBX
009d627c : MOV dword ptr [EBP + -0x14],ECX
009d627f : MOV ECX,dword ptr [EBP + 0x8]
009d6282 : MOV dword ptr [EBP + -0x18],EDX
009d6285 : CMP byte ptr [EAX + 0x4],BL
009d6288 : JZ 0x009d6320
009d628e : MOV EDI,dword ptr [ECX + 0xd4]
009d6294 : CMP EDI,dword ptr [ECX + 0xd8]
009d629a : JZ 0x009d62e1
009d629c : LEA ESP,[ESP]
009d62a0 : MOV ESI,dword ptr [EDI]
009d62a2 : CMP ESI,EBX
009d62a4 : JZ 0x009d62d6
009d62a6 : MOV EAX,dword ptr [ESI + 0xa0]
009d62ac : CMP EAX,EBX
009d62ae : JZ 0x009d62b3
009d62b0 : MOV dword ptr [EAX + 0x24],EBX
009d62b3 : MOV ECX,dword ptr [ESI + 0xa0]
009d62b9 : CMP ECX,EBX
009d62bb : JZ 0x009d62cc
009d62bd : MOV EAX,dword ptr [ECX]
009d62bf : MOV EDX,dword ptr [EAX + 0x18]
009d62c2 : PUSH 0x1
009d62c4 : CALL EDX
009d62c6 : MOV dword ptr [ESI + 0xa0],EBX
009d62cc : MOV ECX,ESI
009d62ce : CALL 0x006f04e0
009d62d6 : ADD EDI,0x4
009d62d9 : CMP EDI,dword ptr [ECX + 0xd8]
009d62df : JNZ 0x009d62a0
009d62e1 : MOV EDI,dword ptr [ECX + 0xd4]
009d62e7 : MOV EDX,dword ptr [ECX + 0xd8]
009d62ed : MOV dword ptr [EBP + -0x10],EDI
009d62f0 : CMP EDI,EDX
009d62f2 : JZ 0x009d6320
009d62f4 : MOV EAX,EDX
009d62f6 : SUB EAX,EDX
009d62f8 : SAR EAX,0x2
009d62fb : LEA ESI,[EAX*0x4 + 0x0]
009d6302 : ADD EDI,ESI
009d6304 : CMP EAX,EBX
009d6306 : JLE 0x009d631a
009d6308 : MOV EAX,dword ptr [EBP + -0x10]
009d630b : PUSH ESI
009d630c : PUSH EDX
009d630d : PUSH ESI
009d630e : PUSH EAX
009d630f : CALL 0x00634101
009d6314 : MOV ECX,dword ptr [EBP + 0x8]
009d6317 : ADD ESP,0x10
009d631a : MOV dword ptr [ECX + 0xd8],EDI
009d6320 : MOV EDX,dword ptr [EBP + 0xc]
009d6323 : MOV dword ptr [EBP + -0x10],EBX
009d6326 : CMP byte ptr [EDX + 0x5],BL
009d6329 : JBE 0x009d6445
009d632f : NOP
009d6330 : MOV EAX,[0x01725270]
009d6335 : SHR EAX,0x3
009d6338 : MOV ECX,0x0
009d633d : AND EAX,0x1
009d6340 : SETZ CL
009d6343 : PUSH ECX
009d6344 : PUSH EBX
009d6345 : PUSH 0xbf1a4a
009d634a : PUSH 0xa8
009d634f : CALL 0x006f0760
009d6354 : ADD ESP,0x10
009d6357 : MOV dword ptr [EBP + -0x1c],EAX
009d635a : MOV dword ptr [EBP + -0x4],EBX
009d635d : CMP EAX,EBX
009d635f : JZ 0x009d63b9
009d6361 : XOR EDX,EDX
009d6363 : XOR ECX,ECX
009d6365 : MOV dword ptr [EAX],EBX
009d6367 : MOV dword ptr [EAX + 0x4],EBX
009d636a : MOV dword ptr [EAX + 0x8],EBX
009d636d : MOV dword ptr [EAX + 0xc],EBX
009d6370 : MOV dword ptr [EAX + 0x10],EBX
009d6373 : MOV dword ptr [EAX + 0x18],EBX
009d6376 : MOV dword ptr [EAX + 0x1c],EBX
009d6379 : MOV byte ptr [EAX + 0x20],BL
009d637c : MOV dword ptr [EAX + 0x24],EBX
009d637f : MOV dword ptr [EAX + 0x28],EBX
009d6382 : MOV dword ptr [EAX + 0x2c],EBX
009d6385 : MOV dword ptr [EAX + 0x30],EBX
009d6388 : MOV dword ptr [EAX + 0x34],EBX
009d638b : MOV word ptr [EAX + 0x38],DX
009d638f : MOV byte ptr [EAX + 0x3a],BL
009d6392 : MOV word ptr [EAX + 0x3c],CX
009d6396 : MOV dword ptr [EAX + 0x90],EBX
009d639c : MOV dword ptr [EAX + 0x94],EBX
009d63a2 : MOV dword ptr [EAX + 0x98],EBX
009d63a8 : MOV word ptr [EAX + 0x9c],DX
009d63af : MOV dword ptr [EAX + 0xa0],EBX
009d63b5 : MOV EDI,EAX
009d63b7 : JMP 0x009d63bb
009d63b9 : XOR EDI,EDI
009d63bb : MOV dword ptr [EBP + -0x4],0xffffffff
009d63c2 : LEA EAX,[EBP + -0x14]
009d63c5 : PUSH EAX
009d63c6 : PUSH EDI
009d63c7 : LEA ESI,[EBP + -0x18]
009d63ca : MOV dword ptr [EBP + -0x1c],EDI
009d63cd : CALL 0x0041b8b0
009d63d2 : MOV ECX,dword ptr [EBP + 0x8]
009d63d5 : MOV EDX,dword ptr [ECX + 0xd4]
009d63db : ADD ECX,0xd0
009d63e1 : CMP EDX,EBX
009d63e3 : JNZ 0x009d63e9
009d63e5 : XOR EAX,EAX
009d63e7 : JMP 0x009d63f1
009d63e9 : MOV EAX,dword ptr [ECX + 0xc]
009d63ec : SUB EAX,EDX
009d63ee : SAR EAX,0x2
009d63f1 : MOV ECX,dword ptr [ECX + 0x8]
009d63f4 : MOV ESI,ECX
009d63f6 : SUB ESI,EDX
009d63f8 : SAR ESI,0x2
009d63fb : CMP ESI,EAX
009d63fd : MOV EAX,dword ptr [EBP + 0x8]
009d6400 : JNC 0x009d6411
009d6402 : MOV dword ptr [ECX],EDI
009d6404 : ADD ECX,0x4
009d6407 : ADD EAX,0xd0
009d640c : MOV dword ptr [EAX + 0x8],ECX
009d640f : JMP 0x009d6421
009d6411 : LEA EDX,[EBP + -0x1c]
009d6414 : PUSH EDX
009d6415 : PUSH ECX
009d6416 : ADD EAX,0xd0
009d641b : PUSH EAX
009d641c : CALL 0x0042fe80
009d6421 : MOV EAX,dword ptr [EBP + 0x8]
009d6424 : PUSH EAX
009d6425 : MOV ECX,EDI
009d6427 : CALL 0x009d39e0
009d642c : MOV ECX,dword ptr [EBP + 0xc]
009d642f : MOV EAX,dword ptr [EBP + -0x10]
009d6432 : MOVZX EDX,byte ptr [ECX + 0x5]
009d6436 : INC EAX
009d6437 : CMP EAX,EDX
009d6439 : MOV dword ptr [EBP + -0x10],EAX
009d643c : JL 0x009d6330
009d6442 : MOV ECX,dword ptr [EBP + 0x8]
009d6445 : MOV EDI,dword ptr [ECX + 0xe4]
009d644b : MOV byte ptr [ECX + 0xf0],BL
009d6451 : CMP EDI,dword ptr [ECX + 0xe8]
009d6457 : JZ 0x009d6490
009d6459 : LEA ESP,[ESP]
009d6460 : MOV ESI,dword ptr [EDI]
009d6462 : MOV EAX,dword ptr [ESI + 0x4]
009d6465 : MOV EDX,dword ptr [ESI]
009d6467 : PUSH EAX
009d6468 : PUSH EDX
009d6469 : MOV EAX,ECX
009d646b : CALL 0x009d0370
009d6470 : CMP AL,0x1
009d6472 : JNZ 0x009d6480
009d6474 : MOV EAX,dword ptr [ESI + 0x28]
009d6477 : CMP EAX,EBX
009d6479 : JLE 0x009d6480
009d647b : NEG EAX
009d647d : MOV dword ptr [ESI + 0x28],EAX
009d6480 : MOV EAX,dword ptr [EBP + 0x8]
009d6483 : ADD EDI,0x4
009d6486 : MOV ECX,EAX
009d6488 : CMP EDI,dword ptr [EAX + 0xe8]
009d648e : JNZ 0x009d6460
009d6490 : CMP dword ptr [ECX + 0x138],EBX
009d6496 : JNZ 0x009d64a6
009d6498 : CALL 0x009d5930
009d649d : MOV ECX,dword ptr [EBP + 0x8]
009d64a0 : PUSH ECX
009d64a1 : CALL 0x009d4fe0
009d64a6 : MOV ECX,dword ptr [EBP + -0xc]
009d64a9 : MOV dword ptr FS:[0x0],ECX
009d64b0 : POP ECX
009d64b1 : POP EDI
009d64b2 : POP ESI
009d64b3 : POP EBX
009d64b4 : MOV ESP,EBP
009d64b6 : POP EBP
009d64b7 : RET 0x8
