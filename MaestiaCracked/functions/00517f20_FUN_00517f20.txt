PROGRAM  : Maestia.exe
FUNCTION : FUN_00517f20
ENTRY    : 00517f20
BODY     : [[00517f20, 00517fd8]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00517f20(_func_void_void_ptr *param_1)

{
  LPCRITICAL_SECTION lpCriticalSection;
  undefined4 *puVar1;
  int iVar2;
  int iVar3;
  int *in_ECX;
  uint uVar4;
  uint uVar5;
  uint uVar6;
  
  uVar4 = 0;
  if (in_ECX[1] != 0) {
    do {
      iVar2 = *(int *)(*in_ECX + uVar4 * 4);
      iVar3 = *(int *)(iVar2 + 8);
      if (iVar3 == 0) {
        while (uVar4 != 0) {
          uVar4 = uVar4 - 1;
          GWaitable::RemoveWaitHandler(*(GWaitable **)(*in_ECX + uVar4 * 4),param_1,in_ECX);
        }
        return 0;
      }
      lpCriticalSection = (LPCRITICAL_SECTION)(iVar3 + 0x10);
      EnterCriticalSection(lpCriticalSection);
      iVar2 = *(int *)(iVar2 + 8);
      uVar5 = *(int *)(iVar2 + 8) + 1;
      if (uVar5 < *(uint *)(iVar2 + 8)) {
        uVar6 = uVar5;
        if (uVar5 < *(uint *)(iVar2 + 0xc) >> 1) {
LAB_00517f74:
          FUN_00517b00((int *)(iVar2 + 4),uVar6);
        }
      }
      else if (*(uint *)(iVar2 + 0xc) <= uVar5) {
        uVar6 = (uVar5 >> 2) + uVar5;
        goto LAB_00517f74;
      }
      *(uint *)(iVar2 + 8) = uVar5;
      puVar1 = (undefined4 *)(*(int *)(iVar2 + 4) + -8 + uVar5 * 8);
      if (puVar1 != (undefined4 *)0x0) {
        *puVar1 = param_1;
        puVar1[1] = in_ECX;
      }
      LeaveCriticalSection(lpCriticalSection);
      uVar4 = uVar4 + 1;
    } while (uVar4 < (uint)in_ECX[1]);
  }
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00517f20 : PUSH ECX
00517f21 : PUSH EBX
00517f22 : PUSH EBP
00517f23 : PUSH ESI
00517f24 : PUSH EDI
00517f25 : MOV EDI,ECX
00517f27 : XOR EBX,EBX
00517f29 : MOV dword ptr [ESP + 0x10],EDI
00517f2d : CMP dword ptr [EDI + 0x4],EBX
00517f30 : JBE 0x00517fcf
00517f36 : MOV EAX,dword ptr [EDI]
00517f38 : MOV ESI,dword ptr [EAX + EBX*0x4]
00517f3b : MOV EAX,dword ptr [ESI + 0x8]
00517f3e : TEST EAX,EAX
00517f40 : JZ 0x00517fab
00517f42 : LEA EBP,[EAX + 0x10]
00517f45 : PUSH EBP
00517f46 : CALL dword ptr [0x00b85118]
00517f4c : MOV ESI,dword ptr [ESI + 0x8]
00517f4f : MOV EDI,dword ptr [ESI + 0x8]
00517f52 : ADD ESI,0x4
00517f55 : INC EDI
00517f56 : CMP EDI,dword ptr [ESI + 0x4]
00517f59 : JNC 0x00517f67
00517f5b : MOV ECX,dword ptr [ESI + 0x8]
00517f5e : SHR ECX,0x1
00517f60 : CMP EDI,ECX
00517f62 : JNC 0x00517f7c
00517f64 : PUSH EDI
00517f65 : JMP 0x00517f74
00517f67 : CMP EDI,dword ptr [ESI + 0x8]
00517f6a : JC 0x00517f7c
00517f6c : MOV EDX,EDI
00517f6e : SHR EDX,0x2
00517f71 : ADD EDX,EDI
00517f73 : PUSH EDX
00517f74 : PUSH ESI
00517f75 : MOV ECX,ESI
00517f77 : CALL 0x00517b00
00517f7c : MOV EAX,dword ptr [ESI]
00517f7e : MOV dword ptr [ESI + 0x4],EDI
00517f81 : LEA EDI,[EAX + EDI*0x8 + -0x8]
00517f85 : TEST EDI,EDI
00517f87 : JZ 0x00517f96
00517f89 : MOV ECX,dword ptr [ESP + 0x18]
00517f8d : MOV EDX,dword ptr [ESP + 0x10]
00517f91 : MOV dword ptr [EDI],ECX
00517f93 : MOV dword ptr [EDI + 0x4],EDX
00517f96 : PUSH EBP
00517f97 : CALL dword ptr [0x00b8511c]
00517f9d : MOV EAX,dword ptr [ESP + 0x10]
00517fa1 : INC EBX
00517fa2 : CMP EBX,dword ptr [EAX + 0x4]
00517fa5 : JNC 0x00517fcf
00517fa7 : MOV EDI,EAX
00517fa9 : JMP 0x00517f36
00517fab : TEST EBX,EBX
00517fad : JBE 0x00517fc5
00517faf : NOP
00517fb0 : MOV ECX,dword ptr [ESP + 0x18]
00517fb4 : MOV EDX,dword ptr [EDI]
00517fb6 : PUSH EDI
00517fb7 : DEC EBX
00517fb8 : PUSH ECX
00517fb9 : MOV ECX,dword ptr [EDX + EBX*0x4]
00517fbc : CALL 0x00517db0
00517fc1 : TEST EBX,EBX
00517fc3 : JA 0x00517fb0
00517fc5 : POP EDI
00517fc6 : POP ESI
00517fc7 : POP EBP
00517fc8 : XOR AL,AL
00517fca : POP EBX
00517fcb : POP ECX
00517fcc : RET 0x4
00517fcf : POP EDI
00517fd0 : POP ESI
00517fd1 : POP EBP
00517fd2 : MOV AL,0x1
00517fd4 : POP EBX
00517fd5 : POP ECX
00517fd6 : RET 0x4
