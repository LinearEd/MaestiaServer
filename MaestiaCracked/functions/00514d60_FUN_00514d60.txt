PROGRAM  : Maestia.exe
FUNCTION : FUN_00514d60
ENTRY    : 00514d60
BODY     : [[00514d60, 00514ec7]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00514d60(undefined4 param_1,uint param_2)

{
  undefined4 *puVar1;
  GRefCountImpl *this;
  undefined4 *puVar2;
  int iVar3;
  int *in_ECX;
  int iVar4;
  int iVar5;
  float10 fVar6;
  longlong local_8;
  
  iVar4 = 0;
  if (param_2 == 0) {
    FUN_0055f000();
    return;
  }
  if (param_2 < 8) {
    iVar5 = 8;
  }
  else {
    fVar6 = (float10)FUN_0063b270();
    local_8 = (longlong)ROUND((float)fVar6 / 0.6931472 + 1.0);
    iVar5 = 1 << ((byte)local_8 & 0x1f);
  }
  local_8 = CONCAT44(local_8._4_4_,2);
  puVar2 = (undefined4 *)FUN_00515840(iVar5 * 0xc + 8,&local_8);
  *puVar2 = 0;
  puVar2[1] = iVar5 + -1;
  if (iVar5 != 0) {
    iVar3 = 0;
    do {
      *(undefined4 *)(iVar3 + 8 + (int)puVar2) = 0xfffffffe;
      iVar3 = iVar3 + 0xc;
      iVar5 = iVar5 + -1;
    } while (iVar5 != 0);
  }
  if (*in_ECX != 0) {
    iVar5 = *(int *)(*in_ECX + 4) + 1;
    do {
      puVar1 = (undefined4 *)(iVar4 + 8 + *in_ECX);
      if (*(int *)(iVar4 + 8 + *in_ECX) != -2) {
        FUN_00513fc0(param_1,puVar1 + 2,*(undefined4 *)(puVar1[2] + 8));
        this = (GRefCountImpl *)puVar1[2];
        if (this != (GRefCountImpl *)0x0) {
          GRefCountImpl::Release(this);
        }
        *puVar1 = 0xfffffffe;
      }
      iVar4 = iVar4 + 0xc;
      iVar5 = iVar5 + -1;
    } while (iVar5 != 0);
    FUN_00515cf0(*in_ECX);
  }
  *in_ECX = (int)puVar2;
  FUN_0055f000();
  return;
}



============================================================
DISASSEMBLY
============================================================
00514d60 : SUB ESP,0xc
00514d63 : MOV EAX,dword ptr [ESP + 0x14]
00514d67 : PUSH EBX
00514d68 : PUSH EDI
00514d69 : XOR EBX,EBX
00514d6b : MOV EDI,ECX
00514d6d : MOV dword ptr [ESP + 0x8],EDI
00514d71 : CMP EAX,EBX
00514d73 : JNZ 0x00514d82
00514d75 : CALL 0x0055f000
00514d7a : POP EDI
00514d7b : POP EBX
00514d7c : ADD ESP,0xc
00514d7f : RET 0x8
00514d82 : PUSH ESI
00514d83 : CMP EAX,0x8
00514d86 : JNC 0x00514d8f
00514d88 : MOV ESI,0x8
00514d8d : JMP 0x00514df4
00514d8f : DEC EAX
00514d90 : MOV dword ptr [ESP + 0x20],EAX
00514d94 : FILD dword ptr [ESP + 0x20]
00514d98 : TEST EAX,EAX
00514d9a : JGE 0x00514da2
00514d9c : FADD float ptr [0x00cdf0e0]
00514da2 : CALL 0x0063b270
00514da7 : FSTP float ptr [ESP + 0x20]
00514dab : FLD float ptr [ESP + 0x20]
00514daf : MOV ESI,0x1
00514db4 : FDIV double ptr [0x00b85fe0]
00514dba : FSTP float ptr [ESP + 0x20]
00514dbe : FLD float ptr [ESP + 0x20]
00514dc2 : FADD double ptr [0x00cdf108]
00514dc8 : FSTP float ptr [ESP + 0x20]
00514dcc : FLD float ptr [ESP + 0x20]
00514dd0 : FNSTCW word ptr [ESP + 0x20]
00514dd4 : MOVZX EAX,word ptr [ESP + 0x20]
00514dd9 : OR EAX,0xc00
00514dde : MOV dword ptr [ESP + 0x10],EAX
00514de2 : FLDCW word ptr [ESP + 0x10]
00514de6 : FISTP qword ptr [ESP + 0x10]
00514dea : MOV CL,byte ptr [ESP + 0x10]
00514dee : SHL ESI,CL
00514df0 : FLDCW word ptr [ESP + 0x20]
00514df4 : LEA EAX,[ESP + 0x10]
00514df8 : LEA ECX,[ESI + ESI*0x2]
00514dfb : LEA EDX,[ECX*0x4 + 0x8]
00514e02 : MOV ECX,dword ptr [0x00d73250]
00514e08 : PUSH EAX
00514e09 : PUSH EDX
00514e0a : MOV dword ptr [ESP + 0x28],EBX
00514e0e : MOV dword ptr [ESP + 0x18],0x2
00514e16 : CALL 0x00515840
00514e1b : MOV dword ptr [ESP + 0x20],EAX
00514e1f : MOV dword ptr [EAX],EBX
00514e21 : MOV ECX,dword ptr [ESP + 0x20]
00514e25 : LEA EAX,[ESI + -0x1]
00514e28 : MOV dword ptr [ECX + 0x4],EAX
00514e2b : CMP ESI,EBX
00514e2d : JBE 0x00514e45
00514e2f : XOR EAX,EAX
00514e31 : MOV EDX,dword ptr [ESP + 0x20]
00514e35 : MOV dword ptr [EAX + EDX*0x1 + 0x8],0xfffffffe
00514e3d : ADD EAX,0xc
00514e40 : SUB ESI,0x1
00514e43 : JNZ 0x00514e31
00514e45 : MOV EAX,dword ptr [EDI]
00514e47 : CMP EAX,EBX
00514e49 : JZ 0x00514ea8
00514e4b : MOV EAX,dword ptr [EAX + 0x4]
00514e4e : PUSH EBP
00514e4f : LEA EBP,[EAX + 0x1]
00514e52 : JMP 0x00514e58
00514e54 : MOV EDI,dword ptr [ESP + 0x10]
00514e58 : MOV EAX,dword ptr [EDI]
00514e5a : CMP dword ptr [EBX + EAX*0x1 + 0x8],-0x2
00514e5f : LEA EDI,[EBX + EAX*0x1 + 0x8]
00514e63 : JZ 0x00514e8f
00514e65 : MOV ECX,dword ptr [EDI + 0x8]
00514e68 : MOV EDX,dword ptr [ECX + 0x8]
00514e6b : MOV EAX,dword ptr [ESP + 0x20]
00514e6f : LEA ESI,[EDI + 0x8]
00514e72 : PUSH EDX
00514e73 : PUSH ESI
00514e74 : PUSH EAX
00514e75 : LEA ECX,[ESP + 0x30]
00514e79 : CALL 0x00513fc0
00514e7e : MOV ECX,dword ptr [ESI]
00514e80 : TEST ECX,ECX
00514e82 : JZ 0x00514e89
00514e84 : CALL 0x004ff7e0
00514e89 : MOV dword ptr [EDI],0xfffffffe
00514e8f : ADD EBX,0xc
00514e92 : SUB EBP,0x1
00514e95 : JNZ 0x00514e54
00514e97 : MOV ECX,dword ptr [ESP + 0x10]
00514e9b : MOV EDX,dword ptr [ECX]
00514e9d : PUSH EDX
00514e9e : CALL 0x00515cf0
00514ea3 : MOV EDI,dword ptr [ESP + 0x10]
00514ea7 : POP EBP
00514ea8 : MOV EAX,dword ptr [ESP + 0x20]
00514eac : LEA ECX,[ESP + 0x20]
00514eb0 : MOV dword ptr [EDI],EAX
00514eb2 : MOV dword ptr [ESP + 0x20],0x0
00514eba : CALL 0x0055f000
00514ebf : POP ESI
00514ec0 : POP EDI
00514ec1 : POP EBX
00514ec2 : ADD ESP,0xc
00514ec5 : RET 0x8
