PROGRAM  : Maestia.exe
FUNCTION : FUN_00436850
ENTRY    : 00436850
BODY     : [[00436850, 004369a7] [004369ed, 00436a67] [00436a8a, 00436b0b]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00436850(int param_1,int param_2,uint param_3,undefined4 param_4)

{
  uint uVar1;
  uint *puVar2;
  int iVar3;
  undefined4 uVar4;
  uint extraout_ECX;
  int iVar5;
  undefined8 uVar6;
  uint uStack_44;
  undefined1 local_30 [16];
  int local_20;
  undefined4 local_1c;
  uint local_18;
  undefined1 *local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b808f0;
  local_10 = ExceptionList;
  uStack_44 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  local_14 = (undefined1 *)&uStack_44;
  ExceptionList = &local_10;
  iVar3 = *(int *)(param_1 + 4);
  if (iVar3 == 0) {
    local_18 = 0;
  }
  else {
    local_18 = *(int *)(param_1 + 0xc) - iVar3 >> 4;
  }
  if (param_3 != 0) {
    iVar3 = *(int *)(param_1 + 8) - iVar3 >> 4;
    uVar6 = CONCAT44(*(int *)(param_1 + 8),iVar3);
    puVar2 = &uStack_44;
    if (0xfffffffU - iVar3 < param_3) {
      uVar6 = FUN_00452880();
      local_18 = extraout_ECX;
      puVar2 = (uint *)local_14;
    }
    local_14 = (undefined1 *)puVar2;
    uVar1 = (int)uVar6 + param_3;
    if (local_18 < uVar1) {
      if (0xfffffff - (local_18 >> 1) < local_18) {
        local_18 = 0;
      }
      else {
        local_18 = local_18 + (local_18 >> 1);
      }
      if (local_18 < uVar1) {
        local_18 = uVar1;
      }
      iVar3 = FUN_00424e80();
      local_20 = param_2 - *(int *)(param_1 + 4) >> 4;
      local_1c = 0;
      local_8 = 0;
      FUN_00437a10();
      local_1c = 1;
      FUN_00438120(*(undefined4 *)(param_1 + 4),param_2);
      local_1c = 2;
      FUN_00438120(param_2,*(undefined4 *)(param_1 + 8));
      local_8 = 0xffffffff;
      if (*(int *)(param_1 + 4) != 0) {
        FUN_00438260(*(undefined4 *)(param_1 + 8),param_2);
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      *(uint *)(param_1 + 0xc) = local_18 * 0x10 + iVar3;
      *(uint *)(param_1 + 8) =
           (param_3 + (*(int *)(param_1 + 8) - *(int *)(param_1 + 4) >> 4)) * 0x10 + iVar3;
      *(int *)(param_1 + 4) = iVar3;
      ExceptionList = local_10;
      return;
    }
    if ((uint)((int)((ulonglong)uVar6 >> 0x20) - param_2 >> 4) < param_3) {
      FUN_00436b10(local_30,param_4);
      local_8 = 2;
      FUN_00438120(param_2,*(undefined4 *)(param_1 + 8));
      local_8 = CONCAT31(local_8._1_3_,3);
      FUN_00437a10();
      local_8 = 2;
      *(int *)(param_1 + 8) = *(int *)(param_1 + 8) + param_3 * 0x10;
      FUN_00438150(local_30);
    }
    else {
      FUN_00436b10(local_30,param_4);
      local_8 = 5;
      iVar3 = *(int *)(param_1 + 8);
      iVar5 = iVar3 + param_3 * -0x10;
      uVar4 = FUN_00438120(iVar5,iVar3);
      *(undefined4 *)(param_1 + 8) = uVar4;
      param_3 = param_3 & 0xffffff00;
      FUN_004382b0(param_2,iVar5,iVar3,param_2,param_2,param_3);
      FUN_00438150(local_30);
    }
    local_8 = 0xffffffff;
    FUN_004361d0();
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00436850 : PUSH EBP
00436851 : MOV EBP,ESP
00436853 : PUSH -0x1
00436855 : PUSH 0xb808f0
0043685a : MOV EAX,FS:[0x0]
00436860 : PUSH EAX
00436861 : SUB ESP,0x24
00436864 : PUSH EBX
00436865 : PUSH ESI
00436866 : PUSH EDI
00436867 : MOV EAX,[0x00d66fa0]
0043686c : XOR EAX,EBP
0043686e : PUSH EAX
0043686f : LEA EAX,[EBP + -0xc]
00436872 : MOV FS:[0x0],EAX
00436878 : MOV dword ptr [EBP + -0x10],ESP
0043687b : MOV ESI,dword ptr [EBP + 0x10]
0043687e : MOV EBX,dword ptr [EBP + 0x8]
00436881 : MOV EDI,dword ptr [EBX + 0x4]
00436884 : TEST EDI,EDI
00436886 : JNZ 0x0043688c
00436888 : XOR ECX,ECX
0043688a : JMP 0x00436896
0043688c : MOV EAX,dword ptr [EBX + 0xc]
0043688f : SUB EAX,EDI
00436891 : SAR EAX,0x4
00436894 : MOV ECX,EAX
00436896 : TEST ESI,ESI
00436898 : JZ 0x00436af8
0043689e : MOV EDX,dword ptr [EBX + 0x8]
004368a1 : MOV EAX,EDX
004368a3 : SUB EAX,EDI
004368a5 : SAR EAX,0x4
004368a8 : MOV EDI,0xfffffff
004368ad : SUB EDI,EAX
004368af : CMP EDI,ESI
004368b1 : JNC 0x004368b8
004368b3 : CALL 0x00452880
004368b8 : LEA EDI,[EAX + ESI*0x1]
004368bb : CMP ECX,EDI
004368bd : JNC 0x004369ed
004368c3 : MOV EAX,ECX
004368c5 : SHR EAX,0x1
004368c7 : MOV EDX,0xfffffff
004368cc : SUB EDX,EAX
004368ce : CMP EDX,ECX
004368d0 : JNC 0x004368de
004368d2 : MOV dword ptr [EBP + -0x14],0x0
004368d9 : MOV ECX,dword ptr [EBP + -0x14]
004368dc : JMP 0x004368e3
004368de : ADD ECX,EAX
004368e0 : MOV dword ptr [EBP + -0x14],ECX
004368e3 : CMP ECX,EDI
004368e5 : JNC 0x004368ec
004368e7 : MOV dword ptr [EBP + -0x14],EDI
004368ea : MOV ECX,EDI
004368ec : CALL 0x00424e80
004368f1 : MOV dword ptr [EBP + 0x8],EAX
004368f4 : MOV ECX,dword ptr [EBP + 0xc]
004368f7 : SUB ECX,dword ptr [EBX + 0x4]
004368fa : SAR ECX,0x4
004368fd : MOV dword ptr [EBP + -0x1c],ECX
00436900 : XOR EDX,EDX
00436902 : MOV dword ptr [EBP + -0x18],EDX
00436905 : MOV dword ptr [EBP + -0x4],EDX
00436908 : MOV EDI,ECX
0043690a : SHL EDI,0x4
0043690d : ADD EDI,EAX
0043690f : MOV EDX,dword ptr [EBP + 0x14]
00436912 : CALL 0x00437a10
00436917 : MOV dword ptr [EBP + -0x18],0x1
0043691e : MOV EAX,dword ptr [EBP + 0xc]
00436921 : PUSH EAX
00436922 : MOV ECX,dword ptr [EBX + 0x4]
00436925 : PUSH ECX
00436926 : MOV EDI,dword ptr [EBP + 0x8]
00436929 : MOV EDX,EDI
0043692b : CALL 0x00438120
00436930 : MOV dword ptr [EBP + -0x18],0x2
00436937 : MOV EDX,dword ptr [EBP + -0x1c]
0043693a : ADD EDX,ESI
0043693c : SHL EDX,0x4
0043693f : ADD EDX,EDI
00436941 : MOV EAX,dword ptr [EBX + 0x8]
00436944 : PUSH EAX
00436945 : MOV ECX,dword ptr [EBP + 0xc]
00436948 : PUSH ECX
00436949 : CALL 0x00438120
0043694e : MOV dword ptr [EBP + -0x4],0xffffffff
00436955 : MOV EAX,dword ptr [EBX + 0x4]
00436958 : MOV EDX,dword ptr [EBX + 0x8]
0043695b : SUB EDX,EAX
0043695d : SAR EDX,0x4
00436960 : ADD ESI,EDX
00436962 : TEST EAX,EAX
00436964 : JZ 0x0043697e
00436966 : MOV ECX,dword ptr [EBP + 0xc]
00436969 : PUSH ECX
0043696a : MOV EDX,dword ptr [EBX + 0x8]
0043696d : PUSH EDX
0043696e : CALL 0x00438260
00436973 : ADD ESP,0x8
00436976 : MOV ECX,dword ptr [EBX + 0x4]
00436979 : CALL 0x006f04e0
0043697e : MOV EAX,dword ptr [EBP + -0x14]
00436981 : SHL EAX,0x4
00436984 : ADD EAX,EDI
00436986 : MOV dword ptr [EBX + 0xc],EAX
00436989 : SHL ESI,0x4
0043698c : ADD ESI,EDI
0043698e : MOV dword ptr [EBX + 0x8],ESI
00436991 : MOV dword ptr [EBX + 0x4],EDI
00436994 : MOV ECX,dword ptr [EBP + -0xc]
00436997 : MOV dword ptr FS:[0x0],ECX
0043699e : POP ECX
0043699f : POP EDI
004369a0 : POP ESI
004369a1 : POP EBX
004369a2 : MOV ESP,EBP
004369a4 : POP EBP
004369a5 : RET 0x10
004369ed : SUB EDX,dword ptr [EBP + 0xc]
004369f0 : SAR EDX,0x4
004369f3 : CMP EDX,ESI
004369f5 : JNC 0x00436a8a
004369fb : MOV ECX,dword ptr [EBP + 0x14]
004369fe : PUSH ECX
004369ff : LEA EDX,[EBP + -0x2c]
00436a02 : PUSH EDX
00436a03 : CALL 0x00436b10
00436a08 : MOV dword ptr [EBP + -0x4],0x2
00436a0f : MOV EAX,ESI
00436a11 : SHL EAX,0x4
00436a14 : MOV dword ptr [EBP + 0x14],EAX
00436a17 : MOV ECX,dword ptr [EBP + 0xc]
00436a1a : LEA EDX,[EAX + ECX*0x1]
00436a1d : MOV EAX,dword ptr [EBX + 0x8]
00436a20 : PUSH EAX
00436a21 : PUSH ECX
00436a22 : CALL 0x00438120
00436a27 : MOV byte ptr [EBP + -0x4],0x3
00436a2b : MOV EDI,dword ptr [EBX + 0x8]
00436a2e : MOV ECX,EDI
00436a30 : SUB ECX,dword ptr [EBP + 0xc]
00436a33 : SAR ECX,0x4
00436a36 : SUB ESI,ECX
00436a38 : LEA EDX,[EBP + -0x2c]
00436a3b : CALL 0x00437a10
00436a40 : MOV dword ptr [EBP + -0x4],0x2
00436a47 : MOV EAX,dword ptr [EBP + 0x14]
00436a4a : ADD dword ptr [EBX + 0x8],EAX
00436a4d : MOV EBX,dword ptr [EBX + 0x8]
00436a50 : LEA EDX,[EBP + -0x2c]
00436a53 : PUSH EDX
00436a54 : MOV EDI,EBX
00436a56 : SUB EDI,EAX
00436a58 : MOV EAX,dword ptr [EBP + 0xc]
00436a5b : CALL 0x00438150
00436a60 : ADD ESP,0x4
00436a63 : JMP 0x00436ae9
00436a8a : MOV EAX,dword ptr [EBP + 0x14]
00436a8d : PUSH EAX
00436a8e : LEA ECX,[EBP + -0x2c]
00436a91 : PUSH ECX
00436a92 : CALL 0x00436b10
00436a97 : MOV dword ptr [EBP + -0x4],0x5
00436a9e : MOV EDI,dword ptr [EBX + 0x8]
00436aa1 : SHL ESI,0x4
00436aa4 : MOV EAX,ESI
00436aa6 : MOV dword ptr [EBP + 0x14],EAX
00436aa9 : MOV ESI,EDI
00436aab : SUB ESI,EAX
00436aad : PUSH EDI
00436aae : PUSH ESI
00436aaf : MOV EDX,EDI
00436ab1 : CALL 0x00438120
00436ab6 : MOV dword ptr [EBX + 0x8],EAX
00436ab9 : MOV byte ptr [EBP + 0x10],0x0
00436abd : MOV EDX,dword ptr [EBP + 0x10]
00436ac0 : PUSH EDX
00436ac1 : MOV EAX,dword ptr [EBP + 0xc]
00436ac4 : PUSH EAX
00436ac5 : MOV ECX,dword ptr [EBP + 0xc]
00436ac8 : PUSH ECX
00436ac9 : PUSH EDI
00436aca : PUSH ESI
00436acb : MOV EDX,dword ptr [EBP + 0xc]
00436ace : PUSH EDX
00436acf : CALL 0x004382b0
00436ad4 : LEA EAX,[EBP + -0x2c]
00436ad7 : PUSH EAX
00436ad8 : MOV EAX,dword ptr [EBP + 0xc]
00436adb : MOV ECX,dword ptr [EBP + 0x14]
00436ade : LEA EDI,[ECX + EAX*0x1]
00436ae1 : CALL 0x00438150
00436ae6 : ADD ESP,0x1c
00436ae9 : MOV dword ptr [EBP + -0x4],0xffffffff
00436af0 : LEA ESI,[EBP + -0x2c]
00436af3 : CALL 0x004361d0
00436af8 : MOV ECX,dword ptr [EBP + -0xc]
00436afb : MOV dword ptr FS:[0x0],ECX
00436b02 : POP ECX
00436b03 : POP EDI
00436b04 : POP ESI
00436b05 : POP EBX
00436b06 : MOV ESP,EBP
00436b08 : POP EBP
00436b09 : RET 0x10
