PROGRAM  : Maestia.exe
FUNCTION : FUN_00a40ee0
ENTRY    : 00a40ee0
BODY     : [[00a40ee0, 00a41311]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a40ee0(int param_1,int param_2)

{
  code *pcVar1;
  int *piVar2;
  short sVar3;
  int iVar4;
  int *piVar5;
  undefined4 uVar6;
  uint uStack_c4;
  LPCRITICAL_SECTION local_b4;
  int *local_b0;
  int local_ac;
  int *piStack_a8;
  undefined4 uStack_a4;
  int local_a0;
  int local_9c [10];
  int local_74;
  undefined1 uStack_40;
  undefined1 auStack_38 [28];
  uint local_1c;
  void *local_14;
  undefined1 *puStack_10;
  int local_c;
  
  local_c = 0xffffffff;
  puStack_10 = &LAB_00b6837b;
  local_14 = ExceptionList;
  local_1c = DAT_00d66fa0 ^ (uint)&local_b4;
  uStack_c4 = DAT_00d66fa0 ^ (uint)&stack0xffffff40;
  ExceptionList = &local_14;
  local_a0 = param_1;
  if (param_1 == 0) {
    local_74 = 0;
  }
  else {
    local_74 = param_1 + 0x18;
  }
  local_b4 = (LPCRITICAL_SECTION)(local_74 + 4);
  EnterCriticalSection(local_b4);
  local_c = 0;
  local_b0 = (int *)FUN_00a1a840(param_2);
  if (((local_b0 != (int *)0x0) || (local_b0 = (int *)FUN_00a1a6d0(param_2), local_b0 != (int *)0x0)
      ) || (local_b0 = (int *)FUN_00a1a780(param_2), local_b0 != (int *)0x0)) {
    piVar2 = local_b0;
    local_9c[0] = local_b0[2];
    FUN_004437f0(local_9c);
    if (((((local_ac == *(int *)(DAT_00d7c54c + 0x44)) || (*(int *)(local_ac + 0x10) == 0)) ||
         ((*(uint *)(*(int *)(local_ac + 0x10) + 0x4c) & 0x200000) == 0)) &&
        (((*(char *)(param_1 + 0x788) == '\0' || (iVar4 = FUN_00a1c150(piVar2[2]), iVar4 == 0)) ||
         ((*(uint *)(iVar4 + 0xa0) & 0x200) == 0)))) &&
       ((sVar3 = (**(code **)(*piVar2 + 0x1e4))(), sVar3 != 6 &&
        (iVar4 = FUN_00a1a620(param_2), iVar4 == 0)))) {
      piVar5 = (int *)FUN_00b0a530(0x5034e6f);
      if (piVar5 == (int *)0x0) {
        FUN_00406460(L"Alloc failed");
        local_c._0_1_ = 1;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                    (L"AvaGameZone::AddLootingObject",0x73d,local_9c + 3);
        }
        local_c = (uint)local_c._1_3_ << 8;
        FUN_00406560();
      }
      else {
        FUN_00404750(L"%d_LootObject",param_2);
        local_c = CONCAT31(local_c._1_3_,2);
        piVar5[1] = param_2;
        FUN_0088b500();
        local_ac = 0x3f800000;
        piStack_a8 = (int *)0x3f800000;
        uStack_a4 = 0x3f800000;
        local_9c[3] = 0;
        local_9c[4] = 0;
        local_9c[5] = 0;
        local_9c[6] = 0x3f800000;
        local_9c[0] = 0;
        local_9c[1] = 0;
        local_9c[2] = 0;
        uVar6 = (**(code **)(**(int **)(local_a0 + 0x16c) + 0x20))
                          (auStack_38,local_9c,local_9c + 3,&local_ac);
        (**(code **)(*piVar5 + 0x1ec))(uVar6);
        (**(code **)(*piVar5 + 0x2f4))(0,0);
        pcVar1 = *(code **)(*piVar5 + 0x1bc);
        piVar5[0x106] = 0x41200000;
        (*pcVar1)(0);
        (**(code **)(*piVar5 + 8))(piVar2[0x28]);
        pcVar1 = *(code **)(*piVar5 + 0x1e8);
        *(undefined1 *)(piVar5 + 0x10e) = 1;
        (*pcVar1)(0);
        (**(code **)(*piVar5 + 0x2a0))(piVar2[0xfa] + 0x68,1);
        FUN_00406460(L"IDS_PREMIUM_MAIN_CATEGORY3");
        uStack_40 = 3;
        iVar4 = FUN_0081d120(&uStack_c4);
        uStack_40 = 4;
        if (*(uint *)(iVar4 + 0x18) < 8) {
          iVar4 = iVar4 + 4;
        }
        else {
          iVar4 = *(int *)(iVar4 + 4);
        }
        uVar6 = uRam00000010;
        if (uRam00000024 < 8) {
          uVar6 = 0x10;
        }
        FUN_00404750(L"%s %s",uVar6,iVar4);
        uStack_40 = 6;
        FUN_00406560();
        uStack_40 = 7;
        FUN_00406560();
        FUN_004044f0();
        FUN_00889ad0(0,0);
        pcVar1 = *(code **)(*piVar5 + 0x328);
        piVar5[0x31] = 10;
        (*pcVar1)(0);
        *(undefined1 *)((int)piVar5 + 0x1665) = 1;
        if (piVar5[0xfa] != 0) {
          FUN_007d48a0(0,0);
        }
        if ((*(int *)(local_a0 + 600) != 0) && (*(int *)(*(int *)(local_a0 + 600) + 4) == param_2))
        {
          FUN_00a20700();
          *(undefined1 *)(piVar5 + 0x599) = 1;
        }
        local_ac = param_2;
        piStack_a8 = piVar5;
        FUN_00451e00(local_9c,&local_ac);
        local_c._0_1_ = 2;
        FUN_00406560();
        local_c = (uint)local_c._1_3_ << 8;
        FUN_00406560();
      }
    }
  }
  local_c = 0xffffffff;
  LeaveCriticalSection(local_b4);
  ExceptionList = local_14;
  __security_check_cookie(local_1c ^ (uint)&local_b4);
  return;
}



============================================================
DISASSEMBLY
============================================================
00a40ee0 : PUSH EBP
00a40ee1 : MOV EBP,ESP
00a40ee3 : AND ESP,0xfffffff8
00a40ee6 : PUSH -0x1
00a40ee8 : PUSH 0xb6837b
00a40eed : MOV EAX,FS:[0x0]
00a40ef3 : PUSH EAX
00a40ef4 : SUB ESP,0xa0
00a40efa : MOV EAX,[0x00d66fa0]
00a40eff : XOR EAX,ESP
00a40f01 : MOV dword ptr [ESP + 0x98],EAX
00a40f08 : PUSH EBX
00a40f09 : PUSH ESI
00a40f0a : PUSH EDI
00a40f0b : MOV EAX,[0x00d66fa0]
00a40f10 : XOR EAX,ESP
00a40f12 : PUSH EAX
00a40f13 : LEA EAX,[ESP + 0xb0]
00a40f1a : MOV FS:[0x0],EAX
00a40f20 : MOV EBX,dword ptr [EBP + 0x8]
00a40f23 : MOV dword ptr [ESP + 0x24],EBX
00a40f27 : TEST EBX,EBX
00a40f29 : JZ 0x00a40f30
00a40f2b : LEA EAX,[EBX + 0x18]
00a40f2e : JMP 0x00a40f32
00a40f30 : XOR EAX,EAX
00a40f32 : MOV dword ptr [ESP + 0x50],EAX
00a40f36 : ADD EAX,0x4
00a40f39 : PUSH EAX
00a40f3a : MOV dword ptr [ESP + 0x14],EAX
00a40f3e : CALL dword ptr [0x00b85118]
00a40f44 : MOV dword ptr [ESP + 0xb8],0x0
00a40f4f : MOV ESI,dword ptr [EBP + 0xc]
00a40f52 : PUSH ESI
00a40f53 : MOV ECX,EBX
00a40f55 : CALL 0x00a1a840
00a40f5a : MOV EDI,EAX
00a40f5c : MOV dword ptr [ESP + 0x14],EDI
00a40f60 : TEST EDI,EDI
00a40f62 : JNZ 0x00a40f8c
00a40f64 : PUSH ESI
00a40f65 : MOV ECX,EBX
00a40f67 : CALL 0x00a1a6d0
00a40f6c : MOV dword ptr [ESP + 0x14],EAX
00a40f70 : TEST EAX,EAX
00a40f72 : JNZ 0x00a40f88
00a40f74 : PUSH ESI
00a40f75 : MOV ECX,EBX
00a40f77 : CALL 0x00a1a780
00a40f7c : MOV dword ptr [ESP + 0x14],EAX
00a40f80 : TEST EAX,EAX
00a40f82 : JZ 0x00a412fd
00a40f88 : MOV EDI,dword ptr [ESP + 0x14]
00a40f8c : MOV EAX,dword ptr [EDI + 0x8]
00a40f8f : LEA ECX,[ESP + 0x28]
00a40f93 : PUSH ECX
00a40f94 : MOV ECX,dword ptr [0x00d7c54c]
00a40f9a : MOV dword ptr [ESP + 0x2c],EAX
00a40f9e : ADD ECX,0x40
00a40fa1 : LEA EAX,[ESP + 0x1c]
00a40fa5 : CALL 0x004437f0
00a40faa : MOV EDX,dword ptr [0x00d7c54c]
00a40fb0 : MOV EAX,dword ptr [EDX + 0x44]
00a40fb3 : MOV ECX,dword ptr [ESP + 0x18]
00a40fb7 : CMP ECX,EAX
00a40fb9 : JZ 0x00a40fcf
00a40fbb : MOV ECX,dword ptr [ECX + 0x10]
00a40fbe : TEST ECX,ECX
00a40fc0 : JZ 0x00a40fcf
00a40fc2 : TEST dword ptr [ECX + 0x4c],0x200000
00a40fc9 : JNZ 0x00a412fd
00a40fcf : CMP byte ptr [EBX + 0x788],0x0
00a40fd6 : JZ 0x00a40ff3
00a40fd8 : MOV EAX,dword ptr [EDI + 0x8]
00a40fdb : PUSH EAX
00a40fdc : MOV EAX,EBX
00a40fde : CALL 0x00a1c150
00a40fe3 : TEST EAX,EAX
00a40fe5 : JZ 0x00a40ff3
00a40fe7 : TEST dword ptr [EAX + 0xa0],0x200
00a40ff1 : JNZ 0x00a41071
00a40ff3 : MOV EDX,dword ptr [EDI]
00a40ff5 : MOV EAX,dword ptr [EDX + 0x1e4]
00a40ffb : MOV ECX,EDI
00a40ffd : CALL EAX
00a40fff : CMP AX,0x6
00a41003 : JZ 0x00a41071
00a41005 : PUSH ESI
00a41006 : MOV ECX,EBX
00a41008 : CALL 0x00a1a620
00a4100d : TEST EAX,EAX
00a4100f : JNZ 0x00a41071
00a41011 : PUSH 0x5034e6f
00a41016 : CALL 0x00b0a530
00a4101b : MOV EBX,EAX
00a4101d : ADD ESP,0x4
00a41020 : TEST EBX,EBX
00a41022 : JNZ 0x00a410ad
00a41028 : PUSH 0xcbea28
00a4102d : LEA ECX,[ESP + 0x38]
00a41031 : CALL 0x00406460
00a41036 : MOV byte ptr [ESP + 0xb8],0x1
00a4103e : MOV EDX,dword ptr [0x00da98e8]
00a41044 : MOV ECX,dword ptr [EDX]
00a41046 : TEST ECX,ECX
00a41048 : JZ 0x00a41060
00a4104a : MOV EAX,dword ptr [ECX]
00a4104c : MOV EAX,dword ptr [EAX + 0x14]
00a4104f : LEA EDX,[ESP + 0x34]
00a41053 : PUSH EDX
00a41054 : PUSH 0x73d
00a41059 : PUSH 0xcbea44
00a4105e : CALL EAX
00a41060 : MOV byte ptr [ESP + 0xb8],0x0
00a41068 : LEA ECX,[ESP + 0x34]
00a4106c : CALL 0x00406560
00a41071 : MOV dword ptr [ESP + 0xb8],0xffffffff
00a4107c : MOV ECX,dword ptr [ESP + 0x10]
00a41080 : PUSH ECX
00a41081 : CALL dword ptr [0x00b8511c]
00a41087 : MOV ECX,dword ptr [ESP + 0xb0]
00a4108e : MOV dword ptr FS:[0x0],ECX
00a41095 : POP ECX
00a41096 : POP EDI
00a41097 : POP ESI
00a41098 : POP EBX
00a41099 : MOV ECX,dword ptr [ESP + 0x98]
00a410a0 : XOR ECX,ESP
00a410a2 : CALL 0x00633e6b
00a410a7 : MOV ESP,EBP
00a410a9 : POP EBP
00a410aa : RET 0x8
00a410ad : PUSH ESI
00a410ae : PUSH 0xcbea80
00a410b3 : LEA ESI,[ESP + 0x94]
00a410ba : CALL 0x00404750
00a410bf : ADD ESP,0x8
00a410c2 : MOV byte ptr [ESP + 0xb8],0x2
00a410ca : MOV EDX,dword ptr [EBP + 0xc]
00a410cd : MOV EAX,0x5034e6f
00a410d2 : MOV ESI,EBX
00a410d4 : MOV dword ptr [EBX + 0x4],EDX
00a410d7 : CALL 0x0088b500
00a410dc : MOV EAX,dword ptr [ESP + 0x24]
00a410e0 : MOV ECX,dword ptr [EAX + 0x16c]
00a410e6 : XORPS XMM0,XMM0
00a410e9 : MOVSS XMM1,dword ptr [0x00c10fc4]
00a410f1 : LEA EAX,[ESP + 0x18]
00a410f5 : PUSH EAX
00a410f6 : LEA EAX,[ESP + 0x38]
00a410fa : PUSH EAX
00a410fb : LEA EAX,[ESP + 0x30]
00a410ff : PUSH EAX
00a41100 : MOVSS dword ptr [ESP + 0x24],XMM1
00a41106 : MOVSS dword ptr [ESP + 0x28],XMM1
00a4110c : MOVSS dword ptr [ESP + 0x2c],XMM1
00a41112 : MOVSS dword ptr [ESP + 0x40],XMM0
00a41118 : MOVSS dword ptr [ESP + 0x44],XMM0
00a4111e : MOVSS dword ptr [ESP + 0x48],XMM0
00a41124 : MOVSS dword ptr [ESP + 0x4c],XMM1
00a4112a : MOVSS dword ptr [ESP + 0x34],XMM0
00a41130 : MOVSS dword ptr [ESP + 0x38],XMM0
00a41136 : MOVSS dword ptr [ESP + 0x3c],XMM0
00a4113c : MOV EDX,dword ptr [ECX]
00a4113e : MOV EDX,dword ptr [EDX + 0x20]
00a41141 : LEA EAX,[ESP + 0x98]
00a41148 : PUSH EAX
00a41149 : CALL EDX
00a4114b : MOV EDX,dword ptr [EBX]
00a4114d : PUSH EAX
00a4114e : MOV EAX,dword ptr [EDX + 0x1ec]
00a41154 : MOV ECX,EBX
00a41156 : CALL EAX
00a41158 : MOV EDX,dword ptr [EBX]
00a4115a : MOV EAX,dword ptr [EDX + 0x2f4]
00a41160 : PUSH 0x0
00a41162 : PUSH 0x0
00a41164 : MOV ECX,EBX
00a41166 : CALL EAX
00a41168 : MOV EDX,dword ptr [EBX]
00a4116a : MOVSS XMM0,dword ptr [0x00c18874]
00a41172 : MOV EAX,dword ptr [EDX + 0x1bc]
00a41178 : PUSH 0x0
00a4117a : PUSH 0x0
00a4117c : MOV ECX,EBX
00a4117e : MOVSS dword ptr [EBX + 0x418],XMM0
00a41186 : CALL EAX
00a41188 : MOV EAX,dword ptr [EDI + 0xa0]
00a4118e : MOV EDX,dword ptr [EBX]
00a41190 : PUSH EAX
00a41191 : MOV EAX,dword ptr [EDX + 0x8]
00a41194 : MOV ECX,EBX
00a41196 : CALL EAX
00a41198 : MOV EDX,dword ptr [EBX]
00a4119a : MOV EAX,dword ptr [EDX + 0x1e8]
00a411a0 : PUSH 0x0
00a411a2 : MOV ECX,EBX
00a411a4 : MOV byte ptr [EBX + 0x438],0x1
00a411ab : CALL EAX
00a411ad : MOV EAX,dword ptr [EDI + 0x3e8]
00a411b3 : MOV EDX,dword ptr [EBX]
00a411b5 : MOV EDX,dword ptr [EDX + 0x2a0]
00a411bb : PUSH 0x1
00a411bd : ADD EAX,0x68
00a411c0 : PUSH EAX
00a411c1 : MOV ECX,EBX
00a411c3 : CALL EDX
00a411c5 : PUSH 0xcbea9c
00a411ca : LEA ECX,[ESP + 0x38]
00a411ce : CALL 0x00406460
00a411d3 : MOV byte ptr [ESP + 0xb8],0x3
00a411db : MOV ECX,dword ptr [0x0172491c]
00a411e1 : LEA EAX,[ESP + 0x34]
00a411e5 : PUSH EAX
00a411e6 : LEA EDI,[ESP + 0x58]
00a411ea : CALL 0x0081d120
00a411ef : MOV byte ptr [ESP + 0xb8],0x4
00a411f7 : MOV EDX,0x8
00a411fc : CMP dword ptr [EAX + 0x18],EDX
00a411ff : JC 0x00a41206
00a41201 : MOV EAX,dword ptr [EAX + 0x4]
00a41204 : JMP 0x00a41209
00a41206 : ADD EAX,0x4
00a41209 : MOV ECX,dword ptr [ESP + 0x14]
00a4120d : CMP dword ptr [ECX + 0x24],EDX
00a41210 : JC 0x00a41217
00a41212 : MOV ECX,dword ptr [ECX + 0x10]
00a41215 : JMP 0x00a4121a
00a41217 : ADD ECX,0x10
00a4121a : PUSH EAX
00a4121b : PUSH ECX
00a4121c : PUSH 0xcbead4
00a41221 : LEA ESI,[ESP + 0x7c]
00a41225 : CALL 0x00404750
00a4122a : ADD ESP,0xc
00a4122d : MOV byte ptr [ESP + 0xb8],0x6
00a41235 : LEA ECX,[ESP + 0x54]
00a41239 : CALL 0x00406560
00a4123e : MOV byte ptr [ESP + 0xb8],0x7
00a41246 : LEA ECX,[ESP + 0x34]
00a4124a : CALL 0x00406560
00a4124f : MOV ECX,ESI
00a41251 : MOV EDI,EBX
00a41253 : CALL 0x004044f0
00a41258 : PUSH 0x0
00a4125a : PUSH 0x0
00a4125c : MOV ESI,EBX
00a4125e : CALL 0x00889ad0
00a41263 : MOV EDX,dword ptr [EBX]
00a41265 : MOV EAX,dword ptr [EDX + 0x328]
00a4126b : PUSH 0x0
00a4126d : MOV ECX,EBX
00a4126f : MOV dword ptr [EBX + 0xc4],0xa
00a41279 : CALL EAX
00a4127b : MOV ECX,dword ptr [EBX + 0x3e8]
00a41281 : MOV byte ptr [EBX + 0x1665],0x1
00a41288 : TEST ECX,ECX
00a4128a : JZ 0x00a41295
00a4128c : PUSH 0x0
00a4128e : PUSH 0x0
00a41290 : CALL 0x007d48a0
00a41295 : MOV EDI,dword ptr [ESP + 0x24]
00a41299 : MOV EAX,dword ptr [EDI + 0x258]
00a4129f : MOV ESI,dword ptr [EBP + 0xc]
00a412a2 : TEST EAX,EAX
00a412a4 : JZ 0x00a412bb
00a412a6 : CMP dword ptr [EAX + 0x4],ESI
00a412a9 : JNZ 0x00a412bb
00a412ab : MOV EAX,ESI
00a412ad : MOV ECX,EDI
00a412af : CALL 0x00a20700
00a412b4 : MOV byte ptr [EBX + 0x1664],0x1
00a412bb : LEA ECX,[ESP + 0x18]
00a412bf : PUSH ECX
00a412c0 : LEA EDX,[ESP + 0x2c]
00a412c4 : PUSH EDX
00a412c5 : LEA EAX,[EDI + 0xd4]
00a412cb : MOV dword ptr [ESP + 0x20],ESI
00a412cf : MOV dword ptr [ESP + 0x24],EBX
00a412d3 : CALL 0x00451e00
00a412d8 : MOV byte ptr [ESP + 0xb8],0x2
00a412e0 : LEA ECX,[ESP + 0x70]
00a412e4 : CALL 0x00406560
00a412e9 : MOV byte ptr [ESP + 0xb8],0x0
00a412f1 : LEA ECX,[ESP + 0x8c]
00a412f8 : CALL 0x00406560
00a412fd : MOV dword ptr [ESP + 0xb8],0xffffffff
00a41308 : MOV EAX,dword ptr [ESP + 0x10]
00a4130c : PUSH EAX
00a4130d : JMP 0x00a41081
