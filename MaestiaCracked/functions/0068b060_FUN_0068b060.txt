PROGRAM  : Maestia.exe
FUNCTION : FUN_0068b060
ENTRY    : 0068b060
BODY     : [[0068b060, 0068b35f]]

============================================================
DECOMPILED C CODE
============================================================

uint FUN_0068b060(undefined4 *param_1,uint *param_2,int param_3,int *param_4)

{
  short sVar1;
  uint uVar2;
  int iVar3;
  short *psVar4;
  uint uVar5;
  undefined4 *puVar6;
  int iVar7;
  undefined4 uVar8;
  int iVar9;
  char local_19;
  int local_18;
  undefined4 local_14;
  uint local_10;
  undefined4 *local_c;
  undefined4 *local_8;
  undefined4 local_4;
  
  iVar9 = 0;
  local_18 = 0;
  if (((param_4 == (int *)0x0) && (-1 < param_3)) || (param_2 == (uint *)0x0)) {
    return 6;
  }
  if (((*param_2 & 2) == 0) || (local_19 = '\x01', param_2[4] == 0)) {
    local_19 = '\0';
  }
  uVar2 = FUN_00688da0(param_1,param_2,&local_14);
  uVar8 = local_14;
  if (uVar2 == 0) {
    local_4 = *param_1;
    if (((*param_2 & 8) == 0) || ((undefined4 *)param_2[5] == (undefined4 *)0x0)) {
      local_c = param_1 + 7;
      puVar6 = local_c + param_1[6];
      local_8 = puVar6;
      if (local_c < puVar6) {
        do {
          uVar8 = local_14;
          if ((**(byte **)*local_c & 1) != 0) {
            uVar2 = 0;
            uVar5 = 0;
            if ((*param_2 & 0x10) != 0) {
              uVar2 = param_2[6];
              uVar5 = param_2[7];
            }
            uVar2 = FUN_00689410(local_14,param_3,uVar2,uVar5,&local_18);
            local_10 = uVar2;
            if (uVar2 == 0) goto LAB_0068b206;
            puVar6 = local_8;
            iVar9 = local_18;
            if ((char)uVar2 != '\x02') break;
          }
          local_c = local_c + 1;
          uVar8 = local_14;
          iVar9 = local_18;
        } while (local_c < puVar6);
      }
      goto LAB_0068b1b1;
    }
    if ((**(byte **)param_2[5] & 1) == 0) {
      uVar2 = 0x20;
    }
    else {
      uVar2 = 0;
      uVar5 = 0;
      if ((*param_2 & 0x10) != 0) {
        uVar2 = param_2[6];
        uVar5 = param_2[7];
      }
      uVar2 = FUN_00689410(local_14,param_3,uVar2,uVar5,&local_18);
      iVar9 = local_18;
      local_10 = uVar2;
      if (uVar2 == 0) {
LAB_0068b206:
        iVar9 = local_18;
        if (local_19 != '\0') {
          *(uint *)(local_18 + 8) = *(uint *)(local_18 + 8) | 0x400;
        }
        iVar3 = FUN_00688c00(local_4,0xc,&local_10);
        uVar2 = local_10;
        if (local_10 == 0) {
          *(int *)(iVar3 + 8) = iVar9;
          FUN_00688050(*(int *)(iVar9 + 0x60) + 0x18,iVar3);
          if (-1 < param_3) {
            uVar2 = FUN_00688f50(iVar9,0);
            if ((uVar2 != 0) || (uVar2 = FUN_006899a0(iVar9,&local_4), uVar2 != 0))
            goto LAB_0068b34d;
            *(undefined4 *)(iVar9 + 0x58) = local_4;
          }
          if ((*(byte *)(iVar9 + 8) & 1) != 0) {
            if (*(short *)(iVar9 + 0x4a) < 0) {
              *(short *)(iVar9 + 0x4a) = -*(short *)(iVar9 + 0x4a);
            }
            if ((*(byte *)(iVar9 + 8) & 0x20) == 0) {
              *(undefined2 *)(iVar9 + 0x4e) = *(undefined2 *)(iVar9 + 0x4a);
            }
          }
          if (((*(byte *)(iVar9 + 8) & 2) != 0) && (iVar3 = 0, 0 < *(int *)(iVar9 + 0x1c))) {
            iVar7 = 0;
            do {
              sVar1 = *(short *)(*(int *)(iVar9 + 0x20) + iVar7);
              psVar4 = (short *)(*(int *)(iVar9 + 0x20) + iVar7);
              if (sVar1 < 0) {
                *psVar4 = -sVar1;
              }
              if (*(int *)(psVar4 + 4) < 0) {
                *(int *)(psVar4 + 4) = (int)-psVar4[4];
              }
              if (*(int *)(psVar4 + 6) < 0) {
                *(int *)(psVar4 + 6) = -*(int *)(psVar4 + 6);
              }
              iVar3 = iVar3 + 1;
              iVar7 = iVar7 + 0x10;
            } while (iVar3 < *(int *)(iVar9 + 0x1c));
          }
          iVar3 = *(int *)(iVar9 + 0x80);
          *(undefined4 *)(iVar3 + 4) = 0x10000;
          *(undefined4 *)(iVar3 + 8) = 0;
          *(undefined4 *)(iVar3 + 0xc) = 0;
          *(undefined4 *)(iVar3 + 0x10) = 0x10000;
          *(undefined4 *)(iVar3 + 0x14) = 0;
          *(undefined4 *)(iVar3 + 0x18) = 0;
          if (param_4 != (int *)0x0) {
            *param_4 = iVar9;
            return uVar2;
          }
        }
        goto LAB_0068b34d;
      }
    }
  }
  else {
LAB_0068b1b1:
    uVar5 = uVar2 & 0xff;
    local_14 = uVar8;
    if (((uVar5 == 0x51) || (uVar5 == 2)) || (uVar5 == 0x55)) {
      uVar2 = FUN_0068b000(param_3,param_2);
      if (uVar2 == 0) {
        FUN_00688210(uVar8,local_19);
        return 0;
      }
      if ((char)uVar2 == '\x02') {
        uVar2 = 2;
      }
    }
  }
  FUN_00688210(local_14,local_19);
LAB_0068b34d:
  FUN_00689940(iVar9);
  return uVar2;
}



============================================================
DISASSEMBLY
============================================================
0068b060 : SUB ESP,0x1c
0068b063 : PUSH ESI
0068b064 : PUSH EDI
0068b065 : XOR EDI,EDI
0068b067 : MOV dword ptr [ESP + 0xc],EDI
0068b06b : CMP dword ptr [ESP + 0x34],EDI
0068b06f : JNZ 0x0068b077
0068b071 : CMP dword ptr [ESP + 0x30],EDI
0068b075 : JGE 0x0068b07f
0068b077 : MOV ESI,dword ptr [ESP + 0x2c]
0068b07b : TEST ESI,ESI
0068b07d : JNZ 0x0068b08a
0068b07f : POP EDI
0068b080 : MOV EAX,0x6
0068b085 : POP ESI
0068b086 : ADD ESP,0x1c
0068b089 : RET
0068b08a : TEST byte ptr [ESI],0x2
0068b08d : JZ 0x0068b099
0068b08f : MOV byte ptr [ESP + 0xb],0x1
0068b094 : CMP dword ptr [ESI + 0x10],EDI
0068b097 : JNZ 0x0068b09e
0068b099 : MOV byte ptr [ESP + 0xb],0x0
0068b09e : PUSH EBX
0068b09f : PUSH EBP
0068b0a0 : MOV EBP,dword ptr [ESP + 0x30]
0068b0a4 : LEA EAX,[ESP + 0x18]
0068b0a8 : PUSH EAX
0068b0a9 : PUSH ESI
0068b0aa : PUSH EBP
0068b0ab : CALL 0x00688da0
0068b0b0 : MOV EBX,EAX
0068b0b2 : ADD ESP,0xc
0068b0b5 : TEST EBX,EBX
0068b0b7 : JNZ 0x0068b1ad
0068b0bd : MOV EAX,dword ptr [ESI]
0068b0bf : MOV ECX,dword ptr [EBP]
0068b0c2 : MOV dword ptr [ESP + 0x28],ECX
0068b0c6 : TEST AL,0x8
0068b0c8 : JZ 0x0068b13d
0068b0ca : MOV EBP,dword ptr [ESI + 0x14]
0068b0cd : TEST EBP,EBP
0068b0cf : JZ 0x0068b139
0068b0d1 : MOV EDX,dword ptr [EBP]
0068b0d4 : TEST byte ptr [EDX],0x1
0068b0d7 : JZ 0x0068b124
0068b0d9 : XOR ECX,ECX
0068b0db : XOR EDX,EDX
0068b0dd : TEST AL,0x10
0068b0df : JZ 0x0068b0e7
0068b0e1 : MOV ECX,dword ptr [ESI + 0x18]
0068b0e4 : MOV EDX,dword ptr [ESI + 0x1c]
0068b0e7 : LEA EAX,[ESP + 0x14]
0068b0eb : PUSH EAX
0068b0ec : PUSH EDX
0068b0ed : MOV EDX,dword ptr [ESP + 0x20]
0068b0f1 : PUSH ECX
0068b0f2 : MOV ECX,dword ptr [ESP + 0x44]
0068b0f6 : PUSH ECX
0068b0f7 : PUSH EDX
0068b0f8 : MOV EAX,EBP
0068b0fa : CALL 0x00689410
0068b0ff : MOV EBX,EAX
0068b101 : ADD ESP,0x14
0068b104 : MOV dword ptr [ESP + 0x1c],EBX
0068b108 : TEST EBX,EBX
0068b10a : JZ 0x0068b206
0068b110 : MOVZX EAX,byte ptr [ESP + 0x13]
0068b115 : MOV ECX,dword ptr [ESP + 0x18]
0068b119 : MOV EDI,dword ptr [ESP + 0x14]
0068b11d : PUSH EAX
0068b11e : PUSH ECX
0068b11f : JMP 0x0068b345
0068b124 : MOVZX EAX,byte ptr [ESP + 0x13]
0068b129 : MOV ECX,dword ptr [ESP + 0x18]
0068b12d : PUSH EAX
0068b12e : MOV EBX,0x20
0068b133 : PUSH ECX
0068b134 : JMP 0x0068b345
0068b139 : MOV EBP,dword ptr [ESP + 0x30]
0068b13d : MOV EDX,dword ptr [EBP + 0x18]
0068b140 : LEA ECX,[EBP + 0x1c]
0068b143 : LEA EDX,[ECX + EDX*0x4]
0068b146 : MOV dword ptr [ESP + 0x20],ECX
0068b14a : MOV dword ptr [ESP + 0x24],EDX
0068b14e : CMP ECX,EDX
0068b150 : JNC 0x0068b1ad
0068b152 : MOV EAX,dword ptr [ECX]
0068b154 : MOV EDI,dword ptr [EAX]
0068b156 : TEST byte ptr [EDI],0x1
0068b159 : JZ 0x0068b19e
0068b15b : XOR ECX,ECX
0068b15d : XOR EDX,EDX
0068b15f : TEST byte ptr [ESI],0x10
0068b162 : JZ 0x0068b16a
0068b164 : MOV ECX,dword ptr [ESI + 0x18]
0068b167 : MOV EDX,dword ptr [ESI + 0x1c]
0068b16a : MOV EBP,dword ptr [ESP + 0x18]
0068b16e : LEA EDI,[ESP + 0x14]
0068b172 : PUSH EDI
0068b173 : PUSH EDX
0068b174 : PUSH ECX
0068b175 : MOV ECX,dword ptr [ESP + 0x44]
0068b179 : PUSH ECX
0068b17a : PUSH EBP
0068b17b : CALL 0x00689410
0068b180 : MOV EBX,EAX
0068b182 : ADD ESP,0x14
0068b185 : MOV dword ptr [ESP + 0x1c],EBX
0068b189 : TEST EBX,EBX
0068b18b : JZ 0x0068b206
0068b18d : CMP BL,0x2
0068b190 : JNZ 0x0068b32b
0068b196 : MOV EDX,dword ptr [ESP + 0x24]
0068b19a : MOV ECX,dword ptr [ESP + 0x20]
0068b19e : ADD ECX,0x4
0068b1a1 : MOV dword ptr [ESP + 0x20],ECX
0068b1a5 : CMP ECX,EDX
0068b1a7 : JC 0x0068b152
0068b1a9 : MOV EDI,dword ptr [ESP + 0x14]
0068b1ad : MOV EBP,dword ptr [ESP + 0x18]
0068b1b1 : MOV EAX,EBX
0068b1b3 : AND EAX,0xff
0068b1b8 : CMP EAX,0x51
0068b1bb : JZ 0x0068b1cb
0068b1bd : CMP EAX,0x2
0068b1c0 : JZ 0x0068b1cb
0068b1c2 : CMP EAX,0x55
0068b1c5 : JNZ 0x0068b33e
0068b1cb : MOV EDX,dword ptr [ESP + 0x38]
0068b1cf : MOV EAX,dword ptr [ESP + 0x3c]
0068b1d3 : PUSH ESI
0068b1d4 : PUSH EDX
0068b1d5 : MOV EDX,dword ptr [ESP + 0x38]
0068b1d9 : MOV ECX,EBP
0068b1db : CALL 0x0068b000
0068b1e0 : MOV EBX,EAX
0068b1e2 : ADD ESP,0x8
0068b1e5 : TEST EBX,EBX
0068b1e7 : JNZ 0x0068b334
0068b1ed : MOVZX EAX,byte ptr [ESP + 0x13]
0068b1f2 : PUSH EAX
0068b1f3 : PUSH EBP
0068b1f4 : CALL 0x00688210
0068b1f9 : ADD ESP,0x8
0068b1fc : POP EBP
0068b1fd : POP EBX
0068b1fe : POP EDI
0068b1ff : XOR EAX,EAX
0068b201 : POP ESI
0068b202 : ADD ESP,0x1c
0068b205 : RET
0068b206 : CMP byte ptr [ESP + 0x13],0x0
0068b20b : MOV EDI,dword ptr [ESP + 0x14]
0068b20f : JZ 0x0068b218
0068b211 : OR dword ptr [EDI + 0x8],0x400
0068b218 : MOV EAX,dword ptr [ESP + 0x28]
0068b21c : LEA EDX,[ESP + 0x1c]
0068b220 : PUSH EDX
0068b221 : PUSH 0xc
0068b223 : PUSH EAX
0068b224 : CALL 0x00688c00
0068b229 : MOV EBX,dword ptr [ESP + 0x28]
0068b22d : XOR EBP,EBP
0068b22f : ADD ESP,0xc
0068b232 : CMP EBX,EBP
0068b234 : JNZ 0x0068b34d
0068b23a : MOV dword ptr [EAX + 0x8],EDI
0068b23d : MOV ECX,dword ptr [EDI + 0x60]
0068b240 : PUSH EAX
0068b241 : ADD ECX,0x18
0068b244 : PUSH ECX
0068b245 : CALL 0x00688050
0068b24a : ADD ESP,0x8
0068b24d : CMP dword ptr [ESP + 0x38],EBP
0068b251 : JL 0x0068b286
0068b253 : PUSH EBP
0068b254 : PUSH EDI
0068b255 : CALL 0x00688f50
0068b25a : MOV EBX,EAX
0068b25c : ADD ESP,0x8
0068b25f : CMP EBX,EBP
0068b261 : JNZ 0x0068b34d
0068b267 : LEA EDX,[ESP + 0x28]
0068b26b : PUSH EDX
0068b26c : PUSH EDI
0068b26d : CALL 0x006899a0
0068b272 : MOV EBX,EAX
0068b274 : ADD ESP,0x8
0068b277 : CMP EBX,EBP
0068b279 : JNZ 0x0068b34d
0068b27f : MOV EAX,dword ptr [ESP + 0x28]
0068b283 : MOV dword ptr [EDI + 0x58],EAX
0068b286 : TEST byte ptr [EDI + 0x8],0x1
0068b28a : JZ 0x0068b2ab
0068b28c : CMP word ptr [EDI + 0x4a],BP
0068b290 : JGE 0x0068b29d
0068b292 : MOV CX,word ptr [EDI + 0x4a]
0068b296 : NEG CX
0068b299 : MOV word ptr [EDI + 0x4a],CX
0068b29d : TEST byte ptr [EDI + 0x8],0x20
0068b2a1 : JNZ 0x0068b2ab
0068b2a3 : MOV DX,word ptr [EDI + 0x4a]
0068b2a7 : MOV word ptr [EDI + 0x4e],DX
0068b2ab : TEST byte ptr [EDI + 0x8],0x2
0068b2af : JZ 0x0068b2fa
0068b2b1 : XOR ESI,ESI
0068b2b3 : CMP dword ptr [EDI + 0x1c],EBP
0068b2b6 : JLE 0x0068b2fa
0068b2b8 : XOR EDX,EDX
0068b2ba : LEA EBX,[EBX]
0068b2c0 : MOV EAX,dword ptr [EDI + 0x20]
0068b2c3 : MOVZX ECX,word ptr [EAX + EDX*0x1]
0068b2c7 : ADD EAX,EDX
0068b2c9 : CMP CX,BP
0068b2cc : JGE 0x0068b2d3
0068b2ce : NEG ECX
0068b2d0 : MOV word ptr [EAX],CX
0068b2d3 : CMP dword ptr [EAX + 0x8],EBP
0068b2d6 : JGE 0x0068b2e5
0068b2d8 : MOV CX,word ptr [EAX + 0x8]
0068b2dc : NEG CX
0068b2df : MOVSX ECX,CX
0068b2e2 : MOV dword ptr [EAX + 0x8],ECX
0068b2e5 : MOV ECX,dword ptr [EAX + 0xc]
0068b2e8 : CMP ECX,EBP
0068b2ea : JGE 0x0068b2f1
0068b2ec : NEG ECX
0068b2ee : MOV dword ptr [EAX + 0xc],ECX
0068b2f1 : INC ESI
0068b2f2 : ADD EDX,0x10
0068b2f5 : CMP ESI,dword ptr [EDI + 0x1c]
0068b2f8 : JL 0x0068b2c0
0068b2fa : MOV EAX,dword ptr [EDI + 0x80]
0068b300 : MOV ECX,0x10000
0068b305 : MOV dword ptr [EAX + 0x4],ECX
0068b308 : MOV dword ptr [EAX + 0x8],EBP
0068b30b : MOV dword ptr [EAX + 0xc],EBP
0068b30e : MOV dword ptr [EAX + 0x10],ECX
0068b311 : MOV dword ptr [EAX + 0x14],EBP
0068b314 : MOV dword ptr [EAX + 0x18],EBP
0068b317 : MOV EAX,dword ptr [ESP + 0x3c]
0068b31b : CMP EAX,EBP
0068b31d : JZ 0x0068b34d
0068b31f : POP EBP
0068b320 : MOV dword ptr [EAX],EDI
0068b322 : MOV EAX,EBX
0068b324 : POP EBX
0068b325 : POP EDI
0068b326 : POP ESI
0068b327 : ADD ESP,0x1c
0068b32a : RET
0068b32b : MOV EDI,dword ptr [ESP + 0x14]
0068b32f : JMP 0x0068b1b1
0068b334 : CMP BL,0x2
0068b337 : JNZ 0x0068b33e
0068b339 : MOV EBX,0x2
0068b33e : MOVZX ECX,byte ptr [ESP + 0x13]
0068b343 : PUSH ECX
0068b344 : PUSH EBP
0068b345 : CALL 0x00688210
0068b34a : ADD ESP,0x8
0068b34d : PUSH EDI
0068b34e : CALL 0x00689940
0068b353 : ADD ESP,0x4
0068b356 : POP EBP
0068b357 : MOV EAX,EBX
0068b359 : POP EBX
0068b35a : POP EDI
0068b35b : POP ESI
0068b35c : ADD ESP,0x1c
0068b35f : RET
