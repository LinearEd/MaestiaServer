PROGRAM  : Maestia.exe
FUNCTION : FUN_006a8650
ENTRY    : 006a8650
BODY     : [[006a8650, 006a8897]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006a8650(undefined4 param_1,undefined4 *param_2,int param_3)

{
  char cVar1;
  char cVar2;
  byte bVar3;
  short sVar4;
  short sVar5;
  short sVar6;
  undefined4 uVar7;
  int iVar8;
  byte *pbVar9;
  byte *pbVar10;
  char *pcVar11;
  byte *pbVar12;
  char *pcVar13;
  bool bVar14;
  
  *param_2 = 1;
  if (param_2[0x22] == 0) {
    uVar7 = FUN_00686de0(*(undefined4 *)(param_2[0x18] + 4),"psaux");
    param_2[0x22] = uVar7;
  }
  if (param_2[0x50] == 0) {
    uVar7 = FUN_00686de0(*(undefined4 *)(param_2[0x18] + 4),"pshinter");
    param_2[0x50] = uVar7;
  }
  iVar8 = FUN_006877c0(param_1,0);
  if (iVar8 != 0) {
    return iVar8;
  }
  iVar8 = FUN_006a8270(param_3);
  if (iVar8 != 0) {
    return iVar8;
  }
  if (param_3 < 0) {
    return 0;
  }
  if (param_3 != 0) {
    return 6;
  }
  param_2[4] = param_2[0x4a];
  param_2[9] = 0;
  param_2[1] = 0;
  param_2[2] = 0x811;
  if (*(char *)(param_2 + 0x2f) != '\0') {
    param_2[2] = 0x815;
  }
  pcVar13 = (char *)param_2[0x2c];
  param_2[5] = pcVar13;
  param_2[6] = "Regular";
  if (pcVar13 == (char *)0x0) {
    if (param_2[0x23] != 0) {
      param_2[5] = param_2[0x23];
    }
  }
  else {
    pcVar11 = (char *)param_2[0x2b];
    if (pcVar11 != (char *)0x0) {
      cVar1 = *pcVar11;
      while (cVar1 != '\0') {
        cVar2 = *pcVar13;
        if (cVar1 == cVar2) {
          pcVar13 = pcVar13 + 1;
LAB_006a8739:
          pcVar11 = pcVar11 + 1;
        }
        else {
          if ((cVar1 == ' ') || (cVar1 == '-')) goto LAB_006a8739;
          if ((cVar2 != ' ') && (cVar2 != '-')) {
            if (*pcVar13 == '\0') {
              param_2[6] = pcVar11;
            }
            break;
          }
          pcVar13 = pcVar13 + 1;
        }
        cVar1 = *pcVar11;
      }
    }
  }
  param_2[3] = 0;
  if (param_2[0x2e] != 0) {
    param_2[3] = 1;
  }
  pbVar10 = (byte *)param_2[0x2d];
  if (pbVar10 != (byte *)0x0) {
    pbVar12 = &DAT_00bd91cc;
    pbVar9 = pbVar10;
    do {
      bVar3 = *pbVar9;
      bVar14 = bVar3 < *pbVar12;
      if (bVar3 != *pbVar12) {
LAB_006a87b0:
        iVar8 = (1 - (uint)bVar14) - (uint)(bVar14 != 0);
        goto LAB_006a87b5;
      }
      if (bVar3 == 0) break;
      bVar3 = pbVar9[1];
      bVar14 = bVar3 < pbVar12[1];
      if (bVar3 != pbVar12[1]) goto LAB_006a87b0;
      pbVar9 = pbVar9 + 2;
      pbVar12 = pbVar12 + 2;
    } while (bVar3 != 0);
    iVar8 = 0;
LAB_006a87b5:
    if (iVar8 != 0) {
      pcVar13 = "Black";
      do {
        bVar3 = *pbVar10;
        bVar14 = bVar3 < (byte)*pcVar13;
        if (bVar3 != *pcVar13) {
LAB_006a87e0:
          iVar8 = (1 - (uint)bVar14) - (uint)(bVar14 != 0);
          goto LAB_006a87e5;
        }
        if (bVar3 == 0) break;
        bVar3 = pbVar10[1];
        bVar14 = bVar3 < ((byte *)pcVar13)[1];
        if (bVar3 != ((byte *)pcVar13)[1]) goto LAB_006a87e0;
        pbVar10 = pbVar10 + 2;
        pcVar13 = (char *)((byte *)pcVar13 + 2);
      } while (bVar3 != 0);
      iVar8 = 0;
LAB_006a87e5:
      if (iVar8 != 0) goto LAB_006a87ed;
    }
    param_2[3] = param_2[3] | 2;
  }
LAB_006a87ed:
  param_2[7] = 0;
  param_2[8] = 0;
  param_2[0xd] = (int)*(short *)((int)param_2 + 0xc6);
  param_2[0xe] = (int)*(short *)((int)param_2 + 0xca);
  param_2[0xf] = param_2[0x33] + 0xffff >> 0x10;
  param_2[0x10] = param_2[0x34] + 0xffff >> 0x10;
  if (*(short *)(param_2 + 0x11) == 0) {
    *(undefined2 *)(param_2 + 0x11) = 1000;
  }
  sVar4 = *(short *)(param_2 + 0xe);
  sVar6 = (short)(((uint)*(ushort *)(param_2 + 0x11) * 0xc) / 10);
  sVar5 = (short)(param_2[0x34] + 0xffff >> 0x10);
  *(short *)((int)param_2 + 0x4a) = sVar6;
  *(short *)((int)param_2 + 0x46) = sVar5;
  *(short *)(param_2 + 0x12) = sVar4;
  if ((int)sVar6 < (int)sVar5 - (int)sVar4) {
    *(short *)((int)param_2 + 0x4a) = sVar5 - sVar4;
  }
  *(undefined2 *)(param_2 + 0x14) = *(undefined2 *)((int)param_2 + 0xbe);
  *(undefined2 *)((int)param_2 + 0x52) = *(undefined2 *)(param_2 + 0x30);
  return 0;
}



============================================================
DISASSEMBLY
============================================================
006a8650 : PUSH EBX
006a8651 : MOV EBX,dword ptr [ESP + 0xc]
006a8655 : CMP dword ptr [EBX + 0x88],0x0
006a865c : MOV dword ptr [EBX],0x1
006a8662 : JNZ 0x006a867e
006a8664 : MOV EAX,dword ptr [EBX + 0x60]
006a8667 : MOV ECX,dword ptr [EAX + 0x4]
006a866a : PUSH 0xbe8af8
006a866f : PUSH ECX
006a8670 : CALL 0x00686de0
006a8675 : ADD ESP,0x8
006a8678 : MOV dword ptr [EBX + 0x88],EAX
006a867e : CMP dword ptr [EBX + 0x140],0x0
006a8685 : JNZ 0x006a86a1
006a8687 : MOV EDX,dword ptr [EBX + 0x60]
006a868a : MOV EAX,dword ptr [EDX + 0x4]
006a868d : PUSH 0xbd9944
006a8692 : PUSH EAX
006a8693 : CALL 0x00686de0
006a8698 : ADD ESP,0x8
006a869b : MOV dword ptr [EBX + 0x140],EAX
006a86a1 : MOV ECX,dword ptr [ESP + 0x8]
006a86a5 : PUSH 0x0
006a86a7 : PUSH ECX
006a86a8 : CALL 0x006877c0
006a86ad : ADD ESP,0x8
006a86b0 : TEST EAX,EAX
006a86b2 : JNZ 0x006a8896
006a86b8 : PUSH EBP
006a86b9 : PUSH ESI
006a86ba : MOV ESI,dword ptr [ESP + 0x18]
006a86be : PUSH ESI
006a86bf : CALL 0x006a8270
006a86c4 : MOV EBP,EAX
006a86c6 : XOR EDX,EDX
006a86c8 : ADD ESP,0x4
006a86cb : CMP EBP,EDX
006a86cd : JNZ 0x006a8892
006a86d3 : CMP ESI,EDX
006a86d5 : JL 0x006a8892
006a86db : JZ 0x006a86e4
006a86dd : POP ESI
006a86de : POP EBP
006a86df : LEA EAX,[EDX + 0x6]
006a86e2 : POP EBX
006a86e3 : RET
006a86e4 : MOV EAX,dword ptr [EBX + 0x128]
006a86ea : MOV dword ptr [EBX + 0x10],EAX
006a86ed : MOV dword ptr [EBX + 0x24],EDX
006a86f0 : MOV dword ptr [EBX + 0x4],EDX
006a86f3 : MOV dword ptr [EBX + 0x8],0x811
006a86fa : CMP byte ptr [EBX + 0xbc],DL
006a8700 : JZ 0x006a8709
006a8702 : MOV dword ptr [EBX + 0x8],0x815
006a8709 : MOV ECX,dword ptr [EBX + 0xb0]
006a870f : MOV EAX,ECX
006a8711 : PUSH EDI
006a8712 : MOV dword ptr [EBX + 0x14],ECX
006a8715 : MOV dword ptr [EBX + 0x18],0xbd91c4
006a871c : CMP EAX,EDX
006a871e : JZ 0x006a8760
006a8720 : MOV ESI,dword ptr [EBX + 0xac]
006a8726 : MOV EDI,EAX
006a8728 : CMP ESI,EDX
006a872a : JZ 0x006a876d
006a872c : MOV AL,byte ptr [ESI]
006a872e : CMP AL,DL
006a8730 : JZ 0x006a876d
006a8732 : MOV CL,byte ptr [EDI]
006a8734 : CMP AL,CL
006a8736 : JNZ 0x006a8742
006a8738 : INC EDI
006a8739 : INC ESI
006a873a : MOV AL,byte ptr [ESI]
006a873c : CMP AL,DL
006a873e : JNZ 0x006a8732
006a8740 : JMP 0x006a876d
006a8742 : CMP AL,0x20
006a8744 : JZ 0x006a8739
006a8746 : CMP AL,0x2d
006a8748 : JZ 0x006a8739
006a874a : CMP CL,0x20
006a874d : JZ 0x006a8754
006a874f : CMP CL,0x2d
006a8752 : JNZ 0x006a8757
006a8754 : INC EDI
006a8755 : JMP 0x006a873a
006a8757 : CMP byte ptr [EDI],DL
006a8759 : JNZ 0x006a876d
006a875b : MOV dword ptr [EBX + 0x18],ESI
006a875e : JMP 0x006a876d
006a8760 : MOV EAX,dword ptr [EBX + 0x8c]
006a8766 : CMP EAX,EDX
006a8768 : JZ 0x006a876d
006a876a : MOV dword ptr [EBX + 0x14],EAX
006a876d : MOV dword ptr [EBX + 0xc],EDX
006a8770 : CMP dword ptr [EBX + 0xb8],EDX
006a8776 : JZ 0x006a877f
006a8778 : MOV dword ptr [EBX + 0xc],0x1
006a877f : MOV EDI,dword ptr [EBX + 0xb4]
006a8785 : CMP EDI,EDX
006a8787 : JZ 0x006a87ed
006a8789 : MOV ESI,0xbd91cc
006a878e : MOV EAX,EDI
006a8790 : MOV CL,byte ptr [EAX]
006a8792 : CMP CL,byte ptr [ESI]
006a8794 : JNZ 0x006a87b0
006a8796 : CMP CL,DL
006a8798 : JZ 0x006a87ac
006a879a : MOV CL,byte ptr [EAX + 0x1]
006a879d : CMP CL,byte ptr [ESI + 0x1]
006a87a0 : JNZ 0x006a87b0
006a87a2 : ADD EAX,0x2
006a87a5 : ADD ESI,0x2
006a87a8 : CMP CL,DL
006a87aa : JNZ 0x006a8790
006a87ac : XOR EAX,EAX
006a87ae : JMP 0x006a87b5
006a87b0 : SBB EAX,EAX
006a87b2 : SBB EAX,-0x1
006a87b5 : CMP EAX,EDX
006a87b7 : JZ 0x006a87e9
006a87b9 : MOV ESI,0xbea1b0
006a87be : MOV EAX,EDI
006a87c0 : MOV CL,byte ptr [EAX]
006a87c2 : CMP CL,byte ptr [ESI]
006a87c4 : JNZ 0x006a87e0
006a87c6 : CMP CL,DL
006a87c8 : JZ 0x006a87dc
006a87ca : MOV CL,byte ptr [EAX + 0x1]
006a87cd : CMP CL,byte ptr [ESI + 0x1]
006a87d0 : JNZ 0x006a87e0
006a87d2 : ADD EAX,0x2
006a87d5 : ADD ESI,0x2
006a87d8 : CMP CL,DL
006a87da : JNZ 0x006a87c0
006a87dc : XOR EAX,EAX
006a87de : JMP 0x006a87e5
006a87e0 : SBB EAX,EAX
006a87e2 : SBB EAX,-0x1
006a87e5 : CMP EAX,EDX
006a87e7 : JNZ 0x006a87ed
006a87e9 : OR dword ptr [EBX + 0xc],0x2
006a87ed : MOV dword ptr [EBX + 0x1c],EDX
006a87f0 : MOV dword ptr [EBX + 0x20],EDX
006a87f3 : MOVSX EAX,word ptr [EBX + 0xc6]
006a87fa : MOV dword ptr [EBX + 0x34],EAX
006a87fd : MOVSX ECX,word ptr [EBX + 0xca]
006a8804 : MOV dword ptr [EBX + 0x38],ECX
006a8807 : MOV EAX,dword ptr [EBX + 0xcc]
006a880d : ADD EAX,0xffff
006a8812 : SHR EAX,0x10
006a8815 : MOV dword ptr [EBX + 0x3c],EAX
006a8818 : MOV ECX,dword ptr [EBX + 0xd0]
006a881e : ADD ECX,0xffff
006a8824 : SHR ECX,0x10
006a8827 : MOV dword ptr [EBX + 0x40],ECX
006a882a : CMP word ptr [EBX + 0x44],DX
006a882e : JNZ 0x006a8839
006a8830 : MOV EDX,0x3e8
006a8835 : MOV word ptr [EBX + 0x44],DX
006a8839 : MOVZX EAX,word ptr [EBX + 0x44]
006a883d : MOVZX ESI,word ptr [EBX + 0x38]
006a8841 : LEA EDX,[EAX + EAX*0x2]
006a8844 : ADD EDX,EDX
006a8846 : ADD EDX,EDX
006a8848 : MOV EAX,0x66666667
006a884d : IMUL EDX
006a884f : SAR EDX,0x2
006a8852 : MOV EAX,EDX
006a8854 : MOVZX ECX,CX
006a8857 : SHR EAX,0x1f
006a885a : ADD EAX,EDX
006a885c : MOVSX EDX,SI
006a885f : MOVSX EDI,CX
006a8862 : MOV word ptr [EBX + 0x4a],AX
006a8866 : CWDE
006a8867 : SUB EDI,EDX
006a8869 : CMP EAX,EDI
006a886b : MOV word ptr [EBX + 0x46],CX
006a886f : MOV word ptr [EBX + 0x48],SI
006a8873 : POP EDI
006a8874 : JGE 0x006a887c
006a8876 : SUB ECX,ESI
006a8878 : MOV word ptr [EBX + 0x4a],CX
006a887c : MOV CX,word ptr [EBX + 0xbe]
006a8883 : MOV word ptr [EBX + 0x50],CX
006a8887 : MOV DX,word ptr [EBX + 0xc0]
006a888e : MOV word ptr [EBX + 0x52],DX
006a8892 : POP ESI
006a8893 : MOV EAX,EBP
006a8895 : POP EBP
006a8896 : POP EBX
006a8897 : RET
