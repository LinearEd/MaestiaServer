PROGRAM  : Maestia.exe
FUNCTION : FUN_005b8a40
ENTRY    : 005b8a40
BODY     : [[005b8a40, 005b8c09] [005b8c10, 005b8c72] [005b8c80, 005b8e2c]]

============================================================
DECOMPILED C CODE
============================================================

undefined1 FUN_005b8a40(uint *param_1)

{
  int iVar1;
  uint uVar2;
  uint uVar3;
  char cVar4;
  int *piVar5;
  int iVar6;
  int iVar7;
  GRefCountNTSImpl *this;
  int *in_ECX;
  int iVar8;
  undefined1 local_39;
  uint local_38;
  int *piStack_34;
  uint local_30;
  uint uStack_2c;
  uint uStack_28;
  uint uStack_24;
  uint uStack_18;
  uint uStack_14;
  undefined1 auStack_10 [16];
  
  if (((uint)in_ECX[0x23] >> 4 & 1) == 0) {
    return 0;
  }
  local_39 = 0;
  if ((char)param_1[3] != '\0') goto LAB_005b8d39;
  uVar2 = *param_1;
  if (uVar2 < 0x2001) {
    if (uVar2 != 0x2000) {
      if (uVar2 == 0x400) {
LAB_005b8b05:
        in_ECX[0x2e] = 1;
        goto LAB_005b8a9f;
      }
      if (uVar2 != 0x800) {
        if (uVar2 != 0x1000) goto LAB_005b8a9f;
        goto LAB_005b8a95;
      }
    }
    in_ECX[0x2e] = 2;
  }
  else if (uVar2 == 0x4000) {
LAB_005b8a95:
    in_ECX[0x2e] = 0;
  }
  else {
    if (uVar2 == 0x8000) goto LAB_005b8b05;
    if (uVar2 == 0x10000) {
      in_ECX[0x2e] = ((byte)~(byte)((uint)in_ECX[0x23] >> 0xd) & 1) * 2;
    }
  }
LAB_005b8a9f:
  iVar8 = 0;
  if (*(int *)(in_ECX[0x27] + 0x10) != 0) {
    (**(code **)(**(int **)(in_ECX[0x27] + 0x10) + 4))();
  }
  uVar2 = *param_1;
  local_38 = 0;
  local_30 = 0;
  if (uVar2 == 0x2000) {
    local_38 = 1;
  }
  else if (uVar2 == 0x4000) {
    local_38 = 2;
  }
  else if (uVar2 == 0x400) {
    local_38 = 4;
  }
  else if (uVar2 == 0x800) {
    local_38 = 8;
  }
  else if (uVar2 == 0x10000) {
    local_38 = 0x10;
  }
  else if (uVar2 == 0x8000) {
    local_38 = 0x20;
  }
  else if (uVar2 == 0x1000) {
    local_38 = 0x40;
  }
  else if (uVar2 == 0x20000) {
    local_30 = FUN_00529930();
  }
  FUN_005b67f0();
  if (((in_ECX[8] != 0) &&
      (piVar5 = (int *)FUN_0054ed10(), piStack_34 = piVar5, piVar5 != (int *)0x0)) &&
     (uStack_28 = 0, *(int *)(in_ECX[0x27] + 0x28) != 0)) {
    do {
      uVar2 = *(uint *)(iVar8 + *(int *)(in_ECX[0x27] + 0x24));
      if (((uVar2 & local_38) != 0) ||
         ((0 < (int)local_30 && (((int)uVar2 >> 9 & 0x7fU) == local_30)))) {
        iVar6 = (**(code **)(*piVar5 + 0x5c))();
        uStack_24 = *(uint *)(*(int *)(in_ECX[0x27] + 0x24) + 8 + iVar8);
        uStack_2c = 0;
        if (uStack_24 != 0) {
          do {
            iVar1 = uStack_2c * 4;
            iVar7 = *(int *)(iVar1 + *(int *)(*(int *)(in_ECX[0x27] + 0x24) + 4 + iVar8));
            if ((*(int *)(iVar7 + 0xc) != 0) && (**(char **)(iVar7 + 8) != '\0')) {
              iVar7 = FUN_00515840(0x20,0);
              if (iVar7 == 0) {
                this = (GRefCountNTSImpl *)0x0;
              }
              else {
                this = (GRefCountNTSImpl *)
                       FUN_0052b920(iVar6 + 0x78,
                                    *(undefined4 *)
                                     (*(int *)(*(int *)(in_ECX[0x27] + 0x24) + 4 + iVar8) + iVar1));
              }
              FUN_0058aeb0(this,4);
              if (this != (GRefCountNTSImpl *)0x0) {
                GRefCountNTSImpl::Release(this);
              }
            }
            uStack_2c = uStack_2c + 1;
          } while (uStack_2c < uStack_24);
          piVar5 = piStack_34;
          if (uStack_24 != 0) {
            local_39 = 1;
          }
        }
      }
      uStack_28 = uStack_28 + 1;
      iVar8 = iVar8 + 0x10;
    } while (uStack_28 < *(uint *)(in_ECX[0x27] + 0x28));
  }
LAB_005b8d39:
  iVar8 = (**(code **)(*in_ECX + 0x5c))();
  if (iVar8 != 0) {
    FUN_00529910(&piStack_34,iVar8 + 0x78);
    if (piStack_34[4] != 0) {
      auStack_10[0] = 0;
      cVar4 = (**(code **)(in_ECX[0x1a] + 0x2c))(iVar8 + 0x78,&piStack_34,auStack_10);
      if (cVar4 != '\0') {
        local_39 = 1;
        (**(code **)(*in_ECX + 0x40))();
        iVar8 = FUN_00571c40(4);
        if (iVar8 != 0) {
          uVar2 = *param_1;
          uStack_18 = param_1[2];
          uStack_14 = param_1[3];
          uVar3 = param_1[1];
          *(undefined4 *)(iVar8 + 4) = 2;
          in_ECX[1] = in_ECX[1] + 1;
          if (*(GRefCountNTSImpl **)(iVar8 + 8) != (GRefCountNTSImpl *)0x0) {
            GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(iVar8 + 8));
          }
          *(int **)(iVar8 + 8) = in_ECX;
          if (*(GRefCountNTSImpl **)(iVar8 + 0xc) != (GRefCountNTSImpl *)0x0) {
            GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(iVar8 + 0xc));
          }
          *(undefined4 *)(iVar8 + 0xc) = 0;
          *(uint *)(iVar8 + 0x10) = uVar2;
          *(uint *)(iVar8 + 0x14) = uVar3;
          *(uint *)(iVar8 + 0x18) = uStack_18;
          *(uint *)(iVar8 + 0x1c) = uStack_14;
        }
      }
      FUN_00526bc0();
    }
    piStack_34[2] = piStack_34[2] + -1;
    if (piStack_34[2] == 0) {
      FUN_00525340();
    }
  }
  return local_39;
}



============================================================
DISASSEMBLY
============================================================
005b8a40 : SUB ESP,0x3c
005b8a43 : PUSH ESI
005b8a44 : MOV ESI,ECX
005b8a46 : MOV ECX,dword ptr [ESI + 0x8c]
005b8a4c : MOV EAX,ECX
005b8a4e : SHR EAX,0x4
005b8a51 : TEST AL,0x1
005b8a53 : JNZ 0x005b8a5e
005b8a55 : XOR AL,AL
005b8a57 : POP ESI
005b8a58 : ADD ESP,0x3c
005b8a5b : RET 0x4
005b8a5e : PUSH EBX
005b8a5f : PUSH EBP
005b8a60 : MOV EBP,dword ptr [ESP + 0x4c]
005b8a64 : CMP byte ptr [EBP + 0xc],0x0
005b8a68 : PUSH EDI
005b8a69 : MOV byte ptr [ESP + 0x13],0x0
005b8a6e : JNZ 0x005b8d39
005b8a74 : MOV EAX,dword ptr [EBP]
005b8a77 : CMP EAX,0x2000
005b8a7c : JA 0x005b8adb
005b8a7e : JZ 0x005b8acf
005b8a80 : CMP EAX,0x400
005b8a85 : JZ 0x005b8b05
005b8a87 : CMP EAX,0x800
005b8a8c : JZ 0x005b8acf
005b8a8e : CMP EAX,0x1000
005b8a93 : JNZ 0x005b8a9f
005b8a95 : MOV dword ptr [ESI + 0xb8],0x0
005b8a9f : MOV ECX,dword ptr [ESI + 0x9c]
005b8aa5 : XOR EBX,EBX
005b8aa7 : CMP dword ptr [ECX + 0x10],EBX
005b8aaa : JZ 0x005b8b39
005b8ab0 : MOV EAX,dword ptr [EBP]
005b8ab3 : CMP EAX,0x2000
005b8ab8 : JA 0x005b8b1f
005b8aba : JZ 0x005b8b18
005b8abc : CMP EAX,0x400
005b8ac1 : JZ 0x005b8b11
005b8ac3 : CMP EAX,0x800
005b8ac8 : JNZ 0x005b8b26
005b8aca : LEA EAX,[EBX + 0x3]
005b8acd : JMP 0x005b8b2d
005b8acf : MOV dword ptr [ESI + 0xb8],0x2
005b8ad9 : JMP 0x005b8a9f
005b8adb : CMP EAX,0x4000
005b8ae0 : JZ 0x005b8a95
005b8ae2 : CMP EAX,0x8000
005b8ae7 : JZ 0x005b8b05
005b8ae9 : CMP EAX,0x10000
005b8aee : JNZ 0x005b8a9f
005b8af0 : SHR ECX,0xd
005b8af3 : NOT CL
005b8af5 : MOVZX ECX,CL
005b8af8 : AND ECX,0x1
005b8afb : ADD ECX,ECX
005b8afd : MOV dword ptr [ESI + 0xb8],ECX
005b8b03 : JMP 0x005b8a9f
005b8b05 : MOV dword ptr [ESI + 0xb8],0x1
005b8b0f : JMP 0x005b8a9f
005b8b11 : MOV EAX,0x2
005b8b16 : JMP 0x005b8b2d
005b8b18 : MOV EAX,0x1
005b8b1d : JMP 0x005b8b2d
005b8b1f : CMP EAX,0x4000
005b8b24 : JZ 0x005b8b2b
005b8b26 : OR EAX,0xffffffff
005b8b29 : JMP 0x005b8b2d
005b8b2b : XOR EAX,EAX
005b8b2d : MOV ECX,dword ptr [ECX + 0x10]
005b8b30 : MOV EDX,dword ptr [ECX]
005b8b32 : PUSH EAX
005b8b33 : MOV EAX,dword ptr [EDX + 0x4]
005b8b36 : PUSH ESI
005b8b37 : CALL EAX
005b8b39 : MOV EAX,dword ptr [EBP]
005b8b3c : MOV dword ptr [ESP + 0x14],EBX
005b8b40 : MOV dword ptr [ESP + 0x1c],EBX
005b8b44 : CMP EAX,0x2000
005b8b49 : JNZ 0x005b8b55
005b8b4b : MOV dword ptr [ESP + 0x14],0x1
005b8b53 : JMP 0x005b8bcd
005b8b55 : CMP EAX,0x4000
005b8b5a : JNZ 0x005b8b66
005b8b5c : MOV dword ptr [ESP + 0x14],0x2
005b8b64 : JMP 0x005b8bcd
005b8b66 : CMP EAX,0x400
005b8b6b : JNZ 0x005b8b77
005b8b6d : MOV dword ptr [ESP + 0x14],0x4
005b8b75 : JMP 0x005b8bcd
005b8b77 : CMP EAX,0x800
005b8b7c : JNZ 0x005b8b88
005b8b7e : MOV dword ptr [ESP + 0x14],0x8
005b8b86 : JMP 0x005b8bcd
005b8b88 : CMP EAX,0x10000
005b8b8d : JNZ 0x005b8b99
005b8b8f : MOV dword ptr [ESP + 0x14],0x10
005b8b97 : JMP 0x005b8bcd
005b8b99 : CMP EAX,0x8000
005b8b9e : JNZ 0x005b8baa
005b8ba0 : MOV dword ptr [ESP + 0x14],0x20
005b8ba8 : JMP 0x005b8bcd
005b8baa : CMP EAX,0x1000
005b8baf : JNZ 0x005b8bbb
005b8bb1 : MOV dword ptr [ESP + 0x14],0x40
005b8bb9 : JMP 0x005b8bcd
005b8bbb : CMP EAX,0x20000
005b8bc0 : JNZ 0x005b8bcd
005b8bc2 : MOV ECX,EBP
005b8bc4 : CALL 0x00529930
005b8bc9 : MOV dword ptr [ESP + 0x1c],EAX
005b8bcd : MOV ECX,ESI
005b8bcf : CALL 0x005b67f0
005b8bd4 : MOV EAX,dword ptr [ESI + 0x20]
005b8bd7 : CMP EAX,EBX
005b8bd9 : JZ 0x005b8d39
005b8bdf : LEA ECX,[EAX + 0x68]
005b8be2 : CALL 0x0054ed10
005b8be7 : MOV EDI,EAX
005b8be9 : MOV dword ptr [ESP + 0x18],EDI
005b8bed : CMP EDI,EBX
005b8bef : JZ 0x005b8d39
005b8bf5 : MOV ECX,dword ptr [ESI + 0x9c]
005b8bfb : MOV dword ptr [ESP + 0x24],EBX
005b8bff : CMP dword ptr [ECX + 0x28],EBX
005b8c02 : JBE 0x005b8d39
005b8c08 : JMP 0x005b8c10
005b8c10 : MOV EDX,dword ptr [ESI + 0x9c]
005b8c16 : MOV EAX,dword ptr [EDX + 0x24]
005b8c19 : MOV EAX,dword ptr [EBX + EAX*0x1]
005b8c1c : MOV ECX,EAX
005b8c1e : AND ECX,dword ptr [ESP + 0x14]
005b8c22 : TEST ECX,0xffff01ff
005b8c28 : JNZ 0x005b8c44
005b8c2a : MOV ECX,dword ptr [ESP + 0x1c]
005b8c2e : TEST ECX,ECX
005b8c30 : JLE 0x005b8d1e
005b8c36 : SAR EAX,0x9
005b8c39 : AND EAX,0x7f
005b8c3c : CMP EAX,ECX
005b8c3e : JNZ 0x005b8d1e
005b8c44 : MOV EDX,dword ptr [EDI]
005b8c46 : MOV EAX,dword ptr [EDX + 0x5c]
005b8c49 : MOV ECX,EDI
005b8c4b : CALL EAX
005b8c4d : MOV ECX,dword ptr [ESI + 0x9c]
005b8c53 : MOV EDX,dword ptr [ECX + 0x24]
005b8c56 : MOV ECX,dword ptr [EDX + EBX*0x1 + 0x8]
005b8c5a : MOV EBP,EAX
005b8c5c : XOR EAX,EAX
005b8c5e : ADD EBP,0x78
005b8c61 : MOV dword ptr [ESP + 0x28],ECX
005b8c65 : MOV dword ptr [ESP + 0x20],EAX
005b8c69 : TEST ECX,ECX
005b8c6b : JBE 0x005b8d1a
005b8c71 : JMP 0x005b8c80
005b8c80 : LEA EDI,[EAX*0x4 + 0x0]
005b8c87 : MOV EAX,dword ptr [ESI + 0x9c]
005b8c8d : MOV ECX,dword ptr [EAX + 0x24]
005b8c90 : MOV EDX,dword ptr [ECX + EBX*0x1 + 0x4]
005b8c94 : MOV EAX,dword ptr [EDI + EDX*0x1]
005b8c97 : CMP dword ptr [EAX + 0xc],0x1
005b8c9b : JC 0x005b8cf2
005b8c9d : MOV EAX,dword ptr [EAX + 0x8]
005b8ca0 : CMP byte ptr [EAX],0x0
005b8ca3 : JZ 0x005b8cf2
005b8ca5 : MOV ECX,dword ptr [EBP]
005b8ca8 : MOV ECX,dword ptr [ECX + 0x288]
005b8cae : PUSH 0x0
005b8cb0 : PUSH 0x20
005b8cb2 : CALL 0x00515840
005b8cb7 : TEST EAX,EAX
005b8cb9 : JZ 0x005b8cd9
005b8cbb : MOV EDX,dword ptr [ESI + 0x9c]
005b8cc1 : MOV ECX,dword ptr [EDX + 0x24]
005b8cc4 : MOV EDX,dword ptr [ECX + EBX*0x1 + 0x4]
005b8cc8 : ADD EDX,EDI
005b8cca : MOV EDX,dword ptr [EDX]
005b8ccc : PUSH EDX
005b8ccd : PUSH EBP
005b8cce : MOV ECX,EAX
005b8cd0 : CALL 0x0052b920
005b8cd5 : MOV EDI,EAX
005b8cd7 : JMP 0x005b8cdb
005b8cd9 : XOR EDI,EDI
005b8cdb : MOV ECX,dword ptr [ESP + 0x18]
005b8cdf : PUSH 0x4
005b8ce1 : PUSH EDI
005b8ce2 : CALL 0x0058aeb0
005b8ce7 : TEST EDI,EDI
005b8ce9 : JZ 0x005b8cf2
005b8ceb : MOV ECX,EDI
005b8ced : CALL 0x004ff7c0
005b8cf2 : MOV EAX,dword ptr [ESP + 0x20]
005b8cf6 : MOV ECX,dword ptr [ESP + 0x28]
005b8cfa : INC EAX
005b8cfb : MOV dword ptr [ESP + 0x20],EAX
005b8cff : CMP EAX,ECX
005b8d01 : JC 0x005b8c80
005b8d07 : MOV EDI,dword ptr [ESP + 0x18]
005b8d0b : MOV EBP,dword ptr [ESP + 0x50]
005b8d0f : TEST ECX,ECX
005b8d11 : JBE 0x005b8d1e
005b8d13 : MOV byte ptr [ESP + 0x13],0x1
005b8d18 : JMP 0x005b8d1e
005b8d1a : MOV EBP,dword ptr [ESP + 0x50]
005b8d1e : MOV EAX,dword ptr [ESP + 0x24]
005b8d22 : MOV ECX,dword ptr [ESI + 0x9c]
005b8d28 : INC EAX
005b8d29 : ADD EBX,0x10
005b8d2c : MOV dword ptr [ESP + 0x24],EAX
005b8d30 : CMP EAX,dword ptr [ECX + 0x28]
005b8d33 : JC 0x005b8c10
005b8d39 : MOV EDX,dword ptr [ESI]
005b8d3b : MOV EAX,dword ptr [EDX + 0x5c]
005b8d3e : MOV ECX,ESI
005b8d40 : CALL EAX
005b8d42 : TEST EAX,EAX
005b8d44 : JZ 0x005b8e1f
005b8d4a : LEA EDI,[EAX + 0x78]
005b8d4d : PUSH EDI
005b8d4e : LEA ECX,[ESP + 0x1c]
005b8d52 : PUSH ECX
005b8d53 : MOV ECX,EBP
005b8d55 : CALL 0x00529910
005b8d5a : MOV EAX,dword ptr [ESP + 0x18]
005b8d5e : CMP dword ptr [EAX + 0x10],0x0
005b8d62 : JBE 0x005b8e0d
005b8d68 : MOV EDX,dword ptr [ESI + 0x68]
005b8d6b : MOV EDX,dword ptr [EDX + 0x2c]
005b8d6e : LEA EAX,[ESP + 0x3c]
005b8d72 : PUSH EAX
005b8d73 : LEA ECX,[ESI + 0x68]
005b8d76 : LEA EAX,[ESP + 0x1c]
005b8d7a : PUSH EAX
005b8d7b : PUSH EDI
005b8d7c : MOV byte ptr [ESP + 0x48],0x0
005b8d81 : CALL EDX
005b8d83 : TEST AL,AL
005b8d85 : JZ 0x005b8e00
005b8d87 : MOV EAX,dword ptr [ESI]
005b8d89 : MOV EDX,dword ptr [EAX + 0x40]
005b8d8c : MOV ECX,ESI
005b8d8e : MOV byte ptr [ESP + 0x13],0x1
005b8d93 : CALL EDX
005b8d95 : PUSH 0x4
005b8d97 : LEA ECX,[EAX + 0xa2c]
005b8d9d : CALL 0x00571c40
005b8da2 : MOV EDI,EAX
005b8da4 : TEST EDI,EDI
005b8da6 : JZ 0x005b8e00
005b8da8 : MOV EBX,dword ptr [EBP]
005b8dab : MOV EAX,dword ptr [ESP + 0x50]
005b8daf : MOV ECX,dword ptr [EAX + 0x8]
005b8db2 : MOV EDX,dword ptr [EAX + 0xc]
005b8db5 : MOV EBP,dword ptr [EBP + 0x4]
005b8db8 : MOV dword ptr [EDI + 0x4],0x2
005b8dbf : INC dword ptr [ESI + 0x4]
005b8dc2 : MOV dword ptr [ESP + 0x34],ECX
005b8dc6 : MOV ECX,dword ptr [EDI + 0x8]
005b8dc9 : MOV dword ptr [ESP + 0x38],EDX
005b8dcd : TEST ECX,ECX
005b8dcf : JZ 0x005b8dd6
005b8dd1 : CALL 0x004ff7c0
005b8dd6 : MOV dword ptr [EDI + 0x8],ESI
005b8dd9 : MOV ECX,dword ptr [EDI + 0xc]
005b8ddc : TEST ECX,ECX
005b8dde : JZ 0x005b8de5
005b8de0 : CALL 0x004ff7c0
005b8de5 : MOV EAX,dword ptr [ESP + 0x34]
005b8de9 : MOV ECX,dword ptr [ESP + 0x38]
005b8ded : MOV dword ptr [EDI + 0xc],0x0
005b8df4 : MOV dword ptr [EDI + 0x10],EBX
005b8df7 : MOV dword ptr [EDI + 0x14],EBP
005b8dfa : MOV dword ptr [EDI + 0x18],EAX
005b8dfd : MOV dword ptr [EDI + 0x1c],ECX
005b8e00 : LEA ECX,[ESP + 0x3c]
005b8e04 : CALL 0x00526bc0
005b8e09 : MOV EAX,dword ptr [ESP + 0x18]
005b8e0d : DEC dword ptr [EAX + 0x8]
005b8e10 : MOV ECX,EAX
005b8e12 : ADD EAX,0x8
005b8e15 : CMP dword ptr [EAX],0x0
005b8e18 : JNZ 0x005b8e1f
005b8e1a : CALL 0x00525340
005b8e1f : MOV AL,byte ptr [ESP + 0x13]
005b8e23 : POP EDI
005b8e24 : POP EBP
005b8e25 : POP EBX
005b8e26 : POP ESI
005b8e27 : ADD ESP,0x3c
005b8e2a : RET 0x4
