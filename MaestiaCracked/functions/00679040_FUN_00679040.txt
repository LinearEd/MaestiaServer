PROGRAM  : Maestia.exe
FUNCTION : FUN_00679040
ENTRY    : 00679040
BODY     : [[00679040, 0067913c] [00679140, 0067926a]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00679040(undefined4 param_1,int param_2,uint param_3)

{
  int *piVar1;
  uint uVar2;
  char cVar3;
  uint uVar4;
  int iVar5;
  undefined4 uVar6;
  int in_ECX;
  int iVar7;
  uint *puVar8;
  uint local_28;
  uint local_24;
  undefined1 local_20 [16];
  undefined1 auStack_10 [16];
  
  if (*(int *)(in_ECX + 0x68) == 0) {
    return 0;
  }
  __controlfp_s(&local_28,0,0);
  __controlfp_s(&local_24,0x10000,0x30000);
  local_20[0] = 0;
  uVar4 = (**(code **)(**(int **)(in_ECX + 0x68) + 0x5c))();
  iVar7 = param_3 - 1;
  local_24 = uVar4;
  if (-1 < iVar7) {
    param_2 = iVar7 * 0x10 + param_2;
    puVar8 = (uint *)(uVar4 + 8);
    do {
      auStack_10[0] = 0;
      FUN_00588880(param_2,auStack_10);
      *puVar8 = *puVar8 + 0x10;
      if (*(uint *)(uVar4 + 0x10) <= *puVar8) {
        FUN_00504050();
      }
      if (*puVar8 != 0) {
        FUN_005266c0(auStack_10);
      }
      FUN_00526bc0();
      iVar7 = iVar7 + -1;
      param_2 = param_2 + -0x10;
    } while (-1 < iVar7);
  }
  if ((*(int *)(in_ECX + 0xa00) == 0) ||
     (iVar7 = FUN_005760d0(param_1), uVar4 = param_3, iVar7 == 0)) {
    cVar3 = FUN_0058cc90(param_1,local_20,param_3);
    uVar4 = param_3;
  }
  else {
    cVar3 = FUN_00572430(param_1,iVar7,local_20,param_3);
  }
  uVar2 = local_24;
  puVar8 = (uint *)(local_24 + 8);
  for (; uVar4 != 0; uVar4 = uVar4 - 1) {
    FUN_00526bc0();
    *puVar8 = *puVar8 - 0x10;
    if (*puVar8 < *(uint *)(uVar2 + 0xc)) {
      FUN_00504f30();
    }
  }
  if (cVar3 != '\0') {
    *(undefined4 *)(*(int *)(in_ECX + 0x9ec) + 0x18) = 0;
    iVar7 = *(int *)(*(int *)(in_ECX + 0x9ec) + 0x18);
    *(int *)(*(int *)(in_ECX + 0x9ec) + 0x18) = iVar7 + 1;
    iVar5 = *(int *)(in_ECX + 0x9ec);
    if (*(uint *)(iVar5 + 0xc) < *(uint *)(iVar5 + 0x18)) {
      iVar5 = *(int *)(iVar5 + 0x18);
      if (iVar5 == 0) {
        iVar5 = 1;
      }
      FUN_0052b460(iVar5);
    }
    uVar6 = (**(code **)(**(int **)(in_ECX + 0x68) + 0x5c))();
    FUN_005272e0(&param_3,uVar6,0xffffffff,0);
    uVar4 = param_3;
    iVar7 = iVar7 * 4;
    iVar5 = *(int *)(*(int *)(in_ECX + 0x9ec) + 8);
    *(int *)(param_3 + 8) = *(int *)(param_3 + 8) + 1;
    piVar1 = (int *)(*(int *)(iVar5 + iVar7) + 8);
    *piVar1 = *piVar1 + -1;
    if (*piVar1 == 0) {
      FUN_00525340();
    }
    *(uint *)(iVar5 + iVar7) = uVar4;
    *(int *)(param_3 + 8) = *(int *)(param_3 + 8) + -1;
    if (*(int *)(param_3 + 8) == 0) {
      FUN_00525340();
    }
    uVar6 = **(undefined4 **)(iVar7 + *(int *)(*(int *)(in_ECX + 0x9ec) + 8));
    FUN_00526bc0();
    __controlfp_s(&param_3,local_28,0x30000);
    return uVar6;
  }
  FUN_00526bc0();
  __controlfp_s(&param_3,local_28,0x30000);
  return 0;
}



============================================================
DISASSEMBLY
============================================================
00679040 : SUB ESP,0x28
00679043 : PUSH ESI
00679044 : MOV ESI,ECX
00679046 : CMP dword ptr [ESI + 0x68],0x0
0067904a : JNZ 0x00679055
0067904c : XOR EAX,EAX
0067904e : POP ESI
0067904f : ADD ESP,0x28
00679052 : RET 0xc
00679055 : PUSH EBX
00679056 : PUSH EBP
00679057 : PUSH EDI
00679058 : PUSH 0x0
0067905a : LEA EAX,[ESP + 0x14]
0067905e : PUSH 0x0
00679060 : PUSH EAX
00679061 : CALL 0x0063c57b
00679066 : PUSH 0x30000
0067906b : LEA ECX,[ESP + 0x24]
0067906f : PUSH 0x10000
00679074 : PUSH ECX
00679075 : CALL 0x0063c57b
0067907a : MOV ECX,dword ptr [ESI + 0x68]
0067907d : MOV byte ptr [ESP + 0x30],0x0
00679082 : MOV EDX,dword ptr [ECX]
00679084 : MOV EAX,dword ptr [EDX + 0x5c]
00679087 : ADD ESP,0x18
0067908a : CALL EAX
0067908c : MOV EBX,dword ptr [ESP + 0x44]
00679090 : ADD EBX,-0x1
00679093 : MOV dword ptr [ESP + 0x14],EAX
00679097 : JS 0x006790e9
00679099 : MOV EBP,EBX
0067909b : SHL EBP,0x4
0067909e : ADD EBP,dword ptr [ESP + 0x40]
006790a2 : LEA EDI,[EAX + 0x8]
006790a5 : LEA ECX,[ESP + 0x28]
006790a9 : PUSH ECX
006790aa : PUSH EBP
006790ab : MOV ECX,ESI
006790ad : MOV byte ptr [ESP + 0x30],0x0
006790b2 : CALL 0x00588880
006790b7 : ADD dword ptr [EDI],0x10
006790ba : MOV EAX,dword ptr [EDI]
006790bc : CMP EAX,dword ptr [EDI + 0x8]
006790bf : JC 0x006790c8
006790c1 : MOV ECX,EDI
006790c3 : CALL 0x00504050
006790c8 : MOV ECX,dword ptr [EDI]
006790ca : TEST ECX,ECX
006790cc : JZ 0x006790d8
006790ce : LEA EDX,[ESP + 0x28]
006790d2 : PUSH EDX
006790d3 : CALL 0x005266c0
006790d8 : LEA ECX,[ESP + 0x28]
006790dc : CALL 0x00526bc0
006790e1 : DEC EBX
006790e2 : SUB EBP,0x10
006790e5 : TEST EBX,EBX
006790e7 : JGE 0x006790a5
006790e9 : CMP dword ptr [ESI + 0xa00],0x0
006790f0 : MOV EDI,dword ptr [ESP + 0x3c]
006790f4 : JZ 0x00679117
006790f6 : PUSH EDI
006790f7 : MOV ECX,ESI
006790f9 : CALL 0x005760d0
006790fe : TEST EAX,EAX
00679100 : JZ 0x00679117
00679102 : MOV EBP,dword ptr [ESP + 0x44]
00679106 : PUSH EBP
00679107 : LEA ECX,[ESP + 0x1c]
0067910b : PUSH ECX
0067910c : PUSH EAX
0067910d : PUSH EDI
0067910e : MOV ECX,ESI
00679110 : CALL 0x00572430
00679115 : JMP 0x0067912e
00679117 : MOV EDX,dword ptr [ESP + 0x44]
0067911b : MOV ECX,dword ptr [ESI + 0x68]
0067911e : PUSH EDX
0067911f : LEA EAX,[ESP + 0x1c]
00679123 : PUSH EAX
00679124 : PUSH EDI
00679125 : CALL 0x0058cc90
0067912a : MOV EBP,dword ptr [ESP + 0x44]
0067912e : MOV EDI,dword ptr [ESP + 0x14]
00679132 : ADD EDI,0x8
00679135 : MOV BL,AL
00679137 : TEST EBP,EBP
00679139 : JBE 0x0067915d
0067913b : JMP 0x00679140
00679140 : MOV ECX,dword ptr [EDI]
00679142 : CALL 0x00526bc0
00679147 : ADD dword ptr [EDI],-0x10
0067914a : MOV EAX,dword ptr [EDI]
0067914c : CMP EAX,dword ptr [EDI + 0x4]
0067914f : JNC 0x00679158
00679151 : MOV ECX,EDI
00679153 : CALL 0x00504f30
00679158 : SUB EBP,0x1
0067915b : JNZ 0x00679140
0067915d : TEST BL,BL
0067915f : JZ 0x0067923f
00679165 : MOV ECX,dword ptr [ESI + 0x9ec]
0067916b : MOV dword ptr [ECX + 0x18],0x0
00679172 : MOV EAX,dword ptr [ESI + 0x9ec]
00679178 : MOV EDI,dword ptr [EAX + 0x18]
0067917b : LEA EDX,[EDI + 0x1]
0067917e : MOV dword ptr [EAX + 0x18],EDX
00679181 : MOV EAX,dword ptr [ESI + 0x9ec]
00679187 : MOV ECX,dword ptr [EAX + 0xc]
0067918a : CMP ECX,dword ptr [EAX + 0x18]
0067918d : JNC 0x006791a7
0067918f : MOV ECX,EAX
00679191 : MOV EAX,dword ptr [ECX + 0x18]
00679194 : CMP EAX,0x1
00679197 : JNC 0x0067919e
00679199 : MOV EAX,0x1
0067919e : PUSH EAX
0067919f : ADD ECX,0x8
006791a2 : CALL 0x0052b460
006791a7 : MOV ECX,dword ptr [ESI + 0x68]
006791aa : MOV EDX,dword ptr [ECX]
006791ac : MOV EAX,dword ptr [EDX + 0x5c]
006791af : CALL EAX
006791b1 : PUSH 0x0
006791b3 : PUSH -0x1
006791b5 : PUSH EAX
006791b6 : LEA ECX,[ESP + 0x50]
006791ba : PUSH ECX
006791bb : LEA ECX,[ESP + 0x28]
006791bf : CALL 0x005272e0
006791c4 : MOV EDX,dword ptr [ESI + 0x9ec]
006791ca : MOV EAX,dword ptr [ESP + 0x44]
006791ce : LEA EBX,[EDI*0x4 + 0x0]
006791d5 : MOV EDI,dword ptr [EDX + 0x8]
006791d8 : INC dword ptr [EAX + 0x8]
006791db : MOV ECX,dword ptr [EDI + EBX*0x1]
006791de : ADD EDI,EBX
006791e0 : ADD dword ptr [ECX + 0x8],-0x1
006791e4 : MOV EBP,EAX
006791e6 : JNZ 0x006791ed
006791e8 : CALL 0x00525340
006791ed : MOV dword ptr [EDI],EBP
006791ef : MOV EAX,dword ptr [ESP + 0x44]
006791f3 : DEC dword ptr [EAX + 0x8]
006791f6 : MOV ECX,EAX
006791f8 : ADD EAX,0x8
006791fb : CMP dword ptr [EAX],0x0
006791fe : JNZ 0x00679205
00679200 : CALL 0x00525340
00679205 : MOV EAX,dword ptr [ESI + 0x9ec]
0067920b : MOV ECX,dword ptr [EAX + 0x8]
0067920e : MOV EDX,dword ptr [EBX + ECX*0x1]
00679211 : MOV ESI,dword ptr [EDX]
00679213 : LEA ECX,[ESP + 0x18]
00679217 : CALL 0x00526bc0
0067921c : MOV EAX,dword ptr [ESP + 0x10]
00679220 : PUSH 0x30000
00679225 : PUSH EAX
00679226 : LEA ECX,[ESP + 0x4c]
0067922a : PUSH ECX
0067922b : CALL 0x0063c57b
00679230 : ADD ESP,0xc
00679233 : POP EDI
00679234 : POP EBP
00679235 : POP EBX
00679236 : MOV EAX,ESI
00679238 : POP ESI
00679239 : ADD ESP,0x28
0067923c : RET 0xc
0067923f : LEA ECX,[ESP + 0x18]
00679243 : CALL 0x00526bc0
00679248 : MOV EDX,dword ptr [ESP + 0x10]
0067924c : PUSH 0x30000
00679251 : PUSH EDX
00679252 : LEA EAX,[ESP + 0x4c]
00679256 : PUSH EAX
00679257 : CALL 0x0063c57b
0067925c : ADD ESP,0xc
0067925f : POP EDI
00679260 : POP EBP
00679261 : POP EBX
00679262 : XOR EAX,EAX
00679264 : POP ESI
00679265 : ADD ESP,0x28
00679268 : RET 0xc
