PROGRAM  : Maestia.exe
FUNCTION : FUN_0058ffa0
ENTRY    : 0058ffa0
BODY     : [[0058ffa0, 005901f5]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0058ffa0(int param_1,undefined2 param_2)

{
  int iVar1;
  uint uVar2;
  LONG LVar3;
  code *pcVar4;
  int in_ECX;
  uint uVar5;
  GThread *this;
  GThread *extraout_ECX;
  GThread *extraout_ECX_00;
  GThread *pGVar6;
  GThread *this_00;
  GThread *extraout_ECX_01;
  int iVar7;
  uint local_18;
  uint local_14;
  undefined1 local_10 [16];
  
  iVar7 = *(int *)(param_1 + 0x314);
  if (iVar7 == 0) {
    iVar7 = param_1 + 0x28;
  }
  uVar2 = FUN_00539ca0();
  *(undefined4 *)(param_1 + 0x2e8) = 1;
  *(int *)(param_1 + 0x2ec) = in_ECX;
  *(undefined1 *)(iVar7 + 0x15) = 0;
  local_14 = uVar2;
  if (*(int *)(iVar7 + 0x30) - *(int *)(iVar7 + 0x2c) < 2) {
    FUN_00539fb0(2);
  }
  iVar1 = *(int *)(iVar7 + 0x2c);
  uVar5 = (uint)CONCAT11(*(undefined1 *)(*(int *)(iVar7 + 0x3c) + 1 + iVar1),
                         *(undefined1 *)(*(int *)(iVar7 + 0x3c) + iVar1));
  *(int *)(iVar7 + 0x2c) = iVar1 + 2;
  *(uint *)(in_ECX + 0x18) = uVar5;
  if (uVar5 == 0) {
    *(undefined4 *)(in_ECX + 0x18) = 1;
  }
  FUN_0058fb30(*(undefined4 *)(in_ECX + 0x18));
  GThread::OnExit(this);
  *(undefined4 *)(in_ECX + 0x1c) = 0;
  if ((uint)((*(int *)(iVar7 + 0x34) - *(int *)(iVar7 + 0x30)) + *(int *)(iVar7 + 0x2c)) < uVar2) {
    do {
      uVar2 = FUN_0053ab10(local_10);
      FUN_0051c480((*(uint *)(*(int *)(param_1 + 0x20) + 0x24) & 0xfffffffc) + 8);
      FUN_00562270(&local_18,local_10,1);
      uVar5 = local_18 & 0xfffffffc;
      LVar3 = InterlockedExchangeAdd((LONG *)(uVar5 + 4),-1);
      pGVar6 = extraout_ECX;
      if (LVar3 == 1) {
        FUN_00515cf0(uVar5);
        pGVar6 = extraout_ECX_00;
      }
      if (uVar2 == 1) {
        if (*(int *)(in_ECX + 0x1c) == *(int *)(in_ECX + 0x24)) {
          FUN_0058fb30(*(int *)(in_ECX + 0x24) + 1);
          FUN_0058c420(iVar7,
                       "An extra frame is found for sprite id = %d, framecnt = %d, actual frames = %d\n"
                       ,param_2,*(undefined4 *)(in_ECX + 0x18),*(int *)(in_ECX + 0x1c) + 1);
        }
        FUN_005a13b0();
        GThread::OnExit(this_00);
        *(int *)(in_ECX + 0x1c) = *(int *)(in_ECX + 0x1c) + 1;
      }
      else {
        if (uVar2 < 0x55) {
          pcVar4 = (code *)(&PTR_FUN_00d65e58)[uVar2];
LAB_00590130:
          if (pcVar4 != (code *)0x0) {
            (*pcVar4)(param_1,local_10);
            goto LAB_00590151;
          }
        }
        else if (uVar2 - 1000 < 10) {
          pcVar4 = (code *)(&PTR_FUN_00d6500c)[uVar2];
          goto LAB_00590130;
        }
        GThread::OnExit(pGVar6);
      }
LAB_00590151:
      FUN_0053a1f0();
    } while ((uint)((*(int *)(iVar7 + 0x34) - *(int *)(iVar7 + 0x30)) + *(int *)(iVar7 + 0x2c)) <
             local_14);
  }
  pGVar6 = (GThread *)(*(int *)(param_1 + 0x2e8) * 3 + 0xbd);
  if ((*(int *)(param_1 + (int)pGVar6 * 4) != 0) ||
     ((*(int *)(param_1 + 0x2e8) == 0 && (*(int *)(param_1 + 0x30c) != 0)))) {
    if (*(int *)(in_ECX + 0x1c) == *(int *)(in_ECX + 0x24)) {
      FUN_0058fb30(*(int *)(in_ECX + 0x24) + 1);
      FUN_0058c420(iVar7,
                   "An extra frame is found for sprite id = %d, framecnt = %d, actual frames = %d\n"
                   ,param_2,*(undefined4 *)(in_ECX + 0x18),*(int *)(in_ECX + 0x1c) + 1);
    }
    FUN_005a13b0();
    pGVar6 = extraout_ECX_01;
  }
  *(undefined4 *)(param_1 + 0x2e8) = 0;
  *(undefined4 *)(param_1 + 0x2ec) = 0;
  GThread::OnExit(pGVar6);
  return;
}



============================================================
DISASSEMBLY
============================================================
0058ffa0 : SUB ESP,0x18
0058ffa3 : PUSH EBP
0058ffa4 : MOV EBP,dword ptr [ESP + 0x20]
0058ffa8 : PUSH ESI
0058ffa9 : MOV ESI,dword ptr [EBP + 0x314]
0058ffaf : PUSH EDI
0058ffb0 : MOV EDI,ECX
0058ffb2 : TEST ESI,ESI
0058ffb4 : JNZ 0x0058ffb9
0058ffb6 : LEA ESI,[EBP + 0x28]
0058ffb9 : PUSH EBX
0058ffba : MOV ECX,ESI
0058ffbc : CALL 0x00539ca0
0058ffc1 : MOV EBX,EAX
0058ffc3 : MOV dword ptr [EBP + 0x2e8],0x1
0058ffcd : MOV dword ptr [EBP + 0x2ec],EDI
0058ffd3 : MOV EAX,dword ptr [ESI + 0x30]
0058ffd6 : SUB EAX,dword ptr [ESI + 0x2c]
0058ffd9 : MOV dword ptr [ESP + 0x14],EBX
0058ffdd : CMP EAX,0x2
0058ffe0 : MOV byte ptr [ESI + 0x15],0x0
0058ffe4 : JGE 0x0058ffef
0058ffe6 : PUSH 0x2
0058ffe8 : MOV ECX,ESI
0058ffea : CALL 0x00539fb0
0058ffef : MOV EAX,dword ptr [ESI + 0x2c]
0058fff2 : MOV ECX,dword ptr [ESI + 0x3c]
0058fff5 : MOVZX DX,byte ptr [ECX + EAX*0x1 + 0x1]
0058fffb : ADD ECX,EAX
0058fffd : MOVZX CX,byte ptr [ECX]
00590001 : SHL DX,0x8
00590005 : OR DX,CX
00590008 : ADD EAX,0x2
0059000b : MOVZX ECX,DX
0059000e : MOV dword ptr [ESI + 0x2c],EAX
00590011 : MOVZX EAX,CX
00590014 : CMP EAX,0x1
00590017 : MOV dword ptr [EDI + 0x18],EAX
0059001a : JGE 0x00590023
0059001c : MOV dword ptr [EDI + 0x18],0x1
00590023 : MOV EDX,dword ptr [EDI + 0x18]
00590026 : LEA ECX,[EDI + 0x20]
00590029 : PUSH EDX
0059002a : CALL 0x0058fb30
0059002f : MOV EAX,dword ptr [EDI + 0x18]
00590032 : PUSH EAX
00590033 : PUSH 0xb8e848
00590038 : PUSH ESI
00590039 : CALL 0x0051d420
0059003e : MOV dword ptr [EDI + 0x1c],0x0
00590045 : MOV ECX,dword ptr [ESI + 0x34]
00590048 : SUB ECX,dword ptr [ESI + 0x30]
0059004b : ADD ESP,0xc
0059004e : ADD ECX,dword ptr [ESI + 0x2c]
00590051 : CMP ECX,EBX
00590053 : JNC 0x0059016f
00590059 : LEA ESP,[ESP]
00590060 : LEA EDX,[ESP + 0x18]
00590064 : PUSH EDX
00590065 : MOV ECX,ESI
00590067 : CALL 0x0053ab10
0059006c : MOV EBX,EAX
0059006e : MOV EAX,dword ptr [EBP + 0x20]
00590071 : MOV ECX,dword ptr [EAX + 0x24]
00590074 : AND ECX,0xfffffffc
00590077 : ADD ECX,0x8
0059007a : PUSH ECX
0059007b : LEA ECX,[ESP + 0x14]
0059007f : CALL 0x0051c480
00590084 : PUSH 0x1
00590086 : LEA EDX,[ESP + 0x1c]
0059008a : PUSH EDX
0059008b : LEA EAX,[ESP + 0x18]
0059008f : PUSH EAX
00590090 : MOV ECX,EBP
00590092 : CALL 0x00562270
00590097 : MOV EBP,dword ptr [ESP + 0x10]
0059009b : AND EBP,0xfffffffc
0059009e : PUSH -0x1
005900a0 : LEA ECX,[EBP + 0x4]
005900a3 : PUSH ECX
005900a4 : CALL dword ptr [0x00b851cc]
005900aa : SUB EAX,0x1
005900ad : JNZ 0x005900b5
005900af : PUSH EBP
005900b0 : CALL 0x00515cf0
005900b5 : CMP EBX,0x1
005900b8 : JNZ 0x00590110
005900ba : MOV EAX,dword ptr [EDI + 0x24]
005900bd : CMP dword ptr [EDI + 0x1c],EAX
005900c0 : JNZ 0x005900ee
005900c2 : INC EAX
005900c3 : PUSH EAX
005900c4 : LEA ECX,[EDI + 0x20]
005900c7 : CALL 0x0058fb30
005900cc : MOV EDX,dword ptr [EDI + 0x1c]
005900cf : MOV EAX,dword ptr [EDI + 0x18]
005900d2 : MOV ECX,dword ptr [ESP + 0x30]
005900d6 : INC EDX
005900d7 : PUSH EDX
005900d8 : PUSH EAX
005900d9 : AND ECX,0xffff
005900df : PUSH ECX
005900e0 : PUSH 0xb8e7f8
005900e5 : PUSH ESI
005900e6 : CALL 0x0058c420
005900eb : ADD ESP,0x14
005900ee : MOV ECX,dword ptr [ESP + 0x2c]
005900f2 : CALL 0x005a13b0
005900f7 : MOVZX EDX,word ptr [ESP + 0x30]
005900fc : PUSH EDX
005900fd : PUSH 0xb8e7d0
00590102 : PUSH ESI
00590103 : CALL 0x0051d420
00590108 : ADD ESP,0xc
0059010b : INC dword ptr [EDI + 0x1c]
0059010e : JMP 0x00590151
00590110 : CMP EBX,0x55
00590113 : JNC 0x0059011e
00590115 : MOV EAX,dword ptr [EBX*0x4 + 0xd65e58]
0059011c : JMP 0x00590130
0059011e : LEA EAX,[EBX + 0xfffffc18]
00590124 : CMP EAX,0x9
00590127 : JA 0x00590142
00590129 : MOV EAX,dword ptr [EBX*0x4 + 0xd6500c]
00590130 : TEST EAX,EAX
00590132 : JZ 0x00590142
00590134 : MOV EDX,dword ptr [ESP + 0x2c]
00590138 : LEA ECX,[ESP + 0x18]
0059013c : PUSH ECX
0059013d : PUSH EDX
0059013e : CALL EAX
00590140 : JMP 0x00590151
00590142 : PUSH EBX
00590143 : PUSH 0xb8cd38
00590148 : PUSH ESI
00590149 : CALL 0x0051d420
0059014e : ADD ESP,0xc
00590151 : MOV ECX,ESI
00590153 : CALL 0x0053a1f0
00590158 : MOV EAX,dword ptr [ESI + 0x34]
0059015b : SUB EAX,dword ptr [ESI + 0x30]
0059015e : MOV EBP,dword ptr [ESP + 0x2c]
00590162 : ADD EAX,dword ptr [ESI + 0x2c]
00590165 : CMP EAX,dword ptr [ESP + 0x14]
00590169 : JC 0x00590060
0059016f : MOV EAX,dword ptr [EBP + 0x2e8]
00590175 : LEA ECX,[EAX + EAX*0x2 + 0xbd]
0059017c : CMP dword ptr [EBP + ECX*0x4],0x0
00590181 : POP EBX
00590182 : JA 0x00590190
00590184 : TEST EAX,EAX
00590186 : JNZ 0x005901cb
00590188 : CMP dword ptr [EBP + 0x30c],EAX
0059018e : JBE 0x005901cb
00590190 : MOV EAX,dword ptr [EDI + 0x24]
00590193 : CMP dword ptr [EDI + 0x1c],EAX
00590196 : JNZ 0x005901c4
00590198 : INC EAX
00590199 : PUSH EAX
0059019a : LEA ECX,[EDI + 0x20]
0059019d : CALL 0x0058fb30
005901a2 : MOV EDX,dword ptr [EDI + 0x1c]
005901a5 : MOV EAX,dword ptr [EDI + 0x18]
005901a8 : MOV ECX,dword ptr [ESP + 0x2c]
005901ac : INC EDX
005901ad : PUSH EDX
005901ae : PUSH EAX
005901af : AND ECX,0xffff
005901b5 : PUSH ECX
005901b6 : PUSH 0xb8e7f8
005901bb : PUSH ESI
005901bc : CALL 0x0058c420
005901c1 : ADD ESP,0x14
005901c4 : MOV ECX,EBP
005901c6 : CALL 0x005a13b0
005901cb : MOVZX EDX,word ptr [ESP + 0x2c]
005901d0 : PUSH EDX
005901d1 : XOR EAX,EAX
005901d3 : PUSH 0xb8e7ac
005901d8 : PUSH ESI
005901d9 : MOV dword ptr [EBP + 0x2e8],EAX
005901df : MOV dword ptr [EBP + 0x2ec],EAX
005901e5 : CALL 0x0051d420
005901ea : ADD ESP,0xc
005901ed : POP EDI
005901ee : POP ESI
005901ef : POP EBP
005901f0 : ADD ESP,0x18
005901f3 : RET 0x8
