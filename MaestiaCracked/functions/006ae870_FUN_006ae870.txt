PROGRAM  : Maestia.exe
FUNCTION : FUN_006ae870
ENTRY    : 006ae870
BODY     : [[006ae870, 006ae8b8] [006ae8c0, 006aebbf]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006ae870(int param_1)

{
  undefined4 uVar1;
  int iVar2;
  char *pcVar3;
  int iVar4;
  uint uVar5;
  char *pcVar6;
  char *_Str1;
  size_t _Size;
  byte *_Src;
  int *unaff_EDI;
  short local_10 [2];
  int local_c;
  int local_8;
  int local_4;
  
  iVar2 = unaff_EDI[4];
  iVar4 = unaff_EDI[0x12];
  local_c = 0;
  local_4 = iVar2;
  if ((char)unaff_EDI[0x17] == '\0') {
    pcVar3 = (char *)unaff_EDI[0x13];
    pcVar6 = pcVar3 + unaff_EDI[0x14];
    _Str1 = pcVar3;
    do {
      while ((((*pcVar3 == 'e' && (pcVar3 + 9 < pcVar6)) && (pcVar3[1] == 'e')) &&
             (((pcVar3[2] == 'x' && (pcVar3[3] == 'e')) && (pcVar3[4] == 'c'))))) {
        unaff_EDI[2] = (int)(pcVar3 + 9);
        pcVar3 = (char *)unaff_EDI[2];
        *unaff_EDI = (int)_Str1;
        while (_Str1 < pcVar3) {
          if ((*_Str1 == 'e') && (iVar4 = _strncmp(_Str1,"eexec",5), iVar4 == 0)) {
            unaff_EDI[2] = unaff_EDI[0x13] + unaff_EDI[0x14];
            (*(code *)unaff_EDI[8])();
            _Src = (byte *)*unaff_EDI;
            if (*_Src == 0xd) {
              _Src = _Src + 1;
              if (*_Src == 10) goto LAB_006aea82;
            }
            else {
              if (*_Src != 10) {
                return 3;
              }
LAB_006aea82:
              _Src = _Src + 1;
            }
            _Size = (unaff_EDI[0x13] - (int)_Src) + unaff_EDI[0x14];
            if (*(char *)((int)unaff_EDI + 0x5d) == '\0') {
              unaff_EDI[0x15] = unaff_EDI[0x13];
              *(undefined1 *)((int)unaff_EDI + 0x5e) = 1;
              unaff_EDI[0x13] = 0;
              unaff_EDI[0x14] = 0;
            }
            else {
              iVar2 = FUN_00688c00(iVar2,_Size + 1,&local_c);
              unaff_EDI[0x15] = iVar2;
              if (local_c != 0) {
                return local_c;
              }
            }
            unaff_EDI[0x16] = _Size;
            uVar5 = (uint)*_Src;
            if ((((uVar5 - 0x30 < 10) || (uVar5 - 0x61 < 6)) || (uVar5 - 0x41 < 6)) &&
               ((((uVar5 = (uint)_Src[1], uVar5 - 0x30 < 10 || (uVar5 - 0x61 < 6)) ||
                 (uVar5 - 0x41 < 6)) &&
                ((((uVar5 = (uint)_Src[2], uVar5 - 0x30 < 10 || (uVar5 - 0x61 < 6)) ||
                  (uVar5 - 0x41 < 6)) &&
                 (((uVar5 = (uint)_Src[3], uVar5 - 0x30 < 10 || (uVar5 - 0x61 < 6)) ||
                  (uVar5 - 0x41 < 6)))))))) {
              *unaff_EDI = (int)_Src;
              (**(code **)(*(int *)(param_1 + 4) + 0x18))();
              unaff_EDI[0x16] = local_4;
              *(undefined1 *)(local_4 + unaff_EDI[0x15]) = 0;
            }
            else {
              _memmove((void *)unaff_EDI[0x15],_Src,_Size);
            }
            goto LAB_006aeb73;
          }
          (*(code *)unaff_EDI[8])();
          if (unaff_EDI[3] != 0) break;
          (*(code *)unaff_EDI[7])();
          _Str1 = (char *)*unaff_EDI;
        }
        _Str1 = (char *)unaff_EDI[0x13];
        pcVar6 = _Str1 + unaff_EDI[0x14];
      }
      pcVar3 = pcVar3 + 1;
    } while (pcVar3 < pcVar6);
  }
  else {
    uVar1 = FUN_00687830(iVar4);
    unaff_EDI[0x16] = 0;
    iVar2 = FUN_006ae5a0(local_10);
    if (iVar2 != 0) {
      return iVar2;
    }
    local_c = 0;
    while (local_10[0] == -0x7ffe) {
      unaff_EDI[0x16] = unaff_EDI[0x16] + local_8;
      local_c = FUN_00687800(iVar4,local_8);
      if (local_c != 0) {
        return local_c;
      }
      local_c = FUN_006ae5a0(local_10);
      if (local_c != 0) {
        return local_c;
      }
    }
    if (unaff_EDI[0x16] != 0) {
      local_c = FUN_006877c0(iVar4,uVar1);
      if (local_c != 0) {
        return local_c;
      }
      iVar2 = FUN_00688c00(local_4,unaff_EDI[0x16],&local_c);
      unaff_EDI[0x15] = iVar2;
      if (local_c != 0) {
        return local_c;
      }
      unaff_EDI[0x16] = 0;
      iVar2 = FUN_006ae5a0(local_10);
      if (iVar2 == 0) {
        local_c = 0;
        do {
          iVar2 = local_8;
          if (local_10[0] != -0x7ffe) break;
          local_c = FUN_006888a0(iVar4,unaff_EDI[0x16] + unaff_EDI[0x15],local_8);
          if (local_c != 0) {
            return local_c;
          }
          unaff_EDI[0x16] = unaff_EDI[0x16] + iVar2;
          local_c = FUN_006ae5a0(local_10);
        } while (local_c == 0);
      }
      local_c = 0;
LAB_006aeb73:
      (**(code **)(param_1 + 0x10))(unaff_EDI[0x15],unaff_EDI[0x16],0xd971);
      *(undefined1 *)unaff_EDI[0x15] = 0x20;
      *(undefined1 *)(unaff_EDI[0x15] + 1) = 0x20;
      *(undefined1 *)(unaff_EDI[0x15] + 2) = 0x20;
      *(undefined1 *)(unaff_EDI[0x15] + 3) = 0x20;
      iVar2 = unaff_EDI[0x15];
      unaff_EDI[1] = iVar2;
      *unaff_EDI = iVar2;
      unaff_EDI[2] = unaff_EDI[0x16] + iVar2;
      return local_c;
    }
  }
  return 3;
}



============================================================
DISASSEMBLY
============================================================
006ae870 : SUB ESP,0x10
006ae873 : PUSH EBX
006ae874 : PUSH EBP
006ae875 : MOV EBP,dword ptr [EDI + 0x10]
006ae878 : XOR EBX,EBX
006ae87a : PUSH ESI
006ae87b : MOV ESI,dword ptr [EDI + 0x48]
006ae87e : MOV dword ptr [ESP + 0x18],EBP
006ae882 : MOV dword ptr [ESP + 0x10],EBX
006ae886 : CMP byte ptr [EDI + 0x5c],BL
006ae889 : JZ 0x006ae9c2
006ae88f : PUSH ESI
006ae890 : CALL 0x00687830
006ae895 : MOV EBP,EAX
006ae897 : LEA EAX,[ESP + 0x10]
006ae89b : MOV dword ptr [EDI + 0x58],EBX
006ae89e : PUSH EAX
006ae89f : LEA EBX,[ESP + 0x1c]
006ae8a3 : CALL 0x006ae5a0
006ae8a8 : ADD ESP,0x8
006ae8ab : MOV dword ptr [ESP + 0x10],EAX
006ae8af : TEST EAX,EAX
006ae8b1 : JNZ 0x006ae9fb
006ae8b7 : JMP 0x006ae8c0
006ae8c0 : MOV ECX,0x8002
006ae8c5 : CMP word ptr [ESP + 0xc],CX
006ae8ca : JNZ 0x006ae909
006ae8cc : MOV EAX,dword ptr [ESP + 0x14]
006ae8d0 : ADD dword ptr [EDI + 0x58],EAX
006ae8d3 : PUSH EAX
006ae8d4 : PUSH ESI
006ae8d5 : CALL 0x00687800
006ae8da : ADD ESP,0x8
006ae8dd : MOV dword ptr [ESP + 0x10],EAX
006ae8e1 : TEST EAX,EAX
006ae8e3 : JNZ 0x006ae9fb
006ae8e9 : LEA EDX,[ESP + 0xc]
006ae8ed : PUSH EDX
006ae8ee : LEA EBX,[ESP + 0x18]
006ae8f2 : CALL 0x006ae5a0
006ae8f7 : ADD ESP,0x4
006ae8fa : MOV dword ptr [ESP + 0x10],EAX
006ae8fe : TEST EAX,EAX
006ae900 : JZ 0x006ae8c0
006ae902 : POP ESI
006ae903 : POP EBP
006ae904 : POP EBX
006ae905 : ADD ESP,0x10
006ae908 : RET
006ae909 : CMP dword ptr [EDI + 0x58],0x0
006ae90d : JZ 0x006ae9f6
006ae913 : PUSH EBP
006ae914 : PUSH ESI
006ae915 : CALL 0x006877c0
006ae91a : ADD ESP,0x8
006ae91d : MOV dword ptr [ESP + 0x10],EAX
006ae921 : TEST EAX,EAX
006ae923 : JNZ 0x006ae9fb
006ae929 : MOV ECX,dword ptr [EDI + 0x58]
006ae92c : MOV EDX,dword ptr [ESP + 0x18]
006ae930 : LEA EAX,[ESP + 0x10]
006ae934 : PUSH EAX
006ae935 : PUSH ECX
006ae936 : PUSH EDX
006ae937 : CALL 0x00688c00
006ae93c : MOV dword ptr [EDI + 0x54],EAX
006ae93f : MOV EAX,dword ptr [ESP + 0x1c]
006ae943 : ADD ESP,0xc
006ae946 : TEST EAX,EAX
006ae948 : JNZ 0x006ae9fb
006ae94e : MOV dword ptr [EDI + 0x58],EAX
006ae951 : LEA EAX,[ESP + 0xc]
006ae955 : PUSH EAX
006ae956 : LEA EBX,[ESP + 0x18]
006ae95a : CALL 0x006ae5a0
006ae95f : ADD ESP,0x4
006ae962 : MOV dword ptr [ESP + 0x10],EAX
006ae966 : TEST EAX,EAX
006ae968 : JNZ 0x006ae9b5
006ae96a : LEA EBX,[EBX]
006ae970 : MOV ECX,0x8002
006ae975 : CMP word ptr [ESP + 0xc],CX
006ae97a : JNZ 0x006ae9b5
006ae97c : MOV EDX,dword ptr [EDI + 0x58]
006ae97f : MOV EBX,dword ptr [ESP + 0x14]
006ae983 : ADD EDX,dword ptr [EDI + 0x54]
006ae986 : PUSH EBX
006ae987 : PUSH EDX
006ae988 : PUSH ESI
006ae989 : CALL 0x006888a0
006ae98e : ADD ESP,0xc
006ae991 : MOV dword ptr [ESP + 0x10],EAX
006ae995 : TEST EAX,EAX
006ae997 : JNZ 0x006ae9fb
006ae999 : ADD dword ptr [EDI + 0x58],EBX
006ae99c : LEA EAX,[ESP + 0xc]
006ae9a0 : PUSH EAX
006ae9a1 : LEA EBX,[ESP + 0x18]
006ae9a5 : CALL 0x006ae5a0
006ae9aa : ADD ESP,0x4
006ae9ad : MOV dword ptr [ESP + 0x10],EAX
006ae9b1 : TEST EAX,EAX
006ae9b3 : JZ 0x006ae970
006ae9b5 : MOV dword ptr [ESP + 0x10],0x0
006ae9bd : JMP 0x006aeb73
006ae9c2 : MOV EDX,dword ptr [EDI + 0x4c]
006ae9c5 : MOV ECX,dword ptr [EDI + 0x50]
006ae9c8 : MOV EAX,EDX
006ae9ca : ADD ECX,EAX
006ae9cc : MOV BL,0x65
006ae9ce : MOV EDI,EDI
006ae9d0 : CMP byte ptr [EAX],BL
006ae9d2 : JNZ 0x006ae9f1
006ae9d4 : LEA ESI,[EAX + 0x9]
006ae9d7 : CMP ESI,ECX
006ae9d9 : JNC 0x006ae9f1
006ae9db : CMP byte ptr [EAX + 0x1],BL
006ae9de : JNZ 0x006ae9f1
006ae9e0 : CMP byte ptr [EAX + 0x2],0x78
006ae9e4 : JNZ 0x006ae9f1
006ae9e6 : CMP byte ptr [EAX + 0x3],BL
006ae9e9 : JNZ 0x006ae9f1
006ae9eb : CMP byte ptr [EAX + 0x4],0x63
006ae9ef : JZ 0x006aea02
006ae9f1 : INC EAX
006ae9f2 : CMP EAX,ECX
006ae9f4 : JC 0x006ae9d0
006ae9f6 : MOV EAX,0x3
006ae9fb : POP ESI
006ae9fc : POP EBP
006ae9fd : POP EBX
006ae9fe : ADD ESP,0x10
006aea01 : RET
006aea02 : ADD EAX,0x9
006aea05 : MOV dword ptr [EDI + 0x8],EAX
006aea08 : MOV ESI,dword ptr [EDI + 0x8]
006aea0b : MOV EAX,EDX
006aea0d : MOV dword ptr [EDI],EDX
006aea0f : CMP EAX,ESI
006aea11 : JNC 0x006aea49
006aea13 : CMP byte ptr [EAX],BL
006aea15 : JNZ 0x006aea2b
006aea17 : PUSH 0x5
006aea19 : PUSH 0xbeb85c
006aea1e : PUSH EAX
006aea1f : CALL 0x0063abcb
006aea24 : ADD ESP,0xc
006aea27 : TEST EAX,EAX
006aea29 : JZ 0x006aea58
006aea2b : MOV ECX,dword ptr [EDI + 0x20]
006aea2e : PUSH EDI
006aea2f : CALL ECX
006aea31 : ADD ESP,0x4
006aea34 : CMP dword ptr [EDI + 0xc],0x0
006aea38 : JNZ 0x006aea49
006aea3a : MOV EDX,dword ptr [EDI + 0x1c]
006aea3d : PUSH EDI
006aea3e : CALL EDX
006aea40 : MOV EAX,dword ptr [EDI]
006aea42 : ADD ESP,0x4
006aea45 : CMP EAX,ESI
006aea47 : JC 0x006aea13
006aea49 : MOV EDX,dword ptr [EDI + 0x4c]
006aea4c : MOV ECX,dword ptr [EDI + 0x50]
006aea4f : MOV EAX,ESI
006aea51 : ADD ECX,EDX
006aea53 : JMP 0x006ae9d0
006aea58 : MOV EAX,dword ptr [EDI + 0x4c]
006aea5b : ADD EAX,dword ptr [EDI + 0x50]
006aea5e : MOV ECX,dword ptr [EDI + 0x20]
006aea61 : PUSH EDI
006aea62 : MOV dword ptr [EDI + 0x8],EAX
006aea65 : CALL ECX
006aea67 : MOV ESI,dword ptr [EDI]
006aea69 : MOV AL,byte ptr [ESI]
006aea6b : ADD ESP,0x4
006aea6e : CMP AL,0xd
006aea70 : JNZ 0x006aea7a
006aea72 : INC ESI
006aea73 : CMP byte ptr [ESI],0xa
006aea76 : JNZ 0x006aea83
006aea78 : JMP 0x006aea82
006aea7a : CMP AL,0xa
006aea7c : JNZ 0x006ae9f6
006aea82 : INC ESI
006aea83 : MOV EAX,dword ptr [EDI + 0x4c]
006aea86 : MOV EBX,EAX
006aea88 : SUB EBX,ESI
006aea8a : ADD EBX,dword ptr [EDI + 0x50]
006aea8d : CMP byte ptr [EDI + 0x5d],0x0
006aea91 : JZ 0x006aeab6
006aea93 : LEA EDX,[ESP + 0x10]
006aea97 : PUSH EDX
006aea98 : LEA EAX,[EBX + 0x1]
006aea9b : PUSH EAX
006aea9c : PUSH EBP
006aea9d : CALL 0x00688c00
006aeaa2 : MOV dword ptr [EDI + 0x54],EAX
006aeaa5 : MOV EAX,dword ptr [ESP + 0x1c]
006aeaa9 : ADD ESP,0xc
006aeaac : TEST EAX,EAX
006aeaae : JNZ 0x006ae9fb
006aeab4 : JMP 0x006aeac5
006aeab6 : MOV dword ptr [EDI + 0x54],EAX
006aeab9 : XOR EAX,EAX
006aeabb : MOV byte ptr [EDI + 0x5e],0x1
006aeabf : MOV dword ptr [EDI + 0x4c],EAX
006aeac2 : MOV dword ptr [EDI + 0x50],EAX
006aeac5 : MOV dword ptr [EDI + 0x58],EBX
006aeac8 : MOVZX EAX,byte ptr [ESI]
006aeacb : LEA ECX,[EAX + -0x30]
006aeace : CMP ECX,0xa
006aead1 : JC 0x006aeae3
006aead3 : LEA EDX,[EAX + -0x61]
006aead6 : CMP EDX,0x6
006aead9 : JC 0x006aeae3
006aeadb : ADD EAX,-0x41
006aeade : CMP EAX,0x6
006aeae1 : JNC 0x006aeb37
006aeae3 : MOVZX EAX,byte ptr [ESI + 0x1]
006aeae7 : LEA ECX,[EAX + -0x30]
006aeaea : CMP ECX,0xa
006aeaed : JC 0x006aeaff
006aeaef : LEA EDX,[EAX + -0x61]
006aeaf2 : CMP EDX,0x6
006aeaf5 : JC 0x006aeaff
006aeaf7 : ADD EAX,-0x41
006aeafa : CMP EAX,0x6
006aeafd : JNC 0x006aeb37
006aeaff : MOVZX EAX,byte ptr [ESI + 0x2]
006aeb03 : LEA ECX,[EAX + -0x30]
006aeb06 : CMP ECX,0xa
006aeb09 : JC 0x006aeb1b
006aeb0b : LEA EDX,[EAX + -0x61]
006aeb0e : CMP EDX,0x6
006aeb11 : JC 0x006aeb1b
006aeb13 : ADD EAX,-0x41
006aeb16 : CMP EAX,0x6
006aeb19 : JNC 0x006aeb37
006aeb1b : MOVZX EAX,byte ptr [ESI + 0x3]
006aeb1f : LEA ECX,[EAX + -0x30]
006aeb22 : CMP ECX,0xa
006aeb25 : JC 0x006aeb47
006aeb27 : LEA EDX,[EAX + -0x61]
006aeb2a : CMP EDX,0x6
006aeb2d : JC 0x006aeb47
006aeb2f : ADD EAX,-0x41
006aeb32 : CMP EAX,0x6
006aeb35 : JC 0x006aeb47
006aeb37 : MOV EAX,dword ptr [EDI + 0x54]
006aeb3a : PUSH EBX
006aeb3b : PUSH ESI
006aeb3c : PUSH EAX
006aeb3d : CALL 0x00636880
006aeb42 : ADD ESP,0xc
006aeb45 : JMP 0x006aeb73
006aeb47 : MOV ECX,dword ptr [ESP + 0x20]
006aeb4b : PUSH 0x0
006aeb4d : LEA EAX,[ESP + 0x1c]
006aeb51 : PUSH EAX
006aeb52 : MOV dword ptr [EDI],ESI
006aeb54 : MOV EDX,dword ptr [ECX + 0x4]
006aeb57 : MOV ECX,dword ptr [EDI + 0x54]
006aeb5a : MOV EDX,dword ptr [EDX + 0x18]
006aeb5d : PUSH EBX
006aeb5e : PUSH ECX
006aeb5f : PUSH EDI
006aeb60 : CALL EDX
006aeb62 : MOV EAX,dword ptr [ESP + 0x2c]
006aeb66 : MOV ECX,dword ptr [EDI + 0x54]
006aeb69 : MOV dword ptr [EDI + 0x58],EAX
006aeb6c : ADD ESP,0x14
006aeb6f : MOV byte ptr [EAX + ECX*0x1],0x0
006aeb73 : MOV EDX,dword ptr [EDI + 0x58]
006aeb76 : MOV EAX,dword ptr [EDI + 0x54]
006aeb79 : MOV ECX,dword ptr [ESP + 0x20]
006aeb7d : PUSH 0xd971
006aeb82 : PUSH EDX
006aeb83 : MOV EDX,dword ptr [ECX + 0x10]
006aeb86 : PUSH EAX
006aeb87 : CALL EDX
006aeb89 : MOV ECX,dword ptr [EDI + 0x54]
006aeb8c : MOV AL,0x20
006aeb8e : MOV byte ptr [ECX],AL
006aeb90 : MOV EDX,dword ptr [EDI + 0x54]
006aeb93 : MOV byte ptr [EDX + 0x1],AL
006aeb96 : MOV ECX,dword ptr [EDI + 0x54]
006aeb99 : MOV byte ptr [ECX + 0x2],AL
006aeb9c : MOV EDX,dword ptr [EDI + 0x54]
006aeb9f : MOV byte ptr [EDX + 0x3],AL
006aeba2 : MOV EAX,dword ptr [EDI + 0x54]
006aeba5 : MOV ECX,dword ptr [EDI + 0x58]
006aeba8 : ADD ESP,0xc
006aebab : POP ESI
006aebac : ADD ECX,EAX
006aebae : POP EBP
006aebaf : MOV dword ptr [EDI + 0x4],EAX
006aebb2 : MOV dword ptr [EDI],EAX
006aebb4 : MOV EAX,dword ptr [ESP + 0x8]
006aebb8 : MOV dword ptr [EDI + 0x8],ECX
006aebbb : POP EBX
006aebbc : ADD ESP,0x10
006aebbf : RET
