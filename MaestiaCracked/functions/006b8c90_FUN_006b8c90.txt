PROGRAM  : Maestia.exe
FUNCTION : FUN_006b8c90
ENTRY    : 006b8c90
BODY     : [[006b8c90, 006b8f4c] [006b8f50, 006b9036]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006b8c90(int param_1)

{
  short *psVar1;
  int iVar2;
  ushort uVar3;
  short sVar4;
  int *in_EAX;
  int iVar5;
  uint uVar6;
  uint uVar7;
  int iVar8;
  short *psVar9;
  uint *puVar10;
  int iVar11;
  int local_40;
  int iStack_3c;
  short *psStack_38;
  int local_34;
  int local_30;
  int local_2c;
  int local_28;
  uint uStack_24;
  int iStack_20;
  int iStack_1c;
  int iStack_18;
  uint *local_14;
  uint uStack_10;
  int iStack_8;
  int iStack_4;
  
  puVar10 = *(uint **)(param_1 + 0x2cc);
  iVar11 = in_EAX[7];
  local_30 = 0;
  local_2c = 0;
  local_28 = 0;
  local_34 = iVar11;
  local_14 = puVar10;
  if ((((puVar10 == (uint *)0x0) || (*(int *)(param_1 + 0x2a0) == 0)) ||
      (local_40 = (**(code **)(param_1 + 0x1fc))(param_1,0x63766172), local_40 != 0)) ||
     (local_40 = FUN_00688900(), local_40 != 0)) {
    local_40 = 0;
  }
  else {
    iVar8 = in_EAX[8];
    iVar2 = *in_EAX;
    iVar5 = FUN_006879a0();
    if (iVar5 == 0x10000) {
      local_30 = FUN_0068a220(iVar11,4,0,*puVar10,0,&local_40);
      uVar6 = uStack_10;
      if (((local_40 == 0) &&
          (local_2c = FUN_0068a220(iVar11,4,0,*puVar10,0,&local_40), uVar6 = uStack_10,
          local_40 == 0)) &&
         (local_28 = FUN_0068a220(iVar11,4,0,*puVar10,0,&local_40), uVar6 = uStack_10, local_40 == 0
         )) {
        uVar6 = FUN_00687940();
        uVar7 = FUN_00687940();
        iStack_3c = (uVar7 & 0xffff) + (iVar8 - iVar2);
        uVar7 = uVar6 & 0xfff;
        iVar11 = local_34;
        uVar6 = uStack_10;
        while (uStack_10 = uVar7, local_34 = iVar11, uStack_10 != 0) {
          uStack_24 = FUN_00687940();
          uStack_24 = uStack_24 & 0xffff;
          uVar3 = FUN_00687940();
          if ((uVar3 & 0x8000) == 0) {
            if (((uVar3 & 0x4000) != 0) && (uVar6 = 0, (*puVar10 & 0x7fffffff) != 0)) {
              do {
                FUN_00687940();
                uVar6 = uVar6 + 1;
              } while (uVar6 < *puVar10 * 2);
            }
LAB_006b8fe7:
            iStack_3c = iStack_3c + uStack_24;
          }
          else {
            uVar6 = 0;
            if (*puVar10 != 0) {
              do {
                sVar4 = FUN_00687940();
                *(int *)(local_30 + uVar6 * 4) = sVar4 * 4;
                uVar6 = uVar6 + 1;
              } while (uVar6 < *puVar10);
            }
            if ((uVar3 & 0x4000) != 0) {
              uVar6 = 0;
              if (*puVar10 != 0) {
                do {
                  sVar4 = FUN_00687940();
                  *(int *)(local_2c + uVar6 * 4) = sVar4 * 4;
                  uVar6 = uVar6 + 1;
                } while (uVar6 < *puVar10);
              }
              uVar6 = 0;
              if (*puVar10 != 0) {
                do {
                  sVar4 = FUN_00687940();
                  *(int *)(local_28 + uVar6 * 4) = sVar4 * 4;
                  uVar6 = uVar6 + 1;
                } while (uVar6 < *puVar10);
              }
            }
            iStack_1c = FUN_006b8780(puVar10,uVar3,local_28);
            if ((iStack_1c == 0) || ((uVar3 & 0x2000) == 0)) goto LAB_006b8fe7;
            iStack_4 = in_EAX[8] - *in_EAX;
            in_EAX[8] = *in_EAX + iStack_3c;
            iVar8 = FUN_006b8160(&iStack_20);
            iVar11 = iStack_20;
            iStack_8 = iVar8;
            psVar9 = (short *)FUN_006b8290();
            psStack_38 = psVar9;
            if ((iVar8 == 0) || (psVar9 == (short *)0x0)) {
LAB_006b8f8b:
              if (iVar8 != -1) {
                FUN_00687f30(local_34,iVar8);
              }
            }
            else {
              if (iVar8 != -1) {
                if (iVar11 != 0) {
                  iVar8 = iVar8 - (int)psVar9;
                  iStack_18 = iStack_20;
                  do {
                    psVar1 = (short *)(*(int *)(param_1 + 0x2a0) +
                                      (uint)*(ushort *)((int)psVar9 + iVar8) * 2);
                    sVar4 = FUN_00685ea0((int)*psVar9,iStack_1c);
                    *psVar1 = *psVar1 + sVar4;
                    psVar9 = psVar9 + 1;
                    iStack_18 = iStack_18 + -1;
                  } while (iStack_18 != 0);
                  iStack_18 = 0;
                  iVar8 = iStack_8;
                  puVar10 = local_14;
                }
                goto LAB_006b8f8b;
              }
              uVar6 = 0;
              if (*(int *)(param_1 + 0x29c) != 0) {
                do {
                  psVar9 = (short *)(*(int *)(param_1 + 0x2a0) + uVar6 * 2);
                  sVar4 = FUN_00685ea0((int)psStack_38[uVar6],iStack_1c);
                  *psVar9 = *psVar9 + sVar4;
                  uVar6 = uVar6 + 1;
                  puVar10 = local_14;
                } while (uVar6 < *(uint *)(param_1 + 0x29c));
              }
            }
            FUN_00687f30(local_34,psStack_38);
            iStack_3c = iStack_3c + uStack_24;
            in_EAX[8] = *in_EAX + iStack_4;
          }
          uVar6 = uStack_10 - 1;
          iVar11 = local_34;
          uVar7 = uVar6;
        }
      }
    }
    else {
      local_40 = 0;
      uVar6 = uStack_10;
    }
    uStack_10 = uVar6;
    FUN_006889b0();
  }
  FUN_00687f30(iVar11,local_30);
  FUN_00687f30(iVar11,local_2c);
  FUN_00687f30(iVar11,local_28);
  return local_40;
}



============================================================
DISASSEMBLY
============================================================
006b8c90 : SUB ESP,0x40
006b8c93 : PUSH EBX
006b8c94 : PUSH EBP
006b8c95 : PUSH ESI
006b8c96 : PUSH EDI
006b8c97 : MOV EDI,EAX
006b8c99 : MOV EAX,dword ptr [ESP + 0x54]
006b8c9d : MOV EBP,dword ptr [EAX + 0x2cc]
006b8ca3 : MOV ESI,dword ptr [EDI + 0x1c]
006b8ca6 : XOR EBX,EBX
006b8ca8 : MOV dword ptr [ESP + 0x1c],ESI
006b8cac : MOV dword ptr [ESP + 0x20],EBX
006b8cb0 : MOV dword ptr [ESP + 0x24],EBX
006b8cb4 : MOV dword ptr [ESP + 0x28],EBX
006b8cb8 : MOV dword ptr [ESP + 0x3c],EBP
006b8cbc : CMP EBP,EBX
006b8cbe : JNZ 0x006b8cc9
006b8cc0 : MOV dword ptr [ESP + 0x10],EBX
006b8cc4 : JMP 0x006b9007
006b8cc9 : CMP dword ptr [EAX + 0x2a0],EBX
006b8ccf : JZ 0x006b8cc0
006b8cd1 : MOV EDX,dword ptr [EAX + 0x1fc]
006b8cd7 : LEA ECX,[ESP + 0x44]
006b8cdb : PUSH ECX
006b8cdc : PUSH EDI
006b8cdd : PUSH 0x63766172
006b8ce2 : PUSH EAX
006b8ce3 : CALL EDX
006b8ce5 : ADD ESP,0x10
006b8ce8 : MOV dword ptr [ESP + 0x10],EAX
006b8cec : CMP EAX,EBX
006b8cee : JNZ 0x006b8cc0
006b8cf0 : MOV EAX,dword ptr [ESP + 0x44]
006b8cf4 : PUSH EAX
006b8cf5 : PUSH EDI
006b8cf6 : CALL 0x00688900
006b8cfb : ADD ESP,0x8
006b8cfe : MOV dword ptr [ESP + 0x10],EAX
006b8d02 : CMP EAX,EBX
006b8d04 : JNZ 0x006b8cc0
006b8d06 : MOV EBX,dword ptr [EDI + 0x20]
006b8d09 : SUB EBX,dword ptr [EDI]
006b8d0b : PUSH EDI
006b8d0c : CALL 0x006879a0
006b8d11 : ADD ESP,0x4
006b8d14 : CMP EAX,0x10000
006b8d19 : JZ 0x006b8d28
006b8d1b : MOV dword ptr [ESP + 0x10],0x0
006b8d23 : JMP 0x006b8ffe
006b8d28 : MOV EDX,dword ptr [EBP]
006b8d2b : LEA ECX,[ESP + 0x10]
006b8d2f : PUSH ECX
006b8d30 : PUSH 0x0
006b8d32 : PUSH EDX
006b8d33 : PUSH 0x0
006b8d35 : PUSH 0x4
006b8d37 : PUSH ESI
006b8d38 : CALL 0x0068a220
006b8d3d : ADD ESP,0x18
006b8d40 : CMP dword ptr [ESP + 0x10],0x0
006b8d45 : MOV dword ptr [ESP + 0x20],EAX
006b8d49 : JNZ 0x006b8ffe
006b8d4f : MOV ECX,dword ptr [EBP]
006b8d52 : LEA EAX,[ESP + 0x10]
006b8d56 : PUSH EAX
006b8d57 : PUSH 0x0
006b8d59 : PUSH ECX
006b8d5a : PUSH 0x0
006b8d5c : PUSH 0x4
006b8d5e : PUSH ESI
006b8d5f : CALL 0x0068a220
006b8d64 : ADD ESP,0x18
006b8d67 : CMP dword ptr [ESP + 0x10],0x0
006b8d6c : MOV dword ptr [ESP + 0x24],EAX
006b8d70 : JNZ 0x006b8ffe
006b8d76 : MOV EAX,dword ptr [EBP]
006b8d79 : LEA EDX,[ESP + 0x10]
006b8d7d : PUSH EDX
006b8d7e : PUSH 0x0
006b8d80 : PUSH EAX
006b8d81 : PUSH 0x0
006b8d83 : PUSH 0x4
006b8d85 : PUSH ESI
006b8d86 : CALL 0x0068a220
006b8d8b : ADD ESP,0x18
006b8d8e : CMP dword ptr [ESP + 0x10],0x0
006b8d93 : MOV dword ptr [ESP + 0x28],EAX
006b8d97 : JNZ 0x006b8ffe
006b8d9d : PUSH EDI
006b8d9e : CALL 0x00687940
006b8da3 : PUSH EDI
006b8da4 : MOVZX ESI,AX
006b8da7 : CALL 0x00687940
006b8dac : MOVZX EAX,AX
006b8daf : ADD EAX,EBX
006b8db1 : ADD ESP,0x8
006b8db4 : AND ESI,0xfff
006b8dba : MOV dword ptr [ESP + 0x14],EAX
006b8dbe : JBE 0x006b8ffa
006b8dc4 : MOV dword ptr [ESP + 0x40],ESI
006b8dc8 : PUSH EDI
006b8dc9 : CALL 0x00687940
006b8dce : MOVZX ECX,AX
006b8dd1 : PUSH EDI
006b8dd2 : MOV dword ptr [ESP + 0x34],ECX
006b8dd6 : CALL 0x00687940
006b8ddb : MOVZX EBX,AX
006b8dde : ADD ESP,0x8
006b8de1 : TEST EBX,0x8000
006b8de7 : JZ 0x006b8fc3
006b8ded : XOR ESI,ESI
006b8def : CMP dword ptr [EBP],ESI
006b8df2 : JBE 0x006b8e11
006b8df4 : PUSH EDI
006b8df5 : CALL 0x00687940
006b8dfa : MOVSX EDX,AX
006b8dfd : MOV EAX,dword ptr [ESP + 0x24]
006b8e01 : ADD EDX,EDX
006b8e03 : ADD EDX,EDX
006b8e05 : MOV dword ptr [EAX + ESI*0x4],EDX
006b8e08 : INC ESI
006b8e09 : ADD ESP,0x4
006b8e0c : CMP ESI,dword ptr [EBP]
006b8e0f : JC 0x006b8df4
006b8e11 : TEST EBX,0x4000
006b8e17 : JZ 0x006b8e5f
006b8e19 : XOR ESI,ESI
006b8e1b : CMP dword ptr [EBP],ESI
006b8e1e : JBE 0x006b8e3d
006b8e20 : PUSH EDI
006b8e21 : CALL 0x00687940
006b8e26 : MOV EDX,dword ptr [ESP + 0x28]
006b8e2a : MOVSX ECX,AX
006b8e2d : ADD ECX,ECX
006b8e2f : ADD ECX,ECX
006b8e31 : MOV dword ptr [EDX + ESI*0x4],ECX
006b8e34 : INC ESI
006b8e35 : ADD ESP,0x4
006b8e38 : CMP ESI,dword ptr [EBP]
006b8e3b : JC 0x006b8e20
006b8e3d : XOR ESI,ESI
006b8e3f : CMP dword ptr [EBP],ESI
006b8e42 : JBE 0x006b8e5f
006b8e44 : PUSH EDI
006b8e45 : CALL 0x00687940
006b8e4a : MOV ECX,dword ptr [ESP + 0x2c]
006b8e4e : CWDE
006b8e4f : ADD EAX,EAX
006b8e51 : ADD EAX,EAX
006b8e53 : MOV dword ptr [ECX + ESI*0x4],EAX
006b8e56 : INC ESI
006b8e57 : ADD ESP,0x4
006b8e5a : CMP ESI,dword ptr [EBP]
006b8e5d : JC 0x006b8e44
006b8e5f : MOV EDX,dword ptr [ESP + 0x28]
006b8e63 : MOV EAX,dword ptr [ESP + 0x20]
006b8e67 : PUSH EDX
006b8e68 : MOV EDX,dword ptr [ESP + 0x28]
006b8e6c : PUSH EBX
006b8e6d : PUSH EBP
006b8e6e : CALL 0x006b8780
006b8e73 : ADD ESP,0xc
006b8e76 : MOV dword ptr [ESP + 0x34],EAX
006b8e7a : TEST EAX,EAX
006b8e7c : JZ 0x006b8fe7
006b8e82 : TEST EBX,0x2000
006b8e88 : JZ 0x006b8fe7
006b8e8e : MOV EAX,dword ptr [EDI]
006b8e90 : MOV ECX,dword ptr [EDI + 0x20]
006b8e93 : SUB ECX,EAX
006b8e95 : MOV dword ptr [ESP + 0x4c],ECX
006b8e99 : MOV ECX,dword ptr [ESP + 0x14]
006b8e9d : LEA EDX,[ESP + 0x30]
006b8ea1 : ADD EAX,ECX
006b8ea3 : PUSH EDX
006b8ea4 : MOV dword ptr [EDI + 0x20],EAX
006b8ea7 : CALL 0x006b8160
006b8eac : MOV ESI,dword ptr [ESP + 0x34]
006b8eb0 : ADD ESP,0x4
006b8eb3 : MOV EBX,EAX
006b8eb5 : MOV dword ptr [ESP + 0x48],EBX
006b8eb9 : TEST ESI,ESI
006b8ebb : JNZ 0x006b8ec9
006b8ebd : MOV EAX,dword ptr [ESP + 0x54]
006b8ec1 : MOV EAX,dword ptr [EAX + 0x29c]
006b8ec7 : JMP 0x006b8ecb
006b8ec9 : MOV EAX,ESI
006b8ecb : PUSH EAX
006b8ecc : PUSH EDI
006b8ecd : CALL 0x006b8290
006b8ed2 : ADD ESP,0x8
006b8ed5 : MOV dword ptr [ESP + 0x18],EAX
006b8ed9 : TEST EBX,EBX
006b8edb : JZ 0x006b8f8b
006b8ee1 : TEST EAX,EAX
006b8ee3 : JZ 0x006b8f8b
006b8ee9 : CMP EBX,-0x1
006b8eec : JNZ 0x006b8f39
006b8eee : MOV ECX,dword ptr [ESP + 0x54]
006b8ef2 : XOR ESI,ESI
006b8ef4 : CMP dword ptr [ECX + 0x29c],ESI
006b8efa : JBE 0x006b8fa2
006b8f00 : MOV EDX,dword ptr [ESP + 0x54]
006b8f04 : MOV EAX,dword ptr [EDX + 0x2a0]
006b8f0a : MOV EDX,dword ptr [ESP + 0x18]
006b8f0e : MOV ECX,dword ptr [ESP + 0x34]
006b8f12 : LEA EBX,[EAX + ESI*0x2]
006b8f15 : MOVSX EAX,word ptr [EDX + ESI*0x2]
006b8f19 : PUSH ECX
006b8f1a : PUSH EAX
006b8f1b : CALL 0x00685ea0
006b8f20 : MOV ECX,dword ptr [ESP + 0x5c]
006b8f24 : ADD word ptr [EBX],AX
006b8f27 : INC ESI
006b8f28 : ADD ESP,0x8
006b8f2b : CMP ESI,dword ptr [ECX + 0x29c]
006b8f31 : JC 0x006b8f00
006b8f33 : MOV EBP,dword ptr [ESP + 0x3c]
006b8f37 : JMP 0x006b8f9e
006b8f39 : TEST ESI,ESI
006b8f3b : JBE 0x006b8f8b
006b8f3d : MOV EDX,dword ptr [ESP + 0x30]
006b8f41 : MOV EBP,EBX
006b8f43 : MOV ESI,EAX
006b8f45 : SUB EBP,EAX
006b8f47 : MOV dword ptr [ESP + 0x38],EDX
006b8f4b : JMP 0x006b8f50
006b8f50 : MOVZX EAX,word ptr [ESI + EBP*0x1]
006b8f54 : MOV ECX,dword ptr [ESP + 0x54]
006b8f58 : MOV EDX,dword ptr [ECX + 0x2a0]
006b8f5e : MOVSX ECX,word ptr [ESI]
006b8f61 : LEA EBX,[EDX + EAX*0x2]
006b8f64 : MOV EAX,dword ptr [ESP + 0x34]
006b8f68 : PUSH EAX
006b8f69 : PUSH ECX
006b8f6a : CALL 0x00685ea0
006b8f6f : ADD word ptr [EBX],AX
006b8f72 : ADD ESP,0x8
006b8f75 : ADD ESI,0x2
006b8f78 : SUB dword ptr [ESP + 0x38],0x1
006b8f7d : JNZ 0x006b8f50
006b8f7f : MOV EBP,dword ptr [ESP + 0x3c]
006b8f83 : MOV EBX,dword ptr [ESP + 0x48]
006b8f87 : MOV EAX,dword ptr [ESP + 0x18]
006b8f8b : CMP EBX,-0x1
006b8f8e : JZ 0x006b8fa2
006b8f90 : MOV EDX,dword ptr [ESP + 0x1c]
006b8f94 : PUSH EBX
006b8f95 : PUSH EDX
006b8f96 : CALL 0x00687f30
006b8f9b : ADD ESP,0x8
006b8f9e : MOV EAX,dword ptr [ESP + 0x18]
006b8fa2 : PUSH EAX
006b8fa3 : MOV EAX,dword ptr [ESP + 0x20]
006b8fa7 : PUSH EAX
006b8fa8 : CALL 0x00687f30
006b8fad : MOV ECX,dword ptr [ESP + 0x34]
006b8fb1 : MOV EDX,dword ptr [EDI]
006b8fb3 : ADD dword ptr [ESP + 0x1c],ECX
006b8fb7 : ADD ESP,0x8
006b8fba : ADD EDX,dword ptr [ESP + 0x4c]
006b8fbe : MOV dword ptr [EDI + 0x20],EDX
006b8fc1 : JMP 0x006b8fef
006b8fc3 : TEST EBX,0x4000
006b8fc9 : JZ 0x006b8fe7
006b8fcb : MOV ECX,dword ptr [EBP]
006b8fce : XOR ESI,ESI
006b8fd0 : ADD ECX,ECX
006b8fd2 : JZ 0x006b8fe7
006b8fd4 : PUSH EDI
006b8fd5 : CALL 0x00687940
006b8fda : MOV EDX,dword ptr [EBP]
006b8fdd : INC ESI
006b8fde : ADD EDX,EDX
006b8fe0 : ADD ESP,0x4
006b8fe3 : CMP ESI,EDX
006b8fe5 : JC 0x006b8fd4
006b8fe7 : MOV EAX,dword ptr [ESP + 0x2c]
006b8feb : ADD dword ptr [ESP + 0x14],EAX
006b8fef : SUB dword ptr [ESP + 0x40],0x1
006b8ff4 : JNZ 0x006b8dc8
006b8ffa : MOV ESI,dword ptr [ESP + 0x1c]
006b8ffe : PUSH EDI
006b8fff : CALL 0x006889b0
006b9004 : ADD ESP,0x4
006b9007 : MOV ECX,dword ptr [ESP + 0x20]
006b900b : PUSH ECX
006b900c : PUSH ESI
006b900d : CALL 0x00687f30
006b9012 : MOV EDX,dword ptr [ESP + 0x2c]
006b9016 : PUSH EDX
006b9017 : PUSH ESI
006b9018 : CALL 0x00687f30
006b901d : MOV EAX,dword ptr [ESP + 0x38]
006b9021 : PUSH EAX
006b9022 : PUSH ESI
006b9023 : CALL 0x00687f30
006b9028 : MOV EAX,dword ptr [ESP + 0x28]
006b902c : ADD ESP,0x18
006b902f : POP EDI
006b9030 : POP ESI
006b9031 : POP EBP
006b9032 : POP EBX
006b9033 : ADD ESP,0x40
006b9036 : RET
