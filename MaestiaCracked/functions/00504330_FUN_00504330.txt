PROGRAM  : Maestia.exe
FUNCTION : FUN_00504330
ENTRY    : 00504330
BODY     : [[00504330, 005046e2]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00504330(int param_1,int param_2)

{
  int *piVar1;
  float fVar2;
  undefined2 uVar3;
  int iVar4;
  undefined2 uVar5;
  GRefCountImpl *this;
  uint uVar6;
  undefined4 uVar7;
  int iVar8;
  int *piVar9;
  ushort uVar10;
  int *in_ECX;
  char *pcVar11;
  undefined4 uVar12;
  int *local_28 [2];
  longlong local_20;
  undefined **ppuStack_18;
  undefined4 uStack_14;
  undefined4 uStack_10;
  undefined2 uStack_c;
  undefined2 uStack_a;
  undefined2 uStack_8;
  undefined2 uStack_6;
  undefined2 uStack_4;
  undefined2 uStack_2;
  
  iVar4 = param_2;
  FUN_005603f0();
  FUN_0055ed00();
  if (*(short *)(in_ECX[0x27] + 0x18) != 0) {
    FUN_00502290(local_28,in_ECX[0x27] + 0x10);
    if (local_28[0] == (int *)0x0) {
      this = (GRefCountImpl *)(**(code **)(*in_ECX + 0x94))();
      if (this != (GRefCountImpl *)0x0) {
        GRefCountImpl::AddRef(this);
        uVar6 = *(uint *)(in_ECX[0x27] + 0x48);
        uVar5 = (undefined2)in_ECX[4];
        uVar3 = *(undefined2 *)(in_ECX[0x27] + 0x18);
        pcVar11 = 
        "Error: Resource for font id = %d is not found in text field id = %d, def text = \'%s\'\n";
LAB_005043b9:
        FUN_00500460(this + 0xc,pcVar11,uVar3,uVar5,(uVar6 & 0xfffffffc) + 8);
        GRefCountImpl::Release(this);
      }
    }
    else {
      uVar6 = (**(code **)(*local_28[0] + 8))();
      piVar9 = local_28[0];
      if ((uVar6 & 0xff00) == 0x200) {
        if (local_28[0] == (int *)0x0) goto LAB_005044fd;
        piVar1 = local_28[0] + 3;
        uVar12 = 0xffffffff;
        uVar7 = (**(code **)(*(int *)local_28[0][3] + 0x3c))(0xffffffff);
        FUN_0055fb50(uVar7,uVar12);
        if (-1 < *(char *)(in_ECX[0x27] + 0x50)) {
          FUN_0055fbc0((byte)(*(uint *)(*piVar1 + 0x14) >> 1) & 1);
          FUN_0055fc30(*(byte *)(*piVar1 + 0x14) & 1);
          if (((*(byte *)(in_ECX[0x27] + 0x51) & 1) == 0) &&
             ((~(byte)(*(uint *)(*piVar1 + 0x14) >> 6) & 1) != 0)) {
            iVar8 = FUN_00500440(0x1c);
            if (iVar8 == 0) {
              piVar9 = (int *)0x0;
            }
            else {
              piVar9 = (int *)FUN_005007e0(0,piVar9,0,0,*(undefined4 *)(in_ECX[0x29] + 0x28));
            }
            FUN_0055fb80(piVar9);
            if ((piVar9 != (int *)0x0) && (*piVar9 = *piVar9 + -1, *piVar9 == 0)) {
              FUN_00500860();
              FUN_00515cf0(piVar9);
            }
          }
        }
      }
      else {
        this = (GRefCountImpl *)(**(code **)(*in_ECX + 0x94))();
        if (this != (GRefCountImpl *)0x0) {
          GRefCountImpl::AddRef(this);
          uVar6 = *(uint *)(in_ECX[0x27] + 0x48);
          uVar5 = (undefined2)in_ECX[4];
          uVar3 = *(undefined2 *)(in_ECX[0x27] + 0x18);
          pcVar11 = 
          "Error: Font id = %d is referring to non-font resource in text field id = %d, def text = \'%s\'\n"
          ;
          goto LAB_005043b9;
        }
      }
    }
    if (local_28[0] != (int *)0x0) {
      FUN_00524240();
    }
  }
LAB_005044fd:
  local_20 = (longlong)ROUND(*(float *)(in_ECX[0x27] + 0x2c));
  uVar5 = (undefined2)local_20;
  if (0x10000 < (uint)local_20) {
    uVar5 = 0xffff;
  }
  *(ushort *)(param_1 + 0x2a) = *(ushort *)(param_1 + 0x2a) | 8;
  *(undefined2 *)(param_1 + 0x26) = uVar5;
  uVar7 = *(undefined4 *)(in_ECX[0x27] + 0x30);
  *(ushort *)(param_1 + 0x2a) = *(ushort *)(param_1 + 0x2a) | 1;
  *(undefined4 *)(param_1 + 0x20) = uVar7;
  uStack_c = 0;
  uStack_6 = 0;
  uStack_14 = 1;
  ppuStack_18 = &PTR_FUN_00b86064;
  uStack_10 = 0;
  uStack_a = 0;
  uStack_8 = 0;
  uStack_4 = 0;
  uStack_2 = 0;
  switch(*(undefined4 *)(in_ECX[0x27] + 0x54)) {
  case 0:
    uVar10 = *(ushort *)(param_2 + 0x16) & 63999 | 1;
    goto LAB_005045fc;
  case 1:
    *(ushort *)(param_2 + 0x16) = *(ushort *)(param_2 + 0x16) & 0xfbff | 0x201;
    break;
  case 2:
    *(ushort *)(param_2 + 0x16) = *(ushort *)(param_2 + 0x16) | 0x601;
    break;
  case 3:
    uVar10 = *(ushort *)(param_2 + 0x16) & 0xfdff | 0x401;
LAB_005045fc:
    *(ushort *)(param_2 + 0x16) = uVar10;
  }
  if ((*(ushort *)(in_ECX[0x27] + 0x50) >> 9 & 1) != 0) {
    fVar2 = *(float *)(in_ECX[0x27] + 0x38);
    *(ushort *)(param_2 + 0x16) = *(ushort *)(param_2 + 0x16) | 0x10;
    uVar10 = *(ushort *)(param_2 + 0x16);
    param_2._0_2_ = (undefined2)(int)ROUND(fVar2 / 20.0);
    *(undefined2 *)(iVar4 + 0x12) = (undefined2)param_2;
    fVar2 = *(float *)(in_ECX[0x27] + 0x3c);
    *(ushort *)(iVar4 + 0x16) = uVar10 | 0x20;
    param_2._0_2_ = (undefined2)(int)ROUND(fVar2 / 20.0);
    *(undefined2 *)(iVar4 + 0x14) = (undefined2)param_2;
    uVar5 = FUN_0063b380();
    *(undefined2 *)(iVar4 + 0xe) = uVar5;
    *(ushort *)(iVar4 + 0x16) = uVar10 | 0x24;
    uVar5 = FUN_0063b380();
    *(undefined2 *)(iVar4 + 0x10) = uVar5;
    *(ushort *)(iVar4 + 0x16) = uVar10 | 0x2c;
  }
  ppuStack_18 = &PTR_FUN_00b86064;
  FUN_0055e7c0();
  GRefCountImplCore::~GRefCountImplCore((GRefCountImplCore *)&ppuStack_18);
  return;
}



============================================================
DISASSEMBLY
============================================================
00504330 : SUB ESP,0x28
00504333 : PUSH EBX
00504334 : PUSH EBP
00504335 : PUSH ESI
00504336 : PUSH EDI
00504337 : MOV EDI,dword ptr [ESP + 0x3c]
0050433b : MOV ESI,ECX
0050433d : MOV ECX,EDI
0050433f : CALL 0x005603f0
00504344 : MOV EBP,dword ptr [ESP + 0x40]
00504348 : MOV ECX,EBP
0050434a : CALL 0x0055ed00
0050434f : MOV EAX,dword ptr [ESI + 0x9c]
00504355 : MOVZX ECX,word ptr [EAX + 0x18]
00504359 : TEST ECX,ECX
0050435b : JZ 0x005044fd
00504361 : MOV ECX,dword ptr [ESI + 0xa4]
00504367 : ADD EAX,0x10
0050436a : PUSH EAX
0050436b : LEA EDX,[ESP + 0x14]
0050436f : PUSH EDX
00504370 : CALL 0x00502290
00504375 : MOV ECX,dword ptr [ESP + 0x10]
00504379 : TEST ECX,ECX
0050437b : JNZ 0x005043d1
0050437d : MOV EAX,dword ptr [ESI]
0050437f : MOV EDX,dword ptr [EAX + 0x94]
00504385 : MOV ECX,ESI
00504387 : CALL EDX
00504389 : MOV EBX,EAX
0050438b : TEST EBX,EBX
0050438d : JZ 0x005044f0
00504393 : MOV ECX,EBX
00504395 : CALL 0x00523dd0
0050439a : MOV EAX,dword ptr [ESI + 0x9c]
005043a0 : MOV ECX,dword ptr [EAX + 0x48]
005043a3 : MOVZX EDX,word ptr [ESI + 0x10]
005043a7 : MOVZX EAX,word ptr [EAX + 0x18]
005043ab : AND ECX,0xfffffffc
005043ae : ADD ECX,0x8
005043b1 : PUSH ECX
005043b2 : PUSH EDX
005043b3 : PUSH EAX
005043b4 : PUSH 0xb86338
005043b9 : LEA ECX,[EBX + 0xc]
005043bc : PUSH ECX
005043bd : CALL 0x00500460
005043c2 : ADD ESP,0x14
005043c5 : MOV ECX,EBX
005043c7 : CALL 0x004ff7e0
005043cc : JMP 0x005044f0
005043d1 : MOV EDX,dword ptr [ECX]
005043d3 : MOV EAX,dword ptr [EDX + 0x8]
005043d6 : CALL EAX
005043d8 : AND EAX,0xff00
005043dd : CMP EAX,0x200
005043e2 : JZ 0x00504422
005043e4 : MOV EDX,dword ptr [ESI]
005043e6 : MOV EAX,dword ptr [EDX + 0x94]
005043ec : MOV ECX,ESI
005043ee : CALL EAX
005043f0 : MOV EBX,EAX
005043f2 : TEST EBX,EBX
005043f4 : JZ 0x005044f0
005043fa : MOV ECX,EBX
005043fc : CALL 0x00523dd0
00504401 : MOV EAX,dword ptr [ESI + 0x9c]
00504407 : MOV ECX,dword ptr [EAX + 0x48]
0050440a : MOVZX EDX,word ptr [ESI + 0x10]
0050440e : MOVZX EAX,word ptr [EAX + 0x18]
00504412 : AND ECX,0xfffffffc
00504415 : ADD ECX,0x8
00504418 : PUSH ECX
00504419 : PUSH EDX
0050441a : PUSH EAX
0050441b : PUSH 0xb862d8
00504420 : JMP 0x005043b9
00504422 : MOV EAX,dword ptr [ESP + 0x10]
00504426 : MOV dword ptr [ESP + 0x3c],EAX
0050442a : TEST EAX,EAX
0050442c : JZ 0x005044fd
00504432 : MOV ECX,dword ptr [EAX + 0xc]
00504435 : MOV EDX,dword ptr [ECX]
00504437 : LEA EBX,[EAX + 0xc]
0050443a : MOV EAX,dword ptr [EDX + 0x3c]
0050443d : PUSH -0x1
0050443f : CALL EAX
00504441 : PUSH EAX
00504442 : MOV ECX,EDI
00504444 : CALL 0x0055fb50
00504449 : MOV ECX,dword ptr [ESI + 0x9c]
0050444f : MOV DL,byte ptr [ECX + 0x50]
00504452 : SHR DL,0x7
00504455 : TEST DL,0x1
00504458 : JNZ 0x005044f0
0050445e : MOV EAX,dword ptr [EBX]
00504460 : MOV ECX,dword ptr [EAX + 0x14]
00504463 : SHR ECX,0x1
00504465 : AND CL,0x1
00504468 : MOVZX EDX,CL
0050446b : PUSH EDX
0050446c : MOV ECX,EDI
0050446e : CALL 0x0055fbc0
00504473 : MOV EAX,dword ptr [EBX]
00504475 : MOV CL,byte ptr [EAX + 0x14]
00504478 : AND CL,0x1
0050447b : MOVZX EDX,CL
0050447e : PUSH EDX
0050447f : MOV ECX,EDI
00504481 : CALL 0x0055fc30
00504486 : MOV EAX,dword ptr [ESI + 0x9c]
0050448c : TEST byte ptr [EAX + 0x51],0x1
00504490 : JNZ 0x005044f0
00504492 : MOV ECX,dword ptr [EBX]
00504494 : MOV EDX,dword ptr [ECX + 0x14]
00504497 : SHR EDX,0x6
0050449a : NOT DL
0050449c : TEST DL,0x1
0050449f : JZ 0x005044f0
005044a1 : PUSH ESI
005044a2 : PUSH 0x1c
005044a4 : CALL 0x00500440
005044a9 : ADD ESP,0x8
005044ac : TEST EAX,EAX
005044ae : JZ 0x005044d0
005044b0 : MOV ECX,dword ptr [ESI + 0xa4]
005044b6 : MOV EDX,dword ptr [ECX + 0x28]
005044b9 : PUSH EDX
005044ba : MOV EDX,dword ptr [ESP + 0x40]
005044be : PUSH 0x0
005044c0 : PUSH 0x0
005044c2 : PUSH EDX
005044c3 : PUSH 0x0
005044c5 : MOV ECX,EAX
005044c7 : CALL 0x005007e0
005044cc : MOV EBX,EAX
005044ce : JMP 0x005044d2
005044d0 : XOR EBX,EBX
005044d2 : PUSH EBX
005044d3 : MOV ECX,EDI
005044d5 : CALL 0x0055fb80
005044da : TEST EBX,EBX
005044dc : JZ 0x005044f0
005044de : ADD dword ptr [EBX],-0x1
005044e1 : JNZ 0x005044f0
005044e3 : MOV ECX,EBX
005044e5 : CALL 0x00500860
005044ea : PUSH EBX
005044eb : CALL 0x00515cf0
005044f0 : MOV ECX,dword ptr [ESP + 0x10]
005044f4 : TEST ECX,ECX
005044f6 : JZ 0x005044fd
005044f8 : CALL 0x00524240
005044fd : MOV EAX,dword ptr [ESI + 0x9c]
00504503 : FNSTCW word ptr [ESP + 0x3c]
00504507 : FLD float ptr [EAX + 0x2c]
0050450a : MOVZX EAX,word ptr [ESP + 0x3c]
0050450f : OR EAX,0xc00
00504514 : MOV dword ptr [ESP + 0x40],EAX
00504518 : FLDCW word ptr [ESP + 0x40]
0050451c : FISTP qword ptr [ESP + 0x18]
00504520 : MOV EAX,dword ptr [ESP + 0x18]
00504524 : CMP EAX,0x10000
00504529 : MOVZX EAX,AX
0050452c : FLDCW word ptr [ESP + 0x3c]
00504530 : JBE 0x00504537
00504532 : MOV EAX,0xffff
00504537 : OR word ptr [EDI + 0x2a],0x8
0050453c : MOV word ptr [EDI + 0x26],AX
00504540 : MOVZX EAX,word ptr [EDI + 0x2a]
00504544 : MOV ECX,dword ptr [ESI + 0x9c]
0050454a : MOV EDX,dword ptr [ECX + 0x30]
0050454d : OR EAX,0x1
00504550 : MOV word ptr [EDI + 0x2a],AX
00504554 : XOR EAX,EAX
00504556 : MOV dword ptr [EDI + 0x20],EDX
00504559 : XOR ECX,ECX
0050455b : XOR EDX,EDX
0050455d : MOV dword ptr [ESP + 0x20],0xcd3f2c
00504565 : MOV word ptr [ESP + 0x2c],AX
0050456a : MOV word ptr [ESP + 0x32],AX
0050456f : MOV EAX,dword ptr [ESI + 0x9c]
00504575 : MOV EBX,0xb86064
0050457a : MOV dword ptr [ESP + 0x24],0x1
00504582 : MOV dword ptr [ESP + 0x20],EBX
00504586 : MOV dword ptr [ESP + 0x28],0x0
0050458e : MOV word ptr [ESP + 0x2e],CX
00504593 : MOV word ptr [ESP + 0x30],DX
00504598 : MOV word ptr [ESP + 0x34],CX
0050459d : MOV word ptr [ESP + 0x36],DX
005045a2 : MOV EAX,dword ptr [EAX + 0x54]
005045a5 : CMP EAX,0x3
005045a8 : JA 0x00504600
005045aa : JMP dword ptr [EAX*0x4 + 0x5046e4]
005045b1 : MOV CX,word ptr [EBP + 0x16]
005045b5 : MOV EDX,0xf9ff
005045ba : AND CX,DX
005045bd : OR CX,0x1
005045c1 : JMP 0x005045fc
005045c3 : MOV AX,word ptr [EBP + 0x16]
005045c7 : MOV ECX,0xfbff
005045cc : AND AX,CX
005045cf : MOV EDX,0x201
005045d4 : OR AX,DX
005045d7 : MOV word ptr [EBP + 0x16],AX
005045db : JMP 0x00504600
005045dd : MOV EAX,0x601
005045e2 : OR word ptr [EBP + 0x16],AX
005045e6 : JMP 0x00504600
005045e8 : MOV CX,word ptr [EBP + 0x16]
005045ec : MOV EDX,0xfdff
005045f1 : AND CX,DX
005045f4 : MOV EAX,0x401
005045f9 : OR CX,AX
005045fc : MOV word ptr [EBP + 0x16],CX
00504600 : MOV ECX,dword ptr [ESI + 0x9c]
00504606 : MOV DX,word ptr [ECX + 0x50]
0050460a : SHR DX,0x9
0050460e : TEST DL,0x1
00504611 : JZ 0x005046c3
00504617 : MOV EAX,ECX
00504619 : FNSTCW word ptr [ESP + 0x3c]
0050461d : FLD float ptr [EAX + 0x38]
00504620 : FLD double ptr [0x00b86058]
00504626 : MOVZX EAX,word ptr [ESP + 0x3c]
0050462b : FDIV ST1,ST0
0050462d : OR word ptr [EBP + 0x16],0x10
00504632 : OR EAX,0xc00
00504637 : MOV dword ptr [ESP + 0x40],EAX
0050463b : MOVZX EDI,word ptr [EBP + 0x16]
0050463f : OR EDI,0x20
00504642 : FLDCW word ptr [ESP + 0x40]
00504646 : FXCH
00504648 : FISTP dword ptr [ESP + 0x40]
0050464c : MOV CX,word ptr [ESP + 0x40]
00504651 : MOV word ptr [EBP + 0x12],CX
00504655 : MOV EDX,dword ptr [ESI + 0x9c]
0050465b : FLDCW word ptr [ESP + 0x3c]
0050465f : FLD float ptr [EDX + 0x3c]
00504662 : FDIV ST0,ST1
00504664 : MOV word ptr [EBP + 0x16],DI
00504668 : FNSTCW word ptr [ESP + 0x3c]
0050466c : MOVZX EAX,word ptr [ESP + 0x3c]
00504671 : OR EAX,0xc00
00504676 : MOV dword ptr [ESP + 0x40],EAX
0050467a : FLDCW word ptr [ESP + 0x40]
0050467e : FISTP dword ptr [ESP + 0x40]
00504682 : MOV AX,word ptr [ESP + 0x40]
00504687 : MOV word ptr [EBP + 0x14],AX
0050468b : MOV ECX,dword ptr [ESI + 0x9c]
00504691 : FLDCW word ptr [ESP + 0x3c]
00504695 : FLD float ptr [ECX + 0x40]
00504698 : FDIV ST0,ST1
0050469a : CALL 0x0063b380
0050469f : MOV word ptr [EBP + 0xe],AX
005046a3 : OR EDI,0x4
005046a6 : MOV word ptr [EBP + 0x16],DI
005046aa : MOV EDX,dword ptr [ESI + 0x9c]
005046b0 : FDIVR float ptr [EDX + 0x44]
005046b3 : CALL 0x0063b380
005046b8 : OR EDI,0x8
005046bb : MOV word ptr [EBP + 0x10],AX
005046bf : MOV word ptr [EBP + 0x16],DI
005046c3 : LEA ECX,[ESP + 0x20]
005046c7 : MOV dword ptr [ESP + 0x20],EBX
005046cb : CALL 0x0055e7c0
005046d0 : LEA ECX,[ESP + 0x20]
005046d4 : CALL 0x004ff7b0
005046d9 : POP EDI
005046da : POP ESI
005046db : POP EBP
005046dc : POP EBX
005046dd : ADD ESP,0x28
005046e0 : RET 0x8
