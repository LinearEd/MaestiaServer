PROGRAM  : Maestia.exe
FUNCTION : FUN_008c0790
ENTRY    : 008c0790
BODY     : [[008c0790, 008c0a36]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_008c0790(void)

{
  int iVar1;
  code *pcVar2;
  char cVar3;
  uint uVar4;
  int iVar5;
  int *piVar6;
  int iVar7;
  undefined4 uVar8;
  int in_ECX;
  int *in_EDX;
  uint uVar9;
  undefined1 local_3c [28];
  int local_20;
  int *local_1c;
  uint local_18;
  char local_11;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b6659c;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if (((char)in_EDX[2] != '\0') && (iVar1 = *(int *)(in_EDX[1] + 0x128), iVar1 != 0)) {
    if ((*(int *)(iVar1 + 0x40) == 0x95) && (cVar3 = FUN_00993510(in_EDX,0), cVar3 != '\0')) {
      ExceptionList = local_10;
      return;
    }
    local_11 = '\0';
    local_18 = 0;
    if (in_ECX == -1) {
      iVar5 = FUN_008eb580(uVar4);
      if (iVar5 != 0) {
        piVar6 = (int *)FUN_008eb580();
        local_1c = (int *)(**(code **)(*piVar6 + 0x74))
                                    (*(undefined2 *)(iVar1 + 0x44),*(undefined2 *)(iVar1 + 0x46));
        if (local_1c != (int *)0x0) {
          local_20 = 0;
          do {
            piVar6 = (int *)(**(code **)(*in_EDX + 0x74))(local_20,0);
            if ((piVar6 != (int *)0x0) && (piVar6[4] == local_1c[4])) {
              local_18 = FUN_004049b0(piVar6[4]);
              if (local_18 == 0) {
                ExceptionList = local_10;
                return;
              }
              uVar4 = (**(code **)(*piVar6 + 0x40))();
              if ((uVar4 & 0xffff) < (uint)*(ushort *)(local_18 + 0xa4)) {
                uVar9 = (uint)*(ushort *)(local_18 + 0xa4) - (uVar4 & 0xffff);
                local_18 = uVar9;
                uVar4 = (**(code **)(*local_1c + 0x40))();
                if ((int)(uVar4 & 0xffff) < (int)uVar9) {
                  local_18 = (**(code **)(*local_1c + 0x40))();
                  local_18 = local_18 & 0xffff;
                }
                local_11 = '\x01';
                in_ECX = local_20;
                goto LAB_008c08f7;
              }
            }
            local_20 = local_20 + 1;
            if (2 < local_20) {
              (**(code **)(*local_1c + 0xb4))();
              ExceptionList = local_10;
              return;
            }
          } while( true );
        }
      }
    }
    else {
LAB_008c08f7:
      pcVar2 = *(code **)(*in_EDX + 0x74);
      *(undefined2 *)((int)in_EDX + 0x5e) = 0;
      *(short *)(in_EDX + 0x17) = (short)in_ECX;
      iVar7 = (*pcVar2)(in_ECX,0);
      iVar5 = *(int *)(iVar1 + 0x40);
      if (iVar5 == -1) {
        if (iVar7 != 0) {
          if (*(char *)(*(int *)(in_EDX[1] + 0x178) + 0x32) != '\0') {
            FUN_00406460(L"IDS_GUI_REMOVE_EQUIP_DEDICATION");
            local_8 = 0;
            piVar6 = *(int **)(in_EDX[1] + 0x1a8);
            uVar8 = FUN_0081d120(local_3c);
            local_8._0_1_ = 1;
            (**(code **)(*piVar6 + 0x44))(uVar8,3);
            local_8 = (uint)local_8._1_3_ << 8;
            FUN_00406560();
            local_8 = 0xffffffff;
            FUN_00406560();
            FUN_0097fa60();
            ExceptionList = local_10;
            return;
          }
          FUN_0097fb30(iVar7,(short)in_EDX[0x17],0);
        }
      }
      else {
        iVar7 = FUN_008eb580();
        if (iVar7 != 0) {
          if (local_11 == '\0') {
            FUN_008efa90(iVar5,*(undefined2 *)(iVar1 + 0x44),*(undefined2 *)(iVar1 + 0x46),0x95,
                         (short)in_EDX[0x17],0);
            ExceptionList = local_10;
            return;
          }
          FUN_008ef980(iVar5,*(undefined2 *)(iVar1 + 0x44),*(undefined2 *)(iVar1 + 0x46),0x95,
                       (short)in_EDX[0x17],0,local_18);
          ExceptionList = local_10;
          return;
        }
      }
    }
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
008c0790 : PUSH EBP
008c0791 : MOV EBP,ESP
008c0793 : PUSH -0x1
008c0795 : PUSH 0xb6659c
008c079a : MOV EAX,FS:[0x0]
008c07a0 : PUSH EAX
008c07a1 : SUB ESP,0x4c
008c07a4 : PUSH EBX
008c07a5 : PUSH ESI
008c07a6 : PUSH EDI
008c07a7 : MOV EAX,[0x00d66fa0]
008c07ac : XOR EAX,EBP
008c07ae : PUSH EAX
008c07af : LEA EAX,[EBP + -0xc]
008c07b2 : MOV FS:[0x0],EAX
008c07b8 : MOV EDI,ECX
008c07ba : MOV ESI,EDX
008c07bc : MOV AL,byte ptr [ESI + 0x8]
008c07bf : TEST AL,AL
008c07c1 : JZ 0x008c0a25
008c07c7 : MOV EAX,dword ptr [ESI + 0x4]
008c07ca : MOV EBX,dword ptr [EAX + 0x128]
008c07d0 : TEST EBX,EBX
008c07d2 : JZ 0x008c0a25
008c07d8 : MOV EAX,dword ptr [EBX + 0x40]
008c07db : CMP EAX,0x95
008c07e0 : JNZ 0x008c07f6
008c07e2 : PUSH 0x0
008c07e4 : PUSH ESI
008c07e5 : MOV EDX,EDI
008c07e7 : MOV ECX,EBX
008c07e9 : CALL 0x00993510
008c07ee : TEST AL,AL
008c07f0 : JNZ 0x008c0a25
008c07f6 : MOV byte ptr [EBP + -0xd],0x0
008c07fa : MOV dword ptr [EBP + -0x14],0x0
008c0801 : CMP EDI,-0x1
008c0804 : JNZ 0x008c08f7
008c080a : MOV EDI,dword ptr [EBX + 0x40]
008c080d : MOV EAX,dword ptr [ESI + 0x4]
008c0810 : CALL 0x008eb580
008c0815 : TEST EAX,EAX
008c0817 : JZ 0x008c0a25
008c081d : MOV EAX,dword ptr [ESI + 0x4]
008c0820 : CALL 0x008eb580
008c0825 : MOVZX ECX,word ptr [EBX + 0x46]
008c0829 : MOVZX EDX,word ptr [EBX + 0x44]
008c082d : MOV EDI,dword ptr [EAX]
008c082f : PUSH ECX
008c0830 : PUSH EDX
008c0831 : MOV EDX,dword ptr [EDI + 0x74]
008c0834 : MOV ECX,EAX
008c0836 : CALL EDX
008c0838 : MOV dword ptr [EBP + -0x18],EAX
008c083b : TEST EAX,EAX
008c083d : JZ 0x008c0a25
008c0843 : MOV dword ptr [EBP + -0x1c],0x0
008c084a : MOV ECX,dword ptr [EBP + -0x1c]
008c084d : MOV EAX,dword ptr [ESI]
008c084f : MOV EDX,dword ptr [EAX + 0x74]
008c0852 : PUSH 0x0
008c0854 : PUSH ECX
008c0855 : MOV ECX,ESI
008c0857 : CALL EDX
008c0859 : MOV EDI,EAX
008c085b : TEST EDI,EDI
008c085d : JZ 0x008c0898
008c085f : MOV EAX,dword ptr [EDI + 0x10]
008c0862 : MOV ECX,dword ptr [EBP + -0x18]
008c0865 : CMP EAX,dword ptr [ECX + 0x10]
008c0868 : JNZ 0x008c0898
008c086a : PUSH EAX
008c086b : CALL 0x004049b0
008c0870 : ADD ESP,0x4
008c0873 : MOV dword ptr [EBP + -0x14],EAX
008c0876 : TEST EAX,EAX
008c0878 : JZ 0x008c0a25
008c087e : MOV EDX,dword ptr [EDI]
008c0880 : MOV EAX,dword ptr [EDX + 0x40]
008c0883 : MOV ECX,EDI
008c0885 : CALL EAX
008c0887 : MOV ECX,dword ptr [EBP + -0x14]
008c088a : MOVZX EDX,word ptr [ECX + 0xa4]
008c0891 : MOVZX EAX,AX
008c0894 : CMP EAX,EDX
008c0896 : JL 0x008c08c3
008c0898 : MOV EAX,dword ptr [EBP + -0x1c]
008c089b : INC EAX
008c089c : CMP EAX,0x3
008c089f : MOV dword ptr [EBP + -0x1c],EAX
008c08a2 : JL 0x008c084a
008c08a4 : MOV ECX,dword ptr [EBP + -0x18]
008c08a7 : MOV EDX,dword ptr [ECX]
008c08a9 : MOV EAX,dword ptr [EDX + 0xb4]
008c08af : CALL EAX
008c08b1 : MOV ECX,dword ptr [EBP + -0xc]
008c08b4 : MOV dword ptr FS:[0x0],ECX
008c08bb : POP ECX
008c08bc : POP EDI
008c08bd : POP ESI
008c08be : POP EBX
008c08bf : MOV ESP,EBP
008c08c1 : POP EBP
008c08c2 : RET
008c08c3 : MOVZX EDI,word ptr [ECX + 0xa4]
008c08ca : MOV ECX,dword ptr [EBP + -0x18]
008c08cd : SUB EDI,EAX
008c08cf : MOV EAX,dword ptr [ECX]
008c08d1 : MOV EDX,dword ptr [EAX + 0x40]
008c08d4 : MOV dword ptr [EBP + -0x14],EDI
008c08d7 : CALL EDX
008c08d9 : MOVZX EAX,AX
008c08dc : CMP EAX,EDI
008c08de : JGE 0x008c08f0
008c08e0 : MOV ECX,dword ptr [EBP + -0x18]
008c08e3 : MOV EDX,dword ptr [ECX]
008c08e5 : MOV EAX,dword ptr [EDX + 0x40]
008c08e8 : CALL EAX
008c08ea : MOVZX ECX,AX
008c08ed : MOV dword ptr [EBP + -0x14],ECX
008c08f0 : MOV EDI,dword ptr [EBP + -0x1c]
008c08f3 : MOV byte ptr [EBP + -0xd],0x1
008c08f7 : MOV EDX,dword ptr [ESI]
008c08f9 : MOV EAX,dword ptr [EDX + 0x74]
008c08fc : XOR ECX,ECX
008c08fe : PUSH ECX
008c08ff : MOV word ptr [ESI + 0x5e],CX
008c0903 : PUSH EDI
008c0904 : MOV ECX,ESI
008c0906 : MOV word ptr [ESI + 0x5c],DI
008c090a : CALL EAX
008c090c : MOV EDI,dword ptr [EBX + 0x40]
008c090f : CMP EDI,-0x1
008c0912 : JZ 0x008c0988
008c0914 : MOV EAX,dword ptr [ESI + 0x4]
008c0917 : CALL 0x008eb580
008c091c : TEST EAX,EAX
008c091e : JZ 0x008c0a25
008c0924 : CMP byte ptr [EBP + -0xd],0x0
008c0928 : MOVZX EAX,word ptr [EBX + 0x44]
008c092c : MOVZX ECX,word ptr [EBX + 0x46]
008c0930 : JZ 0x008c095f
008c0932 : MOV EDX,dword ptr [EBP + -0x14]
008c0935 : PUSH EDX
008c0936 : MOVZX EDX,word ptr [ESI + 0x5c]
008c093a : PUSH 0x0
008c093c : PUSH EDX
008c093d : PUSH 0x95
008c0942 : PUSH ECX
008c0943 : PUSH EAX
008c0944 : PUSH EDI
008c0945 : CALL 0x008ef980
008c094a : ADD ESP,0x1c
008c094d : MOV ECX,dword ptr [EBP + -0xc]
008c0950 : MOV dword ptr FS:[0x0],ECX
008c0957 : POP ECX
008c0958 : POP EDI
008c0959 : POP ESI
008c095a : POP EBX
008c095b : MOV ESP,EBP
008c095d : POP EBP
008c095e : RET
008c095f : MOVZX EDX,word ptr [ESI + 0x5c]
008c0963 : PUSH 0x0
008c0965 : PUSH EDX
008c0966 : PUSH 0x95
008c096b : PUSH ECX
008c096c : PUSH EAX
008c096d : PUSH EDI
008c096e : CALL 0x008efa90
008c0973 : ADD ESP,0x18
008c0976 : MOV ECX,dword ptr [EBP + -0xc]
008c0979 : MOV dword ptr FS:[0x0],ECX
008c0980 : POP ECX
008c0981 : POP EDI
008c0982 : POP ESI
008c0983 : POP EBX
008c0984 : MOV ESP,EBP
008c0986 : POP EBP
008c0987 : RET
008c0988 : TEST EAX,EAX
008c098a : JZ 0x008c0a25
008c0990 : MOV ECX,dword ptr [ESI + 0x4]
008c0993 : MOV ECX,dword ptr [ECX + 0x178]
008c0999 : CMP byte ptr [ECX + 0x32],0x0
008c099d : JZ 0x008c0a11
008c099f : PUSH 0xc4e970
008c09a4 : LEA ECX,[EBP + -0x38]
008c09a7 : CALL 0x00406460
008c09ac : MOV dword ptr [EBP + -0x4],0x0
008c09b3 : MOV EDX,dword ptr [ESI + 0x4]
008c09b6 : MOV ECX,dword ptr [0x0172491c]
008c09bc : MOV ESI,dword ptr [EDX + 0x1a8]
008c09c2 : LEA EAX,[EBP + -0x38]
008c09c5 : PUSH EAX
008c09c6 : LEA EDI,[EBP + -0x54]
008c09c9 : CALL 0x0081d120
008c09ce : MOV byte ptr [EBP + -0x4],0x1
008c09d2 : MOV EDX,dword ptr [ESI]
008c09d4 : PUSH 0x3
008c09d6 : PUSH EAX
008c09d7 : MOV EAX,dword ptr [EDX + 0x44]
008c09da : MOV ECX,ESI
008c09dc : CALL EAX
008c09de : MOV byte ptr [EBP + -0x4],0x0
008c09e2 : MOV ECX,EDI
008c09e4 : CALL 0x00406560
008c09e9 : MOV dword ptr [EBP + -0x4],0xffffffff
008c09f0 : LEA ECX,[EBP + -0x38]
008c09f3 : CALL 0x00406560
008c09f8 : MOV ECX,EBX
008c09fa : CALL 0x0097fa60
008c09ff : MOV ECX,dword ptr [EBP + -0xc]
008c0a02 : MOV dword ptr FS:[0x0],ECX
008c0a09 : POP ECX
008c0a0a : POP EDI
008c0a0b : POP ESI
008c0a0c : POP EBX
008c0a0d : MOV ESP,EBP
008c0a0f : POP EBP
008c0a10 : RET
008c0a11 : MOVZX ECX,word ptr [ESI + 0x5c]
008c0a15 : PUSH 0x0
008c0a17 : PUSH ECX
008c0a18 : PUSH EAX
008c0a19 : MOV EAX,0x95
008c0a1e : MOV ECX,EBX
008c0a20 : CALL 0x0097fb30
008c0a25 : MOV ECX,dword ptr [EBP + -0xc]
008c0a28 : MOV dword ptr FS:[0x0],ECX
008c0a2f : POP ECX
008c0a30 : POP EDI
008c0a31 : POP ESI
008c0a32 : POP EBX
008c0a33 : MOV ESP,EBP
008c0a35 : POP EBP
008c0a36 : RET
