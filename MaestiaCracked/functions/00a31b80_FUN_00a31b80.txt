PROGRAM  : Maestia.exe
FUNCTION : FUN_00a31b80
ENTRY    : 00a31b80
BODY     : [[00a31b80, 00a31eec]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a31b80(int param_1)

{
  float fVar1;
  int iVar2;
  uint uVar3;
  DWORD DVar4;
  int iVar5;
  float *in_ECX;
  undefined1 auStack_7c [2];
  byte bStack_7a;
  byte bStack_79;
  int local_78;
  int local_74;
  DWORD DStack_70;
  float fStack_6c;
  float fStack_68;
  float fStack_64;
  float afStack_60 [2];
  float fStack_58;
  undefined4 ****appppuStack_34 [5];
  uint uStack_20;
  uint local_1c;
  void *local_14;
  undefined1 *puStack_10;
  undefined4 uStack_c;
  
  uStack_c = 0xffffffff;
  puStack_10 = &LAB_00b4f26b;
  local_14 = ExceptionList;
  local_1c = DAT_00d66fa0 ^ (uint)auStack_7c;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xffffff78;
  ExceptionList = &local_14;
  if ((*(int *)(param_1 + 900) != 0) &&
     (local_74 = **(int **)(param_1 + 0x380), (int *)local_74 != *(int **)(param_1 + 0x380))) {
    do {
      iVar2 = local_74;
      DVar4 = timeGetTime();
      if (DVar4 - *(int *)(iVar2 + 0x10) < 0x1389) {
        FUN_00416210();
      }
      else {
        local_74 = FUN_0042b2c0(param_1 + 0x37c,&local_78,iVar2);
        local_74 = *(int *)local_74;
      }
    } while (local_74 != *(int *)(param_1 + 0x380));
  }
  iVar2 = *(int *)(*(int *)(param_1 + 0xac) + 1000);
  bStack_79 = FUN_00a1e6a0(param_1,*(undefined4 *)(iVar2 + 0x68),*(undefined4 *)(iVar2 + 0x70));
  iVar2 = *(int *)(param_1 + 0xc);
  iVar5 = (uint)bStack_79 * 0x28;
  if ((*(byte *)(iVar5 + 0x274 + iVar2) == bStack_79) &&
     (((*(uint *)(iVar5 + 0x294 + iVar2) >> 0xc & 1) != 0 ||
      ((*(byte *)(iVar5 + 0x274 + iVar2) == bStack_79 &&
       ((*(uint *)(iVar5 + 0x294 + iVar2) >> 0xd & 1) != 0)))))) {
    iVar2 = *(int *)(*(int *)(param_1 + 0xac) + 1000);
    fStack_6c = *(float *)(iVar2 + 0x68) - *in_ECX;
    fStack_68 = *(float *)(iVar2 + 0x6c) - in_ECX[1];
    fStack_64 = *(float *)(iVar2 + 0x70) - in_ECX[2];
    D3DXVec3Normalize(&fStack_6c,&fStack_6c,uVar3);
    fVar1 = *(float *)(*(int *)(param_1 + 0xac) + 0x470);
    afStack_60[0] = fStack_6c * fVar1 + *in_ECX;
    fStack_58 = fStack_64 * fVar1 + in_ECX[2];
    bStack_7a = FUN_00a1e6a0(param_1,afStack_60[0],fStack_58);
    iVar2 = *(int *)(param_1 + 0xc);
    local_78 = (uint)bStack_7a * 0x28;
    if ((*(byte *)(local_78 + 0x274 + iVar2) == bStack_7a) &&
       ((((*(uint *)(local_78 + 0x294 + iVar2) >> 0xc & 1) != 0 && (bStack_79 != bStack_7a)) &&
        ((*(byte *)(local_78 + 0x274 + iVar2) != bStack_7a ||
         ((*(uint *)(local_78 + 0x294 + iVar2) >> 0xd & 1) == 0)))))) {
      FUN_00462830();
      iVar2 = local_74;
      if (local_74 == *(int *)(param_1 + 0x380)) {
        DStack_70 = timeGetTime();
        local_74 = CONCAT31(local_74._1_3_,bStack_7a);
        FUN_00462790(afStack_60,&local_74);
        iVar5 = local_78 + 0x274 + *(int *)(param_1 + 0xc);
        if ((*(byte *)(local_78 + 0x274 + *(int *)(param_1 + 0xc)) == bStack_7a) && (iVar5 != 0)) {
          if (*(uint *)(iVar5 + 0x1c) < 8) {
            iVar5 = iVar5 + 8;
          }
          else {
            iVar5 = *(int *)(iVar5 + 8);
          }
          FUN_00406460(iVar5);
          uStack_c = 0;
          FUN_00824120(DAT_0172491c);
          uStack_c = CONCAT31(uStack_c._1_3_,2);
          FUN_00406560();
          iVar2 = *DAT_00da9894;
          if ((iVar2 != 0) && (*(int *)(iVar2 + 0x114) != 0)) {
            if (uStack_20 < 8) {
              appppuStack_34[0] = appppuStack_34;
            }
            (**(code **)(**(int **)(iVar2 + 0x114) + 4))
                      (*(int **)(iVar2 + 0x114),"SetNameInfo","%ls%d",appppuStack_34[0],2000);
          }
          uStack_c = 0xffffffff;
          FUN_00406560();
          goto LAB_00a31ecd;
        }
        DVar4 = timeGetTime();
        uVar3 = DVar4 - *(int *)(iVar2 + 0x10);
      }
      else {
        DVar4 = timeGetTime();
        uVar3 = DVar4 - *(int *)(iVar2 + 0x10);
      }
      if (60000 < uVar3) {
        FUN_0042b2c0(param_1 + 0x37c,&local_78,iVar2);
      }
    }
  }
LAB_00a31ecd:
  ExceptionList = local_14;
  __security_check_cookie(local_1c ^ (uint)auStack_7c);
  return;
}



============================================================
DISASSEMBLY
============================================================
00a31b80 : PUSH EBP
00a31b81 : MOV EBP,ESP
00a31b83 : AND ESP,0xfffffff8
00a31b86 : PUSH -0x1
00a31b88 : PUSH 0xb4f26b
00a31b8d : MOV EAX,FS:[0x0]
00a31b93 : PUSH EAX
00a31b94 : SUB ESP,0x68
00a31b97 : MOV EAX,[0x00d66fa0]
00a31b9c : XOR EAX,ESP
00a31b9e : MOV dword ptr [ESP + 0x60],EAX
00a31ba2 : PUSH EBX
00a31ba3 : PUSH ESI
00a31ba4 : PUSH EDI
00a31ba5 : MOV EAX,[0x00d66fa0]
00a31baa : XOR EAX,ESP
00a31bac : PUSH EAX
00a31bad : LEA EAX,[ESP + 0x78]
00a31bb1 : MOV FS:[0x0],EAX
00a31bb7 : MOV EBX,dword ptr [EBP + 0x8]
00a31bba : MOV EAX,dword ptr [EBX + 0x384]
00a31bc0 : MOV EDI,ECX
00a31bc2 : TEST EAX,EAX
00a31bc4 : JZ 0x00a31c15
00a31bc6 : MOV EAX,dword ptr [EBX + 0x380]
00a31bcc : MOV ESI,dword ptr [EAX]
00a31bce : MOV dword ptr [ESP + 0x18],ESI
00a31bd2 : CMP ESI,EAX
00a31bd4 : JZ 0x00a31c15
00a31bd6 : CALL dword ptr [0x00b85598]
00a31bdc : SUB EAX,dword ptr [ESI + 0x10]
00a31bdf : CMP EAX,0x1388
00a31be4 : JBE 0x00a31c00
00a31be6 : PUSH ESI
00a31be7 : LEA EAX,[ESP + 0x18]
00a31beb : PUSH EAX
00a31bec : LEA ECX,[EBX + 0x37c]
00a31bf2 : PUSH ECX
00a31bf3 : CALL 0x0042b2c0
00a31bf8 : MOV ESI,dword ptr [EAX]
00a31bfa : MOV dword ptr [ESP + 0x18],ESI
00a31bfe : JMP 0x00a31c0d
00a31c00 : LEA EDX,[ESP + 0x18]
00a31c04 : CALL 0x00416210
00a31c09 : MOV ESI,dword ptr [ESP + 0x18]
00a31c0d : CMP ESI,dword ptr [EBX + 0x380]
00a31c13 : JNZ 0x00a31bd6
00a31c15 : MOV EDX,dword ptr [EBX + 0xac]
00a31c1b : MOV EAX,dword ptr [EDX + 0x3e8]
00a31c21 : FLD float ptr [EAX + 0x70]
00a31c24 : SUB ESP,0x8
00a31c27 : FSTP float ptr [ESP + 0x4]
00a31c2b : FLD float ptr [EAX + 0x68]
00a31c2e : FSTP float ptr [ESP]
00a31c31 : PUSH EBX
00a31c32 : CALL 0x00a1e6a0
00a31c37 : MOV ESI,dword ptr [EBX + 0xc]
00a31c3a : MOVZX ECX,AL
00a31c3d : LEA ECX,[ECX + ECX*0x4]
00a31c40 : ADD ECX,ECX
00a31c42 : ADD ECX,ECX
00a31c44 : ADD ECX,ECX
00a31c46 : MOV byte ptr [ESP + 0x13],AL
00a31c4a : CMP byte ptr [ECX + ESI*0x1 + 0x274],AL
00a31c51 : JNZ 0x00a31ecd
00a31c57 : MOV EDX,dword ptr [ECX + ESI*0x1 + 0x294]
00a31c5e : SHR EDX,0xc
00a31c61 : AND EDX,0x1
00a31c64 : JNZ 0x00a31c86
00a31c66 : CMP byte ptr [ECX + ESI*0x1 + 0x274],AL
00a31c6d : JNZ 0x00a31ecd
00a31c73 : MOV EAX,dword ptr [ECX + ESI*0x1 + 0x294]
00a31c7a : SHR EAX,0xd
00a31c7d : AND EAX,0x1
00a31c80 : JZ 0x00a31ecd
00a31c86 : MOV ECX,dword ptr [EBX + 0xac]
00a31c8c : MOV EAX,dword ptr [ECX + 0x3e8]
00a31c92 : MOVSS XMM0,dword ptr [EAX + 0x68]
00a31c97 : MOVSS XMM1,dword ptr [EAX + 0x6c]
00a31c9c : MOVSS XMM2,dword ptr [EAX + 0x70]
00a31ca1 : SUBSS XMM0,dword ptr [EDI]
00a31ca5 : SUBSS XMM1,dword ptr [EDI + 0x4]
00a31caa : SUBSS XMM2,dword ptr [EDI + 0x8]
00a31caf : ADD EAX,0x68
00a31cb2 : LEA EDX,[ESP + 0x20]
00a31cb6 : PUSH EDX
00a31cb7 : MOV EAX,EDX
00a31cb9 : PUSH EAX
00a31cba : MOVSS dword ptr [ESP + 0x28],XMM0
00a31cc0 : MOVSS dword ptr [ESP + 0x2c],XMM1
00a31cc6 : MOVSS dword ptr [ESP + 0x30],XMM2
00a31ccc : CALL 0x004ff722
00a31cd1 : MOV ECX,dword ptr [EBX + 0xac]
00a31cd7 : MOVSS XMM0,dword ptr [ECX + 0x470]
00a31cdf : MOVSS XMM1,dword ptr [EDI]
00a31ce3 : MOVSS XMM3,dword ptr [ESP + 0x20]
00a31ce9 : MOVSS XMM2,dword ptr [EDI + 0x8]
00a31cee : MULSS XMM3,XMM0
00a31cf2 : ADDSS XMM3,XMM1
00a31cf6 : MOVSS XMM1,dword ptr [ESP + 0x28]
00a31cfc : MULSS XMM1,XMM0
00a31d00 : ADDSS XMM1,XMM2
00a31d04 : SUB ESP,0x8
00a31d07 : MOVSS dword ptr [ESP + 0x3c],XMM1
00a31d0d : FLD float ptr [ESP + 0x3c]
00a31d11 : FSTP float ptr [ESP + 0x4]
00a31d15 : MOVSS dword ptr [ESP + 0x34],XMM3
00a31d1b : FLD float ptr [ESP + 0x34]
00a31d1f : FSTP float ptr [ESP]
00a31d22 : PUSH EBX
00a31d23 : CALL 0x00a1e6a0
00a31d28 : MOV EDX,dword ptr [EBX + 0xc]
00a31d2b : MOVZX ECX,AL
00a31d2e : LEA ECX,[ECX + ECX*0x4]
00a31d31 : ADD ECX,ECX
00a31d33 : ADD ECX,ECX
00a31d35 : ADD ECX,ECX
00a31d37 : MOV byte ptr [ESP + 0x12],AL
00a31d3b : MOV dword ptr [ESP + 0x14],ECX
00a31d3f : CMP byte ptr [ECX + EDX*0x1 + 0x274],AL
00a31d46 : JNZ 0x00a31ecd
00a31d4c : MOV ESI,dword ptr [ECX + EDX*0x1 + 0x294]
00a31d53 : SHR ESI,0xc
00a31d56 : AND ESI,0x1
00a31d59 : JZ 0x00a31ecd
00a31d5f : CMP byte ptr [ESP + 0x13],AL
00a31d63 : JZ 0x00a31ecd
00a31d69 : CMP byte ptr [ECX + EDX*0x1 + 0x274],AL
00a31d70 : JNZ 0x00a31d85
00a31d72 : MOV EDX,dword ptr [ECX + EDX*0x1 + 0x294]
00a31d79 : SHR EDX,0xd
00a31d7c : AND EDX,0x1
00a31d7f : JNZ 0x00a31ecd
00a31d85 : LEA ESI,[EBX + 0x37c]
00a31d8b : LEA EDI,[ESP + 0x12]
00a31d8f : LEA EAX,[ESP + 0x18]
00a31d93 : CALL 0x00462830
00a31d98 : MOV EAX,dword ptr [EBX + 0x380]
00a31d9e : MOV EDI,dword ptr [ESP + 0x18]
00a31da2 : CMP EDI,EAX
00a31da4 : JNZ 0x00a31eb1
00a31daa : CALL dword ptr [0x00b85598]
00a31db0 : MOV CL,byte ptr [ESP + 0x12]
00a31db4 : MOV dword ptr [ESP + 0x1c],EAX
00a31db8 : LEA EDX,[ESP + 0x18]
00a31dbc : PUSH EDX
00a31dbd : LEA EAX,[ESP + 0x30]
00a31dc1 : PUSH EAX
00a31dc2 : MOV EAX,ESI
00a31dc4 : MOV byte ptr [ESP + 0x20],CL
00a31dc8 : CALL 0x00462790
00a31dcd : MOV EBX,dword ptr [EBX + 0xc]
00a31dd0 : MOV ECX,dword ptr [ESP + 0x14]
00a31dd4 : MOV DL,byte ptr [ESP + 0x12]
00a31dd8 : CMP byte ptr [ECX + EBX*0x1 + 0x274],DL
00a31ddf : LEA EAX,[ECX + EBX*0x1 + 0x274]
00a31de6 : JNZ 0x00a31dec
00a31de8 : TEST EAX,EAX
00a31dea : JNZ 0x00a31e0b
00a31dec : CALL dword ptr [0x00b85598]
00a31df2 : SUB EAX,dword ptr [EDI + 0x10]
00a31df5 : CMP EAX,0xea60
00a31dfa : JBE 0x00a31ecd
00a31e00 : PUSH EDI
00a31e01 : LEA EAX,[ESP + 0x18]
00a31e05 : PUSH EAX
00a31e06 : JMP 0x00a31ec7
00a31e0b : MOV ESI,0x8
00a31e10 : CMP dword ptr [EAX + 0x1c],ESI
00a31e13 : JC 0x00a31e1a
00a31e15 : MOV EAX,dword ptr [EAX + 0x8]
00a31e18 : JMP 0x00a31e1d
00a31e1a : ADD EAX,0x8
00a31e1d : PUSH EAX
00a31e1e : LEA ECX,[ESP + 0x3c]
00a31e22 : CALL 0x00406460
00a31e27 : MOV dword ptr [ESP + 0x80],0x0
00a31e32 : MOV ECX,dword ptr [0x0172491c]
00a31e38 : PUSH ECX
00a31e39 : LEA EDX,[ESP + 0x3c]
00a31e3d : LEA EDI,[ESP + 0x58]
00a31e41 : CALL 0x00824120
00a31e46 : MOV byte ptr [ESP + 0x80],0x2
00a31e4e : LEA ECX,[ESP + 0x38]
00a31e52 : CALL 0x00406560
00a31e57 : MOV EDX,dword ptr [0x00da9894]
00a31e5d : MOV EAX,dword ptr [EDX]
00a31e5f : TEST EAX,EAX
00a31e61 : JZ 0x00a31e9b
00a31e63 : CMP dword ptr [EAX + 0x114],0x0
00a31e6a : JZ 0x00a31e9b
00a31e6c : MOV EAX,dword ptr [EAX + 0x114]
00a31e72 : MOV ECX,dword ptr [ESP + 0x58]
00a31e76 : CMP dword ptr [ESP + 0x6c],ESI
00a31e7a : JNC 0x00a31e80
00a31e7c : LEA ECX,[ESP + 0x58]
00a31e80 : MOV EDX,dword ptr [EAX]
00a31e82 : PUSH 0x7d0
00a31e87 : PUSH ECX
00a31e88 : PUSH 0xcc4a98
00a31e8d : PUSH 0xcc4aa0
00a31e92 : PUSH EAX
00a31e93 : MOV EAX,dword ptr [EDX + 0x4]
00a31e96 : CALL EAX
00a31e98 : ADD ESP,0x14
00a31e9b : MOV dword ptr [ESP + 0x80],0xffffffff
00a31ea6 : LEA ECX,[ESP + 0x54]
00a31eaa : CALL 0x00406560
00a31eaf : JMP 0x00a31ecd
00a31eb1 : CALL dword ptr [0x00b85598]
00a31eb7 : SUB EAX,dword ptr [EDI + 0x10]
00a31eba : CMP EAX,0xea60
00a31ebf : JBE 0x00a31ecd
00a31ec1 : PUSH EDI
00a31ec2 : LEA ECX,[ESP + 0x18]
00a31ec6 : PUSH ECX
00a31ec7 : PUSH ESI
00a31ec8 : CALL 0x0042b2c0
00a31ecd : MOV ECX,dword ptr [ESP + 0x78]
00a31ed1 : MOV dword ptr FS:[0x0],ECX
00a31ed8 : POP ECX
00a31ed9 : POP EDI
00a31eda : POP ESI
00a31edb : POP EBX
00a31edc : MOV ECX,dword ptr [ESP + 0x60]
00a31ee0 : XOR ECX,ESP
00a31ee2 : CALL 0x00633e6b
00a31ee7 : MOV ESP,EBP
00a31ee9 : POP EBP
00a31eea : RET 0x4
