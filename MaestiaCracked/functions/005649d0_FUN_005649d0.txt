PROGRAM  : Maestia.exe
FUNCTION : FUN_005649d0
ENTRY    : 005649d0
BODY     : [[005649d0, 00564c6b]]

============================================================
DECOMPILED C CODE
============================================================

bool FUN_005649d0(int *param_1,uint param_2)

{
  undefined4 *puVar1;
  undefined4 *puVar2;
  char cVar3;
  int iVar4;
  GRefCountImpl *pGVar5;
  int in_ECX;
  int iVar6;
  uint uVar7;
  int iVar8;
  LPCRITICAL_SECTION lpCriticalSection;
  uint uVar9;
  int *piVar10;
  uint local_1c;
  LPCRITICAL_SECTION local_18;
  int local_14;
  int local_10;
  int local_c;
  uint local_8;
  uint local_4;
  
  iVar4 = *(int *)(*(int *)(*(int *)(in_ECX + 0x1c) + 0xc) + 0x20);
  iVar8 = 0;
  local_14 = 0;
  local_10 = 0;
  iVar6 = 0;
  if (*(int *)(iVar4 + 0x74) < 2) {
    EnterCriticalSection((LPCRITICAL_SECTION)(iVar4 + 0xac));
    iVar6 = iVar4;
  }
  local_1c = param_2;
  iVar4 = FUN_00562ff0(&local_1c);
  if (iVar4 != 0) {
    FUN_004ffda0(iVar4 + 4);
    iVar8 = local_10;
  }
  if (iVar6 != 0) {
    LeaveCriticalSection((LPCRITICAL_SECTION)(iVar6 + 0xac));
  }
  if (iVar4 != 0) {
    if (local_14 == 1) {
      FUN_00502240(param_1,iVar8);
    }
    else {
      param_1[1] = *(int *)(in_ECX + 0x1c) + 0x18;
      pGVar5 = (GRefCountImpl *)FUN_00562020(*(int *)(in_ECX + 0x1c) + 0x18);
      if (pGVar5 != (GRefCountImpl *)0x0) {
        GRefCountImpl::AddRef(pGVar5);
      }
      if (*param_1 != 0) {
        FUN_00524240();
      }
      *param_1 = (int)pGVar5;
      iVar8 = local_10;
    }
    iVar4 = *param_1;
    if ((local_14 == 0) && (iVar8 != 0)) {
      FUN_00524240();
    }
    return iVar4 != 0;
  }
  lpCriticalSection = (LPCRITICAL_SECTION)(*(int *)(in_ECX + 0x1c) + 0x50);
  local_c = 0;
  local_8 = 0;
  local_4 = 0;
  local_18 = lpCriticalSection;
  EnterCriticalSection(lpCriticalSection);
  iVar4 = *(int *)(*(int *)(in_ECX + 0x1c) + 0x48);
  iVar6 = 0;
  uVar7 = 0;
  if (iVar4 != 0) {
    FUN_00562870(&local_c,iVar4);
    iVar6 = local_c;
    uVar7 = local_8;
  }
  iVar4 = *(int *)(in_ECX + 0x1c);
  local_1c = 0;
  uVar9 = uVar7;
  if (*(int *)(iVar4 + 0x48) != 0) {
    do {
      uVar7 = uVar9 + 1;
      puVar1 = (undefined4 *)(*(int *)(iVar4 + 0x44) + local_1c * 4);
      if (uVar7 < uVar9) {
        iVar4 = uVar9 - uVar7;
        piVar10 = (int *)(iVar6 + -4 + (iVar4 + uVar7) * 4);
        for (; iVar4 != 0; iVar4 = iVar4 + -1) {
          if (*piVar10 != 0) {
            FUN_00524240();
          }
          piVar10 = piVar10 + -1;
        }
        iVar6 = local_c;
        uVar9 = uVar7;
        if (uVar7 < local_4 >> 1) {
LAB_00564b78:
          FUN_00562870(&local_c,uVar9);
          iVar6 = local_c;
        }
      }
      else if (local_4 <= uVar7) {
        uVar9 = (uVar7 >> 2) + uVar7;
        goto LAB_00564b78;
      }
      puVar2 = (undefined4 *)(iVar6 + -4 + uVar7 * 4);
      local_8 = uVar7;
      if (puVar2 != (undefined4 *)0x0) {
        pGVar5 = (GRefCountImpl *)*puVar1;
        if (pGVar5 != (GRefCountImpl *)0x0) {
          GRefCountImpl::AddRef(pGVar5);
        }
        *puVar2 = *puVar1;
      }
      iVar4 = *(int *)(in_ECX + 0x1c);
      local_1c = local_1c + 1;
      uVar9 = uVar7;
      lpCriticalSection = local_18;
    } while (local_1c < *(uint *)(iVar4 + 0x48));
  }
  LeaveCriticalSection(lpCriticalSection);
  uVar9 = 0;
  if (uVar7 != 0) {
    do {
      if ((*(int *)(iVar6 + uVar9 * 4) != 0) &&
         (cVar3 = FUN_005649d0(param_1,param_2), cVar3 != '\0')) {
        piVar10 = (int *)(iVar6 + -4 + uVar7 * 4);
        do {
          if (*piVar10 != 0) {
            FUN_00524240();
          }
          piVar10 = piVar10 + -1;
          uVar7 = uVar7 - 1;
        } while (uVar7 != 0);
        FUN_00515cf0(iVar6);
        if ((local_14 == 0) && (local_10 != 0)) {
          FUN_00524240();
        }
        return true;
      }
      uVar9 = uVar9 + 1;
    } while (uVar9 < uVar7);
  }
  piVar10 = (int *)(iVar6 + -4 + uVar7 * 4);
  for (; uVar7 != 0; uVar7 = uVar7 - 1) {
    if (*piVar10 != 0) {
      FUN_00524240();
    }
    piVar10 = piVar10 + -1;
  }
  FUN_00515cf0(iVar6);
  if ((local_14 == 0) && (local_10 != 0)) {
    FUN_00524240();
  }
  return false;
}



============================================================
DISASSEMBLY
============================================================
005649d0 : SUB ESP,0x20
005649d3 : PUSH EBX
005649d4 : PUSH EBP
005649d5 : MOV EBP,ECX
005649d7 : MOV EAX,dword ptr [EBP + 0x1c]
005649da : MOV ECX,dword ptr [EAX + 0xc]
005649dd : MOV EAX,dword ptr [ECX + 0x20]
005649e0 : PUSH ESI
005649e1 : PUSH EDI
005649e2 : XOR EDI,EDI
005649e4 : XOR ESI,ESI
005649e6 : CMP dword ptr [EAX + 0x74],0x2
005649ea : MOV dword ptr [ESP + 0x1c],EDI
005649ee : MOV dword ptr [ESP + 0x20],EDI
005649f2 : JGE 0x00564a02
005649f4 : MOV ESI,EAX
005649f6 : ADD EAX,0xac
005649fb : PUSH EAX
005649fc : CALL dword ptr [0x00b85118]
00564a02 : MOV EDX,dword ptr [EBP + 0x1c]
00564a05 : MOV EAX,dword ptr [EDX + 0xc]
00564a08 : MOV ECX,dword ptr [ESP + 0x38]
00564a0c : MOV EAX,dword ptr [EAX + 0x20]
00564a0f : LEA EDX,[ESP + 0x14]
00564a13 : MOV dword ptr [ESP + 0x14],ECX
00564a17 : PUSH EDX
00564a18 : LEA ECX,[EAX + 0xc8]
00564a1e : CALL 0x00562ff0
00564a23 : CMP EAX,EDI
00564a25 : JZ 0x00564a3c
00564a27 : ADD EAX,0x4
00564a2a : PUSH EAX
00564a2b : LEA ECX,[ESP + 0x20]
00564a2f : CALL 0x004ffda0
00564a34 : MOV EDI,dword ptr [ESP + 0x20]
00564a38 : MOV BL,0x1
00564a3a : JMP 0x00564a3e
00564a3c : XOR BL,BL
00564a3e : TEST ESI,ESI
00564a40 : JZ 0x00564a4f
00564a42 : ADD ESI,0xac
00564a48 : PUSH ESI
00564a49 : CALL dword ptr [0x00b8511c]
00564a4f : TEST BL,BL
00564a51 : JZ 0x00564ac8
00564a53 : CMP dword ptr [ESP + 0x1c],0x1
00564a58 : MOV ESI,dword ptr [ESP + 0x34]
00564a5c : JNZ 0x00564a6d
00564a5e : MOV ECX,dword ptr [EBP + 0x1c]
00564a61 : PUSH EDI
00564a62 : PUSH ESI
00564a63 : ADD ECX,0x18
00564a66 : CALL 0x00502240
00564a6b : JMP 0x00564aa4
00564a6d : MOV EAX,dword ptr [EBP + 0x1c]
00564a70 : ADD EAX,0x18
00564a73 : MOV dword ptr [ESI + 0x4],EAX
00564a76 : MOV EAX,dword ptr [EBP + 0x1c]
00564a79 : ADD EAX,0x18
00564a7c : PUSH EAX
00564a7d : LEA ECX,[ESP + 0x20]
00564a81 : CALL 0x00562020
00564a86 : MOV EDI,EAX
00564a88 : TEST EDI,EDI
00564a8a : JZ 0x00564a93
00564a8c : MOV ECX,EDI
00564a8e : CALL 0x00523dd0
00564a93 : MOV ECX,dword ptr [ESI]
00564a95 : TEST ECX,ECX
00564a97 : JZ 0x00564a9e
00564a99 : CALL 0x00524240
00564a9e : MOV dword ptr [ESI],EDI
00564aa0 : MOV EDI,dword ptr [ESP + 0x20]
00564aa4 : CMP dword ptr [ESI],0x0
00564aa7 : SETNZ BL
00564aaa : CMP dword ptr [ESP + 0x1c],0x0
00564aaf : JNZ 0x00564abc
00564ab1 : TEST EDI,EDI
00564ab3 : JZ 0x00564abc
00564ab5 : MOV ECX,EDI
00564ab7 : CALL 0x00524240
00564abc : POP EDI
00564abd : POP ESI
00564abe : POP EBP
00564abf : MOV AL,BL
00564ac1 : POP EBX
00564ac2 : ADD ESP,0x20
00564ac5 : RET 0x8
00564ac8 : MOV EDI,dword ptr [EBP + 0x1c]
00564acb : ADD EDI,0x50
00564ace : XOR ESI,ESI
00564ad0 : XOR EBX,EBX
00564ad2 : PUSH EDI
00564ad3 : MOV dword ptr [ESP + 0x28],EBX
00564ad7 : MOV dword ptr [ESP + 0x2c],ESI
00564adb : MOV dword ptr [ESP + 0x30],ESI
00564adf : MOV dword ptr [ESP + 0x1c],EDI
00564ae3 : CALL dword ptr [0x00b85118]
00564ae9 : MOV ECX,dword ptr [EBP + 0x1c]
00564aec : MOV EAX,dword ptr [ECX + 0x48]
00564aef : TEST EAX,EAX
00564af1 : JBE 0x00564b08
00564af3 : LEA EDX,[ESP + 0x24]
00564af7 : PUSH EAX
00564af8 : PUSH EDX
00564af9 : MOV ECX,EDX
00564afb : CALL 0x00562870
00564b00 : MOV ESI,dword ptr [ESP + 0x28]
00564b04 : MOV EBX,dword ptr [ESP + 0x24]
00564b08 : MOV EAX,dword ptr [EBP + 0x1c]
00564b0b : XOR ECX,ECX
00564b0d : MOV dword ptr [ESP + 0x14],ECX
00564b11 : CMP dword ptr [EAX + 0x48],ECX
00564b14 : JBE 0x00564bc3
00564b1a : LEA EBX,[EBX]
00564b20 : MOV EAX,dword ptr [EAX + 0x44]
00564b23 : LEA EDI,[ESI + 0x1]
00564b26 : LEA ECX,[EAX + ECX*0x4]
00564b29 : MOV dword ptr [ESP + 0x10],ECX
00564b2d : CMP EDI,ESI
00564b2f : JNC 0x00564b65
00564b31 : SUB ESI,EDI
00564b33 : LEA EDX,[ESI + EDI*0x1]
00564b36 : LEA EBX,[EBX + EDX*0x4 + -0x4]
00564b3a : JZ 0x00564b53
00564b3c : LEA ESP,[ESP]
00564b40 : MOV ECX,dword ptr [EBX]
00564b42 : TEST ECX,ECX
00564b44 : JZ 0x00564b4b
00564b46 : CALL 0x00524240
00564b4b : SUB EBX,0x4
00564b4e : SUB ESI,0x1
00564b51 : JNZ 0x00564b40
00564b53 : MOV EAX,dword ptr [ESP + 0x2c]
00564b57 : SHR EAX,0x1
00564b59 : CMP EDI,EAX
00564b5b : JNC 0x00564b81
00564b5d : PUSH EDI
00564b5e : LEA ECX,[ESP + 0x28]
00564b62 : PUSH ECX
00564b63 : JMP 0x00564b78
00564b65 : CMP EDI,dword ptr [ESP + 0x2c]
00564b69 : JC 0x00564b85
00564b6b : MOV EDX,EDI
00564b6d : SHR EDX,0x2
00564b70 : ADD EDX,EDI
00564b72 : PUSH EDX
00564b73 : LEA EAX,[ESP + 0x28]
00564b77 : PUSH EAX
00564b78 : LEA ECX,[ESP + 0x2c]
00564b7c : CALL 0x00562870
00564b81 : MOV EBX,dword ptr [ESP + 0x24]
00564b85 : MOV ESI,EDI
00564b87 : LEA EDI,[EBX + EDI*0x4 + -0x4]
00564b8b : MOV dword ptr [ESP + 0x28],ESI
00564b8f : TEST EDI,EDI
00564b91 : JZ 0x00564baa
00564b93 : MOV ECX,dword ptr [ESP + 0x10]
00564b97 : MOV ECX,dword ptr [ECX]
00564b99 : TEST ECX,ECX
00564b9b : JZ 0x00564ba2
00564b9d : CALL 0x00523dd0
00564ba2 : MOV EDX,dword ptr [ESP + 0x10]
00564ba6 : MOV EAX,dword ptr [EDX]
00564ba8 : MOV dword ptr [EDI],EAX
00564baa : MOV ECX,dword ptr [ESP + 0x14]
00564bae : MOV EAX,dword ptr [EBP + 0x1c]
00564bb1 : INC ECX
00564bb2 : MOV dword ptr [ESP + 0x14],ECX
00564bb6 : CMP ECX,dword ptr [EAX + 0x48]
00564bb9 : JC 0x00564b20
00564bbf : MOV EDI,dword ptr [ESP + 0x18]
00564bc3 : PUSH EDI
00564bc4 : CALL dword ptr [0x00b8511c]
00564bca : XOR EDI,EDI
00564bcc : TEST ESI,ESI
00564bce : JBE 0x00564bef
00564bd0 : MOV EBP,dword ptr [ESP + 0x34]
00564bd4 : MOV ECX,dword ptr [EBX + EDI*0x4]
00564bd7 : TEST ECX,ECX
00564bd9 : JZ 0x00564bea
00564bdb : MOV EDX,dword ptr [ESP + 0x38]
00564bdf : PUSH EDX
00564be0 : PUSH EBP
00564be1 : CALL 0x005649d0
00564be6 : TEST AL,AL
00564be8 : JNZ 0x00564c30
00564bea : INC EDI
00564beb : CMP EDI,ESI
00564bed : JC 0x00564bd4
00564bef : LEA EDI,[EBX + ESI*0x4 + -0x4]
00564bf3 : TEST ESI,ESI
00564bf5 : JBE 0x00564c0a
00564bf7 : MOV ECX,dword ptr [EDI]
00564bf9 : TEST ECX,ECX
00564bfb : JZ 0x00564c02
00564bfd : CALL 0x00524240
00564c02 : SUB EDI,0x4
00564c05 : SUB ESI,0x1
00564c08 : JNZ 0x00564bf7
00564c0a : PUSH EBX
00564c0b : CALL 0x00515cf0
00564c10 : CMP dword ptr [ESP + 0x1c],0x0
00564c15 : JNZ 0x00564c24
00564c17 : MOV ECX,dword ptr [ESP + 0x20]
00564c1b : TEST ECX,ECX
00564c1d : JZ 0x00564c24
00564c1f : CALL 0x00524240
00564c24 : POP EDI
00564c25 : POP ESI
00564c26 : POP EBP
00564c27 : XOR AL,AL
00564c29 : POP EBX
00564c2a : ADD ESP,0x20
00564c2d : RET 0x8
00564c30 : LEA EDI,[EBX + ESI*0x4 + -0x4]
00564c34 : MOV ECX,dword ptr [EDI]
00564c36 : TEST ECX,ECX
00564c38 : JZ 0x00564c3f
00564c3a : CALL 0x00524240
00564c3f : SUB EDI,0x4
00564c42 : SUB ESI,0x1
00564c45 : JNZ 0x00564c34
00564c47 : PUSH EBX
00564c48 : CALL 0x00515cf0
00564c4d : CMP dword ptr [ESP + 0x1c],ESI
00564c51 : JNZ 0x00564c60
00564c53 : MOV ECX,dword ptr [ESP + 0x20]
00564c57 : TEST ECX,ECX
00564c59 : JZ 0x00564c60
00564c5b : CALL 0x00524240
00564c60 : POP EDI
00564c61 : POP ESI
00564c62 : POP EBP
00564c63 : MOV AL,0x1
00564c65 : POP EBX
00564c66 : ADD ESP,0x20
00564c69 : RET 0x8
