PROGRAM  : Maestia.exe
FUNCTION : FUN_00686f40
ENTRY    : 00686f40
BODY     : [[00686f40, 006870db] [006870e0, 00687301]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_00686f40(short *param_1,undefined4 *param_2,undefined4 param_3)

{
  undefined4 uVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  byte *pbVar6;
  byte bVar7;
  int iVar8;
  int *piVar9;
  int *piVar10;
  int *piVar11;
  byte *local_64;
  int *local_60;
  int local_58;
  int local_50;
  int local_4c;
  int local_48;
  int local_44;
  int local_40;
  int local_3c;
  int iStack_38;
  int iStack_34;
  int iStack_30;
  int iStack_2c;
  int iStack_28;
  int iStack_24;
  int iStack_20;
  int iStack_1c;
  int iStack_18;
  int iStack_14;
  int iStack_10;
  int iStack_c;
  
  if ((param_1 == (short *)0x0) || (param_2 == (undefined4 *)0x0)) {
    return 6;
  }
  uVar1 = param_2[4];
  iVar2 = param_2[5];
  local_64 = (byte *)0x0;
  local_58 = 0;
  if (*param_1 < 1) {
    return 0;
  }
  do {
    iVar8 = (int)*(short *)(*(int *)(param_1 + 6) + local_58 * 2);
    if (iVar8 < 0) {
      return 0x14;
    }
    iVar3 = *(int *)(param_1 + 2);
    local_60 = (int *)(iVar3 + iVar8 * 8);
    iVar5 = (int)local_64 * 8;
    iVar4 = *(int *)(param_1 + 2);
    bVar7 = (byte)uVar1;
    local_44 = (*(int *)(iVar3 + 4 + (int)local_64 * 8) << (bVar7 & 0x1f)) - iVar2;
    local_3c = (*(int *)(iVar4 + 4 + iVar8 * 8) << (bVar7 & 0x1f)) - iVar2;
    local_40 = (*(int *)(iVar4 + iVar8 * 8) << (bVar7 & 0x1f)) - iVar2;
    piVar9 = (int *)(iVar4 + (int)local_64 * 8);
    local_64 = (byte *)((int)local_64 + *(int *)(param_1 + 4));
    local_48 = (*(int *)(iVar3 + iVar5) << (bVar7 & 0x1f)) - iVar2;
    if ((*local_64 & 3) == 2) {
      return 0x14;
    }
    local_50 = local_48;
    local_4c = local_44;
    if ((*local_64 & 3) == 0) {
      if ((*(byte *)(*(int *)(param_1 + 4) + iVar8) & 3) == 1) {
        local_60 = local_60 + -2;
        local_4c = local_3c;
        local_50 = local_40;
      }
      else {
        local_50 = (local_48 + local_40) / 2;
        local_4c = (local_3c + local_44) / 2;
      }
      piVar9 = piVar9 + -2;
      local_64 = local_64 + -1;
    }
    iVar5 = (*(code *)*param_2)(&local_50,param_3);
    while( true ) {
      while( true ) {
        while( true ) {
          if (iVar5 != 0) {
            return iVar5;
          }
          if (local_60 <= piVar9) {
            iVar5 = (*(code *)param_2[1])(&local_50,param_3);
            goto LAB_006870ab;
          }
          pbVar6 = local_64 + 1;
          piVar11 = piVar9 + 2;
          if ((local_64[1] & 3) != 0) break;
          local_48 = (*piVar11 << (bVar7 & 0x1f)) - iVar2;
          local_44 = (piVar9[3] << (bVar7 & 0x1f)) - iVar2;
          while( true ) {
            if (local_60 <= piVar11) {
              iVar5 = (*(code *)param_2[2])(&local_48,&local_50,param_3);
              goto LAB_006870ab;
            }
            piVar9 = piVar11 + 3;
            pbVar6 = pbVar6 + 1;
            piVar11 = piVar11 + 2;
            iStack_38 = (*piVar11 << (bVar7 & 0x1f)) - iVar2;
            iStack_34 = (*piVar9 << (bVar7 & 0x1f)) - iVar2;
            if ((*pbVar6 & 3) == 1) break;
            if ((*pbVar6 & 3) != 0) {
              return 0x14;
            }
            iStack_10 = (iStack_38 + local_48) / 2;
            iStack_c = (iStack_34 + local_44) / 2;
            iVar5 = (*(code *)param_2[2])(&local_48,&iStack_10,param_3);
            if (iVar5 != 0) {
              return iVar5;
            }
            local_48 = iStack_38;
            local_44 = iStack_34;
          }
          iVar5 = (*(code *)param_2[2])(&local_48,&iStack_38,param_3);
          piVar9 = piVar11;
          local_64 = pbVar6;
        }
        if ((local_64[1] & 3) != 1) break;
        iStack_18 = (*piVar11 << (bVar7 & 0x1f)) - iVar2;
        iStack_14 = (piVar9[3] << (bVar7 & 0x1f)) - iVar2;
        iVar5 = (*(code *)param_2[1])(&iStack_18,param_3);
        piVar9 = piVar11;
        local_64 = pbVar6;
      }
      if (local_60 < piVar9 + 4) {
        return 0x14;
      }
      if ((local_64[2] & 3) != 2) {
        return 0x14;
      }
      piVar10 = piVar9 + 6;
      iStack_28 = (*piVar11 << (bVar7 & 0x1f)) - iVar2;
      iStack_24 = (piVar9[3] << (bVar7 & 0x1f)) - iVar2;
      iStack_30 = (piVar9[4] << (bVar7 & 0x1f)) - iVar2;
      iStack_2c = (piVar9[5] << (bVar7 & 0x1f)) - iVar2;
      if (local_60 < piVar10) break;
      iStack_20 = (*piVar10 << (bVar7 & 0x1f)) - iVar2;
      iStack_1c = (piVar9[7] << (bVar7 & 0x1f)) - iVar2;
      iVar5 = (*(code *)param_2[3])(&iStack_28,&iStack_30,&iStack_20,param_3);
      piVar9 = piVar10;
      local_64 = local_64 + 3;
    }
    iVar5 = (*(code *)param_2[3])(&iStack_28,&iStack_30,&local_50,param_3);
LAB_006870ab:
    if (iVar5 != 0) {
      return iVar5;
    }
    local_58 = local_58 + 1;
    local_64 = (byte *)(iVar8 + 1);
    if (*param_1 <= local_58) {
      return 0;
    }
  } while( true );
}



============================================================
DISASSEMBLY
============================================================
00686f40 : PUSH EBP
00686f41 : MOV EBP,ESP
00686f43 : AND ESP,0xfffffff8
00686f46 : MOV EAX,dword ptr [EBP + 0x8]
00686f49 : SUB ESP,0x5c
00686f4c : PUSH EBX
00686f4d : PUSH ESI
00686f4e : XOR ESI,ESI
00686f50 : PUSH EDI
00686f51 : CMP EAX,ESI
00686f53 : JZ 0x006872f6
00686f59 : MOV ECX,dword ptr [EBP + 0xc]
00686f5c : CMP ECX,ESI
00686f5e : JZ 0x006872f6
00686f64 : MOV EDI,dword ptr [ECX + 0x10]
00686f67 : MOV EBX,dword ptr [ECX + 0x14]
00686f6a : XOR ECX,ECX
00686f6c : CMP CX,word ptr [EAX]
00686f6f : MOV dword ptr [ESP + 0xc],ESI
00686f73 : MOV dword ptr [ESP + 0x18],ESI
00686f77 : JL 0x00686f84
00686f79 : XOR EAX,EAX
00686f7b : POP EDI
00686f7c : POP ESI
00686f7d : POP EBX
00686f7e : MOV ESP,EBP
00686f80 : POP EBP
00686f81 : RET
00686f82 : MOV EAX,EDX
00686f84 : MOV EDX,dword ptr [EAX + 0xc]
00686f87 : MOV ECX,dword ptr [ESP + 0x18]
00686f8b : MOVSX EDX,word ptr [EDX + ECX*0x2]
00686f8f : MOV dword ptr [ESP + 0x14],EDX
00686f93 : TEST EDX,EDX
00686f95 : JL 0x006872ea
00686f9b : MOV ECX,dword ptr [EAX + 0x4]
00686f9e : LEA EAX,[ECX + EDX*0x8]
00686fa1 : MOV dword ptr [ESP + 0x10],EAX
00686fa5 : MOV EAX,dword ptr [ECX + ESI*0x8]
00686fa8 : MOV dword ptr [ESP + 0x20],EAX
00686fac : MOV ESI,dword ptr [ECX + ESI*0x8 + 0x4]
00686fb0 : MOV ECX,dword ptr [EBP + 0x8]
00686fb3 : MOV ECX,dword ptr [ECX + 0x4]
00686fb6 : MOV dword ptr [ESP + 0x24],ESI
00686fba : MOV EDX,dword ptr [ECX + EDX*0x8]
00686fbd : MOV dword ptr [ESP + 0x30],EDX
00686fc1 : MOV EDX,dword ptr [ESP + 0x14]
00686fc5 : MOV EDX,dword ptr [ECX + EDX*0x8 + 0x4]
00686fc9 : MOV dword ptr [ESP + 0x1c],ECX
00686fcd : MOV ECX,EDI
00686fcf : SHL ESI,CL
00686fd1 : SHL EDX,CL
00686fd3 : SHL EAX,CL
00686fd5 : SUB ESI,EBX
00686fd7 : MOV dword ptr [ESP + 0x24],ESI
00686fdb : MOV ESI,dword ptr [ESP + 0x30]
00686fdf : SHL ESI,CL
00686fe1 : MOV ECX,dword ptr [ESP + 0x24]
00686fe5 : SUB EDX,EBX
00686fe7 : MOV dword ptr [ESP + 0x34],EDX
00686feb : MOV EDX,dword ptr [ESP + 0xc]
00686fef : MOV dword ptr [ESP + 0x2c],ECX
00686ff3 : MOV ECX,dword ptr [ESP + 0x1c]
00686ff7 : SUB ESI,EBX
00686ff9 : MOV dword ptr [ESP + 0x30],ESI
00686ffd : LEA ESI,[ECX + EDX*0x8]
00687000 : MOV ECX,dword ptr [EBP + 0x8]
00687003 : MOV ECX,dword ptr [ECX + 0x8]
00687006 : ADD EDX,ECX
00687008 : SUB EAX,EBX
0068700a : MOV dword ptr [ESP + 0xc],EDX
0068700e : MOV dword ptr [ESP + 0x20],EAX
00687012 : MOV dword ptr [ESP + 0x28],EAX
00687016 : MOVSX EDX,byte ptr [EDX]
00687019 : AND EDX,0x3
0068701c : CMP EDX,0x2
0068701f : JZ 0x006872ea
00687025 : TEST EDX,EDX
00687027 : JNZ 0x00687074
00687029 : MOV EDX,dword ptr [ESP + 0x14]
0068702d : MOV CL,byte ptr [ECX + EDX*0x1]
00687030 : AND CL,0x3
00687033 : CMP CL,0x1
00687036 : JNZ 0x0068704b
00687038 : MOV EDX,dword ptr [ESP + 0x30]
0068703c : MOV EAX,dword ptr [ESP + 0x34]
00687040 : SUB dword ptr [ESP + 0x10],0x8
00687045 : MOV dword ptr [ESP + 0x20],EDX
00687049 : JMP 0x00687069
0068704b : MOV ECX,dword ptr [ESP + 0x30]
0068704f : ADD EAX,ECX
00687051 : CDQ
00687052 : SUB EAX,EDX
00687054 : MOV EDX,dword ptr [ESP + 0x24]
00687058 : SAR EAX,0x1
0068705a : MOV dword ptr [ESP + 0x20],EAX
0068705e : MOV EAX,dword ptr [ESP + 0x34]
00687062 : ADD EAX,EDX
00687064 : CDQ
00687065 : SUB EAX,EDX
00687067 : SAR EAX,0x1
00687069 : SUB ESI,0x8
0068706c : DEC dword ptr [ESP + 0xc]
00687070 : MOV dword ptr [ESP + 0x24],EAX
00687074 : MOV ECX,dword ptr [EBP + 0x10]
00687077 : MOV EAX,dword ptr [EBP + 0xc]
0068707a : PUSH ECX
0068707b : MOV ECX,dword ptr [EAX]
0068707d : LEA EDX,[ESP + 0x24]
00687081 : PUSH EDX
00687082 : CALL ECX
00687084 : ADD ESP,0x8
00687087 : TEST EAX,EAX
00687089 : JNZ 0x006872fb
0068708f : MOV EDX,dword ptr [ESP + 0x10]
00687093 : CMP ESI,EDX
00687095 : JC 0x006870e4
00687097 : MOV ECX,dword ptr [EBP + 0x10]
0068709a : MOV EAX,dword ptr [EBP + 0xc]
0068709d : PUSH ECX
0068709e : MOV ECX,dword ptr [EAX + 0x4]
006870a1 : LEA EDX,[ESP + 0x24]
006870a5 : PUSH EDX
006870a6 : CALL ECX
006870a8 : ADD ESP,0x8
006870ab : TEST EAX,EAX
006870ad : JNZ 0x006872fb
006870b3 : MOV EDX,dword ptr [EBP + 0x8]
006870b6 : MOV EAX,dword ptr [ESP + 0x18]
006870ba : MOVSX ECX,word ptr [EDX]
006870bd : MOV ESI,dword ptr [ESP + 0x14]
006870c1 : INC EAX
006870c2 : INC ESI
006870c3 : CMP EAX,ECX
006870c5 : MOV dword ptr [ESP + 0xc],ESI
006870c9 : MOV dword ptr [ESP + 0x18],EAX
006870cd : JL 0x00686f82
006870d3 : XOR EAX,EAX
006870d5 : POP EDI
006870d6 : POP ESI
006870d7 : POP EBX
006870d8 : MOV ESP,EBP
006870da : POP EBP
006870db : RET
006870e0 : MOV EDX,dword ptr [ESP + 0x10]
006870e4 : MOV EAX,dword ptr [ESP + 0xc]
006870e8 : MOVSX ECX,byte ptr [EAX + 0x1]
006870ec : INC EAX
006870ed : AND ECX,0x3
006870f0 : ADD ESI,0x8
006870f3 : SUB ECX,0x0
006870f6 : MOV dword ptr [ESP + 0xc],EAX
006870fa : JZ 0x006871ca
00687100 : SUB ECX,0x1
00687103 : JZ 0x0068719a
00687109 : LEA ECX,[ESI + 0x8]
0068710c : CMP ECX,EDX
0068710e : JA 0x006872ea
00687114 : MOV CL,byte ptr [EAX + 0x1]
00687117 : AND CL,0x3
0068711a : CMP CL,0x2
0068711d : JNZ 0x006872ea
00687123 : ADD EAX,0x2
00687126 : MOV dword ptr [ESP + 0xc],EAX
0068712a : MOV EAX,dword ptr [ESI]
0068712c : ADD ESI,0x10
0068712f : MOV ECX,EDI
00687131 : SHL EAX,CL
00687133 : SUB EAX,EBX
00687135 : MOV dword ptr [ESP + 0x48],EAX
00687139 : MOV EAX,dword ptr [ESI + -0xc]
0068713c : SHL EAX,CL
0068713e : SUB EAX,EBX
00687140 : MOV dword ptr [ESP + 0x4c],EAX
00687144 : MOV EAX,dword ptr [ESI + -0x8]
00687147 : SHL EAX,CL
00687149 : SUB EAX,EBX
0068714b : MOV dword ptr [ESP + 0x40],EAX
0068714f : MOV EAX,dword ptr [ESI + -0x4]
00687152 : SHL EAX,CL
00687154 : SUB EAX,EBX
00687156 : MOV dword ptr [ESP + 0x44],EAX
0068715a : CMP ESI,EDX
0068715c : JA 0x006872a9
00687162 : MOV EDX,dword ptr [ESI]
00687164 : MOV EAX,dword ptr [ESI + 0x4]
00687167 : SHL EDX,CL
00687169 : SHL EAX,CL
0068716b : MOV ECX,dword ptr [EBP + 0x10]
0068716e : PUSH ECX
0068716f : SUB EDX,EBX
00687171 : SUB EAX,EBX
00687173 : MOV dword ptr [ESP + 0x54],EDX
00687177 : MOV dword ptr [ESP + 0x58],EAX
0068717b : LEA EDX,[ESP + 0x54]
0068717f : PUSH EDX
00687180 : MOV EDX,dword ptr [EBP + 0xc]
00687183 : LEA EAX,[ESP + 0x48]
00687187 : PUSH EAX
00687188 : MOV EAX,dword ptr [EDX + 0xc]
0068718b : LEA ECX,[ESP + 0x54]
0068718f : PUSH ECX
00687190 : CALL EAX
00687192 : ADD ESP,0x10
00687195 : JMP 0x00687296
0068719a : MOV EDX,dword ptr [ESI]
0068719c : MOV EAX,dword ptr [ESI + 0x4]
0068719f : MOV ECX,EDI
006871a1 : SHL EDX,CL
006871a3 : SHL EAX,CL
006871a5 : MOV ECX,dword ptr [EBP + 0x10]
006871a8 : PUSH ECX
006871a9 : SUB EDX,EBX
006871ab : SUB EAX,EBX
006871ad : MOV dword ptr [ESP + 0x5c],EDX
006871b1 : MOV dword ptr [ESP + 0x60],EAX
006871b5 : MOV EAX,dword ptr [EBP + 0xc]
006871b8 : MOV ECX,dword ptr [EAX + 0x4]
006871bb : LEA EDX,[ESP + 0x5c]
006871bf : PUSH EDX
006871c0 : CALL ECX
006871c2 : ADD ESP,0x8
006871c5 : JMP 0x00687296
006871ca : MOV EDX,dword ptr [ESI]
006871cc : MOV ECX,EDI
006871ce : SHL EDX,CL
006871d0 : SUB EDX,EBX
006871d2 : MOV dword ptr [ESP + 0x28],EDX
006871d6 : MOV EDX,dword ptr [ESI + 0x4]
006871d9 : SHL EDX,CL
006871db : SUB EDX,EBX
006871dd : MOV dword ptr [ESP + 0x2c],EDX
006871e1 : CMP ESI,dword ptr [ESP + 0x10]
006871e5 : JNC 0x006872cc
006871eb : MOV EDX,dword ptr [ESI + 0xc]
006871ee : INC EAX
006871ef : MOV dword ptr [ESP + 0xc],EAX
006871f3 : MOVSX EAX,byte ptr [EAX]
006871f6 : AND EAX,0x3
006871f9 : ADD ESI,0x8
006871fc : MOV dword ptr [ESP + 0x1c],EAX
00687200 : MOV EAX,dword ptr [ESI]
00687202 : MOV ECX,EDI
00687204 : SHL EAX,CL
00687206 : SHL EDX,CL
00687208 : MOV ECX,dword ptr [ESP + 0x1c]
0068720c : SUB EAX,EBX
0068720e : SUB EDX,EBX
00687210 : MOV dword ptr [ESP + 0x38],EAX
00687214 : MOV dword ptr [ESP + 0x3c],EDX
00687218 : CMP ECX,0x1
0068721b : JZ 0x0068727d
0068721d : TEST ECX,ECX
0068721f : JNZ 0x006872ea
00687225 : MOV EDX,dword ptr [ESP + 0x28]
00687229 : MOV ECX,dword ptr [ESP + 0x2c]
0068722d : ADD EAX,EDX
0068722f : CDQ
00687230 : SUB EAX,EDX
00687232 : SAR EAX,0x1
00687234 : MOV dword ptr [ESP + 0x60],EAX
00687238 : MOV EAX,dword ptr [ESP + 0x3c]
0068723c : ADD EAX,ECX
0068723e : CDQ
0068723f : SUB EAX,EDX
00687241 : MOV EDX,dword ptr [EBP + 0x10]
00687244 : SAR EAX,0x1
00687246 : MOV dword ptr [ESP + 0x64],EAX
0068724a : PUSH EDX
0068724b : MOV EDX,dword ptr [EBP + 0xc]
0068724e : LEA EAX,[ESP + 0x64]
00687252 : PUSH EAX
00687253 : MOV EAX,dword ptr [EDX + 0x8]
00687256 : LEA ECX,[ESP + 0x30]
0068725a : PUSH ECX
0068725b : CALL EAX
0068725d : ADD ESP,0xc
00687260 : TEST EAX,EAX
00687262 : JNZ 0x006872fb
00687268 : MOV ECX,dword ptr [ESP + 0x38]
0068726c : MOV EDX,dword ptr [ESP + 0x3c]
00687270 : MOV EAX,dword ptr [ESP + 0xc]
00687274 : MOV dword ptr [ESP + 0x28],ECX
00687278 : JMP 0x006871dd
0068727d : MOV EAX,dword ptr [EBP + 0x10]
00687280 : PUSH EAX
00687281 : MOV EAX,dword ptr [EBP + 0xc]
00687284 : LEA ECX,[ESP + 0x3c]
00687288 : PUSH ECX
00687289 : MOV ECX,dword ptr [EAX + 0x8]
0068728c : LEA EDX,[ESP + 0x30]
00687290 : PUSH EDX
00687291 : CALL ECX
00687293 : ADD ESP,0xc
00687296 : TEST EAX,EAX
00687298 : JNZ 0x006872fb
0068729a : CMP ESI,dword ptr [ESP + 0x10]
0068729e : JC 0x006870e0
006872a4 : JMP 0x00687097
006872a9 : MOV EDX,dword ptr [EBP + 0x10]
006872ac : PUSH EDX
006872ad : LEA EAX,[ESP + 0x24]
006872b1 : PUSH EAX
006872b2 : MOV EAX,dword ptr [EBP + 0xc]
006872b5 : LEA ECX,[ESP + 0x48]
006872b9 : PUSH ECX
006872ba : MOV ECX,dword ptr [EAX + 0xc]
006872bd : LEA EDX,[ESP + 0x54]
006872c1 : PUSH EDX
006872c2 : CALL ECX
006872c4 : ADD ESP,0x10
006872c7 : JMP 0x006870ab
006872cc : MOV EDX,dword ptr [EBP + 0x10]
006872cf : PUSH EDX
006872d0 : MOV EDX,dword ptr [EBP + 0xc]
006872d3 : LEA EAX,[ESP + 0x24]
006872d7 : PUSH EAX
006872d8 : MOV EAX,dword ptr [EDX + 0x8]
006872db : LEA ECX,[ESP + 0x30]
006872df : PUSH ECX
006872e0 : CALL EAX
006872e2 : ADD ESP,0xc
006872e5 : JMP 0x006870ab
006872ea : MOV EAX,0x14
006872ef : POP EDI
006872f0 : POP ESI
006872f1 : POP EBX
006872f2 : MOV ESP,EBP
006872f4 : POP EBP
006872f5 : RET
006872f6 : MOV EAX,0x6
006872fb : POP EDI
006872fc : POP ESI
006872fd : POP EBX
006872fe : MOV ESP,EBP
00687300 : POP EBP
00687301 : RET
