PROGRAM  : Maestia.exe
FUNCTION : FUN_00712800
ENTRY    : 00712800
BODY     : [[00712800, 007129db]]

============================================================
DECOMPILED C CODE
============================================================

byte FUN_00712800(int *param_1,int param_2)

{
  int *piVar1;
  int iVar2;
  uint uVar3;
  int iVar4;
  uint local_8;
  
  local_8 = 0xffff;
  if (param_1[3] - 5U < 0xffff) {
    local_8 = param_1[3] - 5U;
  }
  do {
    uVar3 = param_1[0x1b];
    if (uVar3 < 2) {
      FUN_00711f90();
      uVar3 = param_1[0x1b];
      if (uVar3 == 0) {
        if (param_2 == 0) {
          return 0;
        }
        iVar2 = param_1[0x15];
        if (iVar2 < 0) {
          iVar4 = 0;
        }
        else {
          iVar4 = param_1[0xc] + iVar2;
        }
        FUN_0070fce0(iVar4,param_1[0x19] - iVar2);
        param_1[0x15] = param_1[0x19];
        FUN_00711800();
        if (*(int *)(*param_1 + 0x10) != 0) {
          return (param_2 == 4) * '\x02' + 1;
        }
        return (param_2 != 4) - 1U & 2;
      }
    }
    piVar1 = param_1 + 0x19;
    *piVar1 = *piVar1 + uVar3;
    iVar2 = param_1[0x15];
    param_1[0x1b] = 0;
    uVar3 = iVar2 + local_8;
    if ((*piVar1 == 0) || (uVar3 <= (uint)param_1[0x19])) {
      param_1[0x1b] = param_1[0x19] - uVar3;
      param_1[0x19] = uVar3;
      if (iVar2 < 0) {
        iVar4 = 0;
      }
      else {
        iVar4 = param_1[0xc] + iVar2;
      }
      FUN_0070fce0(iVar4,uVar3 - iVar2);
      iVar2 = *param_1;
      param_1[0x15] = param_1[0x19];
      uVar3 = *(uint *)(*(int *)(iVar2 + 0x1c) + 0x14);
      if (*(uint *)(iVar2 + 0x10) < uVar3) {
        uVar3 = *(uint *)(iVar2 + 0x10);
      }
      if (uVar3 != 0) {
        _memcpy(*(void **)(iVar2 + 0xc),*(void **)(*(int *)(iVar2 + 0x1c) + 0x10),uVar3);
        *(int *)(iVar2 + 0xc) = *(int *)(iVar2 + 0xc) + uVar3;
        piVar1 = (int *)(*(int *)(iVar2 + 0x1c) + 0x10);
        *piVar1 = *piVar1 + uVar3;
        *(int *)(iVar2 + 0x14) = *(int *)(iVar2 + 0x14) + uVar3;
        *(int *)(iVar2 + 0x10) = *(int *)(iVar2 + 0x10) - uVar3;
        piVar1 = (int *)(*(int *)(iVar2 + 0x1c) + 0x14);
        *piVar1 = *piVar1 - uVar3;
        iVar2 = *(int *)(iVar2 + 0x1c);
        if (*(int *)(iVar2 + 0x14) == 0) {
          *(undefined4 *)(iVar2 + 0x10) = *(undefined4 *)(iVar2 + 8);
        }
      }
      if (*(int *)(*param_1 + 0x10) == 0) {
        return 0;
      }
    }
    iVar2 = param_1[0x15];
    if (param_1[9] - 0x106U <= (uint)(param_1[0x19] - iVar2)) {
      if (iVar2 < 0) {
        iVar4 = 0;
      }
      else {
        iVar4 = param_1[0xc] + iVar2;
      }
      FUN_0070fce0(iVar4,param_1[0x19] - iVar2);
      iVar2 = *param_1;
      param_1[0x15] = param_1[0x19];
      uVar3 = *(uint *)(*(int *)(iVar2 + 0x1c) + 0x14);
      if (*(uint *)(iVar2 + 0x10) < uVar3) {
        uVar3 = *(uint *)(iVar2 + 0x10);
      }
      if (uVar3 != 0) {
        _memcpy(*(void **)(iVar2 + 0xc),*(void **)(*(int *)(iVar2 + 0x1c) + 0x10),uVar3);
        *(int *)(iVar2 + 0xc) = *(int *)(iVar2 + 0xc) + uVar3;
        piVar1 = (int *)(*(int *)(iVar2 + 0x1c) + 0x10);
        *piVar1 = *piVar1 + uVar3;
        *(int *)(iVar2 + 0x14) = *(int *)(iVar2 + 0x14) + uVar3;
        *(int *)(iVar2 + 0x10) = *(int *)(iVar2 + 0x10) - uVar3;
        piVar1 = (int *)(*(int *)(iVar2 + 0x1c) + 0x14);
        *piVar1 = *piVar1 - uVar3;
        iVar2 = *(int *)(iVar2 + 0x1c);
        if (*(int *)(iVar2 + 0x14) == 0) {
          *(undefined4 *)(iVar2 + 0x10) = *(undefined4 *)(iVar2 + 8);
        }
      }
      if (*(int *)(*param_1 + 0x10) == 0) {
        return 0;
      }
    }
  } while( true );
}



============================================================
DISASSEMBLY
============================================================
00712800 : PUSH EBP
00712801 : MOV EBP,ESP
00712803 : PUSH ECX
00712804 : PUSH EBX
00712805 : PUSH ESI
00712806 : MOV ESI,dword ptr [EBP + 0x8]
00712809 : MOV EAX,dword ptr [ESI + 0xc]
0071280c : ADD EAX,-0x5
0071280f : PUSH EDI
00712810 : MOV dword ptr [EBP + -0x4],0xffff
00712817 : CMP EAX,0xffff
0071281c : JNC 0x00712821
0071281e : MOV dword ptr [EBP + -0x4],EAX
00712821 : MOV EAX,dword ptr [ESI + 0x6c]
00712824 : CMP EAX,0x1
00712827 : JA 0x0071283b
00712829 : MOV EDI,ESI
0071282b : CALL 0x00711f90
00712830 : MOV EAX,dword ptr [ESI + 0x6c]
00712833 : TEST EAX,EAX
00712835 : JZ 0x00712972
0071283b : ADD dword ptr [ESI + 0x64],EAX
0071283e : MOV ECX,dword ptr [ESI + 0x54]
00712841 : MOV EAX,dword ptr [EBP + -0x4]
00712844 : MOV EDX,dword ptr [ESI + 0x64]
00712847 : MOV dword ptr [ESI + 0x6c],0x0
0071284e : LEA EAX,[ECX + EAX*0x1]
00712851 : JZ 0x0071285b
00712853 : CMP EDX,EAX
00712855 : JC 0x007128db
0071285b : SUB EDX,EAX
0071285d : MOV dword ptr [ESI + 0x6c],EDX
00712860 : MOV dword ptr [ESI + 0x64],EAX
00712863 : TEST ECX,ECX
00712865 : JL 0x0071286e
00712867 : MOV EDX,dword ptr [ESI + 0x30]
0071286a : ADD EDX,ECX
0071286c : JMP 0x00712870
0071286e : XOR EDX,EDX
00712870 : SUB EAX,ECX
00712872 : PUSH EAX
00712873 : PUSH EDX
00712874 : XOR EDI,EDI
00712876 : MOV EAX,ESI
00712878 : CALL 0x0070fce0
0071287d : MOV ECX,dword ptr [ESI + 0x64]
00712880 : MOV EDI,dword ptr [ESI]
00712882 : MOV dword ptr [ESI + 0x54],ECX
00712885 : MOV EAX,dword ptr [EDI + 0x1c]
00712888 : MOV EBX,dword ptr [EAX + 0x14]
0071288b : MOV ECX,dword ptr [EDI + 0x10]
0071288e : ADD ESP,0x8
00712891 : CMP EBX,ECX
00712893 : CMOVA EBX,ECX
00712896 : TEST EBX,EBX
00712898 : JZ 0x007128cf
0071289a : MOV EDX,dword ptr [EAX + 0x10]
0071289d : MOV EAX,dword ptr [EDI + 0xc]
007128a0 : PUSH EBX
007128a1 : PUSH EDX
007128a2 : PUSH EAX
007128a3 : CALL 0x0063ae40
007128a8 : MOV EAX,dword ptr [EDI + 0x1c]
007128ab : ADD dword ptr [EDI + 0xc],EBX
007128ae : ADD dword ptr [EAX + 0x10],EBX
007128b1 : ADD dword ptr [EDI + 0x14],EBX
007128b4 : SUB dword ptr [EDI + 0x10],EBX
007128b7 : MOV EAX,dword ptr [EDI + 0x1c]
007128ba : SUB dword ptr [EAX + 0x14],EBX
007128bd : MOV EDI,dword ptr [EDI + 0x1c]
007128c0 : ADD ESP,0xc
007128c3 : CMP dword ptr [EDI + 0x14],0x0
007128c7 : JNZ 0x007128cf
007128c9 : MOV ECX,dword ptr [EDI + 0x8]
007128cc : MOV dword ptr [EDI + 0x10],ECX
007128cf : MOV EDX,dword ptr [ESI]
007128d1 : CMP dword ptr [EDX + 0x10],0x0
007128d5 : JZ 0x00712969
007128db : MOV EDX,dword ptr [ESI + 0x54]
007128de : MOV ECX,dword ptr [ESI + 0x64]
007128e1 : MOV EAX,dword ptr [ESI + 0x24]
007128e4 : SUB ECX,EDX
007128e6 : SUB EAX,0x106
007128eb : CMP ECX,EAX
007128ed : JC 0x00712821
007128f3 : TEST EDX,EDX
007128f5 : JL 0x007128fe
007128f7 : MOV EAX,dword ptr [ESI + 0x30]
007128fa : ADD EAX,EDX
007128fc : JMP 0x00712900
007128fe : XOR EAX,EAX
00712900 : PUSH ECX
00712901 : PUSH EAX
00712902 : XOR EDI,EDI
00712904 : MOV EAX,ESI
00712906 : CALL 0x0070fce0
0071290b : MOV ECX,dword ptr [ESI + 0x64]
0071290e : MOV EDI,dword ptr [ESI]
00712910 : MOV dword ptr [ESI + 0x54],ECX
00712913 : MOV EAX,dword ptr [EDI + 0x1c]
00712916 : MOV EBX,dword ptr [EAX + 0x14]
00712919 : MOV ECX,dword ptr [EDI + 0x10]
0071291c : ADD ESP,0x8
0071291f : CMP EBX,ECX
00712921 : CMOVA EBX,ECX
00712924 : TEST EBX,EBX
00712926 : JZ 0x0071295d
00712928 : MOV EDX,dword ptr [EAX + 0x10]
0071292b : MOV EAX,dword ptr [EDI + 0xc]
0071292e : PUSH EBX
0071292f : PUSH EDX
00712930 : PUSH EAX
00712931 : CALL 0x0063ae40
00712936 : MOV EAX,dword ptr [EDI + 0x1c]
00712939 : ADD dword ptr [EDI + 0xc],EBX
0071293c : ADD dword ptr [EAX + 0x10],EBX
0071293f : ADD dword ptr [EDI + 0x14],EBX
00712942 : SUB dword ptr [EDI + 0x10],EBX
00712945 : MOV EAX,dword ptr [EDI + 0x1c]
00712948 : SUB dword ptr [EAX + 0x14],EBX
0071294b : MOV EDI,dword ptr [EDI + 0x1c]
0071294e : ADD ESP,0xc
00712951 : CMP dword ptr [EDI + 0x14],0x0
00712955 : JNZ 0x0071295d
00712957 : MOV ECX,dword ptr [EDI + 0x8]
0071295a : MOV dword ptr [EDI + 0x10],ECX
0071295d : MOV EDX,dword ptr [ESI]
0071295f : CMP dword ptr [EDX + 0x10],0x0
00712963 : JNZ 0x00712821
00712969 : POP EDI
0071296a : POP ESI
0071296b : XOR EAX,EAX
0071296d : POP EBX
0071296e : MOV ESP,EBP
00712970 : POP EBP
00712971 : RET
00712972 : MOV EBX,dword ptr [EBP + 0xc]
00712975 : TEST EBX,EBX
00712977 : JZ 0x00712969
00712979 : MOV ECX,dword ptr [ESI + 0x54]
0071297c : TEST ECX,ECX
0071297e : JL 0x00712987
00712980 : MOV EAX,dword ptr [ESI + 0x30]
00712983 : ADD EAX,ECX
00712985 : JMP 0x00712989
00712987 : XOR EAX,EAX
00712989 : MOV EDI,dword ptr [ESI + 0x64]
0071298c : XOR EDX,EDX
0071298e : CMP EBX,0x4
00712991 : SETZ DL
00712994 : SUB EDI,ECX
00712996 : PUSH EDI
00712997 : PUSH EAX
00712998 : MOV EAX,ESI
0071299a : MOV EDI,EDX
0071299c : CALL 0x0070fce0
007129a1 : MOV EAX,dword ptr [ESI + 0x64]
007129a4 : MOV dword ptr [ESI + 0x54],EAX
007129a7 : MOV EAX,dword ptr [ESI]
007129a9 : ADD ESP,0x8
007129ac : CALL 0x00711800
007129b1 : MOV ECX,dword ptr [ESI]
007129b3 : XOR EAX,EAX
007129b5 : CMP dword ptr [ECX + 0x10],EAX
007129b8 : JNZ 0x007129cb
007129ba : CMP EBX,0x4
007129bd : SETNZ AL
007129c0 : POP EDI
007129c1 : POP ESI
007129c2 : POP EBX
007129c3 : DEC EAX
007129c4 : AND EAX,0x2
007129c7 : MOV ESP,EBP
007129c9 : POP EBP
007129ca : RET
007129cb : CMP EBX,0x4
007129ce : SETZ AL
007129d1 : POP EDI
007129d2 : POP ESI
007129d3 : POP EBX
007129d4 : LEA EAX,[EAX + EAX*0x1 + 0x1]
007129d8 : MOV ESP,EBP
007129da : POP EBP
007129db : RET
