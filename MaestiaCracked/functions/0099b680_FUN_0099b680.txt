PROGRAM  : Maestia.exe
FUNCTION : FUN_0099b680
ENTRY    : 0099b680
BODY     : [[0099b680, 0099ba34]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0099b680(ushort *param_1)

{
  undefined2 *puVar1;
  short sVar2;
  int *piVar3;
  uint uVar4;
  int iVar5;
  short *psVar6;
  int *in_ECX;
  uint uVar7;
  undefined1 *puVar8;
  ushort *puVar9;
  int *piVar10;
  _SYSTEMTIME local_248;
  short *local_238;
  int *local_234;
  int local_230;
  int local_22c;
  ushort *local_228;
  int *local_224;
  int local_220;
  short *local_21c;
  short local_218;
  undefined1 local_216 [510];
  uint local_18;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b60b99;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  iVar5 = *in_ECX;
  local_228 = param_1;
  puVar9 = param_1 + 3;
  uVar7 = (*param_1 & 0x1fff) - 6;
  local_224 = in_ECX;
  local_18 = uVar4;
  FUN_00401c00(*(undefined4 *)(*(int *)(iVar5 + 4) + 4));
  *(int *)(*(int *)(iVar5 + 4) + 4) = *(int *)(iVar5 + 4);
  *(undefined4 *)(iVar5 + 8) = 0;
  *(undefined4 *)*(undefined4 *)(iVar5 + 4) = *(undefined4 *)(iVar5 + 4);
  *(int *)(*(int *)(iVar5 + 4) + 8) = *(int *)(iVar5 + 4);
  local_22c = 0;
  if (local_228[2] != 0) {
    while( true ) {
      local_220 = FUN_006f0760(0x68,"",0,(DAT_01725270 >> 3 & 1) == 0,uVar4);
      piVar10 = (int *)0x0;
      local_8 = 0;
      if (local_220 != 0) {
        piVar10 = (int *)FUN_00412470(local_220);
      }
      local_8 = 0xffffffff;
      if (((piVar10 == (int *)0x0) || (puVar9 == (ushort *)0x0)) || (uVar7 < 4)) break;
      *piVar10 = *(int *)puVar9;
      if ((puVar9 + 2 == (ushort *)0x0) || (uVar7 == 4)) break;
      *(char *)((int)piVar10 + 10) = (char)puVar9[2];
      if (((int *)((int)puVar9 + 5) == (int *)0x0) || (uVar7 - 5 < 4)) break;
      piVar10[1] = *(int *)((int)puVar9 + 5);
      if (((undefined2 *)((int)puVar9 + 9) == (undefined2 *)0x0) || (uVar7 - 9 < 2)) break;
      uVar7 = uVar7 - 0xb;
      *(undefined2 *)(piVar10 + 2) = *(undefined2 *)((int)puVar9 + 9);
      if (((short *)((int)puVar9 + 0xb) == (short *)0x0) ||
         (((uVar7 < 2 || (sVar2 = *(short *)((int)puVar9 + 0xb), sVar2 < 0)) ||
          (iVar5 = (int)sVar2, (int)uVar7 < iVar5 + 2)))) break;
      local_21c = (short *)((int)puVar9 + 0xd);
      uVar7 = uVar7 + (-2 - iVar5);
      puVar1 = (undefined2 *)((int)puVar9 + iVar5 + 0xd);
      if (local_21c == (short *)0x0) break;
      local_220 = (int)puVar9 + 0xf;
      psVar6 = local_21c;
      do {
        sVar2 = *psVar6;
        psVar6 = psVar6 + 1;
      } while (sVar2 != 0);
      FUN_00406360();
      if ((puVar1 == (undefined2 *)0x0) || (uVar7 < 2)) {
LAB_0099b86d:
        iVar5 = 0;
        puVar8 = (undefined1 *)0x0;
      }
      else {
        *(undefined2 *)(piVar10 + 3) = *puVar1;
        if ((puVar1 + 1 == (undefined2 *)0x0) || (uVar7 == 2)) goto LAB_0099b86d;
        *(undefined1 *)(piVar10 + 6) = *(undefined1 *)(puVar1 + 1);
        if (((int *)((int)puVar1 + 3) == (int *)0x0) || (uVar7 - 3 < 8)) goto LAB_0099b86d;
        piVar10[8] = *(int *)((int)puVar1 + 3);
        iVar5 = uVar7 - 0xb;
        piVar10[9] = *(int *)((int)puVar1 + 7);
        puVar8 = (undefined1 *)((int)puVar1 + 0xb);
      }
      if (piVar10[3] == 0xffff) {
        VariantTimeToSystemTime(*(DOUBLE *)(piVar10 + 8),&local_248);
        local_218 = 0;
        _memset(local_216,0,0x1fe);
        FUN_004214d0(L"%d-%d %d:%d",local_248.wMonth,local_248.wDay,local_248.wHour,
                     local_248.wMinute);
        psVar6 = &local_218;
        do {
          sVar2 = *psVar6;
          psVar6 = psVar6 + 1;
        } while (sVar2 != 0);
        FUN_00406360();
      }
      else {
        piVar10[5] = 1;
      }
      if ((puVar8 == (undefined1 *)0x0) || (iVar5 == 0)) {
        uVar7 = 0;
        puVar9 = (ushort *)0x0;
      }
      else {
        uVar7 = iVar5 - 1;
        *(undefined1 *)(piVar10 + 0x18) = *puVar8;
        puVar9 = (ushort *)(puVar8 + 1);
      }
      piVar3 = DAT_00da9894;
      if (9 < *(byte *)(piVar10 + 0x18)) {
        *(byte *)(piVar10 + 0x18) = *(byte *)(piVar10 + 0x18) - 10;
        FUN_009adfc0(*(undefined4 *)(*piVar3 + 0x1a8),1,local_21c);
      }
      if (piVar10[3] == 0xfffd) {
        FUN_009adfc0(*(undefined4 *)(*DAT_00da9894 + 0x1a8),1,local_21c);
        *(undefined1 *)((int)piVar10 + 0x61) = 1;
      }
      local_21c = (short *)*piVar10;
      FUN_004437f0(&local_21c);
      if (local_230 == *(int *)(*local_224 + 4)) {
        local_238 = local_21c;
        local_234 = piVar10;
        FUN_00451e00();
      }
      local_22c = local_22c + 1;
      if ((int)(uint)local_228[2] <= local_22c) break;
    }
  }
  FUN_0099aee0();
  ExceptionList = local_10;
  __security_check_cookie(local_18 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
0099b680 : PUSH EBP
0099b681 : MOV EBP,ESP
0099b683 : PUSH -0x1
0099b685 : PUSH 0xb60b99
0099b68a : MOV EAX,FS:[0x0]
0099b690 : PUSH EAX
0099b691 : SUB ESP,0x240
0099b697 : MOV EAX,[0x00d66fa0]
0099b69c : XOR EAX,EBP
0099b69e : MOV dword ptr [EBP + -0x14],EAX
0099b6a1 : PUSH EBX
0099b6a2 : PUSH ESI
0099b6a3 : PUSH EDI
0099b6a4 : PUSH EAX
0099b6a5 : LEA EAX,[EBP + -0xc]
0099b6a8 : MOV FS:[0x0],EAX
0099b6ae : MOV EAX,dword ptr [EBP + 0x8]
0099b6b1 : MOV EDI,dword ptr [ECX]
0099b6b3 : MOVZX EBX,word ptr [EAX]
0099b6b6 : MOV dword ptr [EBP + 0xfffffddc],EAX
0099b6bc : LEA ESI,[EAX + 0x6]
0099b6bf : MOV EAX,dword ptr [EDI + 0x4]
0099b6c2 : MOV dword ptr [EBP + 0xfffffde0],ECX
0099b6c8 : MOV ECX,dword ptr [EAX + 0x4]
0099b6cb : PUSH ECX
0099b6cc : AND EBX,0x1fff
0099b6d2 : MOV ECX,EDI
0099b6d4 : SUB EBX,0x6
0099b6d7 : CALL 0x00401c00
0099b6dc : MOV EAX,dword ptr [EDI + 0x4]
0099b6df : MOV dword ptr [EAX + 0x4],EAX
0099b6e2 : MOV EAX,dword ptr [EDI + 0x4]
0099b6e5 : XOR ECX,ECX
0099b6e7 : MOV dword ptr [EDI + 0x8],ECX
0099b6ea : MOV dword ptr [EAX],EAX
0099b6ec : MOV EDI,dword ptr [EDI + 0x4]
0099b6ef : MOV EAX,dword ptr [EBP + 0xfffffddc]
0099b6f5 : XOR EDX,EDX
0099b6f7 : MOV dword ptr [EDI + 0x8],EDI
0099b6fa : MOV dword ptr [EBP + 0xfffffdd8],ECX
0099b700 : CMP DX,word ptr [EAX + 0x4]
0099b704 : JNC 0x0099ba0a
0099b70a : MOV ECX,dword ptr [0x01725270]
0099b710 : SHR ECX,0x3
0099b713 : MOV EDX,0x0
0099b718 : AND ECX,0x1
0099b71b : SETZ DL
0099b71e : PUSH EDX
0099b71f : PUSH 0x0
0099b721 : PUSH 0xbf1a4a
0099b726 : PUSH 0x68
0099b728 : CALL 0x006f0760
0099b72d : ADD ESP,0x10
0099b730 : MOV dword ptr [EBP + 0xfffffde4],EAX
0099b736 : XOR EDI,EDI
0099b738 : MOV dword ptr [EBP + -0x4],EDI
0099b73b : CMP EAX,EDI
0099b73d : JZ 0x0099b747
0099b73f : PUSH EAX
0099b740 : CALL 0x00412470
0099b745 : MOV EDI,EAX
0099b747 : MOV dword ptr [EBP + -0x4],0xffffffff
0099b74e : TEST EDI,EDI
0099b750 : JZ 0x0099ba0a
0099b756 : TEST ESI,ESI
0099b758 : JZ 0x0099ba0a
0099b75e : CMP EBX,0x4
0099b761 : JC 0x0099ba0a
0099b767 : MOV EAX,dword ptr [ESI]
0099b769 : SUB EBX,0x4
0099b76c : ADD ESI,0x4
0099b76f : MOV dword ptr [EDI],EAX
0099b771 : JZ 0x0099ba0a
0099b777 : CMP EBX,0x1
0099b77a : JC 0x0099ba0a
0099b780 : MOV CL,byte ptr [ESI]
0099b782 : DEC EBX
0099b783 : ADD ESI,0x1
0099b786 : MOV byte ptr [EDI + 0xa],CL
0099b789 : JZ 0x0099ba0a
0099b78f : CMP EBX,0x4
0099b792 : JC 0x0099ba0a
0099b798 : MOV EDX,dword ptr [ESI]
0099b79a : SUB EBX,0x4
0099b79d : ADD ESI,0x4
0099b7a0 : MOV dword ptr [EDI + 0x4],EDX
0099b7a3 : JZ 0x0099ba0a
0099b7a9 : CMP EBX,0x2
0099b7ac : JC 0x0099ba0a
0099b7b2 : MOV AX,word ptr [ESI]
0099b7b5 : SUB EBX,0x2
0099b7b8 : ADD ESI,0x2
0099b7bb : MOV word ptr [EDI + 0x8],AX
0099b7bf : JZ 0x0099ba0a
0099b7c5 : CMP EBX,0x2
0099b7c8 : JC 0x0099ba0a
0099b7ce : MOVZX EAX,word ptr [ESI]
0099b7d1 : TEST AX,AX
0099b7d4 : JL 0x0099ba0a
0099b7da : CWDE
0099b7db : LEA ECX,[EAX + 0x2]
0099b7de : CMP EBX,ECX
0099b7e0 : JL 0x0099ba0a
0099b7e6 : MOV ECX,0xfffffffe
0099b7eb : LEA EDX,[ESI + 0x2]
0099b7ee : SUB ECX,EAX
0099b7f0 : ADD EBX,ECX
0099b7f2 : MOV dword ptr [EBP + 0xfffffde8],EDX
0099b7f8 : LEA ESI,[ESI + EAX*0x1 + 0x2]
0099b7fc : TEST EDX,EDX
0099b7fe : JZ 0x0099ba0a
0099b804 : MOV EAX,EDX
0099b806 : LEA ECX,[EAX + 0x2]
0099b809 : MOV dword ptr [EBP + 0xfffffde4],ECX
0099b80f : NOP
0099b810 : MOV CX,word ptr [EAX]
0099b813 : ADD EAX,0x2
0099b816 : TEST CX,CX
0099b819 : JNZ 0x0099b810
0099b81b : SUB EAX,dword ptr [EBP + 0xfffffde4]
0099b821 : LEA ECX,[EDI + 0x28]
0099b824 : SAR EAX,0x1
0099b826 : PUSH EAX
0099b827 : PUSH EDX
0099b828 : CALL 0x00406360
0099b82d : TEST ESI,ESI
0099b82f : JZ 0x0099b86d
0099b831 : CMP EBX,0x2
0099b834 : JC 0x0099b86d
0099b836 : MOV DX,word ptr [ESI]
0099b839 : SUB EBX,0x2
0099b83c : ADD ESI,0x2
0099b83f : MOV word ptr [EDI + 0xc],DX
0099b843 : JZ 0x0099b86d
0099b845 : CMP EBX,0x1
0099b848 : JC 0x0099b86d
0099b84a : MOV AL,byte ptr [ESI]
0099b84c : DEC EBX
0099b84d : ADD ESI,0x1
0099b850 : MOV byte ptr [EDI + 0x18],AL
0099b853 : JZ 0x0099b86d
0099b855 : CMP EBX,0x8
0099b858 : JC 0x0099b86d
0099b85a : MOV ECX,dword ptr [ESI]
0099b85c : MOV dword ptr [EDI + 0x20],ECX
0099b85f : MOV EDX,dword ptr [ESI + 0x4]
0099b862 : SUB EBX,0x8
0099b865 : MOV dword ptr [EDI + 0x24],EDX
0099b868 : ADD ESI,0x8
0099b86b : JMP 0x0099b871
0099b86d : XOR EBX,EBX
0099b86f : XOR ESI,ESI
0099b871 : CMP dword ptr [EDI + 0xc],0xffff
0099b878 : JNZ 0x0099b911
0099b87e : FLD double ptr [EDI + 0x20]
0099b881 : LEA EAX,[EBP + 0xfffffdbc]
0099b887 : PUSH EAX
0099b888 : SUB ESP,0x8
0099b88b : FSTP double ptr [ESP]
0099b88e : CALL dword ptr [0x00b853d4]
0099b894 : XOR ECX,ECX
0099b896 : PUSH 0x1fe
0099b89b : PUSH ECX
0099b89c : LEA EDX,[EBP + 0xfffffdee]
0099b8a2 : PUSH EDX
0099b8a3 : MOV word ptr [EBP + 0xfffffdec],CX
0099b8aa : CALL 0x0063b700
0099b8af : MOVZX EAX,word ptr [EBP + 0xfffffdc6]
0099b8b6 : MOVZX ECX,word ptr [EBP + 0xfffffdc4]
0099b8bd : MOVZX EDX,word ptr [EBP + 0xfffffdc2]
0099b8c4 : ADD ESP,0xc
0099b8c7 : PUSH EAX
0099b8c8 : MOVZX EAX,word ptr [EBP + 0xfffffdbe]
0099b8cf : PUSH ECX
0099b8d0 : PUSH EDX
0099b8d1 : PUSH EAX
0099b8d2 : PUSH 0xc87b30
0099b8d7 : LEA EDX,[EBP + 0xfffffdec]
0099b8dd : CALL 0x004214d0
0099b8e2 : LEA EAX,[EBP + 0xfffffdec]
0099b8e8 : ADD ESP,0x14
0099b8eb : LEA EDX,[EAX + 0x2]
0099b8ee : MOV EDI,EDI
0099b8f0 : MOV CX,word ptr [EAX]
0099b8f3 : ADD EAX,0x2
0099b8f6 : TEST CX,CX
0099b8f9 : JNZ 0x0099b8f0
0099b8fb : SUB EAX,EDX
0099b8fd : SAR EAX,0x1
0099b8ff : PUSH EAX
0099b900 : LEA ECX,[EBP + 0xfffffdec]
0099b906 : PUSH ECX
0099b907 : LEA ECX,[EDI + 0x44]
0099b90a : CALL 0x00406360
0099b90f : JMP 0x0099b918
0099b911 : MOV dword ptr [EDI + 0x14],0x1
0099b918 : TEST ESI,ESI
0099b91a : JZ 0x0099b92a
0099b91c : CMP EBX,0x1
0099b91f : JC 0x0099b92a
0099b921 : MOV DL,byte ptr [ESI]
0099b923 : DEC EBX
0099b924 : MOV byte ptr [EDI + 0x60],DL
0099b927 : INC ESI
0099b928 : JMP 0x0099b92e
0099b92a : XOR EBX,EBX
0099b92c : XOR ESI,ESI
0099b92e : MOV AL,byte ptr [EDI + 0x60]
0099b931 : CMP AL,0xa
0099b933 : JC 0x0099b95f
0099b935 : MOV ECX,dword ptr [0x00da9894]
0099b93b : SUB AL,0xa
0099b93d : MOV byte ptr [EDI + 0x60],AL
0099b940 : MOV EAX,dword ptr [EBP + 0xfffffde8]
0099b946 : MOV EDX,dword ptr [ECX]
0099b948 : PUSH EAX
0099b949 : MOV EAX,dword ptr [EDX + 0x1a8]
0099b94f : PUSH 0x1
0099b951 : PUSH EAX
0099b952 : MOV ECX,0xc87b48
0099b957 : CALL 0x009adfc0
0099b95c : ADD ESP,0xc
0099b95f : CMP dword ptr [EDI + 0xc],0xfffd
0099b966 : JNZ 0x0099b991
0099b968 : MOV ECX,dword ptr [EBP + 0xfffffde8]
0099b96e : MOV EDX,dword ptr [0x00da9894]
0099b974 : MOV EAX,dword ptr [EDX]
0099b976 : PUSH ECX
0099b977 : MOV ECX,dword ptr [EAX + 0x1a8]
0099b97d : PUSH 0x1
0099b97f : PUSH ECX
0099b980 : MOV ECX,0xc87b70
0099b985 : CALL 0x009adfc0
0099b98a : ADD ESP,0xc
0099b98d : MOV byte ptr [EDI + 0x61],0x1
0099b991 : MOV EDX,dword ptr [EDI]
0099b993 : MOV EAX,dword ptr [EBP + 0xfffffde0]
0099b999 : MOV ECX,dword ptr [EAX]
0099b99b : MOV dword ptr [EBP + 0xfffffde8],EDX
0099b9a1 : LEA EDX,[EBP + 0xfffffde8]
0099b9a7 : PUSH EDX
0099b9a8 : LEA EAX,[EBP + 0xfffffdd4]
0099b9ae : CALL 0x004437f0
0099b9b3 : MOV EDX,dword ptr [EBP + 0xfffffde0]
0099b9b9 : MOV ECX,dword ptr [EBP + 0xfffffdd4]
0099b9bf : MOV EAX,dword ptr [EDX]
0099b9c1 : CMP ECX,dword ptr [EAX + 0x4]
0099b9c4 : JNZ 0x0099b9eb
0099b9c6 : MOV ECX,dword ptr [EBP + 0xfffffde8]
0099b9cc : LEA EDX,[EBP + 0xfffffdcc]
0099b9d2 : MOV dword ptr [EBP + 0xfffffdcc],ECX
0099b9d8 : PUSH EDX
0099b9d9 : LEA ECX,[EBP + 0xfffffdb4]
0099b9df : PUSH ECX
0099b9e0 : MOV dword ptr [EBP + 0xfffffdd0],EDI
0099b9e6 : CALL 0x00451e00
0099b9eb : MOV EDX,dword ptr [EBP + 0xfffffddc]
0099b9f1 : MOV EAX,dword ptr [EBP + 0xfffffdd8]
0099b9f7 : MOVZX ECX,word ptr [EDX + 0x4]
0099b9fb : INC EAX
0099b9fc : CMP EAX,ECX
0099b9fe : MOV dword ptr [EBP + 0xfffffdd8],EAX
0099ba04 : JL 0x0099b70a
0099ba0a : MOV EDI,dword ptr [EBP + 0xfffffde0]
0099ba10 : XOR ECX,ECX
0099ba12 : CALL 0x0099aee0
0099ba17 : MOV ECX,dword ptr [EBP + -0xc]
0099ba1a : MOV dword ptr FS:[0x0],ECX
0099ba21 : POP ECX
0099ba22 : POP EDI
0099ba23 : POP ESI
0099ba24 : POP EBX
0099ba25 : MOV ECX,dword ptr [EBP + -0x14]
0099ba28 : XOR ECX,EBP
0099ba2a : CALL 0x00633e6b
0099ba2f : MOV ESP,EBP
0099ba31 : POP EBP
0099ba32 : RET 0x4
