PROGRAM  : Maestia.exe
FUNCTION : FUN_005b39b0
ENTRY    : 005b39b0
BODY     : [[005b39b0, 005b3ab2]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005b39b0(int param_1)

{
  GRefCountImpl *this;
  undefined4 uVar1;
  LONG LVar2;
  uint unaff_EDI;
  undefined1 auStack_58 [4];
  undefined **ppuStack_54;
  undefined4 uStack_40;
  uint uStack_10;
  uint uStack_8;
  uint local_4;
  
  local_4 = DAT_00d66fa0 ^ (uint)auStack_58;
  this = (GRefCountImpl *)(**(code **)(*(int *)(param_1 + 8) + 0xc))();
  if (this == (GRefCountImpl *)0x0) {
    FUN_005f7d20();
    __security_check_cookie(uStack_8 ^ (uint)&stack0xffffffa4);
    return;
  }
  GRefCountImpl::Release(this);
  if (*(int *)(this + 0xc) == 0) {
    uVar1 = FUN_005f7d20();
    FUN_005ae060(uVar1);
    FUN_005ae280();
    (**(code **)(*(int *)this + 8))("random",uStack_40);
    ppuStack_54 = &PTR_LAB_00b85ff8;
    FUN_005ad950();
  }
  else {
    FUN_0051b6e0();
    (**(code **)(*(int *)this + 4))("random",&stack0xffffffa4);
    _strtoul((char *)((unaff_EDI & 0xfffffffc) + 8),(char **)0x0,10);
    LVar2 = InterlockedExchangeAdd((LONG *)((unaff_EDI & 0xfffffffc) + 4),-1);
    if (LVar2 == 1) {
      FUN_00515cf0(unaff_EDI & 0xfffffffc);
      __security_check_cookie(uStack_10 ^ (uint)&stack0xffffff9c);
      return;
    }
  }
  __security_check_cookie(uStack_10 ^ (uint)&stack0xffffff9c);
  return;
}



============================================================
DISASSEMBLY
============================================================
005b39b0 : SUB ESP,0x58
005b39b3 : MOV EAX,[0x00d66fa0]
005b39b8 : XOR EAX,ESP
005b39ba : MOV dword ptr [ESP + 0x54],EAX
005b39be : MOV EAX,dword ptr [ESP + 0x5c]
005b39c2 : LEA ECX,[EAX + 0x8]
005b39c5 : MOV EAX,dword ptr [ECX]
005b39c7 : MOV EDX,dword ptr [EAX + 0xc]
005b39ca : PUSH ESI
005b39cb : PUSH 0x24
005b39cd : CALL EDX
005b39cf : MOV ESI,EAX
005b39d1 : TEST ESI,ESI
005b39d3 : JZ 0x005b3a9e
005b39d9 : PUSH EDI
005b39da : MOV ECX,ESI
005b39dc : CALL 0x004ff7e0
005b39e1 : CMP dword ptr [ESI + 0xc],0x0
005b39e5 : JNZ 0x005b3a38
005b39e7 : CALL 0x005f7d20
005b39ec : MOV EDI,EAX
005b39ee : PUSH EDI
005b39ef : LEA ECX,[ESP + 0x10]
005b39f3 : CALL 0x005ae060
005b39f8 : LEA ECX,[ESP + 0xc]
005b39fc : CALL 0x005ae280
005b3a01 : MOV ECX,dword ptr [ESP + 0x24]
005b3a05 : MOV EAX,dword ptr [ESI]
005b3a07 : MOV EDX,dword ptr [EAX + 0x8]
005b3a0a : PUSH ECX
005b3a0b : PUSH 0xb8feb4
005b3a10 : MOV ECX,ESI
005b3a12 : CALL EDX
005b3a14 : LEA ECX,[ESP + 0xc]
005b3a18 : MOV dword ptr [ESP + 0x18],0xb85ff8
005b3a20 : CALL 0x005ad950
005b3a25 : MOV EAX,EDI
005b3a27 : POP EDI
005b3a28 : POP ESI
005b3a29 : MOV ECX,dword ptr [ESP + 0x54]
005b3a2d : XOR ECX,ESP
005b3a2f : CALL 0x00633e6b
005b3a34 : ADD ESP,0x58
005b3a37 : RET
005b3a38 : LEA ECX,[ESP + 0x8]
005b3a3c : CALL 0x0051b6e0
005b3a41 : MOV EAX,dword ptr [ESI]
005b3a43 : MOV EDX,dword ptr [EAX + 0x4]
005b3a46 : LEA ECX,[ESP + 0x8]
005b3a4a : PUSH ECX
005b3a4b : PUSH 0xb8feb4
005b3a50 : MOV ECX,ESI
005b3a52 : CALL EDX
005b3a54 : MOV EAX,dword ptr [ESP + 0x8]
005b3a58 : AND EAX,0xfffffffc
005b3a5b : PUSH 0xa
005b3a5d : ADD EAX,0x8
005b3a60 : PUSH 0x0
005b3a62 : PUSH EAX
005b3a63 : CALL 0x00638df2
005b3a68 : MOV ESI,dword ptr [ESP + 0x14]
005b3a6c : ADD ESP,0xc
005b3a6f : MOV EDI,EAX
005b3a71 : AND ESI,0xfffffffc
005b3a74 : PUSH -0x1
005b3a76 : LEA EAX,[ESI + 0x4]
005b3a79 : PUSH EAX
005b3a7a : CALL dword ptr [0x00b851cc]
005b3a80 : SUB EAX,0x1
005b3a83 : JNZ 0x005b3a25
005b3a85 : PUSH ESI
005b3a86 : CALL 0x00515cf0
005b3a8b : MOV EAX,EDI
005b3a8d : POP EDI
005b3a8e : POP ESI
005b3a8f : MOV ECX,dword ptr [ESP + 0x54]
005b3a93 : XOR ECX,ESP
005b3a95 : CALL 0x00633e6b
005b3a9a : ADD ESP,0x58
005b3a9d : RET
005b3a9e : CALL 0x005f7d20
005b3aa3 : MOV ECX,dword ptr [ESP + 0x58]
005b3aa7 : POP ESI
005b3aa8 : XOR ECX,ESP
005b3aaa : CALL 0x00633e6b
005b3aaf : ADD ESP,0x58
005b3ab2 : RET
