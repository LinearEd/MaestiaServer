PROGRAM  : Maestia.exe
FUNCTION : FUN_006874e0
ENTRY    : 006874e0
BODY     : [[006874e0, 0068756c] [00687570, 00687752]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006874e0(int *param_1)

{
  short *psVar1;
  int *piVar2;
  int iVar3;
  int iVar4;
  int *piVar5;
  int iVar6;
  int iVar7;
  int *piVar8;
  short *psVar9;
  int *piVar10;
  int iVar11;
  int *local_38;
  int local_34;
  int *local_30;
  int *local_2c;
  int local_28;
  int *local_24;
  int *local_20;
  int local_18 [6];
  
  local_34 = 0x8000;
  local_28 = 0x8000;
  local_2c = (int *)0xffff8000;
  local_24 = (int *)0x0;
  local_30 = (int *)0x0;
  if ((param_1 == (int *)0x0) || (*(short *)((int)param_1 + 2) < 1)) {
    return 0;
  }
  piVar10 = (int *)((int)param_1 + 4);
  psVar9 = *(short **)((int)param_1 + 0xc);
  psVar1 = psVar9 + *(short *)param_1;
  piVar8 = (int *)*piVar10;
  if (psVar9 < psVar1) {
    do {
      piVar2 = (int *)*piVar10 + *psVar9 * 2;
      iVar6 = 0x8000;
      iVar7 = -0x8000;
      param_1 = (int *)0xffff8000;
      iVar11 = 0x8000;
      piVar5 = piVar8;
      if (piVar8 + 4 <= piVar2) {
        for (; piVar5 <= piVar2; piVar5 = piVar5 + 2) {
          iVar3 = *piVar5;
          if (iVar3 < iVar6) {
            iVar6 = iVar3;
          }
          if ((int)param_1 < iVar3) {
            param_1 = (int *)iVar3;
          }
          iVar3 = piVar5[1];
          if (iVar3 < iVar11) {
            iVar11 = iVar3;
          }
          if (iVar7 < iVar3) {
            iVar7 = iVar3;
          }
        }
        if (((iVar6 < local_34) && ((int *)iVar6 != param_1)) && (iVar11 != iVar7)) {
          local_34 = iVar6;
          local_30 = piVar2;
          local_2c = (int *)iVar7;
          local_28 = iVar11;
          local_24 = piVar8;
        }
      }
      psVar9 = psVar9 + 1;
      piVar8 = piVar2 + 2;
    } while (psVar9 < psVar1);
    if (local_34 != 0x8000) {
      local_18[0] = (int)local_2c + local_28 * 3 >> 2;
      iVar6 = 0;
      local_18[1] = (int)local_2c + local_28 >> 1;
      local_18[2] = local_28 + (int)local_2c * 3 >> 2;
      local_34 = 0;
LAB_00687611:
      do {
        iVar7 = 0x8000;
        local_28 = -0x8000;
        param_1 = (int *)0x0;
        local_2c = (int *)0x0;
        local_20 = (int *)0x0;
        local_38 = (int *)0x0;
        piVar10 = local_30;
        for (piVar8 = local_24; piVar8 <= local_30; piVar8 = piVar8 + 2) {
          iVar11 = *(int *)((int)local_18 + iVar6);
          iVar3 = piVar8[1];
          if ((iVar3 == iVar11) || (iVar4 = piVar10[1], iVar4 == iVar11)) {
            *(int *)((int)local_18 + iVar6) = *(int *)((int)local_18 + iVar6) + 1;
            goto LAB_00687611;
          }
          if (((iVar11 <= iVar3) || (iVar11 <= iVar4)) && ((iVar3 <= iVar11 || (iVar4 <= iVar11))))
          {
            iVar6 = *piVar10;
            iVar11 = FUN_00685d60(*piVar8 - iVar6,iVar11 - iVar4,iVar3 - iVar4);
            iVar11 = iVar11 + iVar6;
            if (iVar11 < iVar7) {
              iVar7 = iVar11;
              local_38 = piVar10;
              local_20 = piVar8;
            }
            iVar6 = local_34;
            if (local_28 < iVar11) {
              param_1 = piVar8;
              local_2c = piVar10;
              local_28 = iVar11;
            }
          }
          piVar10 = piVar8;
        }
        if ((local_38 != (int *)0x0) && (local_2c != (int *)0x0)) {
          if ((local_38[1] < local_20[1]) && (param_1[1] < local_2c[1])) {
            *(undefined4 *)((int)local_18 + iVar6 + 0xc) = 0;
          }
          else if ((local_20[1] < local_38[1]) && (local_2c[1] < param_1[1])) {
            *(undefined4 *)((int)local_18 + iVar6 + 0xc) = 1;
          }
          else {
            *(undefined4 *)((int)local_18 + iVar6 + 0xc) = 2;
          }
        }
        iVar6 = iVar6 + 4;
        local_34 = iVar6;
      } while (iVar6 < 0xc);
      if (local_18[3] != 2) {
        if (local_18[3] == local_18[4]) {
          return local_18[3];
        }
        if (local_18[3] == local_18[5]) {
          return local_18[3];
        }
      }
      if ((local_18[4] != 2) && (local_18[4] == local_18[5])) {
        return local_18[4];
      }
    }
  }
  return 0;
}



============================================================
DISASSEMBLY
============================================================
006874e0 : SUB ESP,0x38
006874e3 : MOV EAX,0x8000
006874e8 : XOR ECX,ECX
006874ea : MOV dword ptr [ESP + 0x4],EAX
006874ee : MOV dword ptr [ESP + 0x10],EAX
006874f2 : MOV EAX,dword ptr [ESP + 0x3c]
006874f6 : MOV dword ptr [ESP + 0xc],0xffff8000
006874fe : MOV dword ptr [ESP + 0x14],ECX
00687502 : MOV dword ptr [ESP + 0x8],ECX
00687506 : CMP EAX,ECX
00687508 : JZ 0x0068774d
0068750e : CMP word ptr [EAX + 0x2],CX
00687512 : JLE 0x0068774d
00687518 : MOV ECX,dword ptr [EAX + 0x4]
0068751b : PUSH EBX
0068751c : PUSH EBP
0068751d : PUSH ESI
0068751e : MOV ESI,dword ptr [EAX + 0xc]
00687521 : MOVSX EAX,word ptr [EAX]
00687524 : LEA EAX,[ESI + EAX*0x2]
00687527 : PUSH EDI
00687528 : MOV dword ptr [ESP + 0x28],ECX
0068752c : MOV EBP,ECX
0068752e : MOV dword ptr [ESP + 0x10],ESI
00687532 : MOV dword ptr [ESP + 0x2c],EAX
00687536 : CMP ESI,EAX
00687538 : JC 0x00687548
0068753a : XOR EAX,EAX
0068753c : POP EDI
0068753d : POP ESI
0068753e : POP EBP
0068753f : POP EBX
00687540 : ADD ESP,0x38
00687543 : RET
00687544 : MOV ECX,dword ptr [ESP + 0x28]
00687548 : MOVSX EAX,word ptr [ESI]
0068754b : LEA ECX,[ECX + EAX*0x8]
0068754e : LEA EAX,[EBP + 0x10]
00687551 : MOV EDX,0x8000
00687556 : MOV EBX,0xffff8000
0068755b : MOV dword ptr [ESP + 0x4c],EBX
0068755f : MOV EDI,EDX
00687561 : CMP ECX,EAX
00687563 : JC 0x006875c0
00687565 : MOV ESI,EBP
00687567 : CMP EBP,ECX
00687569 : JA 0x00687598
0068756b : JMP 0x00687570
00687570 : MOV EAX,dword ptr [ESI]
00687572 : CMP EAX,EDX
00687574 : JGE 0x00687578
00687576 : MOV EDX,EAX
00687578 : CMP EAX,dword ptr [ESP + 0x4c]
0068757c : JLE 0x00687582
0068757e : MOV dword ptr [ESP + 0x4c],EAX
00687582 : MOV EAX,dword ptr [ESI + 0x4]
00687585 : CMP EAX,EDI
00687587 : JGE 0x0068758b
00687589 : MOV EDI,EAX
0068758b : CMP EAX,EBX
0068758d : JLE 0x00687591
0068758f : MOV EBX,EAX
00687591 : ADD ESI,0x8
00687594 : CMP ESI,ECX
00687596 : JBE 0x00687570
00687598 : CMP EDX,dword ptr [ESP + 0x14]
0068759c : JGE 0x006875bc
0068759e : CMP EDX,dword ptr [ESP + 0x4c]
006875a2 : JZ 0x006875bc
006875a4 : CMP EDI,EBX
006875a6 : JZ 0x006875bc
006875a8 : MOV dword ptr [ESP + 0x14],EDX
006875ac : MOV dword ptr [ESP + 0x20],EDI
006875b0 : MOV dword ptr [ESP + 0x1c],EBX
006875b4 : MOV dword ptr [ESP + 0x24],EBP
006875b8 : MOV dword ptr [ESP + 0x18],ECX
006875bc : MOV ESI,dword ptr [ESP + 0x10]
006875c0 : ADD ESI,0x2
006875c3 : MOV dword ptr [ESP + 0x10],ESI
006875c7 : LEA EBP,[ECX + 0x8]
006875ca : CMP ESI,dword ptr [ESP + 0x2c]
006875ce : JC 0x00687544
006875d4 : CMP dword ptr [ESP + 0x14],0x8000
006875dc : JZ 0x0068753a
006875e2 : MOV ECX,dword ptr [ESP + 0x1c]
006875e6 : MOV EAX,dword ptr [ESP + 0x20]
006875ea : LEA EDX,[ECX + EAX*0x2]
006875ed : ADD EDX,EAX
006875ef : SAR EDX,0x2
006875f2 : MOV dword ptr [ESP + 0x30],EDX
006875f6 : LEA EDX,[ECX + EAX*0x1]
006875f9 : LEA EAX,[EAX + ECX*0x2]
006875fc : ADD EAX,ECX
006875fe : SAR EDX,0x1
00687600 : SAR EAX,0x2
00687603 : XOR EBX,EBX
00687605 : MOV dword ptr [ESP + 0x34],EDX
00687609 : MOV dword ptr [ESP + 0x38],EAX
0068760d : MOV dword ptr [ESP + 0x14],EBX
00687611 : MOV ESI,dword ptr [ESP + 0x18]
00687615 : MOV EDI,dword ptr [ESP + 0x24]
00687619 : XOR EDX,EDX
0068761b : MOV EBP,0x8000
00687620 : MOV dword ptr [ESP + 0x20],0xffff8000
00687628 : MOV dword ptr [ESP + 0x4c],EDX
0068762c : MOV dword ptr [ESP + 0x1c],EDX
00687630 : MOV dword ptr [ESP + 0x28],EDX
00687634 : MOV dword ptr [ESP + 0x10],EDX
00687638 : CMP EDI,dword ptr [ESP + 0x18]
0068763c : JA 0x006876af
0068763e : MOV EAX,dword ptr [ESP + EBX*0x1 + 0x30]
00687642 : MOV ECX,dword ptr [EDI + 0x4]
00687645 : CMP ECX,EAX
00687647 : JZ 0x006876a6
00687649 : MOV EDX,dword ptr [ESI + 0x4]
0068764c : CMP EDX,EAX
0068764e : JZ 0x006876a6
00687650 : CMP ECX,EAX
00687652 : JGE 0x0068765a
00687654 : CMP EDX,EAX
00687656 : JL 0x0068769b
00687658 : CMP ECX,EAX
0068765a : JLE 0x00687660
0068765c : CMP EDX,EAX
0068765e : JG 0x0068769b
00687660 : MOV EBX,dword ptr [ESI]
00687662 : SUB ECX,EDX
00687664 : PUSH ECX
00687665 : MOV ECX,dword ptr [EDI]
00687667 : SUB EAX,EDX
00687669 : PUSH EAX
0068766a : SUB ECX,EBX
0068766c : PUSH ECX
0068766d : CALL 0x00685d60
00687672 : ADD EAX,EBX
00687674 : ADD ESP,0xc
00687677 : CMP EAX,EBP
00687679 : JGE 0x00687685
0068767b : MOV EBP,EAX
0068767d : MOV dword ptr [ESP + 0x10],ESI
00687681 : MOV dword ptr [ESP + 0x28],EDI
00687685 : CMP EAX,dword ptr [ESP + 0x20]
00687689 : MOV EBX,dword ptr [ESP + 0x14]
0068768d : JLE 0x0068769b
0068768f : MOV dword ptr [ESP + 0x20],EAX
00687693 : MOV dword ptr [ESP + 0x1c],ESI
00687697 : MOV dword ptr [ESP + 0x4c],EDI
0068769b : MOV EDX,dword ptr [ESP + 0x1c]
0068769f : MOV ESI,EDI
006876a1 : ADD EDI,0x8
006876a4 : JMP 0x00687638
006876a6 : INC dword ptr [ESP + EBX*0x1 + 0x30]
006876aa : JMP 0x00687611
006876af : MOV ECX,dword ptr [ESP + 0x10]
006876b3 : TEST ECX,ECX
006876b5 : JZ 0x00687701
006876b7 : TEST EDX,EDX
006876b9 : JZ 0x00687701
006876bb : MOV EAX,dword ptr [ESP + 0x28]
006876bf : MOV EAX,dword ptr [EAX + 0x4]
006876c2 : MOV ECX,dword ptr [ECX + 0x4]
006876c5 : CMP ECX,EAX
006876c7 : JGE 0x006876e1
006876c9 : MOV ESI,dword ptr [EDX + 0x4]
006876cc : MOV EDI,dword ptr [ESP + 0x4c]
006876d0 : CMP ESI,dword ptr [EDI + 0x4]
006876d3 : JLE 0x006876df
006876d5 : MOV dword ptr [ESP + EBX*0x1 + 0x3c],0x0
006876dd : JMP 0x00687701
006876df : CMP ECX,EAX
006876e1 : JLE 0x006876f9
006876e3 : MOV ECX,dword ptr [EDX + 0x4]
006876e6 : MOV EDX,dword ptr [ESP + 0x4c]
006876ea : CMP ECX,dword ptr [EDX + 0x4]
006876ed : JGE 0x006876f9
006876ef : MOV dword ptr [ESP + EBX*0x1 + 0x3c],0x1
006876f7 : JMP 0x00687701
006876f9 : MOV dword ptr [ESP + EBX*0x1 + 0x3c],0x2
00687701 : ADD EBX,0x4
00687704 : CMP EBX,0xc
00687707 : MOV dword ptr [ESP + 0x14],EBX
0068770b : JL 0x00687611
00687711 : MOV EAX,dword ptr [ESP + 0x3c]
00687715 : MOV EDX,dword ptr [ESP + 0x44]
00687719 : MOV ECX,dword ptr [ESP + 0x40]
0068771d : CMP EAX,0x2
00687720 : JZ 0x00687732
00687722 : CMP EAX,ECX
00687724 : JZ 0x0068753c
0068772a : CMP EAX,EDX
0068772c : JZ 0x0068753c
00687732 : CMP ECX,0x2
00687735 : JZ 0x0068753a
0068773b : CMP ECX,EDX
0068773d : JNZ 0x0068753a
00687743 : POP EDI
00687744 : POP ESI
00687745 : POP EBP
00687746 : MOV EAX,ECX
00687748 : POP EBX
00687749 : ADD ESP,0x38
0068774c : RET
0068774d : XOR EAX,EAX
0068774f : ADD ESP,0x38
00687752 : RET
