PROGRAM  : Maestia.exe
FUNCTION : __fptostr
ENTRY    : 0065fad1
BODY     : [[0065fad1, 0065fb8f]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    __fptostr
   
   Library: Visual Studio 2008 Release */

errno_t __cdecl __fptostr(char *_Buf,size_t _SizeInBytes,int _Digits,STRFLT _PtFlt)

{
  int *piVar1;
  int iVar2;
  char *pcVar3;
  size_t sVar4;
  char cVar5;
  char *pcVar6;
  errno_t eVar7;
  
  pcVar6 = _PtFlt->mantissa;
  if ((_Buf == (char *)0x0) || (_SizeInBytes == 0)) {
    piVar1 = __errno();
    eVar7 = 0x16;
    *piVar1 = 0x16;
  }
  else {
    *_Buf = '\0';
    iVar2 = _Digits;
    if (_Digits < 1) {
      iVar2 = 0;
    }
    if (iVar2 + 1U < _SizeInBytes) {
      *_Buf = '0';
      pcVar3 = _Buf;
      for (; pcVar3 = pcVar3 + 1, 0 < _Digits; _Digits = _Digits + -1) {
        cVar5 = *pcVar6;
        if (cVar5 == '\0') {
          cVar5 = '0';
        }
        else {
          pcVar6 = pcVar6 + 1;
        }
        *pcVar3 = cVar5;
      }
      *pcVar3 = '\0';
      if ((-1 < _Digits) && ('4' < *pcVar6)) {
        while (pcVar3 = pcVar3 + -1, *pcVar3 == '9') {
          *pcVar3 = '0';
        }
        *pcVar3 = *pcVar3 + '\x01';
      }
      if (*_Buf == '1') {
        _PtFlt->decpt = _PtFlt->decpt + 1;
      }
      else {
        sVar4 = _strlen(_Buf + 1);
        _memmove(_Buf,_Buf + 1,sVar4 + 1);
      }
      return 0;
    }
    piVar1 = __errno();
    eVar7 = 0x22;
    *piVar1 = 0x22;
  }
  __invalid_parameter(0,0,0,0,0);
  return eVar7;
}



============================================================
DISASSEMBLY
============================================================
0065fad1 : MOV EDI,EDI
0065fad3 : PUSH EBP
0065fad4 : MOV EBP,ESP
0065fad6 : MOV ECX,dword ptr [EBP + 0x14]
0065fad9 : PUSH EBX
0065fada : PUSH ESI
0065fadb : MOV ESI,dword ptr [EBP + 0x8]
0065fade : XOR EBX,EBX
0065fae0 : PUSH EDI
0065fae1 : MOV EDI,dword ptr [ECX + 0xc]
0065fae4 : CMP ESI,EBX
0065fae6 : JNZ 0x0065fb06
0065fae8 : CALL 0x0063ab82
0065faed : PUSH 0x16
0065faef : POP ESI
0065faf0 : MOV dword ptr [EAX],ESI
0065faf2 : PUSH EBX
0065faf3 : PUSH EBX
0065faf4 : PUSH EBX
0065faf5 : PUSH EBX
0065faf6 : PUSH EBX
0065faf7 : CALL 0x006372b8
0065fafc : ADD ESP,0x14
0065faff : MOV EAX,ESI
0065fb01 : JMP 0x0065fb8b
0065fb06 : CMP dword ptr [EBP + 0xc],EBX
0065fb09 : JBE 0x0065fae8
0065fb0b : MOV EDX,dword ptr [EBP + 0x10]
0065fb0e : CMP EDX,EBX
0065fb10 : MOV byte ptr [ESI],BL
0065fb12 : JLE 0x0065fb18
0065fb14 : MOV EAX,EDX
0065fb16 : JMP 0x0065fb1a
0065fb18 : XOR EAX,EAX
0065fb1a : INC EAX
0065fb1b : CMP dword ptr [EBP + 0xc],EAX
0065fb1e : JA 0x0065fb2e
0065fb20 : CALL 0x0063ab82
0065fb25 : PUSH 0x22
0065fb27 : POP ECX
0065fb28 : MOV dword ptr [EAX],ECX
0065fb2a : MOV ESI,ECX
0065fb2c : JMP 0x0065faf2
0065fb2e : CMP EDX,EBX
0065fb30 : MOV byte ptr [ESI],0x30
0065fb33 : LEA EAX,[ESI + 0x1]
0065fb36 : JLE 0x0065fb52
0065fb38 : MOV CL,byte ptr [EDI]
0065fb3a : CMP CL,BL
0065fb3c : JZ 0x0065fb44
0065fb3e : MOVSX ECX,CL
0065fb41 : INC EDI
0065fb42 : JMP 0x0065fb47
0065fb44 : PUSH 0x30
0065fb46 : POP ECX
0065fb47 : MOV byte ptr [EAX],CL
0065fb49 : INC EAX
0065fb4a : DEC EDX
0065fb4b : CMP EDX,EBX
0065fb4d : JG 0x0065fb38
0065fb4f : MOV ECX,dword ptr [EBP + 0x14]
0065fb52 : CMP EDX,EBX
0065fb54 : MOV byte ptr [EAX],BL
0065fb56 : JL 0x0065fb6a
0065fb58 : CMP byte ptr [EDI],0x35
0065fb5b : JL 0x0065fb6a
0065fb5d : JMP 0x0065fb62
0065fb5f : MOV byte ptr [EAX],0x30
0065fb62 : DEC EAX
0065fb63 : CMP byte ptr [EAX],0x39
0065fb66 : JZ 0x0065fb5f
0065fb68 : INC byte ptr [EAX]
0065fb6a : CMP byte ptr [ESI],0x31
0065fb6d : JNZ 0x0065fb74
0065fb6f : INC dword ptr [ECX + 0x4]
0065fb72 : JMP 0x0065fb89
0065fb74 : LEA EDI,[ESI + 0x1]
0065fb77 : PUSH EDI
0065fb78 : CALL 0x00640960
0065fb7d : INC EAX
0065fb7e : PUSH EAX
0065fb7f : PUSH EDI
0065fb80 : PUSH ESI
0065fb81 : CALL 0x00636880
0065fb86 : ADD ESP,0x10
0065fb89 : XOR EAX,EAX
0065fb8b : POP EDI
0065fb8c : POP ESI
0065fb8d : POP EBX
0065fb8e : POP EBP
0065fb8f : RET
