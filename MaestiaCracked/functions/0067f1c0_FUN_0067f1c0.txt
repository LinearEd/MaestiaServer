PROGRAM  : Maestia.exe
FUNCTION : FUN_0067f1c0
ENTRY    : 0067f1c0
BODY     : [[0067f1c0, 0067f3bc] [0067f3c0, 0067f50d]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0067f1c0(DWORD param_1)

{
  DWORD DVar1;
  uint uVar2;
  HIMC pHVar3;
  DWORD DVar4;
  LPCANDIDATELIST lpCandList;
  int iVar5;
  uint *puVar6;
  LONG LVar7;
  int iVar8;
  GRefCountNTSImpl *this;
  int in_ECX;
  DWORD DVar9;
  int iVar10;
  int local_28;
  uint local_1c;
  uint local_18;
  DWORD local_14;
  undefined4 local_10;
  uint local_c;
  undefined4 local_8;
  
  local_10 = 0;
  local_c = 0;
  pHVar3 = ImmGetContext(*(HWND *)(in_ECX + 0x14));
  DVar4 = ImmGetCandidateListW(pHVar3,param_1,(LPCANDIDATELIST)0x0,0);
  if (DVar4 == 0) goto LAB_0067f4e5;
  lpCandList = (LPCANDIDATELIST)FUN_00515840(DVar4 * 0x1c,0);
  ImmGetCandidateListW(pHVar3,param_1,lpCandList,DVar4);
  *(DWORD *)(in_ECX + 0x78) = lpCandList->dwCount;
  DVar4 = lpCandList->dwSelection;
  *(DWORD *)(in_ECX + 0x40) = lpCandList->dwPageStart;
  DVar9 = lpCandList->dwPageSize;
  *(DWORD *)(in_ECX + 0x80) = DVar9;
  local_14 = DVar4;
  ImmReleaseContext(*(HWND *)(in_ECX + 0x14),pHVar3);
  DVar1 = *(DWORD *)(in_ECX + 0x78);
  if (DVar1 == 0) {
    FUN_00515cf0(lpCandList);
    goto LAB_0067f4e5;
  }
  if ((*(uint *)(in_ECX + 0x5c) & 0xf00) != 0) {
    *(DWORD *)(in_ECX + 0x40) = DVar4 - (int)DVar4 % *(int *)(in_ECX + 0x80);
  }
  iVar5 = *(int *)(in_ECX + 0x5c);
  param_1 = DVar1;
  if (iVar5 == 0x410000) {
    DVar9 = 5;
    param_1 = 5;
    if ((int)DVar1 < 6) {
      param_1 = DVar1;
    }
  }
  else if (iVar5 == 0x40000) {
    iVar5 = *(int *)(in_ECX + 0x40);
joined_r0x0067f2e6:
    param_1 = DVar1 - iVar5;
    if ((int)DVar9 < (int)(DVar1 - iVar5)) {
      param_1 = DVar9;
    }
  }
  else if (iVar5 == 0x60000) {
    param_1 = DVar9;
    if ((int)(DVar1 - DVar4) <= (int)DVar9) {
      param_1 = DVar1 - DVar4;
    }
    *(DWORD *)(in_ECX + 0x40) = DVar4;
  }
  else if ((iVar5 != 0xd00001) && ((int)DVar9 <= (int)DVar1)) {
    iVar5 = *(int *)(in_ECX + 0x40);
    goto joined_r0x0067f2e6;
  }
  *(DWORD *)(in_ECX + 0x3c) = param_1;
  iVar5 = FUN_0051b1a0();
  if (iVar5 != 0) {
    puVar6 = (uint *)FUN_0051c6e0(&local_1c,".RemoveList");
    FUN_00678eb0(*(undefined4 *)(in_ECX + 4),(*puVar6 & 0xfffffffc) + 8,&DAT_00cca874);
    LVar7 = InterlockedExchangeAdd((LONG *)((local_1c & 0xfffffffc) + 4),-1);
    if (LVar7 == 1) {
      FUN_00515cf0(local_1c & 0xfffffffc);
    }
    puVar6 = (uint *)FUN_0051c6e0(&local_18,".CreateList");
    FUN_00678eb0(*(undefined4 *)(in_ECX + 4),(*puVar6 & 0xfffffffc) + 8,"%d %d",DVar9,
                 *(undefined4 *)(in_ECX + 0x54c));
    LVar7 = InterlockedExchangeAdd((LONG *)((local_18 & 0xfffffffc) + 4),-1);
    if (LVar7 == 1) {
      FUN_00515cf0(local_18 & 0xfffffffc);
    }
  }
  FUN_00684a80();
  local_28 = 0;
  if (0 < (int)param_1) {
    do {
      iVar10 = (int)lpCandList->dwOffset +
               (lpCandList->dwOffset[*(int *)(in_ECX + 0x40) + local_28] - 0x18);
      iVar5 = FUN_0051aeb0(iVar10,0xffffffff);
      iVar8 = FUN_00515840(iVar5 + 1,0);
      FUN_0051af70(iVar8,iVar10,0xffffffff);
      *(undefined1 *)(iVar5 + iVar8) = 0;
      this = (GRefCountNTSImpl *)FUN_00515840(0x10,0);
      if (this == (GRefCountNTSImpl *)0x0) {
        this = (GRefCountNTSImpl *)0x0;
      }
      else {
        *(undefined ***)this = &PTR_FUN_00cd3f2c;
        *(undefined4 *)(this + 4) = 1;
        *(undefined ***)this = &PTR_FUN_00bd7fa4;
        FUN_0051b6e0();
        FUN_0051bb20(iVar8);
      }
      if (this != (GRefCountNTSImpl *)0x0) {
        *(int *)(this + 4) = *(int *)(this + 4) + 1;
      }
      FUN_00684a30(this,0);
      FUN_00515cf0(iVar8);
      if (this != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release(this);
      }
      local_28 = local_28 + 1;
    } while (local_28 < (int)param_1);
  }
  FUN_00515cf0(lpCandList);
  ImmReleaseContext(*(HWND *)(in_ECX + 0x14),pHVar3);
  uVar2 = *(uint *)(in_ECX + 0x5c);
  if (((((uVar2 == 2) || (uVar2 == 4)) || ((uVar2 & 0xf00) != 0)) ||
      ((uVar2 == 0x40000 || (uVar2 == 0x70000)))) ||
     ((uVar2 == 0x110000 || ((uVar2 == 0x210000 || (uVar2 == 0x410000)))))) {
    iVar5 = (int)local_14 % *(int *)(in_ECX + 0x80);
  }
  else {
    iVar5 = -1;
  }
  FUN_006847b0(iVar5);
  FUN_00684870();
  *(undefined1 *)(in_ECX + 0x560) = 1;
LAB_0067f4e5:
  if ((local_c >> 6 & 1) != 0) {
    FUN_00588b40(&local_10,local_8);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
0067f1c0 : SUB ESP,0x28
0067f1c3 : PUSH EBX
0067f1c4 : PUSH EBP
0067f1c5 : PUSH ESI
0067f1c6 : MOV ESI,ECX
0067f1c8 : MOV EAX,dword ptr [ESI + 0x14]
0067f1cb : PUSH EDI
0067f1cc : XOR EBX,EBX
0067f1ce : PUSH EAX
0067f1cf : MOV dword ptr [ESP + 0x2c],EBX
0067f1d3 : MOV dword ptr [ESP + 0x30],EBX
0067f1d7 : CALL 0x00611450
0067f1dc : MOV ECX,dword ptr [ESP + 0x3c]
0067f1e0 : PUSH EBX
0067f1e1 : PUSH EBX
0067f1e2 : MOV EBP,EAX
0067f1e4 : PUSH ECX
0067f1e5 : PUSH EBP
0067f1e6 : MOV dword ptr [ESP + 0x28],EBP
0067f1ea : CALL 0x00685b90
0067f1ef : MOV EDI,EAX
0067f1f1 : CMP EDI,EBX
0067f1f3 : JZ 0x0067f4e5
0067f1f9 : MOV ECX,dword ptr [0x00d73250]
0067f1ff : LEA EDX,[EDI*0x8 + 0x0]
0067f206 : SUB EDX,EDI
0067f208 : ADD EDX,EDX
0067f20a : PUSH EBX
0067f20b : ADD EDX,EDX
0067f20d : PUSH EDX
0067f20e : CALL 0x00515840
0067f213 : MOV EBX,EAX
0067f215 : MOV EAX,dword ptr [ESP + 0x3c]
0067f219 : PUSH EDI
0067f21a : PUSH EBX
0067f21b : PUSH EAX
0067f21c : PUSH EBP
0067f21d : MOV dword ptr [ESP + 0x24],EBX
0067f221 : CALL 0x00685b90
0067f226 : MOV ECX,dword ptr [EBX + 0x8]
0067f229 : MOV EAX,dword ptr [ESP + 0x18]
0067f22d : MOV dword ptr [ESI + 0x78],ECX
0067f230 : MOV EDI,dword ptr [EBX + 0xc]
0067f233 : MOV EDX,dword ptr [EBX + 0x10]
0067f236 : MOV ECX,dword ptr [ESI + 0x14]
0067f239 : MOV dword ptr [ESI + 0x40],EDX
0067f23c : MOV EBP,dword ptr [EBX + 0x14]
0067f23f : PUSH EAX
0067f240 : PUSH ECX
0067f241 : MOV dword ptr [ESP + 0x2c],EDI
0067f245 : MOV dword ptr [ESI + 0x80],EBP
0067f24b : CALL 0x00611462
0067f250 : MOV ECX,dword ptr [ESI + 0x78]
0067f253 : TEST ECX,ECX
0067f255 : JNZ 0x0067f262
0067f257 : PUSH EBX
0067f258 : CALL 0x00515cf0
0067f25d : JMP 0x0067f4e5
0067f262 : TEST dword ptr [ESI + 0x5c],0xf00
0067f269 : JZ 0x0067f27b
0067f26b : MOV EAX,EDI
0067f26d : CDQ
0067f26e : IDIV dword ptr [ESI + 0x80]
0067f274 : MOV EAX,EDI
0067f276 : SUB EAX,EDX
0067f278 : MOV dword ptr [ESI + 0x40],EAX
0067f27b : MOV EAX,dword ptr [ESI + 0x5c]
0067f27e : CMP EAX,0x410000
0067f283 : JNZ 0x0067f298
0067f285 : MOV EBP,0x5
0067f28a : CMP ECX,EBP
0067f28c : MOV dword ptr [ESP + 0x3c],EBP
0067f290 : JG 0x0067f2ec
0067f292 : MOV dword ptr [ESP + 0x3c],ECX
0067f296 : JMP 0x0067f2ec
0067f298 : CMP EAX,0x40000
0067f29d : JNZ 0x0067f2ac
0067f29f : SUB ECX,dword ptr [ESI + 0x40]
0067f2a2 : CMP EBP,ECX
0067f2a4 : JL 0x0067f2e8
0067f2a6 : MOV dword ptr [ESP + 0x3c],ECX
0067f2aa : JMP 0x0067f2ec
0067f2ac : CMP EAX,0x60000
0067f2b1 : JNZ 0x0067f2c6
0067f2b3 : SUB ECX,EDI
0067f2b5 : CMP EBP,ECX
0067f2b7 : MOV dword ptr [ESP + 0x3c],EBP
0067f2bb : JL 0x0067f2c1
0067f2bd : MOV dword ptr [ESP + 0x3c],ECX
0067f2c1 : MOV dword ptr [ESI + 0x40],EDI
0067f2c4 : JMP 0x0067f2ec
0067f2c6 : CMP EAX,0xd00001
0067f2cb : JNZ 0x0067f2d3
0067f2cd : MOV dword ptr [ESP + 0x3c],ECX
0067f2d1 : JMP 0x0067f2ec
0067f2d3 : CMP ECX,EBP
0067f2d5 : JGE 0x0067f2dd
0067f2d7 : MOV dword ptr [ESP + 0x3c],ECX
0067f2db : JMP 0x0067f2ec
0067f2dd : SUB ECX,dword ptr [ESI + 0x40]
0067f2e0 : CMP ECX,EBP
0067f2e2 : MOV dword ptr [ESP + 0x3c],ECX
0067f2e6 : JLE 0x0067f2ec
0067f2e8 : MOV dword ptr [ESP + 0x3c],EBP
0067f2ec : MOV ECX,dword ptr [ESP + 0x3c]
0067f2f0 : MOV dword ptr [ESI + 0x3c],ECX
0067f2f3 : LEA EDI,[ESI + 0x8]
0067f2f6 : MOV ECX,EDI
0067f2f8 : CALL 0x0051b1a0
0067f2fd : TEST EAX,EAX
0067f2ff : JBE 0x0067f3a0
0067f305 : PUSH 0xbd7f7c
0067f30a : LEA EDX,[ESP + 0x20]
0067f30e : PUSH EDX
0067f30f : MOV ECX,EDI
0067f311 : CALL 0x0051c6e0
0067f316 : MOV EAX,dword ptr [EAX]
0067f318 : AND EAX,0xfffffffc
0067f31b : ADD EAX,0x8
0067f31e : PUSH 0xcca874
0067f323 : PUSH EAX
0067f324 : MOV EAX,dword ptr [ESI + 0x4]
0067f327 : PUSH EAX
0067f328 : CALL 0x00678eb0
0067f32d : MOV EDI,dword ptr [ESP + 0x28]
0067f331 : ADD ESP,0xc
0067f334 : AND EDI,0xfffffffc
0067f337 : PUSH -0x1
0067f339 : LEA ECX,[EDI + 0x4]
0067f33c : PUSH ECX
0067f33d : CALL dword ptr [0x00b851cc]
0067f343 : ADD EAX,-0x1
0067f346 : JNZ 0x0067f34e
0067f348 : PUSH EDI
0067f349 : CALL 0x00515cf0
0067f34e : PUSH 0xbd7fcc
0067f353 : LEA EDX,[ESP + 0x24]
0067f357 : PUSH EDX
0067f358 : LEA ECX,[ESI + 0x8]
0067f35b : CALL 0x0051c6e0
0067f360 : MOV ECX,dword ptr [ESI + 0x54c]
0067f366 : MOV EAX,dword ptr [EAX]
0067f368 : MOV EDX,dword ptr [ESI + 0x4]
0067f36b : PUSH ECX
0067f36c : PUSH EBP
0067f36d : AND EAX,0xfffffffc
0067f370 : PUSH 0xbd6554
0067f375 : ADD EAX,0x8
0067f378 : PUSH EAX
0067f379 : PUSH EDX
0067f37a : CALL 0x00678eb0
0067f37f : MOV EDI,dword ptr [ESP + 0x34]
0067f383 : ADD ESP,0x14
0067f386 : AND EDI,0xfffffffc
0067f389 : PUSH -0x1
0067f38b : LEA EAX,[EDI + 0x4]
0067f38e : PUSH EAX
0067f38f : CALL dword ptr [0x00b851cc]
0067f395 : ADD EAX,-0x1
0067f398 : JNZ 0x0067f3a0
0067f39a : PUSH EDI
0067f39b : CALL 0x00515cf0
0067f3a0 : MOV ECX,dword ptr [ESI + 0x18]
0067f3a3 : CALL 0x00684a80
0067f3a8 : CMP dword ptr [ESP + 0x3c],0x0
0067f3ad : MOV dword ptr [ESP + 0x10],0x0
0067f3b5 : JLE 0x0067f473
0067f3bb : JMP 0x0067f3c0
0067f3c0 : MOV ECX,dword ptr [ESI + 0x40]
0067f3c3 : ADD ECX,dword ptr [ESP + 0x10]
0067f3c7 : PUSH -0x1
0067f3c9 : MOV EDI,dword ptr [EBX + ECX*0x4 + 0x18]
0067f3cd : ADD EDI,EBX
0067f3cf : PUSH EDI
0067f3d0 : CALL 0x0051aeb0
0067f3d5 : MOV ECX,dword ptr [0x00d73250]
0067f3db : MOV EBX,EAX
0067f3dd : PUSH 0x0
0067f3df : LEA EDX,[EBX + 0x1]
0067f3e2 : PUSH EDX
0067f3e3 : CALL 0x00515840
0067f3e8 : PUSH -0x1
0067f3ea : MOV EBP,EAX
0067f3ec : PUSH EDI
0067f3ed : PUSH EBP
0067f3ee : CALL 0x0051af70
0067f3f3 : PUSH 0x0
0067f3f5 : MOV byte ptr [EBX + EBP*0x1],0x0
0067f3f9 : MOV ECX,dword ptr [0x00d73250]
0067f3ff : PUSH 0x10
0067f401 : CALL 0x00515840
0067f406 : MOV EDI,EAX
0067f408 : TEST EDI,EDI
0067f40a : JZ 0x0067f433
0067f40c : MOV dword ptr [EDI],0xcd3f2c
0067f412 : LEA EBX,[EDI + 0xc]
0067f415 : MOV ECX,EBX
0067f417 : MOV dword ptr [EDI + 0x4],0x1
0067f41e : MOV dword ptr [EDI],0xbd7fa4
0067f424 : CALL 0x0051b6e0
0067f429 : PUSH EBP
0067f42a : MOV ECX,EBX
0067f42c : CALL 0x0051bb20
0067f431 : JMP 0x0067f435
0067f433 : XOR EDI,EDI
0067f435 : PUSH 0x0
0067f437 : PUSH ECX
0067f438 : MOV EAX,ESP
0067f43a : TEST EDI,EDI
0067f43c : JZ 0x0067f441
0067f43e : INC dword ptr [EDI + 0x4]
0067f441 : MOV dword ptr [EAX],EDI
0067f443 : MOV ECX,dword ptr [ESI + 0x18]
0067f446 : CALL 0x00684a30
0067f44b : PUSH EBP
0067f44c : CALL 0x00515cf0
0067f451 : TEST EDI,EDI
0067f453 : JZ 0x0067f45c
0067f455 : MOV ECX,EDI
0067f457 : CALL 0x004ff7c0
0067f45c : MOV EAX,dword ptr [ESP + 0x10]
0067f460 : MOV EBX,dword ptr [ESP + 0x14]
0067f464 : INC EAX
0067f465 : CMP EAX,dword ptr [ESP + 0x3c]
0067f469 : MOV dword ptr [ESP + 0x10],EAX
0067f46d : JL 0x0067f3c0
0067f473 : PUSH EBX
0067f474 : CALL 0x00515cf0
0067f479 : MOV EAX,dword ptr [ESP + 0x18]
0067f47d : MOV ECX,dword ptr [ESI + 0x14]
0067f480 : PUSH EAX
0067f481 : PUSH ECX
0067f482 : CALL 0x00611462
0067f487 : MOV EAX,dword ptr [ESI + 0x5c]
0067f48a : CMP EAX,0x2
0067f48d : JZ 0x0067f4c2
0067f48f : CMP EAX,0x4
0067f492 : JZ 0x0067f4c2
0067f494 : TEST EAX,0xf00
0067f499 : JNZ 0x0067f4c2
0067f49b : CMP EAX,0x40000
0067f4a0 : JZ 0x0067f4c2
0067f4a2 : CMP EAX,0x70000
0067f4a7 : JZ 0x0067f4c2
0067f4a9 : CMP EAX,0x110000
0067f4ae : JZ 0x0067f4c2
0067f4b0 : CMP EAX,0x210000
0067f4b5 : JZ 0x0067f4c2
0067f4b7 : CMP EAX,0x410000
0067f4bc : JZ 0x0067f4c2
0067f4be : PUSH -0x1
0067f4c0 : JMP 0x0067f4ce
0067f4c2 : MOV EAX,dword ptr [ESP + 0x24]
0067f4c6 : CDQ
0067f4c7 : IDIV dword ptr [ESI + 0x80]
0067f4cd : PUSH EDX
0067f4ce : MOV ECX,dword ptr [ESI + 0x18]
0067f4d1 : CALL 0x006847b0
0067f4d6 : MOV ECX,dword ptr [ESI + 0x18]
0067f4d9 : CALL 0x00684870
0067f4de : MOV byte ptr [ESI + 0x560],0x1
0067f4e5 : MOV EDX,dword ptr [ESP + 0x2c]
0067f4e9 : SHR EDX,0x6
0067f4ec : TEST DL,0x1
0067f4ef : JZ 0x0067f504
0067f4f1 : MOV EAX,dword ptr [ESP + 0x30]
0067f4f5 : PUSH EAX
0067f4f6 : LEA ECX,[ESP + 0x2c]
0067f4fa : PUSH ECX
0067f4fb : MOV ECX,dword ptr [ESP + 0x30]
0067f4ff : CALL 0x00588b40
0067f504 : POP EDI
0067f505 : POP ESI
0067f506 : POP EBP
0067f507 : POP EBX
0067f508 : ADD ESP,0x28
0067f50b : RET 0x4
