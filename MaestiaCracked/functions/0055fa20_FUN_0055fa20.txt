PROGRAM  : Maestia.exe
FUNCTION : FUN_0055fa20
ENTRY    : 0055fa20
BODY     : [[0055fa20, 0055fa6c] [0055fa70, 0055fb4f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0055fa20(int param_1,uint param_2)

{
  int *piVar1;
  uint uVar2;
  int iVar3;
  int iVar4;
  int in_ECX;
  
  if (param_2 == 0xffffffff) {
    param_2 = FUN_0051c9d0(param_1);
  }
  if ((*(ushort *)(in_ECX + 0x2a) >> 0xb & 1) != 0) {
    uVar2 = FUN_0051b1a0();
    if (uVar2 == param_2) {
      uVar2 = 0;
      if (param_2 != 0) {
        do {
          iVar3 = FUN_0051cb70((short)*(char *)((*(uint *)(in_ECX + 8) & 0xfffffffc) + 8 + uVar2));
          iVar4 = FUN_0051cb70(*(undefined2 *)(param_1 + uVar2 * 2));
          if (iVar3 != iVar4) {
            piVar1 = *(int **)(in_ECX + 0x1c);
            if ((piVar1 != (int *)0x0) && (*piVar1 = *piVar1 + -1, *piVar1 == 0)) {
              FUN_00500860();
              FUN_00515cf0(piVar1);
            }
            *(undefined4 *)(in_ECX + 0x1c) = 0;
            *(ushort *)(in_ECX + 0x2a) = *(ushort *)(in_ECX + 0x2a) & 0xf7ff;
            break;
          }
          uVar2 = uVar2 + 1;
        } while (uVar2 < param_2);
      }
    }
    else {
      piVar1 = *(int **)(in_ECX + 0x1c);
      if ((piVar1 != (int *)0x0) && (*piVar1 = *piVar1 + -1, *piVar1 == 0)) {
        FUN_00500860();
        FUN_00515cf0(piVar1);
      }
      *(undefined4 *)(in_ECX + 0x1c) = 0;
      *(ushort *)(in_ECX + 0x2a) = *(ushort *)(in_ECX + 0x2a) & 0xf7ff;
    }
  }
  FUN_0051bf30();
  FUN_0051b8a0(param_1,param_2);
  *(ushort *)(in_ECX + 0x2a) = *(ushort *)(in_ECX + 0x2a) | 4;
  iVar3 = FUN_00638800((*(uint *)(in_ECX + 8) & 0xfffffffc) + 8,0x2c);
  if (iVar3 != 0) {
    *(ushort *)(in_ECX + 0x2a) = *(ushort *)(in_ECX + 0x2a) & 0xefff;
    return;
  }
  *(ushort *)(in_ECX + 0x2a) = *(ushort *)(in_ECX + 0x2a) | 0x1000;
  return;
}



============================================================
DISASSEMBLY
============================================================
0055fa20 : PUSH EBP
0055fa21 : MOV EBP,dword ptr [ESP + 0xc]
0055fa25 : PUSH ESI
0055fa26 : PUSH EDI
0055fa27 : MOV ESI,ECX
0055fa29 : CMP EBP,-0x1
0055fa2c : JNZ 0x0055fa41
0055fa2e : MOV EAX,dword ptr [ESP + 0x10]
0055fa32 : PUSH EAX
0055fa33 : CALL 0x0051c9d0
0055fa38 : MOV EBP,EAX
0055fa3a : ADD ESP,0x4
0055fa3d : MOV dword ptr [ESP + 0x14],EBP
0055fa41 : MOV CX,word ptr [ESI + 0x2a]
0055fa45 : SHR CX,0xb
0055fa49 : TEST CL,0x1
0055fa4c : JZ 0x0055faff
0055fa52 : PUSH EBX
0055fa53 : LEA EBX,[ESI + 0x8]
0055fa56 : MOV ECX,EBX
0055fa58 : CALL 0x0051b1a0
0055fa5d : CMP EAX,EBP
0055fa5f : JNZ 0x0055fad5
0055fa61 : XOR EDI,EDI
0055fa63 : TEST EBP,EBP
0055fa65 : JBE 0x0055fafe
0055fa6b : JMP 0x0055fa70
0055fa70 : MOV EAX,dword ptr [EBX]
0055fa72 : AND EAX,0xfffffffc
0055fa75 : MOVSX DX,byte ptr [EAX + EDI*0x1 + 0x8]
0055fa7b : MOVZX EAX,DX
0055fa7e : PUSH EAX
0055fa7f : CALL 0x0051cb70
0055fa84 : MOV ECX,dword ptr [ESP + 0x18]
0055fa88 : MOVZX EDX,word ptr [ECX + EDI*0x2]
0055fa8c : PUSH EDX
0055fa8d : MOV EBP,EAX
0055fa8f : CALL 0x0051cb70
0055fa94 : ADD ESP,0x8
0055fa97 : CMP EBP,EAX
0055fa99 : JNZ 0x0055faa6
0055fa9b : MOV EBP,dword ptr [ESP + 0x18]
0055fa9f : INC EDI
0055faa0 : CMP EDI,EBP
0055faa2 : JC 0x0055fa70
0055faa4 : JMP 0x0055fafe
0055faa6 : MOV EDI,dword ptr [ESI + 0x1c]
0055faa9 : TEST EDI,EDI
0055faab : JZ 0x0055fabf
0055faad : ADD dword ptr [EDI],-0x1
0055fab0 : JNZ 0x0055fabf
0055fab2 : MOV ECX,EDI
0055fab4 : CALL 0x00500860
0055fab9 : PUSH EDI
0055faba : CALL 0x00515cf0
0055fabf : MOV EBP,dword ptr [ESP + 0x18]
0055fac3 : MOV EAX,0xf7ff
0055fac8 : MOV dword ptr [ESI + 0x1c],0x0
0055facf : AND word ptr [ESI + 0x2a],AX
0055fad3 : JMP 0x0055fafe
0055fad5 : MOV EDI,dword ptr [ESI + 0x1c]
0055fad8 : TEST EDI,EDI
0055fada : JZ 0x0055faee
0055fadc : ADD dword ptr [EDI],-0x1
0055fadf : JNZ 0x0055faee
0055fae1 : MOV ECX,EDI
0055fae3 : CALL 0x00500860
0055fae8 : PUSH EDI
0055fae9 : CALL 0x00515cf0
0055faee : MOV ECX,0xf7ff
0055faf3 : MOV dword ptr [ESI + 0x1c],0x0
0055fafa : AND word ptr [ESI + 0x2a],CX
0055fafe : POP EBX
0055faff : LEA EDI,[ESI + 0x8]
0055fb02 : MOV ECX,EDI
0055fb04 : CALL 0x0051bf30
0055fb09 : MOV EDX,dword ptr [ESP + 0x10]
0055fb0d : PUSH EBP
0055fb0e : PUSH EDX
0055fb0f : MOV ECX,EDI
0055fb11 : CALL 0x0051b8a0
0055fb16 : MOV EDI,dword ptr [EDI]
0055fb18 : OR word ptr [ESI + 0x2a],0x4
0055fb1d : AND EDI,0xfffffffc
0055fb20 : PUSH 0x2c
0055fb22 : ADD EDI,0x8
0055fb25 : PUSH EDI
0055fb26 : CALL 0x00638800
0055fb2b : ADD ESP,0x8
0055fb2e : TEST EAX,EAX
0055fb30 : JNZ 0x0055fb41
0055fb32 : MOV EAX,0x1000
0055fb37 : OR word ptr [ESI + 0x2a],AX
0055fb3b : POP EDI
0055fb3c : POP ESI
0055fb3d : POP EBP
0055fb3e : RET 0x8
0055fb41 : MOV ECX,0xefff
0055fb46 : AND word ptr [ESI + 0x2a],CX
0055fb4a : POP EDI
0055fb4b : POP ESI
0055fb4c : POP EBP
0055fb4d : RET 0x8
