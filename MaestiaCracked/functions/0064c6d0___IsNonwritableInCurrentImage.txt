PROGRAM  : Maestia.exe
FUNCTION : __IsNonwritableInCurrentImage
ENTRY    : 0064c6d0
BODY     : [[0064c6d0, 0064c75a] [0064c772, 0064c78c]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    __IsNonwritableInCurrentImage
   
   Library: Visual Studio 2008 Release */

BOOL __cdecl __IsNonwritableInCurrentImage(PBYTE pTarget)

{
  BOOL BVar1;
  PIMAGE_SECTION_HEADER p_Var2;
  void *local_14;
  code *pcStack_10;
  uint local_c;
  undefined4 local_8;
  
  pcStack_10 = __except_handler4;
  local_14 = ExceptionList;
  local_c = DAT_00d66fa0 ^ 0xced158;
  ExceptionList = &local_14;
  local_8 = 0;
  BVar1 = __ValidateImageBase((PBYTE)&IMAGE_DOS_HEADER_00400000);
  if (BVar1 != 0) {
    p_Var2 = __FindPESection((PBYTE)&IMAGE_DOS_HEADER_00400000,(DWORD_PTR)(pTarget + -0x400000));
    if (p_Var2 != (PIMAGE_SECTION_HEADER)0x0) {
      ExceptionList = local_14;
      return ~(p_Var2->Characteristics >> 0x1f) & 1;
    }
  }
  ExceptionList = local_14;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
0064c6d0 : MOV EDI,EDI
0064c6d2 : PUSH EBP
0064c6d3 : MOV EBP,ESP
0064c6d5 : PUSH -0x2
0064c6d7 : PUSH 0xced158
0064c6dc : PUSH 0x64c290
0064c6e1 : MOV EAX,FS:[0x0]
0064c6e7 : PUSH EAX
0064c6e8 : SUB ESP,0x8
0064c6eb : PUSH EBX
0064c6ec : PUSH ESI
0064c6ed : PUSH EDI
0064c6ee : MOV EAX,[0x00d66fa0]
0064c6f3 : XOR dword ptr [EBP + -0x8],EAX
0064c6f6 : XOR EAX,EBP
0064c6f8 : PUSH EAX
0064c6f9 : LEA EAX,[EBP + -0x10]
0064c6fc : MOV FS:[0x0],EAX
0064c702 : MOV dword ptr [EBP + -0x18],ESP
0064c705 : MOV dword ptr [EBP + -0x4],0x0
0064c70c : PUSH 0x400000
0064c711 : CALL 0x0064c640
0064c716 : ADD ESP,0x4
0064c719 : TEST EAX,EAX
0064c71b : JZ 0x0064c772
0064c71d : MOV EAX,dword ptr [EBP + 0x8]
0064c720 : SUB EAX,0x400000
0064c725 : PUSH EAX
0064c726 : PUSH 0x400000
0064c72b : CALL 0x0064c680
0064c730 : ADD ESP,0x8
0064c733 : TEST EAX,EAX
0064c735 : JZ 0x0064c772
0064c737 : MOV EAX,dword ptr [EAX + 0x24]
0064c73a : SHR EAX,0x1f
0064c73d : NOT EAX
0064c73f : AND EAX,0x1
0064c742 : MOV dword ptr [EBP + -0x4],0xfffffffe
0064c749 : MOV ECX,dword ptr [EBP + -0x10]
0064c74c : MOV dword ptr FS:[0x0],ECX
0064c753 : POP ECX
0064c754 : POP EDI
0064c755 : POP ESI
0064c756 : POP EBX
0064c757 : MOV ESP,EBP
0064c759 : POP EBP
0064c75a : RET
0064c772 : MOV dword ptr [EBP + -0x4],0xfffffffe
0064c779 : XOR EAX,EAX
0064c77b : MOV ECX,dword ptr [EBP + -0x10]
0064c77e : MOV dword ptr FS:[0x0],ECX
0064c785 : POP ECX
0064c786 : POP EDI
0064c787 : POP ESI
0064c788 : POP EBX
0064c789 : MOV ESP,EBP
0064c78b : POP EBP
0064c78c : RET
