PROGRAM  : Maestia.exe
FUNCTION : FUN_004858e0
ENTRY    : 004858e0
BODY     : [[004858e0, 00485c09]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Removing unreachable block (ram,0x00485b97) */
/* WARNING: Removing unreachable block (ram,0x00485bb1) */
/* WARNING: Removing unreachable block (ram,0x00485b66) */
/* WARNING: Removing unreachable block (ram,0x00485bb3) */

void FUN_004858e0(int param_1)

{
  int *piVar1;
  uint uVar2;
  uint uVar3;
  int *piVar4;
  DWORD DVar5;
  int iVar6;
  int *piVar7;
  uint uVar8;
  int iVar9;
  bool bVar10;
  wchar_t *pwVar11;
  undefined1 local_44 [4];
  int local_40;
  int local_3c;
  undefined4 local_38;
  undefined1 local_34 [4];
  int *local_30;
  int *local_2c;
  int local_28;
  int local_24;
  int *local_20;
  int local_1c;
  char local_15;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b7f648;
  local_10 = ExceptionList;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if (*(uint *)(param_1 + 0x4c) < 3) {
    FUN_008018d0(L"Find Path Error m_WayPoints size 2 under !!!!!!!!!!!!");
    ExceptionList = local_10;
    return;
  }
  piVar7 = (int *)0x0;
  local_2c = (int *)0x0;
  local_30 = (int *)0x0;
  local_28 = 0;
  local_40 = 0;
  local_3c = 0;
  local_38 = 0;
  local_8 = 2;
  piVar1 = *(int **)(param_1 + 0x30);
  local_20 = (int *)(param_1 + 0x30);
  for (uVar8 = *(uint *)(param_1 + 0x48);
      (piVar1 != (int *)*local_20 || (uVar8 != local_20[7] + local_20[6])); uVar8 = uVar8 + 1) {
    if (piVar1 == (int *)0x0) {
      iVar6 = 0;
    }
    else {
      iVar6 = *piVar1;
    }
    uVar3 = uVar8;
    if (*(uint *)(iVar6 + 0x14) <= uVar8) {
      if (piVar1 == (int *)0x0) {
        iVar6 = 0;
      }
      else {
        iVar6 = *piVar1;
      }
      uVar3 = uVar8 - *(int *)(iVar6 + 0x14);
    }
    if (piVar1 == (int *)0x0) {
      iVar6 = 0;
    }
    else {
      iVar6 = *piVar1;
    }
    FUN_00406db0(*(undefined4 *)(*(int *)(iVar6 + 0x10) + uVar3 * 4));
  }
  FUN_00476f00(uVar2);
  iVar6 = (local_3c - local_40) / 0xc + -1;
  local_15 = '\0';
  local_1c = iVar6;
  FUN_00406db0(local_40);
  if (0 < iVar6) {
    iVar9 = 0;
    do {
      iVar6 = FUN_00485d00(param_1,local_44,iVar9,iVar6);
      piVar1 = local_30;
      bVar10 = true;
      local_24 = iVar6;
      if (iVar6 == -1) {
        piVar4 = local_30;
        if (local_30 == piVar7) {
LAB_00485ab1:
          FUN_00406db0(local_40 + (iVar9 * 3 + 3) * 4);
          local_24 = iVar9 + 1;
          if (piVar1 == (int *)0x0) {
            uVar2 = 0;
          }
          else {
            uVar2 = local_28 - (int)piVar1 >> 2;
          }
          if ((uint)((int)piVar7 - (int)piVar1 >> 2) < uVar2) {
            *piVar7 = local_24;
            local_2c = piVar7 + 1;
            piVar7 = local_2c;
          }
          else {
            FUN_00408c10(local_34,piVar7,1,&local_24);
            piVar7 = local_2c;
          }
        }
        else {
          do {
            if (*piVar4 == iVar9) {
              bVar10 = false;
            }
            piVar4 = piVar4 + 1;
          } while (piVar4 != piVar7);
          if (bVar10) goto LAB_00485ab1;
        }
        bVar10 = iVar9 == local_1c;
      }
      else {
        piVar4 = local_30;
        if (local_30 == piVar7) {
LAB_00485a35:
          FUN_00406db0(local_40 + iVar6 * 0xc);
          if (piVar1 == (int *)0x0) {
            uVar2 = 0;
          }
          else {
            uVar2 = local_28 - (int)piVar1 >> 2;
          }
          if ((uint)((int)piVar7 - (int)piVar1 >> 2) < uVar2) {
            *piVar7 = iVar6;
            piVar7 = piVar7 + 1;
            bVar10 = iVar6 == local_1c;
            iVar9 = iVar6 + -1;
            local_2c = piVar7;
            goto LAB_00485b05;
          }
          FUN_00408c10(local_34,piVar7,1,&local_24);
          piVar7 = local_2c;
        }
        else {
          do {
            if (*piVar4 == iVar6) {
              bVar10 = false;
            }
            piVar4 = piVar4 + 1;
          } while (piVar4 != piVar7);
          if (bVar10) goto LAB_00485a35;
        }
        bVar10 = iVar6 == local_1c;
        iVar9 = iVar6 + -1;
      }
LAB_00485b05:
      if (bVar10) {
        local_15 = '\x01';
      }
      iVar9 = iVar9 + 1;
      if (*(char *)(param_1 + 0x2eee9) != '\0') {
        pwVar11 = L"====== Path Find Force Abort ======";
LAB_00485b4b:
        FUN_008018d0(pwVar11);
        goto LAB_00485bb8;
      }
      DVar5 = GetTickCount();
      uVar2 = DVar5 - *(int *)(param_1 + 0x2eecc);
      *(uint *)(param_1 + 0x2eed0) = uVar2;
      if (*(uint *)(param_1 + 0x2eed4) < uVar2) {
        pwVar11 = L"====== Path Find Time Over ======";
        goto LAB_00485b4b;
      }
      iVar6 = local_1c;
    } while (iVar9 < local_1c);
    if (local_15 != '\0') goto LAB_00485b83;
  }
  FUN_00406db0(local_40 + iVar6 * 0xc);
LAB_00485b83:
  FUN_00476f00();
LAB_00485bb8:
  local_8 = (uint)local_8._1_3_ << 8;
  if (local_40 != 0) {
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  local_38 = 0;
  local_3c = 0;
  local_40 = 0;
  local_8 = 0xffffffff;
  if (local_30 != (int *)0x0) {
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
004858e0 : PUSH EBP
004858e1 : MOV EBP,ESP
004858e3 : PUSH -0x1
004858e5 : PUSH 0xb7f648
004858ea : MOV EAX,FS:[0x0]
004858f0 : PUSH EAX
004858f1 : SUB ESP,0x48
004858f4 : PUSH EBX
004858f5 : PUSH ESI
004858f6 : PUSH EDI
004858f7 : MOV EAX,[0x00d66fa0]
004858fc : XOR EAX,EBP
004858fe : PUSH EAX
004858ff : LEA EAX,[EBP + -0xc]
00485902 : MOV FS:[0x0],EAX
00485908 : MOV ECX,dword ptr [EBP + 0x8]
0048590b : MOV EAX,dword ptr [ECX + 0x4c]
0048590e : CMP EAX,0x2
00485911 : JA 0x0048593a
00485913 : MOV ESI,dword ptr [0x00da98e8]
00485919 : PUSH 0xcd7ce8
0048591e : CALL 0x008018d0
00485923 : ADD ESP,0x4
00485926 : MOV ECX,dword ptr [EBP + -0xc]
00485929 : MOV dword ptr FS:[0x0],ECX
00485930 : POP ECX
00485931 : POP EDI
00485932 : POP ESI
00485933 : POP EBX
00485934 : MOV ESP,EBP
00485936 : POP EBP
00485937 : RET 0x4
0048593a : XOR EDX,EDX
0048593c : XOR EBX,EBX
0048593e : MOV dword ptr [EBP + -0x28],EBX
00485941 : MOV dword ptr [EBP + -0x2c],EDX
00485944 : MOV dword ptr [EBP + -0x24],EDX
00485947 : MOV dword ptr [EBP + -0x4],EDX
0048594a : MOV dword ptr [EBP + -0x3c],EDX
0048594d : MOV dword ptr [EBP + -0x38],EDX
00485950 : MOV dword ptr [EBP + -0x34],EDX
00485953 : MOV byte ptr [EBP + -0x4],0x1
00485957 : MOV dword ptr [EBP + -0x4c],EDX
0048595a : MOV dword ptr [EBP + -0x48],EDX
0048595d : MOV dword ptr [EBP + -0x44],EDX
00485960 : MOV byte ptr [EBP + -0x4],0x2
00485964 : MOV EAX,dword ptr [ECX + 0x48]
00485967 : MOV ESI,dword ptr [ECX + 0x30]
0048596a : ADD ECX,0x30
0048596d : MOV dword ptr [EBP + -0x1c],ECX
00485970 : MOV EDI,EAX
00485972 : MOV EAX,dword ptr [ECX + 0x1c]
00485975 : ADD EAX,dword ptr [ECX + 0x18]
00485978 : CMP ESI,dword ptr [ECX]
0048597a : JNZ 0x00485980
0048597c : CMP EDI,EAX
0048597e : JZ 0x004859c1
00485980 : MOV EAX,EDI
00485982 : CMP ESI,EDX
00485984 : JZ 0x0048598a
00485986 : MOV ECX,dword ptr [ESI]
00485988 : JMP 0x0048598c
0048598a : XOR ECX,ECX
0048598c : CMP dword ptr [ECX + 0x14],EDI
0048598f : JA 0x004859a0
00485991 : CMP ESI,EDX
00485993 : JZ 0x00485999
00485995 : MOV ECX,dword ptr [ESI]
00485997 : JMP 0x0048599b
00485999 : XOR ECX,ECX
0048599b : MOV EAX,EDI
0048599d : SUB EAX,dword ptr [ECX + 0x14]
004859a0 : CMP ESI,EDX
004859a2 : JZ 0x004859a8
004859a4 : MOV ECX,dword ptr [ESI]
004859a6 : JMP 0x004859aa
004859a8 : XOR ECX,ECX
004859aa : MOV ECX,dword ptr [ECX + 0x10]
004859ad : MOV EDX,dword ptr [ECX + EAX*0x4]
004859b0 : PUSH EDX
004859b1 : LEA EAX,[EBP + -0x40]
004859b4 : CALL 0x00406db0
004859b9 : MOV ECX,dword ptr [EBP + -0x1c]
004859bc : INC EDI
004859bd : XOR EDX,EDX
004859bf : JMP 0x00485972
004859c1 : MOV ESI,ECX
004859c3 : CALL 0x00476f00
004859c8 : MOV ECX,dword ptr [EBP + -0x38]
004859cb : SUB ECX,dword ptr [EBP + -0x3c]
004859ce : MOV EAX,0x2aaaaaab
004859d3 : IMUL ECX
004859d5 : SAR EDX,0x1
004859d7 : MOV EAX,EDX
004859d9 : SHR EAX,0x1f
004859dc : ADD EAX,EDX
004859de : LEA ESI,[EAX + -0x1]
004859e1 : MOV EAX,dword ptr [EBP + -0x3c]
004859e4 : PUSH EAX
004859e5 : LEA EAX,[EBP + -0x50]
004859e8 : XOR EDI,EDI
004859ea : MOV dword ptr [EBP + -0x18],ESI
004859ed : MOV byte ptr [EBP + -0x11],0x0
004859f1 : CALL 0x00406db0
004859f6 : TEST ESI,ESI
004859f8 : JLE 0x00485b71
004859fe : MOV EDI,EDI
00485a00 : MOV EDX,dword ptr [EBP + 0x8]
00485a03 : PUSH ESI
00485a04 : PUSH EDI
00485a05 : LEA ECX,[EBP + -0x40]
00485a08 : PUSH ECX
00485a09 : PUSH EDX
00485a0a : CALL 0x00485d00
00485a0f : MOV ESI,EAX
00485a11 : MOV dword ptr [EBP + -0x20],ESI
00485a14 : MOV CL,0x1
00485a16 : CMP ESI,-0x1
00485a19 : JZ 0x00485a90
00485a1b : MOV EDI,dword ptr [EBP + -0x2c]
00485a1e : MOV EAX,EDI
00485a20 : CMP EDI,EBX
00485a22 : JZ 0x00485a35
00485a24 : CMP dword ptr [EAX],ESI
00485a26 : JNZ 0x00485a2a
00485a28 : XOR CL,CL
00485a2a : ADD EAX,0x4
00485a2d : CMP EAX,EBX
00485a2f : JNZ 0x00485a24
00485a31 : TEST CL,CL
00485a33 : JZ 0x00485a88
00485a35 : MOV ECX,dword ptr [EBP + -0x3c]
00485a38 : LEA EAX,[ESI + ESI*0x2]
00485a3b : LEA EDX,[ECX + EAX*0x4]
00485a3e : PUSH EDX
00485a3f : LEA EAX,[EBP + -0x50]
00485a42 : CALL 0x00406db0
00485a47 : TEST EDI,EDI
00485a49 : JNZ 0x00485a4f
00485a4b : XOR EAX,EAX
00485a4d : JMP 0x00485a57
00485a4f : MOV EAX,dword ptr [EBP + -0x24]
00485a52 : SUB EAX,EDI
00485a54 : SAR EAX,0x2
00485a57 : MOV ECX,EBX
00485a59 : SUB ECX,EDI
00485a5b : SAR ECX,0x2
00485a5e : CMP ECX,EAX
00485a60 : JNC 0x00485a75
00485a62 : MOV dword ptr [EBX],ESI
00485a64 : ADD EBX,0x4
00485a67 : CMP ESI,dword ptr [EBP + -0x18]
00485a6a : MOV dword ptr [EBP + -0x28],EBX
00485a6d : LEA EDI,[ESI + -0x1]
00485a70 : JMP 0x00485b05
00485a75 : LEA EDX,[EBP + -0x20]
00485a78 : PUSH EDX
00485a79 : PUSH 0x1
00485a7b : PUSH EBX
00485a7c : LEA EAX,[EBP + -0x30]
00485a7f : PUSH EAX
00485a80 : CALL 0x00408c10
00485a85 : MOV EBX,dword ptr [EBP + -0x28]
00485a88 : CMP ESI,dword ptr [EBP + -0x18]
00485a8b : LEA EDI,[ESI + -0x1]
00485a8e : JMP 0x00485b05
00485a90 : MOV ESI,dword ptr [EBP + -0x2c]
00485a93 : MOV EAX,ESI
00485a95 : CMP ESI,EBX
00485a97 : JZ 0x00485ab1
00485a99 : LEA ESP,[ESP]
00485aa0 : CMP dword ptr [EAX],EDI
00485aa2 : JNZ 0x00485aa6
00485aa4 : XOR CL,CL
00485aa6 : ADD EAX,0x4
00485aa9 : CMP EAX,EBX
00485aab : JNZ 0x00485aa0
00485aad : TEST CL,CL
00485aaf : JZ 0x00485b02
00485ab1 : MOV EDX,dword ptr [EBP + -0x3c]
00485ab4 : LEA ECX,[EDI + EDI*0x2 + 0x3]
00485ab8 : LEA EAX,[EDX + ECX*0x4]
00485abb : PUSH EAX
00485abc : LEA EAX,[EBP + -0x50]
00485abf : CALL 0x00406db0
00485ac4 : LEA ECX,[EDI + 0x1]
00485ac7 : MOV dword ptr [EBP + -0x20],ECX
00485aca : TEST ESI,ESI
00485acc : JNZ 0x00485ad2
00485ace : XOR EAX,EAX
00485ad0 : JMP 0x00485ada
00485ad2 : MOV EAX,dword ptr [EBP + -0x24]
00485ad5 : SUB EAX,ESI
00485ad7 : SAR EAX,0x2
00485ada : MOV EDX,EBX
00485adc : SUB EDX,ESI
00485ade : SAR EDX,0x2
00485ae1 : CMP EDX,EAX
00485ae3 : JNC 0x00485aef
00485ae5 : MOV dword ptr [EBX],ECX
00485ae7 : ADD EBX,0x4
00485aea : MOV dword ptr [EBP + -0x28],EBX
00485aed : JMP 0x00485b02
00485aef : LEA EAX,[EBP + -0x20]
00485af2 : PUSH EAX
00485af3 : PUSH 0x1
00485af5 : PUSH EBX
00485af6 : LEA ECX,[EBP + -0x30]
00485af9 : PUSH ECX
00485afa : CALL 0x00408c10
00485aff : MOV EBX,dword ptr [EBP + -0x28]
00485b02 : CMP EDI,dword ptr [EBP + -0x18]
00485b05 : JNZ 0x00485b0b
00485b07 : MOV byte ptr [EBP + -0x11],0x1
00485b0b : MOV ESI,dword ptr [EBP + 0x8]
00485b0e : INC EDI
00485b0f : CMP byte ptr [ESI + 0x2eee9],0x0
00485b16 : JNZ 0x00485b3f
00485b18 : CALL dword ptr [0x00b850d8]
00485b1e : SUB EAX,dword ptr [ESI + 0x2eecc]
00485b24 : MOV dword ptr [ESI + 0x2eed0],EAX
00485b2a : CMP EAX,dword ptr [ESI + 0x2eed4]
00485b30 : JA 0x00485b46
00485b32 : CMP EDI,dword ptr [EBP + -0x18]
00485b35 : JGE 0x00485b68
00485b37 : MOV ESI,dword ptr [EBP + -0x18]
00485b3a : JMP 0x00485a00
00485b3f : PUSH 0xcd7d58
00485b44 : JMP 0x00485b4b
00485b46 : PUSH 0xcd7da0
00485b4b : MOV ESI,dword ptr [0x00da98e8]
00485b51 : CALL 0x008018d0
00485b56 : ADD ESP,0x4
00485b59 : MOV byte ptr [EBP + -0x4],0x1
00485b5d : MOV ECX,dword ptr [EBP + -0x4c]
00485b60 : XOR ESI,ESI
00485b62 : CMP ECX,ESI
00485b64 : JZ 0x00485bb8
00485b66 : JMP 0x00485bb3
00485b68 : CMP byte ptr [EBP + -0x11],0x0
00485b6c : JNZ 0x00485b83
00485b6e : MOV ESI,dword ptr [EBP + -0x18]
00485b71 : MOV EAX,dword ptr [EBP + -0x3c]
00485b74 : LEA EDX,[ESI + ESI*0x2]
00485b77 : LEA ECX,[EAX + EDX*0x4]
00485b7a : PUSH ECX
00485b7b : LEA EAX,[EBP + -0x50]
00485b7e : CALL 0x00406db0
00485b83 : MOV ESI,dword ptr [EBP + -0x1c]
00485b86 : CALL 0x00476f00
00485b8b : MOV EBX,dword ptr [EBP + -0x4c]
00485b8e : MOV EDI,dword ptr [EBP + -0x48]
00485b91 : MOV ESI,EBX
00485b93 : CMP EBX,EDI
00485b95 : JZ 0x00485ba7
00485b97 : MOV EAX,dword ptr [EBP + -0x1c]
00485b9a : PUSH ESI
00485b9b : CALL 0x00406ea0
00485ba0 : ADD ESI,0xc
00485ba3 : CMP ESI,EDI
00485ba5 : JNZ 0x00485b97
00485ba7 : MOV byte ptr [EBP + -0x4],0x1
00485bab : XOR ESI,ESI
00485bad : CMP EBX,ESI
00485baf : JZ 0x00485bb8
00485bb1 : MOV ECX,EBX
00485bb3 : CALL 0x006f04e0
00485bb8 : MOV dword ptr [EBP + -0x44],ESI
00485bbb : MOV dword ptr [EBP + -0x48],ESI
00485bbe : MOV dword ptr [EBP + -0x4c],ESI
00485bc1 : MOV byte ptr [EBP + -0x4],0x0
00485bc5 : MOV ECX,dword ptr [EBP + -0x3c]
00485bc8 : CMP ECX,ESI
00485bca : JZ 0x00485bd1
00485bcc : CALL 0x006f04e0
00485bd1 : MOV dword ptr [EBP + -0x34],ESI
00485bd4 : MOV dword ptr [EBP + -0x38],ESI
00485bd7 : MOV dword ptr [EBP + -0x3c],ESI
00485bda : MOV dword ptr [EBP + -0x4],0xffffffff
00485be1 : MOV ECX,dword ptr [EBP + -0x2c]
00485be4 : CMP ECX,ESI
00485be6 : JZ 0x00485bed
00485be8 : CALL 0x006f04e0
00485bed : MOV dword ptr [EBP + -0x24],ESI
00485bf0 : MOV dword ptr [EBP + -0x28],ESI
00485bf3 : MOV dword ptr [EBP + -0x2c],ESI
00485bf6 : MOV ECX,dword ptr [EBP + -0xc]
00485bf9 : MOV dword ptr FS:[0x0],ECX
00485c00 : POP ECX
00485c01 : POP EDI
00485c02 : POP ESI
00485c03 : POP EBX
00485c04 : MOV ESP,EBP
00485c06 : POP EBP
00485c07 : RET 0x4
