PROGRAM  : Maestia.exe
FUNCTION : __close
ENTRY    : 00648e03
BODY     : [[00648e03, 00648ec5]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __SEH_prolog4 replaced with injection: SEH_prolog4 */
/* WARNING: Function: __SEH_epilog4 replaced with injection: EH_epilog3 */
/* Library Function - Single Match
    __close
   
   Library: Visual Studio 2008 Release */

int __cdecl __close(int _FileHandle)

{
  ulong *puVar1;
  int *piVar2;
  int iVar3;
  int local_20;
  
  if (_FileHandle == -2) {
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
  }
  else {
    if ((-1 < _FileHandle) && ((uint)_FileHandle < DAT_01728c30)) {
      iVar3 = (_FileHandle & 0x1fU) * 0x40;
      if ((*(byte *)((&DAT_01728c40)[_FileHandle >> 5] + 4 + iVar3) & 1) != 0) {
        ___lock_fhandle(_FileHandle);
        if ((*(byte *)((&DAT_01728c40)[_FileHandle >> 5] + 4 + iVar3) & 1) == 0) {
          piVar2 = __errno();
          *piVar2 = 9;
          local_20 = -1;
        }
        else {
          local_20 = __close_nolock(_FileHandle);
        }
        FUN_00648ec6();
        return local_20;
      }
    }
    puVar1 = ___doserrno();
    *puVar1 = 0;
    piVar2 = __errno();
    *piVar2 = 9;
    __invalid_parameter(0,0,0,0,0);
  }
  return -1;
}



============================================================
DISASSEMBLY
============================================================
00648e03 : PUSH 0x10
00648e05 : PUSH 0xced058
00648e0a : CALL 0x0064c228
00648e0f : MOV EAX,dword ptr [EBP + 0x8]
00648e12 : CMP EAX,-0x2
00648e15 : JNZ 0x00648e32
00648e17 : CALL 0x0063ab95
00648e1c : AND dword ptr [EAX],0x0
00648e1f : CALL 0x0063ab82
00648e24 : MOV dword ptr [EAX],0x9
00648e2a : OR EAX,0xffffffff
00648e2d : JMP 0x00648ec0
00648e32 : XOR EDI,EDI
00648e34 : CMP EAX,EDI
00648e36 : JL 0x00648e40
00648e38 : CMP EAX,dword ptr [0x01728c30]
00648e3e : JC 0x00648e61
00648e40 : CALL 0x0063ab95
00648e45 : MOV dword ptr [EAX],EDI
00648e47 : CALL 0x0063ab82
00648e4c : MOV dword ptr [EAX],0x9
00648e52 : PUSH EDI
00648e53 : PUSH EDI
00648e54 : PUSH EDI
00648e55 : PUSH EDI
00648e56 : PUSH EDI
00648e57 : CALL 0x006372b8
00648e5c : ADD ESP,0x14
00648e5f : JMP 0x00648e2a
00648e61 : MOV ECX,EAX
00648e63 : SAR ECX,0x5
00648e66 : LEA EBX,[ECX*0x4 + 0x1728c40]
00648e6d : MOV ESI,EAX
00648e6f : AND ESI,0x1f
00648e72 : SHL ESI,0x6
00648e75 : MOV ECX,dword ptr [EBX]
00648e77 : MOVSX ECX,byte ptr [ECX + ESI*0x1 + 0x4]
00648e7c : AND ECX,0x1
00648e7f : JZ 0x00648e40
00648e81 : PUSH EAX
00648e82 : CALL 0x0065cc82
00648e87 : POP ECX
00648e88 : MOV dword ptr [EBP + -0x4],EDI
00648e8b : MOV EAX,dword ptr [EBX]
00648e8d : TEST byte ptr [EAX + ESI*0x1 + 0x4],0x1
00648e92 : JZ 0x00648ea2
00648e94 : PUSH dword ptr [EBP + 0x8]
00648e97 : CALL 0x00648d67
00648e9c : POP ECX
00648e9d : MOV dword ptr [EBP + -0x1c],EAX
00648ea0 : JMP 0x00648eb1
00648ea2 : CALL 0x0063ab82
00648ea7 : MOV dword ptr [EAX],0x9
00648ead : OR dword ptr [EBP + -0x1c],0xffffffff
00648eb1 : MOV dword ptr [EBP + -0x4],0xfffffffe
00648eb8 : CALL 0x00648ec6
00648ebd : MOV EAX,dword ptr [EBP + -0x1c]
00648ec0 : CALL 0x0064c26d
00648ec5 : RET
