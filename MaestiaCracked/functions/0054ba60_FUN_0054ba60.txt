PROGRAM  : Maestia.exe
FUNCTION : FUN_0054ba60
ENTRY    : 0054ba60
BODY     : [[0054ba60, 0054bb16] [0054bb20, 0054bdbb]]

============================================================
DECOMPILED C CODE
============================================================

undefined1 FUN_0054ba60(float *param_1,uint param_2)

{
  float fVar1;
  float fVar2;
  float fVar3;
  float fVar4;
  float fVar5;
  int *piVar6;
  float fVar7;
  uint uVar8;
  uint uVar9;
  int in_ECX;
  int iVar10;
  float10 fVar11;
  undefined1 local_8d;
  int local_8c;
  int local_88;
  int local_78;
  int *local_70 [2];
  uint local_68;
  ushort *local_5c;
  ushort *local_58;
  int *local_10;
  GRefCountNTSImpl *local_c;
  
  uVar8 = FUN_0053c470();
  iVar10 = 0;
  if ((param_1 == (float *)0x0) || (uVar8 < param_2)) {
    return 0;
  }
  if ((*(byte *)(in_ECX + 0x143) & 3) != 0) {
    FUN_00549ad0();
    *(byte *)(in_ECX + 0x143) = *(byte *)(in_ECX + 0x143) & 0xfc;
  }
  FUN_00599f40(local_70,param_2);
  local_8d = 0;
  if (((local_70[0] != (int *)0x0) && (local_68 < (uint)local_70[0][1])) && (-1 < (int)local_68)) {
    piVar6 = *(int **)(*local_70[0] + local_68 * 4);
    uVar8 = piVar6[2];
    if ((*piVar6 < 0) && (uVar8 = uVar8 & 0xffffff, uVar8 == 0xffffff)) {
      uVar8 = 0xffffffff;
    }
    FUN_005461c0(&local_5c);
    local_78 = 0;
    while( true ) {
      if ((local_5c == (ushort *)0x0) || (local_58 <= local_5c)) goto LAB_0054bccf;
      if (iVar10 == param_2 - uVar8) break;
      uVar9 = (uint)local_5c[1];
      if (((byte)local_5c[3] >> 6 & 1) != 0) {
        uVar9 = -uVar9;
      }
      local_78 = local_78 + uVar9;
      FUN_005443b0();
      iVar10 = iVar10 + 1;
    }
    local_8d = 1;
    if ((local_5c[3] >> 0xb & 1) == 0) {
      if (local_10 == (int *)0x0) {
        iVar10 = 0;
      }
      else {
        iVar10 = local_10[5];
      }
      fVar11 = (float10)FUN_00544370();
      fVar7 = (float)(fVar11 * (float10)20.0) * 0.0009765625;
      if (*local_5c < 0xffff) {
        uVar8 = (uint)*local_5c;
      }
      else {
        uVar8 = 0xffffffff;
      }
      (**(code **)(**(int **)(iVar10 + 0xc) + 0x30))(uVar8,param_1);
      if ((*(byte *)((int)local_5c + 7) & 1) != 0) {
        param_1[2] = (param_1[2] - *param_1) / 3.0 + *param_1;
      }
      fVar1 = *(float *)(*(int *)(iVar10 + 0xc) + 8);
      fVar2 = *(float *)(*(int *)(iVar10 + 0xc) + 0xc);
      fVar3 = *param_1;
      *param_1 = fVar7 * fVar3;
      fVar4 = param_1[2];
      param_1[2] = fVar7 * fVar4;
      fVar11 = (float10)FUN_00544470();
      fVar5 = (float)((fVar11 - (float10)fVar7 * (float10)*(float *)(*(int *)(iVar10 + 0xc) + 8)) +
                     (float10)40.0);
      param_1[1] = fVar5;
      param_1[3] = (float)(((float10)fVar2 + (float10)fVar1) * (float10)fVar7) + fVar5;
      if (*piVar6 < 0) {
        local_88 = piVar6[4];
      }
      else {
        local_88 = piVar6[4];
      }
      fVar1 = (float)((float10)40.0 + (float10)local_78);
      *param_1 = fVar1 + fVar7 * fVar3;
      param_1[2] = fVar1 + fVar7 * fVar4;
      param_1[1] = (float)local_88 + param_1[1];
      param_1[3] = (float)local_88 + param_1[3];
    }
    else {
      *param_1 = -(float)*(int *)(local_c + 0x10);
      param_1[1] = -(float)*(int *)(local_c + 0x14);
      fVar7 = (float)*(int *)(local_c + 0x18);
      if (*(int *)(local_c + 0x18) < 0) {
        fVar7 = fVar7 + 4.2949673e+09;
      }
      param_1[2] = fVar7 + *param_1;
      fVar7 = (float)*(int *)(local_c + 0x1c);
      if (*(int *)(local_c + 0x1c) < 0) {
        fVar7 = fVar7 + 4.2949673e+09;
      }
      param_1[3] = fVar7 + param_1[1];
      if (*piVar6 < 0) {
        local_8c = piVar6[4];
      }
      else {
        local_8c = piVar6[4];
      }
      *param_1 = (float)local_78 + 40.0 + *param_1;
      param_1[2] = (float)local_78 + 40.0 + param_1[2];
      param_1[1] = (float)local_8c + 40.0 + param_1[1];
      param_1[3] = (float)local_8c + 40.0 + param_1[3];
    }
LAB_0054bccf:
    if (local_c != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(local_c);
    }
    if ((local_10 != (int *)0x0) && (*local_10 = *local_10 + -1, *local_10 == 0)) {
      FUN_00500860();
      FUN_00515cf0(local_10);
    }
  }
  return local_8d;
}



============================================================
DISASSEMBLY
============================================================
0054ba60 : SUB ESP,0x90
0054ba66 : PUSH EBX
0054ba67 : PUSH EBP
0054ba68 : PUSH ESI
0054ba69 : MOV EBX,ECX
0054ba6b : MOV ECX,dword ptr [EBX + 0xc]
0054ba6e : PUSH EDI
0054ba6f : CALL 0x0053c470
0054ba74 : MOV ESI,dword ptr [ESP + 0xa4]
0054ba7b : XOR EBP,EBP
0054ba7d : CMP ESI,EBP
0054ba7f : JZ 0x0054bdad
0054ba85 : MOV EDI,dword ptr [ESP + 0xa8]
0054ba8c : CMP EDI,EAX
0054ba8e : JA 0x0054bdad
0054ba94 : TEST byte ptr [EBX + 0x143],0x3
0054ba9b : JZ 0x0054baab
0054ba9d : MOV ECX,EBX
0054ba9f : CALL 0x00549ad0
0054baa4 : AND byte ptr [EBX + 0x143],0xfc
0054baab : PUSH EDI
0054baac : LEA EAX,[ESP + 0x34]
0054bab0 : PUSH EAX
0054bab1 : LEA ECX,[EBX + 0x28]
0054bab4 : CALL 0x00599f40
0054bab9 : MOV EAX,dword ptr [ESP + 0x30]
0054babd : MOV byte ptr [ESP + 0x13],0x0
0054bac2 : CMP EAX,EBP
0054bac4 : JZ 0x0054bcf9
0054baca : MOV ECX,dword ptr [ESP + 0x38]
0054bace : CMP ECX,dword ptr [EAX + 0x4]
0054bad1 : JNC 0x0054bcf9
0054bad7 : CMP ECX,EBP
0054bad9 : JL 0x0054bcf9
0054badf : MOV EDX,dword ptr [EAX]
0054bae1 : MOV EBX,dword ptr [EDX + ECX*0x4]
0054bae4 : MOV EAX,dword ptr [EBX]
0054bae6 : SHR EAX,0x1f
0054bae9 : TEST AL,0x1
0054baeb : MOV EAX,dword ptr [EBX + 0x8]
0054baee : JZ 0x0054baff
0054baf0 : AND EAX,0xffffff
0054baf5 : CMP EAX,0xffffff
0054bafa : JNZ 0x0054baff
0054bafc : OR EAX,0xffffffff
0054baff : LEA ECX,[ESP + 0x44]
0054bb03 : SUB EDI,EAX
0054bb05 : PUSH ECX
0054bb06 : MOV ECX,EBX
0054bb08 : MOV dword ptr [ESP + 0x18],EDI
0054bb0c : CALL 0x005461c0
0054bb11 : MOV dword ptr [ESP + 0x28],EBP
0054bb15 : JMP 0x0054bb20
0054bb20 : MOV EDI,dword ptr [ESP + 0x44]
0054bb24 : TEST EDI,EDI
0054bb26 : JZ 0x0054bcc8
0054bb2c : CMP EDI,dword ptr [ESP + 0x48]
0054bb30 : JNC 0x0054bcc8
0054bb36 : CMP EBP,dword ptr [ESP + 0x14]
0054bb3a : JZ 0x0054bb5d
0054bb3c : MOV DL,byte ptr [EDI + 0x6]
0054bb3f : MOVZX EAX,word ptr [EDI + 0x2]
0054bb43 : SHR DL,0x6
0054bb46 : TEST DL,0x1
0054bb49 : JZ 0x0054bb4d
0054bb4b : NEG EAX
0054bb4d : ADD dword ptr [ESP + 0x28],EAX
0054bb51 : LEA ECX,[ESP + 0x44]
0054bb55 : CALL 0x005443b0
0054bb5a : INC EBP
0054bb5b : JMP 0x0054bb20
0054bb5d : LEA EAX,[EDI + 0x6]
0054bb60 : MOV dword ptr [ESP + 0x24],EAX
0054bb64 : MOV AX,word ptr [EAX]
0054bb67 : SHR AX,0xb
0054bb6b : MOV byte ptr [ESP + 0x13],0x1
0054bb70 : TEST AL,0x1
0054bb72 : JNZ 0x0054bd0a
0054bb78 : MOV EAX,dword ptr [ESP + 0x90]
0054bb7f : TEST EAX,EAX
0054bb81 : JZ 0x0054bb88
0054bb83 : MOV EBP,dword ptr [EAX + 0x14]
0054bb86 : JMP 0x0054bb8a
0054bb88 : XOR EBP,EBP
0054bb8a : MOV ECX,EDI
0054bb8c : CALL 0x00544370
0054bb91 : FMUL double ptr [0x00b86058]
0054bb97 : MOVZX EAX,word ptr [EDI]
0054bb9a : MOV ECX,0xffff
0054bb9f : FSTP float ptr [ESP + 0x14]
0054bba3 : FLD float ptr [ESP + 0x14]
0054bba7 : FMUL double ptr [0x00b8bee0]
0054bbad : FSTP float ptr [ESP + 0x18]
0054bbb1 : CMP AX,CX
0054bbb4 : JNC 0x0054bbbb
0054bbb6 : MOVZX EAX,AX
0054bbb9 : JMP 0x0054bbbe
0054bbbb : OR EAX,0xffffffff
0054bbbe : MOV ECX,dword ptr [EBP + 0xc]
0054bbc1 : MOV EDX,dword ptr [ECX]
0054bbc3 : PUSH ESI
0054bbc4 : PUSH EAX
0054bbc5 : MOV EAX,dword ptr [EDX + 0x30]
0054bbc8 : CALL EAX
0054bbca : MOV ECX,dword ptr [ESP + 0x24]
0054bbce : TEST byte ptr [ECX + 0x1],0x1
0054bbd2 : JZ 0x0054bbf4
0054bbd4 : FLD float ptr [ESI + 0x8]
0054bbd7 : FSUB float ptr [ESI]
0054bbd9 : FSTP float ptr [ESP + 0x14]
0054bbdd : FLD float ptr [ESP + 0x14]
0054bbe1 : FDIV double ptr [0x00b8bee8]
0054bbe7 : FSTP float ptr [ESP + 0x14]
0054bbeb : FLD float ptr [ESP + 0x14]
0054bbef : FADD float ptr [ESI]
0054bbf1 : FSTP float ptr [ESI + 0x8]
0054bbf4 : MOV EAX,dword ptr [EBP + 0xc]
0054bbf7 : FLD float ptr [EAX + 0x8]
0054bbfa : MOV ECX,EBX
0054bbfc : FSTP float ptr [ESP + 0x1c]
0054bc00 : FLD float ptr [EAX + 0xc]
0054bc03 : FSTP float ptr [ESP + 0x2c]
0054bc07 : FLD float ptr [ESI]
0054bc09 : FLD float ptr [ESP + 0x18]
0054bc0d : FLD ST0
0054bc0f : FMULP ST2
0054bc11 : FXCH
0054bc13 : FSTP float ptr [ESP + 0x24]
0054bc17 : FLD float ptr [ESP + 0x24]
0054bc1b : FSTP float ptr [ESI]
0054bc1d : FMUL float ptr [ESI + 0x8]
0054bc20 : FSTP float ptr [ESP + 0x14]
0054bc24 : FLD float ptr [ESP + 0x14]
0054bc28 : FSTP float ptr [ESI + 0x8]
0054bc2b : CALL 0x00544470
0054bc30 : MOV EDX,dword ptr [EBP + 0xc]
0054bc33 : FLD float ptr [EDX + 0x8]
0054bc36 : FLD float ptr [ESP + 0x18]
0054bc3a : FLD ST0
0054bc3c : FMULP ST2
0054bc3e : FXCH ST2
0054bc40 : FSUBRP
0054bc42 : FLD double ptr [0x00b8be30]
0054bc48 : FADD ST1,ST0
0054bc4a : FXCH
0054bc4c : FSTP float ptr [ESP + 0x18]
0054bc50 : FLD float ptr [ESP + 0x18]
0054bc54 : FST float ptr [ESI + 0x4]
0054bc57 : FLD float ptr [ESP + 0x2c]
0054bc5b : FADD float ptr [ESP + 0x1c]
0054bc5f : FMULP ST3
0054bc61 : FXCH ST2
0054bc63 : FSTP float ptr [ESP + 0x1c]
0054bc67 : FLD float ptr [ESP + 0x1c]
0054bc6b : FADDP ST2,ST0
0054bc6d : FXCH
0054bc6f : FSTP float ptr [ESI + 0xc]
0054bc72 : MOV EAX,dword ptr [EBX]
0054bc74 : SHR EAX,0x1f
0054bc77 : TEST AL,0x1
0054bc79 : JZ 0x0054bc84
0054bc7b : MOV ECX,dword ptr [EBX + 0x10]
0054bc7e : MOV dword ptr [ESP + 0x18],ECX
0054bc82 : JMP 0x0054bc8b
0054bc84 : MOV EDX,dword ptr [EBX + 0x10]
0054bc87 : MOV dword ptr [ESP + 0x18],EDX
0054bc8b : FIADD dword ptr [ESP + 0x28]
0054bc8f : FSTP float ptr [ESP + 0x1c]
0054bc93 : FILD dword ptr [ESP + 0x18]
0054bc97 : FSTP float ptr [ESP + 0x20]
0054bc9b : FLD float ptr [ESP + 0x24]
0054bc9f : FLD float ptr [ESP + 0x1c]
0054bca3 : FLD ST0
0054bca5 : FADDP ST2,ST0
0054bca7 : FXCH
0054bca9 : FSTP float ptr [ESI]
0054bcab : FADD float ptr [ESP + 0x14]
0054bcaf : FSTP float ptr [ESI + 0x8]
0054bcb2 : FLD float ptr [ESI + 0x4]
0054bcb5 : FLD float ptr [ESP + 0x20]
0054bcb9 : FLD ST0
0054bcbb : FADDP ST2,ST0
0054bcbd : FXCH
0054bcbf : FSTP float ptr [ESI + 0x4]
0054bcc2 : FADD float ptr [ESI + 0xc]
0054bcc5 : FSTP float ptr [ESI + 0xc]
0054bcc8 : MOV ECX,dword ptr [ESP + 0x94]
0054bccf : TEST ECX,ECX
0054bcd1 : JZ 0x0054bcd8
0054bcd3 : CALL 0x004ff7c0
0054bcd8 : MOV EAX,dword ptr [ESP + 0x90]
0054bcdf : TEST EAX,EAX
0054bce1 : JZ 0x0054bcf9
0054bce3 : DEC dword ptr [EAX]
0054bce5 : MOV ESI,EAX
0054bce7 : CMP dword ptr [ESI],0x0
0054bcea : JNZ 0x0054bcf9
0054bcec : MOV ECX,ESI
0054bcee : CALL 0x00500860
0054bcf3 : PUSH ESI
0054bcf4 : CALL 0x00515cf0
0054bcf9 : MOV AL,byte ptr [ESP + 0x13]
0054bcfd : POP EDI
0054bcfe : POP ESI
0054bcff : POP EBP
0054bd00 : POP EBX
0054bd01 : ADD ESP,0x90
0054bd07 : RET 0x8
0054bd0a : MOV ECX,dword ptr [ESP + 0x94]
0054bd11 : FILD dword ptr [ECX + 0x10]
0054bd14 : FCHS
0054bd16 : FSTP float ptr [ESI]
0054bd18 : FILD dword ptr [ECX + 0x14]
0054bd1b : FCHS
0054bd1d : FSTP float ptr [ESI + 0x4]
0054bd20 : MOV EAX,dword ptr [ECX + 0x18]
0054bd23 : FILD dword ptr [ECX + 0x18]
0054bd26 : TEST EAX,EAX
0054bd28 : JGE 0x0054bd30
0054bd2a : FADD float ptr [0x00cdf0e0]
0054bd30 : FADD float ptr [ESI]
0054bd32 : FSTP float ptr [ESI + 0x8]
0054bd35 : MOV EDX,dword ptr [ECX + 0x1c]
0054bd38 : FILD dword ptr [ECX + 0x1c]
0054bd3b : TEST EDX,EDX
0054bd3d : JGE 0x0054bd45
0054bd3f : FADD float ptr [0x00cdf0e0]
0054bd45 : FADD float ptr [ESI + 0x4]
0054bd48 : FSTP float ptr [ESI + 0xc]
0054bd4b : MOV EAX,dword ptr [EBX]
0054bd4d : SHR EAX,0x1f
0054bd50 : TEST AL,0x1
0054bd52 : JZ 0x0054bd5d
0054bd54 : MOV EDX,dword ptr [EBX + 0x10]
0054bd57 : MOV dword ptr [ESP + 0x14],EDX
0054bd5b : JMP 0x0054bd64
0054bd5d : MOV EAX,dword ptr [EBX + 0x10]
0054bd60 : MOV dword ptr [ESP + 0x14],EAX
0054bd64 : FILD dword ptr [ESP + 0x28]
0054bd68 : FLD double ptr [0x00b8be30]
0054bd6e : FADD ST1,ST0
0054bd70 : FXCH
0054bd72 : FSTP float ptr [ESP + 0x1c]
0054bd76 : FIADD dword ptr [ESP + 0x14]
0054bd7a : FSTP float ptr [ESP + 0x20]
0054bd7e : FLD float ptr [ESI]
0054bd80 : FLD float ptr [ESP + 0x1c]
0054bd84 : FLD ST0
0054bd86 : FADDP ST2,ST0
0054bd88 : FXCH
0054bd8a : FSTP float ptr [ESI]
0054bd8c : FADD float ptr [ESI + 0x8]
0054bd8f : FSTP float ptr [ESI + 0x8]
0054bd92 : FLD float ptr [ESI + 0x4]
0054bd95 : FLD float ptr [ESP + 0x20]
0054bd99 : FLD ST0
0054bd9b : FADDP ST2,ST0
0054bd9d : FXCH
0054bd9f : FSTP float ptr [ESI + 0x4]
0054bda2 : FADD float ptr [ESI + 0xc]
0054bda5 : FSTP float ptr [ESI + 0xc]
0054bda8 : JMP 0x0054bccf
0054bdad : POP EDI
0054bdae : POP ESI
0054bdaf : POP EBP
0054bdb0 : XOR AL,AL
0054bdb2 : POP EBX
0054bdb3 : ADD ESP,0x90
0054bdb9 : RET 0x8
