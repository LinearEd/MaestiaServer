PROGRAM  : Maestia.exe
FUNCTION : FUN_006f42f0
ENTRY    : 006f42f0
BODY     : [[006f42f0, 006f44a1]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_006f42f0(void)

{
  u_short uVar1;
  SOCKET s;
  int iVar2;
  DWORD DVar3;
  undefined4 uVar4;
  int unaff_ESI;
  undefined4 local_10;
  undefined4 local_c;
  undefined4 local_8;
  
  *(undefined1 *)(unaff_ESI + 0x2404) = 200;
  *(undefined1 *)(unaff_ESI + 0x2405) = 200;
  if (*(int *)(unaff_ESI + 0xee0) != -1) {
    return 0;
  }
  s = WSASocketA(2,1,6,0,0,1);
  *(SOCKET *)(unaff_ESI + 0xee0) = s;
  local_8 = 0;
  local_c = 0;
  local_10 = 1;
  iVar2 = setsockopt(s,0xffff,0x1001,(char *)&local_8,4);
  if (iVar2 != 0) {
    iVar2 = WSAGetLastError();
    FUN_006ee470(L"AvSocket::Connect - SO_SNDBUF set failed. val %d, error %u\n",local_8,iVar2);
  }
  iVar2 = setsockopt(*(SOCKET *)(unaff_ESI + 0xee0),0xffff,0x1002,(char *)&local_c,4);
  if (iVar2 != 0) {
    iVar2 = WSAGetLastError();
    FUN_006ee470(L"AvSocket::Connect - SO_RCVBUF set failed. val %d, error %u\n",local_c,iVar2);
  }
  iVar2 = setsockopt(*(SOCKET *)(unaff_ESI + 0xee0),6,1,(char *)&local_10,4);
  if (iVar2 != 0) {
    iVar2 = WSAGetLastError();
    FUN_006ee470(L"AvSocket::Connect - TCP_NODELAY set failed. val %d, error %u\n",local_10,iVar2);
  }
  iVar2 = WSAConnect(*(undefined4 *)(unaff_ESI + 0xee0),unaff_ESI + 0xee4,0x10,0,0,0,0);
  if (iVar2 != 0) {
    DVar3 = GetLastError();
    if (DVar3 != 0x2733) {
      uVar1 = htons(*(u_short *)(unaff_ESI + 0xee6));
      uVar4 = FUN_006f2370(uVar1);
      FUN_006ee470(L"Error - Connect Failed (%u), address %S:%d\n",DVar3,uVar4);
      goto LAB_006f445f;
    }
  }
  iVar2 = FUN_006f4c00(*(undefined4 *)(unaff_ESI + 0xee0));
  if (iVar2 == 1) {
    FUN_006f3140();
    return 1;
  }
  iVar2 = WSAGetLastError();
  FUN_006ee470(L"AvSocket::Connect()- BindIOCP Failed (%u)\n",iVar2);
LAB_006f445f:
  if (*(SOCKET *)(unaff_ESI + 0xee0) != 0xffffffff) {
    shutdown(*(SOCKET *)(unaff_ESI + 0xee0),2);
    closesocket(*(SOCKET *)(unaff_ESI + 0xee0));
  }
  *(undefined4 *)(unaff_ESI + 0xee0) = 0xffffffff;
  return 0;
}



============================================================
DISASSEMBLY
============================================================
006f42f0 : PUSH EBP
006f42f1 : MOV EBP,ESP
006f42f3 : MOV AL,0xc8
006f42f5 : SUB ESP,0xc
006f42f8 : CMP dword ptr [ESI + 0xee0],-0x1
006f42ff : MOV byte ptr [ESI + 0x2404],AL
006f4305 : MOV byte ptr [ESI + 0x2405],AL
006f430b : JZ 0x006f4313
006f430d : XOR EAX,EAX
006f430f : MOV ESP,EBP
006f4311 : POP EBP
006f4312 : RET
006f4313 : PUSH EDI
006f4314 : PUSH 0x1
006f4316 : PUSH 0x0
006f4318 : PUSH 0x0
006f431a : PUSH 0x6
006f431c : PUSH 0x1
006f431e : PUSH 0x2
006f4320 : CALL dword ptr [0x00b855d0]
006f4326 : MOV EDI,dword ptr [0x00b855cc]
006f432c : PUSH 0x4
006f432e : LEA ECX,[EBP + -0x4]
006f4331 : PUSH ECX
006f4332 : PUSH 0x1001
006f4337 : PUSH 0xffff
006f433c : PUSH EAX
006f433d : MOV dword ptr [ESI + 0xee0],EAX
006f4343 : MOV dword ptr [EBP + -0x4],0x0
006f434a : MOV dword ptr [EBP + -0x8],0x0
006f4351 : MOV dword ptr [EBP + -0xc],0x1
006f4358 : CALL EDI
006f435a : TEST EAX,EAX
006f435c : JZ 0x006f4376
006f435e : CALL dword ptr [0x00b855c8]
006f4364 : MOV EDX,dword ptr [EBP + -0x4]
006f4367 : PUSH EAX
006f4368 : PUSH EDX
006f4369 : PUSH 0xbf6388
006f436e : CALL 0x006ee470
006f4373 : ADD ESP,0xc
006f4376 : MOV ECX,dword ptr [ESI + 0xee0]
006f437c : PUSH 0x4
006f437e : LEA EAX,[EBP + -0x8]
006f4381 : PUSH EAX
006f4382 : PUSH 0x1002
006f4387 : PUSH 0xffff
006f438c : PUSH ECX
006f438d : CALL EDI
006f438f : TEST EAX,EAX
006f4391 : JZ 0x006f43ab
006f4393 : CALL dword ptr [0x00b855c8]
006f4399 : MOV EDX,dword ptr [EBP + -0x8]
006f439c : PUSH EAX
006f439d : PUSH EDX
006f439e : PUSH 0xbf6400
006f43a3 : CALL 0x006ee470
006f43a8 : ADD ESP,0xc
006f43ab : MOV ECX,dword ptr [ESI + 0xee0]
006f43b1 : PUSH 0x4
006f43b3 : LEA EAX,[EBP + -0xc]
006f43b6 : PUSH EAX
006f43b7 : PUSH 0x1
006f43b9 : PUSH 0x6
006f43bb : PUSH ECX
006f43bc : CALL EDI
006f43be : TEST EAX,EAX
006f43c0 : JZ 0x006f43da
006f43c2 : CALL dword ptr [0x00b855c8]
006f43c8 : MOV EDX,dword ptr [EBP + -0xc]
006f43cb : PUSH EAX
006f43cc : PUSH EDX
006f43cd : PUSH 0xbf6478
006f43d2 : CALL 0x006ee470
006f43d7 : ADD ESP,0xc
006f43da : MOV ECX,dword ptr [ESI + 0xee0]
006f43e0 : PUSH 0x0
006f43e2 : PUSH 0x0
006f43e4 : PUSH 0x0
006f43e6 : PUSH 0x0
006f43e8 : PUSH 0x10
006f43ea : LEA EAX,[ESI + 0xee4]
006f43f0 : PUSH EAX
006f43f1 : PUSH ECX
006f43f2 : CALL dword ptr [0x00b855c4]
006f43f8 : TEST EAX,EAX
006f43fa : JZ 0x006f4436
006f43fc : CALL dword ptr [0x00b85128]
006f4402 : MOV EDI,EAX
006f4404 : CMP EDI,0x2733
006f440a : JZ 0x006f4436
006f440c : MOVZX EDX,word ptr [ESI + 0xee6]
006f4413 : PUSH EDX
006f4414 : CALL dword ptr [0x00b855c0]
006f441a : MOVZX EAX,AX
006f441d : PUSH EAX
006f441e : MOV EAX,ESI
006f4420 : CALL 0x006f2370
006f4425 : PUSH EAX
006f4426 : PUSH EDI
006f4427 : PUSH 0xbf6530
006f442c : CALL 0x006ee470
006f4431 : ADD ESP,0x10
006f4434 : JMP 0x006f445f
006f4436 : MOV ECX,dword ptr [ESI + 0xee0]
006f443c : PUSH ESI
006f443d : PUSH ECX
006f443e : CALL 0x006f4c00
006f4443 : ADD ESP,0x8
006f4446 : CMP EAX,0x1
006f4449 : JZ 0x006f4491
006f444b : CALL dword ptr [0x00b855c8]
006f4451 : PUSH EAX
006f4452 : PUSH 0xbf6588
006f4457 : CALL 0x006ee470
006f445c : ADD ESP,0x8
006f445f : MOV EAX,dword ptr [ESI + 0xee0]
006f4465 : CMP EAX,-0x1
006f4468 : JZ 0x006f4480
006f446a : PUSH 0x2
006f446c : PUSH EAX
006f446d : CALL dword ptr [0x00b855bc]
006f4473 : MOV EDX,dword ptr [ESI + 0xee0]
006f4479 : PUSH EDX
006f447a : CALL dword ptr [0x00b855b8]
006f4480 : MOV dword ptr [ESI + 0xee0],0xffffffff
006f448a : XOR EAX,EAX
006f448c : POP EDI
006f448d : MOV ESP,EBP
006f448f : POP EBP
006f4490 : RET
006f4491 : MOV ECX,ESI
006f4493 : CALL 0x006f3140
006f4498 : MOV EAX,0x1
006f449d : POP EDI
006f449e : MOV ESP,EBP
006f44a0 : POP EBP
006f44a1 : RET
