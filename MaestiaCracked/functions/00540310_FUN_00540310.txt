PROGRAM  : Maestia.exe
FUNCTION : FUN_00540310
ENTRY    : 00540310
BODY     : [[00540310, 0054044d]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00540310(undefined4 *param_1,int param_2)

{
  int *piVar1;
  int iVar2;
  void *_Dst;
  undefined4 uVar3;
  GRefCountImpl *this;
  undefined4 *in_ECX;
  int iVar4;
  uint local_4;
  
  _Dst = (void *)FUN_00515840(param_1[1] * 2,0);
  *in_ECX = _Dst;
  uVar3 = param_1[1];
  in_ECX[1] = uVar3;
  in_ECX[2] = uVar3;
  _memcpy(_Dst,(void *)*param_1,param_1[1] * 2);
  in_ECX[3] = 0;
  piVar1 = in_ECX + 4;
  *piVar1 = 0;
  in_ECX[5] = 0;
  in_ECX[6] = 0;
  iVar4 = param_1[5];
  uVar3 = param_1[4];
  if (iVar4 != 0) {
    iVar2 = in_ECX[5];
    FUN_0053df30(piVar1,iVar2 + iVar4);
    FUN_0053d230(*piVar1 + iVar2 * 0xc,iVar4,uVar3);
  }
  in_ECX[7] = param_1[7];
  *(undefined2 *)(in_ECX + 9) = 0;
  iVar4 = *(int *)(param_2 + 0x18);
  *(int *)(param_2 + 0x18) = iVar4 + 1;
  in_ECX[8] = iVar4;
  uVar3 = FUN_00561090(param_1[3]);
  if ((GRefCountNTSImpl *)in_ECX[3] != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release((GRefCountNTSImpl *)in_ECX[3]);
  }
  in_ECX[3] = uVar3;
  local_4 = 0;
  param_1 = (undefined4 *)0x0;
  while ((-1 < (int)param_1 && (local_4 < (uint)in_ECX[5]))) {
    iVar4 = *piVar1 + (int)param_1;
    this = (GRefCountImpl *)FUN_00560f80(*(undefined4 *)(iVar4 + 8));
    if (this != (GRefCountImpl *)0x0) {
      GRefCountImpl::AddRef(this);
    }
    if (*(GRefCountImpl **)(iVar4 + 8) != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(*(GRefCountImpl **)(iVar4 + 8));
    }
    *(GRefCountImpl **)(iVar4 + 8) = this;
    if (this != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(this);
    }
    if ((int)local_4 < (int)in_ECX[5]) {
      local_4 = local_4 + 1;
      param_1 = (undefined4 *)((int)param_1 + 0xc);
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00540310 : SUB ESP,0xc
00540313 : PUSH EBX
00540314 : PUSH EBP
00540315 : MOV EBP,dword ptr [ESP + 0x1c]
00540319 : PUSH ESI
0054031a : MOV ESI,dword ptr [ESP + 0x1c]
0054031e : MOV EAX,dword ptr [ESI + 0x4]
00540321 : PUSH EDI
00540322 : PUSH 0x0
00540324 : ADD EAX,EAX
00540326 : MOV EDI,ECX
00540328 : MOV ECX,dword ptr [EBP + 0x1c]
0054032b : PUSH EAX
0054032c : CALL 0x00515840
00540331 : MOV dword ptr [EDI],EAX
00540333 : MOV ECX,dword ptr [ESI + 0x4]
00540336 : MOV dword ptr [EDI + 0x4],ECX
00540339 : MOV dword ptr [EDI + 0x8],ECX
0054033c : MOV ECX,dword ptr [ESI + 0x4]
0054033f : MOV EDX,dword ptr [ESI]
00540341 : ADD ECX,ECX
00540343 : PUSH ECX
00540344 : PUSH EDX
00540345 : PUSH EAX
00540346 : CALL 0x0063ae40
0054034b : MOV dword ptr [EDI + 0xc],0x0
00540352 : XOR ECX,ECX
00540354 : LEA EBX,[EDI + 0x10]
00540357 : MOV dword ptr [EBX],ECX
00540359 : MOV dword ptr [EBX + 0x4],ECX
0054035c : MOV dword ptr [EBX + 0x8],ECX
0054035f : MOV EAX,dword ptr [ESI + 0x14]
00540362 : MOV EDX,dword ptr [ESI + 0x10]
00540365 : ADD ESP,0xc
00540368 : MOV dword ptr [ESP + 0x10],EAX
0054036c : MOV dword ptr [ESP + 0x20],EDX
00540370 : CMP EAX,ECX
00540372 : JZ 0x005403a5
00540374 : MOV ECX,dword ptr [EBX + 0x4]
00540377 : MOV dword ptr [ESP + 0x14],ECX
0054037b : ADD ECX,EAX
0054037d : PUSH ECX
0054037e : PUSH EBX
0054037f : MOV ECX,EBX
00540381 : CALL 0x0053df30
00540386 : MOV EAX,dword ptr [ESP + 0x20]
0054038a : MOV ECX,dword ptr [ESP + 0x10]
0054038e : PUSH EAX
0054038f : MOV EAX,dword ptr [ESP + 0x18]
00540393 : LEA EDX,[EAX + EAX*0x2]
00540396 : MOV EAX,dword ptr [EBX]
00540398 : PUSH ECX
00540399 : LEA ECX,[EAX + EDX*0x4]
0054039c : PUSH ECX
0054039d : CALL 0x0053d230
005403a2 : ADD ESP,0xc
005403a5 : MOV EDX,dword ptr [ESI + 0x1c]
005403a8 : XOR EAX,EAX
005403aa : MOV dword ptr [EDI + 0x1c],EDX
005403ad : MOV word ptr [EDI + 0x24],AX
005403b1 : MOV EAX,dword ptr [EBP + 0x18]
005403b4 : LEA ECX,[EAX + 0x1]
005403b7 : MOV dword ptr [EBP + 0x18],ECX
005403ba : MOV dword ptr [EDI + 0x20],EAX
005403bd : MOV ESI,dword ptr [ESI + 0xc]
005403c0 : PUSH ESI
005403c1 : MOV ECX,EBP
005403c3 : CALL 0x00561090
005403c8 : MOV ECX,dword ptr [EDI + 0xc]
005403cb : MOV ESI,EAX
005403cd : TEST ECX,ECX
005403cf : JZ 0x005403d6
005403d1 : CALL 0x004ff7c0
005403d6 : XOR EAX,EAX
005403d8 : MOV dword ptr [EDI + 0xc],ESI
005403db : MOV dword ptr [ESP + 0x18],EAX
005403df : MOV dword ptr [ESP + 0x20],EAX
005403e3 : MOV EAX,dword ptr [ESP + 0x20]
005403e7 : TEST EAX,EAX
005403e9 : JL 0x00540442
005403eb : MOV EDX,dword ptr [ESP + 0x18]
005403ef : CMP EDX,dword ptr [EBX + 0x4]
005403f2 : JNC 0x00540442
005403f4 : MOV ESI,dword ptr [EBX]
005403f6 : ADD ESI,EAX
005403f8 : MOV EAX,dword ptr [ESI + 0x8]
005403fb : PUSH EAX
005403fc : MOV ECX,EBP
005403fe : CALL 0x00560f80
00540403 : MOV EBP,EAX
00540405 : TEST EBP,EBP
00540407 : JZ 0x00540410
00540409 : MOV ECX,EBP
0054040b : CALL 0x00523dd0
00540410 : MOV ECX,dword ptr [ESI + 0x8]
00540413 : TEST ECX,ECX
00540415 : JZ 0x0054041c
00540417 : CALL 0x004ff7e0
0054041c : MOV dword ptr [ESI + 0x8],EBP
0054041f : TEST EBP,EBP
00540421 : JZ 0x0054042a
00540423 : MOV ECX,EBP
00540425 : CALL 0x004ff7e0
0054042a : MOV EAX,dword ptr [ESP + 0x18]
0054042e : CMP EAX,dword ptr [EBX + 0x4]
00540431 : MOV EBP,dword ptr [ESP + 0x24]
00540435 : JGE 0x005403e3
00540437 : INC dword ptr [ESP + 0x18]
0054043b : ADD dword ptr [ESP + 0x20],0xc
00540440 : JMP 0x005403e3
00540442 : MOV EAX,EDI
00540444 : POP EDI
00540445 : POP ESI
00540446 : POP EBP
00540447 : POP EBX
00540448 : ADD ESP,0xc
0054044b : RET 0x8
