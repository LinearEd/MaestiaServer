PROGRAM  : Maestia.exe
FUNCTION : FUN_00521bc0
ENTRY    : 00521bc0
BODY     : [[00521bc0, 00521e06]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00521bc0(int param_1,int *param_2,char *param_3,undefined4 param_4)

{
  char *pcVar1;
  char cVar2;
  byte bVar3;
  int iVar4;
  undefined4 uVar5;
  int *in_ECX;
  int *piVar6;
  
  pcVar1 = param_3;
  if ((*(uint *)(*param_2 + 0xc) >> 0x1d & 1) == 0) {
    iVar4 = FUN_00524bc0();
    if ((iVar4 == 0) || (iVar4 = FUN_00524bf0(0), iVar4 != 0x5f)) goto LAB_00521d57;
    FUN_00525d70(&param_3);
    if ((*(uint *)(param_3 + 0xc) >> 0x1c & 1) == 0) {
      *(int *)(param_3 + 8) = *(int *)(param_3 + 8) + -1;
      if (*(int *)(param_3 + 8) == 0) {
        FUN_00525340();
      }
      goto LAB_00521d57;
    }
    *(int *)(param_3 + 8) = *(int *)(param_3 + 8) + -1;
    if (*(int *)(param_3 + 8) == 0) {
      FUN_00525340();
    }
  }
  piVar6 = in_ECX + -0x1a;
  iVar4 = FUN_00521500(param_2);
  cVar2 = (**(code **)(*piVar6 + 0xfc))(iVar4,pcVar1,0);
  if (cVar2 != '\0') {
    return 1;
  }
  if (iVar4 == 0x58) {
    iVar4 = (**(code **)(*piVar6 + 0x5c))();
    if (*(char *)(*(int *)(iVar4 + 0x78) + 0x2a4) == '\x01') {
      uVar5 = (**(code **)(*piVar6 + 0x5c))();
      cVar2 = FUN_00526120(uVar5);
      if (cVar2 == '\0') {
        *(byte *)((int)in_ECX + -2) = *(byte *)((int)in_ECX + -2) & 0xfd;
      }
      else {
        *(byte *)((int)in_ECX + -2) = *(byte *)((int)in_ECX + -2) | 2;
      }
      if ((*(byte *)((int)in_ECX + -2) & 2) == 0) {
        (**(code **)(*piVar6 + 0x40))(piVar6);
        FUN_00575730(piVar6);
      }
      else {
        (**(code **)(*piVar6 + 0x40))();
        FUN_00573bd0(piVar6);
      }
    }
  }
  else if ((iVar4 == 0x59) &&
          (iVar4 = (**(code **)(*piVar6 + 0x5c))(),
          *(char *)(*(int *)(iVar4 + 0x78) + 0x2a4) == '\x01')) {
    uVar5 = (**(code **)(*piVar6 + 0x5c))();
    bVar3 = FUN_00526120(uVar5);
    param_3 = (char *)CONCAT31(param_3._1_3_,bVar3);
    if (bVar3 != ((byte)((uint)in_ECX[9] >> 2) & 1)) {
      FUN_0051ccf0(param_3);
      uVar5 = (**(code **)(*piVar6 + 0x40))();
      FUN_0051dcd0(uVar5);
      if ((in_ECX[-0x12] != 0) && ((*(uint *)(in_ECX[-0x12] + 0x8c) >> 2 & 1) == 0)) {
        (**(code **)(*piVar6 + 0x10c))();
      }
    }
  }
LAB_00521d57:
  if (*(byte *)(param_1 + 0x7c) < 7) {
    if (*(int *)(*param_2 + 4) == 0) {
      FUN_00525a80();
    }
    if ((*(int *)(*(int *)(*(int *)(param_1 + 0x78) + 0x134) + 4) == *(int *)(*param_2 + 4)) &&
       (*pcVar1 != '\n')) {
      iVar4 = *in_ECX;
      uVar5 = FUN_00526fa0(0);
      (**(code **)(iVar4 + 0x34))(param_1 + 0x78,uVar5);
    }
  }
  else if ((*param_2 == *(int *)(*(int *)(param_1 + 0x78) + 0x134)) && (*pcVar1 != '\n')) {
    iVar4 = *in_ECX;
    uVar5 = FUN_00526fa0(0);
    (**(code **)(iVar4 + 0x34))(param_1 + 0x78,uVar5);
  }
  iVar4 = (**(code **)(in_ECX[-0x1a] + 0xe4))();
  if (iVar4 == 0) {
    return 0;
  }
  uVar5 = (**(code **)(*(int *)(iVar4 + 0x10) + 0xc))(param_1,param_2,pcVar1,param_4);
  return uVar5;
}



============================================================
DISASSEMBLY
============================================================
00521bc0 : PUSH EBX
00521bc1 : MOV EBX,dword ptr [ESP + 0x10]
00521bc5 : PUSH EBP
00521bc6 : MOV EBP,dword ptr [ESP + 0x10]
00521bca : MOV EAX,dword ptr [EBP]
00521bcd : PUSH ESI
00521bce : PUSH EDI
00521bcf : MOV EDI,ECX
00521bd1 : MOV ECX,dword ptr [EAX + 0xc]
00521bd4 : SHR ECX,0x1d
00521bd7 : TEST CL,0x1
00521bda : JNZ 0x00521c2a
00521bdc : MOV ECX,EBP
00521bde : CALL 0x00524bc0
00521be3 : TEST EAX,EAX
00521be5 : JBE 0x00521d57
00521beb : PUSH 0x0
00521bed : MOV ECX,EBP
00521bef : CALL 0x00524bf0
00521bf4 : CMP EAX,0x5f
00521bf7 : JNZ 0x00521d57
00521bfd : LEA EDX,[ESP + 0x1c]
00521c01 : PUSH EDX
00521c02 : MOV ECX,EBP
00521c04 : CALL 0x00525d70
00521c09 : MOV EAX,dword ptr [ESP + 0x1c]
00521c0d : MOV ECX,dword ptr [EAX + 0xc]
00521c10 : SHR ECX,0x1c
00521c13 : TEST CL,0x1
00521c16 : MOV ECX,EAX
00521c18 : JZ 0x00521c54
00521c1a : DEC dword ptr [EAX + 0x8]
00521c1d : ADD EAX,0x8
00521c20 : CMP dword ptr [EAX],0x0
00521c23 : JNZ 0x00521c2a
00521c25 : CALL 0x00525340
00521c2a : LEA ESI,[EDI + -0x68]
00521c2d : PUSH EBP
00521c2e : MOV ECX,ESI
00521c30 : CALL 0x00521500
00521c35 : MOV EDX,dword ptr [ESI]
00521c37 : PUSH 0x0
00521c39 : MOV EBP,EAX
00521c3b : MOV EAX,dword ptr [EDX + 0xfc]
00521c41 : PUSH EBX
00521c42 : PUSH EBP
00521c43 : MOV ECX,ESI
00521c45 : CALL EAX
00521c47 : TEST AL,AL
00521c49 : JZ 0x00521c6d
00521c4b : POP EDI
00521c4c : POP ESI
00521c4d : POP EBP
00521c4e : MOV AL,0x1
00521c50 : POP EBX
00521c51 : RET 0x10
00521c54 : DEC dword ptr [EAX + 0x8]
00521c57 : ADD EAX,0x8
00521c5a : CMP dword ptr [EAX],0x0
00521c5d : JNZ 0x00521d57
00521c63 : CALL 0x00525340
00521c68 : JMP 0x00521d57
00521c6d : SUB EBP,0x58
00521c70 : JZ 0x00521cfd
00521c76 : SUB EBP,0x1
00521c79 : JNZ 0x00521d53
00521c7f : MOV EDX,dword ptr [ESI]
00521c81 : MOV EAX,dword ptr [EDX + 0x5c]
00521c84 : MOV ECX,ESI
00521c86 : CALL EAX
00521c88 : MOV ECX,dword ptr [EAX + 0x78]
00521c8b : CMP byte ptr [ECX + 0x2a4],0x1
00521c92 : JNZ 0x00521d53
00521c98 : MOV EDX,dword ptr [ESI]
00521c9a : MOV EAX,dword ptr [EDX + 0x5c]
00521c9d : MOV ECX,ESI
00521c9f : CALL EAX
00521ca1 : PUSH EAX
00521ca2 : MOV ECX,EBX
00521ca4 : CALL 0x00526120
00521ca9 : MOV ECX,dword ptr [EDI + 0x24]
00521cac : SHR ECX,0x2
00521caf : AND CL,0x1
00521cb2 : MOV byte ptr [ESP + 0x1c],AL
00521cb6 : CMP AL,CL
00521cb8 : JZ 0x00521d53
00521cbe : MOV EDX,dword ptr [ESP + 0x1c]
00521cc2 : PUSH EDX
00521cc3 : MOV ECX,ESI
00521cc5 : CALL 0x0051ccf0
00521cca : MOV EAX,dword ptr [ESI]
00521ccc : MOV EDX,dword ptr [EAX + 0x40]
00521ccf : MOV ECX,ESI
00521cd1 : CALL EDX
00521cd3 : PUSH EAX
00521cd4 : MOV ECX,ESI
00521cd6 : CALL 0x0051dcd0
00521cdb : MOV EAX,dword ptr [EDI + -0x48]
00521cde : TEST EAX,EAX
00521ce0 : JZ 0x00521d53
00521ce2 : MOV EAX,dword ptr [EAX + 0x8c]
00521ce8 : SHR EAX,0x2
00521ceb : TEST AL,0x1
00521ced : JNZ 0x00521d53
00521cef : MOV EDX,dword ptr [ESI]
00521cf1 : MOV EAX,dword ptr [EDX + 0x10c]
00521cf7 : MOV ECX,ESI
00521cf9 : CALL EAX
00521cfb : JMP 0x00521d53
00521cfd : MOV EDX,dword ptr [ESI]
00521cff : MOV EAX,dword ptr [EDX + 0x5c]
00521d02 : MOV ECX,ESI
00521d04 : CALL EAX
00521d06 : MOV ECX,dword ptr [EAX + 0x78]
00521d09 : CMP byte ptr [ECX + 0x2a4],0x1
00521d10 : JNZ 0x00521d53
00521d12 : MOV EDX,dword ptr [ESI]
00521d14 : MOV EAX,dword ptr [EDX + 0x5c]
00521d17 : MOV ECX,ESI
00521d19 : CALL EAX
00521d1b : PUSH EAX
00521d1c : MOV ECX,EBX
00521d1e : CALL 0x00526120
00521d23 : MOV CL,0x2
00521d25 : TEST AL,AL
00521d27 : JZ 0x00521d2e
00521d29 : OR byte ptr [ESI + 0x66],CL
00521d2c : JMP 0x00521d32
00521d2e : AND byte ptr [ESI + 0x66],0xfd
00521d32 : MOV EDX,dword ptr [ESI]
00521d34 : TEST byte ptr [EDI + -0x2],CL
00521d37 : MOV EAX,dword ptr [EDX + 0x40]
00521d3a : PUSH ESI
00521d3b : MOV ECX,ESI
00521d3d : JZ 0x00521d4a
00521d3f : CALL EAX
00521d41 : MOV ECX,EAX
00521d43 : CALL 0x00573bd0
00521d48 : JMP 0x00521d53
00521d4a : CALL EAX
00521d4c : MOV ECX,EAX
00521d4e : CALL 0x00575730
00521d53 : MOV EBP,dword ptr [ESP + 0x18]
00521d57 : MOV ESI,dword ptr [ESP + 0x14]
00521d5b : CMP byte ptr [ESI + 0x7c],0x6
00521d5f : JBE 0x00521d8d
00521d61 : MOV ECX,dword ptr [ESI + 0x78]
00521d64 : MOV EDX,dword ptr [EBP]
00521d67 : ADD ESI,0x78
00521d6a : CMP EDX,dword ptr [ECX + 0x134]
00521d70 : JNZ 0x00521dcf
00521d72 : CMP byte ptr [EBX],0xa
00521d75 : JZ 0x00521dcf
00521d77 : MOV EBP,dword ptr [EDI]
00521d79 : PUSH 0x0
00521d7b : MOV ECX,EBX
00521d7d : CALL 0x00526fa0
00521d82 : PUSH EAX
00521d83 : MOV EAX,dword ptr [EBP + 0x34]
00521d86 : PUSH ESI
00521d87 : MOV ECX,EDI
00521d89 : CALL EAX
00521d8b : JMP 0x00521dcb
00521d8d : MOV ECX,dword ptr [EBP]
00521d90 : CMP dword ptr [ECX + 0x4],0x0
00521d94 : JNZ 0x00521d9b
00521d96 : CALL 0x00525a80
00521d9b : MOV ECX,dword ptr [ESI + 0x78]
00521d9e : MOV EDX,dword ptr [ECX + 0x134]
00521da4 : MOV EAX,dword ptr [EBP]
00521da7 : MOV ECX,dword ptr [EDX + 0x4]
00521daa : ADD ESI,0x78
00521dad : CMP ECX,dword ptr [EAX + 0x4]
00521db0 : JNZ 0x00521dcf
00521db2 : CMP byte ptr [EBX],0xa
00521db5 : JZ 0x00521dcf
00521db7 : MOV EBP,dword ptr [EDI]
00521db9 : PUSH 0x0
00521dbb : MOV ECX,EBX
00521dbd : CALL 0x00526fa0
00521dc2 : MOV EDX,dword ptr [EBP + 0x34]
00521dc5 : PUSH EAX
00521dc6 : PUSH ESI
00521dc7 : MOV ECX,EDI
00521dc9 : CALL EDX
00521dcb : MOV EBP,dword ptr [ESP + 0x18]
00521dcf : MOV EAX,dword ptr [EDI + -0x68]
00521dd2 : MOV EDX,dword ptr [EAX + 0xe4]
00521dd8 : LEA ECX,[EDI + -0x68]
00521ddb : CALL EDX
00521ddd : TEST EAX,EAX
00521ddf : JZ 0x00521dfe
00521de1 : MOV EDX,dword ptr [ESP + 0x20]
00521de5 : PUSH EDX
00521de6 : MOV EDX,dword ptr [ESP + 0x18]
00521dea : LEA ECX,[EAX + 0x10]
00521ded : MOV EAX,dword ptr [ECX]
00521def : MOV EAX,dword ptr [EAX + 0xc]
00521df2 : PUSH EBX
00521df3 : PUSH EBP
00521df4 : PUSH EDX
00521df5 : CALL EAX
00521df7 : POP EDI
00521df8 : POP ESI
00521df9 : POP EBP
00521dfa : POP EBX
00521dfb : RET 0x10
00521dfe : POP EDI
00521dff : POP ESI
00521e00 : POP EBP
00521e01 : XOR AL,AL
00521e03 : POP EBX
00521e04 : RET 0x10
