PROGRAM  : Maestia.exe
FUNCTION : FUN_0059a4d0
ENTRY    : 0059a4d0
BODY     : [[0059a4d0, 0059a644]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0059a4d0(void)

{
  uint uVar1;
  int *piVar2;
  int *piVar3;
  char cVar4;
  uint *puVar5;
  uint *in_ECX;
  undefined1 local_8 [4];
  undefined1 local_4 [4];
  
  if ((GRefCountNTSImpl *)in_ECX[0x14] != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release((GRefCountNTSImpl *)in_ECX[0x14]);
  }
  in_ECX[0x14] = 0;
  uVar1 = *in_ECX;
  if ((uVar1 != 0) && (uVar1 < in_ECX[1])) {
    if ((*(ushort *)(uVar1 + 6) >> 0xe & 1) != 0) {
      if ((*(ushort *)(uVar1 + 6) >> 0xd & 1) != 0) {
        piVar2 = *(int **)in_ECX[2];
        if (piVar2 != (int *)0x0) {
          *piVar2 = *piVar2 + 1;
        }
        piVar3 = (int *)in_ECX[0x13];
        if ((piVar3 != (int *)0x0) && (*piVar3 = *piVar3 + -1, *piVar3 == 0)) {
          FUN_00500860();
          FUN_00515cf0(piVar3);
        }
        in_ECX[0x13] = (uint)piVar2;
        in_ECX[2] = in_ECX[2] + 4;
      }
      if ((*(ushort *)(*in_ECX + 6) >> 0xc & 1) != 0) {
        uVar1 = *(uint *)in_ECX[2];
        in_ECX[0x10] = uVar1;
        in_ECX[0x11] = uVar1;
        in_ECX[2] = (uint)((uint *)in_ECX[2] + 1);
      }
      if ((*(ushort *)(*in_ECX + 6) >> 0xb & 1) != 0) {
        uVar1 = *(uint *)in_ECX[2];
        if (uVar1 != 0) {
          *(int *)(uVar1 + 4) = *(int *)(uVar1 + 4) + 1;
        }
        if ((GRefCountNTSImpl *)in_ECX[0x14] != (GRefCountNTSImpl *)0x0) {
          GRefCountNTSImpl::Release((GRefCountNTSImpl *)in_ECX[0x14]);
        }
        in_ECX[0x14] = uVar1;
        in_ECX[2] = in_ECX[2] + 4;
      }
    }
    if ((*(ushort *)(*in_ECX + 6) >> 10 & 1) == 0) {
      in_ECX[0x15] = 0;
    }
    else {
      in_ECX[0x15] = 1;
      in_ECX[0x12] = in_ECX[0x10];
    }
    cVar4 = FUN_005d2b10();
    if (cVar4 == '\0') {
      in_ECX[0x10] = in_ECX[0x11];
      if (((*(ushort *)(*in_ECX + 4) & 0xf000) == 0) && ((*(byte *)(*in_ECX + 6) >> 3 & 1) == 0)) {
        return;
      }
      if ((in_ECX[0xf] & 0x10) != 0) {
        puVar5 = (uint *)FUN_00502320(local_8);
        in_ECX[0x10] = *puVar5;
      }
      if (((byte)in_ECX[0xf] & 7) != 0) {
        in_ECX[0x15] = (byte)in_ECX[0xf] & 7;
      }
      if ((in_ECX[0xf] & 0x20) != 0) {
        puVar5 = (uint *)FUN_00502360(local_4);
        in_ECX[0x12] = *puVar5;
        return;
      }
    }
    else {
      if ((*(ushort *)(*in_ECX + 6) >> 10 & 1) == 0) {
        return;
      }
      in_ECX[0x15] = 1;
    }
    in_ECX[0x12] = in_ECX[0x10];
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
0059a4d0 : SUB ESP,0x8
0059a4d3 : PUSH ESI
0059a4d4 : MOV ESI,ECX
0059a4d6 : MOV ECX,dword ptr [ESI + 0x50]
0059a4d9 : TEST ECX,ECX
0059a4db : JZ 0x0059a4e2
0059a4dd : CALL 0x004ff7c0
0059a4e2 : MOV dword ptr [ESI + 0x50],0x0
0059a4e9 : MOV EAX,dword ptr [ESI]
0059a4eb : TEST EAX,EAX
0059a4ed : JZ 0x0059a640
0059a4f3 : CMP EAX,dword ptr [ESI + 0x4]
0059a4f6 : JNC 0x0059a640
0059a4fc : MOVZX EAX,word ptr [EAX + 0x6]
0059a500 : MOV ECX,EAX
0059a502 : SHR ECX,0xe
0059a505 : TEST CL,0x1
0059a508 : JZ 0x0059a590
0059a50e : SHR EAX,0xd
0059a511 : PUSH EDI
0059a512 : TEST AL,0x1
0059a514 : JZ 0x0059a544
0059a516 : MOV EDX,dword ptr [ESI + 0x8]
0059a519 : MOV EDI,dword ptr [EDX]
0059a51b : TEST EDI,EDI
0059a51d : JZ 0x0059a521
0059a51f : INC dword ptr [EDI]
0059a521 : PUSH EBP
0059a522 : MOV EBP,dword ptr [ESI + 0x4c]
0059a525 : TEST EBP,EBP
0059a527 : JZ 0x0059a53c
0059a529 : ADD dword ptr [EBP],-0x1
0059a52d : JNZ 0x0059a53c
0059a52f : MOV ECX,EBP
0059a531 : CALL 0x00500860
0059a536 : PUSH EBP
0059a537 : CALL 0x00515cf0
0059a53c : MOV dword ptr [ESI + 0x4c],EDI
0059a53f : ADD dword ptr [ESI + 0x8],0x4
0059a543 : POP EBP
0059a544 : MOV EDX,dword ptr [ESI]
0059a546 : MOV AX,word ptr [EDX + 0x6]
0059a54a : SHR AX,0xc
0059a54e : TEST AL,0x1
0059a550 : JZ 0x0059a563
0059a552 : MOV EAX,dword ptr [ESI + 0x8]
0059a555 : MOV ECX,dword ptr [EAX]
0059a557 : ADD EAX,0x4
0059a55a : MOV dword ptr [ESI + 0x40],ECX
0059a55d : MOV dword ptr [ESI + 0x44],ECX
0059a560 : MOV dword ptr [ESI + 0x8],EAX
0059a563 : MOV CX,word ptr [EDX + 0x6]
0059a567 : SHR CX,0xb
0059a56b : TEST CL,0x1
0059a56e : JZ 0x0059a58f
0059a570 : MOV EDX,dword ptr [ESI + 0x8]
0059a573 : MOV EDI,dword ptr [EDX]
0059a575 : TEST EDI,EDI
0059a577 : JZ 0x0059a57c
0059a579 : INC dword ptr [EDI + 0x4]
0059a57c : MOV ECX,dword ptr [ESI + 0x50]
0059a57f : TEST ECX,ECX
0059a581 : JZ 0x0059a588
0059a583 : CALL 0x004ff7c0
0059a588 : MOV dword ptr [ESI + 0x50],EDI
0059a58b : ADD dword ptr [ESI + 0x8],0x4
0059a58f : POP EDI
0059a590 : MOV EAX,dword ptr [ESI]
0059a592 : MOV CX,word ptr [EAX + 0x6]
0059a596 : SHR CX,0xa
0059a59a : TEST CL,0x1
0059a59d : JZ 0x0059a5ae
0059a59f : MOV EDX,dword ptr [ESI + 0x40]
0059a5a2 : MOV dword ptr [ESI + 0x54],0x1
0059a5a9 : MOV dword ptr [ESI + 0x48],EDX
0059a5ac : JMP 0x0059a5b5
0059a5ae : MOV dword ptr [ESI + 0x54],0x0
0059a5b5 : LEA ECX,[ESI + 0xc]
0059a5b8 : CALL 0x005d2b10
0059a5bd : TEST AL,AL
0059a5bf : JNZ 0x0059a624
0059a5c1 : MOV EAX,dword ptr [ESI + 0x44]
0059a5c4 : MOV dword ptr [ESI + 0x40],EAX
0059a5c7 : MOV EAX,dword ptr [ESI]
0059a5c9 : MOV ECX,0xf000
0059a5ce : TEST word ptr [EAX + 0x4],CX
0059a5d2 : JA 0x0059a5df
0059a5d4 : MOV DL,byte ptr [EAX + 0x6]
0059a5d7 : SHR DL,0x3
0059a5da : TEST DL,0x1
0059a5dd : JZ 0x0059a640
0059a5df : TEST byte ptr [ESI + 0x3c],0x10
0059a5e3 : JZ 0x0059a5f7
0059a5e5 : LEA EAX,[ESP + 0x4]
0059a5e9 : PUSH EAX
0059a5ea : LEA ECX,[ESI + 0x30]
0059a5ed : CALL 0x00502320
0059a5f2 : MOV ECX,dword ptr [EAX]
0059a5f4 : MOV dword ptr [ESI + 0x40],ECX
0059a5f7 : MOV AL,byte ptr [ESI + 0x3c]
0059a5fa : TEST AL,0x7
0059a5fc : JZ 0x0059a607
0059a5fe : MOVZX EDX,AL
0059a601 : AND EDX,0x7
0059a604 : MOV dword ptr [ESI + 0x54],EDX
0059a607 : TEST byte ptr [ESI + 0x3c],0x20
0059a60b : JZ 0x0059a63a
0059a60d : LEA EAX,[ESP + 0x8]
0059a611 : PUSH EAX
0059a612 : LEA ECX,[ESI + 0x30]
0059a615 : CALL 0x00502360
0059a61a : MOV ECX,dword ptr [EAX]
0059a61c : MOV dword ptr [ESI + 0x48],ECX
0059a61f : POP ESI
0059a620 : ADD ESP,0x8
0059a623 : RET
0059a624 : MOV EAX,dword ptr [ESI]
0059a626 : MOV CX,word ptr [EAX + 0x6]
0059a62a : SHR CX,0xa
0059a62e : TEST CL,0x1
0059a631 : JZ 0x0059a640
0059a633 : MOV dword ptr [ESI + 0x54],0x1
0059a63a : MOV EDX,dword ptr [ESI + 0x40]
0059a63d : MOV dword ptr [ESI + 0x48],EDX
0059a640 : POP ESI
0059a641 : ADD ESP,0x8
0059a644 : RET
