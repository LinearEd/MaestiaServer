PROGRAM  : Maestia.exe
FUNCTION : FUN_005084e0
ENTRY    : 005084e0
BODY     : [[005084e0, 005085ff]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005084e0(undefined4 param_1,undefined4 *param_2,uint param_3)

{
  uint *puVar1;
  int iVar2;
  int *piVar3;
  uint *puVar4;
  uint uVar5;
  int *in_ECX;
  int iVar6;
  uint uVar7;
  int iVar8;
  
  piVar3 = (int *)*in_ECX;
  if (piVar3 == (int *)0x0) {
    iVar8 = 8;
  }
  else {
    if ((uint)(*piVar3 * 5) <= piVar3[1] * 4 + 4U) goto LAB_0050851c;
    iVar8 = piVar3[1] * 2 + 2;
  }
  FUN_005072f0(param_1,iVar8);
LAB_0050851c:
  piVar3 = (int *)*in_ECX;
  param_3 = param_3 & piVar3[1];
  *piVar3 = *piVar3 + 1;
  iVar8 = *in_ECX;
  puVar1 = (uint *)(param_3 * 0x10 + 8 + iVar8);
  if (*puVar1 == 0xfffffffe) {
    *puVar1 = 0xffffffff;
    FUN_0051c2c0(*param_2);
    puVar4 = (uint *)param_2[1];
    uVar7 = *puVar4;
    if (uVar7 != 0) {
      piVar3 = (int *)(uVar7 + 4);
      *piVar3 = *piVar3 + 1;
    }
    puVar1[3] = *puVar4;
    puVar1[1] = param_3;
    return;
  }
  uVar7 = param_3;
  do {
    uVar7 = uVar7 + 1 & *(uint *)(iVar8 + 4);
  } while (*(int *)(iVar8 + 8 + uVar7 * 0x10) != -2);
  iVar2 = uVar7 * 0x10 + 8 + iVar8;
  if (puVar1[1] != param_3) {
    iVar6 = puVar1[1] * 0x10;
    uVar5 = *(uint *)(iVar6 + 8 + iVar8);
    while (puVar4 = (uint *)(iVar6 + 8 + iVar8), uVar5 != param_3) {
      iVar6 = *puVar4 * 0x10;
      uVar5 = *(uint *)(iVar6 + 8 + iVar8);
    }
    if (iVar2 != 0) {
      FUN_005035b0(puVar1);
    }
    *puVar4 = uVar7;
    FUN_005021e0(param_2);
    puVar1[1] = param_3;
    *puVar1 = 0xffffffff;
    return;
  }
  if (iVar2 != 0) {
    FUN_005035b0(puVar1);
  }
  FUN_005021e0(param_2);
  puVar1[1] = param_3;
  *puVar1 = uVar7;
  return;
}



============================================================
DISASSEMBLY
============================================================
005084e0 : PUSH EBX
005084e1 : PUSH EBP
005084e2 : PUSH ESI
005084e3 : MOV ESI,ECX
005084e5 : MOV EAX,dword ptr [ESI]
005084e7 : PUSH EDI
005084e8 : TEST EAX,EAX
005084ea : JNZ 0x005084f5
005084ec : MOV EAX,dword ptr [ESP + 0x14]
005084f0 : PUSH 0x8
005084f2 : PUSH EAX
005084f3 : JMP 0x00508517
005084f5 : MOV ECX,dword ptr [EAX + 0x4]
005084f8 : LEA EDX,[ECX*0x4 + 0x4]
005084ff : MOV ECX,dword ptr [EAX]
00508501 : LEA ECX,[ECX + ECX*0x4]
00508504 : CMP ECX,EDX
00508506 : JBE 0x0050851c
00508508 : MOV EDX,dword ptr [EAX + 0x4]
0050850b : MOV ECX,dword ptr [ESP + 0x14]
0050850f : LEA EAX,[EDX + EDX*0x1 + 0x2]
00508513 : PUSH EAX
00508514 : PUSH ECX
00508515 : MOV ECX,ESI
00508517 : CALL 0x005072f0
0050851c : MOV EAX,dword ptr [ESI]
0050851e : MOV EDI,dword ptr [ESP + 0x1c]
00508522 : AND EDI,dword ptr [EAX + 0x4]
00508525 : INC dword ptr [EAX]
00508527 : MOV EAX,dword ptr [ESI]
00508529 : MOV EDX,EDI
0050852b : SHL EDX,0x4
0050852e : LEA ESI,[EDX + EAX*0x1 + 0x8]
00508532 : MOV EDX,0xfffffffe
00508537 : CMP dword ptr [ESI],EDX
00508539 : JNZ 0x00508573
0050853b : MOV EBP,dword ptr [ESP + 0x18]
0050853f : MOV dword ptr [ESI],0xffffffff
00508545 : MOV EAX,dword ptr [EBP]
00508548 : LEA EBX,[ESI + 0x8]
0050854b : PUSH EAX
0050854c : MOV ECX,EBX
0050854e : MOV byte ptr [ESP + 0x18],0x0
00508553 : CALL 0x0051c2c0
00508558 : MOV ECX,dword ptr [EBP + 0x4]
0050855b : MOV EAX,dword ptr [ECX]
0050855d : TEST EAX,EAX
0050855f : JZ 0x00508564
00508561 : INC dword ptr [EAX + 0x4]
00508564 : MOV ECX,dword ptr [ECX]
00508566 : MOV dword ptr [EBX + 0x4],ECX
00508569 : MOV dword ptr [ESI + 0x4],EDI
0050856c : POP EDI
0050856d : POP ESI
0050856e : POP EBP
0050856f : POP EBX
00508570 : RET 0xc
00508573 : MOV ECX,dword ptr [EAX + 0x4]
00508576 : MOV EBX,EDI
00508578 : INC EBX
00508579 : AND EBX,ECX
0050857b : MOV EBP,EBX
0050857d : SHL EBP,0x4
00508580 : CMP dword ptr [EAX + EBP*0x1 + 0x8],EDX
00508584 : JNZ 0x00508578
00508586 : MOV EDX,EBX
00508588 : SHL EDX,0x4
0050858b : LEA ECX,[EDX + EAX*0x1 + 0x8]
0050858f : MOV EDX,dword ptr [ESI + 0x4]
00508592 : CMP EDX,EDI
00508594 : JNZ 0x005085b9
00508596 : TEST ECX,ECX
00508598 : JZ 0x005085a0
0050859a : PUSH ESI
0050859b : CALL 0x005035b0
005085a0 : MOV EAX,dword ptr [ESP + 0x18]
005085a4 : PUSH EAX
005085a5 : LEA ECX,[ESI + 0x8]
005085a8 : CALL 0x005021e0
005085ad : MOV dword ptr [ESI + 0x4],EDI
005085b0 : POP EDI
005085b1 : MOV dword ptr [ESI],EBX
005085b3 : POP ESI
005085b4 : POP EBP
005085b5 : POP EBX
005085b6 : RET 0xc
005085b9 : SHL EDX,0x4
005085bc : CMP dword ptr [EDX + EAX*0x1 + 0x8],EDI
005085c0 : LEA EBP,[EDX + EAX*0x1 + 0x8]
005085c4 : JZ 0x005085d6
005085c6 : MOV EDX,dword ptr [EBP]
005085c9 : SHL EDX,0x4
005085cc : CMP dword ptr [EDX + EAX*0x1 + 0x8],EDI
005085d0 : LEA EBP,[EDX + EAX*0x1 + 0x8]
005085d4 : JNZ 0x005085c6
005085d6 : TEST ECX,ECX
005085d8 : JZ 0x005085e0
005085da : PUSH ESI
005085db : CALL 0x005035b0
005085e0 : MOV EAX,dword ptr [ESP + 0x18]
005085e4 : PUSH EAX
005085e5 : LEA ECX,[ESI + 0x8]
005085e8 : MOV dword ptr [EBP],EBX
005085eb : CALL 0x005021e0
005085f0 : MOV dword ptr [ESI + 0x4],EDI
005085f3 : POP EDI
005085f4 : MOV dword ptr [ESI],0xffffffff
005085fa : POP ESI
005085fb : POP EBP
005085fc : POP EBX
005085fd : RET 0xc
