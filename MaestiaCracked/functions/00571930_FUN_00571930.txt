PROGRAM  : Maestia.exe
FUNCTION : FUN_00571930
ENTRY    : 00571930
BODY     : [[00571930, 00571a97]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00571930(uint param_1,undefined4 param_2,undefined4 param_3)

{
  bool bVar1;
  int iVar2;
  int iVar3;
  LONG LVar4;
  GRefCountImpl *this;
  uint uVar5;
  undefined1 local_8 [4];
  int local_4;
  
  uVar5 = param_1;
  bVar1 = false;
  if (param_1 != 0) {
    iVar2 = FUN_0054ed10();
    if ((iVar2 == 0) || (iVar2 = *(int *)(iVar2 + 0x1a0), iVar2 == -1)) {
      iVar2 = FUN_00515840(0x68,0);
      if (iVar2 == 0) {
        iVar2 = 0;
      }
      else {
        FUN_0051c480(param_2);
        iVar3 = *(int *)(uVar5 + 0x80);
        bVar1 = true;
        if (iVar3 == 0) {
          iVar3 = FUN_00520df0();
        }
        FUN_0051b6e0();
        *(undefined4 *)(iVar2 + 0x14) = 0;
        *(undefined1 *)(iVar2 + 0x1c) = 0;
        *(undefined1 *)(iVar2 + 0x2c) = 0;
        *(undefined1 *)(iVar2 + 0x3c) = 0;
        *(undefined4 *)(iVar2 + 0x4c) = 0;
        *(undefined1 *)(iVar2 + 0x50) = 0;
        *(undefined4 *)(iVar2 + 0x60) = 0;
        FUN_0056eaa0(4,iVar3,0xffffffff,&param_1,param_3,0);
      }
      if (bVar1) {
        uVar5 = param_1 & 0xfffffffc;
        LVar4 = InterlockedExchangeAdd((LONG *)(uVar5 + 4),-1);
        if (LVar4 == 1) {
          FUN_00515cf0(uVar5);
        }
      }
    }
    else {
      iVar3 = FUN_00515840(0x68,0);
      if (iVar3 == 0) {
        iVar2 = 0;
      }
      else {
        FUN_0051c480(param_2);
        iVar2 = FUN_0056ebb0(iVar2,local_8,param_3,1,0);
        FUN_0045b730();
      }
    }
    if (iVar2 != 0) {
      this = (GRefCountImpl *)(**(code **)(*(int *)(local_4 + 8) + 0xc))(0x17);
      if (this != (GRefCountImpl *)0x0) {
        GRefCountImpl::Release(this);
        FUN_00571350(iVar2);
        return;
      }
      FUN_0056a440(iVar2);
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00571930 : SUB ESP,0xc
00571933 : PUSH EBX
00571934 : PUSH ESI
00571935 : PUSH EDI
00571936 : MOV EDI,dword ptr [ESP + 0x1c]
0057193a : XOR EBX,EBX
0057193c : MOV ESI,ECX
0057193e : MOV dword ptr [ESP + 0x14],ESI
00571942 : MOV dword ptr [ESP + 0xc],EBX
00571946 : CMP EDI,EBX
00571948 : JZ 0x00571a8f
0057194e : PUSH EBP
0057194f : LEA ECX,[EDI + 0x68]
00571952 : CALL 0x0054ed10
00571957 : CMP EAX,EBX
00571959 : JZ 0x0057196a
0057195b : MOV EBP,dword ptr [EAX + 0x1a0]
00571961 : CMP EBP,-0x1
00571964 : JNZ 0x00571a03
0057196a : MOV ECX,dword ptr [ESI + 0x14]
0057196d : PUSH EBX
0057196e : PUSH 0x68
00571970 : CALL 0x00515840
00571975 : MOV ESI,EAX
00571977 : CMP ESI,EBX
00571979 : JZ 0x005719da
0057197b : MOV EAX,dword ptr [ESP + 0x24]
0057197f : PUSH EAX
00571980 : LEA ECX,[ESP + 0x24]
00571984 : CALL 0x0051c480
00571989 : MOV EAX,dword ptr [EDI + 0x80]
0057198f : MOV dword ptr [ESP + 0x10],0x1
00571997 : CMP EAX,EBX
00571999 : JNZ 0x005719a2
0057199b : MOV ECX,EDI
0057199d : CALL 0x00520df0
005719a2 : LEA ECX,[ESI + 0xc]
005719a5 : MOV EDI,EAX
005719a7 : CALL 0x0051b6e0
005719ac : MOV ECX,dword ptr [ESP + 0x28]
005719b0 : PUSH EBX
005719b1 : PUSH ECX
005719b2 : MOV dword ptr [ESI + 0x14],EBX
005719b5 : MOV byte ptr [ESI + 0x1c],BL
005719b8 : LEA EDX,[ESP + 0x28]
005719bc : PUSH EDX
005719bd : MOV byte ptr [ESI + 0x2c],BL
005719c0 : PUSH -0x1
005719c2 : MOV byte ptr [ESI + 0x3c],BL
005719c5 : MOV dword ptr [ESI + 0x4c],EBX
005719c8 : PUSH EDI
005719c9 : MOV byte ptr [ESI + 0x50],BL
005719cc : PUSH 0x4
005719ce : MOV ECX,ESI
005719d0 : MOV dword ptr [ESI + 0x60],EBX
005719d3 : CALL 0x0056eaa0
005719d8 : JMP 0x005719dc
005719da : XOR ESI,ESI
005719dc : TEST byte ptr [ESP + 0x10],0x1
005719e1 : JZ 0x00571a55
005719e3 : MOV EDI,dword ptr [ESP + 0x20]
005719e7 : AND EDI,0xfffffffc
005719ea : PUSH -0x1
005719ec : LEA EAX,[EDI + 0x4]
005719ef : PUSH EAX
005719f0 : CALL dword ptr [0x00b851cc]
005719f6 : SUB EAX,0x1
005719f9 : JNZ 0x00571a55
005719fb : PUSH EDI
005719fc : CALL 0x00515cf0
00571a01 : JMP 0x00571a55
00571a03 : MOV ECX,dword ptr [ESI + 0x14]
00571a06 : PUSH EBX
00571a07 : PUSH 0x68
00571a09 : CALL 0x00515840
00571a0e : MOV ESI,EAX
00571a10 : CMP ESI,EBX
00571a12 : JZ 0x00571a43
00571a14 : MOV ECX,dword ptr [ESP + 0x24]
00571a18 : PUSH ECX
00571a19 : LEA ECX,[ESP + 0x18]
00571a1d : CALL 0x0051c480
00571a22 : MOV EDX,dword ptr [ESP + 0x28]
00571a26 : PUSH EBX
00571a27 : PUSH 0x1
00571a29 : PUSH EDX
00571a2a : LEA EAX,[ESP + 0x20]
00571a2e : PUSH EAX
00571a2f : PUSH EBP
00571a30 : MOV ECX,ESI
00571a32 : MOV dword ptr [ESP + 0x24],0x2
00571a3a : CALL 0x0056ebb0
00571a3f : MOV ESI,EAX
00571a41 : JMP 0x00571a45
00571a43 : XOR ESI,ESI
00571a45 : TEST byte ptr [ESP + 0x10],0x2
00571a4a : JZ 0x00571a55
00571a4c : LEA ECX,[ESP + 0x14]
00571a50 : CALL 0x0045b730
00571a55 : POP EBP
00571a56 : CMP ESI,EBX
00571a58 : JZ 0x00571a8f
00571a5a : MOV EDI,dword ptr [ESP + 0x14]
00571a5e : MOV EDX,dword ptr [EDI + 0x8]
00571a61 : MOV EAX,dword ptr [EDX + 0xc]
00571a64 : LEA ECX,[EDI + 0x8]
00571a67 : PUSH 0x17
00571a69 : CALL EAX
00571a6b : CMP EAX,EBX
00571a6d : JZ 0x00571a87
00571a6f : MOV ECX,EAX
00571a71 : CALL 0x004ff7e0
00571a76 : PUSH ESI
00571a77 : MOV ECX,EDI
00571a79 : CALL 0x00571350
00571a7e : POP EDI
00571a7f : POP ESI
00571a80 : POP EBX
00571a81 : ADD ESP,0xc
00571a84 : RET 0xc
00571a87 : PUSH ESI
00571a88 : MOV ECX,EDI
00571a8a : CALL 0x0056a440
00571a8f : POP EDI
00571a90 : POP ESI
00571a91 : POP EBX
00571a92 : ADD ESP,0xc
00571a95 : RET 0xc
