PROGRAM  : Maestia.exe
FUNCTION : FUN_00ad07c0
ENTRY    : 00ad07c0
BODY     : [[00ad07c0, 00ad0b29]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __alloca_probe replaced with injection: alloca_probe */

void FUN_00ad07c0(void)

{
  WCHAR WVar1;
  WCHAR *pWVar2;
  LPCWSTR pWVar3;
  FILE *_File;
  int *piVar4;
  int iVar5;
  _SYSTEMTIME local_1868;
  int local_1858;
  LPCRITICAL_SECTION local_1854;
  char *local_1850;
  undefined4 local_184c;
  int local_1848;
  undefined4 local_1844;
  int *local_1840;
  undefined **local_183c;
  int local_1838;
  wchar_t local_1834 [1028];
  undefined4 local_102c;
  undefined4 local_101c;
  uint local_1018;
  wchar_t local_1014 [1024];
  WCHAR local_814;
  undefined1 local_812 [2046];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  uint local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b17552;
  local_10 = ExceptionList;
  local_14 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  DAT_00d6c8ec = DAT_00d6c8ec + 1;
  GetLocalTime(&local_1868);
  local_1848 = 0;
  local_1854 = (LPCRITICAL_SECTION)&DAT_00d722c8;
  local_1850 = ".\\MoMemTracer.cpp";
  local_184c = 0x8e;
  local_1844 = 1;
  FUN_006ef1a0(&local_1854);
  local_8 = 0;
  GetCurrentDirectoryW(0x400,&local_814);
  local_102c = (LPCWSTR)((uint)local_102c._2_2_ << 0x10);
  pWVar2 = &local_814;
  local_1018 = 7;
  local_101c = 0;
  do {
    WVar1 = *pWVar2;
    pWVar2 = pWVar2 + 1;
  } while (WVar1 != L'\0');
  FUN_00406360(&local_814,(int)pWVar2 - (int)local_812 >> 1);
  local_8._0_1_ = 1;
  FUN_00404870(L"\\memory",7);
  pWVar3 = local_102c;
  if (local_1018 < 8) {
    pWVar3 = (LPCWSTR)&local_102c;
  }
  CreateDirectoryW(pWVar3,(LPSECURITY_ATTRIBUTES)0x0);
  pWVar3 = local_102c;
  if (local_1018 < 8) {
    pWVar3 = (LPCWSTR)&local_102c;
  }
  _swprintf_s(local_1014,0x400,L"%s\\%s_%d_%d_%d_[%d_%d_%d].csv",pWVar3,L"Myth_Mem_Log.txt",
              (uint)local_1868.wYear,(uint)local_1868.wMonth,(uint)local_1868.wDay,
              (uint)local_1868.wHour,(uint)local_1868.wMinute,(uint)local_1868.wSecond);
  _File = __wfopen(local_1014,L"wt");
  if (_File == (FILE *)0x0) {
    local_8 = (uint)local_8._1_3_ << 8;
    if (7 < local_1018) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
  }
  else {
    local_183c = &PTR_FUN_00cd083c;
    local_1838 = 0x3ff;
    _wcscpy_s(local_1834,0x400,L"");
    local_8 = CONCAT31(local_8._1_3_,2);
    if (0x22 < local_1838) {
      _wcscpy_s(local_1834,0x400,L"Index,ZoneLoad,Size,File,Src,Alias\n");
    }
    _fwprintf(_File,local_1834);
    if (DAT_017244c4 != 0) {
      local_1858 = DAT_00d6c8ec + -1;
      local_1840 = (int *)*DAT_017244c0;
      iVar5 = 0;
      piVar4 = DAT_017244c0;
      if (local_1840 != DAT_017244c0) {
        do {
          if (local_1840[0x6f] == local_1858) {
            FUN_004ceb70(L"%d,%d,%d,%s,%s(%d),%s\n",iVar5,local_1840[0x6f],local_1840[5],
                         local_1840 + 8,local_1840 + 0x2a,local_1840[0x4a],local_1840 + 0x4e);
            _fwprintf(_File,local_1834);
            piVar4 = DAT_017244c0;
          }
          FUN_004cf140();
          iVar5 = iVar5 + 1;
        } while (local_1840 != piVar4);
      }
    }
    _fflush(_File);
    _fclose(_File);
    local_183c = &PTR_FUN_00cd083c;
    local_8 = local_8 & 0xffffff00;
    if (7 < local_1018) {
                    /* WARNING: Subroutine does not return */
      FUN_006f04e0();
    }
  }
  local_102c = (LPCWSTR)((uint)local_102c & 0xffff0000);
  local_8 = 0xffffffff;
  local_101c = 0;
  local_1018 = 7;
  if (local_1848 != 0) {
    local_8 = 0xffffffff;
    local_1018 = 7;
    local_101c = 0;
    LeaveCriticalSection(local_1854);
    local_1848 = 0;
  }
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00ad07c0 : PUSH EBP
00ad07c1 : MOV EBP,ESP
00ad07c3 : PUSH -0x1
00ad07c5 : PUSH 0xb17552
00ad07ca : MOV EAX,FS:[0x0]
00ad07d0 : PUSH EAX
00ad07d1 : MOV EAX,0x185c
00ad07d6 : CALL 0x0063b780
00ad07db : MOV EAX,[0x00d66fa0]
00ad07e0 : XOR EAX,EBP
00ad07e2 : MOV dword ptr [EBP + -0x10],EAX
00ad07e5 : PUSH EBX
00ad07e6 : PUSH ESI
00ad07e7 : PUSH EDI
00ad07e8 : PUSH EAX
00ad07e9 : LEA EAX,[EBP + -0xc]
00ad07ec : MOV FS:[0x0],EAX
00ad07f2 : LEA EAX,[EBP + 0xffffe79c]
00ad07f8 : MOV ESI,0x1
00ad07fd : ADD dword ptr [0x00d6c8ec],ESI
00ad0803 : PUSH EAX
00ad0804 : CALL dword ptr [0x00b85154]
00ad080a : LEA ECX,[EBP + 0xffffe7b0]
00ad0810 : XOR EBX,EBX
00ad0812 : PUSH ECX
00ad0813 : MOV dword ptr [EBP + 0xffffe7bc],EBX
00ad0819 : MOV dword ptr [EBP + 0xffffe7b0],0xd722c8
00ad0823 : MOV dword ptr [EBP + 0xffffe7b4],0xbfcf70
00ad082d : MOV dword ptr [EBP + 0xffffe7b8],0x8e
00ad0837 : MOV dword ptr [EBP + 0xffffe7c0],ESI
00ad083d : CALL 0x006ef1a0
00ad0842 : MOV dword ptr [EBP + -0x4],EBX
00ad0845 : LEA EDX,[EBP + 0xfffff7f0]
00ad084b : PUSH EDX
00ad084c : PUSH 0x400
00ad0851 : CALL dword ptr [0x00b851d4]
00ad0857 : XOR EAX,EAX
00ad0859 : MOV word ptr [EBP + 0xffffefd8],AX
00ad0860 : LEA EAX,[EBP + 0xfffff7f0]
00ad0866 : MOV dword ptr [EBP + 0xffffefec],0x7
00ad0870 : MOV dword ptr [EBP + 0xffffefe8],EBX
00ad0876 : LEA EDX,[EAX + 0x2]
00ad0879 : LEA ESP,[ESP]
00ad0880 : MOV CX,word ptr [EAX]
00ad0883 : ADD EAX,0x2
00ad0886 : CMP CX,BX
00ad0889 : JNZ 0x00ad0880
00ad088b : SUB EAX,EDX
00ad088d : SAR EAX,0x1
00ad088f : PUSH EAX
00ad0890 : LEA ECX,[EBP + 0xfffff7f0]
00ad0896 : PUSH ECX
00ad0897 : LEA ECX,[EBP + 0xffffefd4]
00ad089d : CALL 0x00406360
00ad08a2 : MOV byte ptr [EBP + -0x4],0x1
00ad08a6 : PUSH 0x7
00ad08a8 : PUSH 0xbfcf84
00ad08ad : LEA ESI,[EBP + 0xffffefd4]
00ad08b3 : CALL 0x00404870
00ad08b8 : MOV EAX,dword ptr [EBP + 0xffffefd8]
00ad08be : MOV ESI,0x8
00ad08c3 : CMP dword ptr [EBP + 0xffffefec],ESI
00ad08c9 : JNC 0x00ad08d1
00ad08cb : LEA EAX,[EBP + 0xffffefd8]
00ad08d1 : PUSH EBX
00ad08d2 : PUSH EAX
00ad08d3 : CALL dword ptr [0x00b851bc]
00ad08d9 : MOV EAX,dword ptr [EBP + 0xffffefd8]
00ad08df : CMP dword ptr [EBP + 0xffffefec],ESI
00ad08e5 : JNC 0x00ad08ed
00ad08e7 : LEA EAX,[EBP + 0xffffefd8]
00ad08ed : MOVZX EDX,word ptr [EBP + 0xffffe7a8]
00ad08f4 : MOVZX ECX,word ptr [EBP + 0xffffe7a6]
00ad08fb : PUSH EDX
00ad08fc : MOVZX EDX,word ptr [EBP + 0xffffe7a4]
00ad0903 : PUSH ECX
00ad0904 : MOVZX ECX,word ptr [EBP + 0xffffe7a2]
00ad090b : PUSH EDX
00ad090c : MOVZX EDX,word ptr [EBP + 0xffffe79e]
00ad0913 : PUSH ECX
00ad0914 : MOVZX ECX,word ptr [EBP + 0xffffe79c]
00ad091b : PUSH EDX
00ad091c : PUSH ECX
00ad091d : PUSH 0xc8cca4
00ad0922 : PUSH EAX
00ad0923 : PUSH 0xbfcf94
00ad0928 : LEA EDX,[EBP + 0xffffeff0]
00ad092e : PUSH 0x400
00ad0933 : PUSH EDX
00ad0934 : CALL 0x00635d51
00ad0939 : LEA EAX,[EBP + 0xffffeff0]
00ad093f : PUSH 0xbfcfd0
00ad0944 : PUSH EAX
00ad0945 : CALL 0x00636404
00ad094a : MOV EDI,EAX
00ad094c : ADD ESP,0x34
00ad094f : CMP EDI,EBX
00ad0951 : JNZ 0x00ad09a2
00ad0953 : MOV byte ptr [EBP + -0x4],0x0
00ad0957 : CMP dword ptr [EBP + 0xffffefec],ESI
00ad095d : JC 0x00ad096a
00ad095f : MOV ECX,dword ptr [EBP + 0xffffefd8]
00ad0965 : CALL 0x006f04e0
00ad096a : XOR ECX,ECX
00ad096c : MOV dword ptr [EBP + 0xffffefec],0x7
00ad0976 : MOV dword ptr [EBP + 0xffffefe8],EBX
00ad097c : MOV word ptr [EBP + 0xffffefd8],CX
00ad0983 : MOV dword ptr [EBP + -0x4],0xffffffff
00ad098a : CMP dword ptr [EBP + 0xffffe7bc],EBX
00ad0990 : JZ 0x00ad0b0e
00ad0996 : MOV EDX,dword ptr [EBP + 0xffffe7b0]
00ad099c : PUSH EDX
00ad099d : JMP 0x00ad0b02
00ad09a2 : PUSH 0xcca49c
00ad09a7 : LEA EAX,[EBP + 0xffffe7d0]
00ad09ad : PUSH 0x400
00ad09b2 : PUSH EAX
00ad09b3 : MOV dword ptr [EBP + 0xffffe7c8],0xcd083c
00ad09bd : MOV dword ptr [EBP + 0xffffe7cc],0x3ff
00ad09c7 : CALL 0x0063481b
00ad09cc : ADD ESP,0xc
00ad09cf : MOV byte ptr [EBP + -0x4],0x2
00ad09d3 : CMP dword ptr [EBP + 0xffffe7cc],0x23
00ad09da : JL 0x00ad09f5
00ad09dc : PUSH 0xbfcfd8
00ad09e1 : LEA ECX,[EBP + 0xffffe7d0]
00ad09e7 : PUSH 0x400
00ad09ec : PUSH ECX
00ad09ed : CALL 0x0063481b
00ad09f2 : ADD ESP,0xc
00ad09f5 : LEA EDX,[EBP + 0xffffe7d0]
00ad09fb : PUSH EDX
00ad09fc : PUSH EDI
00ad09fd : CALL 0x006372ee
00ad0a02 : ADD ESP,0x8
00ad0a05 : CMP dword ptr [0x017244c4],EBX
00ad0a0b : JZ 0x00ad0a9f
00ad0a11 : MOV EAX,[0x00d6c8ec]
00ad0a16 : MOV EBX,dword ptr [0x017244c0]
00ad0a1c : DEC EAX
00ad0a1d : MOV dword ptr [EBP + 0xffffe7ac],EAX
00ad0a23 : MOV EAX,dword ptr [EBX]
00ad0a25 : XOR ESI,ESI
00ad0a27 : MOV dword ptr [EBP + 0xffffe7c4],EAX
00ad0a2d : CMP EAX,EBX
00ad0a2f : JZ 0x00ad0a9a
00ad0a31 : MOV ECX,dword ptr [EAX + 0x1bc]
00ad0a37 : CMP ECX,dword ptr [EBP + 0xffffe7ac]
00ad0a3d : JNZ 0x00ad0a84
00ad0a3f : LEA EDX,[EAX + 0x138]
00ad0a45 : PUSH EDX
00ad0a46 : MOV EDX,dword ptr [EAX + 0x128]
00ad0a4c : PUSH EDX
00ad0a4d : LEA EDX,[EAX + 0xa8]
00ad0a53 : PUSH EDX
00ad0a54 : LEA EDX,[EAX + 0x20]
00ad0a57 : MOV EAX,dword ptr [EAX + 0x14]
00ad0a5a : PUSH EDX
00ad0a5b : PUSH EAX
00ad0a5c : PUSH ECX
00ad0a5d : PUSH ESI
00ad0a5e : PUSH 0xbfd020
00ad0a63 : LEA ECX,[EBP + 0xffffe7c8]
00ad0a69 : CALL 0x004ceb70
00ad0a6e : LEA ECX,[EBP + 0xffffe7d0]
00ad0a74 : PUSH ECX
00ad0a75 : PUSH EDI
00ad0a76 : CALL 0x006372ee
00ad0a7b : MOV EBX,dword ptr [0x017244c0]
00ad0a81 : ADD ESP,0x28
00ad0a84 : LEA EDX,[EBP + 0xffffe7c4]
00ad0a8a : CALL 0x004cf140
00ad0a8f : MOV EAX,dword ptr [EBP + 0xffffe7c4]
00ad0a95 : INC ESI
00ad0a96 : CMP EAX,EBX
00ad0a98 : JNZ 0x00ad0a31
00ad0a9a : XOR EBX,EBX
00ad0a9c : LEA ESI,[EBX + 0x8]
00ad0a9f : PUSH EDI
00ad0aa0 : CALL 0x006395f7
00ad0aa5 : PUSH EDI
00ad0aa6 : CALL 0x006366db
00ad0aab : ADD ESP,0x8
00ad0aae : MOV byte ptr [EBP + -0x4],0x1
00ad0ab2 : MOV dword ptr [EBP + 0xffffe7c8],0xcd083c
00ad0abc : MOV byte ptr [EBP + -0x4],0x0
00ad0ac0 : CMP dword ptr [EBP + 0xffffefec],ESI
00ad0ac6 : JC 0x00ad0ad3
00ad0ac8 : MOV ECX,dword ptr [EBP + 0xffffefd8]
00ad0ace : CALL 0x006f04e0
00ad0ad3 : XOR EDX,EDX
00ad0ad5 : MOV dword ptr [EBP + 0xffffefec],0x7
00ad0adf : MOV dword ptr [EBP + 0xffffefe8],EBX
00ad0ae5 : MOV word ptr [EBP + 0xffffefd8],DX
00ad0aec : MOV dword ptr [EBP + -0x4],0xffffffff
00ad0af3 : CMP dword ptr [EBP + 0xffffe7bc],EBX
00ad0af9 : JZ 0x00ad0b0e
00ad0afb : MOV EAX,dword ptr [EBP + 0xffffe7b0]
00ad0b01 : PUSH EAX
00ad0b02 : CALL dword ptr [0x00b8511c]
00ad0b08 : MOV dword ptr [EBP + 0xffffe7bc],EBX
00ad0b0e : MOV ECX,dword ptr [EBP + -0xc]
00ad0b11 : MOV dword ptr FS:[0x0],ECX
00ad0b18 : POP ECX
00ad0b19 : POP EDI
00ad0b1a : POP ESI
00ad0b1b : POP EBX
00ad0b1c : MOV ECX,dword ptr [EBP + -0x10]
00ad0b1f : XOR ECX,EBP
00ad0b21 : CALL 0x00633e6b
00ad0b26 : MOV ESP,EBP
00ad0b28 : POP EBP
00ad0b29 : RET
