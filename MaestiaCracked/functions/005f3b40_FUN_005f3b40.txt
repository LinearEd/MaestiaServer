PROGRAM  : Maestia.exe
FUNCTION : FUN_005f3b40
ENTRY    : 005f3b40
BODY     : [[005f3b40, 005f3cd5]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005f3b40(uint param_1,uint param_2,uint param_3,uint param_4,int param_5,int param_6,
                 ulong param_7)

{
  float fVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  GImage *this;
  byte bVar5;
  int *in_ECX;
  uint uVar6;
  int iVar7;
  byte bVar8;
  
  FUN_005f2bf0();
  bVar8 = 0;
  in_ECX[7] = 0;
  in_ECX[0xc] = 0;
  in_ECX[0xb1] = 0;
  in_ECX[0xb2] = 0;
  in_ECX[0xb3] = 0;
  FUN_005f2a90();
  uVar2 = param_4;
  if (param_1 < 0x40) {
    uVar3 = 0x3f;
  }
  else {
    uVar3 = param_1 - 1;
  }
  uVar6 = 0x3f;
  if (0x3f < param_2) {
    uVar6 = param_2 - 1;
  }
  bVar5 = 0;
  for (; uVar3 != 0; uVar3 = uVar3 >> 1) {
    bVar5 = bVar5 + 1;
  }
  for (; uVar6 != 0; uVar6 = uVar6 >> 1) {
    bVar8 = bVar8 + 1;
  }
  uVar3 = param_3;
  if (0x20 < param_3) {
    uVar3 = 0x20;
  }
  iVar4 = 1 << (bVar5 & 0x1f);
  iVar7 = 1 << (bVar8 & 0x1f);
  fVar1 = (float)iVar4;
  *in_ECX = iVar4;
  in_ECX[1] = iVar7;
  in_ECX[2] = uVar3;
  in_ECX[3] = param_4;
  in_ECX[4] = param_5;
  if (iVar4 < 0) {
    fVar1 = fVar1 + 4.2949673e+09;
  }
  in_ECX[5] = (int)(1.0 / fVar1);
  fVar1 = (float)iVar7;
  if (iVar7 < 0) {
    fVar1 = fVar1 + 4.2949673e+09;
  }
  param_3 = 3;
  in_ECX[6] = (int)(1.0 / fVar1);
  this = (GImage *)FUN_00515d60(in_ECX,0x30,&param_3);
  if (this == (GImage *)0x0) {
    param_3 = 0;
  }
  else {
    param_3 = GImage::GImage(this,9,param_6 + 3U & 0xfffffffc,param_7);
  }
  if ((GRefCountNTSImpl *)in_ECX[0xae] != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release((GRefCountNTSImpl *)in_ECX[0xae]);
  }
  in_ECX[0xae] = param_3;
  in_ECX[0xaf] = param_6;
  in_ECX[0xb0] = param_7;
  in_ECX[0xb1] = 0;
  in_ECX[0xb2] = 0;
  in_ECX[0xb3] = 0;
  FUN_005f2a90();
  in_ECX[0x1c7] = param_1;
  in_ECX[0x1c8] = param_2;
  param_2 = param_2 / uVar2;
  in_ECX[0x1c5] = 0;
  in_ECX[0x1c6] = uVar3;
  in_ECX[0x1c9] = uVar2;
  in_ECX[0x1ca] = param_2;
  iVar4 = param_2 * uVar3;
  FUN_005f1aa0(iVar4,0);
  in_ECX[0x1e3] = iVar4;
  return;
}



============================================================
DISASSEMBLY
============================================================
005f3b40 : PUSH EBX
005f3b41 : PUSH EBP
005f3b42 : PUSH ESI
005f3b43 : PUSH EDI
005f3b44 : MOV ESI,ECX
005f3b46 : CALL 0x005f2bf0
005f3b4b : XOR EBP,EBP
005f3b4d : MOV dword ptr [ESI + 0x1c],EBP
005f3b50 : MOV dword ptr [ESI + 0x30],EBP
005f3b53 : LEA EDI,[ESI + 0x710]
005f3b59 : MOV ECX,EDI
005f3b5b : MOV dword ptr [ESI + 0x2c4],EBP
005f3b61 : MOV dword ptr [ESI + 0x2c8],EBP
005f3b67 : MOV dword ptr [ESI + 0x2cc],EBP
005f3b6d : CALL 0x005f2a90
005f3b72 : MOV EAX,dword ptr [ESP + 0x14]
005f3b76 : CMP EAX,0x40
005f3b79 : JNC 0x005f3b80
005f3b7b : LEA EAX,[EBP + 0x3f]
005f3b7e : JMP 0x005f3b81
005f3b80 : DEC EAX
005f3b81 : MOV ECX,dword ptr [ESP + 0x18]
005f3b85 : MOV EDX,0x3f
005f3b8a : CMP ECX,0x40
005f3b8d : JC 0x005f3b92
005f3b8f : LEA EDX,[ECX + -0x1]
005f3b92 : XOR ECX,ECX
005f3b94 : CMP EAX,EBP
005f3b96 : JZ 0x005f3b9d
005f3b98 : INC ECX
005f3b99 : SHR EAX,0x1
005f3b9b : JNZ 0x005f3b98
005f3b9d : CMP EDX,EBP
005f3b9f : JZ 0x005f3ba6
005f3ba1 : INC EBP
005f3ba2 : SHR EDX,0x1
005f3ba4 : JNZ 0x005f3ba1
005f3ba6 : MOV EBX,dword ptr [ESP + 0x1c]
005f3baa : CMP EBX,0x20
005f3bad : JBE 0x005f3bb4
005f3baf : MOV EBX,0x20
005f3bb4 : MOV EAX,0x1
005f3bb9 : SHL EAX,CL
005f3bbb : MOV ECX,EBP
005f3bbd : MOV EBP,dword ptr [ESP + 0x20]
005f3bc1 : MOV EDX,0x1
005f3bc6 : SHL EDX,CL
005f3bc8 : MOV ECX,dword ptr [ESP + 0x24]
005f3bcc : MOV dword ptr [ESP + 0x1c],EAX
005f3bd0 : FILD dword ptr [ESP + 0x1c]
005f3bd4 : MOV dword ptr [ESI],EAX
005f3bd6 : MOV dword ptr [ESI + 0x4],EDX
005f3bd9 : MOV dword ptr [ESI + 0x8],EBX
005f3bdc : MOV dword ptr [ESI + 0xc],EBP
005f3bdf : MOV dword ptr [ESI + 0x10],ECX
005f3be2 : TEST EAX,EAX
005f3be4 : JGE 0x005f3bec
005f3be6 : FADD float ptr [0x00cdf0e0]
005f3bec : FLD1
005f3bee : MOV dword ptr [ESP + 0x1c],EDX
005f3bf2 : FLD ST0
005f3bf4 : FDIVRP ST2,ST0
005f3bf6 : FXCH
005f3bf8 : FSTP float ptr [ESI + 0x14]
005f3bfb : FILD dword ptr [ESP + 0x1c]
005f3bff : TEST EDX,EDX
005f3c01 : JGE 0x005f3c09
005f3c03 : FADD float ptr [0x00cdf0e0]
005f3c09 : FDIVP
005f3c0b : LEA EDX,[ESP + 0x1c]
005f3c0f : PUSH EDX
005f3c10 : PUSH 0x30
005f3c12 : PUSH ESI
005f3c13 : MOV dword ptr [ESP + 0x28],0x3
005f3c1b : FSTP float ptr [ESI + 0x18]
005f3c1e : CALL 0x00515d60
005f3c23 : TEST EAX,EAX
005f3c25 : JZ 0x005f3c46
005f3c27 : MOV EDX,dword ptr [ESP + 0x28]
005f3c2b : MOV ECX,dword ptr [ESP + 0x2c]
005f3c2f : PUSH ECX
005f3c30 : ADD EDX,0x3
005f3c33 : AND EDX,0xfffffffc
005f3c36 : PUSH EDX
005f3c37 : PUSH 0x9
005f3c39 : MOV ECX,EAX
005f3c3b : CALL 0x005199d0
005f3c40 : MOV dword ptr [ESP + 0x1c],EAX
005f3c44 : JMP 0x005f3c4e
005f3c46 : MOV dword ptr [ESP + 0x1c],0x0
005f3c4e : MOV ECX,dword ptr [ESI + 0x2b8]
005f3c54 : TEST ECX,ECX
005f3c56 : JZ 0x005f3c5d
005f3c58 : CALL 0x004ff7c0
005f3c5d : MOV EAX,dword ptr [ESP + 0x1c]
005f3c61 : MOV EDX,dword ptr [ESP + 0x28]
005f3c65 : MOV dword ptr [ESI + 0x2b8],EAX
005f3c6b : MOV dword ptr [ESI + 0x2bc],EDX
005f3c71 : MOV EDX,dword ptr [ESP + 0x2c]
005f3c75 : XOR EAX,EAX
005f3c77 : MOV dword ptr [ESI + 0x2c0],EDX
005f3c7d : XOR ECX,ECX
005f3c7f : MOV dword ptr [ESI + 0x2c4],EAX
005f3c85 : MOV dword ptr [ESI + 0x2c8],ECX
005f3c8b : MOV ECX,EDI
005f3c8d : MOV dword ptr [ESI + 0x2cc],EAX
005f3c93 : CALL 0x005f2a90
005f3c98 : MOV EAX,dword ptr [ESP + 0x14]
005f3c9c : MOV dword ptr [EDI + 0xc],EAX
005f3c9f : MOV EAX,dword ptr [ESP + 0x18]
005f3ca3 : MOV dword ptr [EDI + 0x10],EAX
005f3ca6 : XOR EDX,EDX
005f3ca8 : DIV EBP
005f3caa : MOV dword ptr [EDI + 0x4],0x0
005f3cb1 : MOV dword ptr [EDI + 0x8],EBX
005f3cb4 : MOV dword ptr [EDI + 0x14],EBP
005f3cb7 : PUSH 0x0
005f3cb9 : ADD EDI,0x78
005f3cbc : MOV ECX,EDI
005f3cbe : MOV dword ptr [EDI + -0x60],EAX
005f3cc1 : IMUL EAX,EBX
005f3cc4 : MOV ESI,EAX
005f3cc6 : PUSH ESI
005f3cc7 : CALL 0x005f1aa0
005f3ccc : MOV dword ptr [EDI + 0x4],ESI
005f3ccf : POP EDI
005f3cd0 : POP ESI
005f3cd1 : POP EBP
005f3cd2 : POP EBX
005f3cd3 : RET 0x1c
