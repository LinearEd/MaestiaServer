PROGRAM  : Maestia.exe
FUNCTION : FUN_006afd10
ENTRY    : 006afd10
BODY     : [[006afd10, 006b00c5]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_006afd10(int param_1,int *param_2)

{
  byte bVar1;
  byte bVar2;
  byte *pbVar3;
  int iVar4;
  bool bVar5;
  int iVar6;
  undefined4 uVar7;
  int iVar8;
  byte *pbVar9;
  int iStack_10;
  byte *local_c;
  int iStack_8;
  undefined4 *local_4;
  
  local_4 = *(undefined4 **)(param_1 + 0x1e4);
  pbVar3 = (byte *)param_2[2];
  local_c = pbVar3;
  (*(code *)param_2[7])(param_2);
  pbVar9 = (byte *)*param_2;
  if (pbVar3 <= pbVar9) {
    param_2[3] = 3;
    return;
  }
  bVar1 = *pbVar9;
  if ((9 < bVar1 - 0x30) && (bVar1 != 0x5b)) {
    if ((pbVar9 + 0x11 < pbVar3) &&
       (iVar6 = _strncmp((char *)pbVar9,"StandardEncoding",0x10), iVar6 == 0)) {
      *(undefined4 *)(param_1 + 0x16c) = 2;
      return;
    }
    if ((pbVar9 + 0xf < pbVar3) &&
       (iVar6 = _strncmp((char *)pbVar9,"ExpertEncoding",0xe), iVar6 == 0)) {
      *(undefined4 *)(param_1 + 0x16c) = 4;
      return;
    }
    if ((pbVar9 + 0x12 < pbVar3) &&
       (iVar6 = _strncmp((char *)pbVar9,"ISOLatin1Encoding",0x11), iVar6 == 0)) {
      *(undefined4 *)(param_1 + 0x16c) = 3;
      return;
    }
    param_2[3] = 0xa2;
    return;
  }
  iVar6 = param_2[4];
  if (bVar1 != 0x5b) {
    iStack_8 = (*(code *)param_2[9])(param_2);
  }
  else {
    iStack_8 = 0x100;
    *param_2 = (int)(pbVar9 + 1);
  }
  iVar8 = iStack_8;
  bVar5 = bVar1 == 0x5b;
  (*(code *)param_2[7])(param_2);
  if ((byte *)*param_2 < local_c) {
    *(int *)(param_1 + 0x170) = iVar8;
    param_2[0x18] = iVar8;
    uVar7 = FUN_0068a220(iVar6,2,0,iVar8,0,&iStack_10);
    *(undefined4 *)(param_1 + 0x17c) = uVar7;
    if (iStack_10 == 0) {
      uVar7 = FUN_0068a220(iVar6,4,0,iVar8,0,&iStack_10);
      *(undefined4 *)(param_1 + 0x180) = uVar7;
      if ((iStack_10 == 0) &&
         (iStack_10 = (**(code **)*local_4)(param_2 + 0x19,iVar8,iVar6), iStack_10 == 0)) {
        iVar6 = 0;
        iStack_10 = 0;
        if (0 < iVar8) {
          do {
            (*(code *)param_2[0x24])(param_2 + 0x19,iVar6,".notdef",8);
            iVar6 = iVar6 + 1;
          } while (iVar6 < iVar8);
        }
        iVar6 = 0;
        local_4 = (undefined4 *)0x0;
        (*(code *)param_2[7])(param_2);
        if ((byte *)*param_2 < local_c) {
          while( true ) {
            pbVar9 = (byte *)*param_2;
            bVar1 = *pbVar9;
            if (((((bVar1 == 100) && (pbVar9 + 3 < local_c)) && (pbVar9[1] == 0x65)) &&
                (pbVar9[2] == 0x66)) &&
               (((((bVar2 = pbVar9[3], bVar2 == 0x20 || (bVar2 == 0xd)) ||
                  ((bVar2 == 10 || ((bVar2 == 9 || (bVar2 == 0xc)))))) ||
                 ((bVar2 == 0 || (((bVar2 == 0x2f || (bVar2 == 0x28)) || (bVar2 == 0x29)))))) ||
                (((bVar2 == 0x3c || (bVar2 == 0x3e)) ||
                 ((((bVar2 == 0x5b || ((bVar2 == 0x5d || (bVar2 == 0x7b)))) || (bVar2 == 0x7d)) ||
                  (bVar2 == 0x25)))))))) {
              *(undefined4 *)(param_1 + 0x16c) = 1;
              *param_2 = (int)(pbVar9 + 3);
              return;
            }
            if (bVar1 == 0x5d) break;
            iVar8 = iVar6;
            if (bVar1 - 0x30 < 10) {
              if (!bVar5) {
                iVar8 = (*(code *)param_2[9])(param_2);
                (*(code *)param_2[7])(param_2);
              }
LAB_006affff:
              pbVar9 = (byte *)*param_2;
              if (((*pbVar9 == 0x2f) && (pbVar9 + 2 < local_c)) && (iVar6 < iStack_8)) {
                pbVar9 = pbVar9 + 1;
                *param_2 = (int)pbVar9;
                (*(code *)param_2[8])(param_2);
                if (param_2[3] != 0) {
                  return;
                }
                iVar4 = *param_2;
                iVar6 = (*(code *)param_2[0x24])
                                  (param_2 + 0x19,iVar8,pbVar9,(iVar4 - (int)pbVar9) + 1);
                param_2[3] = iVar6;
                if (iVar6 != 0) {
                  return;
                }
                iVar6 = (int)local_4 + 1;
                *(undefined1 *)((iVar4 - (int)pbVar9) + *(int *)(param_2[0x1f] + iVar8 * 4)) = 0;
                local_4 = (undefined4 *)iVar6;
              }
            }
            else {
              if (bVar5) goto LAB_006affff;
              (*(code *)param_2[8])(param_2);
              if (param_2[3] != 0) {
                return;
              }
            }
            (*(code *)param_2[7])(param_2);
            if (local_c <= (byte *)*param_2) {
              *(undefined4 *)(param_1 + 0x16c) = 1;
              *param_2 = (int)pbVar9;
              return;
            }
          }
          pbVar9 = pbVar9 + 1;
        }
        *(undefined4 *)(param_1 + 0x16c) = 1;
        *param_2 = (int)pbVar9;
        return;
      }
    }
    param_2[3] = iStack_10;
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
006afd10 : SUB ESP,0x10
006afd13 : PUSH EBX
006afd14 : MOV EBX,dword ptr [ESP + 0x18]
006afd18 : MOV EAX,dword ptr [EBX + 0x1e4]
006afd1e : PUSH EBP
006afd1f : PUSH ESI
006afd20 : MOV ESI,dword ptr [ESP + 0x24]
006afd24 : MOV ECX,dword ptr [ESI + 0x1c]
006afd27 : PUSH EDI
006afd28 : MOV EDI,dword ptr [ESI + 0x8]
006afd2b : PUSH ESI
006afd2c : MOV dword ptr [ESP + 0x18],EDI
006afd30 : MOV dword ptr [ESP + 0x20],EAX
006afd34 : CALL ECX
006afd36 : MOV EBP,dword ptr [ESI]
006afd38 : ADD ESP,0x4
006afd3b : CMP EBP,EDI
006afd3d : JC 0x006afd4e
006afd3f : POP EDI
006afd40 : MOV dword ptr [ESI + 0xc],0x3
006afd47 : POP ESI
006afd48 : POP EBP
006afd49 : POP EBX
006afd4a : ADD ESP,0x10
006afd4d : RET
006afd4e : MOV AL,byte ptr [EBP]
006afd51 : MOVZX EDX,AL
006afd54 : SUB EDX,0x30
006afd57 : CMP EDX,0xa
006afd5a : JC 0x006afdfe
006afd60 : CMP AL,0x5b
006afd62 : JZ 0x006afdfe
006afd68 : LEA EAX,[EBP + 0x11]
006afd6b : CMP EAX,EDI
006afd6d : JNC 0x006afd95
006afd6f : PUSH 0x10
006afd71 : PUSH 0xbe96a8
006afd76 : PUSH EBP
006afd77 : CALL 0x0063abcb
006afd7c : ADD ESP,0xc
006afd7f : TEST EAX,EAX
006afd81 : JNZ 0x006afd95
006afd83 : POP EDI
006afd84 : POP ESI
006afd85 : POP EBP
006afd86 : MOV dword ptr [EBX + 0x16c],0x2
006afd90 : POP EBX
006afd91 : ADD ESP,0x10
006afd94 : RET
006afd95 : LEA ECX,[EBP + 0xf]
006afd98 : CMP ECX,EDI
006afd9a : JNC 0x006afdc2
006afd9c : PUSH 0xe
006afd9e : PUSH 0xbe9698
006afda3 : PUSH EBP
006afda4 : CALL 0x0063abcb
006afda9 : ADD ESP,0xc
006afdac : TEST EAX,EAX
006afdae : JNZ 0x006afdc2
006afdb0 : POP EDI
006afdb1 : POP ESI
006afdb2 : POP EBP
006afdb3 : MOV dword ptr [EBX + 0x16c],0x4
006afdbd : POP EBX
006afdbe : ADD ESP,0x10
006afdc1 : RET
006afdc2 : LEA EDX,[EBP + 0x12]
006afdc5 : CMP EDX,EDI
006afdc7 : JNC 0x006afdef
006afdc9 : PUSH 0x11
006afdcb : PUSH 0xbe9684
006afdd0 : PUSH EBP
006afdd1 : CALL 0x0063abcb
006afdd6 : ADD ESP,0xc
006afdd9 : TEST EAX,EAX
006afddb : JNZ 0x006afdef
006afddd : POP EDI
006afdde : POP ESI
006afddf : POP EBP
006afde0 : MOV dword ptr [EBX + 0x16c],0x3
006afdea : POP EBX
006afdeb : ADD ESP,0x10
006afdee : RET
006afdef : POP EDI
006afdf0 : MOV dword ptr [ESI + 0xc],0xa2
006afdf7 : POP ESI
006afdf8 : POP EBP
006afdf9 : POP EBX
006afdfa : ADD ESP,0x10
006afdfd : RET
006afdfe : MOV EDI,dword ptr [ESI + 0x10]
006afe01 : MOV byte ptr [ESP + 0x28],0x0
006afe06 : CMP AL,0x5b
006afe08 : JNZ 0x006afe1f
006afe0a : MOV EBX,0x100
006afe0f : LEA EAX,[EBP + 0x1]
006afe12 : MOV dword ptr [ESP + 0x18],EBX
006afe16 : MOV byte ptr [ESP + 0x28],0x1
006afe1b : MOV dword ptr [ESI],EAX
006afe1d : JMP 0x006afe2e
006afe1f : MOV ECX,dword ptr [ESI + 0x24]
006afe22 : PUSH ESI
006afe23 : CALL ECX
006afe25 : ADD ESP,0x4
006afe28 : MOV dword ptr [ESP + 0x18],EAX
006afe2c : MOV EBX,EAX
006afe2e : MOV EDX,dword ptr [ESI + 0x1c]
006afe31 : PUSH ESI
006afe32 : CALL EDX
006afe34 : MOV EAX,dword ptr [ESP + 0x18]
006afe38 : ADD ESP,0x4
006afe3b : CMP dword ptr [ESI],EAX
006afe3d : JNC 0x006b00be
006afe43 : MOV ECX,dword ptr [ESP + 0x24]
006afe47 : LEA EDX,[ESP + 0x10]
006afe4b : PUSH EDX
006afe4c : PUSH 0x0
006afe4e : PUSH EBX
006afe4f : PUSH 0x0
006afe51 : PUSH 0x2
006afe53 : MOV dword ptr [ECX + 0x170],EBX
006afe59 : PUSH EDI
006afe5a : MOV dword ptr [ESI + 0x60],EBX
006afe5d : CALL 0x0068a220
006afe62 : MOV ECX,dword ptr [ESP + 0x3c]
006afe66 : MOV dword ptr [ECX + 0x17c],EAX
006afe6c : MOV EAX,dword ptr [ESP + 0x28]
006afe70 : ADD ESP,0x18
006afe73 : TEST EAX,EAX
006afe75 : JNZ 0x006b00bb
006afe7b : LEA EDX,[ESP + 0x10]
006afe7f : PUSH EDX
006afe80 : PUSH EAX
006afe81 : PUSH EBX
006afe82 : PUSH EAX
006afe83 : PUSH 0x4
006afe85 : PUSH EDI
006afe86 : CALL 0x0068a220
006afe8b : MOV ECX,dword ptr [ESP + 0x3c]
006afe8f : MOV dword ptr [ECX + 0x180],EAX
006afe95 : MOV EAX,dword ptr [ESP + 0x28]
006afe99 : ADD ESP,0x18
006afe9c : TEST EAX,EAX
006afe9e : JNZ 0x006b00bb
006afea4 : MOV EDX,dword ptr [ESP + 0x1c]
006afea8 : MOV ECX,dword ptr [EDX]
006afeaa : MOV EDX,dword ptr [ECX]
006afeac : PUSH EDI
006afead : LEA EAX,[ESI + 0x64]
006afeb0 : PUSH EBX
006afeb1 : PUSH EAX
006afeb2 : CALL EDX
006afeb4 : ADD ESP,0xc
006afeb7 : MOV dword ptr [ESP + 0x10],EAX
006afebb : TEST EAX,EAX
006afebd : JNZ 0x006b00bb
006afec3 : XOR EDI,EDI
006afec5 : TEST EBX,EBX
006afec7 : JLE 0x006afee9
006afec9 : LEA ESP,[ESP]
006afed0 : PUSH 0x8
006afed2 : PUSH 0xbe967c
006afed7 : LEA EAX,[ESI + 0x64]
006afeda : PUSH EDI
006afedb : PUSH EAX
006afedc : MOV EAX,dword ptr [EAX + 0x2c]
006afedf : CALL EAX
006afee1 : INC EDI
006afee2 : ADD ESP,0x10
006afee5 : CMP EDI,EBX
006afee7 : JL 0x006afed0
006afee9 : MOV ECX,dword ptr [ESI + 0x1c]
006afeec : XOR EDI,EDI
006afeee : PUSH ESI
006afeef : MOV dword ptr [ESP + 0x20],EDI
006afef3 : CALL ECX
006afef5 : MOV EDX,dword ptr [ESP + 0x18]
006afef9 : ADD ESP,0x4
006afefc : CMP dword ptr [ESI],EDX
006afefe : JNC 0x006b00a3
006aff04 : MOV EBP,dword ptr [ESI]
006aff06 : MOV CL,byte ptr [EBP]
006aff09 : CMP CL,0x64
006aff0c : JNZ 0x006affb3
006aff12 : LEA EAX,[EBP + 0x3]
006aff15 : CMP EAX,EDX
006aff17 : JNC 0x006affb3
006aff1d : CMP byte ptr [EBP + 0x1],0x65
006aff21 : JNZ 0x006affb3
006aff27 : CMP byte ptr [EBP + 0x2],0x66
006aff2b : JNZ 0x006affb3
006aff31 : MOV AL,byte ptr [EAX]
006aff33 : CMP AL,0x20
006aff35 : JZ 0x006b0087
006aff3b : CMP AL,0xd
006aff3d : JZ 0x006b0087
006aff43 : CMP AL,0xa
006aff45 : JZ 0x006b0087
006aff4b : CMP AL,0x9
006aff4d : JZ 0x006b0087
006aff53 : CMP AL,0xc
006aff55 : JZ 0x006b0087
006aff5b : TEST AL,AL
006aff5d : JZ 0x006b0087
006aff63 : CMP AL,0x2f
006aff65 : JZ 0x006b0087
006aff6b : CMP AL,0x28
006aff6d : JZ 0x006b0087
006aff73 : CMP AL,0x29
006aff75 : JZ 0x006b0087
006aff7b : CMP AL,0x3c
006aff7d : JZ 0x006b0087
006aff83 : CMP AL,0x3e
006aff85 : JZ 0x006b0087
006aff8b : CMP AL,0x5b
006aff8d : JZ 0x006b0087
006aff93 : CMP AL,0x5d
006aff95 : JZ 0x006b0087
006aff9b : CMP AL,0x7b
006aff9d : JZ 0x006b0087
006affa3 : CMP AL,0x7d
006affa5 : JZ 0x006b0087
006affab : CMP AL,0x25
006affad : JZ 0x006b0087
006affb3 : CMP CL,0x5d
006affb6 : JZ 0x006b00a2
006affbc : MOVZX EDX,CL
006affbf : SUB EDX,0x30
006affc2 : CMP EDX,0xa
006affc5 : JC 0x006affe3
006affc7 : CMP byte ptr [ESP + 0x28],0x0
006affcc : JNZ 0x006affea
006affce : MOV EAX,dword ptr [ESI + 0x20]
006affd1 : PUSH ESI
006affd2 : CALL EAX
006affd4 : ADD ESP,0x4
006affd7 : CMP dword ptr [ESI + 0xc],0x0
006affdb : JNZ 0x006b00be
006affe1 : JMP 0x006b005a
006affe3 : CMP byte ptr [ESP + 0x28],0x0
006affe8 : JZ 0x006affee
006affea : MOV EBX,EDI
006affec : JMP 0x006affff
006affee : MOV ECX,dword ptr [ESI + 0x24]
006afff1 : PUSH ESI
006afff2 : CALL ECX
006afff4 : MOV EDX,dword ptr [ESI + 0x1c]
006afff7 : PUSH ESI
006afff8 : MOV EBX,EAX
006afffa : CALL EDX
006afffc : ADD ESP,0x8
006affff : MOV EBP,dword ptr [ESI]
006b0001 : CMP byte ptr [EBP],0x2f
006b0005 : JNZ 0x006b005a
006b0007 : LEA EAX,[EBP + 0x2]
006b000a : CMP EAX,dword ptr [ESP + 0x14]
006b000e : JNC 0x006b005a
006b0010 : CMP EDI,dword ptr [ESP + 0x18]
006b0014 : JGE 0x006b005a
006b0016 : MOV ECX,dword ptr [ESI + 0x20]
006b0019 : INC EBP
006b001a : PUSH ESI
006b001b : MOV dword ptr [ESI],EBP
006b001d : CALL ECX
006b001f : ADD ESP,0x4
006b0022 : CMP dword ptr [ESI + 0xc],0x0
006b0026 : JNZ 0x006b00be
006b002c : MOV EDI,dword ptr [ESI]
006b002e : SUB EDI,EBP
006b0030 : LEA EDX,[EDI + 0x1]
006b0033 : PUSH EDX
006b0034 : PUSH EBP
006b0035 : LEA EAX,[ESI + 0x64]
006b0038 : PUSH EBX
006b0039 : PUSH EAX
006b003a : MOV EAX,dword ptr [EAX + 0x2c]
006b003d : CALL EAX
006b003f : ADD ESP,0x10
006b0042 : MOV dword ptr [ESI + 0xc],EAX
006b0045 : TEST EAX,EAX
006b0047 : JNZ 0x006b00be
006b0049 : MOV ECX,dword ptr [ESI + 0x7c]
006b004c : MOV EDX,dword ptr [ECX + EBX*0x4]
006b004f : INC dword ptr [ESP + 0x1c]
006b0053 : MOV byte ptr [EDI + EDX*0x1],AL
006b0056 : MOV EDI,dword ptr [ESP + 0x1c]
006b005a : MOV EAX,dword ptr [ESI + 0x1c]
006b005d : PUSH ESI
006b005e : CALL EAX
006b0060 : MOV EDX,dword ptr [ESP + 0x18]
006b0064 : ADD ESP,0x4
006b0067 : CMP dword ptr [ESI],EDX
006b0069 : JC 0x006aff04
006b006f : MOV ECX,dword ptr [ESP + 0x24]
006b0073 : POP EDI
006b0074 : MOV dword ptr [ECX + 0x16c],0x1
006b007e : MOV dword ptr [ESI],EBP
006b0080 : POP ESI
006b0081 : POP EBP
006b0082 : POP EBX
006b0083 : ADD ESP,0x10
006b0086 : RET
006b0087 : MOV ECX,dword ptr [ESP + 0x24]
006b008b : ADD EBP,0x3
006b008e : POP EDI
006b008f : MOV dword ptr [ECX + 0x16c],0x1
006b0099 : MOV dword ptr [ESI],EBP
006b009b : POP ESI
006b009c : POP EBP
006b009d : POP EBX
006b009e : ADD ESP,0x10
006b00a1 : RET
006b00a2 : INC EBP
006b00a3 : MOV ECX,dword ptr [ESP + 0x24]
006b00a7 : POP EDI
006b00a8 : MOV dword ptr [ECX + 0x16c],0x1
006b00b2 : MOV dword ptr [ESI],EBP
006b00b4 : POP ESI
006b00b5 : POP EBP
006b00b6 : POP EBX
006b00b7 : ADD ESP,0x10
006b00ba : RET
006b00bb : MOV dword ptr [ESI + 0xc],EAX
006b00be : POP EDI
006b00bf : POP ESI
006b00c0 : POP EBP
006b00c1 : POP EBX
006b00c2 : ADD ESP,0x10
006b00c5 : RET
