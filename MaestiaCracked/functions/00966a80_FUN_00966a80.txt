PROGRAM  : Maestia.exe
FUNCTION : FUN_00966a80
ENTRY    : 00966a80
BODY     : [[00966a80, 00966c2b]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00966a80(int *param_1,undefined4 param_2,undefined4 param_3)

{
  int iVar1;
  int *piVar2;
  char cVar3;
  uint uVar4;
  int iVar5;
  undefined4 uVar6;
  int iVar7;
  undefined1 local_34 [28];
  uint local_18;
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b67101;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if (((char)param_1[2] != '\0') && (iVar7 = *(int *)(param_1[1] + 0x128), iVar7 != 0)) {
    if ((*(int *)(iVar7 + 0x40) == 0x20) && (cVar3 = FUN_00993510(param_1,param_3), cVar3 != '\0'))
    {
      ExceptionList = local_10;
      return;
    }
    iVar1 = *(int *)(iVar7 + 0x40);
    if (iVar1 == -1) {
      iVar7 = (**(code **)(*param_1 + 0x74))(param_2,param_3,uVar4);
      if (iVar7 != 0) {
        FUN_0097fb30(iVar7,param_2,param_3);
      }
    }
    else {
      iVar5 = FUN_008eb580();
      if (iVar5 != 0) {
        local_18 = (uint)*(ushort *)(iVar7 + 0x46);
        local_14 = (uint)*(ushort *)(iVar7 + 0x44);
        cVar3 = FUN_00962e30(param_1,local_14,local_18);
        if (cVar3 != '\0') {
          uVar6 = (**(code **)(**(int **)(iVar7 + 0x4c) + 0x20))();
          FUN_0097f9f0(uVar6);
          FUN_00965fe0(param_1[0x17],iVar1,local_14,local_18,uVar6);
          ExceptionList = local_10;
          return;
        }
        if (((DAT_0172491c != 0) && (*DAT_00da9894 != 0)) && (*(int *)(*DAT_00da9894 + 0x1a8) != 0))
        {
          FUN_00406460(L"IDS_CLTNET_ERR_CANTSELLITEM");
          local_8 = 0;
          piVar2 = *(int **)(*DAT_00da9894 + 0x1a8);
          uVar6 = FUN_0081d120(local_34);
          local_8._0_1_ = 1;
          (**(code **)(*piVar2 + 0x44))(uVar6,3);
          local_8 = (uint)local_8._1_3_ << 8;
          FUN_00406560();
          local_8 = 0xffffffff;
          FUN_00406560();
          ExceptionList = local_10;
          return;
        }
      }
    }
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00966a80 : PUSH EBP
00966a81 : MOV EBP,ESP
00966a83 : PUSH -0x1
00966a85 : PUSH 0xb67101
00966a8a : MOV EAX,FS:[0x0]
00966a90 : PUSH EAX
00966a91 : SUB ESP,0x40
00966a94 : PUSH EBX
00966a95 : PUSH ESI
00966a96 : PUSH EDI
00966a97 : MOV EAX,[0x00d66fa0]
00966a9c : XOR EAX,EBP
00966a9e : PUSH EAX
00966a9f : LEA EAX,[EBP + -0xc]
00966aa2 : MOV FS:[0x0],EAX
00966aa8 : MOV EBX,dword ptr [EBP + 0x8]
00966aab : MOV AL,byte ptr [EBX + 0x8]
00966aae : TEST AL,AL
00966ab0 : JZ 0x00966c18
00966ab6 : MOV EAX,dword ptr [EBX + 0x4]
00966ab9 : MOV ESI,dword ptr [EAX + 0x128]
00966abf : TEST ESI,ESI
00966ac1 : JZ 0x00966c18
00966ac7 : MOV EAX,dword ptr [ESI + 0x40]
00966aca : CMP EAX,0x20
00966acd : JNZ 0x00966ae6
00966acf : MOV ECX,dword ptr [EBP + 0x10]
00966ad2 : MOV EDX,dword ptr [EBP + 0xc]
00966ad5 : PUSH ECX
00966ad6 : PUSH EBX
00966ad7 : MOV ECX,ESI
00966ad9 : CALL 0x00993510
00966ade : TEST AL,AL
00966ae0 : JNZ 0x00966c18
00966ae6 : MOV EDI,dword ptr [ESI + 0x40]
00966ae9 : CMP EDI,-0x1
00966aec : JZ 0x00966bf1
00966af2 : MOV EAX,dword ptr [EBX + 0x4]
00966af5 : CALL 0x008eb580
00966afa : TEST EAX,EAX
00966afc : JZ 0x00966c18
00966b02 : MOVZX ECX,word ptr [ESI + 0x46]
00966b06 : MOVZX EAX,word ptr [ESI + 0x44]
00966b0a : PUSH ECX
00966b0b : PUSH EAX
00966b0c : PUSH EBX
00966b0d : MOV dword ptr [EBP + -0x10],EAX
00966b10 : MOV dword ptr [EBP + -0x14],ECX
00966b13 : CALL 0x00962e30
00966b18 : TEST AL,AL
00966b1a : JZ 0x00966b56
00966b1c : MOV ECX,dword ptr [ESI + 0x4c]
00966b1f : MOV EDX,dword ptr [ECX]
00966b21 : MOV EAX,dword ptr [EDX + 0x20]
00966b24 : CALL EAX
00966b26 : PUSH EAX
00966b27 : MOV EAX,ESI
00966b29 : CALL 0x0097f9f0
00966b2e : MOV ECX,dword ptr [EBP + -0x14]
00966b31 : MOV EDX,dword ptr [EBP + -0x10]
00966b34 : PUSH ECX
00966b35 : MOV ECX,dword ptr [EBX + 0x5c]
00966b38 : PUSH EDX
00966b39 : PUSH EDI
00966b3a : PUSH ECX
00966b3b : MOV CL,0x1
00966b3d : CALL 0x00965fe0
00966b42 : MOV ECX,dword ptr [EBP + -0xc]
00966b45 : MOV dword ptr FS:[0x0],ECX
00966b4c : POP ECX
00966b4d : POP EDI
00966b4e : POP ESI
00966b4f : POP EBX
00966b50 : MOV ESP,EBP
00966b52 : POP EBP
00966b53 : RET 0xc
00966b56 : CMP dword ptr [0x0172491c],0x0
00966b5d : JZ 0x00966c18
00966b63 : MOV EDX,dword ptr [0x00da9894]
00966b69 : MOV EAX,dword ptr [EDX]
00966b6b : TEST EAX,EAX
00966b6d : JZ 0x00966c18
00966b73 : CMP dword ptr [EAX + 0x1a8],0x0
00966b7a : JZ 0x00966c18
00966b80 : PUSH 0xc7a02c
00966b85 : LEA ECX,[EBP + -0x30]
00966b88 : CALL 0x00406460
00966b8d : MOV dword ptr [EBP + -0x4],0x0
00966b94 : MOV EAX,[0x00da9894]
00966b99 : MOV EAX,dword ptr [EAX]
00966b9b : MOV ESI,dword ptr [EAX + 0x1a8]
00966ba1 : LEA ECX,[EBP + -0x30]
00966ba4 : PUSH ECX
00966ba5 : MOV ECX,dword ptr [0x0172491c]
00966bab : LEA EDI,[EBP + -0x4c]
00966bae : CALL 0x0081d120
00966bb3 : MOV byte ptr [EBP + -0x4],0x1
00966bb7 : MOV EDX,dword ptr [ESI]
00966bb9 : PUSH 0x3
00966bbb : PUSH EAX
00966bbc : MOV EAX,dword ptr [EDX + 0x44]
00966bbf : MOV ECX,ESI
00966bc1 : CALL EAX
00966bc3 : MOV byte ptr [EBP + -0x4],0x0
00966bc7 : MOV ECX,EDI
00966bc9 : CALL 0x00406560
00966bce : MOV dword ptr [EBP + -0x4],0xffffffff
00966bd5 : LEA ECX,[EBP + -0x30]
00966bd8 : CALL 0x00406560
00966bdd : MOV ECX,dword ptr [EBP + -0xc]
00966be0 : MOV dword ptr FS:[0x0],ECX
00966be7 : POP ECX
00966be8 : POP EDI
00966be9 : POP ESI
00966bea : POP EBX
00966beb : MOV ESP,EBP
00966bed : POP EBP
00966bee : RET 0xc
00966bf1 : MOV EDI,dword ptr [EBP + 0x10]
00966bf4 : MOV EDX,dword ptr [EBX]
00966bf6 : MOV EAX,dword ptr [EBP + 0xc]
00966bf9 : MOV EDX,dword ptr [EDX + 0x74]
00966bfc : PUSH EDI
00966bfd : PUSH EAX
00966bfe : MOV ECX,EBX
00966c00 : CALL EDX
00966c02 : TEST EAX,EAX
00966c04 : JZ 0x00966c18
00966c06 : MOV ECX,dword ptr [EBP + 0xc]
00966c09 : PUSH EDI
00966c0a : PUSH ECX
00966c0b : PUSH EAX
00966c0c : MOV EAX,0x20
00966c11 : MOV ECX,ESI
00966c13 : CALL 0x0097fb30
00966c18 : MOV ECX,dword ptr [EBP + -0xc]
00966c1b : MOV dword ptr FS:[0x0],ECX
00966c22 : POP ECX
00966c23 : POP EDI
00966c24 : POP ESI
00966c25 : POP EBX
00966c26 : MOV ESP,EBP
00966c28 : POP EBP
00966c29 : RET 0xc
