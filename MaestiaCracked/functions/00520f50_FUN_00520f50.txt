PROGRAM  : Maestia.exe
FUNCTION : FUN_00520f50
ENTRY    : 00520f50
BODY     : [[00520f50, 00520f9c] [00520fa0, 00521097]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00520f50(int *param_1,int *param_2)

{
  uint *puVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  int *in_ECX;
  int iVar5;
  int iVar6;
  undefined1 local_34 [4];
  undefined **ppuStack_30;
  undefined **ppuStack_24;
  undefined1 *puStack_20;
  int *piStack_1c;
  undefined4 uStack_18;
  undefined4 uStack_14;
  undefined1 uStack_10;
  int iStack_c;
  int iStack_8;
  int iStack_4;
  
  if (*param_1 == 0) {
    return 0;
  }
  local_34[0] = 0;
  iVar4 = (**(code **)(*in_ECX + 0x5c))();
  iVar2 = param_2[1];
  if ((0 < iVar2) && (iVar5 = iVar2 + -1, -1 < iVar5)) {
    puVar1 = (uint *)(iVar4 + 8);
    iVar6 = iVar5 * 0x10;
    do {
      iVar3 = *param_2;
      *puVar1 = *puVar1 + 0x10;
      if (*(uint *)(iVar4 + 0x10) <= *puVar1) {
        FUN_00504050();
      }
      if (*puVar1 != 0) {
        FUN_005266c0(iVar3 + iVar6);
      }
      iVar5 = iVar5 + -1;
      iVar6 = iVar6 + -0x10;
    } while (-1 < iVar5);
  }
  piStack_1c = in_ECX + 0x1a;
  iStack_4 = (*(int *)(iVar4 + 8) - *(int *)(iVar4 + 0xc) >> 4) + -0x20 +
             *(int *)(iVar4 + 0x1c) * 0x20;
  puStack_20 = local_34;
  ppuStack_24 = &PTR_FUN_00b8ab5c;
  uStack_10 = 0;
  uStack_18 = 0;
  uStack_14 = 0;
  iStack_c = iVar4;
  iStack_8 = iVar2;
  (**(code **)(*(int *)*param_1 + 0x28))(&ppuStack_24,param_1[1],0);
  ppuStack_30 = &PTR_FUN_00b8ab5c;
  if ((((uint)piStack_1c & 2) == 0) && (ppuStack_24 != (undefined **)0x0)) {
    FUN_00503db0();
  }
  ppuStack_24 = (undefined **)0x0;
  if ((((uint)piStack_1c & 1) == 0) && (puStack_20 != (undefined1 *)0x0)) {
    FUN_00503db0();
  }
  if (0 < iVar2) {
    FUN_00520a70(iVar2);
  }
  FUN_00526bc0();
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00520f50 : SUB ESP,0x40
00520f53 : PUSH EBP
00520f54 : MOV EBP,dword ptr [ESP + 0x48]
00520f58 : CMP dword ptr [EBP],0x0
00520f5c : PUSH ESI
00520f5d : MOV ESI,ECX
00520f5f : MOV dword ptr [ESP + 0x8],ESI
00520f63 : JZ 0x0052108e
00520f69 : MOV EAX,dword ptr [ESI]
00520f6b : MOV EDX,dword ptr [EAX + 0x5c]
00520f6e : PUSH EBX
00520f6f : PUSH EDI
00520f70 : MOV byte ptr [ESP + 0x1c],0x0
00520f75 : CALL EDX
00520f77 : MOV EDX,EAX
00520f79 : MOV EAX,dword ptr [ESP + 0x58]
00520f7d : MOV EDI,dword ptr [EAX + 0x4]
00520f80 : MOV dword ptr [ESP + 0x14],EDX
00520f84 : MOV dword ptr [ESP + 0x18],EDI
00520f88 : TEST EDI,EDI
00520f8a : JLE 0x00520fdd
00520f8c : LEA EBX,[EDI + -0x1]
00520f8f : TEST EBX,EBX
00520f91 : JL 0x00520fdd
00520f93 : MOV EBP,EBX
00520f95 : LEA ESI,[EDX + 0x8]
00520f98 : SHL EBP,0x4
00520f9b : JMP 0x00520fa0
00520fa0 : MOV ECX,dword ptr [ESP + 0x58]
00520fa4 : MOV EDI,dword ptr [ECX]
00520fa6 : ADD dword ptr [ESI],0x10
00520fa9 : MOV EAX,dword ptr [ESI]
00520fab : ADD EDI,EBP
00520fad : CMP EAX,dword ptr [ESI + 0x8]
00520fb0 : JC 0x00520fb9
00520fb2 : MOV ECX,ESI
00520fb4 : CALL 0x00504050
00520fb9 : MOV ECX,dword ptr [ESI]
00520fbb : TEST ECX,ECX
00520fbd : JZ 0x00520fc5
00520fbf : PUSH EDI
00520fc0 : CALL 0x005266c0
00520fc5 : DEC EBX
00520fc6 : SUB EBP,0x10
00520fc9 : TEST EBX,EBX
00520fcb : JGE 0x00520fa0
00520fcd : MOV ESI,dword ptr [ESP + 0x10]
00520fd1 : MOV EBP,dword ptr [ESP + 0x54]
00520fd5 : MOV EDX,dword ptr [ESP + 0x14]
00520fd9 : MOV EDI,dword ptr [ESP + 0x18]
00520fdd : MOV ECX,dword ptr [EDX + 0x8]
00520fe0 : SUB ECX,dword ptr [EDX + 0xc]
00520fe3 : MOV EBX,dword ptr [EDX + 0x1c]
00520fe6 : LEA EAX,[ESI + 0x68]
00520fe9 : LEA ESI,[EDX + 0x8]
00520fec : SAR ECX,0x4
00520fef : SHL EBX,0x5
00520ff2 : LEA ECX,[ECX + EBX*0x1 + -0x20]
00520ff6 : LEA EBX,[ESP + 0x1c]
00520ffa : MOV dword ptr [ESP + 0x30],EBX
00520ffe : MOV dword ptr [ESP + 0x34],EAX
00521002 : MOV EAX,dword ptr [EBP + 0x4]
00521005 : XOR EBX,EBX
00521007 : MOV dword ptr [ESP + 0x4c],ECX
0052100b : MOV ECX,dword ptr [EBP]
0052100e : PUSH EBX
0052100f : MOV dword ptr [ESP + 0x48],EDX
00521013 : PUSH EAX
00521014 : MOV dword ptr [ESP + 0x34],0xb8ab5c
0052101c : MOV byte ptr [ESP + 0x48],0x0
00521021 : MOV dword ptr [ESP + 0x40],EBX
00521025 : MOV dword ptr [ESP + 0x44],EBX
00521029 : MOV dword ptr [ESP + 0x50],EDI
0052102d : MOV EDX,dword ptr [ECX]
0052102f : MOV EDX,dword ptr [EDX + 0x28]
00521032 : LEA EAX,[ESP + 0x34]
00521036 : PUSH EAX
00521037 : CALL EDX
00521039 : TEST byte ptr [ESP + 0x40],0x2
0052103e : MOV dword ptr [ESP + 0x2c],0xb8ab5c
00521046 : JNZ 0x00521055
00521048 : MOV ECX,dword ptr [ESP + 0x38]
0052104c : CMP ECX,EBX
0052104e : JZ 0x00521055
00521050 : CALL 0x00503db0
00521055 : TEST byte ptr [ESP + 0x40],0x1
0052105a : MOV dword ptr [ESP + 0x38],EBX
0052105e : JNZ 0x0052106d
00521060 : MOV ECX,dword ptr [ESP + 0x3c]
00521064 : CMP ECX,EBX
00521066 : JZ 0x0052106d
00521068 : CALL 0x00503db0
0052106d : CMP EDI,EBX
0052106f : JLE 0x00521079
00521071 : PUSH EDI
00521072 : MOV ECX,ESI
00521074 : CALL 0x00520a70
00521079 : LEA ECX,[ESP + 0x1c]
0052107d : CALL 0x00526bc0
00521082 : POP EDI
00521083 : POP EBX
00521084 : POP ESI
00521085 : MOV AL,0x1
00521087 : POP EBP
00521088 : ADD ESP,0x40
0052108b : RET 0x8
0052108e : POP ESI
0052108f : XOR AL,AL
00521091 : POP EBP
00521092 : ADD ESP,0x40
00521095 : RET 0x8
