PROGRAM  : Maestia.exe
FUNCTION : FUN_005b6620
ENTRY    : 005b6620
BODY     : [[005b6620, 005b66f5]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005b6620(int param_1,int param_2,int param_3)

{
  undefined4 *puVar1;
  int iVar2;
  undefined4 uVar3;
  GThread *in_ECX;
  GThread *this;
  GThread *this_00;
  uint uVar4;
  uint uVar5;
  
  if (param_3 == 0) {
    return;
  }
  if (param_2 == 7) {
    *(uint *)in_ECX = 8;
    this = in_ECX;
  }
  else {
    *(undefined1 *)(param_1 + 0x15) = 0;
    if (*(int *)(param_1 + 0x30) - *(int *)(param_1 + 0x2c) < 2) {
      FUN_00539fb0(2);
    }
    iVar2 = *(int *)(param_1 + 0x2c);
    this = (GThread *)
           (uint)CONCAT11(*(undefined1 *)(*(int *)(param_1 + 0x3c) + 1 + iVar2),
                          *(undefined1 *)(*(int *)(param_1 + 0x3c) + iVar2));
    *(int *)(param_1 + 0x2c) = iVar2 + 2;
    *(GThread **)in_ECX = this;
    param_3 = param_3 + -2;
  }
  GThread::OnExit(this);
  GThread::OnExit(this_00);
  uVar3 = FUN_0052b230();
  FUN_0052ace0(param_1,param_3);
  uVar4 = *(uint *)(in_ECX + 8) + 1;
  if (uVar4 < *(uint *)(in_ECX + 8)) {
    uVar5 = uVar4;
    if (*(uint *)(in_ECX + 0xc) >> 1 <= uVar4) goto LAB_005b66e0;
  }
  else {
    if (uVar4 < *(uint *)(in_ECX + 0xc)) goto LAB_005b66e0;
    uVar5 = (uVar4 >> 2) + uVar4;
  }
  FUN_005edac0(in_ECX + 4,uVar5);
LAB_005b66e0:
  *(uint *)(in_ECX + 8) = uVar4;
  puVar1 = (undefined4 *)((*(uint *)(in_ECX + 4) - 4) + uVar4 * 4);
  if (puVar1 != (undefined4 *)0x0) {
    *puVar1 = uVar3;
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005b6620 : PUSH EBX
005b6621 : MOV EBX,dword ptr [ESP + 0x10]
005b6625 : PUSH EDI
005b6626 : MOV EDI,ECX
005b6628 : TEST EBX,EBX
005b662a : JZ 0x005b66f1
005b6630 : CMP dword ptr [ESP + 0x10],0x7
005b6635 : PUSH ESI
005b6636 : MOV ESI,dword ptr [ESP + 0x10]
005b663a : JNZ 0x005b6644
005b663c : MOV dword ptr [EDI],0x8
005b6642 : JMP 0x005b6686
005b6644 : MOV EAX,dword ptr [ESI + 0x30]
005b6647 : SUB EAX,dword ptr [ESI + 0x2c]
005b664a : MOV byte ptr [ESI + 0x15],0x0
005b664e : CMP EAX,0x2
005b6651 : JGE 0x005b665c
005b6653 : PUSH 0x2
005b6655 : MOV ECX,ESI
005b6657 : CALL 0x00539fb0
005b665c : MOV EAX,dword ptr [ESI + 0x2c]
005b665f : MOV ECX,dword ptr [ESI + 0x3c]
005b6662 : MOVZX DX,byte ptr [ECX + EAX*0x1 + 0x1]
005b6668 : ADD ECX,EAX
005b666a : MOVZX CX,byte ptr [ECX]
005b666e : SHL DX,0x8
005b6672 : OR DX,CX
005b6675 : MOVZX ECX,DX
005b6678 : ADD EAX,0x2
005b667b : MOVZX EDX,CX
005b667e : MOV dword ptr [ESI + 0x2c],EAX
005b6681 : MOV dword ptr [EDI],EDX
005b6683 : SUB EBX,0x2
005b6686 : MOV EAX,dword ptr [EDI]
005b6688 : PUSH EBP
005b6689 : PUSH EAX
005b668a : PUSH 0xb906d8
005b668f : PUSH ESI
005b6690 : CALL 0x0051d420
005b6695 : PUSH 0xb906c0
005b669a : PUSH ESI
005b669b : CALL 0x0051d420
005b66a0 : ADD ESP,0x14
005b66a3 : CALL 0x0052b230
005b66a8 : MOV EBP,EAX
005b66aa : PUSH EBX
005b66ab : PUSH ESI
005b66ac : MOV ECX,EBP
005b66ae : CALL 0x0052ace0
005b66b3 : MOV ESI,dword ptr [EDI + 0x8]
005b66b6 : ADD EDI,0x4
005b66b9 : INC ESI
005b66ba : CMP ESI,dword ptr [EDI + 0x4]
005b66bd : JNC 0x005b66cb
005b66bf : MOV ECX,dword ptr [EDI + 0x8]
005b66c2 : SHR ECX,0x1
005b66c4 : CMP ESI,ECX
005b66c6 : JNC 0x005b66e0
005b66c8 : PUSH ESI
005b66c9 : JMP 0x005b66d8
005b66cb : CMP ESI,dword ptr [EDI + 0x8]
005b66ce : JC 0x005b66e0
005b66d0 : MOV EDX,ESI
005b66d2 : SHR EDX,0x2
005b66d5 : ADD EDX,ESI
005b66d7 : PUSH EDX
005b66d8 : PUSH EDI
005b66d9 : MOV ECX,EDI
005b66db : CALL 0x005edac0
005b66e0 : MOV EAX,dword ptr [EDI]
005b66e2 : MOV dword ptr [EDI + 0x4],ESI
005b66e5 : LEA ESI,[EAX + ESI*0x4 + -0x4]
005b66e9 : TEST ESI,ESI
005b66eb : JZ 0x005b66ef
005b66ed : MOV dword ptr [ESI],EBP
005b66ef : POP EBP
005b66f0 : POP ESI
005b66f1 : POP EDI
005b66f2 : POP EBX
005b66f3 : RET 0xc
