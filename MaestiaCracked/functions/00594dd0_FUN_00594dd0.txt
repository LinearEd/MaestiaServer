PROGRAM  : Maestia.exe
FUNCTION : FUN_00594dd0
ENTRY    : 00594dd0
BODY     : [[00594dd0, 005950a8]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00594dd0(undefined4 *param_1)

{
  undefined1 *puVar1;
  undefined4 *puVar2;
  int *piVar3;
  char cVar4;
  LONG LVar5;
  int iVar6;
  uint uVar7;
  undefined4 uVar8;
  GRefCountNTSImpl *this;
  int *piVar9;
  undefined4 uVar10;
  undefined *puVar11;
  undefined4 uVar12;
  undefined *puVar13;
  undefined4 uVar14;
  undefined4 uVar15;
  int **ppiVar16;
  undefined4 uVar17;
  uint *puVar18;
  undefined4 uVar19;
  uint local_64;
  int iStack_60;
  int *local_5c;
  int local_58;
  int *piStack_54;
  undefined4 uStack_50;
  GRefCountNTSImpl *apGStack_4c [16];
  uint uStack_c;
  
  puVar2 = param_1;
  puVar1 = (undefined1 *)param_1[1];
  FUN_00526400();
  *puVar1 = 0;
  if ((int *)puVar2[2] == (int *)0x0) {
    piVar9 = *(int **)(puVar2[6] + 0x74);
  }
  else {
    iVar6 = (**(code **)(*(int *)puVar2[2] + 8))();
    if (iVar6 != 2) {
      return;
    }
    if (puVar2[2] == 0) {
      return;
    }
    piVar9 = (int *)(puVar2[2] + -0x68);
  }
  if ((piVar9 != (int *)0x0) && (2 < (int)puVar2[7])) {
    uVar8 = puVar2[6];
    FUN_00526260(0);
    FUN_005272e0(&param_1,uVar8,0xffffffff,0);
    local_5c = (int *)0x0;
    local_58 = 0;
    FUN_0051c480(*param_1);
    puVar18 = &local_64;
    ppiVar16 = &local_5c;
    (**(code **)(*piVar9 + 0x48))(ppiVar16,puVar18);
    cVar4 = FUN_005649d0(ppiVar16,puVar18);
    LVar5 = InterlockedExchangeAdd((LONG *)((local_64 & 0xfffffffc) + 4),-1);
    if (LVar5 == 1) {
      FUN_00515cf0(local_64 & 0xfffffffc);
    }
    if (cVar4 == '\0') {
      iVar6 = piVar9[0x20];
      uVar8 = *param_1;
      if (iVar6 == 0) {
        iVar6 = FUN_00520df0();
      }
      FUN_00502160(piVar9 + 3,"Error: %s.attachMovie() failed - export name \"%s\" is not found.\n",
                   **(undefined4 **)(iVar6 + 0xc),uVar8);
    }
    else {
      uVar7 = (**(code **)(*local_5c + 8))();
      piVar3 = local_5c;
      if ((uVar7 & 0x8000) == 0) {
        iVar6 = piVar9[0x20];
        uVar8 = *param_1;
        if (iVar6 == 0) {
          iVar6 = FUN_00520df0();
        }
        FUN_00502160(piVar9 + 3,"Error: %s.attachMovie() failed - \"%s\" is not a movieclip.\n",
                     **(undefined4 **)(iVar6 + 0xc),uVar8);
      }
      else {
        uVar8 = puVar2[6];
        uStack_50 = *(undefined4 *)(local_58 + 0x28);
        uVar19 = 0;
        uVar17 = 0;
        uVar15 = 0;
        uVar14 = 0;
        puVar13 = &DAT_00d65698;
        uVar12 = 1;
        puVar11 = &DAT_00d65858;
        uVar10 = 1;
        piStack_54 = local_5c;
        FUN_00526260(2);
        FUN_00527730(uVar8);
        iVar6 = FUN_0063b380(uVar10,puVar11,uVar12,puVar13,uVar14,uVar15,uVar17,uVar19);
        FUN_0051d350(piVar3[3],iVar6 + 0x4000,uVar10,puVar11,uVar12,puVar13,uVar14,uVar15,uVar17,
                     uVar19);
        if (uStack_c < 0x7efffffe) {
          if (puVar2[7] == 4) {
            uVar8 = puVar2[6];
            FUN_00526260(3);
            uVar8 = FUN_005270f0(uVar8);
          }
          else {
            uVar8 = 0;
          }
          uVar10 = puVar2[6];
          FUN_00526260(1);
          FUN_005272e0(&iStack_60,uVar10,0xffffffff,0);
          this = (GRefCountNTSImpl *)
                 FUN_00594270(apGStack_4c,&iStack_60,0,uVar8,0xffffffff,1,&piStack_54,0);
          if (this != (GRefCountNTSImpl *)0x0) {
            *(int *)(this + 4) = *(int *)(this + 4) + 1;
          }
          *(int *)(iStack_60 + 8) = *(int *)(iStack_60 + 8) + -1;
          if (*(int *)(iStack_60 + 8) == 0) {
            FUN_00525340();
          }
          if (this != (GRefCountNTSImpl *)0x0) {
            (**(code **)(*(int *)this + 0x14))(0);
            uVar7 = FUN_0051cf20();
            if (5 < uVar7) {
              FUN_00526c80(-(uint)(((byte)this[0x66] & 0x80) != 0) & (uint)this);
            }
            GRefCountNTSImpl::Release(this);
          }
        }
        else {
          uVar8 = *param_1;
          iVar6 = piVar9[0x20];
          if (iVar6 == 0) {
            iVar6 = FUN_00520df0();
          }
          FUN_00502160(piVar9 + 3,"Error: %s.attachMovie(\"%s\") failed - depth (%d) must be >= 0\n"
                       ,**(undefined4 **)(iVar6 + 0xc),uVar8,uStack_c);
        }
        if (apGStack_4c[0] != (GRefCountNTSImpl *)0x0) {
          GRefCountNTSImpl::Release(apGStack_4c[0]);
        }
      }
    }
    if (local_5c != (int *)0x0) {
      FUN_00524240();
    }
    param_1[2] = param_1[2] + -1;
    if (param_1[2] == 0) {
      FUN_00525340();
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00594dd0 : SUB ESP,0x64
00594dd3 : PUSH EBX
00594dd4 : PUSH EBP
00594dd5 : PUSH ESI
00594dd6 : MOV ESI,dword ptr [ESP + 0x74]
00594dda : PUSH EDI
00594ddb : MOV EDI,dword ptr [ESI + 0x4]
00594dde : MOV ECX,EDI
00594de0 : CALL 0x00526400
00594de5 : MOV byte ptr [EDI],0x0
00594de8 : MOV ECX,dword ptr [ESI + 0x8]
00594deb : XOR EBX,EBX
00594ded : CMP ECX,EBX
00594def : JNZ 0x00594df9
00594df1 : MOV EAX,dword ptr [ESI + 0x18]
00594df4 : MOV EDI,dword ptr [EAX + 0x74]
00594df7 : JMP 0x00594e17
00594df9 : MOV EDX,dword ptr [ECX]
00594dfb : MOV EAX,dword ptr [EDX + 0x8]
00594dfe : CALL EAX
00594e00 : CMP EAX,0x2
00594e03 : JNZ 0x005950a1
00594e09 : MOV EDI,dword ptr [ESI + 0x8]
00594e0c : CMP EDI,EBX
00594e0e : JZ 0x005950a1
00594e14 : ADD EDI,-0x68
00594e17 : CMP EDI,EBX
00594e19 : JZ 0x005950a1
00594e1f : CMP dword ptr [ESI + 0x1c],0x3
00594e23 : JL 0x005950a1
00594e29 : MOV EBP,dword ptr [ESI + 0x18]
00594e2c : PUSH EBX
00594e2d : MOV ECX,ESI
00594e2f : CALL 0x00526260
00594e34 : PUSH EBX
00594e35 : PUSH -0x1
00594e37 : PUSH EBP
00594e38 : LEA ECX,[ESP + 0x84]
00594e3f : PUSH ECX
00594e40 : MOV ECX,EAX
00594e42 : CALL 0x005272e0
00594e47 : MOV EDX,dword ptr [ESP + 0x78]
00594e4b : MOV dword ptr [ESP + 0x18],EBX
00594e4f : MOV dword ptr [ESP + 0x1c],EBX
00594e53 : MOV EAX,dword ptr [EDX]
00594e55 : PUSH EAX
00594e56 : LEA ECX,[ESP + 0x14]
00594e5a : CALL 0x0051c480
00594e5f : MOV EDX,dword ptr [EDI]
00594e61 : LEA EAX,[ESP + 0x10]
00594e65 : PUSH EAX
00594e66 : MOV EAX,dword ptr [EDX + 0x48]
00594e69 : LEA ECX,[ESP + 0x1c]
00594e6d : PUSH ECX
00594e6e : MOV ECX,EDI
00594e70 : CALL EAX
00594e72 : MOV ECX,EAX
00594e74 : CALL 0x005649d0
00594e79 : MOV EBP,dword ptr [ESP + 0x10]
00594e7d : TEST AL,AL
00594e7f : SETZ BL
00594e82 : AND EBP,0xfffffffc
00594e85 : PUSH -0x1
00594e87 : LEA ECX,[EBP + 0x4]
00594e8a : PUSH ECX
00594e8b : CALL dword ptr [0x00b851cc]
00594e91 : ADD EAX,-0x1
00594e94 : JNZ 0x00594e9c
00594e96 : PUSH EBP
00594e97 : CALL 0x00515cf0
00594e9c : TEST BL,BL
00594e9e : JZ 0x00594ed4
00594ea0 : MOV EAX,dword ptr [EDI + 0x80]
00594ea6 : MOV EDX,dword ptr [ESP + 0x78]
00594eaa : MOV ESI,dword ptr [EDX]
00594eac : TEST EAX,EAX
00594eae : JNZ 0x00594eb7
00594eb0 : MOV ECX,EDI
00594eb2 : CALL 0x00520df0
00594eb7 : MOV EAX,dword ptr [EAX + 0xc]
00594eba : MOV ECX,dword ptr [EAX]
00594ebc : PUSH ESI
00594ebd : PUSH ECX
00594ebe : PUSH 0xb8e1c8
00594ec3 : ADD EDI,0xc
00594ec6 : PUSH EDI
00594ec7 : CALL 0x00502160
00594ecc : ADD ESP,0x10
00594ecf : JMP 0x0059507e
00594ed4 : MOV ECX,dword ptr [ESP + 0x18]
00594ed8 : MOV EDX,dword ptr [ECX]
00594eda : MOV EAX,dword ptr [EDX + 0x8]
00594edd : CALL EAX
00594edf : TEST EAX,0x8000
00594ee4 : JNZ 0x00594f1a
00594ee6 : MOV EAX,dword ptr [EDI + 0x80]
00594eec : MOV ECX,dword ptr [ESP + 0x78]
00594ef0 : MOV ESI,dword ptr [ECX]
00594ef2 : TEST EAX,EAX
00594ef4 : JNZ 0x00594efd
00594ef6 : MOV ECX,EDI
00594ef8 : CALL 0x00520df0
00594efd : MOV EDX,dword ptr [EAX + 0xc]
00594f00 : MOV EAX,dword ptr [EDX]
00594f02 : PUSH ESI
00594f03 : PUSH EAX
00594f04 : PUSH 0xb8e18c
00594f09 : ADD EDI,0xc
00594f0c : PUSH EDI
00594f0d : CALL 0x00502160
00594f12 : ADD ESP,0x10
00594f15 : JMP 0x0059507e
00594f1a : MOV ECX,dword ptr [ESP + 0x1c]
00594f1e : FLDZ
00594f20 : MOV EAX,dword ptr [ESI + 0x18]
00594f23 : MOV EDX,dword ptr [ECX + 0x28]
00594f26 : MOV EBP,dword ptr [ESP + 0x18]
00594f2a : PUSH 0x0
00594f2c : PUSH 0x0
00594f2e : PUSH 0x0
00594f30 : PUSH ECX
00594f31 : FSTP float ptr [ESP]
00594f34 : PUSH 0xd65698
00594f39 : PUSH 0x1
00594f3b : PUSH 0xd65858
00594f40 : PUSH 0x1
00594f42 : PUSH EAX
00594f43 : PUSH 0x2
00594f45 : MOV ECX,ESI
00594f47 : MOV dword ptr [ESP + 0x48],EBP
00594f4b : MOV dword ptr [ESP + 0x4c],EDX
00594f4f : CALL 0x00526260
00594f54 : MOV ECX,EAX
00594f56 : CALL 0x00527730
00594f5b : CALL 0x0063b380
00594f60 : ADD EAX,0x4000
00594f65 : PUSH EAX
00594f66 : PUSH ECX
00594f67 : MOV ECX,dword ptr [EBP + 0xc]
00594f6a : MOV EAX,ESP
00594f6c : MOV dword ptr [EAX],ECX
00594f6e : LEA ECX,[ESP + 0x50]
00594f72 : CALL 0x0051d350
00594f77 : CMP dword ptr [ESP + 0x68],0x7efffffd
00594f7f : JA 0x0059503d
00594f85 : CMP dword ptr [ESI + 0x1c],0x4
00594f89 : JNZ 0x00594fa3
00594f8b : MOV EDX,dword ptr [ESI + 0x18]
00594f8e : PUSH EDX
00594f8f : PUSH 0x3
00594f91 : MOV ECX,ESI
00594f93 : CALL 0x00526260
00594f98 : MOV ECX,EAX
00594f9a : CALL 0x005270f0
00594f9f : MOV EBX,EAX
00594fa1 : JMP 0x00594fa5
00594fa3 : XOR EBX,EBX
00594fa5 : MOV EBP,dword ptr [ESI + 0x18]
00594fa8 : PUSH 0x1
00594faa : MOV ECX,ESI
00594fac : CALL 0x00526260
00594fb1 : PUSH 0x0
00594fb3 : PUSH -0x1
00594fb5 : PUSH EBP
00594fb6 : LEA ECX,[ESP + 0x20]
00594fba : PUSH ECX
00594fbb : MOV ECX,EAX
00594fbd : CALL 0x005272e0
00594fc2 : PUSH 0x0
00594fc4 : LEA EDX,[ESP + 0x24]
00594fc8 : PUSH EDX
00594fc9 : PUSH 0x1
00594fcb : PUSH -0x1
00594fcd : PUSH EBX
00594fce : PUSH 0x0
00594fd0 : LEA EAX,[ESP + 0x2c]
00594fd4 : PUSH EAX
00594fd5 : LEA ECX,[ESP + 0x44]
00594fd9 : PUSH ECX
00594fda : MOV ECX,EDI
00594fdc : CALL 0x00594270
00594fe1 : MOV EBP,EAX
00594fe3 : TEST EBP,EBP
00594fe5 : JZ 0x00594fea
00594fe7 : INC dword ptr [EBP + 0x4]
00594fea : MOV EAX,dword ptr [ESP + 0x14]
00594fee : DEC dword ptr [EAX + 0x8]
00594ff1 : MOV ECX,EAX
00594ff3 : ADD EAX,0x8
00594ff6 : CMP dword ptr [EAX],0x0
00594ff9 : JNZ 0x00595000
00594ffb : CALL 0x00525340
00595000 : TEST EBP,EBP
00595002 : JZ 0x00595071
00595004 : MOV EDX,dword ptr [EBP]
00595007 : MOV EAX,dword ptr [EDX + 0x14]
0059500a : PUSH 0x0
0059500c : MOV ECX,EBP
0059500e : CALL EAX
00595010 : MOV ECX,EDI
00595012 : CALL 0x0051cf20
00595017 : CMP EAX,0x6
0059501a : JC 0x00595034
0059501c : MOV CL,byte ptr [EBP + 0x66]
0059501f : AND CL,0x80
00595022 : MOVZX EDX,CL
00595025 : MOV ECX,dword ptr [ESI + 0x4]
00595028 : NEG EDX
0059502a : SBB EDX,EDX
0059502c : AND EDX,EBP
0059502e : PUSH EDX
0059502f : CALL 0x00526c80
00595034 : MOV ECX,EBP
00595036 : CALL 0x004ff7c0
0059503b : JMP 0x00595071
0059503d : MOV EAX,dword ptr [ESP + 0x78]
00595041 : MOV ESI,dword ptr [EAX]
00595043 : MOV EAX,dword ptr [EDI + 0x80]
00595049 : TEST EAX,EAX
0059504b : JNZ 0x00595054
0059504d : MOV ECX,EDI
0059504f : CALL 0x00520df0
00595054 : MOV ECX,dword ptr [ESP + 0x68]
00595058 : MOV EDX,dword ptr [EAX + 0xc]
0059505b : MOV EAX,dword ptr [EDX]
0059505d : PUSH ECX
0059505e : PUSH ESI
0059505f : PUSH EAX
00595060 : PUSH 0xb8e14c
00595065 : ADD EDI,0xc
00595068 : PUSH EDI
00595069 : CALL 0x00502160
0059506e : ADD ESP,0x14
00595071 : MOV ECX,dword ptr [ESP + 0x28]
00595075 : TEST ECX,ECX
00595077 : JZ 0x0059507e
00595079 : CALL 0x004ff7c0
0059507e : MOV ECX,dword ptr [ESP + 0x18]
00595082 : TEST ECX,ECX
00595084 : JZ 0x0059508b
00595086 : CALL 0x00524240
0059508b : MOV EAX,dword ptr [ESP + 0x78]
0059508f : DEC dword ptr [EAX + 0x8]
00595092 : MOV ECX,EAX
00595094 : ADD EAX,0x8
00595097 : CMP dword ptr [EAX],0x0
0059509a : JNZ 0x005950a1
0059509c : CALL 0x00525340
005950a1 : POP EDI
005950a2 : POP ESI
005950a3 : POP EBP
005950a4 : POP EBX
005950a5 : ADD ESP,0x64
005950a8 : RET
