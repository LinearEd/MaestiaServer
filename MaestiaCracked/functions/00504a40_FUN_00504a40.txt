PROGRAM  : Maestia.exe
FUNCTION : FUN_00504a40
ENTRY    : 00504a40
BODY     : [[00504a40, 00504e01]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00504a40(undefined4 param_1,int param_2,undefined4 param_3)

{
  int *piVar1;
  uint uVar2;
  char cVar3;
  int iVar4;
  int iVar5;
  int iVar6;
  undefined4 uVar7;
  int in_ECX;
  char *pcVar8;
  uint uVar9;
  uint *puVar10;
  undefined1 local_58 [44];
  undefined1 local_2c [44];
  
  piVar1 = *(int **)(in_ECX + 0xd0);
  if (piVar1 == (int *)0x0) {
    return;
  }
  if (*piVar1 == 0) {
    return;
  }
  pcVar8 = (char *)0x0;
  switch(param_1) {
  case 0:
    if (piVar1[param_2 * 2 + 4] == 0) {
      uVar2 = piVar1[2];
      uVar9 = 0;
      if (uVar2 == 0) {
        return;
      }
      while (cVar3 = FUN_004ffde0(param_3), cVar3 == '\0') {
        uVar9 = uVar9 + 1;
        if (uVar2 <= uVar9) {
          return;
        }
      }
      iVar4 = *(int *)(*(int *)(in_ECX + 0xd0) + 4);
      *(uint *)(*(int *)(in_ECX + 0xd0) + 0x10 + param_2 * 8) = uVar9 + 1;
      puVar10 = (uint *)(iVar4 + uVar9 * 0x14);
      *(undefined1 *)(*(int *)(in_ECX + 0xd0) + 0x15 + param_2 * 8) = 1;
    }
    else {
      if (*(char *)((int)piVar1 + param_2 * 8 + 0x15) != '\0') {
        return;
      }
      *(undefined1 *)((int)piVar1 + param_2 * 8 + 0x15) = 1;
      iVar4 = *(int *)(*(int *)(in_ECX + 0xd0) + 0x10 + param_2 * 8);
      iVar5 = *(int *)(*(int *)(in_ECX + 0xd0) + 4);
      puVar10 = (uint *)(iVar5 + -0x14 + iVar4 * 0x14);
      if (*(int *)(iVar5 + -8 + iVar4 * 0x14) != 0) {
        puVar10[3] = puVar10[3] + 1;
        return;
      }
    }
    if (puVar10 == (uint *)0x0) {
      return;
    }
    uVar2 = puVar10[3];
    puVar10[3] = uVar2 + 1;
    if (uVar2 != 0) {
      return;
    }
LAB_00504cb4:
    pcVar8 = "a:active";
    break;
  case 1:
    if (piVar1[param_2 * 2 + 4] == 0) {
      return;
    }
    if (*(char *)((int)piVar1 + param_2 * 8 + 0x15) == '\0') {
      return;
    }
    *(undefined1 *)((int)piVar1 + param_2 * 8 + 0x15) = 0;
    iVar4 = *(int *)(in_ECX + 0xd0);
    iVar5 = *(int *)(iVar4 + 0x10 + param_2 * 8) + -1;
    if (*(char *)(iVar4 + 0x14 + param_2 * 8) == '\0') {
      *(undefined4 *)(iVar4 + 0x10 + param_2 * 8) = 0;
    }
    iVar4 = *(int *)(*(int *)(in_ECX + 0xd0) + 4);
    puVar10 = (uint *)(iVar4 + iVar5 * 0x14);
    if (*(int *)(iVar4 + 0xc + iVar5 * 0x14) != 0) {
      puVar10[3] = puVar10[3] - 1;
      if (puVar10[3] != 0) {
        return;
      }
      if (puVar10[4] != 0) {
        pcVar8 = "a:hover";
      }
    }
    break;
  case 2:
    if (piVar1[param_2 * 2 + 4] == 0) {
      uVar2 = piVar1[2];
      uVar9 = 0;
      if (uVar2 == 0) {
        return;
      }
      while (cVar3 = FUN_004ffde0(param_3), cVar3 == '\0') {
        uVar9 = uVar9 + 1;
        if (uVar2 <= uVar9) {
          return;
        }
      }
      iVar4 = *(int *)(*(int *)(in_ECX + 0xd0) + 4);
      *(uint *)(*(int *)(in_ECX + 0xd0) + 0x10 + param_2 * 8) = uVar9 + 1;
      puVar10 = (uint *)(iVar4 + uVar9 * 0x14);
      *(undefined1 *)(*(int *)(in_ECX + 0xd0) + 0x14 + param_2 * 8) = 1;
    }
    else {
      if ((char)piVar1[param_2 * 2 + 5] != '\0') {
        return;
      }
      *(undefined1 *)(piVar1 + param_2 * 2 + 5) = 1;
      iVar4 = *(int *)(*(int *)(in_ECX + 0xd0) + 0x10 + param_2 * 8);
      iVar5 = *(int *)(*(int *)(in_ECX + 0xd0) + 4);
      puVar10 = (uint *)(iVar5 + -0x14 + iVar4 * 0x14);
      if (*(int *)(iVar5 + -4 + iVar4 * 0x14) != 0) {
        puVar10[4] = puVar10[4] + 1;
        return;
      }
    }
    if (puVar10 == (uint *)0x0) {
      return;
    }
    if (puVar10[3] != 0) {
      return;
    }
    uVar2 = puVar10[4];
    puVar10[4] = uVar2 + 1;
    if (uVar2 != 0) {
      return;
    }
    pcVar8 = "a:hover";
    break;
  case 3:
    if (piVar1[param_2 * 2 + 4] == 0) {
      return;
    }
    if ((char)piVar1[param_2 * 2 + 5] == '\0') {
      return;
    }
    *(undefined1 *)(piVar1 + param_2 * 2 + 5) = 0;
    iVar4 = *(int *)(in_ECX + 0xd0);
    puVar10 = (uint *)(*(int *)(iVar4 + 4) + -0x14 + *(int *)(iVar4 + 0x10 + param_2 * 8) * 0x14);
    if (*(char *)(iVar4 + 0x15 + param_2 * 8) == '\0') {
      *(undefined4 *)(iVar4 + 0x10 + param_2 * 8) = 0;
    }
    if (puVar10[4] != 0) {
      puVar10[4] = puVar10[4] - 1;
      if (puVar10[4] != 0) {
        return;
      }
      if (puVar10[3] != 0) goto LAB_00504cb4;
    }
    break;
  default:
    goto switchD_00504a6f_default;
  }
  if (puVar10[2] != 0) {
    uVar2 = *puVar10;
    if (puVar10[1] + uVar2 < uVar2) {
      iVar4 = 0;
    }
    else {
      iVar4 = (puVar10[1] + uVar2) - uVar2;
    }
    FUN_00542320(uVar2,iVar4);
    FUN_00541980(puVar10[2],uVar2,0xffffffff);
  }
  if ((pcVar8 != (char *)0x0) && (iVar4 = FUN_0057dec0(0,pcVar8,0xffffffff), iVar4 != 0)) {
    iVar5 = FUN_0057dec0(0,&DAT_00b8653c,0xffffffff);
    iVar6 = FUN_0057dec0(0,"a:link",0xffffffff);
    uVar7 = FUN_00515dd0(in_ECX);
    FUN_00504200(uVar7);
    if (iVar5 != 0) {
      uVar7 = FUN_0055fca0(local_2c,iVar5);
      FUN_00504700(uVar7);
      FUN_00504260();
    }
    if (iVar6 != 0) {
      uVar7 = FUN_0055fca0(local_2c,iVar6);
      FUN_00504700(uVar7);
      FUN_00504260();
    }
    uVar7 = FUN_0055fca0(local_2c,iVar4);
    FUN_00504700(uVar7);
    FUN_00504260();
    FUN_005449c0(local_58,*puVar10,puVar10[1] + *puVar10);
    FUN_00504260();
  }
switchD_00504a6f_default:
  return;
}



============================================================
DISASSEMBLY
============================================================
00504a40 : SUB ESP,0x58
00504a43 : PUSH EDI
00504a44 : MOV EDI,ECX
00504a46 : MOV EAX,dword ptr [EDI + 0xd0]
00504a4c : TEST EAX,EAX
00504a4e : JZ 0x00504dfb
00504a54 : CMP dword ptr [EAX],0x0
00504a57 : JZ 0x00504dfb
00504a5d : MOV ECX,dword ptr [ESP + 0x60]
00504a61 : PUSH EBX
00504a62 : XOR EBX,EBX
00504a64 : CMP ECX,0x3
00504a67 : JA 0x00504dfa
00504a6d : PUSH EBP
00504a6e : PUSH ESI
00504a6f : JMP dword ptr [ECX*0x4 + 0x504e04]
00504a76 : MOV EBX,dword ptr [ESP + 0x70]
00504a7a : CMP dword ptr [EAX + EBX*0x8 + 0x10],0x0
00504a7f : JBE 0x00504ab9
00504a81 : CMP byte ptr [EAX + EBX*0x8 + 0x15],0x0
00504a86 : JNZ 0x00504df8
00504a8c : MOV byte ptr [EAX + EBX*0x8 + 0x15],0x1
00504a91 : MOV EAX,dword ptr [EDI + 0xd0]
00504a97 : MOV ECX,dword ptr [EAX + EBX*0x8 + 0x10]
00504a9b : MOV EDX,dword ptr [EAX + 0x4]
00504a9e : LEA ECX,[ECX + ECX*0x4]
00504aa1 : CMP dword ptr [EDX + ECX*0x4 + -0x8],0x0
00504aa6 : LEA ESI,[EDX + ECX*0x4 + -0x14]
00504aaa : JBE 0x00504b14
00504aac : INC dword ptr [ESI + 0xc]
00504aaf : POP ESI
00504ab0 : POP EBP
00504ab1 : POP EBX
00504ab2 : POP EDI
00504ab3 : ADD ESP,0x58
00504ab6 : RET 0xc
00504ab9 : MOV ECX,dword ptr [EAX + 0x8]
00504abc : XOR EBP,EBP
00504abe : MOV dword ptr [ESP + 0x70],ECX
00504ac2 : TEST ECX,ECX
00504ac4 : JBE 0x00504df8
00504aca : MOV ESI,dword ptr [EAX + 0x4]
00504acd : LEA ECX,[ECX]
00504ad0 : MOV EAX,dword ptr [ESP + 0x74]
00504ad4 : PUSH EAX
00504ad5 : MOV ECX,ESI
00504ad7 : CALL 0x004ffde0
00504adc : TEST AL,AL
00504ade : JNZ 0x00504af4
00504ae0 : INC EBP
00504ae1 : ADD ESI,0x14
00504ae4 : CMP EBP,dword ptr [ESP + 0x70]
00504ae8 : JC 0x00504ad0
00504aea : POP ESI
00504aeb : POP EBP
00504aec : POP EBX
00504aed : POP EDI
00504aee : ADD ESP,0x58
00504af1 : RET 0xc
00504af4 : MOV EAX,dword ptr [EDI + 0xd0]
00504afa : MOV EDX,dword ptr [EAX + 0x4]
00504afd : LEA ECX,[EBP + EBP*0x4]
00504b01 : INC EBP
00504b02 : MOV dword ptr [EAX + EBX*0x8 + 0x10],EBP
00504b06 : MOV EAX,dword ptr [EDI + 0xd0]
00504b0c : LEA ESI,[EDX + ECX*0x4]
00504b0f : MOV byte ptr [EAX + EBX*0x8 + 0x15],0x1
00504b14 : TEST ESI,ESI
00504b16 : JZ 0x00504df8
00504b1c : MOV EAX,dword ptr [ESI + 0xc]
00504b1f : LEA ECX,[EAX + 0x1]
00504b22 : MOV dword ptr [ESI + 0xc],ECX
00504b25 : TEST EAX,EAX
00504b27 : JNZ 0x00504df8
00504b2d : JMP 0x00504cb4
00504b32 : MOV ECX,dword ptr [ESP + 0x70]
00504b36 : CMP dword ptr [EAX + ECX*0x8 + 0x10],EBX
00504b3a : JBE 0x00504df8
00504b40 : CMP byte ptr [EAX + ECX*0x8 + 0x15],BL
00504b44 : JZ 0x00504df8
00504b4a : MOV EDX,EAX
00504b4c : MOV byte ptr [EDX + ECX*0x8 + 0x15],BL
00504b50 : MOV EDX,dword ptr [EDI + 0xd0]
00504b56 : MOV EAX,dword ptr [EDX + ECX*0x8 + 0x10]
00504b5a : DEC EAX
00504b5b : CMP byte ptr [EDX + ECX*0x8 + 0x14],BL
00504b5f : JNZ 0x00504b65
00504b61 : MOV dword ptr [EDX + ECX*0x8 + 0x10],EBX
00504b65 : MOV ECX,dword ptr [EDI + 0xd0]
00504b6b : MOV EDX,dword ptr [ECX + 0x4]
00504b6e : LEA EAX,[EAX + EAX*0x4]
00504b71 : CMP dword ptr [EDX + EAX*0x4 + 0xc],EBX
00504b75 : LEA ESI,[EDX + EAX*0x4]
00504b78 : JBE 0x00504cb9
00504b7e : DEC dword ptr [ESI + 0xc]
00504b81 : CMP dword ptr [ESI + 0xc],EBX
00504b84 : JNZ 0x00504df8
00504b8a : CMP dword ptr [ESI + 0x10],EBX
00504b8d : JBE 0x00504cb9
00504b93 : MOV EBX,0xb8654c
00504b98 : JMP 0x00504cb9
00504b9d : MOV EBX,dword ptr [ESP + 0x70]
00504ba1 : CMP dword ptr [EAX + EBX*0x8 + 0x10],0x0
00504ba6 : JBE 0x00504be0
00504ba8 : CMP byte ptr [EAX + EBX*0x8 + 0x14],0x0
00504bad : JNZ 0x00504df8
00504bb3 : MOV byte ptr [EAX + EBX*0x8 + 0x14],0x1
00504bb8 : MOV EAX,dword ptr [EDI + 0xd0]
00504bbe : MOV ECX,dword ptr [EAX + EBX*0x8 + 0x10]
00504bc2 : MOV EDX,dword ptr [EAX + 0x4]
00504bc5 : LEA ECX,[ECX + ECX*0x4]
00504bc8 : CMP dword ptr [EDX + ECX*0x4 + -0x4],0x0
00504bcd : LEA ESI,[EDX + ECX*0x4 + -0x14]
00504bd1 : JBE 0x00504c38
00504bd3 : INC dword ptr [ESI + 0x10]
00504bd6 : POP ESI
00504bd7 : POP EBP
00504bd8 : POP EBX
00504bd9 : POP EDI
00504bda : ADD ESP,0x58
00504bdd : RET 0xc
00504be0 : MOV ECX,dword ptr [EAX + 0x8]
00504be3 : XOR EBP,EBP
00504be5 : MOV dword ptr [ESP + 0x70],ECX
00504be9 : TEST ECX,ECX
00504beb : JBE 0x00504df8
00504bf1 : MOV ESI,dword ptr [EAX + 0x4]
00504bf4 : MOV EAX,dword ptr [ESP + 0x74]
00504bf8 : PUSH EAX
00504bf9 : MOV ECX,ESI
00504bfb : CALL 0x004ffde0
00504c00 : TEST AL,AL
00504c02 : JNZ 0x00504c18
00504c04 : INC EBP
00504c05 : ADD ESI,0x14
00504c08 : CMP EBP,dword ptr [ESP + 0x70]
00504c0c : JC 0x00504bf4
00504c0e : POP ESI
00504c0f : POP EBP
00504c10 : POP EBX
00504c11 : POP EDI
00504c12 : ADD ESP,0x58
00504c15 : RET 0xc
00504c18 : MOV EAX,dword ptr [EDI + 0xd0]
00504c1e : MOV EDX,dword ptr [EAX + 0x4]
00504c21 : LEA ECX,[EBP + EBP*0x4]
00504c25 : INC EBP
00504c26 : MOV dword ptr [EAX + EBX*0x8 + 0x10],EBP
00504c2a : MOV EAX,dword ptr [EDI + 0xd0]
00504c30 : LEA ESI,[EDX + ECX*0x4]
00504c33 : MOV byte ptr [EAX + EBX*0x8 + 0x14],0x1
00504c38 : TEST ESI,ESI
00504c3a : JZ 0x00504df8
00504c40 : CMP dword ptr [ESI + 0xc],0x0
00504c44 : JNZ 0x00504df8
00504c4a : MOV EAX,dword ptr [ESI + 0x10]
00504c4d : LEA ECX,[EAX + 0x1]
00504c50 : MOV dword ptr [ESI + 0x10],ECX
00504c53 : TEST EAX,EAX
00504c55 : JNZ 0x00504df8
00504c5b : MOV EBX,0xb8654c
00504c60 : JMP 0x00504cb9
00504c62 : MOV ECX,dword ptr [ESP + 0x70]
00504c66 : CMP dword ptr [EAX + ECX*0x8 + 0x10],EBX
00504c6a : JBE 0x00504df8
00504c70 : CMP byte ptr [EAX + ECX*0x8 + 0x14],BL
00504c74 : JZ 0x00504df8
00504c7a : MOV EDX,EAX
00504c7c : MOV byte ptr [EDX + ECX*0x8 + 0x14],BL
00504c80 : MOV EAX,dword ptr [EDI + 0xd0]
00504c86 : MOV EDX,dword ptr [EAX + ECX*0x8 + 0x10]
00504c8a : MOV ESI,dword ptr [EAX + 0x4]
00504c8d : LEA EDX,[EDX + EDX*0x4]
00504c90 : LEA ESI,[ESI + EDX*0x4 + -0x14]
00504c94 : CMP byte ptr [EAX + ECX*0x8 + 0x15],BL
00504c98 : JNZ 0x00504c9e
00504c9a : MOV dword ptr [EAX + ECX*0x8 + 0x10],EBX
00504c9e : CMP dword ptr [ESI + 0x10],EBX
00504ca1 : JBE 0x00504cb9
00504ca3 : DEC dword ptr [ESI + 0x10]
00504ca6 : CMP dword ptr [ESI + 0x10],EBX
00504ca9 : JNZ 0x00504df8
00504caf : CMP dword ptr [ESI + 0xc],EBX
00504cb2 : JBE 0x00504cb9
00504cb4 : MOV EBX,0xb86540
00504cb9 : CMP dword ptr [ESI + 0x8],0x0
00504cbd : JZ 0x00504cf5
00504cbf : MOV EBP,dword ptr [ESI]
00504cc1 : MOV EAX,dword ptr [ESI + 0x4]
00504cc4 : MOV ECX,dword ptr [EDI + 0xa0]
00504cca : ADD EAX,EBP
00504ccc : CMP EAX,EBP
00504cce : JC 0x00504cd4
00504cd0 : SUB EAX,EBP
00504cd2 : JMP 0x00504cd6
00504cd4 : XOR EAX,EAX
00504cd6 : MOV ECX,dword ptr [ECX + 0xc]
00504cd9 : PUSH EAX
00504cda : PUSH EBP
00504cdb : CALL 0x00542320
00504ce0 : MOV ECX,dword ptr [ESI + 0x8]
00504ce3 : MOV EDX,dword ptr [EDI + 0xa0]
00504ce9 : PUSH -0x1
00504ceb : PUSH EBP
00504cec : PUSH ECX
00504ced : MOV ECX,dword ptr [EDX + 0xc]
00504cf0 : CALL 0x00541980
00504cf5 : TEST EBX,EBX
00504cf7 : JZ 0x00504df8
00504cfd : MOV EAX,dword ptr [EDI + 0xd0]
00504d03 : MOV EAX,dword ptr [EAX]
00504d05 : PUSH -0x1
00504d07 : PUSH EBX
00504d08 : PUSH 0x0
00504d0a : LEA ECX,[EAX + 0x30]
00504d0d : CALL 0x0057dec0
00504d12 : MOV EBP,EAX
00504d14 : TEST EBP,EBP
00504d16 : JZ 0x00504df8
00504d1c : MOV ECX,dword ptr [EDI + 0xd0]
00504d22 : MOV EAX,dword ptr [ECX]
00504d24 : PUSH -0x1
00504d26 : PUSH 0xb8653c
00504d2b : PUSH 0x0
00504d2d : LEA ECX,[EAX + 0x30]
00504d30 : CALL 0x0057dec0
00504d35 : MOV EDX,dword ptr [EDI + 0xd0]
00504d3b : PUSH -0x1
00504d3d : MOV EBX,EAX
00504d3f : MOV EAX,dword ptr [EDX]
00504d41 : PUSH 0xb86534
00504d46 : PUSH 0x0
00504d48 : LEA ECX,[EAX + 0x30]
00504d4b : CALL 0x0057dec0
00504d50 : PUSH EDI
00504d51 : MOV dword ptr [ESP + 0x74],EAX
00504d55 : CALL 0x00515dd0
00504d5a : PUSH EAX
00504d5b : LEA ECX,[ESP + 0x14]
00504d5f : CALL 0x00504200
00504d64 : TEST EBX,EBX
00504d66 : JZ 0x00504d8a
00504d68 : PUSH EBX
00504d69 : LEA EAX,[ESP + 0x40]
00504d6d : PUSH EAX
00504d6e : LEA ECX,[ESP + 0x18]
00504d72 : CALL 0x0055fca0
00504d77 : PUSH EAX
00504d78 : LEA ECX,[ESP + 0x14]
00504d7c : CALL 0x00504700
00504d81 : LEA ECX,[ESP + 0x3c]
00504d85 : CALL 0x00504260
00504d8a : MOV EAX,dword ptr [ESP + 0x70]
00504d8e : TEST EAX,EAX
00504d90 : JZ 0x00504db4
00504d92 : PUSH EAX
00504d93 : LEA ECX,[ESP + 0x40]
00504d97 : PUSH ECX
00504d98 : LEA ECX,[ESP + 0x18]
00504d9c : CALL 0x0055fca0
00504da1 : PUSH EAX
00504da2 : LEA ECX,[ESP + 0x14]
00504da6 : CALL 0x00504700
00504dab : LEA ECX,[ESP + 0x3c]
00504daf : CALL 0x00504260
00504db4 : PUSH EBP
00504db5 : LEA EDX,[ESP + 0x40]
00504db9 : PUSH EDX
00504dba : LEA ECX,[ESP + 0x18]
00504dbe : CALL 0x0055fca0
00504dc3 : PUSH EAX
00504dc4 : LEA ECX,[ESP + 0x14]
00504dc8 : CALL 0x00504700
00504dcd : LEA ECX,[ESP + 0x3c]
00504dd1 : CALL 0x00504260
00504dd6 : MOV EAX,dword ptr [ESI]
00504dd8 : MOV ECX,dword ptr [ESI + 0x4]
00504ddb : ADD ECX,EAX
00504ddd : PUSH ECX
00504dde : MOV ECX,dword ptr [EDI + 0xa0]
00504de4 : PUSH EAX
00504de5 : LEA EDX,[ESP + 0x18]
00504de9 : PUSH EDX
00504dea : CALL 0x005449c0
00504def : LEA ECX,[ESP + 0x10]
00504df3 : CALL 0x00504260
00504df8 : POP ESI
00504df9 : POP EBP
00504dfa : POP EBX
00504dfb : POP EDI
00504dfc : ADD ESP,0x58
00504dff : RET 0xc
