PROGRAM  : Maestia.exe
FUNCTION : FUN_006ce520
ENTRY    : 006ce520
BODY     : [[006ce520, 006ce80b]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_006ce520(int param_1,int param_2,int param_3,int param_4)

{
  int iVar1;
  void *_Src;
  undefined4 uVar2;
  size_t _Size;
  undefined4 *puVar3;
  size_t local_14;
  int local_8;
  
  if (((param_1 == 0) || (param_2 == 0)) || (param_4 == 0)) {
    return 0;
  }
  if (*(int *)(param_2 + 0x34) < *(int *)(param_2 + 0x30) + param_4) {
    if (*(int *)(param_2 + 0x38) == 0) {
      *(int *)(param_2 + 0x34) = param_4 + 8;
      *(undefined4 *)(param_2 + 0x30) = 0;
      uVar2 = FUN_006cef50(param_1,*(int *)(param_2 + 0x34) << 4);
      *(undefined4 *)(param_2 + 0x38) = uVar2;
      if (*(int *)(param_2 + 0x38) == 0) {
        return 1;
      }
      *(uint *)(param_2 + 0xb8) = *(uint *)(param_2 + 0xb8) | 0x4000;
    }
    else {
      iVar1 = *(int *)(param_2 + 0x34);
      *(int *)(param_2 + 0x34) = *(int *)(param_2 + 0x30) + 8 + param_4;
      _Src = *(void **)(param_2 + 0x38);
      uVar2 = FUN_006cef50(param_1,*(int *)(param_2 + 0x34) << 4);
      *(undefined4 *)(param_2 + 0x38) = uVar2;
      if (*(int *)(param_2 + 0x38) == 0) {
        FUN_006ceee0(param_1,_Src);
        return 1;
      }
      _memcpy(*(void **)(param_2 + 0x38),_Src,iVar1 << 4);
      FUN_006ceee0(param_1,_Src);
    }
  }
  local_8 = 0;
  do {
    if (param_4 <= local_8) {
      return 0;
    }
    puVar3 = (undefined4 *)(*(int *)(param_2 + 0x30) * 0x10 + *(int *)(param_2 + 0x38));
    if (*(int *)(param_3 + 4 + local_8 * 0x10) != 0) {
      _Size = _strlen(*(char **)(param_3 + 4 + local_8 * 0x10));
      if (*(int *)(param_3 + local_8 * 0x10) < 1) {
        if ((*(int *)(param_3 + 8 + local_8 * 0x10) == 0) ||
           (**(char **)(param_3 + 8 + local_8 * 0x10) == '\0')) {
          local_14 = 0;
          *puVar3 = 0xffffffff;
        }
        else {
          local_14 = _strlen(*(char **)(param_3 + 8 + local_8 * 0x10));
          *puVar3 = *(undefined4 *)(param_3 + local_8 * 0x10);
        }
        uVar2 = FUN_006cef50(param_1,_Size + local_14 + 4);
        puVar3[1] = uVar2;
        if (puVar3[1] == 0) {
          return 1;
        }
        _memcpy((void *)puVar3[1],*(void **)(param_3 + 4 + local_8 * 0x10),_Size);
        *(undefined1 *)(puVar3[1] + _Size) = 0;
        puVar3[2] = puVar3[1] + 1 + _Size;
        if (local_14 != 0) {
          _memcpy((void *)puVar3[2],*(void **)(param_3 + 8 + local_8 * 0x10),local_14);
        }
        *(undefined1 *)(puVar3[2] + local_14) = 0;
        puVar3[3] = local_14;
        *(int *)(param_2 + 0x30) = *(int *)(param_2 + 0x30) + 1;
      }
      else {
        FUN_006c24c0(param_1,"iTXt chunk not supported.");
      }
    }
    local_8 = local_8 + 1;
  } while( true );
}



============================================================
DISASSEMBLY
============================================================
006ce520 : PUSH EBP
006ce521 : MOV EBP,ESP
006ce523 : SUB ESP,0x20
006ce526 : CMP dword ptr [EBP + 0x8],0x0
006ce52a : JZ 0x006ce538
006ce52c : CMP dword ptr [EBP + 0xc],0x0
006ce530 : JZ 0x006ce538
006ce532 : CMP dword ptr [EBP + 0x14],0x0
006ce536 : JNZ 0x006ce53f
006ce538 : XOR EAX,EAX
006ce53a : JMP 0x006ce808
006ce53f : MOV EAX,dword ptr [EBP + 0xc]
006ce542 : MOV ECX,dword ptr [EAX + 0x30]
006ce545 : ADD ECX,dword ptr [EBP + 0x14]
006ce548 : MOV EDX,dword ptr [EBP + 0xc]
006ce54b : CMP ECX,dword ptr [EDX + 0x34]
006ce54e : JLE 0x006ce64e
006ce554 : MOV EAX,dword ptr [EBP + 0xc]
006ce557 : CMP dword ptr [EAX + 0x38],0x0
006ce55b : JZ 0x006ce5f1
006ce561 : MOV ECX,dword ptr [EBP + 0xc]
006ce564 : MOV EDX,dword ptr [ECX + 0x34]
006ce567 : MOV dword ptr [EBP + -0x8],EDX
006ce56a : MOV EAX,dword ptr [EBP + 0xc]
006ce56d : MOV ECX,dword ptr [EAX + 0x30]
006ce570 : MOV EDX,dword ptr [EBP + 0x14]
006ce573 : LEA EAX,[ECX + EDX*0x1 + 0x8]
006ce577 : MOV ECX,dword ptr [EBP + 0xc]
006ce57a : MOV dword ptr [ECX + 0x34],EAX
006ce57d : MOV EDX,dword ptr [EBP + 0xc]
006ce580 : MOV EAX,dword ptr [EDX + 0x38]
006ce583 : MOV dword ptr [EBP + -0xc],EAX
006ce586 : MOV ECX,dword ptr [EBP + 0xc]
006ce589 : MOV EDX,dword ptr [ECX + 0x34]
006ce58c : SHL EDX,0x4
006ce58f : PUSH EDX
006ce590 : MOV EAX,dword ptr [EBP + 0x8]
006ce593 : PUSH EAX
006ce594 : CALL 0x006cef50
006ce599 : ADD ESP,0x8
006ce59c : MOV ECX,dword ptr [EBP + 0xc]
006ce59f : MOV dword ptr [ECX + 0x38],EAX
006ce5a2 : MOV EDX,dword ptr [EBP + 0xc]
006ce5a5 : CMP dword ptr [EDX + 0x38],0x0
006ce5a9 : JNZ 0x006ce5c5
006ce5ab : MOV EAX,dword ptr [EBP + -0xc]
006ce5ae : PUSH EAX
006ce5af : MOV ECX,dword ptr [EBP + 0x8]
006ce5b2 : PUSH ECX
006ce5b3 : CALL 0x006ceee0
006ce5b8 : ADD ESP,0x8
006ce5bb : MOV EAX,0x1
006ce5c0 : JMP 0x006ce808
006ce5c5 : MOV EDX,dword ptr [EBP + -0x8]
006ce5c8 : SHL EDX,0x4
006ce5cb : PUSH EDX
006ce5cc : MOV EAX,dword ptr [EBP + -0xc]
006ce5cf : PUSH EAX
006ce5d0 : MOV ECX,dword ptr [EBP + 0xc]
006ce5d3 : MOV EDX,dword ptr [ECX + 0x38]
006ce5d6 : PUSH EDX
006ce5d7 : CALL 0x0063ae40
006ce5dc : ADD ESP,0xc
006ce5df : MOV EAX,dword ptr [EBP + -0xc]
006ce5e2 : PUSH EAX
006ce5e3 : MOV ECX,dword ptr [EBP + 0x8]
006ce5e6 : PUSH ECX
006ce5e7 : CALL 0x006ceee0
006ce5ec : ADD ESP,0x8
006ce5ef : JMP 0x006ce64e
006ce5f1 : MOV EDX,dword ptr [EBP + 0x14]
006ce5f4 : ADD EDX,0x8
006ce5f7 : MOV EAX,dword ptr [EBP + 0xc]
006ce5fa : MOV dword ptr [EAX + 0x34],EDX
006ce5fd : MOV ECX,dword ptr [EBP + 0xc]
006ce600 : MOV dword ptr [ECX + 0x30],0x0
006ce607 : MOV EDX,dword ptr [EBP + 0xc]
006ce60a : MOV EAX,dword ptr [EDX + 0x34]
006ce60d : SHL EAX,0x4
006ce610 : PUSH EAX
006ce611 : MOV ECX,dword ptr [EBP + 0x8]
006ce614 : PUSH ECX
006ce615 : CALL 0x006cef50
006ce61a : ADD ESP,0x8
006ce61d : MOV EDX,dword ptr [EBP + 0xc]
006ce620 : MOV dword ptr [EDX + 0x38],EAX
006ce623 : MOV EAX,dword ptr [EBP + 0xc]
006ce626 : CMP dword ptr [EAX + 0x38],0x0
006ce62a : JNZ 0x006ce636
006ce62c : MOV EAX,0x1
006ce631 : JMP 0x006ce808
006ce636 : MOV ECX,dword ptr [EBP + 0xc]
006ce639 : MOV EDX,dword ptr [ECX + 0xb8]
006ce63f : OR EDX,0x4000
006ce645 : MOV EAX,dword ptr [EBP + 0xc]
006ce648 : MOV dword ptr [EAX + 0xb8],EDX
006ce64e : MOV dword ptr [EBP + -0x4],0x0
006ce655 : JMP 0x006ce660
006ce657 : MOV ECX,dword ptr [EBP + -0x4]
006ce65a : ADD ECX,0x1
006ce65d : MOV dword ptr [EBP + -0x4],ECX
006ce660 : MOV EDX,dword ptr [EBP + -0x4]
006ce663 : CMP EDX,dword ptr [EBP + 0x14]
006ce666 : JGE 0x006ce806
006ce66c : MOV EAX,dword ptr [EBP + 0xc]
006ce66f : MOV ECX,dword ptr [EAX + 0x30]
006ce672 : SHL ECX,0x4
006ce675 : MOV EDX,dword ptr [EBP + 0xc]
006ce678 : ADD ECX,dword ptr [EDX + 0x38]
006ce67b : MOV dword ptr [EBP + -0x1c],ECX
006ce67e : MOV EAX,dword ptr [EBP + -0x4]
006ce681 : SHL EAX,0x4
006ce684 : MOV ECX,dword ptr [EBP + 0x10]
006ce687 : CMP dword ptr [ECX + EAX*0x1 + 0x4],0x0
006ce68c : JNZ 0x006ce690
006ce68e : JMP 0x006ce657
006ce690 : MOV EDX,dword ptr [EBP + -0x4]
006ce693 : SHL EDX,0x4
006ce696 : MOV EAX,dword ptr [EBP + 0x10]
006ce699 : MOV ECX,dword ptr [EAX + EDX*0x1 + 0x4]
006ce69d : PUSH ECX
006ce69e : CALL 0x00640960
006ce6a3 : ADD ESP,0x4
006ce6a6 : MOV dword ptr [EBP + -0x14],EAX
006ce6a9 : MOV EDX,dword ptr [EBP + -0x4]
006ce6ac : SHL EDX,0x4
006ce6af : MOV EAX,dword ptr [EBP + 0x10]
006ce6b2 : CMP dword ptr [EAX + EDX*0x1],0x0
006ce6b6 : JG 0x006ce6c8
006ce6b8 : MOV dword ptr [EBP + -0x18],0x0
006ce6bf : MOV dword ptr [EBP + -0x20],0x0
006ce6c6 : JMP 0x006ce6de
006ce6c8 : PUSH 0xbedf08
006ce6cd : MOV ECX,dword ptr [EBP + 0x8]
006ce6d0 : PUSH ECX
006ce6d1 : CALL 0x006c24c0
006ce6d6 : ADD ESP,0x8
006ce6d9 : JMP 0x006ce657
006ce6de : MOV EDX,dword ptr [EBP + -0x4]
006ce6e1 : SHL EDX,0x4
006ce6e4 : MOV EAX,dword ptr [EBP + 0x10]
006ce6e7 : CMP dword ptr [EAX + EDX*0x1 + 0x8],0x0
006ce6ec : JZ 0x006ce702
006ce6ee : MOV ECX,dword ptr [EBP + -0x4]
006ce6f1 : SHL ECX,0x4
006ce6f4 : MOV EDX,dword ptr [EBP + 0x10]
006ce6f7 : MOV EAX,dword ptr [EDX + ECX*0x1 + 0x8]
006ce6fb : MOVSX ECX,byte ptr [EAX]
006ce6fe : TEST ECX,ECX
006ce700 : JNZ 0x006ce714
006ce702 : MOV dword ptr [EBP + -0x10],0x0
006ce709 : MOV EDX,dword ptr [EBP + -0x1c]
006ce70c : MOV dword ptr [EDX],0xffffffff
006ce712 : JMP 0x006ce73e
006ce714 : MOV EAX,dword ptr [EBP + -0x4]
006ce717 : SHL EAX,0x4
006ce71a : MOV ECX,dword ptr [EBP + 0x10]
006ce71d : MOV EDX,dword ptr [ECX + EAX*0x1 + 0x8]
006ce721 : PUSH EDX
006ce722 : CALL 0x00640960
006ce727 : ADD ESP,0x4
006ce72a : MOV dword ptr [EBP + -0x10],EAX
006ce72d : MOV EAX,dword ptr [EBP + -0x4]
006ce730 : SHL EAX,0x4
006ce733 : MOV ECX,dword ptr [EBP + -0x1c]
006ce736 : MOV EDX,dword ptr [EBP + 0x10]
006ce739 : MOV EAX,dword ptr [EDX + EAX*0x1]
006ce73c : MOV dword ptr [ECX],EAX
006ce73e : MOV ECX,dword ptr [EBP + -0x14]
006ce741 : ADD ECX,dword ptr [EBP + -0x10]
006ce744 : ADD ECX,dword ptr [EBP + -0x18]
006ce747 : MOV EDX,dword ptr [EBP + -0x20]
006ce74a : LEA EAX,[ECX + EDX*0x1 + 0x4]
006ce74e : PUSH EAX
006ce74f : MOV ECX,dword ptr [EBP + 0x8]
006ce752 : PUSH ECX
006ce753 : CALL 0x006cef50
006ce758 : ADD ESP,0x8
006ce75b : MOV EDX,dword ptr [EBP + -0x1c]
006ce75e : MOV dword ptr [EDX + 0x4],EAX
006ce761 : MOV EAX,dword ptr [EBP + -0x1c]
006ce764 : CMP dword ptr [EAX + 0x4],0x0
006ce768 : JNZ 0x006ce774
006ce76a : MOV EAX,0x1
006ce76f : JMP 0x006ce808
006ce774 : MOV ECX,dword ptr [EBP + -0x14]
006ce777 : PUSH ECX
006ce778 : MOV EDX,dword ptr [EBP + -0x4]
006ce77b : SHL EDX,0x4
006ce77e : MOV EAX,dword ptr [EBP + 0x10]
006ce781 : MOV ECX,dword ptr [EAX + EDX*0x1 + 0x4]
006ce785 : PUSH ECX
006ce786 : MOV EDX,dword ptr [EBP + -0x1c]
006ce789 : MOV EAX,dword ptr [EDX + 0x4]
006ce78c : PUSH EAX
006ce78d : CALL 0x0063ae40
006ce792 : ADD ESP,0xc
006ce795 : MOV ECX,dword ptr [EBP + -0x1c]
006ce798 : MOV EDX,dword ptr [ECX + 0x4]
006ce79b : MOV EAX,dword ptr [EBP + -0x14]
006ce79e : MOV byte ptr [EDX + EAX*0x1],0x0
006ce7a2 : MOV ECX,dword ptr [EBP + -0x1c]
006ce7a5 : MOV EDX,dword ptr [ECX + 0x4]
006ce7a8 : MOV EAX,dword ptr [EBP + -0x14]
006ce7ab : LEA ECX,[EDX + EAX*0x1 + 0x1]
006ce7af : MOV EDX,dword ptr [EBP + -0x1c]
006ce7b2 : MOV dword ptr [EDX + 0x8],ECX
006ce7b5 : CMP dword ptr [EBP + -0x10],0x0
006ce7b9 : JZ 0x006ce7dc
006ce7bb : MOV EAX,dword ptr [EBP + -0x10]
006ce7be : PUSH EAX
006ce7bf : MOV ECX,dword ptr [EBP + -0x4]
006ce7c2 : SHL ECX,0x4
006ce7c5 : MOV EDX,dword ptr [EBP + 0x10]
006ce7c8 : MOV EAX,dword ptr [EDX + ECX*0x1 + 0x8]
006ce7cc : PUSH EAX
006ce7cd : MOV ECX,dword ptr [EBP + -0x1c]
006ce7d0 : MOV EDX,dword ptr [ECX + 0x8]
006ce7d3 : PUSH EDX
006ce7d4 : CALL 0x0063ae40
006ce7d9 : ADD ESP,0xc
006ce7dc : MOV EAX,dword ptr [EBP + -0x1c]
006ce7df : MOV ECX,dword ptr [EAX + 0x8]
006ce7e2 : MOV EDX,dword ptr [EBP + -0x10]
006ce7e5 : MOV byte ptr [ECX + EDX*0x1],0x0
006ce7e9 : MOV EAX,dword ptr [EBP + -0x1c]
006ce7ec : MOV ECX,dword ptr [EBP + -0x10]
006ce7ef : MOV dword ptr [EAX + 0xc],ECX
006ce7f2 : MOV EDX,dword ptr [EBP + 0xc]
006ce7f5 : MOV EAX,dword ptr [EDX + 0x30]
006ce7f8 : ADD EAX,0x1
006ce7fb : MOV ECX,dword ptr [EBP + 0xc]
006ce7fe : MOV dword ptr [ECX + 0x30],EAX
006ce801 : JMP 0x006ce657
006ce806 : XOR EAX,EAX
006ce808 : MOV ESP,EBP
006ce80a : POP EBP
006ce80b : RET
