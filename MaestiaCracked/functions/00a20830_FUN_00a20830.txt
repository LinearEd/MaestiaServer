PROGRAM  : Maestia.exe
FUNCTION : FUN_00a20830
ENTRY    : 00a20830
BODY     : [[00a20830, 00a20a87]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a20830(int *param_1,int param_2)

{
  uint uVar1;
  uint uVar2;
  int *piVar3;
  uint uVar4;
  int iVar5;
  undefined4 uVar6;
  code *pcVar7;
  char cVar8;
  undefined1 local_2c [28];
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b263b9;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if ((*(int *)(param_1[0x2b] + 0x1f54) != 0) &&
     (iVar5 = FUN_00ab6640(*(undefined4 *)(param_2 + 4)), iVar5 != 0)) {
    cVar8 = *(char *)(param_2 + 0xc);
    if ((cVar8 == '\x01') || (cVar8 == '\x05')) {
      FUN_00a90a50(*(undefined4 *)(param_2 + 0xd),*(undefined4 *)(param_2 + 0x11));
    }
    else if (cVar8 == -0x35) {
      FUN_00a909b0(*(undefined4 *)(param_2 + 0xd),*(undefined4 *)(param_2 + 0x11));
    }
  }
  uVar6 = *(undefined4 *)(param_2 + 4);
  iVar5 = FUN_00a1a840(uVar6);
  if (((iVar5 == 0) && (iVar5 = FUN_00a1a6d0(uVar6), iVar5 == 0)) &&
     (iVar5 = FUN_00a1a780(uVar6), iVar5 == 0)) {
    ExceptionList = local_10;
    return;
  }
  iVar5 = *(int *)(param_2 + 4);
  cVar8 = *(char *)(param_2 + 0xc);
  if (iVar5 != *(int *)(param_1[0x2b] + 4)) {
    if (cVar8 != '\x05') {
      if (cVar8 == -0x37) {
        cVar8 = -1;
        goto LAB_00a20a37;
      }
      if (cVar8 != -0x35) {
        ExceptionList = local_10;
        return;
      }
      goto switchD_00a20931_caseD_cb;
    }
switchD_00a20931_caseD_5:
    pcVar7 = *(code **)(*param_1 + 0xd4);
    goto LAB_00a20a67;
  }
  switch(cVar8) {
  case '\x05':
    goto switchD_00a20931_caseD_5;
  default:
    goto switchD_00a20931_caseD_6;
  case -0x37:
  case -0x32:
  case -0x31:
    goto LAB_00a20a37;
  case -0x36:
    pcVar7 = *(code **)(*param_1 + 0xd0);
    break;
  case -0x35:
switchD_00a20931_caseD_cb:
    pcVar7 = *(code **)(*param_1 + 0xd8);
    break;
  case -0x34:
    pcVar7 = *(code **)(*param_1 + 0xb0);
    break;
  case -0x33:
    pcVar7 = *(code **)(*param_1 + 0xac);
    break;
  case -0x2f:
    uVar1 = *(uint *)(param_1[0x2b] + 0x1ed0);
    uVar2 = *(uint *)(param_2 + 0x11);
    if (uVar1 < uVar2) {
      FUN_00406460(L"IDS_ZONE_GETGOLD");
      local_8 = 0;
      piVar3 = *(int **)(*DAT_00da9894 + 0x1a8);
      iVar5 = FUN_0081d120(local_2c);
      local_8._0_1_ = 1;
      if (*(uint *)(iVar5 + 0x18) < 8) {
        iVar5 = iVar5 + 4;
      }
      else {
        iVar5 = *(int *)(iVar5 + 4);
      }
      uVar6 = FUN_00404750(iVar5,uVar2 - uVar1);
      local_8._0_1_ = 2;
      (**(code **)(*piVar3 + 0x44))(uVar6,4);
      local_8._0_1_ = 1;
      FUN_00406560();
      local_8 = (uint)local_8._1_3_ << 8;
      FUN_00406560();
      local_8 = 0xffffffff;
      FUN_00406560();
    }
    cVar8 = *(char *)(param_2 + 0xc);
    iVar5 = *(int *)(param_2 + 4);
LAB_00a20a37:
    (**(code **)(*param_1 + 0xcc))
              (*(undefined4 *)(param_2 + 0xd),*(undefined4 *)(param_2 + 0x11),iVar5,cVar8,uVar4);
    ExceptionList = local_10;
    return;
  case -0x2c:
    pcVar7 = *(code **)(*param_1 + 0xb4);
  }
LAB_00a20a67:
  (*pcVar7)(*(undefined4 *)(param_2 + 0xd),*(undefined4 *)(param_2 + 0x11),iVar5);
switchD_00a20931_caseD_6:
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00a20830 : PUSH EBP
00a20831 : MOV EBP,ESP
00a20833 : PUSH -0x1
00a20835 : PUSH 0xb263b9
00a2083a : MOV EAX,FS:[0x0]
00a20840 : PUSH EAX
00a20841 : SUB ESP,0x54
00a20844 : PUSH EBX
00a20845 : PUSH ESI
00a20846 : PUSH EDI
00a20847 : MOV EAX,[0x00d66fa0]
00a2084c : XOR EAX,EBP
00a2084e : PUSH EAX
00a2084f : LEA EAX,[EBP + -0xc]
00a20852 : MOV FS:[0x0],EAX
00a20858 : MOV EBX,dword ptr [EBP + 0xc]
00a2085b : MOV ESI,dword ptr [EBP + 0x8]
00a2085e : MOV EAX,dword ptr [ESI + 0xac]
00a20864 : CMP dword ptr [EAX + 0x1f54],0x0
00a2086b : JZ 0x00a208d5
00a2086d : MOV ECX,dword ptr [EBX + 0x4]
00a20870 : MOV EAX,dword ptr [EAX + 0x1f54]
00a20876 : PUSH ECX
00a20877 : MOV ECX,EAX
00a20879 : CALL 0x00ab6640
00a2087e : TEST EAX,EAX
00a20880 : JZ 0x00a208d5
00a20882 : MOVZX EAX,byte ptr [EBX + 0xc]
00a20886 : SUB EAX,0x1
00a20889 : JZ 0x00a208b7
00a2088b : SUB EAX,0x4
00a2088e : JZ 0x00a208b7
00a20890 : SUB EAX,0xc6
00a20895 : JNZ 0x00a208d5
00a20897 : MOV EDX,dword ptr [0x00da9894]
00a2089d : MOV EAX,dword ptr [EDX]
00a2089f : MOV EDI,dword ptr [EAX + 0x14c]
00a208a5 : MOV EAX,dword ptr [EBX + 0x11]
00a208a8 : MOV ECX,dword ptr [EBX + 0xd]
00a208ab : PUSH EAX
00a208ac : MOV EAX,dword ptr [EBX + 0x4]
00a208af : PUSH ECX
00a208b0 : CALL 0x00a909b0
00a208b5 : JMP 0x00a208d5
00a208b7 : MOV EDX,dword ptr [0x00da9894]
00a208bd : MOV EAX,dword ptr [EDX]
00a208bf : MOV EDI,dword ptr [EAX + 0x14c]
00a208c5 : MOV EAX,dword ptr [EBX + 0x11]
00a208c8 : MOV ECX,dword ptr [EBX + 0xd]
00a208cb : PUSH EAX
00a208cc : MOV EAX,dword ptr [EBX + 0x4]
00a208cf : PUSH ECX
00a208d0 : CALL 0x00a90a50
00a208d5 : MOV EDI,dword ptr [EBX + 0x4]
00a208d8 : PUSH EDI
00a208d9 : MOV ECX,ESI
00a208db : CALL 0x00a1a840
00a208e0 : TEST EAX,EAX
00a208e2 : JNZ 0x00a20900
00a208e4 : PUSH EDI
00a208e5 : MOV ECX,ESI
00a208e7 : CALL 0x00a1a6d0
00a208ec : TEST EAX,EAX
00a208ee : JNZ 0x00a20900
00a208f0 : PUSH EDI
00a208f1 : MOV ECX,ESI
00a208f3 : CALL 0x00a1a780
00a208f8 : TEST EAX,EAX
00a208fa : JZ 0x00a20a74
00a20900 : MOV EDX,dword ptr [ESI + 0xac]
00a20906 : MOV ECX,dword ptr [EDX + 0x4]
00a20909 : MOV EAX,dword ptr [EBX + 0x4]
00a2090c : CMP EAX,ECX
00a2090e : MOVZX ECX,byte ptr [EBX + 0xc]
00a20912 : JNZ 0x00a20a15
00a20918 : MOVZX EDI,CL
00a2091b : ADD EDI,-0x5
00a2091e : CMP EDI,0xcf
00a20924 : JA 0x00a20a74
00a2092a : MOVZX EDI,byte ptr [EDI + 0xa20aac]
00a20931 : JMP dword ptr [EDI*0x4 + 0xa20a88]
00a20938 : PUSH ECX
00a20939 : JMP 0x00a20a36
00a2093e : MOV ECX,dword ptr [EDX + 0x1ed0]
00a20944 : MOV EAX,dword ptr [EBX + 0x11]
00a20947 : CMP ECX,EAX
00a20949 : JNC 0x00a209e2
00a2094f : SUB EAX,ECX
00a20951 : PUSH 0xcc3274
00a20956 : LEA ECX,[EBP + -0x28]
00a20959 : MOV ESI,EAX
00a2095b : CALL 0x00406460
00a20960 : MOV dword ptr [EBP + -0x4],0x0
00a20967 : MOV EAX,[0x00da9894]
00a2096c : MOV EAX,dword ptr [EAX]
00a2096e : MOV ECX,dword ptr [EAX + 0x1a8]
00a20974 : LEA EDX,[EBP + -0x28]
00a20977 : MOV dword ptr [EBP + 0xc],ECX
00a2097a : MOV ECX,dword ptr [0x0172491c]
00a20980 : PUSH EDX
00a20981 : LEA EDI,[EBP + -0x60]
00a20984 : CALL 0x0081d120
00a20989 : MOV byte ptr [EBP + -0x4],0x1
00a2098d : CMP dword ptr [EAX + 0x18],0x8
00a20991 : JC 0x00a20998
00a20993 : MOV EAX,dword ptr [EAX + 0x4]
00a20996 : JMP 0x00a2099b
00a20998 : ADD EAX,0x4
00a2099b : PUSH ESI
00a2099c : PUSH EAX
00a2099d : LEA ESI,[EBP + -0x44]
00a209a0 : CALL 0x00404750
00a209a5 : ADD ESP,0x8
00a209a8 : MOV byte ptr [EBP + -0x4],0x2
00a209ac : MOV ECX,dword ptr [EBP + 0xc]
00a209af : MOV EDX,dword ptr [ECX]
00a209b1 : PUSH 0x4
00a209b3 : PUSH EAX
00a209b4 : MOV EAX,dword ptr [EDX + 0x44]
00a209b7 : CALL EAX
00a209b9 : MOV byte ptr [EBP + -0x4],0x1
00a209bd : MOV ECX,ESI
00a209bf : CALL 0x00406560
00a209c4 : MOV byte ptr [EBP + -0x4],0x0
00a209c8 : LEA ECX,[EBP + -0x60]
00a209cb : CALL 0x00406560
00a209d0 : MOV dword ptr [EBP + -0x4],0xffffffff
00a209d7 : LEA ECX,[EBP + -0x28]
00a209da : CALL 0x00406560
00a209df : MOV ESI,dword ptr [EBP + 0x8]
00a209e2 : MOVZX EAX,byte ptr [EBX + 0xc]
00a209e6 : MOV ECX,dword ptr [EBX + 0x4]
00a209e9 : PUSH EAX
00a209ea : PUSH ECX
00a209eb : JMP 0x00a20a37
00a209ed : MOV EDX,dword ptr [ESI]
00a209ef : MOV EDX,dword ptr [EDX + 0xd0]
00a209f5 : JMP 0x00a20a67
00a209f7 : MOV EDX,dword ptr [ESI]
00a209f9 : MOV EDX,dword ptr [EDX + 0xb0]
00a209ff : JMP 0x00a20a67
00a20a01 : MOV EDX,dword ptr [ESI]
00a20a03 : MOV EDX,dword ptr [EDX + 0xb4]
00a20a09 : JMP 0x00a20a67
00a20a0b : MOV EDX,dword ptr [ESI]
00a20a0d : MOV EDX,dword ptr [EDX + 0xac]
00a20a13 : JMP 0x00a20a67
00a20a15 : SUB ECX,0x5
00a20a18 : JZ 0x00a20a5f
00a20a1a : SUB ECX,0xc4
00a20a20 : JZ 0x00a20a31
00a20a22 : SUB ECX,0x2
00a20a25 : JNZ 0x00a20a74
00a20a27 : MOV EDX,dword ptr [ESI]
00a20a29 : MOV EDX,dword ptr [EDX + 0xd8]
00a20a2f : JMP 0x00a20a67
00a20a31 : PUSH 0xff
00a20a36 : PUSH EAX
00a20a37 : MOV EAX,dword ptr [EBX + 0x11]
00a20a3a : MOV ECX,dword ptr [EBX + 0xd]
00a20a3d : MOV EDX,dword ptr [ESI]
00a20a3f : MOV EDX,dword ptr [EDX + 0xcc]
00a20a45 : PUSH EAX
00a20a46 : PUSH ECX
00a20a47 : MOV ECX,ESI
00a20a49 : CALL EDX
00a20a4b : MOV ECX,dword ptr [EBP + -0xc]
00a20a4e : MOV dword ptr FS:[0x0],ECX
00a20a55 : POP ECX
00a20a56 : POP EDI
00a20a57 : POP ESI
00a20a58 : POP EBX
00a20a59 : MOV ESP,EBP
00a20a5b : POP EBP
00a20a5c : RET 0x8
00a20a5f : MOV EDX,dword ptr [ESI]
00a20a61 : MOV EDX,dword ptr [EDX + 0xd4]
00a20a67 : MOV ECX,dword ptr [EBX + 0xd]
00a20a6a : PUSH EAX
00a20a6b : MOV EAX,dword ptr [EBX + 0x11]
00a20a6e : PUSH EAX
00a20a6f : PUSH ECX
00a20a70 : MOV ECX,ESI
00a20a72 : CALL EDX
00a20a74 : MOV ECX,dword ptr [EBP + -0xc]
00a20a77 : MOV dword ptr FS:[0x0],ECX
00a20a7e : POP ECX
00a20a7f : POP EDI
00a20a80 : POP ESI
00a20a81 : POP EBX
00a20a82 : MOV ESP,EBP
00a20a84 : POP EBP
00a20a85 : RET 0x8
