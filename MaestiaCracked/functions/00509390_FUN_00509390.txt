PROGRAM  : Maestia.exe
FUNCTION : FUN_00509390
ENTRY    : 00509390
BODY     : [[00509390, 0050942c] [00509430, 005094c7]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00509390(undefined4 param_1,undefined4 *param_2,uint param_3)

{
  uint *puVar1;
  int iVar2;
  int *piVar3;
  uint *puVar4;
  int *in_ECX;
  uint uVar5;
  uint uVar6;
  int iVar7;
  int iVar8;
  
  piVar3 = (int *)*in_ECX;
  if (piVar3 == (int *)0x0) {
    iVar8 = 8;
  }
  else {
    if ((uint)(*piVar3 * 5) <= piVar3[1] * 4 + 4U) goto LAB_005093ca;
    iVar8 = piVar3[1] * 2 + 2;
  }
  FUN_005088c0(param_1,iVar8);
LAB_005093ca:
  piVar3 = (int *)*in_ECX;
  param_3 = param_3 & piVar3[1];
  *piVar3 = *piVar3 + 1;
  iVar8 = *in_ECX;
  puVar1 = (uint *)(param_3 * 0x10 + 8 + iVar8);
  if (*puVar1 == 0xfffffffe) {
    *puVar1 = 0xffffffff;
    uVar5 = *(uint *)*param_2;
    puVar1[1] = uVar5;
    piVar3 = (int *)(uVar5 + 8);
    *piVar3 = *piVar3 + 1;
    puVar4 = (uint *)param_2[1];
    puVar1[2] = *puVar4;
    uVar5 = puVar4[1];
    if (uVar5 != 0) {
      *(uint *)(uVar5 + 8) = *(int *)(uVar5 + 8) + 1U & 0x8fffffff;
    }
    puVar1[3] = puVar4[1];
    return;
  }
  uVar5 = param_3;
  do {
    uVar5 = uVar5 + 1 & *(uint *)(iVar8 + 4);
  } while (*(int *)(iVar8 + 8 + uVar5 * 0x10) != -2);
  iVar2 = uVar5 * 0x10 + 8 + iVar8;
  uVar6 = *(uint *)(puVar1[1] + 0xc) & *(uint *)(iVar8 + 4);
  if (uVar6 == param_3) {
    if (iVar2 != 0) {
      FUN_00507eb0(puVar1);
    }
    FUN_00507660(param_2);
    *puVar1 = uVar5;
    return;
  }
  iVar7 = uVar6 * 0x10;
  uVar6 = *(uint *)(iVar7 + 8 + iVar8);
  while (puVar4 = (uint *)(iVar7 + 8 + iVar8), uVar6 != param_3) {
    iVar7 = *puVar4 * 0x10;
    uVar6 = *(uint *)(iVar7 + 8 + iVar8);
  }
  if (iVar2 != 0) {
    FUN_00507eb0(puVar1);
  }
  *puVar4 = uVar5;
  FUN_00507660(param_2);
  *puVar1 = 0xffffffff;
  return;
}



============================================================
DISASSEMBLY
============================================================
00509390 : PUSH ESI
00509391 : MOV ESI,ECX
00509393 : MOV EAX,dword ptr [ESI]
00509395 : PUSH EDI
00509396 : TEST EAX,EAX
00509398 : JNZ 0x005093a3
0050939a : MOV EAX,dword ptr [ESP + 0xc]
0050939e : PUSH 0x8
005093a0 : PUSH EAX
005093a1 : JMP 0x005093c5
005093a3 : MOV ECX,dword ptr [EAX + 0x4]
005093a6 : LEA EDX,[ECX*0x4 + 0x4]
005093ad : MOV ECX,dword ptr [EAX]
005093af : LEA ECX,[ECX + ECX*0x4]
005093b2 : CMP ECX,EDX
005093b4 : JBE 0x005093ca
005093b6 : MOV EDX,dword ptr [EAX + 0x4]
005093b9 : MOV ECX,dword ptr [ESP + 0xc]
005093bd : LEA EAX,[EDX + EDX*0x1 + 0x2]
005093c1 : PUSH EAX
005093c2 : PUSH ECX
005093c3 : MOV ECX,ESI
005093c5 : CALL 0x005088c0
005093ca : MOV EAX,dword ptr [ESI]
005093cc : MOV EDX,dword ptr [ESP + 0x14]
005093d0 : AND EDX,dword ptr [EAX + 0x4]
005093d3 : INC dword ptr [EAX]
005093d5 : MOV EAX,dword ptr [ESI]
005093d7 : MOV ECX,EDX
005093d9 : SHL ECX,0x4
005093dc : LEA ESI,[ECX + EAX*0x1 + 0x8]
005093e0 : MOV EDI,0xfffffffe
005093e5 : CMP dword ptr [ESI],EDI
005093e7 : JNZ 0x00509424
005093e9 : MOV ECX,dword ptr [ESP + 0x10]
005093ed : MOV dword ptr [ESI],0xffffffff
005093f3 : MOV EDX,dword ptr [ECX]
005093f5 : MOV EAX,dword ptr [EDX]
005093f7 : MOV dword ptr [ESI + 0x4],EAX
005093fa : INC dword ptr [EAX + 0x8]
005093fd : MOV EAX,dword ptr [ECX + 0x4]
00509400 : MOV ECX,dword ptr [EAX]
00509402 : MOV dword ptr [ESI + 0x8],ECX
00509405 : MOV ECX,dword ptr [EAX + 0x4]
00509408 : TEST ECX,ECX
0050940a : JZ 0x00509419
0050940c : MOV EDX,dword ptr [ECX + 0x8]
0050940f : INC EDX
00509410 : AND EDX,0x8fffffff
00509416 : MOV dword ptr [ECX + 0x8],EDX
00509419 : MOV EAX,dword ptr [EAX + 0x4]
0050941c : POP EDI
0050941d : MOV dword ptr [ESI + 0xc],EAX
00509420 : POP ESI
00509421 : RET 0xc
00509424 : MOV ECX,dword ptr [EAX + 0x4]
00509427 : PUSH EBX
00509428 : MOV EBX,EDX
0050942a : PUSH EBP
0050942b : JMP 0x00509430
00509430 : INC EBX
00509431 : AND EBX,ECX
00509433 : MOV EBP,EBX
00509435 : SHL EBP,0x4
00509438 : CMP dword ptr [EAX + EBP*0x1 + 0x8],EDI
0050943c : JNZ 0x00509430
0050943e : MOV EDI,EBX
00509440 : SHL EDI,0x4
00509443 : LEA EDI,[EDI + EAX*0x1 + 0x8]
00509447 : MOV dword ptr [ESP + 0x14],EDI
0050944b : MOV EDI,dword ptr [ESI + 0x4]
0050944e : MOV EDI,dword ptr [EDI + 0xc]
00509451 : LEA EBP,[ESI + 0x4]
00509454 : AND EDI,ECX
00509456 : CMP EDI,EDX
00509458 : JNZ 0x0050947d
0050945a : MOV ECX,dword ptr [ESP + 0x14]
0050945e : TEST ECX,ECX
00509460 : JZ 0x00509468
00509462 : PUSH ESI
00509463 : CALL 0x00507eb0
00509468 : MOV ECX,dword ptr [ESP + 0x18]
0050946c : PUSH ECX
0050946d : MOV ECX,EBP
0050946f : CALL 0x00507660
00509474 : POP EBP
00509475 : MOV dword ptr [ESI],EBX
00509477 : POP EBX
00509478 : POP EDI
00509479 : POP ESI
0050947a : RET 0xc
0050947d : SHL EDI,0x4
00509480 : CMP dword ptr [EDI + EAX*0x1 + 0x8],EDX
00509484 : LEA EDI,[EDI + EAX*0x1 + 0x8]
00509488 : JZ 0x0050949f
0050948a : LEA EBX,[EBX]
00509490 : MOV ECX,dword ptr [EDI]
00509492 : SHL ECX,0x4
00509495 : CMP dword ptr [ECX + EAX*0x1 + 0x8],EDX
00509499 : LEA EDI,[ECX + EAX*0x1 + 0x8]
0050949d : JNZ 0x00509490
0050949f : MOV ECX,dword ptr [ESP + 0x14]
005094a3 : TEST ECX,ECX
005094a5 : JZ 0x005094ad
005094a7 : PUSH ESI
005094a8 : CALL 0x00507eb0
005094ad : MOV EDX,dword ptr [ESP + 0x18]
005094b1 : PUSH EDX
005094b2 : MOV ECX,EBP
005094b4 : MOV dword ptr [EDI],EBX
005094b6 : CALL 0x00507660
005094bb : POP EBP
005094bc : POP EBX
005094bd : POP EDI
005094be : MOV dword ptr [ESI],0xffffffff
005094c4 : POP ESI
005094c5 : RET 0xc
