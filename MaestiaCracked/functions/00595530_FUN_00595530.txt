PROGRAM  : Maestia.exe
FUNCTION : FUN_00595530
ENTRY    : 00595530
BODY     : [[00595530, 00595854]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00595530(GRefCountImpl *param_1,int param_2,int param_3,int *param_4,undefined4 param_5,
                 char param_6)

{
  byte bVar1;
  GRefCountNTSImpl *this;
  int *piVar2;
  char cVar3;
  byte bVar4;
  uint uVar5;
  int iVar6;
  undefined4 uVar7;
  undefined4 *in_ECX;
  char cVar8;
  undefined4 *puVar9;
  uint uVar10;
  
  cVar3 = param_6;
  FUN_00522570(param_2,param_4,param_5);
  *in_ECX = &PTR_FUN_00b8e9d8;
  in_ECX[3] = &PTR_LAB_00b8e9cc;
  in_ECX[0x1a] = &PTR_LAB_00b8e978;
  if (param_1 != (GRefCountImpl *)0x0) {
    GRefCountImpl::AddRef(param_1);
  }
  in_ECX[0x27] = param_1;
  in_ECX[0x28] = param_3;
  in_ECX[0x29] = 0;
  in_ECX[0x2a] = 0;
  in_ECX[0x2b] = 0;
  in_ECX[0x2c] = 0;
  in_ECX[0x2d] = 0;
  in_ECX[0x2e] = 0;
  in_ECX[0x2f] = 0;
  in_ECX[0x30] = 0;
  in_ECX[0x31] = 0;
  in_ECX[0x32] = 0;
  FUN_005953c0();
  in_ECX[0x68] = 0xffffffff;
  in_ECX[0x69] = 0;
  in_ECX[0x6a] = 0;
  in_ECX[0x6c] = 0;
  in_ECX[0x6e] = 0;
  in_ECX[0x6f] = 0;
  in_ECX[0x70] = 0;
  *(undefined1 *)(in_ECX + 0x71) = 0;
  *(undefined1 *)((int)in_ECX + 0x1c5) = 0;
  cVar8 = '\0';
  *(undefined1 *)((int)in_ECX + 0x1c6) = 0;
  in_ECX[0x72] = 0;
  in_ECX[0x6d] = 0;
  in_ECX[0x6b] = 0;
  uVar5 = (**(code **)(*(int *)param_1 + 8))();
  if ((uVar5 & 0xff00) == 0x8400) {
    FUN_0058b5e0(*(undefined4 *)(param_1 + 0x2c));
    *(byte *)(in_ECX + 0x71) = *(byte *)(in_ECX + 0x71) | 0x40;
  }
  FUN_00529660(in_ECX);
  bVar1 = *(byte *)(in_ECX + 0x71);
  bVar4 = bVar1 & 0xdc;
  *(byte *)(in_ECX + 0x71) = bVar4 | 1;
  if (param_6 == '\0') {
    bVar4 = bVar1 & 0xcc | 1;
  }
  else {
    bVar4 = bVar4 | 0x11;
  }
  *(byte *)(in_ECX + 0x71) = bVar4;
  if (((param_4 == (int *)0x0) || (param_6 != '\0')) ||
     (iVar6 = (**(code **)(*param_4 + 0x48))(), iVar6 == param_2)) {
    param_6 = '\0';
    if (cVar3 == '\0') goto LAB_005956ad;
LAB_005956b9:
    iVar6 = *(int *)(in_ECX[0x28] + 0x74);
    if (iVar6 != in_ECX[0x28] + 0x70) {
      do {
        if ((*(int *)(iVar6 + 0xc) == in_ECX[0x1f]) && (*(char *)(iVar6 + 0x18) == cVar8)) {
          *(int *)(iVar6 + 8) = *(int *)(iVar6 + 8) + 1;
          in_ECX[0x69] = iVar6;
          break;
        }
        iVar6 = *(int *)(iVar6 + 4);
      } while (iVar6 != in_ECX[0x28] + 0x70);
    }
    if (in_ECX[0x69] == 0) {
      iVar6 = FUN_00515840(0x20,0);
      if (iVar6 == 0) {
        iVar6 = 0;
      }
      else {
        uVar7 = in_ECX[0x1f];
        *(undefined4 *)(iVar6 + 8) = 1;
        *(undefined4 *)(iVar6 + 0xc) = uVar7;
        *(char *)(iVar6 + 0x18) = param_6;
        *(undefined4 *)(iVar6 + 0x1c) = 0;
      }
      in_ECX[0x69] = iVar6;
      *(undefined4 *)(in_ECX[0x69] + 0x14) = *(undefined4 *)(*(int *)(in_ECX[0x1f] + 0x1c) + 0x80);
      if (param_6 == '\0') {
        uVar7 = (**(code **)(*(int *)in_ECX[0x1f] + 0x14))();
      }
      else {
        uVar7 = 0;
      }
      *(undefined4 *)(in_ECX[0x69] + 0x10) = uVar7;
      iVar6 = FUN_00515840(0x2c,0);
      if (iVar6 == 0) {
        uVar7 = 0;
      }
      else {
        uVar7 = FUN_0055e410(in_ECX[0x1f],*(undefined4 *)(param_3 + 0x118));
      }
      iVar6 = in_ECX[0x69];
      this = *(GRefCountNTSImpl **)(iVar6 + 0x1c);
      if (this != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release(this);
      }
      *(undefined4 *)(iVar6 + 0x1c) = uVar7;
      iVar6 = in_ECX[0x28];
      piVar2 = (int *)in_ECX[0x69];
      piVar2[1] = *(int *)(iVar6 + 0x74);
      *piVar2 = iVar6 + 0x70;
      **(int **)(iVar6 + 0x74) = (int)piVar2;
      *(int **)(iVar6 + 0x74) = piVar2;
    }
  }
  else {
    cVar8 = '\x01';
    param_6 = '\x01';
LAB_005956ad:
    if ((param_4 == (int *)0x0) || (cVar8 != '\0')) goto LAB_005956b9;
  }
  uVar5 = (**(code **)(*(int *)in_ECX[0x27] + 0x28))();
  if (uVar5 < (uint)in_ECX[0x31]) {
    uVar10 = uVar5;
    if ((uint)in_ECX[0x32] >> 1 <= uVar5) goto LAB_00595803;
  }
  else {
    if (uVar5 < (uint)in_ECX[0x32]) goto LAB_00595803;
    uVar10 = (uVar5 >> 2) + uVar5;
  }
  FUN_006770c0(in_ECX + 0x30,uVar10);
LAB_00595803:
  in_ECX[0x31] = uVar5;
  _memset((void *)in_ECX[0x30],0,uVar5);
  uVar7 = 6;
  puVar9 = in_ECX + 0x33;
  FUN_0051d6a0(puVar9,6);
  iVar6 = FUN_00530980(puVar9,uVar7);
  if (iVar6 != 0) {
    *(uint *)(iVar6 + 8) = *(int *)(iVar6 + 8) + 1U & 0x8fffffff;
  }
  if (in_ECX[0x1b] != 0) {
    FUN_00503db0();
  }
  in_ECX[0x1b] = iVar6;
  return;
}



============================================================
DISASSEMBLY
============================================================
00595530 : MOV EDX,dword ptr [ESP + 0x10]
00595534 : PUSH EBX
00595535 : PUSH EBP
00595536 : PUSH ESI
00595537 : PUSH EDI
00595538 : PUSH ECX
00595539 : MOV EAX,ESP
0059553b : MOV ESI,ECX
0059553d : MOV ECX,dword ptr [ESP + 0x28]
00595541 : MOV dword ptr [EAX],ECX
00595543 : MOV EAX,dword ptr [ESP + 0x1c]
00595547 : PUSH EDX
00595548 : PUSH EAX
00595549 : MOV ECX,ESI
0059554b : CALL 0x00522570
00595550 : MOV EDI,dword ptr [ESP + 0x14]
00595554 : XOR EBX,EBX
00595556 : MOV dword ptr [ESI],0xb8e9d8
0059555c : MOV dword ptr [ESI + 0xc],0xb8e9cc
00595563 : MOV dword ptr [ESI + 0x68],0xb8e978
0059556a : CMP EDI,EBX
0059556c : JZ 0x00595575
0059556e : MOV ECX,EDI
00595570 : CALL 0x00523dd0
00595575 : MOV ECX,dword ptr [ESP + 0x1c]
00595579 : MOV dword ptr [ESI + 0x9c],EDI
0059557f : MOV dword ptr [ESI + 0xa0],ECX
00595585 : MOV dword ptr [ESI + 0xa4],EBX
0059558b : MOV dword ptr [ESI + 0xa8],EBX
00595591 : MOV dword ptr [ESI + 0xac],EBX
00595597 : MOV dword ptr [ESI + 0xb0],EBX
0059559d : MOV dword ptr [ESI + 0xb4],EBX
005955a3 : MOV dword ptr [ESI + 0xb8],EBX
005955a9 : MOV dword ptr [ESI + 0xbc],EBX
005955af : LEA EBP,[ESI + 0xcc]
005955b5 : MOV dword ptr [ESI + 0xc0],EBX
005955bb : MOV dword ptr [ESI + 0xc4],EBX
005955c1 : MOV ECX,EBP
005955c3 : MOV dword ptr [ESI + 0xc8],EBX
005955c9 : CALL 0x005953c0
005955ce : MOV dword ptr [ESI + 0x1a0],0xffffffff
005955d8 : MOV dword ptr [ESI + 0x1a4],EBX
005955de : MOV dword ptr [ESI + 0x1a8],EBX
005955e4 : MOV dword ptr [ESI + 0x1b0],EBX
005955ea : MOV dword ptr [ESI + 0x1b8],EBX
005955f0 : MOV dword ptr [ESI + 0x1bc],EBX
005955f6 : MOV dword ptr [ESI + 0x1c0],EBX
005955fc : MOV byte ptr [ESI + 0x1c4],BL
00595602 : MOV byte ptr [ESI + 0x1c5],BL
00595608 : MOV byte ptr [ESI + 0x1c6],BL
0059560e : MOV dword ptr [ESI + 0x1c8],EBX
00595614 : MOV dword ptr [ESI + 0x1b4],EBX
0059561a : MOV dword ptr [ESI + 0x1ac],EBX
00595620 : MOV EDX,dword ptr [EDI]
00595622 : MOV EAX,dword ptr [EDX + 0x8]
00595625 : MOV ECX,EDI
00595627 : CALL EAX
00595629 : AND EAX,0xff00
0059562e : CMP EAX,0x8400
00595633 : JNZ 0x00595647
00595635 : MOV ECX,dword ptr [EDI + 0x2c]
00595638 : PUSH ECX
00595639 : MOV ECX,ESI
0059563b : CALL 0x0058b5e0
00595640 : OR byte ptr [ESI + 0x1c4],0x40
00595647 : PUSH ESI
00595648 : MOV ECX,EBP
0059564a : CALL 0x00529660
0059564f : MOVZX EAX,byte ptr [ESI + 0x1c4]
00595656 : MOV CL,byte ptr [ESP + 0x28]
0059565a : AND EAX,0xfc
0059565f : OR AL,0x1
00595661 : AND AL,0xdf
00595663 : MOV byte ptr [ESI + 0x1c4],AL
00595669 : MOVZX EAX,AL
0059566c : CMP CL,BL
0059566e : JZ 0x00595674
00595670 : OR AL,0x10
00595672 : JMP 0x00595676
00595674 : AND AL,0xef
00595676 : MOV EDI,dword ptr [ESP + 0x20]
0059567a : MOV byte ptr [ESI + 0x1c4],AL
00595680 : CMP EDI,EBX
00595682 : JZ 0x005956a3
00595684 : CMP CL,BL
00595686 : JNZ 0x005956a3
00595688 : MOV EDX,dword ptr [EDI]
0059568a : MOV EAX,dword ptr [EDX + 0x48]
0059568d : MOV ECX,EDI
0059568f : CALL EAX
00595691 : CMP EAX,dword ptr [ESP + 0x18]
00595695 : JZ 0x0059569f
00595697 : MOV DL,0x1
00595699 : MOV byte ptr [ESP + 0x28],DL
0059569d : JMP 0x005956ad
0059569f : MOV CL,byte ptr [ESP + 0x28]
005956a3 : MOV byte ptr [ESP + 0x28],BL
005956a7 : MOV DL,BL
005956a9 : CMP CL,BL
005956ab : JNZ 0x005956b9
005956ad : CMP EDI,EBX
005956af : JZ 0x005956b9
005956b1 : CMP DL,BL
005956b3 : JZ 0x005957c5
005956b9 : MOV ECX,dword ptr [ESI + 0xa0]
005956bf : MOV EAX,dword ptr [ECX + 0x74]
005956c2 : ADD ECX,0x70
005956c5 : CMP EAX,ECX
005956c7 : JZ 0x005956f5
005956c9 : MOV EDI,dword ptr [ESI + 0x7c]
005956cc : LEA ESP,[ESP]
005956d0 : CMP dword ptr [EAX + 0xc],EDI
005956d3 : JNZ 0x005956da
005956d5 : CMP byte ptr [EAX + 0x18],DL
005956d8 : JZ 0x005956ec
005956da : MOV ECX,dword ptr [ESI + 0xa0]
005956e0 : MOV EAX,dword ptr [EAX + 0x4]
005956e3 : ADD ECX,0x70
005956e6 : CMP EAX,ECX
005956e8 : JNZ 0x005956d0
005956ea : JMP 0x005956f5
005956ec : INC dword ptr [EAX + 0x8]
005956ef : MOV dword ptr [ESI + 0x1a4],EAX
005956f5 : CMP dword ptr [ESI + 0x1a4],EBX
005956fb : JNZ 0x005957c5
00595701 : MOV EBP,dword ptr [ESP + 0x1c]
00595705 : MOV EDI,dword ptr [EBP + 0x14]
00595708 : PUSH EBX
00595709 : PUSH 0x20
0059570b : MOV ECX,EDI
0059570d : CALL 0x00515840
00595712 : CMP EAX,EBX
00595714 : JZ 0x0059572f
00595716 : MOV ECX,dword ptr [ESI + 0x7c]
00595719 : MOV DL,byte ptr [ESP + 0x28]
0059571d : MOV dword ptr [EAX + 0x8],0x1
00595724 : MOV dword ptr [EAX + 0xc],ECX
00595727 : MOV byte ptr [EAX + 0x18],DL
0059572a : MOV dword ptr [EAX + 0x1c],EBX
0059572d : JMP 0x00595731
0059572f : XOR EAX,EAX
00595731 : MOV dword ptr [ESI + 0x1a4],EAX
00595737 : MOV EAX,dword ptr [ESI + 0x7c]
0059573a : MOV EAX,dword ptr [EAX + 0x1c]
0059573d : MOV ECX,dword ptr [EAX + 0x80]
00595743 : MOV EDX,dword ptr [ESI + 0x1a4]
00595749 : MOV dword ptr [EDX + 0x14],ECX
0059574c : CMP byte ptr [ESP + 0x28],BL
00595750 : JZ 0x00595756
00595752 : XOR EAX,EAX
00595754 : JMP 0x00595760
00595756 : MOV ECX,dword ptr [ESI + 0x7c]
00595759 : MOV EAX,dword ptr [ECX]
0059575b : MOV EDX,dword ptr [EAX + 0x14]
0059575e : CALL EDX
00595760 : MOV ECX,dword ptr [ESI + 0x1a4]
00595766 : PUSH EBX
00595767 : MOV dword ptr [ECX + 0x10],EAX
0059576a : PUSH 0x2c
0059576c : MOV ECX,EDI
0059576e : CALL 0x00515840
00595773 : CMP EAX,EBX
00595775 : JZ 0x0059578d
00595777 : MOV ECX,dword ptr [EBP + 0x118]
0059577d : MOV EDX,dword ptr [ESI + 0x7c]
00595780 : PUSH ECX
00595781 : PUSH EDX
00595782 : MOV ECX,EAX
00595784 : CALL 0x0055e410
00595789 : MOV EBP,EAX
0059578b : JMP 0x0059578f
0059578d : XOR EBP,EBP
0059578f : MOV EDI,dword ptr [ESI + 0x1a4]
00595795 : MOV ECX,dword ptr [EDI + 0x1c]
00595798 : ADD EDI,0x1c
0059579b : CMP ECX,EBX
0059579d : JZ 0x005957a4
0059579f : CALL 0x004ff7c0
005957a4 : MOV dword ptr [EDI],EBP
005957a6 : MOV EAX,dword ptr [ESI + 0xa0]
005957ac : MOV EDX,dword ptr [EAX + 0x74]
005957af : MOV ECX,dword ptr [ESI + 0x1a4]
005957b5 : ADD EAX,0x70
005957b8 : MOV dword ptr [ECX + 0x4],EDX
005957bb : MOV dword ptr [ECX],EAX
005957bd : MOV EDX,dword ptr [EAX + 0x4]
005957c0 : MOV dword ptr [EDX],ECX
005957c2 : MOV dword ptr [EAX + 0x4],ECX
005957c5 : MOV ECX,dword ptr [ESI + 0x9c]
005957cb : MOV EAX,dword ptr [ECX]
005957cd : MOV EDX,dword ptr [EAX + 0x28]
005957d0 : CALL EDX
005957d2 : MOV EDI,EAX
005957d4 : CMP EDI,dword ptr [ESI + 0xc4]
005957da : LEA EBP,[ESI + 0xc0]
005957e0 : JNC 0x005957ee
005957e2 : MOV EAX,dword ptr [EBP + 0x8]
005957e5 : SHR EAX,0x1
005957e7 : CMP EDI,EAX
005957e9 : JNC 0x00595803
005957eb : PUSH EDI
005957ec : JMP 0x005957fb
005957ee : CMP EDI,dword ptr [EBP + 0x8]
005957f1 : JC 0x00595803
005957f3 : MOV ECX,EDI
005957f5 : SHR ECX,0x2
005957f8 : ADD ECX,EDI
005957fa : PUSH ECX
005957fb : PUSH EBP
005957fc : MOV ECX,EBP
005957fe : CALL 0x006770c0
00595803 : PUSH EDI
00595804 : MOV dword ptr [EBP + 0x4],EDI
00595807 : MOV EDX,dword ptr [EBP]
0059580a : PUSH EBX
0059580b : PUSH EDX
0059580c : CALL 0x0063b700
00595811 : ADD ESP,0xc
00595814 : PUSH 0x6
00595816 : LEA EAX,[ESI + 0xcc]
0059581c : PUSH EAX
0059581d : MOV ECX,ESI
0059581f : CALL 0x0051d6a0
00595824 : MOV ECX,EAX
00595826 : CALL 0x00530980
0059582b : MOV EDI,EAX
0059582d : CMP EDI,EBX
0059582f : JZ 0x0059583d
00595831 : MOV EAX,dword ptr [EDI + 0x8]
00595834 : INC EAX
00595835 : AND EAX,0x8fffffff
0059583a : MOV dword ptr [EDI + 0x8],EAX
0059583d : MOV ECX,dword ptr [ESI + 0x6c]
00595840 : CMP ECX,EBX
00595842 : JZ 0x00595849
00595844 : CALL 0x00503db0
00595849 : MOV dword ptr [ESI + 0x6c],EDI
0059584c : POP EDI
0059584d : MOV EAX,ESI
0059584f : POP ESI
00595850 : POP EBP
00595851 : POP EBX
00595852 : RET 0x18
