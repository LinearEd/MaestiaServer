PROGRAM  : Maestia.exe
FUNCTION : FUN_00683960
ENTRY    : 00683960
BODY     : [[00683960, 00683b0a]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Type propagation algorithm not settling */

void FUN_00683960(void)

{
  int iVar1;
  uint *puVar2;
  LONG LVar3;
  void *_Dst;
  GRefCountImpl *this;
  undefined4 uVar4;
  int in_ECX;
  size_t _Size;
  uint uVar5;
  uint local_34 [5];
  undefined4 uStack_20;
  undefined4 uStack_1c;
  undefined4 uStack_18;
  undefined4 uStack_14;
  undefined4 uStack_10;
  undefined4 uStack_c;
  undefined4 uStack_8;
  undefined4 uStack_4;
  
  local_34[1] = 0;
  local_34[2] = 0;
  iVar1 = FUN_0051b1a0();
  if (iVar1 != 0) {
    puVar2 = (uint *)FUN_0051c6e0(local_34,".RemoveInputWindow");
    FUN_00678eb0(*(undefined4 *)(in_ECX + 4),(*puVar2 & 0xfffffffc) + 8,0);
    uVar5 = local_34[0] & 0xfffffffc;
    LVar3 = InterlockedExchangeAdd((LONG *)(uVar5 + 4),-1);
    if (LVar3 == 1) {
      FUN_00515cf0(uVar5);
    }
  }
  uVar5 = *(uint *)(*(uint *)(in_ECX + 0x68) & 0xfffffffc) & 0x7fffffff;
  if (uVar5 != 0) {
    _Size = uVar5 + 1;
    _Dst = (void *)FUN_00515840(_Size,0);
    _memset(_Dst,0,_Size);
    _memcpy(_Dst,(void *)((*(uint *)(in_ECX + 0x68) & 0xfffffffc) + 8),_Size);
    if (_Dst == (void *)0x0) {
      **(undefined2 **)(in_ECX + 0x20) = 0;
    }
    else {
      this = (GRefCountImpl *)(**(code **)(*(int *)(*(int *)(in_ECX + 4) + 8) + 0xc))(0x1b);
      uStack_10 = 0;
      uStack_c = 0;
      uStack_8 = 0;
      uStack_4 = 0;
      uStack_20 = 0;
      uStack_1c = 0;
      uStack_18 = 0;
      uStack_14 = 0;
      FUN_00597610(&uStack_10,&uStack_20,-*(int *)(in_ECX + 0x34));
      iVar1 = FUN_0051b1a0();
      if (iVar1 != 0) {
        puVar2 = (uint *)FUN_0051c6e0(local_34,".DisplayInputWindow");
        uVar4 = FUN_0063b380(0);
        uVar4 = FUN_0063b380(uVar4);
        FUN_00678eb0(*(undefined4 *)(in_ECX + 4),(*puVar2 & 0xfffffffc) + 8,"%s %d %d %d",_Dst,uVar4
                    );
        LVar3 = InterlockedExchangeAdd((LONG *)((local_34[0] & 0xfffffffc) + 4),-1);
        if (LVar3 == 1) {
          FUN_00515cf0(local_34[0] & 0xfffffffc);
        }
      }
      FUN_00515cf0(_Dst);
      if (this != (GRefCountImpl *)0x0) {
        GRefCountImpl::Release(this);
      }
    }
  }
  if ((local_34[2] >> 6 & 1) != 0) {
    FUN_00588b40(local_34 + 1,local_34[3]);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00683960 : SUB ESP,0x34
00683963 : PUSH EBX
00683964 : PUSH EBP
00683965 : PUSH ESI
00683966 : MOV ESI,ECX
00683968 : PUSH EDI
00683969 : XOR EDI,EDI
0068396b : LEA EBX,[ESI + 0x8]
0068396e : MOV ECX,EBX
00683970 : MOV dword ptr [ESP + 0x14],EDI
00683974 : MOV dword ptr [ESP + 0x18],EDI
00683978 : CALL 0x0051b1a0
0068397d : TEST EAX,EAX
0068397f : JBE 0x006839c6
00683981 : PUSH 0xbd7f88
00683986 : LEA EAX,[ESP + 0x14]
0068398a : PUSH EAX
0068398b : MOV ECX,EBX
0068398d : CALL 0x0051c6e0
00683992 : MOV ECX,dword ptr [EAX]
00683994 : MOV EDX,dword ptr [ESI + 0x4]
00683997 : AND ECX,0xfffffffc
0068399a : PUSH EDI
0068399b : ADD ECX,0x8
0068399e : PUSH ECX
0068399f : PUSH EDX
006839a0 : CALL 0x00678eb0
006839a5 : MOV EDI,dword ptr [ESP + 0x1c]
006839a9 : ADD ESP,0xc
006839ac : AND EDI,0xfffffffc
006839af : PUSH -0x1
006839b1 : LEA EAX,[EDI + 0x4]
006839b4 : PUSH EAX
006839b5 : CALL dword ptr [0x00b851cc]
006839bb : SUB EAX,0x1
006839be : JNZ 0x006839c6
006839c0 : PUSH EDI
006839c1 : CALL 0x00515cf0
006839c6 : MOV ECX,dword ptr [ESI + 0x68]
006839c9 : AND ECX,0xfffffffc
006839cc : MOV EBP,dword ptr [ECX]
006839ce : AND EBP,0x7fffffff
006839d4 : JZ 0x00683ae2
006839da : MOV ECX,dword ptr [0x00d73250]
006839e0 : PUSH 0x0
006839e2 : INC EBP
006839e3 : PUSH EBP
006839e4 : CALL 0x00515840
006839e9 : PUSH EBP
006839ea : MOV EDI,EAX
006839ec : PUSH 0x0
006839ee : PUSH EDI
006839ef : CALL 0x0063b700
006839f4 : MOV EDX,dword ptr [ESI + 0x68]
006839f7 : AND EDX,0xfffffffc
006839fa : PUSH EBP
006839fb : ADD EDX,0x8
006839fe : PUSH EDX
006839ff : PUSH EDI
00683a00 : CALL 0x0063ae40
00683a05 : ADD ESP,0x18
00683a08 : TEST EDI,EDI
00683a0a : JNZ 0x00683a19
00683a0c : MOV EAX,dword ptr [ESI + 0x20]
00683a0f : XOR ECX,ECX
00683a11 : MOV word ptr [EAX],CX
00683a14 : JMP 0x00683ae2
00683a19 : MOV ECX,dword ptr [ESI + 0x4]
00683a1c : MOV EDX,dword ptr [ECX + 0x8]
00683a1f : MOV EAX,dword ptr [EDX + 0xc]
00683a22 : ADD ECX,0x8
00683a25 : PUSH 0x1b
00683a27 : CALL EAX
00683a29 : FLDZ
00683a2b : MOV ECX,dword ptr [ESI + 0x34]
00683a2e : FST float ptr [ESP + 0x34]
00683a32 : NEG ECX
00683a34 : FST float ptr [ESP + 0x38]
00683a38 : PUSH ECX
00683a39 : FST float ptr [ESP + 0x40]
00683a3d : FST float ptr [ESP + 0x44]
00683a41 : MOV EBP,EAX
00683a43 : LEA EDX,[ESP + 0x28]
00683a47 : FST float ptr [ESP + 0x28]
00683a4b : FST float ptr [ESP + 0x2c]
00683a4f : PUSH EDX
00683a50 : LEA EAX,[ESP + 0x3c]
00683a54 : FST float ptr [ESP + 0x34]
00683a58 : PUSH EAX
00683a59 : FSTP float ptr [ESP + 0x3c]
00683a5d : MOV ECX,EBP
00683a5f : CALL 0x00597610
00683a64 : MOV ECX,EBX
00683a66 : CALL 0x0051b1a0
00683a6b : TEST EAX,EAX
00683a6d : JBE 0x00683ad1
00683a6f : PUSH 0xbd7fb8
00683a74 : LEA ECX,[ESP + 0x14]
00683a78 : PUSH ECX
00683a79 : MOV ECX,EBX
00683a7b : CALL 0x0051c6e0
00683a80 : FLD float ptr [ESP + 0x30]
00683a84 : PUSH 0x0
00683a86 : MOV EBX,EAX
00683a88 : CALL 0x0063b380
00683a8d : FLD float ptr [ESP + 0x28]
00683a91 : PUSH EAX
00683a92 : CALL 0x0063b380
00683a97 : MOV EDX,dword ptr [EBX]
00683a99 : PUSH EAX
00683a9a : MOV EAX,dword ptr [ESI + 0x4]
00683a9d : PUSH EDI
00683a9e : AND EDX,0xfffffffc
00683aa1 : PUSH 0xbd7fac
00683aa6 : ADD EDX,0x8
00683aa9 : PUSH EDX
00683aaa : PUSH EAX
00683aab : CALL 0x00678eb0
00683ab0 : MOV ESI,dword ptr [ESP + 0x2c]
00683ab4 : ADD ESP,0x1c
00683ab7 : AND ESI,0xfffffffc
00683aba : PUSH -0x1
00683abc : LEA ECX,[ESI + 0x4]
00683abf : PUSH ECX
00683ac0 : CALL dword ptr [0x00b851cc]
00683ac6 : SUB EAX,0x1
00683ac9 : JNZ 0x00683ad1
00683acb : PUSH ESI
00683acc : CALL 0x00515cf0
00683ad1 : PUSH EDI
00683ad2 : CALL 0x00515cf0
00683ad7 : TEST EBP,EBP
00683ad9 : JZ 0x00683ae2
00683adb : MOV ECX,EBP
00683add : CALL 0x004ff7e0
00683ae2 : MOV EDX,dword ptr [ESP + 0x18]
00683ae6 : SHR EDX,0x6
00683ae9 : TEST DL,0x1
00683aec : JZ 0x00683b01
00683aee : MOV EAX,dword ptr [ESP + 0x1c]
00683af2 : PUSH EAX
00683af3 : LEA ECX,[ESP + 0x18]
00683af7 : PUSH ECX
00683af8 : MOV ECX,dword ptr [ESP + 0x1c]
00683afc : CALL 0x00588b40
00683b01 : POP EDI
00683b02 : POP ESI
00683b03 : POP EBP
00683b04 : POP EBX
00683b05 : ADD ESP,0x34
00683b08 : RET 0x4
