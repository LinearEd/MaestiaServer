PROGRAM  : Maestia.exe
FUNCTION : FUN_00768ab0
ENTRY    : 00768ab0
BODY     : [[00768ab0, 00768b17] [00768b20, 00768e01]]

============================================================
DECOMPILED C CODE
============================================================

undefined4
FUN_00768ab0(int *param_1,int *param_2,int param_3,ushort param_4,ushort param_5,ushort param_6,
            int *param_7,ushort param_8)

{
  uint uVar1;
  uint uVar2;
  int iVar3;
  undefined4 uVar4;
  int in_ECX;
  uint in_EDX;
  uint uVar5;
  float fVar6;
  float fVar7;
  LPCRITICAL_SECTION local_40;
  char *local_3c;
  undefined4 local_38;
  int local_34;
  uint local_30;
  undefined4 local_2c;
  undefined4 local_28;
  int local_24;
  int local_20;
  ushort *local_1c;
  int local_18;
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b18fda;
  local_10 = ExceptionList;
  uVar1 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_1c = (ushort *)(in_ECX + 0x364 + (uint)param_8 * 2);
  uVar5 = 0;
  if (*local_1c != 0) {
    local_14 = ((uint)param_7 & 0xffff) + (uint)param_5;
    local_18 = (uint)param_6 + (uint)param_4;
    do {
      fVar7 = 2.0;
      uVar2 = uVar5;
      if ((int)uVar5 < 0) {
        uVar2 = -uVar5;
      }
      fVar6 = 1.0;
      while( true ) {
        if ((uVar2 & 1) != 0) {
          fVar6 = fVar6 * fVar7;
        }
        uVar2 = uVar2 >> 1;
        if (uVar2 == 0) break;
        fVar7 = fVar7 * fVar7;
      }
      if ((int)uVar5 < 0) {
        fVar6 = 1.0 / fVar6;
      }
      local_24 = (int)fVar6;
      local_28 = (undefined4)((longlong)(ulonglong)param_5 / (longlong)local_24);
      _param_8 = (int *)0x0;
      local_20 = local_14 / local_24;
      local_2c = (undefined4)((longlong)(ulonglong)param_4 / (longlong)local_24);
      local_24 = local_18 / local_24;
      in_EDX = in_EDX & ((int)in_EDX < 0) - 1;
      iVar3 = uVar5 + in_EDX;
      if (param_3 + -1 < (int)(uVar5 + in_EDX)) {
        iVar3 = param_3 + -1;
      }
      iVar3 = (**(code **)(*param_1 + 0x48))(param_1,iVar3,&param_8,uVar1);
      if (iVar3 < 0) {
        uVar4 = FUN_00404750(L"[AvaMergeMeshEntity::_CopySurfaceImpl] Error GetSurfaceLevel (%d)",
                             iVar3);
        local_8 = 0;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                    (L"AvaLib::AvaMergeMeshEntity::_CopySurfaceImpl",0x605,uVar4);
        }
        local_8 = 0xffffffff;
        if (local_30 < 8) {
          ExceptionList = local_10;
          return 0;
        }
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      param_7 = (int *)0x0;
      iVar3 = (**(code **)(*param_2 + 0x48))(param_2,uVar5,&param_7);
      if (iVar3 < 0) {
        uVar4 = FUN_00404750(L"[AvaMergeMeshEntity::_CopySurfaceImpl] Error GetSurfaceLevel (%d)",
                             iVar3);
        local_8 = 1;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                    (L"AvaLib::AvaMergeMeshEntity::_CopySurfaceImpl",0x60d,uVar4);
        }
        local_8 = 0xffffffff;
        if (local_30 < 8) {
          local_30 = 7;
          local_34 = 0;
          (**(code **)(*_param_8 + 8))(_param_8);
          ExceptionList = local_10;
          return 0;
        }
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      local_40 = (LPCRITICAL_SECTION)(DAT_017251ac + 0x424);
      local_34 = 0;
      local_3c = ".\\Mesh\\AvaMergeMeshEntity.cpp";
      local_38 = 0x613;
      local_30 = 1;
      FUN_006ef1a0(&local_40);
      local_8 = 2;
      iVar3 = D3DXLoadSurfaceFromSurface(param_7,0,&local_2c,_param_8,0,0,5,0);
      local_8 = 0xffffffff;
      if (local_34 != 0) {
        LeaveCriticalSection(local_40);
        local_34 = 0;
      }
      if (iVar3 < 0) {
        uVar4 = FUN_00404750(L"[AvaMergeMeshEntity::_CopySurfaceImpl] Error D3DXLoadSurfaceFromSurface (%d)"
                             ,iVar3);
        local_8 = 3;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                    (L"AvaLib::AvaMergeMeshEntity::_CopySurfaceImpl",0x619,uVar4);
        }
        local_8 = 0xffffffff;
        if (local_30 < 8) {
          local_30 = 7;
          local_34 = 0;
          (**(code **)(*_param_8 + 8))(_param_8);
          (**(code **)(*param_7 + 8))(param_7);
          ExceptionList = local_10;
          return 0;
        }
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      (**(code **)(*_param_8 + 8))(_param_8);
      (**(code **)(*param_7 + 8))(param_7);
      uVar5 = uVar5 + 1;
    } while ((int)uVar5 < (int)(uint)*local_1c);
  }
  ExceptionList = local_10;
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00768ab0 : PUSH EBP
00768ab1 : MOV EBP,ESP
00768ab3 : PUSH -0x1
00768ab5 : PUSH 0xb18fda
00768aba : MOV EAX,FS:[0x0]
00768ac0 : PUSH EAX
00768ac1 : SUB ESP,0x3c
00768ac4 : PUSH EBX
00768ac5 : PUSH ESI
00768ac6 : PUSH EDI
00768ac7 : MOV EAX,[0x00d66fa0]
00768acc : XOR EAX,EBP
00768ace : PUSH EAX
00768acf : LEA EAX,[EBP + -0xc]
00768ad2 : MOV FS:[0x0],EAX
00768ad8 : MOV EDI,EDX
00768ada : MOVZX EAX,word ptr [EBP + 0x24]
00768ade : LEA EAX,[ECX + EAX*0x2 + 0x364]
00768ae5 : XOR EDX,EDX
00768ae7 : XOR ESI,ESI
00768ae9 : MOV dword ptr [EBP + -0x18],EAX
00768aec : CMP DX,word ptr [EAX]
00768aef : JNC 0x00768c78
00768af5 : MOVZX EAX,word ptr [EBP + 0x18]
00768af9 : MOVZX ECX,word ptr [EBP + 0x20]
00768afd : MOVZX EDX,word ptr [EBP + 0x1c]
00768b01 : MOV EBX,dword ptr [EBP + 0x10]
00768b04 : ADD ECX,EAX
00768b06 : MOVZX EAX,word ptr [EBP + 0x14]
00768b0a : ADD EDX,EAX
00768b0c : DEC EBX
00768b0d : MOV dword ptr [EBP + -0x10],ECX
00768b10 : MOV dword ptr [EBP + -0x14],EDX
00768b13 : MOV dword ptr [EBP + 0x1c],EBX
00768b16 : JMP 0x00768b23
00768b20 : MOV EBX,dword ptr [EBP + 0x1c]
00768b23 : MOVSS XMM1,dword ptr [0x00c10fc4]
00768b2b : MOVSS XMM2,dword ptr [0x00cdf144]
00768b33 : MOV EAX,ESI
00768b35 : TEST ESI,ESI
00768b37 : JGE 0x00768b3b
00768b39 : NEG EAX
00768b3b : MOVAPS XMM0,XMM1
00768b3e : MOV EDI,EDI
00768b40 : TEST AL,0x1
00768b42 : JZ 0x00768b48
00768b44 : MULSS XMM0,XMM2
00768b48 : SHR EAX,0x1
00768b4a : JZ 0x00768b58
00768b4c : MOVAPS XMM3,XMM2
00768b4f : MULSS XMM3,XMM2
00768b53 : MOVAPS XMM2,XMM3
00768b56 : JMP 0x00768b40
00768b58 : TEST ESI,ESI
00768b5a : JGE 0x00768b62
00768b5c : DIVSS XMM1,XMM0
00768b60 : JMP 0x00768b65
00768b62 : MOVAPS XMM1,XMM0
00768b65 : MOVZX EAX,word ptr [EBP + 0x18]
00768b69 : CDQ
00768b6a : CVTTSS2SI ECX,XMM1
00768b6e : IDIV ECX
00768b70 : MOV dword ptr [EBP + 0x24],0x0
00768b77 : MOV dword ptr [EBP + -0x24],EAX
00768b7a : MOV EAX,dword ptr [EBP + -0x10]
00768b7d : CDQ
00768b7e : IDIV ECX
00768b80 : MOV dword ptr [EBP + -0x1c],EAX
00768b83 : MOVZX EAX,word ptr [EBP + 0x14]
00768b87 : CDQ
00768b88 : IDIV ECX
00768b8a : MOV dword ptr [EBP + -0x28],EAX
00768b8d : MOV EAX,dword ptr [EBP + -0x14]
00768b90 : CDQ
00768b91 : IDIV ECX
00768b93 : MOV ECX,dword ptr [EBP + 0x8]
00768b96 : MOV EDX,dword ptr [ECX]
00768b98 : MOV dword ptr [EBP + -0x20],EAX
00768b9b : XOR EAX,EAX
00768b9d : TEST EDI,EDI
00768b9f : SETL AL
00768ba2 : DEC EAX
00768ba3 : AND EDI,EAX
00768ba5 : LEA EAX,[ESI + EDI*0x1]
00768ba8 : CMP EAX,EBX
00768baa : CMOVG EAX,EBX
00768bad : LEA EBX,[EBP + 0x24]
00768bb0 : PUSH EBX
00768bb1 : PUSH EAX
00768bb2 : MOV EAX,dword ptr [EDX + 0x48]
00768bb5 : PUSH ECX
00768bb6 : CALL EAX
00768bb8 : XOR EBX,EBX
00768bba : CMP EAX,EBX
00768bbc : JL 0x00768c8e
00768bc2 : MOV EAX,dword ptr [EBP + 0xc]
00768bc5 : MOV ECX,dword ptr [EAX]
00768bc7 : LEA EDX,[EBP + 0x20]
00768bca : PUSH EDX
00768bcb : PUSH ESI
00768bcc : PUSH EAX
00768bcd : MOV EAX,dword ptr [ECX + 0x48]
00768bd0 : MOV dword ptr [EBP + 0x20],EBX
00768bd3 : CALL EAX
00768bd5 : CMP EAX,EBX
00768bd7 : JL 0x00768cfb
00768bdd : MOV ECX,dword ptr [0x017251ac]
00768be3 : LEA EDX,[EBP + -0x3c]
00768be6 : ADD ECX,0x424
00768bec : PUSH EDX
00768bed : MOV dword ptr [EBP + -0x30],EBX
00768bf0 : MOV dword ptr [EBP + -0x3c],ECX
00768bf3 : MOV dword ptr [EBP + -0x38],0xc0e1a4
00768bfa : MOV dword ptr [EBP + -0x34],0x613
00768c01 : MOV dword ptr [EBP + -0x2c],0x1
00768c08 : CALL 0x006ef1a0
00768c0d : MOV dword ptr [EBP + -0x4],0x2
00768c14 : MOV EAX,dword ptr [EBP + 0x24]
00768c17 : MOV EDX,dword ptr [EBP + 0x20]
00768c1a : PUSH EBX
00768c1b : PUSH 0x5
00768c1d : PUSH EBX
00768c1e : PUSH EBX
00768c1f : PUSH EAX
00768c20 : LEA ECX,[EBP + -0x28]
00768c23 : PUSH ECX
00768c24 : PUSH EBX
00768c25 : PUSH EDX
00768c26 : CALL 0x00664cc6
00768c2b : MOV EBX,EAX
00768c2d : MOV dword ptr [EBP + -0x4],0xffffffff
00768c34 : CMP dword ptr [EBP + -0x30],0x0
00768c38 : JZ 0x00768c4b
00768c3a : MOV EAX,dword ptr [EBP + -0x3c]
00768c3d : PUSH EAX
00768c3e : CALL dword ptr [0x00b8511c]
00768c44 : MOV dword ptr [EBP + -0x30],0x0
00768c4b : TEST EBX,EBX
00768c4d : JL 0x00768d77
00768c53 : MOV EAX,dword ptr [EBP + 0x24]
00768c56 : MOV ECX,dword ptr [EAX]
00768c58 : MOV EDX,dword ptr [ECX + 0x8]
00768c5b : PUSH EAX
00768c5c : CALL EDX
00768c5e : MOV EAX,dword ptr [EBP + 0x20]
00768c61 : MOV ECX,dword ptr [EAX]
00768c63 : MOV EDX,dword ptr [ECX + 0x8]
00768c66 : PUSH EAX
00768c67 : CALL EDX
00768c69 : MOV EAX,dword ptr [EBP + -0x18]
00768c6c : MOVZX ECX,word ptr [EAX]
00768c6f : INC ESI
00768c70 : CMP ESI,ECX
00768c72 : JL 0x00768b20
00768c78 : MOV AL,0x1
00768c7a : MOV ECX,dword ptr [EBP + -0xc]
00768c7d : MOV dword ptr FS:[0x0],ECX
00768c84 : POP ECX
00768c85 : POP EDI
00768c86 : POP ESI
00768c87 : POP EBX
00768c88 : MOV ESP,EBP
00768c8a : POP EBP
00768c8b : RET 0x20
00768c8e : PUSH EAX
00768c8f : PUSH 0xc0dfd8
00768c94 : LEA ESI,[EBP + -0x44]
00768c97 : CALL 0x00404750
00768c9c : ADD ESP,0x8
00768c9f : MOV dword ptr [EBP + -0x4],EBX
00768ca2 : MOV EDX,dword ptr [0x00da98e8]
00768ca8 : MOV ECX,dword ptr [EDX]
00768caa : CMP ECX,EBX
00768cac : JZ 0x00768cc0
00768cae : MOV EDX,dword ptr [ECX]
00768cb0 : PUSH EAX
00768cb1 : MOV EAX,dword ptr [EDX + 0x14]
00768cb4 : PUSH 0x605
00768cb9 : PUSH 0xc0e060
00768cbe : CALL EAX
00768cc0 : MOV dword ptr [EBP + -0x4],0xffffffff
00768cc7 : CMP dword ptr [EBP + -0x2c],0x8
00768ccb : JC 0x00768cd5
00768ccd : MOV ECX,dword ptr [EBP + -0x40]
00768cd0 : CALL 0x006f04e0
00768cd5 : XOR ECX,ECX
00768cd7 : MOV dword ptr [EBP + -0x2c],0x7
00768cde : MOV dword ptr [EBP + -0x30],EBX
00768ce1 : MOV word ptr [EBP + -0x40],CX
00768ce5 : XOR AL,AL
00768ce7 : MOV ECX,dword ptr [EBP + -0xc]
00768cea : MOV dword ptr FS:[0x0],ECX
00768cf1 : POP ECX
00768cf2 : POP EDI
00768cf3 : POP ESI
00768cf4 : POP EBX
00768cf5 : MOV ESP,EBP
00768cf7 : POP EBP
00768cf8 : RET 0x20
00768cfb : PUSH EAX
00768cfc : PUSH 0xc0e0c0
00768d01 : LEA ESI,[EBP + -0x44]
00768d04 : CALL 0x00404750
00768d09 : ADD ESP,0x8
00768d0c : MOV dword ptr [EBP + -0x4],0x1
00768d13 : MOV EDX,dword ptr [0x00da98e8]
00768d19 : MOV ECX,dword ptr [EDX]
00768d1b : CMP ECX,EBX
00768d1d : JZ 0x00768d31
00768d1f : MOV EDX,dword ptr [ECX]
00768d21 : PUSH EAX
00768d22 : MOV EAX,dword ptr [EDX + 0x14]
00768d25 : PUSH 0x60d
00768d2a : PUSH 0xc0e148
00768d2f : CALL EAX
00768d31 : MOV dword ptr [EBP + -0x4],0xffffffff
00768d38 : CMP dword ptr [EBP + -0x2c],0x8
00768d3c : JC 0x00768d46
00768d3e : MOV ECX,dword ptr [EBP + -0x40]
00768d41 : CALL 0x006f04e0
00768d46 : MOV EAX,dword ptr [EBP + 0x24]
00768d49 : MOV EDX,dword ptr [EAX]
00768d4b : XOR ECX,ECX
00768d4d : PUSH EAX
00768d4e : MOV EAX,dword ptr [EDX + 0x8]
00768d51 : MOV dword ptr [EBP + -0x2c],0x7
00768d58 : MOV dword ptr [EBP + -0x30],EBX
00768d5b : MOV word ptr [EBP + -0x40],CX
00768d5f : CALL EAX
00768d61 : XOR AL,AL
00768d63 : MOV ECX,dword ptr [EBP + -0xc]
00768d66 : MOV dword ptr FS:[0x0],ECX
00768d6d : POP ECX
00768d6e : POP EDI
00768d6f : POP ESI
00768d70 : POP EBX
00768d71 : MOV ESP,EBP
00768d73 : POP EBP
00768d74 : RET 0x20
00768d77 : PUSH EBX
00768d78 : PUSH 0xc0e1c8
00768d7d : LEA ESI,[EBP + -0x44]
00768d80 : CALL 0x00404750
00768d85 : ADD ESP,0x8
00768d88 : MOV dword ptr [EBP + -0x4],0x3
00768d8f : MOV ECX,dword ptr [0x00da98e8]
00768d95 : MOV ECX,dword ptr [ECX]
00768d97 : TEST ECX,ECX
00768d99 : JZ 0x00768dad
00768d9b : MOV EDX,dword ptr [ECX]
00768d9d : PUSH EAX
00768d9e : MOV EAX,dword ptr [EDX + 0x14]
00768da1 : PUSH 0x619
00768da6 : PUSH 0xc0e268
00768dab : CALL EAX
00768dad : MOV dword ptr [EBP + -0x4],0xffffffff
00768db4 : CMP dword ptr [EBP + -0x2c],0x8
00768db8 : JC 0x00768dc2
00768dba : MOV ECX,dword ptr [EBP + -0x40]
00768dbd : CALL 0x006f04e0
00768dc2 : MOV EAX,dword ptr [EBP + 0x24]
00768dc5 : MOV EDX,dword ptr [EAX]
00768dc7 : XOR ECX,ECX
00768dc9 : PUSH EAX
00768dca : MOV EAX,dword ptr [EDX + 0x8]
00768dcd : MOV dword ptr [EBP + -0x2c],0x7
00768dd4 : MOV dword ptr [EBP + -0x30],0x0
00768ddb : MOV word ptr [EBP + -0x40],CX
00768ddf : CALL EAX
00768de1 : MOV EAX,dword ptr [EBP + 0x20]
00768de4 : MOV ECX,dword ptr [EAX]
00768de6 : MOV EDX,dword ptr [ECX + 0x8]
00768de9 : PUSH EAX
00768dea : CALL EDX
00768dec : XOR AL,AL
00768dee : MOV ECX,dword ptr [EBP + -0xc]
00768df1 : MOV dword ptr FS:[0x0],ECX
00768df8 : POP ECX
00768df9 : POP EDI
00768dfa : POP ESI
00768dfb : POP EBX
00768dfc : MOV ESP,EBP
00768dfe : POP EBP
00768dff : RET 0x20
