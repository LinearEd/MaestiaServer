PROGRAM  : Maestia.exe
FUNCTION : FUN_005ebb40
ENTRY    : 005ebb40
BODY     : [[005ebb40, 005ebdd8]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005ebb40(int param_1,GRefCountNTSImpl *param_2)

{
  int iVar1;
  int iVar2;
  undefined4 uVar3;
  int *piVar4;
  undefined4 *puVar5;
  int in_ECX;
  uint uVar6;
  float fStack_50;
  float fStack_4c;
  uint uStack_48;
  int iStack_44;
  int *piStack_40;
  undefined4 uStack_3c;
  float fStack_38;
  float fStack_34;
  float fStack_30;
  float fStack_2c;
  int iStack_28;
  uint uStack_24;
  undefined4 uStack_20;
  undefined4 uStack_1c;
  float fStack_18;
  float fStack_14;
  float fStack_10;
  float fStack_c;
  undefined4 uStack_8;
  undefined4 uStack_4;
  
  iVar1 = (int)param_2;
  iVar2 = (**(code **)(**(int **)((int)param_2 + 0xc) + 0x38))();
  if (iVar2 != 0) {
    iVar2 = FUN_00515840(0x2c,0);
    if (iVar2 == 0) {
      param_2 = (GRefCountNTSImpl *)0x0;
    }
    else {
      uVar3 = (**(code **)(**(int **)((int)param_2 + 0xc) + 0x38))();
      param_2 = (GRefCountNTSImpl *)FUN_005e90c0(uVar3,0);
    }
    *(undefined4 *)(param_2 + 8) = *(undefined4 *)(in_ECX + 0xc);
    *(undefined4 *)(param_2 + 0xc) = *(undefined4 *)(in_ECX + 0x10);
    *(undefined4 *)(param_2 + 0x10) = *(undefined4 *)(in_ECX + 0x14);
    *(undefined4 *)(param_2 + 0x14) = *(undefined4 *)(in_ECX + 0x18);
    *(int *)(param_2 + 4) = *(int *)(param_2 + 4) + 1;
    if (*(GRefCountNTSImpl **)(iVar1 + 0x10) != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(iVar1 + 0x10));
    }
    *(GRefCountNTSImpl **)(iVar1 + 0x10) = param_2;
    fStack_4c = (float)*(int *)(in_ECX + 0xc) / 1536.0;
    uStack_48 = (**(code **)(**(int **)(iVar1 + 0xc) + 0x38))();
    uVar6 = 0;
    if (uStack_48 != 0) {
      do {
        iVar2 = FUN_005e1290(uVar6);
        if (((*(int *)(iVar2 + 8) == 0) && (*(int *)(iVar2 + 0xc) == 0)) &&
           (piVar4 = (int *)(**(code **)(**(int **)(iVar1 + 0xc) + 0x18))(uVar6,0),
           piVar4 != (int *)0x0)) {
          fStack_38 = 0.0;
          fStack_34 = 0.0;
          fStack_30 = 0.0;
          fStack_2c = 0.0;
          (**(code **)(*piVar4 + 0x14))(&fStack_38);
          fStack_50 = fStack_30 - fStack_38;
          if ((0.0 < fStack_50) && (fStack_50 = fStack_2c - fStack_34, 0.0 < fStack_50)) {
            fStack_c = (float)*(int *)(in_ECX + 0x10);
            fStack_18 = fStack_4c * fStack_38 - fStack_c;
            fStack_14 = fStack_4c * fStack_34 - fStack_c;
            fStack_10 = fStack_c + fStack_4c * fStack_30;
            fStack_c = fStack_2c * fStack_4c + fStack_c;
            uStack_8 = 0;
            uStack_4 = 0;
            fStack_50 = fStack_10 - fStack_18;
            if ((0.0 < fStack_50) && (fStack_50 = fStack_c - fStack_14, 0.0 < fStack_50)) {
              uStack_20 = 0xffffffff;
              uStack_1c = 0xffffffff;
              iStack_28 = iVar1;
              uStack_24 = uVar6;
              uStack_3c = (**(code **)(*piVar4 + 0x1c))();
              iStack_44 = iVar1;
              piStack_40 = piVar4;
              puVar5 = (undefined4 *)FUN_005eb560(&iStack_44);
              if (puVar5 == (undefined4 *)0x0) {
                fStack_50 = *(float *)(param_1 + 4);
                FUN_005ebb00(&iStack_44,&fStack_50);
                FUN_005eb920(&iStack_28);
              }
              else {
                uStack_20 = *puVar5;
                FUN_005eb920(&iStack_28);
              }
            }
          }
          FUN_00557b30();
        }
        uVar6 = uVar6 + 1;
      } while (uVar6 < uStack_48);
    }
    GRefCountNTSImpl::Release(param_2);
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005ebb40 : SUB ESP,0x54
005ebb43 : PUSH EBX
005ebb44 : PUSH EDI
005ebb45 : MOV EDI,dword ptr [ESP + 0x64]
005ebb49 : MOV EBX,ECX
005ebb4b : MOV ECX,dword ptr [EDI + 0xc]
005ebb4e : MOV EAX,dword ptr [ECX]
005ebb50 : MOV EDX,dword ptr [EAX + 0x38]
005ebb53 : MOV dword ptr [ESP + 0x8],EBX
005ebb57 : CALL EDX
005ebb59 : TEST EAX,EAX
005ebb5b : JZ 0x005ebdd1
005ebb61 : MOV ECX,dword ptr [EBX + 0x2c]
005ebb64 : PUSH EBP
005ebb65 : PUSH ESI
005ebb66 : PUSH 0x0
005ebb68 : PUSH 0x2c
005ebb6a : CALL 0x00515840
005ebb6f : MOV ESI,EAX
005ebb71 : TEST ESI,ESI
005ebb73 : JZ 0x005ebb91
005ebb75 : MOV ECX,dword ptr [EDI + 0xc]
005ebb78 : MOV EAX,dword ptr [ECX]
005ebb7a : MOV EDX,dword ptr [EAX + 0x38]
005ebb7d : CALL EDX
005ebb7f : PUSH 0x0
005ebb81 : PUSH EAX
005ebb82 : MOV ECX,ESI
005ebb84 : CALL 0x005e90c0
005ebb89 : MOV EBP,EAX
005ebb8b : MOV dword ptr [ESP + 0x6c],EBP
005ebb8f : JMP 0x005ebb9d
005ebb91 : MOV dword ptr [ESP + 0x6c],0x0
005ebb99 : MOV EBP,dword ptr [ESP + 0x6c]
005ebb9d : MOV EAX,dword ptr [EBX + 0xc]
005ebba0 : ADD EBX,0xc
005ebba3 : MOV dword ptr [EBP + 0x8],EAX
005ebba6 : MOV ECX,dword ptr [EBX + 0x4]
005ebba9 : MOV dword ptr [EBP + 0xc],ECX
005ebbac : MOV EDX,dword ptr [EBX + 0x8]
005ebbaf : MOV dword ptr [EBP + 0x10],EDX
005ebbb2 : MOV EAX,dword ptr [EBX + 0xc]
005ebbb5 : MOV dword ptr [EBP + 0x14],EAX
005ebbb8 : INC dword ptr [EBP + 0x4]
005ebbbb : MOV ECX,dword ptr [EDI + 0x10]
005ebbbe : TEST ECX,ECX
005ebbc0 : JZ 0x005ebbc7
005ebbc2 : CALL 0x004ff7c0
005ebbc7 : MOV dword ptr [EDI + 0x10],EBP
005ebbca : FILD dword ptr [EBX]
005ebbcc : MOV ECX,dword ptr [EDI + 0xc]
005ebbcf : MOV EDX,dword ptr [ECX]
005ebbd1 : FDIV double ptr [0x00b94848]
005ebbd7 : MOV EAX,dword ptr [EDX + 0x38]
005ebbda : FSTP float ptr [ESP + 0x18]
005ebbde : CALL EAX
005ebbe0 : XOR EBX,EBX
005ebbe2 : MOV dword ptr [ESP + 0x1c],EAX
005ebbe6 : TEST EAX,EAX
005ebbe8 : JBE 0x005ebdc8
005ebbee : MOV EDI,EDI
005ebbf0 : PUSH EBX
005ebbf1 : MOV ECX,EBP
005ebbf3 : CALL 0x005e1290
005ebbf8 : ADD EAX,0x8
005ebbfb : CMP dword ptr [EAX],0x0
005ebbfe : JNZ 0x005ebdbd
005ebc04 : CMP dword ptr [EAX + 0x4],0x0
005ebc08 : JNZ 0x005ebdbd
005ebc0e : MOV ECX,dword ptr [EDI + 0xc]
005ebc11 : MOV EDX,dword ptr [ECX]
005ebc13 : MOV EAX,dword ptr [EDX + 0x18]
005ebc16 : PUSH 0x0
005ebc18 : PUSH EBX
005ebc19 : CALL EAX
005ebc1b : MOV ESI,EAX
005ebc1d : TEST ESI,ESI
005ebc1f : JZ 0x005ebdbd
005ebc25 : FLDZ
005ebc27 : MOV EDX,dword ptr [ESI]
005ebc29 : MOV EDX,dword ptr [EDX + 0x14]
005ebc2c : FST float ptr [ESP + 0x2c]
005ebc30 : FST float ptr [ESP + 0x30]
005ebc34 : LEA EAX,[ESP + 0x2c]
005ebc38 : FST float ptr [ESP + 0x34]
005ebc3c : PUSH EAX
005ebc3d : MOV ECX,ESI
005ebc3f : FSTP float ptr [ESP + 0x3c]
005ebc43 : CALL EDX
005ebc45 : FLD float ptr [ESP + 0x34]
005ebc49 : FLD ST0
005ebc4b : FLD float ptr [ESP + 0x2c]
005ebc4f : FLD ST0
005ebc51 : FSUBP ST2,ST0
005ebc53 : FXCH
005ebc55 : FSTP float ptr [ESP + 0x14]
005ebc59 : FLD float ptr [ESP + 0x14]
005ebc5d : FLDZ
005ebc5f : FCOM
005ebc61 : FNSTSW AX
005ebc63 : FSTP ST1
005ebc65 : TEST AH,0x5
005ebc68 : JP 0x005ebda8
005ebc6e : FLD float ptr [ESP + 0x38]
005ebc72 : FLD ST0
005ebc74 : FLD float ptr [ESP + 0x30]
005ebc78 : FLD ST0
005ebc7a : FSUBP ST2,ST0
005ebc7c : FXCH
005ebc7e : FSTP float ptr [ESP + 0x14]
005ebc82 : FLD float ptr [ESP + 0x14]
005ebc86 : FCOMP ST3
005ebc88 : FNSTSW AX
005ebc8a : TEST AH,0x41
005ebc8d : JNZ 0x005ebdac
005ebc93 : MOV EAX,dword ptr [ESP + 0x10]
005ebc97 : FILD dword ptr [EAX + 0x10]
005ebc9a : FSTP float ptr [ESP + 0x14]
005ebc9e : FLD float ptr [ESP + 0x18]
005ebca2 : FLD ST0
005ebca4 : FMULP ST5
005ebca6 : FLD float ptr [ESP + 0x14]
005ebcaa : FLD ST0
005ebcac : FSUBP ST6,ST0
005ebcae : FXCH ST5
005ebcb0 : FSTP float ptr [ESP + 0x4c]
005ebcb4 : FLD ST0
005ebcb6 : FMULP ST2
005ebcb8 : FLD ST4
005ebcba : FSUBP ST2,ST0
005ebcbc : FXCH
005ebcbe : FSTP float ptr [ESP + 0x50]
005ebcc2 : FLD ST0
005ebcc4 : FMULP ST5
005ebcc6 : FLD ST3
005ebcc8 : FADDP ST5,ST0
005ebcca : FXCH ST4
005ebccc : FSTP float ptr [ESP + 0x54]
005ebcd0 : FMULP ST3
005ebcd2 : FXCH ST2
005ebcd4 : FADDP
005ebcd6 : FSTP float ptr [ESP + 0x58]
005ebcda : FST float ptr [ESP + 0x5c]
005ebcde : FST float ptr [ESP + 0x60]
005ebce2 : FLD float ptr [ESP + 0x54]
005ebce6 : FSUB float ptr [ESP + 0x4c]
005ebcea : FSTP float ptr [ESP + 0x14]
005ebcee : FLD float ptr [ESP + 0x14]
005ebcf2 : FCOMP
005ebcf4 : FNSTSW AX
005ebcf6 : TEST AH,0x41
005ebcf9 : JNZ 0x005ebdb4
005ebcff : FLD float ptr [ESP + 0x58]
005ebd03 : FSUB float ptr [ESP + 0x50]
005ebd07 : FSTP float ptr [ESP + 0x14]
005ebd0b : FCOMP float ptr [ESP + 0x14]
005ebd0f : FNSTSW AX
005ebd11 : TEST AH,0x5
005ebd14 : JP 0x005ebdb6
005ebd1a : MOV EDX,dword ptr [ESI]
005ebd1c : MOV EAX,0xffffffff
005ebd21 : MOV dword ptr [ESP + 0x44],EAX
005ebd25 : MOV dword ptr [ESP + 0x48],EAX
005ebd29 : MOV EAX,dword ptr [EDX + 0x1c]
005ebd2c : MOV ECX,ESI
005ebd2e : MOV dword ptr [ESP + 0x3c],EDI
005ebd32 : MOV dword ptr [ESP + 0x40],EBX
005ebd36 : CALL EAX
005ebd38 : MOV EBP,dword ptr [ESP + 0x10]
005ebd3c : LEA ECX,[ESP + 0x20]
005ebd40 : ADD EBP,0x148
005ebd46 : PUSH ECX
005ebd47 : MOV ECX,EBP
005ebd49 : MOV dword ptr [ESP + 0x24],EDI
005ebd4d : MOV dword ptr [ESP + 0x28],ESI
005ebd51 : MOV dword ptr [ESP + 0x2c],EAX
005ebd55 : CALL 0x005eb560
005ebd5a : TEST EAX,EAX
005ebd5c : JZ 0x005ebd78
005ebd5e : MOV EDX,dword ptr [EAX]
005ebd60 : LEA ECX,[ESP + 0x3c]
005ebd64 : PUSH ECX
005ebd65 : MOV ECX,dword ptr [ESP + 0x6c]
005ebd69 : MOV dword ptr [ESP + 0x48],EDX
005ebd6d : CALL 0x005eb920
005ebd72 : MOV EBP,dword ptr [ESP + 0x6c]
005ebd76 : JMP 0x005ebdb6
005ebd78 : MOV EAX,dword ptr [ESP + 0x68]
005ebd7c : MOV ECX,dword ptr [EAX + 0x4]
005ebd7f : LEA EDX,[ESP + 0x14]
005ebd83 : PUSH EDX
005ebd84 : LEA EAX,[ESP + 0x24]
005ebd88 : MOV dword ptr [ESP + 0x18],ECX
005ebd8c : PUSH EAX
005ebd8d : MOV ECX,EBP
005ebd8f : CALL 0x005ebb00
005ebd94 : LEA ECX,[ESP + 0x3c]
005ebd98 : PUSH ECX
005ebd99 : MOV ECX,dword ptr [ESP + 0x6c]
005ebd9d : CALL 0x005eb920
005ebda2 : MOV EBP,dword ptr [ESP + 0x6c]
005ebda6 : JMP 0x005ebdb6
005ebda8 : FSTP ST0
005ebdaa : JMP 0x005ebdb2
005ebdac : FSTP ST2
005ebdae : FSTP ST2
005ebdb0 : FSTP ST1
005ebdb2 : FSTP ST0
005ebdb4 : FSTP ST0
005ebdb6 : MOV ECX,ESI
005ebdb8 : CALL 0x00557b30
005ebdbd : INC EBX
005ebdbe : CMP EBX,dword ptr [ESP + 0x1c]
005ebdc2 : JC 0x005ebbf0
005ebdc8 : MOV ECX,EBP
005ebdca : CALL 0x004ff7c0
005ebdcf : POP ESI
005ebdd0 : POP EBP
005ebdd1 : POP EDI
005ebdd2 : POP EBX
005ebdd3 : ADD ESP,0x54
005ebdd6 : RET 0x8
