PROGRAM  : Maestia.exe
FUNCTION : FUN_005924a0
ENTRY    : 005924a0
BODY     : [[005924a0, 0059267c]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005924a0(GRefCountImpl *param_1,undefined4 param_2,int param_3)

{
  undefined4 uVar1;
  undefined4 *puVar2;
  uint uVar3;
  GRefCountNTSImpl *this;
  GRefCountImpl *pGVar4;
  int iVar5;
  int in_ECX;
  int *piVar6;
  int *piVar7;
  
  if (*(int *)(in_ECX + 0x1ac) == 0) {
    puVar2 = (undefined4 *)FUN_00515840(0x24,0);
    if (puVar2 == (undefined4 *)0x0) {
      puVar2 = (undefined4 *)0x0;
    }
    else {
      puVar2[2] = 0;
      puVar2[3] = 0;
      puVar2[4] = 0;
      puVar2[5] = 0;
      puVar2[6] = 0;
      puVar2[7] = 0;
      puVar2[8] = 0;
      *puVar2 = 100;
      puVar2[1] = 0;
    }
    *(undefined4 **)(in_ECX + 0x1ac) = puVar2;
  }
  uVar3 = 0;
  if (*(int *)(*(int *)(in_ECX + 0x1ac) + 0xc) != 0) {
    piVar7 = *(int **)(*(int *)(in_ECX + 0x1ac) + 8);
    piVar6 = piVar7;
    do {
      if (*(GRefCountImpl **)(*piVar6 + 8) == param_1) {
        if (piVar7[uVar3] != 0) {
          piVar6 = (int *)(piVar7[uVar3] + 4);
          *piVar6 = *piVar6 + 1;
        }
        this = (GRefCountNTSImpl *)piVar7[uVar3];
        if (this != (GRefCountNTSImpl *)0x0) goto LAB_0059264f;
        break;
      }
      uVar3 = uVar3 + 1;
      piVar6 = piVar6 + 1;
    } while (uVar3 < *(uint *)(*(int *)(in_ECX + 0x1ac) + 0xc));
  }
  this = (GRefCountNTSImpl *)FUN_00515840(0x14,0);
  if (this == (GRefCountNTSImpl *)0x0) {
    this = (GRefCountNTSImpl *)0x0;
  }
  else {
    *(undefined ***)this = &PTR_FUN_00cd3f2c;
    *(undefined4 *)(this + 4) = 1;
    *(undefined ***)this = &PTR_FUN_00b8e59c;
    *(undefined4 *)(this + 8) = 0;
    *(undefined4 *)(this + 0xc) = 0;
    *(undefined4 *)(this + 0x10) = 0;
  }
  if (param_1 != (GRefCountImpl *)0x0) {
    GRefCountImpl::AddRef(param_1);
  }
  if (*(GRefCountImpl **)(this + 8) != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release(*(GRefCountImpl **)(this + 8));
  }
  *(GRefCountImpl **)(this + 8) = param_1;
  iVar5 = *(int *)(in_ECX + 0x1ac);
  piVar7 = (int *)(iVar5 + 8);
  uVar3 = *(int *)(iVar5 + 0xc) + 1;
  if (uVar3 < *(uint *)(iVar5 + 0xc)) {
    pGVar4 = (GRefCountImpl *)(*(uint *)(iVar5 + 0xc) - uVar3);
    puVar2 = (undefined4 *)(*piVar7 + -4 + (int)(pGVar4 + uVar3) * 4);
    while (pGVar4 != (GRefCountImpl *)0x0) {
      if ((GRefCountNTSImpl *)*puVar2 != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release((GRefCountNTSImpl *)*puVar2);
      }
      puVar2 = puVar2 + -1;
      pGVar4 = pGVar4 + -1;
      param_1 = pGVar4;
    }
    if (uVar3 < *(uint *)(iVar5 + 0x10) >> 1) {
      FUN_005b5ef0(piVar7,uVar3);
    }
  }
  else if (*(uint *)(iVar5 + 0x10) <= uVar3) {
    FUN_005b5ef0(piVar7,(uVar3 >> 2) + uVar3);
  }
  *(uint *)(iVar5 + 0xc) = uVar3;
  puVar2 = (undefined4 *)(*piVar7 + -4 + uVar3 * 4);
  if (puVar2 != (undefined4 *)0x0) {
    if (this != (GRefCountNTSImpl *)0x0) {
      *(int *)(this + 4) = *(int *)(this + 4) + 1;
    }
    *puVar2 = this;
  }
  uVar1 = *(undefined4 *)(in_ECX + 0xa0);
  param_1 = (GRefCountImpl *)
            (CONCAT31(param_1._1_3_,(char)(*(uint *)(in_ECX + 0x8c) >> 0x13)) & 0xffffff01);
  iVar5 = FUN_0058ca10(param_1);
  if (iVar5 == -1) {
    FUN_0051d620(uVar1);
  }
  else if (iVar5 == 1) {
    FUN_0051d5a0(uVar1);
  }
LAB_0059264f:
  *(undefined4 *)(this + 0xc) = param_2;
  *(int *)(this + 0x10) = param_3;
  if (param_3 != 0) {
    *(int *)(param_3 + 0x1c) = *(int *)(param_3 + 0x1c) + 1;
    GRefCountImpl::AddRef(*(GRefCountImpl **)(this + 0x10));
  }
  GRefCountNTSImpl::Release(this);
  return;
}



============================================================
DISASSEMBLY
============================================================
005924a0 : SUB ESP,0x8
005924a3 : PUSH EBX
005924a4 : PUSH EBP
005924a5 : PUSH ESI
005924a6 : PUSH EDI
005924a7 : MOV EBP,ECX
005924a9 : XOR EDI,EDI
005924ab : MOV dword ptr [ESP + 0x14],EBP
005924af : CMP dword ptr [EBP + 0x1ac],EDI
005924b5 : JNZ 0x005924f1
005924b7 : MOV ECX,dword ptr [0x00d73250]
005924bd : PUSH EDI
005924be : PUSH 0x24
005924c0 : CALL 0x00515840
005924c5 : CMP EAX,EDI
005924c7 : JZ 0x005924e9
005924c9 : MOV dword ptr [EAX + 0x8],EDI
005924cc : MOV dword ptr [EAX + 0xc],EDI
005924cf : MOV dword ptr [EAX + 0x10],EDI
005924d2 : MOV dword ptr [EAX + 0x14],EDI
005924d5 : MOV dword ptr [EAX + 0x18],EDI
005924d8 : MOV dword ptr [EAX + 0x1c],EDI
005924db : MOV dword ptr [EAX + 0x20],EDI
005924de : MOV dword ptr [EAX],0x64
005924e4 : MOV dword ptr [EAX + 0x4],EDI
005924e7 : JMP 0x005924eb
005924e9 : XOR EAX,EAX
005924eb : MOV dword ptr [EBP + 0x1ac],EAX
005924f1 : MOV ECX,dword ptr [EBP + 0x1ac]
005924f7 : XOR EAX,EAX
005924f9 : CMP dword ptr [ECX + 0xc],EDI
005924fc : JBE 0x00592534
005924fe : MOV EDX,dword ptr [ECX + 0x8]
00592501 : MOV ECX,EDX
00592503 : MOV ESI,dword ptr [ECX]
00592505 : MOV EBX,dword ptr [ESP + 0x1c]
00592509 : CMP dword ptr [ESI + 0x8],EBX
0059250c : JZ 0x0059251f
0059250e : MOV ESI,dword ptr [EBP + 0x1ac]
00592514 : INC EAX
00592515 : ADD ECX,0x4
00592518 : CMP EAX,dword ptr [ESI + 0xc]
0059251b : JC 0x00592503
0059251d : JMP 0x00592534
0059251f : MOV ECX,dword ptr [EDX + EAX*0x4]
00592522 : CMP ECX,EDI
00592524 : JZ 0x00592529
00592526 : INC dword ptr [ECX + 0x4]
00592529 : MOV ESI,dword ptr [EDX + EAX*0x4]
0059252c : CMP ESI,EDI
0059252e : JNZ 0x0059264f
00592534 : MOV ECX,dword ptr [0x00d73250]
0059253a : PUSH EDI
0059253b : PUSH 0x14
0059253d : CALL 0x00515840
00592542 : CMP EAX,EDI
00592544 : JZ 0x00592566
00592546 : MOV dword ptr [EAX],0xcd3f2c
0059254c : MOV dword ptr [EAX + 0x4],0x1
00592553 : MOV dword ptr [EAX],0xb8e59c
00592559 : MOV dword ptr [EAX + 0x8],EDI
0059255c : MOV dword ptr [EAX + 0xc],EDI
0059255f : MOV dword ptr [EAX + 0x10],EDI
00592562 : MOV EBX,EAX
00592564 : JMP 0x00592568
00592566 : XOR EBX,EBX
00592568 : MOV ESI,dword ptr [ESP + 0x1c]
0059256c : MOV dword ptr [ESP + 0x10],EBX
00592570 : CMP ESI,EDI
00592572 : JZ 0x0059257b
00592574 : MOV ECX,ESI
00592576 : CALL 0x00523dd0
0059257b : MOV ECX,dword ptr [EBX + 0x8]
0059257e : CMP ECX,EDI
00592580 : JZ 0x00592587
00592582 : CALL 0x004ff7e0
00592587 : MOV dword ptr [EBX + 0x8],ESI
0059258a : MOV ESI,dword ptr [EBP + 0x1ac]
00592590 : MOV EDI,dword ptr [ESI + 0xc]
00592593 : MOV EAX,dword ptr [ESI + 0xc]
00592596 : ADD ESI,0x8
00592599 : INC EDI
0059259a : CMP EDI,EAX
0059259c : JNC 0x0059262a
005925a2 : MOV EDX,dword ptr [ESI]
005925a4 : SUB EAX,EDI
005925a6 : LEA ECX,[EAX + EDI*0x1]
005925a9 : LEA EBP,[EDX + ECX*0x4 + -0x4]
005925ad : JZ 0x005925c9
005925af : MOV dword ptr [ESP + 0x1c],EAX
005925b3 : MOV ECX,dword ptr [EBP]
005925b6 : TEST ECX,ECX
005925b8 : JZ 0x005925bf
005925ba : CALL 0x004ff7c0
005925bf : SUB EBP,0x4
005925c2 : SUB dword ptr [ESP + 0x1c],0x1
005925c7 : JNZ 0x005925b3
005925c9 : MOV EAX,dword ptr [ESI + 0x8]
005925cc : SHR EAX,0x1
005925ce : CMP EDI,EAX
005925d0 : JNC 0x005925db
005925d2 : PUSH EDI
005925d3 : PUSH ESI
005925d4 : MOV ECX,ESI
005925d6 : CALL 0x005b5ef0
005925db : MOV EBP,dword ptr [ESP + 0x14]
005925df : MOV EDX,dword ptr [ESI]
005925e1 : MOV dword ptr [ESI + 0x4],EDI
005925e4 : LEA EDI,[EDX + EDI*0x4 + -0x4]
005925e8 : TEST EDI,EDI
005925ea : JZ 0x005925f5
005925ec : TEST EBX,EBX
005925ee : JZ 0x005925f3
005925f0 : INC dword ptr [EBX + 0x4]
005925f3 : MOV dword ptr [EDI],EBX
005925f5 : MOV EAX,dword ptr [EBP + 0x8c]
005925fb : MOV ESI,dword ptr [EBP + 0xa0]
00592601 : SHR EAX,0x13
00592604 : AND AL,0x1
00592606 : MOV byte ptr [ESP + 0x1c],AL
0059260a : MOV ECX,dword ptr [ESP + 0x1c]
0059260e : PUSH ECX
0059260f : MOV ECX,EBP
00592611 : CALL 0x0058ca10
00592616 : CMP EAX,-0x1
00592619 : JZ 0x00592641
0059261b : CMP EAX,0x1
0059261e : JNZ 0x00592649
00592620 : PUSH ESI
00592621 : MOV ECX,EBP
00592623 : CALL 0x0051d5a0
00592628 : JMP 0x00592649
0059262a : CMP EDI,dword ptr [ESI + 0x8]
0059262d : JC 0x005925df
0059262f : MOV ECX,EDI
00592631 : SHR ECX,0x2
00592634 : ADD ECX,EDI
00592636 : PUSH ECX
00592637 : PUSH ESI
00592638 : MOV ECX,ESI
0059263a : CALL 0x005b5ef0
0059263f : JMP 0x005925df
00592641 : PUSH ESI
00592642 : MOV ECX,EBP
00592644 : CALL 0x0051d620
00592649 : MOV ESI,dword ptr [ESP + 0x10]
0059264d : XOR EDI,EDI
0059264f : MOV EAX,dword ptr [ESP + 0x24]
00592653 : MOV EDX,dword ptr [ESP + 0x20]
00592657 : MOV dword ptr [ESI + 0xc],EDX
0059265a : MOV dword ptr [ESI + 0x10],EAX
0059265d : CMP EAX,EDI
0059265f : JZ 0x0059266c
00592661 : INC dword ptr [EAX + 0x1c]
00592664 : MOV ECX,dword ptr [ESI + 0x10]
00592667 : CALL 0x00523dd0
0059266c : MOV ECX,ESI
0059266e : CALL 0x004ff7c0
00592673 : POP EDI
00592674 : POP ESI
00592675 : POP EBP
00592676 : POP EBX
00592677 : ADD ESP,0x8
0059267a : RET 0xc
