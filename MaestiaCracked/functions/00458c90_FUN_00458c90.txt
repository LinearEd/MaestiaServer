PROGRAM  : Maestia.exe
FUNCTION : FUN_00458c90
ENTRY    : 00458c90
BODY     : [[00458c90, 00458cfc] [00458d00, 00458e2d]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Removing unreachable block (ram,0x00458daa) */

void FUN_00458c90(void)

{
  ushort *puVar1;
  int iVar2;
  undefined4 *puVar3;
  undefined4 uVar4;
  uint uVar5;
  uint uVar6;
  ushort *puVar7;
  int unaff_ESI;
  undefined4 *puVar8;
  undefined4 *puVar9;
  undefined8 uVar10;
  
  if (*(uint *)(unaff_ESI + 0x24) <
      (*(int *)(unaff_ESI + 0x18) - *(int *)(unaff_ESI + 0x14) >> 2) - 1U) {
    if (*(uint *)(unaff_ESI + 0x20) < *(uint *)(unaff_ESI + 0x24)) {
      *(uint *)(unaff_ESI + 0x20) = *(uint *)(unaff_ESI + 0x20) * 2 + 1;
    }
  }
  else {
    *(int *)(unaff_ESI + 0x20) =
         (*(int *)(unaff_ESI + 0x18) - *(int *)(unaff_ESI + 0x14) >> 2) * 2 + -3;
    FUN_0044f4a0(*(undefined4 *)(unaff_ESI + 8));
  }
  uVar5 = (*(int *)(unaff_ESI + 0x24) - (*(uint *)(unaff_ESI + 0x20) >> 1)) - 1;
  puVar8 = *(undefined4 **)(uVar5 * 4 + *(int *)(unaff_ESI + 0x14));
  if (puVar8 != *(undefined4 **)(uVar5 * 4 + *(int *)(unaff_ESI + 0x14) + 4)) {
    do {
      if ((uint)puVar8[8] < 8) {
        puVar7 = (ushort *)(puVar8 + 3);
      }
      else {
        puVar7 = (ushort *)puVar8[3];
      }
      puVar1 = puVar7 + puVar8[7];
      uVar6 = 0x811c9dc5;
      for (; puVar7 != puVar1; puVar7 = puVar7 + 1) {
        uVar6 = uVar6 * 0x1000193 ^ (uint)*puVar7;
      }
      uVar10 = FUN_0063871f(uVar6 & 0x7fffffff,0x1f31d);
      uVar6 = (int)((ulonglong)uVar10 >> 0x20) * 0x41a7 + (int)uVar10 * -0xb14;
      if ((int)uVar6 < 0) {
        uVar6 = uVar6 + 0x7fffffff;
      }
      if ((*(uint *)(unaff_ESI + 0x20) & uVar6) == uVar5) {
        puVar9 = (undefined4 *)*puVar8;
      }
      else {
        puVar9 = (undefined4 *)*puVar8;
        if (puVar9 != *(undefined4 **)(unaff_ESI + 8)) {
          iVar2 = uVar5 * 4;
          puVar3 = *(undefined4 **)(iVar2 + *(int *)(unaff_ESI + 0x14));
          uVar6 = uVar5;
          while ((puVar8 == puVar3 &&
                 (*(undefined4 **)(iVar2 + *(int *)(unaff_ESI + 0x14)) = puVar9, uVar6 != 0))) {
            uVar6 = uVar6 - 1;
            iVar2 = uVar6 * 4;
            puVar3 = *(undefined4 **)(iVar2 + *(int *)(unaff_ESI + 0x14));
          }
          iVar2 = *(int *)(unaff_ESI + 8);
          *(undefined4 **)puVar8[1] = puVar9;
          *(int *)puVar9[1] = iVar2;
          **(undefined4 **)(iVar2 + 4) = puVar8;
          uVar4 = *(undefined4 *)(iVar2 + 4);
          *(undefined4 *)(iVar2 + 4) = puVar9[1];
          puVar9[1] = puVar8[1];
          puVar8[1] = uVar4;
          puVar8 = *(undefined4 **)(*(int *)(unaff_ESI + 8) + 4);
          *(int *)(*(int *)(unaff_ESI + 0x14) + 4 + *(int *)(unaff_ESI + 0x24) * 4) =
               *(int *)(unaff_ESI + 8);
        }
        for (uVar6 = *(uint *)(unaff_ESI + 0x24);
            (uVar5 < uVar6 &&
            (*(int *)(*(int *)(unaff_ESI + 0x14) + uVar6 * 4) == *(int *)(unaff_ESI + 8)));
            uVar6 = uVar6 - 1) {
          *(undefined4 **)(*(int *)(unaff_ESI + 0x14) + uVar6 * 4) = puVar8;
        }
        if (puVar9 == *(undefined4 **)(unaff_ESI + 8)) break;
      }
      puVar8 = puVar9;
    } while (puVar9 != *(undefined4 **)(uVar5 * 4 + 4 + *(int *)(unaff_ESI + 0x14)));
  }
  *(int *)(unaff_ESI + 0x24) = *(int *)(unaff_ESI + 0x24) + 1;
  return;
}



============================================================
DISASSEMBLY
============================================================
00458c90 : PUSH EBP
00458c91 : MOV EBP,ESP
00458c93 : MOV EDX,dword ptr [ESI + 0x18]
00458c96 : SUB EDX,dword ptr [ESI + 0x14]
00458c99 : MOV ECX,dword ptr [ESI + 0x24]
00458c9c : LEA EAX,[ESI + 0x10]
00458c9f : SUB ESP,0x8
00458ca2 : SAR EDX,0x2
00458ca5 : DEC EDX
00458ca6 : PUSH EBX
00458ca7 : PUSH EDI
00458ca8 : CMP EDX,ECX
00458caa : JA 0x00458cca
00458cac : MOV ECX,dword ptr [EAX + 0x8]
00458caf : SUB ECX,dword ptr [EAX + 0x4]
00458cb2 : MOV EDX,dword ptr [ESI + 0x8]
00458cb5 : SAR ECX,0x2
00458cb8 : LEA ECX,[ECX + ECX*0x1 + -0x3]
00458cbc : MOV dword ptr [ESI + 0x20],ECX
00458cbf : PUSH EDX
00458cc0 : ADD ECX,0x2
00458cc3 : CALL 0x0044f4a0
00458cc8 : JMP 0x00458cd8
00458cca : MOV EAX,dword ptr [ESI + 0x20]
00458ccd : CMP EAX,ECX
00458ccf : JNC 0x00458cd8
00458cd1 : LEA EAX,[EAX + EAX*0x1 + 0x1]
00458cd5 : MOV dword ptr [ESI + 0x20],EAX
00458cd8 : MOV ECX,dword ptr [ESI + 0x20]
00458cdb : MOV EAX,dword ptr [ESI + 0x24]
00458cde : MOV EDX,dword ptr [ESI + 0x14]
00458ce1 : SHR ECX,0x1
00458ce3 : SUB EAX,ECX
00458ce5 : DEC EAX
00458ce6 : MOV dword ptr [EBP + -0x4],EAX
00458ce9 : ADD EAX,EAX
00458ceb : ADD EAX,EAX
00458ced : MOV EDI,dword ptr [EAX + EDX*0x1]
00458cf0 : ADD EAX,EDX
00458cf2 : CMP EDI,dword ptr [EAX + 0x4]
00458cf5 : JZ 0x00458e25
00458cfb : JMP 0x00458d00
00458d00 : CMP dword ptr [EDI + 0x20],0x8
00458d04 : JC 0x00458d0b
00458d06 : MOV ECX,dword ptr [EDI + 0xc]
00458d09 : JMP 0x00458d0e
00458d0b : LEA ECX,[EDI + 0xc]
00458d0e : MOV EDX,dword ptr [EDI + 0x1c]
00458d11 : LEA EDX,[ECX + EDX*0x2]
00458d14 : MOV EAX,0x811c9dc5
00458d19 : CMP ECX,EDX
00458d1b : JZ 0x00458d32
00458d1d : LEA ECX,[ECX]
00458d20 : MOVZX EBX,word ptr [ECX]
00458d23 : IMUL EAX,EAX,0x1000193
00458d29 : ADD ECX,0x2
00458d2c : XOR EAX,EBX
00458d2e : CMP ECX,EDX
00458d30 : JNZ 0x00458d20
00458d32 : AND EAX,0x7fffffff
00458d37 : PUSH 0x1f31d
00458d3c : PUSH EAX
00458d3d : CALL 0x0063871f
00458d42 : IMUL EDX,EDX,0x41a7
00458d48 : IMUL EAX,EAX,0xb14
00458d4e : ADD ESP,0x8
00458d51 : SUB EDX,EAX
00458d53 : JNS 0x00458d5b
00458d55 : ADD EDX,0x7fffffff
00458d5b : MOV EAX,dword ptr [ESI + 0x20]
00458d5e : MOV ECX,dword ptr [EBP + -0x4]
00458d61 : AND EAX,EDX
00458d63 : CMP EAX,ECX
00458d65 : JNZ 0x00458d6e
00458d67 : MOV EDI,dword ptr [EDI]
00458d69 : JMP 0x00458e11
00458d6e : MOV EDX,dword ptr [EDI]
00458d70 : MOV dword ptr [EBP + -0x8],EDX
00458d73 : CMP EDX,dword ptr [ESI + 0x8]
00458d76 : JZ 0x00458dea
00458d78 : MOV EBX,dword ptr [ESI + 0x14]
00458d7b : MOV EAX,ECX
00458d7d : ADD ECX,ECX
00458d7f : ADD ECX,ECX
00458d81 : CMP EDI,dword ptr [ECX + EBX*0x1]
00458d84 : JNZ 0x00458da0
00458d86 : MOV EBX,dword ptr [ESI + 0x14]
00458d89 : MOV dword ptr [ECX + EBX*0x1],EDX
00458d8c : TEST EAX,EAX
00458d8e : JZ 0x00458da0
00458d90 : MOV EBX,dword ptr [ESI + 0x14]
00458d93 : DEC EAX
00458d94 : LEA ECX,[EAX*0x4 + 0x0]
00458d9b : CMP EDI,dword ptr [ECX + EBX*0x1]
00458d9e : JZ 0x00458d86
00458da0 : MOV EBX,dword ptr [ESI + 0x8]
00458da3 : LEA EAX,[ESI + 0x4]
00458da6 : CMP EAX,EAX
00458da8 : JZ 0x00458db6
00458daa : XOR ECX,ECX
00458dac : MOV EDX,EAX
00458dae : CALL 0x00459450
00458db3 : MOV EDX,dword ptr [EBP + -0x8]
00458db6 : MOV ECX,dword ptr [EDI + 0x4]
00458db9 : MOV dword ptr [ECX],EDX
00458dbb : MOV EAX,dword ptr [EDX + 0x4]
00458dbe : MOV dword ptr [EAX],EBX
00458dc0 : MOV ECX,dword ptr [EBX + 0x4]
00458dc3 : MOV dword ptr [ECX],EDI
00458dc5 : MOV EAX,dword ptr [EBX + 0x4]
00458dc8 : MOV ECX,dword ptr [EDX + 0x4]
00458dcb : MOV dword ptr [EBX + 0x4],ECX
00458dce : MOV ECX,dword ptr [EDI + 0x4]
00458dd1 : MOV dword ptr [EDX + 0x4],ECX
00458dd4 : MOV dword ptr [EDI + 0x4],EAX
00458dd7 : MOV EAX,dword ptr [ESI + 0x8]
00458dda : MOV ECX,dword ptr [ESI + 0x24]
00458ddd : MOV EBX,dword ptr [ESI + 0x14]
00458de0 : MOV EDI,dword ptr [EAX + 0x4]
00458de3 : MOV dword ptr [EBX + ECX*0x4 + 0x4],EAX
00458de7 : MOV ECX,dword ptr [EBP + -0x4]
00458dea : MOV EAX,dword ptr [ESI + 0x24]
00458ded : CMP ECX,EAX
00458def : JNC 0x00458e0a
00458df1 : MOV ECX,dword ptr [ESI + 0x14]
00458df4 : MOV EBX,dword ptr [ECX + EAX*0x4]
00458df7 : LEA ECX,[ECX + EAX*0x4]
00458dfa : CMP EBX,dword ptr [ESI + 0x8]
00458dfd : JNZ 0x00458e07
00458dff : DEC EAX
00458e00 : MOV dword ptr [ECX],EDI
00458e02 : CMP dword ptr [EBP + -0x4],EAX
00458e05 : JC 0x00458df1
00458e07 : MOV ECX,dword ptr [EBP + -0x4]
00458e0a : CMP EDX,dword ptr [ESI + 0x8]
00458e0d : JZ 0x00458e25
00458e0f : MOV EDI,EDX
00458e11 : MOV EDX,dword ptr [ESI + 0x14]
00458e14 : LEA EAX,[ECX*0x4 + 0x0]
00458e1b : CMP EDI,dword ptr [EAX + EDX*0x1 + 0x4]
00458e1f : JNZ 0x00458d00
00458e25 : INC dword ptr [ESI + 0x24]
00458e28 : POP EDI
00458e29 : POP EBX
00458e2a : MOV ESP,EBP
00458e2c : POP EBP
00458e2d : RET
