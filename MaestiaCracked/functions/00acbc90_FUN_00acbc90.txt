PROGRAM  : Maestia.exe
FUNCTION : FUN_00acbc90
ENTRY    : 00acbc90
BODY     : [[00acbc90, 00acbe72]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00acbc90(undefined4 param_1,undefined4 param_2)

{
  int iVar1;
  int iVar2;
  wchar_t *_Src;
  byte bVar3;
  int unaff_ESI;
  uint8_t *packet;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  puStack_c = &LAB_00b4092e;
  local_10 = ExceptionList;
  ExceptionList = &local_10;
  iVar1 = *(int *)ThreadLocalStoragePointer;
  bVar3 = (byte)((ulonglong)(*(byte *)(iVar1 + 0x18) + 1) % 3);
  *(byte *)(iVar1 + 0x18) = bVar3;
  packet = (uint8_t *)((uint)bVar3 * 0x2000 + 0x122cb8 + iVar1);
  if (packet == (uint8_t *)0x0) {
    packet = (uint8_t *)0x0;
  }
  else {
    packet[0] = '\0';
    packet[1] = '\0';
    packet[2] = 0x8f;
    packet[3] = '\x14';
    packet[0x51] = '\0';
    packet[0x52] = '\0';
    packet[0x53] = '\0';
    packet[0x54] = '\0';
    packet[0x55] = '\0';
    packet[0x56] = '\0';
    packet[0x57] = '\0';
    packet[0x58] = '\0';
    packet[0x59] = '\0';
    packet[0x5a] = '\0';
    packet[0x5b] = '\0';
    packet[0x5c] = '\0';
    packet[0x5d] = '\0';
    packet[0x5e] = '\0';
    packet[0x5f] = '\0';
    packet[0x60] = '\0';
    packet[0x61] = '\0';
    packet[0x62] = '\0';
    packet[0x67] = 0xff;
  }
  local_8 = 0xffffffff;
  *(undefined4 *)(packet + 0x1e) = param_1;
  *(undefined4 *)(packet + 0x22) = param_2;
  *(undefined2 *)(packet + 4) = *(undefined2 *)(unaff_ESI + 0x38);
  packet[6] = *(uint8_t *)(unaff_ESI + 0x3a);
  *(undefined2 *)(packet + 7) = *(undefined2 *)(unaff_ESI + 0x3c);
  *(undefined2 *)(packet + 9) = *(undefined2 *)(unaff_ESI + 0x3e);
  *(int *)(packet + 0x10) = *(int *)(unaff_ESI + 0x44) * 60000;
  *(undefined2 *)(packet + 0x18) = *(undefined2 *)(unaff_ESI + 0x50);
  *(undefined2 *)(packet + 0x1a) = *(undefined2 *)(unaff_ESI + 0x52);
  *(undefined2 *)(packet + 0x1c) = *(undefined2 *)(unaff_ESI + 0x54);
  *(int *)(packet + 0xc) = *(int *)(unaff_ESI + 0x48) * 60000;
  *(undefined4 *)(packet + 0x14) = *(undefined4 *)(unaff_ESI + 0x4c);
  packet[0xb] = *(uint8_t *)(unaff_ESI + 0x40);
  *(undefined8 *)(packet + 0x26) = *(undefined8 *)(unaff_ESI + 0x56);
  *(undefined2 *)(packet + 0x2e) = *(undefined2 *)(unaff_ESI + 0x5e);
  *(int *)(packet + 0x30) = *(int *)(unaff_ESI + 0x60) * 60000;
  *(undefined2 *)(packet + 0x34) = *(undefined2 *)(unaff_ESI + 0x6c);
  *(undefined2 *)(packet + 0x36) = *(undefined2 *)(unaff_ESI + 100);
  *(undefined2 *)(packet + 0x38) = *(undefined2 *)(unaff_ESI + 0x68);
  *(undefined2 *)(packet + 0x3a) = *(undefined2 *)(unaff_ESI + 0x80);
  *(undefined4 *)(packet + 0x3c) = *(undefined4 *)(unaff_ESI + 0x70);
  *(undefined2 *)(packet + 99) = *(undefined2 *)(unaff_ESI + 0x74);
  *(undefined2 *)(packet + 0x65) = *(undefined2 *)(unaff_ESI + 0x78);
  packet[0x40] = *(uint8_t *)(unaff_ESI + 0x7c);
  *(undefined4 *)(packet + 0x41) = *(undefined4 *)(unaff_ESI + 0xac);
  *(undefined4 *)(packet + 0x45) = *(undefined4 *)(unaff_ESI + 0xa4);
  *(undefined4 *)(packet + 0x49) = *(undefined4 *)(unaff_ESI + 0xa8);
  *(undefined4 *)(packet + 0x4d) = *(undefined4 *)(unaff_ESI + 0xb0);
  *(uint *)(packet + 0x51) = (uint)(*(int *)(unaff_ESI + 0x9c) != 0);
  if (*(uint *)(unaff_ESI + 0x9c) < 7) {
    if (*(uint *)(unaff_ESI + 0xa0) < 8) {
      _Src = (wchar_t *)(unaff_ESI + 0x8c);
    }
    else {
      _Src = *(wchar_t **)(unaff_ESI + 0x8c);
    }
    _wcscpy_s((wchar_t *)(packet + 0x55),7,_Src);
  }
  iVar2 = DAT_017247d4;
  packet[0x67] = *(uint8_t *)(unaff_ESI + 0xb5);
  iVar1 = *(int *)(iVar2 + 4);
  if ((iVar1 != 0) && (*(char *)(iVar2 + 8) != '\0')) {
    FUN_00a0dd40(iVar1,0x68,packet);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00acbc90 : PUSH EBP
00acbc91 : MOV EBP,ESP
00acbc93 : PUSH -0x1
00acbc95 : PUSH 0xb4092e
00acbc9a : MOV EAX,FS:[0x0]
00acbca0 : PUSH EAX
00acbca1 : SUB ESP,0x8
00acbca4 : PUSH EBX
00acbca5 : PUSH EDI
00acbca6 : MOV EAX,[0x00d66fa0]
00acbcab : XOR EAX,EBP
00acbcad : PUSH EAX
00acbcae : LEA EAX,[EBP + -0xc]
00acbcb1 : MOV FS:[0x0],EAX
00acbcb7 : MOV EAX,FS:[0x2c]
00acbcbd : MOV ECX,dword ptr [EAX]
00acbcbf : MOVZX EAX,byte ptr [ECX + 0x18]
00acbcc3 : INC EAX
00acbcc4 : CDQ
00acbcc5 : MOV EDI,0x3
00acbcca : IDIV EDI
00acbccc : MOV byte ptr [ECX + 0x18],DL
00acbccf : MOVZX EDX,DL
00acbcd2 : SHL EDX,0xd
00acbcd5 : LEA EDI,[EDX + ECX*0x1 + 0x122cb8]
00acbcdc : MOV dword ptr [EBP + -0x10],EDI
00acbcdf : XOR EBX,EBX
00acbce1 : MOV dword ptr [EBP + -0x4],EBX
00acbce4 : CMP EDI,EBX
00acbce6 : JZ 0x00acbd0e
00acbce8 : XOR EAX,EAX
00acbcea : MOV word ptr [EDI],AX
00acbced : MOV byte ptr [EDI + 0x2],0x8f
00acbcf1 : MOV byte ptr [EDI + 0x3],0x14
00acbcf5 : MOV dword ptr [EDI + 0x51],EBX
00acbcf8 : PXOR XMM0,XMM0
00acbcfc : MOVQ qword ptr [EDI + 0x55],XMM0
00acbd01 : MOV dword ptr [EDI + 0x5d],EBX
00acbd04 : MOV word ptr [EDI + 0x61],BX
00acbd08 : MOV byte ptr [EDI + 0x67],0xff
00acbd0c : JMP 0x00acbd10
00acbd0e : XOR EDI,EDI
00acbd10 : MOV dword ptr [EBP + -0x4],0xffffffff
00acbd17 : MOV ECX,dword ptr [EBP + 0x8]
00acbd1a : MOV EDX,dword ptr [EBP + 0xc]
00acbd1d : MOV dword ptr [EDI + 0x1e],ECX
00acbd20 : MOV dword ptr [EDI + 0x22],EDX
00acbd23 : MOVZX EAX,word ptr [ESI + 0x38]
00acbd27 : MOV word ptr [EDI + 0x4],AX
00acbd2b : MOVZX ECX,byte ptr [ESI + 0x3a]
00acbd2f : MOV byte ptr [EDI + 0x6],CL
00acbd32 : MOVZX EDX,word ptr [ESI + 0x3c]
00acbd36 : MOV word ptr [EDI + 0x7],DX
00acbd3a : MOVZX EAX,word ptr [ESI + 0x3e]
00acbd3e : MOV word ptr [EDI + 0x9],AX
00acbd42 : MOV ECX,dword ptr [ESI + 0x44]
00acbd45 : IMUL ECX,ECX,0xea60
00acbd4b : MOV dword ptr [EDI + 0x10],ECX
00acbd4e : MOVZX EDX,word ptr [ESI + 0x50]
00acbd52 : MOV word ptr [EDI + 0x18],DX
00acbd56 : MOVZX EAX,word ptr [ESI + 0x52]
00acbd5a : MOV word ptr [EDI + 0x1a],AX
00acbd5e : MOVZX ECX,word ptr [ESI + 0x54]
00acbd62 : MOV word ptr [EDI + 0x1c],CX
00acbd66 : MOV EDX,dword ptr [ESI + 0x48]
00acbd69 : IMUL EDX,EDX,0xea60
00acbd6f : MOV dword ptr [EDI + 0xc],EDX
00acbd72 : MOV EAX,dword ptr [ESI + 0x4c]
00acbd75 : MOV dword ptr [EDI + 0x14],EAX
00acbd78 : MOVZX ECX,byte ptr [ESI + 0x40]
00acbd7c : MOV byte ptr [EDI + 0xb],CL
00acbd7f : MOVQ XMM0,qword ptr [ESI + 0x56]
00acbd84 : MOVQ qword ptr [EDI + 0x26],XMM0
00acbd89 : MOVZX EDX,word ptr [ESI + 0x5e]
00acbd8d : MOV word ptr [EDI + 0x2e],DX
00acbd91 : MOV EAX,dword ptr [ESI + 0x60]
00acbd94 : IMUL EAX,EAX,0xea60
00acbd9a : MOV dword ptr [EDI + 0x30],EAX
00acbd9d : MOVZX ECX,word ptr [ESI + 0x6c]
00acbda1 : MOV word ptr [EDI + 0x34],CX
00acbda5 : MOVZX EDX,word ptr [ESI + 0x64]
00acbda9 : MOV word ptr [EDI + 0x36],DX
00acbdad : MOVZX EAX,word ptr [ESI + 0x68]
00acbdb1 : MOV word ptr [EDI + 0x38],AX
00acbdb5 : MOVZX ECX,word ptr [ESI + 0x80]
00acbdbc : MOV word ptr [EDI + 0x3a],CX
00acbdc0 : MOV EDX,dword ptr [ESI + 0x70]
00acbdc3 : MOV dword ptr [EDI + 0x3c],EDX
00acbdc6 : MOVZX EAX,word ptr [ESI + 0x74]
00acbdca : MOV word ptr [EDI + 0x63],AX
00acbdce : MOVZX ECX,word ptr [ESI + 0x78]
00acbdd2 : MOV word ptr [EDI + 0x65],CX
00acbdd6 : MOV DL,byte ptr [ESI + 0x7c]
00acbdd9 : MOV byte ptr [EDI + 0x40],DL
00acbddc : MOV EAX,dword ptr [ESI + 0xac]
00acbde2 : MOV dword ptr [EDI + 0x41],EAX
00acbde5 : MOV ECX,dword ptr [ESI + 0xa4]
00acbdeb : MOV dword ptr [EDI + 0x45],ECX
00acbdee : MOV EDX,dword ptr [ESI + 0xa8]
00acbdf4 : MOV dword ptr [EDI + 0x49],EDX
00acbdf7 : MOV EAX,dword ptr [ESI + 0xb0]
00acbdfd : XOR ECX,ECX
00acbdff : MOV dword ptr [EDI + 0x4d],EAX
00acbe02 : CMP dword ptr [ESI + 0x9c],EBX
00acbe08 : SETNZ CL
00acbe0b : MOV dword ptr [EDI + 0x51],ECX
00acbe0e : CMP dword ptr [ESI + 0x9c],0x7
00acbe15 : JNC 0x00acbe3d
00acbe17 : CMP dword ptr [ESI + 0xa0],0x8
00acbe1e : JC 0x00acbe28
00acbe20 : MOV EAX,dword ptr [ESI + 0x8c]
00acbe26 : JMP 0x00acbe2e
00acbe28 : LEA EAX,[ESI + 0x8c]
00acbe2e : PUSH EAX
00acbe2f : LEA EDX,[EDI + 0x55]
00acbe32 : PUSH 0x7
00acbe34 : PUSH EDX
00acbe35 : CALL 0x0063481b
00acbe3a : ADD ESP,0xc
00acbe3d : MOV AL,byte ptr [ESI + 0xb5]
00acbe43 : MOV ECX,dword ptr [0x017247d4]
00acbe49 : MOV byte ptr [EDI + 0x67],AL
00acbe4c : MOV EAX,dword ptr [ECX + 0x4]
00acbe4f : CMP EAX,EBX
00acbe51 : JZ 0x00acbe60
00acbe53 : CMP byte ptr [ECX + 0x8],BL
00acbe56 : JZ 0x00acbe60
00acbe58 : PUSH 0x68
00acbe5a : PUSH EAX
00acbe5b : CALL 0x00a0dd40
00acbe60 : MOV ECX,dword ptr [EBP + -0xc]
00acbe63 : MOV dword ptr FS:[0x0],ECX
00acbe6a : POP ECX
00acbe6b : POP EDI
00acbe6c : POP EBX
00acbe6d : MOV ESP,EBP
00acbe6f : POP EBP
00acbe70 : RET 0x8
