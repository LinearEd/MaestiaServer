PROGRAM  : Maestia.exe
FUNCTION : FUN_0091b9d0
ENTRY    : 0091b9d0
BODY     : [[0091b9d0, 0091bc7f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_0091b9d0(short param_1,char param_2,undefined4 param_3,undefined4 *param_4)

{
  short sVar1;
  int *piVar2;
  uint uVar3;
  int iVar4;
  undefined4 uVar5;
  undefined4 *puVar6;
  uint8_t *packet;
  int in_ECX;
  int in_stack_00000020;
  uint in_stack_00000024;
  wchar_t *pwVar7;
  undefined1 local_30 [28];
  int local_14;
  void *local_10;
  undefined1 *puStack_c;
  uint local_8;
  
  puStack_c = &LAB_00b3f841;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_8 = 0;
  if ((*(short *)(DAT_00da93ec + 0x450) == param_1) || (*(char *)(DAT_00da93ec + 0x3a8) != '\0')) {
    FUN_008018d0(L"[AvaGuiRvREvent::SendRvRJoin] already in RvR zone\n",uVar3);
    local_8 = 0xffffffff;
    if (in_stack_00000024 < 8) {
      ExceptionList = local_10;
      return;
    }
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  if (param_2 != '\0') {
    sVar1 = *(short *)(in_ECX + 0x3c);
    iVar4 = FUN_00917e80();
    if (iVar4 == 0) {
      pwVar7 = L"[AvaGuiRvREvent::SendRvRJoin] RvRConfig *config == NULL";
LAB_0091bb14:
      FUN_008018d0(pwVar7,uVar3);
      local_8 = 0xffffffff;
      FUN_00406560();
      ExceptionList = local_10;
      return;
    }
    if ((*(char *)(iVar4 + 7) == '\x01') && (*(char *)(iVar4 + 6) != '\n')) {
      if ((DAT_0172491c != 0) && ((*DAT_00da9894 != 0 && (*(int *)(*DAT_00da9894 + 0x1a8) != 0)))) {
        FUN_00406460(L"IDS_RVREVENT_OBSERVER_CANNOT_JOIN_YET");
        local_8._0_1_ = 1;
        piVar2 = *(int **)(*DAT_00da9894 + 0x1a8);
        uVar5 = FUN_0081d120(local_30);
        local_8._0_1_ = 2;
        (**(code **)(*piVar2 + 0x44))(uVar5,3);
        local_8._0_1_ = 1;
        FUN_00406560();
        local_8 = (uint)local_8._1_3_ << 8;
        FUN_00406560();
      }
      local_8 = 0xffffffff;
      FUN_00406560();
      ExceptionList = local_10;
      return;
    }
    if (((*(char *)(in_ECX + 0x38) != '\0') || ((int)PTR_FUN_00d6eb34 < 10000)) &&
       (DAT_00d6ee14 == sVar1)) {
      pwVar7 = L"[AvaGuiRvREvent::SendRvRJoin] Rejoin Requested";
      goto LAB_0091bb14;
    }
  }
  FUN_008018d0(L"[AvaGuiRvREvent::SendRvRJoin] Join zone %d, observer %d\n",param_1,param_2);
  *(char *)(in_ECX + 0x50) = param_2;
  puVar6 = param_4;
  if (in_stack_00000024 < 8) {
    puVar6 = &param_4;
  }
  iVar4 = FUN_00405b70(puVar6);
  if ((iVar4 == 0) && (in_stack_00000020 == 0)) {
    local_14 = FUN_006f4590();
    local_8 = CONCAT31(local_8._1_3_,4);
    if (local_14 != 0) {
      packet = (uint8_t *)FUN_0042a700(param_1,param_2);
      goto LAB_0091bbe2;
    }
  }
  else {
    local_14 = FUN_006f4590();
    local_8 = CONCAT31(local_8._1_3_,3);
    if (local_14 != 0) {
      packet = (uint8_t *)FUN_0042a700(param_1,param_2);
      goto LAB_0091bbe2;
    }
  }
  packet = (uint8_t *)0x0;
LAB_0091bbe2:
  local_8 = local_8 & 0xffffff00;
  if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
    FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),0x1a,packet);
  }
  PTR_FUN_00d6eb34 = (undefined *)0x0;
  DAT_00d6ee14 = param_1;
  local_8 = 0xffffffff;
  if (in_stack_00000024 < 8) {
    PTR_FUN_00d6eb34 = (undefined *)0x0;
    ExceptionList = local_10;
    return;
  }
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
0091b9d0 : PUSH EBP
0091b9d1 : MOV EBP,ESP
0091b9d3 : PUSH -0x1
0091b9d5 : PUSH 0xb3f841
0091b9da : MOV EAX,FS:[0x0]
0091b9e0 : PUSH EAX
0091b9e1 : SUB ESP,0x40
0091b9e4 : PUSH EBX
0091b9e5 : PUSH ESI
0091b9e6 : PUSH EDI
0091b9e7 : MOV EAX,[0x00d66fa0]
0091b9ec : XOR EAX,EBP
0091b9ee : PUSH EAX
0091b9ef : LEA EAX,[EBP + -0xc]
0091b9f2 : MOV FS:[0x0],EAX
0091b9f8 : MOV EDI,ECX
0091b9fa : XOR EBX,EBX
0091b9fc : MOV dword ptr [EBP + -0x4],EBX
0091b9ff : MOV EAX,[0x00da93ec]
0091ba04 : MOV CX,word ptr [EBP + 0x8]
0091ba08 : CMP word ptr [EAX + 0x450],CX
0091ba0f : JZ 0x0091bc34
0091ba15 : CMP byte ptr [EAX + 0x3a8],BL
0091ba1b : JNZ 0x0091bc34
0091ba21 : MOV BL,byte ptr [EBP + 0xc]
0091ba24 : TEST BL,BL
0091ba26 : JZ 0x0091bb45
0091ba2c : MOVZX ESI,word ptr [EDI + 0x3c]
0091ba30 : MOV EDX,ESI
0091ba32 : MOV ECX,EDI
0091ba34 : CALL 0x00917e80
0091ba39 : TEST EAX,EAX
0091ba3b : JZ 0x0091bb0f
0091ba41 : CMP byte ptr [EAX + 0x7],0x1
0091ba45 : JNZ 0x0091baed
0091ba4b : CMP byte ptr [EAX + 0x6],0xa
0091ba4f : JZ 0x0091baed
0091ba55 : CMP dword ptr [0x0172491c],0x0
0091ba5c : JZ 0x0091baca
0091ba5e : MOV EDX,dword ptr [0x00da9894]
0091ba64 : MOV EAX,dword ptr [EDX]
0091ba66 : TEST EAX,EAX
0091ba68 : JZ 0x0091baca
0091ba6a : CMP dword ptr [EAX + 0x1a8],0x0
0091ba71 : JZ 0x0091baca
0091ba73 : PUSH 0xc67848
0091ba78 : LEA ECX,[EBP + -0x2c]
0091ba7b : CALL 0x00406460
0091ba80 : MOV byte ptr [EBP + -0x4],0x1
0091ba84 : MOV EAX,[0x00da9894]
0091ba89 : MOV EAX,dword ptr [EAX]
0091ba8b : MOV ESI,dword ptr [EAX + 0x1a8]
0091ba91 : LEA ECX,[EBP + -0x2c]
0091ba94 : PUSH ECX
0091ba95 : MOV ECX,dword ptr [0x0172491c]
0091ba9b : LEA EDI,[EBP + -0x48]
0091ba9e : CALL 0x0081d120
0091baa3 : MOV byte ptr [EBP + -0x4],0x2
0091baa7 : MOV EDX,dword ptr [ESI]
0091baa9 : PUSH 0x3
0091baab : PUSH EAX
0091baac : MOV EAX,dword ptr [EDX + 0x44]
0091baaf : MOV ECX,ESI
0091bab1 : CALL EAX
0091bab3 : MOV byte ptr [EBP + -0x4],0x1
0091bab7 : MOV ECX,EDI
0091bab9 : CALL 0x00406560
0091babe : MOV byte ptr [EBP + -0x4],0x0
0091bac2 : LEA ECX,[EBP + -0x2c]
0091bac5 : CALL 0x00406560
0091baca : MOV dword ptr [EBP + -0x4],0xffffffff
0091bad1 : LEA ECX,[EBP + 0x10]
0091bad4 : CALL 0x00406560
0091bad9 : MOV ECX,dword ptr [EBP + -0xc]
0091badc : MOV dword ptr FS:[0x0],ECX
0091bae3 : POP ECX
0091bae4 : POP EDI
0091bae5 : POP ESI
0091bae6 : POP EBX
0091bae7 : MOV ESP,EBP
0091bae9 : POP EBP
0091baea : RET 0x24
0091baed : CMP byte ptr [EDI + 0x38],0x0
0091baf1 : JNZ 0x0091baff
0091baf3 : CMP dword ptr [0x00d6eb34],0x2710
0091bafd : JGE 0x0091bb45
0091baff : CMP word ptr [0x00d6ee14],SI
0091bb06 : JNZ 0x0091bb45
0091bb08 : PUSH 0xc67908
0091bb0d : JMP 0x0091bb14
0091bb0f : PUSH 0xc67898
0091bb14 : MOV ESI,dword ptr [0x00da98e8]
0091bb1a : CALL 0x008018d0
0091bb1f : ADD ESP,0x4
0091bb22 : MOV dword ptr [EBP + -0x4],0xffffffff
0091bb29 : LEA ECX,[EBP + 0x10]
0091bb2c : CALL 0x00406560
0091bb31 : MOV ECX,dword ptr [EBP + -0xc]
0091bb34 : MOV dword ptr FS:[0x0],ECX
0091bb3b : POP ECX
0091bb3c : POP EDI
0091bb3d : POP ESI
0091bb3e : POP EBX
0091bb3f : MOV ESP,EBP
0091bb41 : POP EBP
0091bb42 : RET 0x24
0091bb45 : MOVZX EAX,word ptr [EBP + 0x8]
0091bb49 : MOV ESI,dword ptr [0x00da98e8]
0091bb4f : MOVZX EBX,BL
0091bb52 : PUSH EBX
0091bb53 : PUSH EAX
0091bb54 : PUSH 0xc67968
0091bb59 : CALL 0x008018d0
0091bb5e : MOV CL,byte ptr [EBP + 0xc]
0091bb61 : MOV EAX,dword ptr [EBP + 0x14]
0091bb64 : MOV byte ptr [EDI + 0x50],CL
0091bb67 : MOV EDI,0x8
0091bb6c : ADD ESP,0xc
0091bb6f : CMP dword ptr [EBP + 0x28],EDI
0091bb72 : JNC 0x0091bb77
0091bb74 : LEA EAX,[EBP + 0x14]
0091bb77 : PUSH EAX
0091bb78 : XOR EDX,EDX
0091bb7a : MOV ECX,0xc6778c
0091bb7f : CALL 0x00405b70
0091bb84 : XOR ESI,ESI
0091bb86 : ADD ESP,0x4
0091bb89 : CMP EAX,ESI
0091bb8b : JNZ 0x0091bb99
0091bb8d : XOR EAX,EAX
0091bb8f : CMP dword ptr [EBP + 0x24],ESI
0091bb92 : SETNZ AL
0091bb95 : CMP EAX,ESI
0091bb97 : JZ 0x0091bbc1
0091bb99 : CALL 0x006f4590
0091bb9e : MOV dword ptr [EBP + -0x10],EAX
0091bba1 : MOV byte ptr [EBP + -0x4],0x3
0091bba5 : CMP EAX,ESI
0091bba7 : JZ 0x0091bbe0
0091bba9 : MOV ECX,dword ptr [EBP + 0x14]
0091bbac : CMP dword ptr [EBP + 0x28],EDI
0091bbaf : JNC 0x0091bbb4
0091bbb1 : LEA ECX,[EBP + 0x14]
0091bbb4 : MOVZX EDX,word ptr [EBP + 0x8]
0091bbb8 : PUSH EBX
0091bbb9 : PUSH EDX
0091bbba : CALL 0x0042a700
0091bbbf : JMP 0x0091bbe2
0091bbc1 : CALL 0x006f4590
0091bbc6 : MOV dword ptr [EBP + -0x10],EAX
0091bbc9 : MOV byte ptr [EBP + -0x4],0x4
0091bbcd : CMP EAX,ESI
0091bbcf : JZ 0x0091bbe0
0091bbd1 : MOVZX ECX,word ptr [EBP + 0x8]
0091bbd5 : PUSH EBX
0091bbd6 : PUSH ECX
0091bbd7 : XOR ECX,ECX
0091bbd9 : CALL 0x0042a700
0091bbde : JMP 0x0091bbe2
0091bbe0 : XOR EAX,EAX
0091bbe2 : MOV byte ptr [EBP + -0x4],0x0
0091bbe6 : MOV EDX,dword ptr [0x017247d4]
0091bbec : MOV ECX,dword ptr [EDX + 0x4]
0091bbef : CMP ECX,ESI
0091bbf1 : JZ 0x0091bc03
0091bbf3 : CMP byte ptr [EDX + 0x8],0x0
0091bbf7 : JZ 0x0091bc03
0091bbf9 : PUSH 0x1a
0091bbfb : PUSH ECX
0091bbfc : MOV EDI,EAX
0091bbfe : CALL 0x00a0dd40
0091bc03 : MOV DX,word ptr [EBP + 0x8]
0091bc07 : MOV dword ptr [0x00d6eb34],ESI
0091bc0d : MOV word ptr [0x00d6ee14],DX
0091bc14 : MOV dword ptr [EBP + -0x4],0xffffffff
0091bc1b : CMP dword ptr [EBP + 0x28],0x8
0091bc1f : JC 0x0091bc29
0091bc21 : MOV ECX,dword ptr [EBP + 0x14]
0091bc24 : CALL 0x006f04e0
0091bc29 : XOR EAX,EAX
0091bc2b : MOV dword ptr [EBP + 0x24],ESI
0091bc2e : MOV word ptr [EBP + 0x14],AX
0091bc32 : JMP 0x0091bc65
0091bc34 : MOV ESI,dword ptr [0x00da98e8]
0091bc3a : PUSH 0xc677e0
0091bc3f : CALL 0x008018d0
0091bc44 : ADD ESP,0x4
0091bc47 : MOV dword ptr [EBP + -0x4],0xffffffff
0091bc4e : CMP dword ptr [EBP + 0x28],0x8
0091bc52 : JC 0x0091bc5c
0091bc54 : MOV ECX,dword ptr [EBP + 0x14]
0091bc57 : CALL 0x006f04e0
0091bc5c : XOR ECX,ECX
0091bc5e : MOV dword ptr [EBP + 0x24],EBX
0091bc61 : MOV word ptr [EBP + 0x14],CX
0091bc65 : MOV dword ptr [EBP + 0x28],0x7
0091bc6c : MOV ECX,dword ptr [EBP + -0xc]
0091bc6f : MOV dword ptr FS:[0x0],ECX
0091bc76 : POP ECX
0091bc77 : POP EDI
0091bc78 : POP ESI
0091bc79 : POP EBX
0091bc7a : MOV ESP,EBP
0091bc7c : POP EBP
0091bc7d : RET 0x24
