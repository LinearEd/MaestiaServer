PROGRAM  : Maestia.exe
FUNCTION : FUN_00404870
ENTRY    : 00404870
BODY     : [[00404870, 00404979]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00404870(undefined4 *param_1,uint param_2)

{
  undefined4 *puVar1;
  undefined4 *puVar2;
  int iVar3;
  int unaff_ESI;
  uint uVar4;
  
  if (param_1 != (undefined4 *)0x0) {
    uVar4 = *(uint *)(unaff_ESI + 0x18);
    puVar1 = (undefined4 *)(unaff_ESI + 4);
    puVar2 = puVar1;
    if (7 < uVar4) {
      puVar2 = (undefined4 *)*puVar1;
    }
    if (puVar2 <= param_1) {
      puVar2 = puVar1;
      if (7 < uVar4) {
        puVar2 = (undefined4 *)*puVar1;
      }
      if (param_1 < (undefined4 *)((int)puVar2 + *(int *)(unaff_ESI + 0x14) * 2)) {
        if (7 < uVar4) {
          puVar1 = (undefined4 *)*puVar1;
        }
        FUN_00405c30(unaff_ESI,(int)param_1 - (int)puVar1 >> 1,param_2);
        return;
      }
    }
  }
  uVar4 = *(uint *)(unaff_ESI + 0x14);
  if ((-uVar4 - 1 <= param_2) || (uVar4 + param_2 < uVar4)) {
    FUN_00622ecf();
  }
  if (param_2 != 0) {
    uVar4 = *(int *)(unaff_ESI + 0x14) + param_2;
    if (0x7ffffffe < uVar4) {
      FUN_00622ecf();
    }
    if (*(uint *)(unaff_ESI + 0x18) < uVar4) {
      FUN_00406170(uVar4,*(undefined4 *)(unaff_ESI + 0x14));
    }
    else if (uVar4 == 0) {
      *(undefined4 *)(unaff_ESI + 0x14) = 0;
      if (*(uint *)(unaff_ESI + 0x18) < 8) {
        *(undefined2 *)(unaff_ESI + 4) = 0;
        return;
      }
      **(undefined2 **)(unaff_ESI + 4) = 0;
      return;
    }
    if (uVar4 != 0) {
      if (*(uint *)(unaff_ESI + 0x18) < 8) {
        iVar3 = unaff_ESI + 4;
      }
      else {
        iVar3 = *(int *)(unaff_ESI + 4);
      }
      _memcpy_s((void *)(iVar3 + *(int *)(unaff_ESI + 0x14) * 2),
                (*(uint *)(unaff_ESI + 0x18) - *(int *)(unaff_ESI + 0x14)) * 2,param_1,param_2 * 2);
      FUN_004064e0(uVar4);
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00404870 : PUSH EBP
00404871 : MOV EBP,ESP
00404873 : MOV ECX,dword ptr [EBP + 0x8]
00404876 : PUSH EBX
00404877 : MOV EBX,dword ptr [EBP + 0xc]
0040487a : PUSH EDI
0040487b : TEST ECX,ECX
0040487d : JZ 0x004048ca
0040487f : MOV EDI,dword ptr [ESI + 0x18]
00404882 : LEA EAX,[ESI + 0x4]
00404885 : CMP EDI,0x8
00404888 : JC 0x0040488e
0040488a : MOV EDX,dword ptr [EAX]
0040488c : JMP 0x00404890
0040488e : MOV EDX,EAX
00404890 : CMP ECX,EDX
00404892 : JC 0x004048ca
00404894 : CMP EDI,0x8
00404897 : JC 0x0040489d
00404899 : MOV EDX,dword ptr [EAX]
0040489b : JMP 0x0040489f
0040489d : MOV EDX,EAX
0040489f : MOV EBX,dword ptr [ESI + 0x14]
004048a2 : LEA EDX,[EDX + EBX*0x2]
004048a5 : CMP EDX,ECX
004048a7 : JBE 0x004048c7
004048a9 : CMP EDI,0x8
004048ac : JC 0x004048b0
004048ae : MOV EAX,dword ptr [EAX]
004048b0 : MOV EDX,dword ptr [EBP + 0xc]
004048b3 : SUB ECX,EAX
004048b5 : PUSH EDX
004048b6 : SAR ECX,0x1
004048b8 : PUSH ECX
004048b9 : PUSH ESI
004048ba : MOV ECX,ESI
004048bc : CALL 0x00405c30
004048c1 : POP EDI
004048c2 : POP EBX
004048c3 : POP EBP
004048c4 : RET 0x8
004048c7 : MOV EBX,dword ptr [EBP + 0xc]
004048ca : MOV EAX,dword ptr [ESI + 0x14]
004048cd : OR ECX,0xffffffff
004048d0 : SUB ECX,EAX
004048d2 : CMP ECX,EBX
004048d4 : JBE 0x004048dd
004048d6 : LEA EDX,[EAX + EBX*0x1]
004048d9 : CMP EDX,EAX
004048db : JNC 0x004048e2
004048dd : CALL 0x00622ecf
004048e2 : TEST EBX,EBX
004048e4 : JBE 0x00404972
004048ea : MOV EDI,dword ptr [ESI + 0x14]
004048ed : ADD EDI,EBX
004048ef : CMP EDI,0x7ffffffe
004048f5 : JBE 0x004048fc
004048f7 : CALL 0x00622ecf
004048fc : MOV EAX,dword ptr [ESI + 0x18]
004048ff : CMP EAX,EDI
00404901 : JNC 0x00404920
00404903 : MOV EAX,dword ptr [ESI + 0x14]
00404906 : PUSH EAX
00404907 : PUSH EDI
00404908 : MOV ECX,ESI
0040490a : CALL 0x00406170
0040490f : TEST EDI,EDI
00404911 : JBE 0x00404972
00404913 : MOV EAX,dword ptr [ESI + 0x18]
00404916 : CMP EAX,0x8
00404919 : JC 0x0040494c
0040491b : MOV EDX,dword ptr [ESI + 0x4]
0040491e : JMP 0x0040494f
00404920 : TEST EDI,EDI
00404922 : JNZ 0x00404911
00404924 : MOV dword ptr [ESI + 0x14],EDI
00404927 : CMP EAX,0x8
0040492a : JC 0x0040493c
0040492c : MOV EAX,dword ptr [ESI + 0x4]
0040492f : XOR ECX,ECX
00404931 : POP EDI
00404932 : MOV word ptr [EAX],CX
00404935 : MOV EAX,ESI
00404937 : POP EBX
00404938 : POP EBP
00404939 : RET 0x8
0040493c : LEA EAX,[ESI + 0x4]
0040493f : XOR ECX,ECX
00404941 : POP EDI
00404942 : MOV word ptr [EAX],CX
00404945 : MOV EAX,ESI
00404947 : POP EBX
00404948 : POP EBP
00404949 : RET 0x8
0040494c : LEA EDX,[ESI + 0x4]
0040494f : MOV ECX,dword ptr [ESI + 0x14]
00404952 : ADD EBX,EBX
00404954 : PUSH EBX
00404955 : MOV EBX,dword ptr [EBP + 0x8]
00404958 : SUB EAX,ECX
0040495a : PUSH EBX
0040495b : ADD EAX,EAX
0040495d : PUSH EAX
0040495e : LEA EDX,[EDX + ECX*0x2]
00404961 : PUSH EDX
00404962 : CALL 0x00633ea4
00404967 : ADD ESP,0x10
0040496a : PUSH EDI
0040496b : MOV ECX,ESI
0040496d : CALL 0x004064e0
00404972 : POP EDI
00404973 : MOV EAX,ESI
00404975 : POP EBX
00404976 : POP EBP
00404977 : RET 0x8
