PROGRAM  : Maestia.exe
FUNCTION : do_put
ENTRY    : 00626f32
BODY     : [[00626f32, 00627072]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Function: __EH_prolog3_GS replaced with injection: EH_prolog3 */
/* Library Function - Multiple Matches With Same Base Name
    protected: virtual class std::ostreambuf_iterator<unsigned short,struct
   std::char_traits<unsigned short> > __thiscall std::time_put<unsigned short,class
   std::ostreambuf_iterator<unsigned short,struct std::char_traits<unsigned short> > >::do_put(class
   std::ostreambuf_iterator<unsigned short,struct std::char_traits<unsigned short> >,class
   std::ios_base &,unsigned short,struct tm const *,char,char)const 
    protected: virtual class std::ostreambuf_iterator<wchar_t,struct std::char_traits<wchar_t> >
   __thiscall std::time_put<wchar_t,class std::ostreambuf_iterator<wchar_t,struct
   std::char_traits<wchar_t> > >::do_put(class std::ostreambuf_iterator<wchar_t,struct
   std::char_traits<wchar_t> >,class std::ios_base &,wchar_t,struct tm const *,char,char)const 
   
   Library: Visual Studio 2008 Release */

void do_put(undefined4 *param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
           undefined4 param_5,tm *param_6,undefined1 param_7,char param_8)

{
  void *pvVar1;
  char *pcVar2;
  size_t sVar3;
  undefined4 *puVar4;
  int iVar5;
  size_t sVar6;
  int in_ECX;
  undefined1 *puVar7;
  mbstate_t *pmVar8;
  undefined4 uVar9;
  _Cvtvec *p_Var10;
  undefined1 local_5c [8];
  mbstate_t local_54;
  undefined1 local_50 [4];
  size_t local_4c;
  undefined4 local_48;
  undefined4 *local_44;
  undefined4 local_40;
  tm *local_3c;
  size_t local_24;
  char local_1c [20];
  undefined4 local_8;
  undefined4 uStack_4;
  
  uStack_4 = 0x4c;
  local_8 = 0x626f3e;
  builtin_strncpy(local_1c,"!%x",4);
  local_44 = param_1;
  local_3c = param_6;
  local_1c[4] = 0;
  FUN_0040eea0();
  local_8 = 0;
  if (param_8 == '\0') {
    local_1c[2] = param_7;
  }
  else {
    local_1c[2] = param_8;
    local_1c[3] = param_7;
  }
  iVar5 = 0x10;
  while( true ) {
    FUN_004d12b0(iVar5,0);
    pvVar1 = *(void **)(in_ECX + 8);
    local_4c = local_24;
    FUN_00438b10(local_5c);
    pcVar2 = (char *)FUN_00412cf0();
    sVar3 = __Strftime(pcVar2,local_4c,local_1c,local_3c,pvVar1);
    if (sVar3 != 0) break;
    iVar5 = iVar5 * 2;
  }
  local_54 = 0;
  uVar9 = 1;
  puVar7 = local_5c;
  sVar3 = sVar3 - 1;
  FUN_00438b10(local_50);
  puVar4 = (undefined4 *)FUN_00436600(puVar7,uVar9);
  local_40 = *puVar4;
  local_3c = (tm *)puVar4[1];
  if (sVar3 != 0) {
    do {
      pmVar8 = &local_54;
      sVar6 = sVar3;
      p_Var10 = (_Cvtvec *)(in_ECX + 0xc);
      pcVar2 = (char *)FUN_00412cf0();
      iVar5 = __Mbrtowc((wchar_t *)&local_48,pcVar2,sVar6,pmVar8,p_Var10);
      if (iVar5 == -3) {
        iVar5 = 0;
      }
      else if (-3 < iVar5) {
        if (iVar5 < 0) break;
        if ((iVar5 == 0) && ((wchar_t)local_48 == L'\0')) {
          pcVar2 = (char *)FUN_00412cf0();
          sVar6 = _strlen(pcVar2);
          iVar5 = sVar6 + 1;
        }
      }
      sVar3 = sVar3 - iVar5;
      FUN_00437ac0(iVar5);
      FID_conflict_operator_(local_48);
    } while (sVar3 != 0);
  }
  *local_44 = param_2;
  local_44[1] = param_3;
  FUN_00405260(1,0);
  FUN_00640ed0();
  return;
}



============================================================
DISASSEMBLY
============================================================
00626f32 : PUSH 0x4c
00626f34 : MOV EAX,0xb0b823
00626f39 : CALL 0x00640e86
00626f3e : MOV EAX,dword ptr [EBP + 0x8]
00626f41 : MOV ESI,0xb95e5c
00626f46 : LEA EDI,[EBP + -0x18]
00626f49 : MOVSD ES:EDI,ESI
00626f4a : MOV dword ptr [EBP + -0x40],EAX
00626f4d : MOV EAX,dword ptr [EBP + 0x1c]
00626f50 : MOV EBX,ECX
00626f52 : LEA ECX,[EBP + -0x34]
00626f55 : MOV dword ptr [EBP + -0x38],EAX
00626f58 : MOVSB ES:EDI,ESI
00626f59 : CALL 0x0040eea0
00626f5e : MOV AL,byte ptr [EBP + 0x24]
00626f61 : AND dword ptr [EBP + -0x4],0x0
00626f65 : TEST AL,AL
00626f67 : JNZ 0x00626f71
00626f69 : MOV AL,byte ptr [EBP + 0x20]
00626f6c : MOV byte ptr [EBP + -0x16],AL
00626f6f : JMP 0x00626f7a
00626f71 : MOV byte ptr [EBP + -0x16],AL
00626f74 : MOV AL,byte ptr [EBP + 0x20]
00626f77 : MOV byte ptr [EBP + -0x15],AL
00626f7a : PUSH 0x10
00626f7c : POP ESI
00626f7d : JMP 0x00626f81
00626f7f : ADD ESI,ESI
00626f81 : PUSH 0x0
00626f83 : PUSH ESI
00626f84 : LEA ECX,[EBP + -0x34]
00626f87 : CALL 0x004d12b0
00626f8c : MOV EAX,dword ptr [EBP + -0x20]
00626f8f : MOV EDI,dword ptr [EBX + 0x8]
00626f92 : MOV dword ptr [EBP + -0x48],EAX
00626f95 : LEA EAX,[EBP + -0x58]
00626f98 : PUSH EAX
00626f99 : LEA ECX,[EBP + -0x34]
00626f9c : CALL 0x00438b10
00626fa1 : MOV ECX,EAX
00626fa3 : CALL 0x00412cf0
00626fa8 : PUSH EDI
00626fa9 : PUSH dword ptr [EBP + -0x38]
00626fac : LEA ECX,[EBP + -0x18]
00626faf : PUSH ECX
00626fb0 : PUSH dword ptr [EBP + -0x48]
00626fb3 : PUSH EAX
00626fb4 : CALL 0x00644baf
00626fb9 : MOV EDI,EAX
00626fbb : ADD ESP,0x14
00626fbe : TEST EDI,EDI
00626fc0 : JBE 0x00626f7f
00626fc2 : AND dword ptr [EBP + -0x50],0x0
00626fc6 : PUSH 0x1
00626fc8 : LEA EAX,[EBP + -0x58]
00626fcb : PUSH EAX
00626fcc : LEA EAX,[EBP + -0x4c]
00626fcf : PUSH EAX
00626fd0 : LEA ECX,[EBP + -0x34]
00626fd3 : DEC EDI
00626fd4 : CALL 0x00438b10
00626fd9 : MOV ECX,EAX
00626fdb : CALL 0x00436600
00626fe0 : MOV ECX,dword ptr [EAX]
00626fe2 : MOV EAX,dword ptr [EAX + 0x4]
00626fe5 : XOR ESI,ESI
00626fe7 : MOV dword ptr [EBP + -0x3c],ECX
00626fea : MOV dword ptr [EBP + -0x38],EAX
00626fed : CMP EDI,ESI
00626fef : JBE 0x00627050
00626ff1 : ADD EBX,0xc
00626ff4 : PUSH EBX
00626ff5 : LEA EAX,[EBP + -0x50]
00626ff8 : PUSH EAX
00626ff9 : PUSH EDI
00626ffa : LEA ECX,[EBP + -0x3c]
00626ffd : CALL 0x00412cf0
00627002 : PUSH EAX
00627003 : LEA EAX,[EBP + -0x44]
00627006 : PUSH EAX
00627007 : CALL 0x0063389a
0062700c : ADD ESP,0x14
0062700f : CMP EAX,-0x3
00627012 : JZ 0x00627034
00627014 : JLE 0x00627036
00627016 : CMP EAX,ESI
00627018 : JL 0x00627050
0062701a : JNZ 0x00627036
0062701c : CMP word ptr [EBP + -0x44],SI
00627020 : JNZ 0x00627036
00627022 : LEA ECX,[EBP + -0x3c]
00627025 : CALL 0x00412cf0
0062702a : PUSH EAX
0062702b : CALL 0x00640960
00627030 : POP ECX
00627031 : INC EAX
00627032 : JMP 0x00627036
00627034 : XOR EAX,EAX
00627036 : PUSH EAX
00627037 : LEA ECX,[EBP + -0x3c]
0062703a : SUB EDI,EAX
0062703c : CALL 0x00437ac0
00627041 : PUSH dword ptr [EBP + -0x44]
00627044 : LEA ECX,[EBP + 0xc]
00627047 : CALL 0x00625e4c
0062704c : CMP EDI,ESI
0062704e : JA 0x00626ff4
00627050 : MOV EAX,dword ptr [EBP + 0xc]
00627053 : MOV EDI,dword ptr [EBP + -0x40]
00627056 : MOV dword ptr [EDI],EAX
00627058 : MOV EAX,dword ptr [EBP + 0x10]
0062705b : PUSH ESI
0062705c : PUSH 0x1
0062705e : LEA ECX,[EBP + -0x34]
00627061 : MOV dword ptr [EDI + 0x4],EAX
00627064 : CALL 0x00405260
00627069 : MOV EAX,EDI
0062706b : CALL 0x00640ed0
00627070 : RET 0x20
