PROGRAM  : Maestia.exe
FUNCTION : FUN_00988050
ENTRY    : 00988050
BODY     : [[00988050, 00988331]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00988050(int param_1,int param_2,uint8_t *param_3)

{
  int iVar1;
  char *pcVar2;
  uint uVar3;
  int iVar4;
  int iVar5;
  uint8_t *puVar6;
  byte bVar7;
  short *psVar8;
  int iVar9;
  ushort *puVar10;
  int iVar11;
  undefined2 *puVar12;
  uint8_t *local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  puStack_c = &LAB_00b409f2;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  if (param_2 < 1) {
    return 0;
  }
  iVar1 = *(int *)ThreadLocalStoragePointer;
  bVar7 = (byte)((ulonglong)(*(byte *)(iVar1 + 0x18) + 1) % 3);
  ExceptionList = &local_10;
  *(byte *)(iVar1 + 0x18) = bVar7;
  local_14 = (uint8_t *)((uint)bVar7 * 0x2000 + 0x122cb8 + iVar1);
  if (local_14 == (uint8_t *)0x0) {
    puVar6 = (uint8_t *)0x0;
  }
  else {
    local_14[0] = '\0';
    local_14[1] = '\0';
    local_14[2] = '6';
    local_14[3] = 0xf0;
    local_14[4] = '\0';
    local_14[5] = '\0';
    local_14[6] = '\0';
    local_14[7] = '\0';
    local_14[8] = '\0';
    puVar6 = local_14;
  }
  local_8 = 0xffffffff;
  if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
    FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),9,puVar6);
  }
  iVar11 = 0;
  *(undefined8 *)(param_1 + 0x110) = 0;
  *(undefined8 *)(param_1 + 0x118) = 0;
  *(undefined4 *)(param_1 + 0x120) = 0;
  if (8 < (int)param_3) {
    param_3 = (uint8_t *)0x8;
  }
  iVar9 = (int)param_3;
  if (0 < (int)param_3) {
    puVar12 = (undefined2 *)(param_1 + 0x124);
    do {
      iVar4 = FUN_00987660(param_1);
      if (iVar4 == 0) break;
      puVar12[-10] = (short)iVar4;
      *puVar12 = (undefined2)param_2;
      iVar11 = iVar11 + 1;
      puVar12 = puVar12 + 1;
    } while (iVar11 < iVar9);
  }
  if ((1 < param_2) && (iVar11 < 8)) {
    iVar4 = _rand();
    local_14 = (uint8_t *)(iVar4 % (8 - iVar11) + iVar11);
    if (iVar11 < (int)local_14) {
      psVar8 = (short *)(param_1 + 0x124 + iVar11 * 2);
      do {
        iVar4 = _rand();
        iVar5 = FUN_00987660(param_1);
        iVar9 = (int)param_3;
        if (iVar5 == 0) break;
        psVar8[-10] = (short)iVar5;
        *psVar8 = (short)(iVar4 % (param_2 + -1)) + 1;
        iVar11 = iVar11 + 1;
        psVar8 = psVar8 + 1;
      } while (iVar11 < (int)local_14);
    }
  }
  *(int *)(param_1 + 0x10c) = iVar11;
  FUN_00410870("%d, %d, %d, ",param_2,iVar9,iVar11,uVar3);
  param_2 = 0;
  if (0 < *(int *)(param_1 + 0x10c)) {
    puVar10 = (ushort *)(param_1 + 0x110);
    do {
      bVar7 = (byte)((ulonglong)(*(byte *)(iVar1 + 0x18) + 1) % 3);
      *(byte *)(iVar1 + 0x18) = bVar7;
      param_3 = (uint8_t *)((uint)bVar7 * 0x2000 + 0x122cb8 + iVar1);
      if (param_3 == (uint8_t *)0x0) {
        puVar6 = (uint8_t *)0x0;
      }
      else {
        param_3[0] = '\0';
        param_3[1] = '\0';
        param_3[2] = 'C';
        param_3[3] = '\x01';
        param_3[4] = '\0';
        param_3[5] = '\0';
        param_3[6] = '\0';
        param_3[7] = '\0';
        param_3[8] = '\0';
        param_3[9] = '\0';
        param_3[10] = '\0';
        param_3[0xb] = '\0';
        param_3[0xc] = '\0';
        param_3[0xd] = '\0';
        param_3[0xe] = '\0';
        param_3[0xf] = '\0';
        param_3[0x10] = '\0';
        param_3[0x11] = '\0';
        param_3[0x12] = '\0';
        param_3[0x13] = '\0';
        param_3[0x14] = '\0';
        param_3[0x15] = '\0';
        param_3[0x16] = '\0';
        param_3[0x17] = '\0';
        param_3[0x18] = '\0';
        param_3[0x19] = '\0';
        param_3[0x1a] = '\0';
        param_3[0x1b] = '\0';
        param_3[0x1c] = '\0';
        param_3[0x1d] = '\0';
        param_3[0x1e] = '\0';
        param_3[0x1f] = '\0';
        puVar6 = param_3;
      }
      local_8 = 0xffffffff;
      puVar6[4] = '\'';
      puVar6[5] = '\0';
      puVar6[6] = '\0';
      puVar6[7] = '\0';
      *(uint *)(puVar6 + 8) = (uint)*puVar10;
      if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
        FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),0x20,puVar6);
      }
      param_3 = (uint8_t *)(*puVar10 | 0x68c0000);
      FUN_004437f0(&param_3);
      if ((local_14 != *(uint8_t **)(DAT_00d7c54c + 0x44)) && (*(int *)(local_14 + 0x10) != 0)) {
        pcVar2 = (char *)(param_1 + 0x13c);
        do {
          param_3 = (uint8_t *)pcVar2;
          pcVar2 = (char *)param_3 + 1;
        } while (*param_3 != '\0');
        FUN_00422170("%s/%d, ",*(int *)(local_14 + 0x10) + 0x18,puVar10[10]);
      }
      param_2 = param_2 + 1;
      puVar10 = puVar10 + 1;
    } while (param_2 < *(int *)(param_1 + 0x10c));
  }
  ExceptionList = local_10;
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00988050 : PUSH EBP
00988051 : MOV EBP,ESP
00988053 : PUSH -0x1
00988055 : PUSH 0xb409f2
0098805a : MOV EAX,FS:[0x0]
00988060 : PUSH EAX
00988061 : SUB ESP,0x8
00988064 : PUSH EBX
00988065 : PUSH ESI
00988066 : PUSH EDI
00988067 : MOV EAX,[0x00d66fa0]
0098806c : XOR EAX,EBP
0098806e : PUSH EAX
0098806f : LEA EAX,[EBP + -0xc]
00988072 : MOV FS:[0x0],EAX
00988078 : XOR ESI,ESI
0098807a : CMP dword ptr [EBP + 0xc],ESI
0098807d : JG 0x00988095
0098807f : XOR EAX,EAX
00988081 : MOV ECX,dword ptr [EBP + -0xc]
00988084 : MOV dword ptr FS:[0x0],ECX
0098808b : POP ECX
0098808c : POP EDI
0098808d : POP ESI
0098808e : POP EBX
0098808f : MOV ESP,EBP
00988091 : POP EBP
00988092 : RET 0xc
00988095 : MOV EAX,FS:[0x2c]
0098809b : MOV ECX,dword ptr [EAX]
0098809d : MOVZX EAX,byte ptr [ECX + 0x18]
009880a1 : INC EAX
009880a2 : CDQ
009880a3 : MOV EDI,0x3
009880a8 : IDIV EDI
009880aa : MOV dword ptr [EBP + -0x14],ECX
009880ad : MOV byte ptr [ECX + 0x18],DL
009880b0 : MOVZX EDX,DL
009880b3 : SHL EDX,0xd
009880b6 : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
009880bd : MOV dword ptr [EBP + -0x10],EAX
009880c0 : MOV dword ptr [EBP + -0x4],ESI
009880c3 : CMP EAX,ESI
009880c5 : JZ 0x009880dc
009880c7 : XOR ECX,ECX
009880c9 : MOV word ptr [EAX],CX
009880cc : MOV byte ptr [EAX + 0x2],0x36
009880d0 : MOV byte ptr [EAX + 0x3],0xf0
009880d4 : MOV byte ptr [EAX + 0x4],CL
009880d7 : MOV dword ptr [EAX + 0x5],ESI
009880da : JMP 0x009880de
009880dc : XOR EAX,EAX
009880de : MOV dword ptr [EBP + -0x4],0xffffffff
009880e5 : MOV EDX,dword ptr [0x017247d4]
009880eb : MOV ECX,dword ptr [EDX + 0x4]
009880ee : CMP ECX,ESI
009880f0 : JZ 0x00988104
009880f2 : CMP byte ptr [EDX + 0x8],0x0
009880f6 : JZ 0x00988104
009880f8 : PUSH 0x9
009880fa : PUSH ECX
009880fb : MOV EDI,EAX
009880fd : CALL 0x00a0dd40
00988102 : XOR ESI,ESI
00988104 : MOV EDI,dword ptr [EBP + 0x8]
00988107 : MOV EBX,dword ptr [EBP + 0x10]
0098810a : CMP EBX,0x8
0098810d : PXOR XMM0,XMM0
00988111 : MOVQ qword ptr [EDI + 0x110],XMM0
00988119 : MOVQ qword ptr [EDI + 0x118],XMM0
00988121 : MOV dword ptr [EDI + 0x120],ESI
00988127 : JLE 0x00988133
00988129 : MOV dword ptr [EBP + 0x10],0x8
00988130 : MOV EBX,dword ptr [EBP + 0x10]
00988133 : CMP EBX,ESI
00988135 : JLE 0x00988161
00988137 : ADD EDI,0x124
0098813d : MOV EDX,dword ptr [EBP + 0x8]
00988140 : MOV EAX,dword ptr [EBP + 0xc]
00988143 : PUSH EDX
00988144 : DEC EAX
00988145 : CALL 0x00987660
0098814a : TEST EAX,EAX
0098814c : JZ 0x00988161
0098814e : MOV word ptr [EDI + -0x14],AX
00988152 : MOV AX,word ptr [EBP + 0xc]
00988156 : MOV word ptr [EDI],AX
00988159 : INC ESI
0098815a : ADD EDI,0x2
0098815d : CMP ESI,EBX
0098815f : JL 0x0098813d
00988161 : CMP dword ptr [EBP + 0xc],0x1
00988165 : JLE 0x009881c2
00988167 : CMP ESI,0x8
0098816a : JGE 0x009881c2
0098816c : CALL 0x00635d2f
00988171 : MOV ECX,0x8
00988176 : SUB ECX,ESI
00988178 : CDQ
00988179 : IDIV ECX
0098817b : ADD EDX,ESI
0098817d : CMP ESI,EDX
0098817f : MOV dword ptr [EBP + -0x10],EDX
00988182 : JGE 0x009881c2
00988184 : MOV EDX,dword ptr [EBP + 0x8]
00988187 : LEA EBX,[EDX + ESI*0x2 + 0x124]
0098818e : MOV EDI,EDI
00988190 : CALL 0x00635d2f
00988195 : MOV ECX,dword ptr [EBP + 0xc]
00988198 : CDQ
00988199 : DEC ECX
0098819a : IDIV ECX
0098819c : MOV ECX,dword ptr [EBP + 0x8]
0098819f : PUSH ECX
009881a0 : MOV EDI,EDX
009881a2 : INC EDI
009881a3 : LEA EAX,[EDI + -0x1]
009881a6 : CALL 0x00987660
009881ab : TEST EAX,EAX
009881ad : JZ 0x009881bf
009881af : MOV word ptr [EBX + -0x14],AX
009881b3 : MOV word ptr [EBX],DI
009881b6 : INC ESI
009881b7 : ADD EBX,0x2
009881ba : CMP ESI,dword ptr [EBP + -0x10]
009881bd : JL 0x00988190
009881bf : MOV EBX,dword ptr [EBP + 0x10]
009881c2 : MOV EAX,dword ptr [EBP + 0xc]
009881c5 : MOV EDX,dword ptr [EBP + 0x8]
009881c8 : PUSH ESI
009881c9 : PUSH EBX
009881ca : PUSH EAX
009881cb : MOV dword ptr [EDX + 0x10c],ESI
009881d1 : ADD EDX,0x13c
009881d7 : PUSH 0xc82674
009881dc : CALL 0x00410870
009881e1 : MOV ESI,dword ptr [EBP + 0x8]
009881e4 : ADD ESP,0x10
009881e7 : CMP dword ptr [ESI + 0x10c],0x0
009881ee : MOV dword ptr [EBP + 0xc],0x0
009881f5 : JLE 0x00988319
009881fb : LEA EBX,[ESI + 0x110]
00988201 : MOV ECX,dword ptr [EBP + -0x14]
00988204 : MOVZX EAX,byte ptr [ECX + 0x18]
00988208 : INC EAX
00988209 : CDQ
0098820a : MOV EDI,0x3
0098820f : IDIV EDI
00988211 : MOV byte ptr [ECX + 0x18],DL
00988214 : MOVZX EDX,DL
00988217 : SHL EDX,0xd
0098821a : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
00988221 : MOV dword ptr [EBP + 0x10],EAX
00988224 : MOV dword ptr [EBP + -0x4],0x1
0098822b : XOR EDI,EDI
0098822d : CMP EAX,EDI
0098822f : JZ 0x00988257
00988231 : XOR ECX,ECX
00988233 : MOV word ptr [EAX],CX
00988236 : MOV byte ptr [EAX + 0x2],0x43
0098823a : MOV byte ptr [EAX + 0x3],0x1
0098823e : MOV dword ptr [EAX + 0x4],EDI
00988241 : PXOR XMM0,XMM0
00988245 : MOVQ qword ptr [EAX + 0x8],XMM0
0098824a : MOVQ qword ptr [EAX + 0x10],XMM0
0098824f : MOV dword ptr [EAX + 0x18],EDI
00988252 : MOV dword ptr [EAX + 0x1c],EDI
00988255 : JMP 0x00988259
00988257 : XOR EAX,EAX
00988259 : MOV dword ptr [EBP + -0x4],0xffffffff
00988260 : MOV dword ptr [EAX + 0x4],0x27
00988267 : MOVZX EDX,word ptr [EBX]
0098826a : MOV dword ptr [EAX + 0x8],EDX
0098826d : MOV EDX,dword ptr [0x017247d4]
00988273 : MOV ECX,dword ptr [EDX + 0x4]
00988276 : CMP ECX,EDI
00988278 : JZ 0x0098828c
0098827a : CMP byte ptr [EDX + 0x8],0x0
0098827e : JZ 0x0098828c
00988280 : PUSH 0x20
00988282 : PUSH ECX
00988283 : MOV EDI,EAX
00988285 : CALL 0x00a0dd40
0098828a : XOR EDI,EDI
0098828c : MOVZX EAX,word ptr [EBX]
0098828f : LEA ECX,[EBP + 0x10]
00988292 : OR EAX,0x68c0000
00988297 : PUSH ECX
00988298 : MOV ECX,dword ptr [0x00d7c54c]
0098829e : MOV dword ptr [EBP + 0x10],EAX
009882a1 : ADD ECX,0x40
009882a4 : LEA EAX,[EBP + -0x10]
009882a7 : CALL 0x004437f0
009882ac : MOV EAX,dword ptr [EBP + -0x10]
009882af : MOV EDX,dword ptr [0x00d7c54c]
009882b5 : CMP EAX,dword ptr [EDX + 0x44]
009882b8 : JZ 0x00988303
009882ba : MOV EDX,dword ptr [EAX + 0x10]
009882bd : CMP EDX,EDI
009882bf : JZ 0x00988303
009882c1 : LEA EAX,[ESI + 0x13c]
009882c7 : LEA ESI,[EAX + 0x1]
009882ca : LEA EBX,[EBX]
009882d0 : MOV CL,byte ptr [EAX]
009882d2 : INC EAX
009882d3 : TEST CL,CL
009882d5 : JNZ 0x009882d0
009882d7 : MOV ECX,dword ptr [EBP + 0x8]
009882da : SUB EAX,ESI
009882dc : ADD ECX,0x13c
009882e2 : ADD ECX,EAX
009882e4 : MOVZX EAX,word ptr [EBX + 0x14]
009882e8 : PUSH EAX
009882e9 : ADD EDX,0x18
009882ec : PUSH EDX
009882ed : PUSH 0xc82684
009882f2 : LEA EAX,[EBP + 0x10]
009882f5 : MOV dword ptr [EBP + 0x10],ECX
009882f8 : CALL 0x00422170
009882fd : MOV ESI,dword ptr [EBP + 0x8]
00988300 : ADD ESP,0xc
00988303 : MOV EAX,dword ptr [EBP + 0xc]
00988306 : INC EAX
00988307 : ADD EBX,0x2
0098830a : CMP EAX,dword ptr [ESI + 0x10c]
00988310 : MOV dword ptr [EBP + 0xc],EAX
00988313 : JL 0x00988201
00988319 : MOV EAX,0x1
0098831e : MOV ECX,dword ptr [EBP + -0xc]
00988321 : MOV dword ptr FS:[0x0],ECX
00988328 : POP ECX
00988329 : POP EDI
0098832a : POP ESI
0098832b : POP EBX
0098832c : MOV ESP,EBP
0098832e : POP EBP
0098832f : RET 0xc
