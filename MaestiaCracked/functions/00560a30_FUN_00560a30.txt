PROGRAM  : Maestia.exe
FUNCTION : FUN_00560a30
ENTRY    : 00560a30
BODY     : [[00560a30, 00560bbb]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00560a30(undefined4 param_1,undefined4 *param_2,uint param_3)

{
  int *piVar1;
  uint *puVar2;
  uint *puVar3;
  int *piVar4;
  int iVar5;
  GRefCountNTSImpl *pGVar6;
  uint uVar7;
  int *in_ECX;
  uint uVar8;
  int iVar9;
  
  piVar4 = (int *)*in_ECX;
  if (piVar4 == (int *)0x0) {
    iVar9 = 8;
  }
  else {
    if ((uint)(*piVar4 * 5) <= piVar4[1] * 4 + 4U) goto LAB_00560a74;
    iVar9 = piVar4[1] * 2 + 2;
  }
  FUN_00560650(param_1,iVar9);
LAB_00560a74:
  piVar4 = (int *)*in_ECX;
  param_3 = param_3 & piVar4[1];
  *piVar4 = *piVar4 + 1;
  iVar9 = *in_ECX;
  iVar5 = *(int *)(iVar9 + 8 + param_3 * 0xc);
  puVar2 = (uint *)(iVar9 + 8 + param_3 * 0xc);
  if (iVar5 == -2) {
    pGVar6 = (GRefCountNTSImpl *)*param_2;
    if (pGVar6 != (GRefCountNTSImpl *)0x0) {
      *(int *)(pGVar6 + 4) = *(int *)(pGVar6 + 4) + 1;
    }
    *puVar2 = 0xffffffff;
    if (pGVar6 != (GRefCountNTSImpl *)0x0) {
      *(int *)(pGVar6 + 4) = *(int *)(pGVar6 + 4) + 1;
    }
    puVar2[2] = (uint)pGVar6;
    if (pGVar6 != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(pGVar6);
      puVar2[1] = param_3;
      return;
    }
  }
  else {
    uVar8 = param_3;
    do {
      uVar8 = uVar8 + 1 & *(uint *)(iVar9 + 4);
    } while (*(int *)(iVar9 + 8 + uVar8 * 0xc) != -2);
    piVar4 = (int *)(iVar9 + 8 + uVar8 * 0xc);
    uVar7 = puVar2[1];
    if (uVar7 == param_3) {
      if (piVar4 != (int *)0x0) {
        *piVar4 = iVar5;
        piVar4[1] = puVar2[1];
        if (puVar2[2] != 0) {
          piVar1 = (int *)(puVar2[2] + 4);
          *piVar1 = *piVar1 + 1;
        }
        piVar4[2] = puVar2[2];
      }
      pGVar6 = (GRefCountNTSImpl *)*param_2;
      if ((pGVar6 != (GRefCountNTSImpl *)0x0) &&
         (*(int *)(pGVar6 + 4) = *(int *)(pGVar6 + 4) + 1, pGVar6 != (GRefCountNTSImpl *)0x0)) {
        *(int *)(pGVar6 + 4) = *(int *)(pGVar6 + 4) + 1;
      }
      if ((GRefCountNTSImpl *)puVar2[2] != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release((GRefCountNTSImpl *)puVar2[2]);
      }
      puVar2[2] = (uint)pGVar6;
      if (pGVar6 != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release(pGVar6);
      }
      *puVar2 = uVar8;
      puVar2[1] = param_3;
      return;
    }
    puVar3 = (uint *)(iVar9 + 8 + uVar7 * 0xc);
    for (uVar7 = *(uint *)(iVar9 + 8 + uVar7 * 0xc); uVar7 != param_3;
        uVar7 = *(uint *)(iVar9 + 8 + uVar7 * 0xc)) {
      uVar7 = *puVar3;
      puVar3 = (uint *)(iVar9 + 8 + uVar7 * 0xc);
    }
    if (piVar4 != (int *)0x0) {
      *piVar4 = iVar5;
      piVar4[1] = puVar2[1];
      if (puVar2[2] != 0) {
        piVar1 = (int *)(puVar2[2] + 4);
        *piVar1 = *piVar1 + 1;
      }
      piVar4[2] = puVar2[2];
    }
    *puVar3 = uVar8;
    pGVar6 = (GRefCountNTSImpl *)*param_2;
    if ((pGVar6 != (GRefCountNTSImpl *)0x0) &&
       (*(int *)(pGVar6 + 4) = *(int *)(pGVar6 + 4) + 1, pGVar6 != (GRefCountNTSImpl *)0x0)) {
      *(int *)(pGVar6 + 4) = *(int *)(pGVar6 + 4) + 1;
    }
    if ((GRefCountNTSImpl *)puVar2[2] != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release((GRefCountNTSImpl *)puVar2[2]);
    }
    puVar2[2] = (uint)pGVar6;
    if (pGVar6 != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(pGVar6);
    }
    *puVar2 = 0xffffffff;
  }
  puVar2[1] = param_3;
  return;
}



============================================================
DISASSEMBLY
============================================================
00560a30 : PUSH ECX
00560a31 : PUSH EBX
00560a32 : PUSH EBP
00560a33 : PUSH ESI
00560a34 : MOV ESI,ECX
00560a36 : MOV EAX,dword ptr [ESI]
00560a38 : MOV dword ptr [ESP + 0xc],0x0
00560a40 : TEST EAX,EAX
00560a42 : JNZ 0x00560a4d
00560a44 : MOV EAX,dword ptr [ESP + 0x14]
00560a48 : PUSH 0x8
00560a4a : PUSH EAX
00560a4b : JMP 0x00560a6f
00560a4d : MOV ECX,dword ptr [EAX + 0x4]
00560a50 : LEA EDX,[ECX*0x4 + 0x4]
00560a57 : MOV ECX,dword ptr [EAX]
00560a59 : LEA ECX,[ECX + ECX*0x4]
00560a5c : CMP ECX,EDX
00560a5e : JBE 0x00560a74
00560a60 : MOV EDX,dword ptr [EAX + 0x4]
00560a63 : MOV ECX,dword ptr [ESP + 0x14]
00560a67 : LEA EAX,[EDX + EDX*0x1 + 0x2]
00560a6b : PUSH EAX
00560a6c : PUSH ECX
00560a6d : MOV ECX,ESI
00560a6f : CALL 0x00560650
00560a74 : MOV EAX,dword ptr [ESI]
00560a76 : MOV EBX,dword ptr [ESP + 0x1c]
00560a7a : AND EBX,dword ptr [EAX + 0x4]
00560a7d : MOV EDX,0x1
00560a82 : ADD dword ptr [EAX],EDX
00560a84 : MOV EAX,dword ptr [ESI]
00560a86 : LEA ECX,[EBX + EBX*0x2]
00560a89 : MOV EBP,dword ptr [EAX + ECX*0x4 + 0x8]
00560a8d : LEA ESI,[EAX + ECX*0x4 + 0x8]
00560a91 : CMP EBP,-0x2
00560a94 : JNZ 0x00560aca
00560a96 : MOV EAX,dword ptr [ESP + 0x18]
00560a9a : MOV ECX,dword ptr [EAX]
00560a9c : TEST ECX,ECX
00560a9e : JZ 0x00560aa3
00560aa0 : ADD dword ptr [ECX + 0x4],EDX
00560aa3 : MOV dword ptr [ESI],0xffffffff
00560aa9 : TEST ECX,ECX
00560aab : JZ 0x00560ab0
00560aad : ADD dword ptr [ECX + 0x4],EDX
00560ab0 : MOV dword ptr [ESI + 0x8],ECX
00560ab3 : TEST ECX,ECX
00560ab5 : JZ 0x00560bb2
00560abb : CALL 0x004ff7c0
00560ac0 : MOV dword ptr [ESI + 0x4],EBX
00560ac3 : POP ESI
00560ac4 : POP EBP
00560ac5 : POP EBX
00560ac6 : POP ECX
00560ac7 : RET 0xc
00560aca : MOV ECX,dword ptr [EAX + 0x4]
00560acd : PUSH EDI
00560ace : MOV EDI,EBX
00560ad0 : INC EDI
00560ad1 : AND EDI,ECX
00560ad3 : LEA EDX,[EDI + EDI*0x2]
00560ad6 : CMP dword ptr [EAX + EDX*0x4 + 0x8],-0x2
00560adb : JNZ 0x00560ad0
00560add : LEA ECX,[EDI + EDI*0x2]
00560ae0 : LEA EDX,[EAX + ECX*0x4 + 0x8]
00560ae4 : MOV ECX,dword ptr [ESI + 0x4]
00560ae7 : CMP ECX,EBX
00560ae9 : JNZ 0x00560b42
00560aeb : TEST EDX,EDX
00560aed : JZ 0x00560b07
00560aef : MOV dword ptr [EDX],EBP
00560af1 : MOV EAX,dword ptr [ESI + 0x4]
00560af4 : MOV dword ptr [EDX + 0x4],EAX
00560af7 : MOV EAX,dword ptr [ESI + 0x8]
00560afa : TEST EAX,EAX
00560afc : JZ 0x00560b01
00560afe : INC dword ptr [EAX + 0x4]
00560b01 : MOV ECX,dword ptr [ESI + 0x8]
00560b04 : MOV dword ptr [EDX + 0x8],ECX
00560b07 : MOV EDX,dword ptr [ESP + 0x1c]
00560b0b : MOV EBP,dword ptr [EDX]
00560b0d : TEST EBP,EBP
00560b0f : JZ 0x00560b1b
00560b11 : INC dword ptr [EBP + 0x4]
00560b14 : TEST EBP,EBP
00560b16 : JZ 0x00560b1b
00560b18 : INC dword ptr [EBP + 0x4]
00560b1b : MOV ECX,dword ptr [ESI + 0x8]
00560b1e : TEST ECX,ECX
00560b20 : JZ 0x00560b27
00560b22 : CALL 0x004ff7c0
00560b27 : MOV dword ptr [ESI + 0x8],EBP
00560b2a : TEST EBP,EBP
00560b2c : JZ 0x00560b35
00560b2e : MOV ECX,EBP
00560b30 : CALL 0x004ff7c0
00560b35 : MOV dword ptr [ESI],EDI
00560b37 : POP EDI
00560b38 : MOV dword ptr [ESI + 0x4],EBX
00560b3b : POP ESI
00560b3c : POP EBP
00560b3d : POP EBX
00560b3e : POP ECX
00560b3f : RET 0xc
00560b42 : LEA ECX,[ECX + ECX*0x2]
00560b45 : CMP dword ptr [EAX + ECX*0x4 + 0x8],EBX
00560b49 : LEA ECX,[EAX + ECX*0x4 + 0x8]
00560b4d : JZ 0x00560b5f
00560b4f : NOP
00560b50 : MOV ECX,dword ptr [ECX]
00560b52 : LEA ECX,[ECX + ECX*0x2]
00560b55 : CMP dword ptr [EAX + ECX*0x4 + 0x8],EBX
00560b59 : LEA ECX,[EAX + ECX*0x4 + 0x8]
00560b5d : JNZ 0x00560b50
00560b5f : TEST EDX,EDX
00560b61 : JZ 0x00560b7b
00560b63 : MOV dword ptr [EDX],EBP
00560b65 : MOV EAX,dword ptr [ESI + 0x4]
00560b68 : MOV dword ptr [EDX + 0x4],EAX
00560b6b : MOV EAX,dword ptr [ESI + 0x8]
00560b6e : TEST EAX,EAX
00560b70 : JZ 0x00560b75
00560b72 : INC dword ptr [EAX + 0x4]
00560b75 : MOV EAX,dword ptr [ESI + 0x8]
00560b78 : MOV dword ptr [EDX + 0x8],EAX
00560b7b : MOV dword ptr [ECX],EDI
00560b7d : MOV ECX,dword ptr [ESP + 0x1c]
00560b81 : MOV EDI,dword ptr [ECX]
00560b83 : TEST EDI,EDI
00560b85 : JZ 0x00560b91
00560b87 : INC dword ptr [EDI + 0x4]
00560b8a : TEST EDI,EDI
00560b8c : JZ 0x00560b91
00560b8e : INC dword ptr [EDI + 0x4]
00560b91 : MOV ECX,dword ptr [ESI + 0x8]
00560b94 : TEST ECX,ECX
00560b96 : JZ 0x00560b9d
00560b98 : CALL 0x004ff7c0
00560b9d : MOV dword ptr [ESI + 0x8],EDI
00560ba0 : TEST EDI,EDI
00560ba2 : JZ 0x00560bab
00560ba4 : MOV ECX,EDI
00560ba6 : CALL 0x004ff7c0
00560bab : MOV dword ptr [ESI],0xffffffff
00560bb1 : POP EDI
00560bb2 : MOV dword ptr [ESI + 0x4],EBX
00560bb5 : POP ESI
00560bb6 : POP EBP
00560bb7 : POP EBX
00560bb8 : POP ECX
00560bb9 : RET 0xc
