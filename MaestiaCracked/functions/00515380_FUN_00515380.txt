PROGRAM  : Maestia.exe
FUNCTION : FUN_00515380
ENTRY    : 00515380
BODY     : [[00515380, 005155f9]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00515380(int param_1,undefined1 param_2)

{
  undefined4 *puVar1;
  GRefCountImpl *pGVar2;
  int iVar3;
  undefined4 *in_ECX;
  
  *in_ECX = &PTR_FUN_00cd3f2c;
  in_ECX[1] = 1;
  in_ECX[2] = &PTR_FUN_00b86ce4;
  in_ECX[4] = &PTR_LAB_00b8b11c;
  *in_ECX = &PTR_FUN_00b87018;
  in_ECX[2] = &PTR_LAB_00b87004;
  in_ECX[4] = &PTR_LAB_00b86ffc;
  in_ECX[5] = 0;
  puVar1 = in_ECX + 7;
  in_ECX[6] = 0;
  *puVar1 = puVar1;
  in_ECX[8] = puVar1;
  FUN_005a2090(0);
  *(undefined1 *)(in_ECX + 0xf) = param_2;
  if (param_1 != 0) {
    pGVar2 = *(GRefCountImpl **)(param_1 + 8);
    if (pGVar2 != (GRefCountImpl *)0x0) {
      GRefCountImpl::AddRef(pGVar2);
    }
    if ((GRefCountImpl *)in_ECX[6] != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release((GRefCountImpl *)in_ECX[6]);
    }
    in_ECX[6] = pGVar2;
  }
  puVar1 = (undefined4 *)FUN_00515840(0x34,0);
  if (puVar1 == (undefined4 *)0x0) {
    puVar1 = (undefined4 *)0x0;
  }
  else {
    *puVar1 = &PTR_FUN_00cd3f2c;
    puVar1[1] = 1;
    puVar1[2] = &PTR_FUN_00b86ce4;
    puVar1[4] = &PTR_LAB_00b8b11c;
    *puVar1 = &PTR_FUN_00b870c0;
    puVar1[2] = &PTR_FUN_00b870ac;
    puVar1[4] = &PTR_LAB_00b870a4;
    puVar1[5] = 0;
    puVar1[6] = 0;
    FUN_005a2090(0);
    if ((GRefCountImpl *)puVar1[5] != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release((GRefCountImpl *)puVar1[5]);
    }
    puVar1[5] = 0;
  }
  if ((GRefCountImpl *)in_ECX[5] != (GRefCountImpl *)0x0) {
    GRefCountImpl::Release((GRefCountImpl *)in_ECX[5]);
  }
  in_ECX[5] = puVar1;
  if (puVar1 != (undefined4 *)0x0) {
    pGVar2 = (GRefCountImpl *)FUN_00515840(0x10,0);
    if (pGVar2 == (GRefCountImpl *)0x0) {
      pGVar2 = (GRefCountImpl *)0x0;
    }
    else {
      *(undefined ***)pGVar2 = &PTR_FUN_00cd3f2c;
      *(undefined4 *)(pGVar2 + 4) = 1;
      *(undefined4 *)(pGVar2 + 8) = 4;
      *(undefined ***)(pGVar2 + 0xc) = &PTR_LAB_00b8b11c;
      *(undefined ***)pGVar2 = &PTR_FUN_00b87074;
      *(undefined ***)(pGVar2 + 0xc) = &PTR_LAB_00b8706c;
    }
    (**(code **)(*(int *)(in_ECX[5] + 8) + 8))(4,pGVar2);
    if (pGVar2 != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(pGVar2);
    }
    pGVar2 = (GRefCountImpl *)FUN_00515840(0x10,0);
    if (pGVar2 == (GRefCountImpl *)0x0) {
      pGVar2 = (GRefCountImpl *)0x0;
    }
    else {
      *(undefined ***)pGVar2 = &PTR_FUN_00cd3f2c;
      *(undefined4 *)(pGVar2 + 4) = 1;
      *(undefined4 *)(pGVar2 + 8) = 0xc;
      *(undefined ***)pGVar2 = &PTR_FUN_00cd46dc;
      pGVar2[0xc] = (GRefCountImpl)0x0;
    }
    (**(code **)(*(int *)(in_ECX[5] + 8) + 8))(0xc,pGVar2);
    if (pGVar2 != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(pGVar2);
    }
    (**(code **)(*(int *)(in_ECX[5] + 8) + 8))(0x11,0);
    iVar3 = FUN_00515840(0x48,0);
    if (iVar3 == 0) {
      pGVar2 = (GRefCountImpl *)0x0;
    }
    else {
      pGVar2 = (GRefCountImpl *)FUN_005a5640(1,*(undefined1 *)(in_ECX + 0xf));
    }
    (**(code **)(*(int *)(in_ECX[5] + 8) + 8))(0x12,pGVar2);
    if (pGVar2 != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(pGVar2);
    }
    iVar3 = FUN_00515840(0x20,0);
    if (iVar3 == 0) {
      pGVar2 = (GRefCountImpl *)0x0;
    }
    else {
      pGVar2 = (GRefCountImpl *)FUN_00503950();
    }
    (**(code **)(*(int *)(in_ECX[5] + 8) + 8))(0x18,pGVar2);
    if (pGVar2 != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(pGVar2);
    }
    iVar3 = FUN_00515840(0x18,0);
    if (iVar3 != 0) {
      FUN_00506b70();
    }
    pGVar2 = (GRefCountImpl *)FUN_00506bd0();
    (**(code **)(*(int *)(in_ECX[5] + 8) + 8))(0x19,pGVar2);
    if (pGVar2 != (GRefCountImpl *)0x0) {
      GRefCountImpl::Release(pGVar2);
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00515380 : PUSH EBX
00515381 : PUSH ESI
00515382 : MOV ESI,ECX
00515384 : MOV dword ptr [ESI],0xcd3f2c
0051538a : MOV dword ptr [ESI + 0x4],0x1
00515391 : MOV dword ptr [ESI + 0x8],0xb86ce4
00515398 : MOV dword ptr [ESI + 0x10],0xb8b11c
0051539f : MOV dword ptr [ESI],0xb87018
005153a5 : MOV dword ptr [ESI + 0x8],0xb87004
005153ac : MOV dword ptr [ESI + 0x10],0xb86ffc
005153b3 : XOR EBX,EBX
005153b5 : MOV dword ptr [ESI + 0x14],EBX
005153b8 : PUSH EDI
005153b9 : LEA EAX,[ESI + 0x1c]
005153bc : MOV dword ptr [ESI + 0x18],EBX
005153bf : PUSH EBX
005153c0 : LEA ECX,[ESI + 0x24]
005153c3 : MOV dword ptr [EAX],EAX
005153c5 : MOV dword ptr [EAX + 0x4],EAX
005153c8 : CALL 0x005a2090
005153cd : MOV AL,byte ptr [ESP + 0x14]
005153d1 : MOV byte ptr [ESI + 0x3c],AL
005153d4 : MOV EAX,dword ptr [ESP + 0x10]
005153d8 : CMP EAX,EBX
005153da : JZ 0x005153f9
005153dc : MOV EDI,dword ptr [EAX + 0x8]
005153df : CMP EDI,EBX
005153e1 : JZ 0x005153ea
005153e3 : MOV ECX,EDI
005153e5 : CALL 0x00523dd0
005153ea : MOV ECX,dword ptr [ESI + 0x18]
005153ed : CMP ECX,EBX
005153ef : JZ 0x005153f6
005153f1 : CALL 0x004ff7e0
005153f6 : MOV dword ptr [ESI + 0x18],EDI
005153f9 : MOV ECX,dword ptr [0x00d73250]
005153ff : PUSH EBX
00515400 : PUSH 0x34
00515402 : CALL 0x00515840
00515407 : MOV EDI,EAX
00515409 : CMP EDI,EBX
0051540b : JZ 0x0051545c
0051540d : MOV dword ptr [EDI],0xcd3f2c
00515413 : MOV dword ptr [EDI + 0x4],0x1
0051541a : MOV dword ptr [EDI + 0x8],0xb86ce4
00515421 : MOV dword ptr [EDI + 0x10],0xb8b11c
00515428 : MOV dword ptr [EDI],0xb870c0
0051542e : MOV dword ptr [EDI + 0x8],0xb870ac
00515435 : MOV dword ptr [EDI + 0x10],0xb870a4
0051543c : MOV dword ptr [EDI + 0x14],EBX
0051543f : PUSH EBX
00515440 : LEA ECX,[EDI + 0x1c]
00515443 : MOV dword ptr [EDI + 0x18],EBX
00515446 : CALL 0x005a2090
0051544b : MOV ECX,dword ptr [EDI + 0x14]
0051544e : CMP ECX,EBX
00515450 : JZ 0x00515457
00515452 : CALL 0x004ff7e0
00515457 : MOV dword ptr [EDI + 0x14],EBX
0051545a : JMP 0x0051545e
0051545c : XOR EDI,EDI
0051545e : MOV ECX,dword ptr [ESI + 0x14]
00515461 : CMP ECX,EBX
00515463 : JZ 0x0051546a
00515465 : CALL 0x004ff7e0
0051546a : MOV dword ptr [ESI + 0x14],EDI
0051546d : CMP EDI,EBX
0051546f : JZ 0x005155f2
00515475 : MOV ECX,dword ptr [0x00d73250]
0051547b : PUSH EBX
0051547c : PUSH 0x10
0051547e : CALL 0x00515840
00515483 : CMP EAX,EBX
00515485 : JZ 0x005154b3
00515487 : MOV dword ptr [EAX],0xcd3f2c
0051548d : MOV dword ptr [EAX + 0x4],0x1
00515494 : MOV dword ptr [EAX + 0x8],0x4
0051549b : MOV dword ptr [EAX + 0xc],0xb8b11c
005154a2 : MOV dword ptr [EAX],0xb87074
005154a8 : MOV dword ptr [EAX + 0xc],0xb8706c
005154af : MOV EDI,EAX
005154b1 : JMP 0x005154b5
005154b3 : XOR EDI,EDI
005154b5 : MOV ECX,dword ptr [ESI + 0x14]
005154b8 : MOV EDX,dword ptr [ECX + 0x8]
005154bb : MOV EAX,dword ptr [EDX + 0x8]
005154be : ADD ECX,0x8
005154c1 : PUSH EDI
005154c2 : PUSH 0x4
005154c4 : CALL EAX
005154c6 : CMP EDI,EBX
005154c8 : JZ 0x005154d1
005154ca : MOV ECX,EDI
005154cc : CALL 0x004ff7e0
005154d1 : MOV ECX,dword ptr [0x00d73250]
005154d7 : PUSH EBX
005154d8 : PUSH 0x10
005154da : CALL 0x00515840
005154df : CMP EAX,EBX
005154e1 : JZ 0x00515504
005154e3 : MOV dword ptr [EAX],0xcd3f2c
005154e9 : MOV dword ptr [EAX + 0x4],0x1
005154f0 : MOV dword ptr [EAX + 0x8],0xc
005154f7 : MOV dword ptr [EAX],0xcd46dc
005154fd : MOV byte ptr [EAX + 0xc],BL
00515500 : MOV EDI,EAX
00515502 : JMP 0x00515506
00515504 : XOR EDI,EDI
00515506 : MOV ECX,dword ptr [ESI + 0x14]
00515509 : MOV EDX,dword ptr [ECX + 0x8]
0051550c : MOV EAX,dword ptr [EDX + 0x8]
0051550f : ADD ECX,0x8
00515512 : PUSH EDI
00515513 : PUSH 0xc
00515515 : CALL EAX
00515517 : CMP EDI,EBX
00515519 : JZ 0x00515522
0051551b : MOV ECX,EDI
0051551d : CALL 0x004ff7e0
00515522 : MOV ECX,dword ptr [ESI + 0x14]
00515525 : MOV EDX,dword ptr [ECX + 0x8]
00515528 : MOV EAX,dword ptr [EDX + 0x8]
0051552b : ADD ECX,0x8
0051552e : PUSH EBX
0051552f : PUSH 0x11
00515531 : CALL EAX
00515533 : MOV ECX,dword ptr [0x00d73250]
00515539 : PUSH EBX
0051553a : PUSH 0x48
0051553c : CALL 0x00515840
00515541 : CMP EAX,EBX
00515543 : JZ 0x00515557
00515545 : MOVZX ECX,byte ptr [ESI + 0x3c]
00515549 : PUSH ECX
0051554a : PUSH 0x1
0051554c : MOV ECX,EAX
0051554e : CALL 0x005a5640
00515553 : MOV EDI,EAX
00515555 : JMP 0x00515559
00515557 : XOR EDI,EDI
00515559 : MOV ECX,dword ptr [ESI + 0x14]
0051555c : MOV EDX,dword ptr [ECX + 0x8]
0051555f : MOV EAX,dword ptr [EDX + 0x8]
00515562 : ADD ECX,0x8
00515565 : PUSH EDI
00515566 : PUSH 0x12
00515568 : CALL EAX
0051556a : CMP EDI,EBX
0051556c : JZ 0x00515575
0051556e : MOV ECX,EDI
00515570 : CALL 0x004ff7e0
00515575 : MOV ECX,dword ptr [0x00d73250]
0051557b : PUSH EBX
0051557c : PUSH 0x20
0051557e : CALL 0x00515840
00515583 : CMP EAX,EBX
00515585 : JZ 0x00515592
00515587 : MOV ECX,EAX
00515589 : CALL 0x00503950
0051558e : MOV EDI,EAX
00515590 : JMP 0x00515594
00515592 : XOR EDI,EDI
00515594 : MOV ECX,dword ptr [ESI + 0x14]
00515597 : MOV EDX,dword ptr [ECX + 0x8]
0051559a : MOV EAX,dword ptr [EDX + 0x8]
0051559d : ADD ECX,0x8
005155a0 : PUSH EDI
005155a1 : PUSH 0x18
005155a3 : CALL EAX
005155a5 : CMP EDI,EBX
005155a7 : JZ 0x005155b0
005155a9 : MOV ECX,EDI
005155ab : CALL 0x004ff7e0
005155b0 : MOV ECX,dword ptr [0x00d73250]
005155b6 : PUSH EBX
005155b7 : PUSH 0x18
005155b9 : CALL 0x00515840
005155be : CMP EAX,EBX
005155c0 : JZ 0x005155cb
005155c2 : MOV ECX,EAX
005155c4 : CALL 0x00506b70
005155c9 : JMP 0x005155cd
005155cb : XOR EAX,EAX
005155cd : MOV ECX,EAX
005155cf : CALL 0x00506bd0
005155d4 : MOV ECX,dword ptr [ESI + 0x14]
005155d7 : MOV EDX,dword ptr [ECX + 0x8]
005155da : MOV EDI,EAX
005155dc : MOV EAX,dword ptr [EDX + 0x8]
005155df : ADD ECX,0x8
005155e2 : PUSH EDI
005155e3 : PUSH 0x19
005155e5 : CALL EAX
005155e7 : CMP EDI,EBX
005155e9 : JZ 0x005155f2
005155eb : MOV ECX,EDI
005155ed : CALL 0x004ff7e0
005155f2 : POP EDI
005155f3 : MOV EAX,ESI
005155f5 : POP ESI
005155f6 : POP EBX
005155f7 : RET 0x8
