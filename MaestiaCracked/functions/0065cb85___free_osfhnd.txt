PROGRAM  : Maestia.exe
FUNCTION : __free_osfhnd
ENTRY    : 0065cb85
BODY     : [[0065cb85, 0065cc0a]]

============================================================
DECOMPILED C CODE
============================================================

/* Library Function - Single Match
    __free_osfhnd
   
   Library: Visual Studio 2008 Release */

int __cdecl __free_osfhnd(int param_1)

{
  int *piVar1;
  ulong *puVar2;
  int iVar3;
  DWORD nStdHandle;
  
  if ((-1 < param_1) && ((uint)param_1 < DAT_01728c30)) {
    iVar3 = (param_1 & 0x1fU) * 0x40;
    piVar1 = (int *)((&DAT_01728c40)[param_1 >> 5] + iVar3);
    if (((*(byte *)(piVar1 + 1) & 1) != 0) && (*piVar1 != -1)) {
      if (DAT_00d66f78 == 1) {
        if (param_1 == 0) {
          nStdHandle = 0xfffffff6;
        }
        else if (param_1 == 1) {
          nStdHandle = 0xfffffff5;
        }
        else {
          if (param_1 != 2) goto LAB_0065cbe7;
          nStdHandle = 0xfffffff4;
        }
        SetStdHandle(nStdHandle,(HANDLE)0x0);
      }
LAB_0065cbe7:
      *(undefined4 *)(iVar3 + (&DAT_01728c40)[param_1 >> 5]) = 0xffffffff;
      return 0;
    }
  }
  piVar1 = __errno();
  *piVar1 = 9;
  puVar2 = ___doserrno();
  *puVar2 = 0;
  return -1;
}



============================================================
DISASSEMBLY
============================================================
0065cb85 : MOV EDI,EDI
0065cb87 : PUSH EBP
0065cb88 : MOV EBP,ESP
0065cb8a : MOV ECX,dword ptr [EBP + 0x8]
0065cb8d : PUSH EBX
0065cb8e : XOR EBX,EBX
0065cb90 : CMP ECX,EBX
0065cb92 : PUSH ESI
0065cb93 : PUSH EDI
0065cb94 : JL 0x0065cbf1
0065cb96 : CMP ECX,dword ptr [0x01728c30]
0065cb9c : JNC 0x0065cbf1
0065cb9e : MOV EAX,ECX
0065cba0 : SAR EAX,0x5
0065cba3 : MOV ESI,ECX
0065cba5 : LEA EDI,[EAX*0x4 + 0x1728c40]
0065cbac : MOV EAX,dword ptr [EDI]
0065cbae : AND ESI,0x1f
0065cbb1 : SHL ESI,0x6
0065cbb4 : ADD EAX,ESI
0065cbb6 : TEST byte ptr [EAX + 0x4],0x1
0065cbba : JZ 0x0065cbf1
0065cbbc : CMP dword ptr [EAX],-0x1
0065cbbf : JZ 0x0065cbf1
0065cbc1 : CMP dword ptr [0x00d66f78],0x1
0065cbc8 : JNZ 0x0065cbe7
0065cbca : SUB ECX,EBX
0065cbcc : JZ 0x0065cbde
0065cbce : DEC ECX
0065cbcf : JZ 0x0065cbd9
0065cbd1 : DEC ECX
0065cbd2 : JNZ 0x0065cbe7
0065cbd4 : PUSH EBX
0065cbd5 : PUSH -0xc
0065cbd7 : JMP 0x0065cbe1
0065cbd9 : PUSH EBX
0065cbda : PUSH -0xb
0065cbdc : JMP 0x0065cbe1
0065cbde : PUSH EBX
0065cbdf : PUSH -0xa
0065cbe1 : CALL dword ptr [0x00b85218]
0065cbe7 : MOV EAX,dword ptr [EDI]
0065cbe9 : OR dword ptr [ESI + EAX*0x1],0xffffffff
0065cbed : XOR EAX,EAX
0065cbef : JMP 0x0065cc06
0065cbf1 : CALL 0x0063ab82
0065cbf6 : MOV dword ptr [EAX],0x9
0065cbfc : CALL 0x0063ab95
0065cc01 : MOV dword ptr [EAX],EBX
0065cc03 : OR EAX,0xffffffff
0065cc06 : POP EDI
0065cc07 : POP ESI
0065cc08 : POP EBX
0065cc09 : POP EBP
0065cc0a : RET
