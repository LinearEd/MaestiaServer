PROGRAM  : Maestia.exe
FUNCTION : FUN_005b4e80
ENTRY    : 005b4e80
BODY     : [[005b4e80, 005b4fc3]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005b4e80(int param_1)

{
  GRefCountNTSImpl *this;
  uint uVar1;
  char cVar2;
  int iVar3;
  GRefCountNTSImpl *pGVar4;
  float *pfVar5;
  undefined2 in_FPUControlWord;
  float10 fVar6;
  undefined4 uVar7;
  GRefCountNTSImpl *local_2c;
  undefined8 local_28;
  float local_20 [4];
  undefined4 local_10;
  float local_c;
  
  cVar2 = FUN_00526030(0x15);
  if (cVar2 == '\0') {
    FUN_00526050("Color",0,0);
    return;
  }
  if ((*(int *)(param_1 + 8) != 0) && (*(int *)(param_1 + 8) != 0x10)) {
    FUN_005033a0(&local_2c);
    this = local_2c;
    if (local_2c != (GRefCountNTSImpl *)0x0) {
      *(int *)(local_2c + 4) = *(int *)(local_2c + 4) + 1;
      GRefCountNTSImpl::Release(local_2c);
    }
    if (*(int *)(param_1 + 0x1c) < 1) {
      if (this != (GRefCountNTSImpl *)0x0) {
        GRefCountNTSImpl::Release(this);
        return;
      }
    }
    else if (this != (GRefCountNTSImpl *)0x0) {
      uVar7 = *(undefined4 *)(param_1 + 0x18);
      FUN_00526260(0);
      fVar6 = (float10)FUN_00527730(uVar7);
      local_2c = (GRefCountNTSImpl *)CONCAT22(local_2c._2_2_,in_FPUControlWord);
      pGVar4 = this + 0x24;
      pfVar5 = local_20;
      for (iVar3 = 8; iVar3 != 0; iVar3 = iVar3 + -1) {
        *pfVar5 = *(float *)pGVar4;
        pGVar4 = pGVar4 + 4;
        pfVar5 = pfVar5 + 1;
      }
      local_28._0_4_ = (uint)(longlong)ROUND(fVar6);
      uVar1 = (uint)local_28;
      local_28._4_4_ = (undefined4)((ulonglong)(longlong)ROUND(fVar6) >> 0x20);
      local_28 = CONCAT44(local_28._4_4_,(uint)local_28 >> 0x10) & 0xffffffff000000ff;
      local_10 = 0;
      local_20[2] = 0.0;
      local_20[0] = 0.0;
      local_20[1] = (float)(uint)local_28;
      local_28 = CONCAT44(local_28._4_4_,uVar1 >> 8) & 0xffffffff000000ff;
      local_20[3] = (float)(uint)local_28;
      local_28 = CONCAT44(local_28._4_4_,uVar1) & 0xffffffff000000ff;
      local_c = (float)(uint)local_28;
      FUN_0051ccd0(local_20);
      (**(code **)(*(int *)this + 0x14))(0);
      GRefCountNTSImpl::Release(this);
      return;
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005b4e80 : SUB ESP,0x2c
005b4e83 : PUSH ESI
005b4e84 : MOV ESI,dword ptr [ESP + 0x34]
005b4e88 : PUSH 0x15
005b4e8a : MOV ECX,ESI
005b4e8c : CALL 0x00526030
005b4e91 : TEST AL,AL
005b4e93 : JNZ 0x005b4eaa
005b4e95 : PUSH 0x0
005b4e97 : PUSH 0x0
005b4e99 : PUSH 0xb8fe48
005b4e9e : MOV ECX,ESI
005b4ea0 : CALL 0x00526050
005b4ea5 : POP ESI
005b4ea6 : ADD ESP,0x2c
005b4ea9 : RET
005b4eaa : MOV EAX,dword ptr [ESI + 0x8]
005b4ead : TEST EAX,EAX
005b4eaf : JZ 0x005b4fbf
005b4eb5 : ADD EAX,-0x10
005b4eb8 : JZ 0x005b4fbf
005b4ebe : PUSH EBX
005b4ebf : PUSH EDI
005b4ec0 : LEA ECX,[ESP + 0xc]
005b4ec4 : PUSH ECX
005b4ec5 : LEA ECX,[EAX + 0x30]
005b4ec8 : CALL 0x005033a0
005b4ecd : MOV EBX,dword ptr [ESP + 0xc]
005b4ed1 : MOV EDI,0x1
005b4ed6 : TEST EBX,EBX
005b4ed8 : JZ 0x005b4ee8
005b4eda : ADD dword ptr [EBX + 0x4],EDI
005b4edd : MOV EBX,dword ptr [ESP + 0xc]
005b4ee1 : MOV ECX,EBX
005b4ee3 : CALL 0x004ff7c0
005b4ee8 : CMP dword ptr [ESI + 0x1c],EDI
005b4eeb : JL 0x005b4fac
005b4ef1 : TEST EBX,EBX
005b4ef3 : JZ 0x005b4fbd
005b4ef9 : MOV EDX,dword ptr [ESI + 0x18]
005b4efc : PUSH EDX
005b4efd : PUSH 0x0
005b4eff : MOV ECX,ESI
005b4f01 : CALL 0x00526260
005b4f06 : MOV ECX,EAX
005b4f08 : CALL 0x00527730
005b4f0d : FNSTCW word ptr [ESP + 0xc]
005b4f11 : MOVZX EAX,word ptr [ESP + 0xc]
005b4f16 : OR EAX,0xc00
005b4f1b : MOV dword ptr [ESP + 0x10],EAX
005b4f1f : LEA ESI,[EBX + 0x24]
005b4f22 : MOV ECX,0x8
005b4f27 : FLDCW word ptr [ESP + 0x10]
005b4f2b : LEA EDI,[ESP + 0x18]
005b4f2f : MOVSD.REP ES:EDI,ESI
005b4f31 : FISTP qword ptr [ESP + 0x10]
005b4f35 : FLDCW word ptr [ESP + 0xc]
005b4f39 : MOV EAX,dword ptr [ESP + 0x10]
005b4f3d : MOV ECX,EAX
005b4f3f : SHR ECX,0x10
005b4f42 : AND ECX,0xff
005b4f48 : FLDZ
005b4f4a : MOV dword ptr [ESP + 0x10],ECX
005b4f4e : MOV EDX,EAX
005b4f50 : FST float ptr [ESP + 0x28]
005b4f54 : SHR EDX,0x8
005b4f57 : FST float ptr [ESP + 0x20]
005b4f5b : AND EDX,0xff
005b4f61 : FSTP float ptr [ESP + 0x18]
005b4f65 : MOVZX EAX,AL
005b4f68 : FILD dword ptr [ESP + 0x10]
005b4f6c : MOV dword ptr [ESP + 0x10],EDX
005b4f70 : LEA ECX,[ESP + 0x18]
005b4f74 : PUSH ECX
005b4f75 : FSTP float ptr [ESP + 0x20]
005b4f79 : MOV ECX,EBX
005b4f7b : FILD dword ptr [ESP + 0x14]
005b4f7f : MOV dword ptr [ESP + 0x14],EAX
005b4f83 : FSTP float ptr [ESP + 0x28]
005b4f87 : FILD dword ptr [ESP + 0x14]
005b4f8b : FSTP float ptr [ESP + 0x30]
005b4f8f : CALL 0x0051ccd0
005b4f94 : MOV EDX,dword ptr [EBX]
005b4f96 : MOV EAX,dword ptr [EDX + 0x14]
005b4f99 : PUSH 0x0
005b4f9b : MOV ECX,EBX
005b4f9d : CALL EAX
005b4f9f : POP EDI
005b4fa0 : MOV ECX,EBX
005b4fa2 : POP EBX
005b4fa3 : POP ESI
005b4fa4 : ADD ESP,0x2c
005b4fa7 : JMP 0x004ff7c0
005b4fac : TEST EBX,EBX
005b4fae : JZ 0x005b4fbd
005b4fb0 : POP EDI
005b4fb1 : MOV ECX,EBX
005b4fb3 : POP EBX
005b4fb4 : POP ESI
005b4fb5 : ADD ESP,0x2c
005b4fb8 : JMP 0x004ff7c0
005b4fbd : POP EDI
005b4fbe : POP EBX
005b4fbf : POP ESI
005b4fc0 : ADD ESP,0x2c
005b4fc3 : RET
