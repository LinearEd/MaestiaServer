PROGRAM  : Maestia.exe
FUNCTION : FUN_006bb7c0
ENTRY    : 006bb7c0
BODY     : [[006bb7c0, 006bba3d] [006bba40, 006bbb02]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_006bb7c0(short *param_1)

{
  undefined4 *puVar1;
  short *psVar2;
  undefined4 *in_EAX;
  undefined4 uVar3;
  int iVar4;
  undefined4 *puVar5;
  short sVar6;
  uint uVar7;
  int iVar8;
  short *psVar9;
  int iVar10;
  short *psVar11;
  int local_28;
  short *local_24;
  byte *local_20;
  short *local_1c;
  undefined4 local_18;
  int local_14;
  undefined4 local_10;
  int local_c;
  int local_8;
  short *local_4;
  
  local_18 = in_EAX[1];
  local_10 = in_EAX[3];
  local_14 = in_EAX[2];
  local_c = in_EAX[4];
  in_EAX[7] = 0;
  in_EAX[10] = 0;
  in_EAX[0xc] = 0;
  in_EAX[0xf] = 0;
  in_EAX[0x13] = 0;
  in_EAX[0x16] = 0;
  local_4 = (short *)*in_EAX;
  local_28 = 0;
  if ((uint)in_EAX[9] < (uint)(int)*param_1) {
    uVar7 = (int)*param_1 + 3U & 0xfffffffc;
    uVar3 = FUN_0068a220(local_4,4,in_EAX[9],uVar7,in_EAX[0xb],&local_28);
    in_EAX[0xb] = uVar3;
    if (local_28 != 0) {
      return local_28;
    }
    in_EAX[9] = uVar7;
  }
  if ((uint)in_EAX[6] < (int)param_1[1] + 2U) {
    uVar7 = (int)param_1[1] + 0xbU & 0xfffffff8;
    uVar3 = FUN_0068a220(local_4,0x28,in_EAX[6],uVar7,in_EAX[8],&local_28);
    in_EAX[8] = uVar3;
    if (local_28 != 0) {
      return local_28;
    }
    in_EAX[6] = uVar7;
  }
  in_EAX[7] = (int)param_1[1];
  in_EAX[10] = (int)*param_1;
  in_EAX[0x12] = 2;
  in_EAX[0x19] = 0xffffffff;
  iVar4 = FUN_006874e0(param_1);
  if (iVar4 == 1) {
    in_EAX[0x12] = 0xfffffffe;
    in_EAX[0x19] = 1;
  }
  psVar2 = (short *)in_EAX[8];
  in_EAX[2] = local_14;
  in_EAX[1] = local_18;
  in_EAX[3] = local_10;
  in_EAX[4] = local_c;
  in_EAX[0x1d] = 0;
  in_EAX[0x1e] = 0;
  if (in_EAX[7] != 0) {
    psVar9 = *(short **)(param_1 + 2);
    local_20 = *(byte **)(param_1 + 4);
    local_1c = psVar2 + in_EAX[7] * 0x14;
    local_24 = psVar2 + **(short **)(param_1 + 6) * 0x14;
    local_8 = 0;
    psVar11 = psVar2;
    local_4 = local_24;
    if (psVar2 < local_1c) {
      do {
        psVar11[6] = *psVar9;
        psVar11[7] = psVar9[2];
        iVar4 = FUN_00685ea0(*(undefined4 *)psVar9,local_18);
        *(int *)(psVar11 + 8) = iVar4 + local_14;
        *(int *)(psVar11 + 2) = iVar4 + local_14;
        iVar4 = FUN_00685ea0(*(undefined4 *)(psVar9 + 2),local_10);
        *(int *)(psVar11 + 10) = iVar4 + local_c;
        *(int *)(psVar11 + 4) = iVar4 + local_c;
        if ((*local_20 & 3) == 0) {
          *psVar11 = 1;
        }
        else if ((*local_20 & 3) == 2) {
          *psVar11 = 2;
        }
        else {
          *psVar11 = 0;
        }
        *(short **)(psVar11 + 0x12) = local_24;
        *(short **)(local_24 + 0x10) = psVar11;
        local_24 = psVar11;
        if ((psVar11 == local_4) && (local_8 = local_8 + 1, local_8 < *param_1)) {
          local_24 = psVar2 + *(short *)(*(int *)(param_1 + 6) + local_8 * 2) * 0x14;
          local_4 = local_24;
        }
        local_20 = local_20 + 1;
        psVar11 = psVar11 + 0x14;
        psVar9 = psVar9 + 4;
      } while (psVar11 < local_1c);
    }
    puVar5 = (undefined4 *)in_EAX[0xb];
    puVar1 = puVar5 + in_EAX[10];
    psVar9 = *(short **)(param_1 + 6);
    sVar6 = 0;
    for (; puVar5 < puVar1; puVar5 = puVar5 + 1) {
      *puVar5 = psVar2 + sVar6 * 0x14;
      sVar6 = *psVar9 + 1;
      psVar9 = psVar9 + 1;
    }
    iVar4 = 0;
    local_20 = (byte *)0x0;
    param_1._0_1_ = '\x04';
    if (psVar2 < local_1c) {
      psVar9 = psVar2 + 6;
      local_4 = psVar2;
      do {
        iVar10 = iVar4;
        if (psVar9 + -6 == local_4) {
          iVar4 = *(int *)(local_4 + 0x12);
          iVar10 = (int)local_4[6] - (int)*(short *)(iVar4 + 0xc);
          local_20 = (byte *)((int)local_4[7] - (int)*(short *)(iVar4 + 0xe));
          param_1._0_1_ = FUN_006bb6a0();
          local_4 = (short *)(iVar4 + 0x28);
        }
        *(char *)(psVar9 + -5) = (char)param_1;
        iVar4 = (int)*(short *)(*(int *)(psVar9 + 10) + 0xc) - (int)*psVar9;
        iVar8 = (int)*(short *)(*(int *)(psVar9 + 10) + 0xe) - (int)psVar9[1];
        param_1._0_1_ = FUN_006bb6a0();
        *(char *)((int)psVar9 + -9) = (char)param_1;
        if ((*(byte *)(psVar9 + -6) & 3) == 0) {
          if ((char)param_1 == (char)psVar9[-5]) {
            if (((char)param_1 != '\x04') ||
               (iVar10 = FUN_006862b0(iVar10,local_20,iVar4,iVar8), iVar10 != 0)) goto LAB_006bbad8;
          }
          else if ((int)(char)psVar9[-5] == -(int)(char)param_1) goto LAB_006bbad8;
        }
        else {
LAB_006bbad8:
          psVar9[-6] = psVar9[-6] | 0x100;
        }
        psVar2 = psVar9 + 0xe;
        psVar9 = psVar9 + 0x14;
        local_20 = (byte *)iVar8;
      } while (psVar2 < local_1c);
    }
  }
  return local_28;
}



============================================================
DISASSEMBLY
============================================================
006bb7c0 : SUB ESP,0x28
006bb7c3 : PUSH EBX
006bb7c4 : PUSH EBP
006bb7c5 : PUSH ESI
006bb7c6 : MOV ESI,EAX
006bb7c8 : MOV EAX,dword ptr [ESI + 0x4]
006bb7cb : MOV ECX,dword ptr [ESI + 0xc]
006bb7ce : MOV EDX,dword ptr [ESI + 0x8]
006bb7d1 : XOR EBP,EBP
006bb7d3 : MOV dword ptr [ESP + 0x1c],EAX
006bb7d7 : MOV EAX,dword ptr [ESI + 0x10]
006bb7da : PUSH EDI
006bb7db : MOV EDI,dword ptr [ESP + 0x3c]
006bb7df : MOV dword ptr [ESP + 0x2c],EAX
006bb7e3 : MOV dword ptr [ESI + 0x1c],EBP
006bb7e6 : MOV dword ptr [ESI + 0x28],EBP
006bb7e9 : MOV dword ptr [ESI + 0x30],EBP
006bb7ec : MOV dword ptr [ESI + 0x3c],EBP
006bb7ef : MOV dword ptr [ESI + 0x4c],EBP
006bb7f2 : MOV dword ptr [ESI + 0x58],EBP
006bb7f5 : MOVSX EAX,word ptr [EDI]
006bb7f8 : MOV dword ptr [ESP + 0x28],ECX
006bb7fc : MOV ECX,dword ptr [ESI + 0x24]
006bb7ff : MOV dword ptr [ESP + 0x24],EDX
006bb803 : MOV EDX,dword ptr [ESI]
006bb805 : MOV dword ptr [ESP + 0x10],EBP
006bb809 : MOV dword ptr [ESP + 0x34],EDX
006bb80d : CMP EAX,ECX
006bb80f : JBE 0x006bb83f
006bb811 : LEA EBX,[EAX + 0x3]
006bb814 : LEA EAX,[ESP + 0x10]
006bb818 : PUSH EAX
006bb819 : MOV EAX,dword ptr [ESI + 0x2c]
006bb81c : PUSH EAX
006bb81d : AND EBX,0xfffffffc
006bb820 : PUSH EBX
006bb821 : PUSH ECX
006bb822 : PUSH 0x4
006bb824 : PUSH EDX
006bb825 : CALL 0x0068a220
006bb82a : MOV dword ptr [ESI + 0x2c],EAX
006bb82d : MOV EAX,dword ptr [ESP + 0x28]
006bb831 : ADD ESP,0x18
006bb834 : CMP EAX,EBP
006bb836 : JNZ 0x006bbafb
006bb83c : MOV dword ptr [ESI + 0x24],EBX
006bb83f : MOVSX EAX,word ptr [EDI + 0x2]
006bb843 : MOV ECX,dword ptr [ESI + 0x18]
006bb846 : ADD EAX,0x2
006bb849 : CMP EAX,ECX
006bb84b : JBE 0x006bb87f
006bb84d : LEA EBX,[EAX + 0x9]
006bb850 : MOV EAX,dword ptr [ESI + 0x20]
006bb853 : LEA EDX,[ESP + 0x10]
006bb857 : PUSH EDX
006bb858 : PUSH EAX
006bb859 : AND EBX,0xfffffff8
006bb85c : PUSH EBX
006bb85d : PUSH ECX
006bb85e : MOV ECX,dword ptr [ESP + 0x44]
006bb862 : PUSH 0x28
006bb864 : PUSH ECX
006bb865 : CALL 0x0068a220
006bb86a : MOV dword ptr [ESI + 0x20],EAX
006bb86d : MOV EAX,dword ptr [ESP + 0x28]
006bb871 : ADD ESP,0x18
006bb874 : CMP EAX,EBP
006bb876 : JNZ 0x006bbafb
006bb87c : MOV dword ptr [ESI + 0x18],EBX
006bb87f : MOVSX EDX,word ptr [EDI + 0x2]
006bb883 : MOV dword ptr [ESI + 0x1c],EDX
006bb886 : MOVSX EAX,word ptr [EDI]
006bb889 : PUSH EDI
006bb88a : MOV dword ptr [ESI + 0x28],EAX
006bb88d : MOV dword ptr [ESI + 0x48],0x2
006bb894 : MOV dword ptr [ESI + 0x64],0xffffffff
006bb89b : CALL 0x006874e0
006bb8a0 : ADD ESP,0x4
006bb8a3 : CMP EAX,0x1
006bb8a6 : JNZ 0x006bb8b2
006bb8a8 : MOV dword ptr [ESI + 0x48],0xfffffffe
006bb8af : MOV dword ptr [ESI + 0x64],EAX
006bb8b2 : MOV EAX,dword ptr [ESP + 0x24]
006bb8b6 : MOV ECX,dword ptr [ESP + 0x20]
006bb8ba : MOV EDX,dword ptr [ESP + 0x28]
006bb8be : MOV EBX,dword ptr [ESI + 0x20]
006bb8c1 : MOV dword ptr [ESI + 0x8],EAX
006bb8c4 : MOV EAX,dword ptr [ESI + 0x1c]
006bb8c7 : MOV dword ptr [ESI + 0x4],ECX
006bb8ca : MOV ECX,dword ptr [ESP + 0x2c]
006bb8ce : MOV dword ptr [ESI + 0xc],EDX
006bb8d1 : MOV dword ptr [ESI + 0x10],ECX
006bb8d4 : MOV dword ptr [ESI + 0x74],EBP
006bb8d7 : MOV dword ptr [ESI + 0x78],EBP
006bb8da : CMP EAX,EBP
006bb8dc : JZ 0x006bbaf7
006bb8e2 : MOV ECX,dword ptr [EDI + 0xc]
006bb8e5 : MOV EBP,dword ptr [EDI + 0x4]
006bb8e8 : LEA EDX,[EAX + EAX*0x4]
006bb8eb : MOV EAX,dword ptr [EDI + 0x8]
006bb8ee : MOV dword ptr [ESP + 0x18],EAX
006bb8f2 : MOVSX EAX,word ptr [ECX]
006bb8f5 : LEA EDX,[EBX + EDX*0x8]
006bb8f8 : LEA EAX,[EAX + EAX*0x4]
006bb8fb : LEA EAX,[EBX + EAX*0x8]
006bb8fe : MOV dword ptr [ESP + 0x1c],EDX
006bb902 : MOV dword ptr [ESP + 0x34],EAX
006bb906 : MOV dword ptr [ESP + 0x14],EAX
006bb90a : MOV dword ptr [ESP + 0x30],0x0
006bb912 : MOV EDI,EBX
006bb914 : CMP EBX,EDX
006bb916 : JNC 0x006bb9e9
006bb91c : LEA ESP,[ESP]
006bb920 : MOV CX,word ptr [EBP]
006bb924 : MOV EAX,dword ptr [ESP + 0x20]
006bb928 : MOV word ptr [EDI + 0xc],CX
006bb92c : MOV DX,word ptr [EBP + 0x4]
006bb930 : MOV word ptr [EDI + 0xe],DX
006bb934 : MOV ECX,dword ptr [EBP]
006bb937 : PUSH EAX
006bb938 : PUSH ECX
006bb939 : CALL 0x00685ea0
006bb93e : MOV EDX,dword ptr [ESP + 0x2c]
006bb942 : ADD EAX,EDX
006bb944 : MOV dword ptr [EDI + 0x10],EAX
006bb947 : MOV dword ptr [EDI + 0x4],EAX
006bb94a : MOV EAX,dword ptr [ESP + 0x30]
006bb94e : MOV ECX,dword ptr [EBP + 0x4]
006bb951 : PUSH EAX
006bb952 : PUSH ECX
006bb953 : CALL 0x00685ea0
006bb958 : MOV EDX,dword ptr [ESP + 0x3c]
006bb95c : ADD EAX,EDX
006bb95e : MOV dword ptr [EDI + 0x14],EAX
006bb961 : MOV dword ptr [EDI + 0x8],EAX
006bb964 : MOV EAX,dword ptr [ESP + 0x28]
006bb968 : MOVSX EAX,byte ptr [EAX]
006bb96b : AND EAX,0x3
006bb96e : ADD ESP,0x10
006bb971 : SUB EAX,0x0
006bb974 : JZ 0x006bb98c
006bb976 : SUB EAX,0x2
006bb979 : JZ 0x006bb982
006bb97b : XOR ECX,ECX
006bb97d : MOV word ptr [EDI],CX
006bb980 : JMP 0x006bb994
006bb982 : MOV EDX,0x2
006bb987 : MOV word ptr [EDI],DX
006bb98a : JMP 0x006bb994
006bb98c : MOV EAX,0x1
006bb991 : MOV word ptr [EDI],AX
006bb994 : MOV EAX,dword ptr [ESP + 0x14]
006bb998 : MOV dword ptr [EDI + 0x24],EAX
006bb99b : MOV dword ptr [EAX + 0x20],EDI
006bb99e : MOV dword ptr [ESP + 0x14],EDI
006bb9a2 : CMP EDI,dword ptr [ESP + 0x34]
006bb9a6 : JNZ 0x006bb9d1
006bb9a8 : MOV ECX,dword ptr [ESP + 0x3c]
006bb9ac : MOV EAX,dword ptr [ESP + 0x30]
006bb9b0 : MOVSX EDX,word ptr [ECX]
006bb9b3 : INC EAX
006bb9b4 : CMP EAX,EDX
006bb9b6 : MOV dword ptr [ESP + 0x30],EAX
006bb9ba : JGE 0x006bb9d1
006bb9bc : MOV ECX,dword ptr [ECX + 0xc]
006bb9bf : MOVSX EAX,word ptr [ECX + EAX*0x2]
006bb9c3 : LEA EDX,[EAX + EAX*0x4]
006bb9c6 : LEA EAX,[EBX + EDX*0x8]
006bb9c9 : MOV dword ptr [ESP + 0x34],EAX
006bb9cd : MOV dword ptr [ESP + 0x14],EAX
006bb9d1 : INC dword ptr [ESP + 0x18]
006bb9d5 : ADD EDI,0x28
006bb9d8 : ADD EBP,0x8
006bb9db : CMP EDI,dword ptr [ESP + 0x1c]
006bb9df : JC 0x006bb920
006bb9e5 : MOV EDX,dword ptr [ESP + 0x1c]
006bb9e9 : MOV EAX,dword ptr [ESI + 0x2c]
006bb9ec : MOV ECX,dword ptr [ESI + 0x28]
006bb9ef : LEA EDI,[EAX + ECX*0x4]
006bb9f2 : MOV ECX,dword ptr [ESP + 0x3c]
006bb9f6 : MOV ESI,dword ptr [ECX + 0xc]
006bb9f9 : XOR ECX,ECX
006bb9fb : CMP EAX,EDI
006bb9fd : JNC 0x006bba1d
006bb9ff : NOP
006bba00 : MOVSX ECX,CX
006bba03 : LEA ECX,[ECX + ECX*0x4]
006bba06 : LEA ECX,[EBX + ECX*0x8]
006bba09 : MOV dword ptr [EAX],ECX
006bba0b : MOV CX,word ptr [ESI]
006bba0e : INC CX
006bba10 : ADD EAX,0x4
006bba13 : ADD ESI,0x2
006bba16 : MOVZX ECX,CX
006bba19 : CMP EAX,EDI
006bba1b : JC 0x006bba00
006bba1d : XOR EBP,EBP
006bba1f : MOV EAX,EBX
006bba21 : MOV dword ptr [ESP + 0x34],EAX
006bba25 : MOV dword ptr [ESP + 0x18],EBP
006bba29 : MOV dword ptr [ESP + 0x3c],0x4
006bba31 : CMP EBX,EDX
006bba33 : JNC 0x006bbaf7
006bba39 : LEA ESI,[EBX + 0xc]
006bba3c : JMP 0x006bba44
006bba40 : MOV EAX,dword ptr [ESP + 0x34]
006bba44 : LEA EDX,[ESI + -0xc]
006bba47 : CMP EDX,EAX
006bba49 : JNZ 0x006bba78
006bba4b : MOV EDI,dword ptr [EAX + 0x24]
006bba4e : MOVSX EBP,word ptr [EAX + 0xc]
006bba52 : MOVSX ECX,word ptr [EDI + 0xc]
006bba56 : MOVSX EDX,word ptr [EAX + 0xe]
006bba5a : SUB EBP,ECX
006bba5c : MOVSX ECX,word ptr [EDI + 0xe]
006bba60 : SUB EDX,ECX
006bba62 : MOV EAX,EBP
006bba64 : MOV dword ptr [ESP + 0x18],EDX
006bba68 : CALL 0x006bb6a0
006bba6d : ADD EDI,0x28
006bba70 : MOV dword ptr [ESP + 0x3c],EAX
006bba74 : MOV dword ptr [ESP + 0x34],EDI
006bba78 : MOV DL,byte ptr [ESP + 0x3c]
006bba7c : MOV EAX,dword ptr [ESI + 0x14]
006bba7f : MOVSX ECX,word ptr [ESI]
006bba82 : MOV byte ptr [ESI + -0xa],DL
006bba85 : MOVSX EDI,word ptr [EAX + 0xc]
006bba89 : MOVSX EBX,word ptr [EAX + 0xe]
006bba8d : MOVSX EDX,word ptr [ESI + 0x2]
006bba91 : SUB EDI,ECX
006bba93 : SUB EBX,EDX
006bba95 : MOV EDX,EBX
006bba97 : MOV EAX,EDI
006bba99 : CALL 0x006bb6a0
006bba9e : TEST byte ptr [ESI + -0xc],0x3
006bbaa2 : MOV dword ptr [ESP + 0x3c],EAX
006bbaa6 : MOV byte ptr [ESI + -0x9],AL
006bbaa9 : JNZ 0x006bbad8
006bbaab : MOV CL,byte ptr [ESI + -0xa]
006bbaae : CMP AL,CL
006bbab0 : JNZ 0x006bbacc
006bbab2 : CMP AL,0x4
006bbab4 : JNZ 0x006bbad8
006bbab6 : MOV EAX,dword ptr [ESP + 0x18]
006bbaba : PUSH EBX
006bbabb : PUSH EDI
006bbabc : PUSH EAX
006bbabd : PUSH EBP
006bbabe : CALL 0x006862b0
006bbac3 : ADD ESP,0x10
006bbac6 : TEST EAX,EAX
006bbac8 : JNZ 0x006bbad8
006bbaca : JMP 0x006bbae1
006bbacc : MOVSX EDX,AL
006bbacf : MOVSX EAX,CL
006bbad2 : NEG EDX
006bbad4 : CMP EAX,EDX
006bbad6 : JNZ 0x006bbae1
006bbad8 : MOV ECX,0x100
006bbadd : OR word ptr [ESI + -0xc],CX
006bbae1 : ADD ESI,0x28
006bbae4 : LEA EDX,[ESI + -0xc]
006bbae7 : MOV EBP,EDI
006bbae9 : MOV dword ptr [ESP + 0x18],EBX
006bbaed : CMP EDX,dword ptr [ESP + 0x1c]
006bbaf1 : JC 0x006bba40
006bbaf7 : MOV EAX,dword ptr [ESP + 0x10]
006bbafb : POP EDI
006bbafc : POP ESI
006bbafd : POP EBP
006bbafe : POP EBX
006bbaff : ADD ESP,0x28
006bbb02 : RET
