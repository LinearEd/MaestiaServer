PROGRAM  : Maestia.exe
FUNCTION : FUN_00768850
ENTRY    : 00768850
BODY     : [[00768850, 00768aa7]]

============================================================
DECOMPILED C CODE
============================================================

undefined4
FUN_00768850(int *param_1,int *param_2,int param_3,ushort param_4,ushort param_5,ushort param_6,
            uint param_7)

{
  size_t _Size;
  uint uVar1;
  int iVar2;
  uint uVar3;
  undefined4 uVar4;
  int in_ECX;
  uint uVar5;
  void *_Dst;
  void *_Src;
  float fVar6;
  float fVar7;
  uint local_34;
  size_t local_30;
  void *local_2c;
  int local_28;
  int local_24;
  ushort *local_20;
  int local_1c;
  int local_18;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b18f9f;
  local_10 = ExceptionList;
  uVar1 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_20 = (ushort *)(in_ECX + 0x364 + (param_7 & 0xffff) * 2);
  uVar5 = 0;
  if (*local_20 != 0) {
    do {
      iVar2 = (**(code **)(*param_1 + 0x4c))(param_1,param_3 + uVar5,&local_30,0,0x10,uVar1);
      if (iVar2 < 0) {
        uVar4 = FUN_00404750(L"[AvaMergeMeshEntity::_CopySurfaceDXT5Impl] lpSrcTex LockRect failed (%d)"
                             ,iVar2);
        local_8 = 0;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                    (L"AvaLib::AvaMergeMeshEntity::_CopySurfaceDXT5Impl",0x631,uVar4);
        }
        local_8 = 0xffffffff;
        if (local_34 < 8) {
          ExceptionList = local_10;
          return 0;
        }
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      iVar2 = (**(code **)(*param_2 + 0x4c))(param_2,uVar5,&local_28,0,0);
      _Size = local_30;
      if (iVar2 < 0) {
        uVar4 = FUN_00404750(L"[AvaMergeMeshEntity::_CopySurfaceDXT5Impl] lpDstTex LockRect failed (%d)"
                             ,iVar2);
        local_8 = 1;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                    (L"AvaLib::AvaMergeMeshEntity::_CopySurfaceDXT5Impl",0x638,uVar4);
        }
        local_8 = 0xffffffff;
        if (local_34 < 8) {
          (**(code **)(*param_1 + 0x50))(param_1,uVar5 + param_3);
          ExceptionList = local_10;
          return 0;
        }
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      fVar7 = 2.0;
      local_1c = local_28;
      uVar3 = uVar5;
      if ((int)uVar5 < 0) {
        uVar3 = -uVar5;
      }
      fVar6 = 1.0;
      while( true ) {
        if ((uVar3 & 1) != 0) {
          fVar6 = fVar6 * fVar7;
        }
        uVar3 = uVar3 >> 1;
        if (uVar3 == 0) break;
        fVar7 = fVar7 * fVar7;
      }
      if ((int)uVar5 < 0) {
        fVar6 = 1.0 / fVar6;
      }
      iVar2 = (int)((longlong)(ulonglong)param_6 / (longlong)((int)fVar6 * 4));
      _Dst = (void *)((int)(((int)((uint)param_5 * local_28 +
                                  ((int)((uint)param_5 * local_28) >> 0x1f & 3U)) >> 2) +
                           (uint)param_4 * 4) / (int)fVar6 + local_24);
      _Src = local_2c;
      if (0 < iVar2) {
        do {
          local_18 = iVar2;
          _memcpy(_Dst,_Src,_Size);
          _Dst = (void *)((int)_Dst + local_1c);
          local_18 = local_18 + -1;
          _Src = (void *)((int)_Src + _Size);
          iVar2 = local_18;
        } while (local_18 != 0);
      }
      (**(code **)(*param_1 + 0x50))(param_1,param_3 + uVar5);
      (**(code **)(*param_2 + 0x50))(param_2,uVar5);
      uVar5 = uVar5 + 1;
    } while ((int)uVar5 < (int)(uint)*local_20);
  }
  ExceptionList = local_10;
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00768850 : PUSH EBP
00768851 : MOV EBP,ESP
00768853 : PUSH -0x1
00768855 : PUSH 0xb18f9f
0076885a : MOV EAX,FS:[0x0]
00768860 : PUSH EAX
00768861 : SUB ESP,0x40
00768864 : PUSH EBX
00768865 : PUSH ESI
00768866 : PUSH EDI
00768867 : MOV EAX,[0x00d66fa0]
0076886c : XOR EAX,EBP
0076886e : PUSH EAX
0076886f : LEA EAX,[EBP + -0xc]
00768872 : MOV FS:[0x0],EAX
00768878 : MOVZX EAX,word ptr [EBP + 0x20]
0076887c : LEA EAX,[ECX + EAX*0x2 + 0x364]
00768883 : XOR EDX,EDX
00768885 : XOR EBX,EBX
00768887 : MOV dword ptr [EBP + -0x1c],EAX
0076888a : CMP DX,word ptr [EAX]
0076888d : JNC 0x007689a0
00768893 : MOV EAX,dword ptr [EBP + 0x10]
00768896 : MOV EDI,dword ptr [EBP + 0x8]
00768899 : MOV ECX,dword ptr [EDI]
0076889b : PUSH 0x10
0076889d : PUSH 0x0
0076889f : LEA EDX,[EBP + -0x2c]
007688a2 : ADD EAX,EBX
007688a4 : PUSH EDX
007688a5 : PUSH EAX
007688a6 : MOV EAX,dword ptr [ECX + 0x4c]
007688a9 : PUSH EDI
007688aa : CALL EAX
007688ac : TEST EAX,EAX
007688ae : JL 0x007689b6
007688b4 : MOV EAX,dword ptr [EBP + 0xc]
007688b7 : MOV ECX,dword ptr [EAX]
007688b9 : PUSH 0x0
007688bb : PUSH 0x0
007688bd : LEA EDX,[EBP + -0x24]
007688c0 : PUSH EDX
007688c1 : PUSH EBX
007688c2 : PUSH EAX
007688c3 : MOV EAX,dword ptr [ECX + 0x4c]
007688c6 : CALL EAX
007688c8 : TEST EAX,EAX
007688ca : JL 0x00768a25
007688d0 : MOV ECX,dword ptr [EBP + -0x2c]
007688d3 : MOV EDX,dword ptr [EBP + -0x24]
007688d6 : MOVSS XMM2,dword ptr [0x00cdf144]
007688de : MOV dword ptr [EBP + 0x20],ECX
007688e1 : MOV dword ptr [EBP + -0x18],EDX
007688e4 : MOV EAX,EBX
007688e6 : TEST EBX,EBX
007688e8 : JGE 0x007688ec
007688ea : NEG EAX
007688ec : MOVSS XMM1,dword ptr [0x00c10fc4]
007688f4 : MOVAPS XMM0,XMM1
007688f7 : TEST AL,0x1
007688f9 : JZ 0x007688ff
007688fb : MULSS XMM0,XMM2
007688ff : SHR EAX,0x1
00768901 : JZ 0x0076890f
00768903 : MOVAPS XMM3,XMM2
00768906 : MULSS XMM3,XMM2
0076890a : MOVAPS XMM2,XMM3
0076890d : JMP 0x007688f7
0076890f : TEST EBX,EBX
00768911 : JGE 0x00768919
00768913 : DIVSS XMM1,XMM0
00768917 : JMP 0x0076891c
00768919 : MOVAPS XMM1,XMM0
0076891c : MOVZX EAX,word ptr [EBP + 0x1c]
00768920 : CDQ
00768921 : CVTTSS2SI ESI,XMM1
00768925 : LEA ECX,[ESI*0x4 + 0x0]
0076892c : IDIV ECX
0076892e : MOV EDI,dword ptr [EBP + -0x28]
00768931 : MOV ECX,EAX
00768933 : MOVZX EAX,word ptr [EBP + 0x18]
00768937 : IMUL EAX,dword ptr [EBP + -0x24]
0076893b : CDQ
0076893c : AND EDX,0x3
0076893f : ADD EAX,EDX
00768941 : MOVZX EDX,word ptr [EBP + 0x14]
00768945 : SAR EAX,0x2
00768948 : LEA EAX,[EAX + EDX*0x4]
0076894b : CDQ
0076894c : IDIV ESI
0076894e : MOV ESI,EAX
00768950 : ADD ESI,dword ptr [EBP + -0x20]
00768953 : TEST ECX,ECX
00768955 : JLE 0x00768974
00768957 : MOV dword ptr [EBP + -0x14],ECX
0076895a : MOV EAX,dword ptr [EBP + 0x20]
0076895d : PUSH EAX
0076895e : PUSH EDI
0076895f : PUSH ESI
00768960 : CALL 0x0063ae40
00768965 : ADD ESI,dword ptr [EBP + -0x18]
00768968 : ADD EDI,dword ptr [EBP + 0x20]
0076896b : ADD ESP,0xc
0076896e : SUB dword ptr [EBP + -0x14],0x1
00768972 : JNZ 0x0076895a
00768974 : MOV EAX,dword ptr [EBP + 0x10]
00768977 : MOV ECX,dword ptr [EBP + 0x8]
0076897a : MOV EDX,dword ptr [ECX]
0076897c : ADD EAX,EBX
0076897e : PUSH EAX
0076897f : PUSH ECX
00768980 : MOV ECX,dword ptr [EDX + 0x50]
00768983 : CALL ECX
00768985 : MOV EAX,dword ptr [EBP + 0xc]
00768988 : MOV EDX,dword ptr [EAX]
0076898a : PUSH EBX
0076898b : PUSH EAX
0076898c : MOV EAX,dword ptr [EDX + 0x50]
0076898f : CALL EAX
00768991 : MOV ECX,dword ptr [EBP + -0x1c]
00768994 : MOVZX EDX,word ptr [ECX]
00768997 : INC EBX
00768998 : CMP EBX,EDX
0076899a : JL 0x00768893
007689a0 : MOV AL,0x1
007689a2 : MOV ECX,dword ptr [EBP + -0xc]
007689a5 : MOV dword ptr FS:[0x0],ECX
007689ac : POP ECX
007689ad : POP EDI
007689ae : POP ESI
007689af : POP EBX
007689b0 : MOV ESP,EBP
007689b2 : POP EBP
007689b3 : RET 0x1c
007689b6 : PUSH EAX
007689b7 : PUSH 0xc0e2c8
007689bc : LEA ESI,[EBP + -0x48]
007689bf : CALL 0x00404750
007689c4 : ADD ESP,0x8
007689c7 : XOR ESI,ESI
007689c9 : MOV dword ptr [EBP + -0x4],ESI
007689cc : MOV ECX,dword ptr [0x00da98e8]
007689d2 : MOV ECX,dword ptr [ECX]
007689d4 : CMP ECX,ESI
007689d6 : JZ 0x007689ea
007689d8 : MOV EDX,dword ptr [ECX]
007689da : PUSH EAX
007689db : MOV EAX,dword ptr [EDX + 0x14]
007689de : PUSH 0x631
007689e3 : PUSH 0xc0e360
007689e8 : CALL EAX
007689ea : MOV dword ptr [EBP + -0x4],0xffffffff
007689f1 : CMP dword ptr [EBP + -0x30],0x8
007689f5 : JC 0x007689ff
007689f7 : MOV ECX,dword ptr [EBP + -0x44]
007689fa : CALL 0x006f04e0
007689ff : XOR ECX,ECX
00768a01 : MOV dword ptr [EBP + -0x30],0x7
00768a08 : MOV dword ptr [EBP + -0x34],ESI
00768a0b : MOV word ptr [EBP + -0x44],CX
00768a0f : XOR AL,AL
00768a11 : MOV ECX,dword ptr [EBP + -0xc]
00768a14 : MOV dword ptr FS:[0x0],ECX
00768a1b : POP ECX
00768a1c : POP EDI
00768a1d : POP ESI
00768a1e : POP EBX
00768a1f : MOV ESP,EBP
00768a21 : POP EBP
00768a22 : RET 0x1c
00768a25 : PUSH EAX
00768a26 : PUSH 0xc0e3c8
00768a2b : LEA ESI,[EBP + -0x48]
00768a2e : CALL 0x00404750
00768a33 : ADD ESP,0x8
00768a36 : MOV dword ptr [EBP + -0x4],0x1
00768a3d : MOV EDX,dword ptr [0x00da98e8]
00768a43 : MOV ECX,dword ptr [EDX]
00768a45 : TEST ECX,ECX
00768a47 : JZ 0x00768a5b
00768a49 : MOV EDX,dword ptr [ECX]
00768a4b : PUSH EAX
00768a4c : MOV EAX,dword ptr [EDX + 0x14]
00768a4f : PUSH 0x638
00768a54 : PUSH 0xc0e460
00768a59 : CALL EAX
00768a5b : MOV dword ptr [EBP + -0x4],0xffffffff
00768a62 : CMP dword ptr [EBP + -0x30],0x8
00768a66 : JC 0x00768a70
00768a68 : MOV ECX,dword ptr [EBP + -0x44]
00768a6b : CALL 0x006f04e0
00768a70 : MOV EAX,dword ptr [EBP + 0x10]
00768a73 : MOV EDX,dword ptr [EDI]
00768a75 : XOR ECX,ECX
00768a77 : ADD EBX,EAX
00768a79 : PUSH EBX
00768a7a : MOV word ptr [EBP + -0x44],CX
00768a7e : MOV ECX,dword ptr [EDX + 0x50]
00768a81 : PUSH EDI
00768a82 : MOV dword ptr [EBP + -0x30],0x7
00768a89 : MOV dword ptr [EBP + -0x34],0x0
00768a90 : CALL ECX
00768a92 : XOR AL,AL
00768a94 : MOV ECX,dword ptr [EBP + -0xc]
00768a97 : MOV dword ptr FS:[0x0],ECX
00768a9e : POP ECX
00768a9f : POP EDI
00768aa0 : POP ESI
00768aa1 : POP EBX
00768aa2 : MOV ESP,EBP
00768aa4 : POP EBP
00768aa5 : RET 0x1c
