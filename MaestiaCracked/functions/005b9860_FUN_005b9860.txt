PROGRAM  : Maestia.exe
FUNCTION : FUN_005b9860
ENTRY    : 005b9860
BODY     : [[005b9860, 005b9a67]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005b9860(int param_1)

{
  undefined4 *puVar1;
  undefined1 *puVar2;
  int iVar3;
  int iVar4;
  char *pcVar5;
  GRefCountNTSImpl *this;
  uint uVar6;
  GRefCountNTSImpl *pGVar7;
  undefined4 uVar8;
  undefined4 uVar9;
  undefined4 uVar10;
  undefined4 uVar11;
  undefined4 *puStack_18;
  int iStack_14;
  undefined4 *puStack_10;
  undefined4 *puStack_c;
  undefined4 uStack_8;
  undefined1 *puStack_4;
  
  iVar3 = param_1;
  puVar2 = *(undefined1 **)(param_1 + 4);
  FUN_00526400();
  *puVar2 = 2;
  puVar2[4] = 0;
  if (*(int *)(param_1 + 0x1c) < 2) {
    return;
  }
  puVar1 = (undefined4 *)(param_1 + 8);
  param_1 = 0;
  iVar4 = (**(code **)(*(int *)*puVar1 + 8))();
  if (iVar4 == 0x19) {
    if (*(int *)(iVar3 + 8) == 0) {
      param_1 = 0;
    }
    else {
      param_1 = *(int *)(iVar3 + 8) + -0x10;
    }
  }
  uVar8 = *(undefined4 *)(iVar3 + 0x18);
  FUN_00526260(0);
  FUN_005272e0(&puStack_18,uVar8,0xffffffff,0);
  pcVar5 = (char *)FUN_00526260(1);
  if (*pcVar5 == '\a') {
    uVar8 = *(undefined4 *)(iVar3 + 0x18);
    FUN_00526260(1);
    this = (GRefCountNTSImpl *)FUN_00525fa0(uVar8);
    if (this != (GRefCountNTSImpl *)0x0) {
      *(int *)(this + 4) = *(int *)(this + 4) + 1;
    }
  }
  else {
    uVar8 = *(undefined4 *)(iVar3 + 0x18);
    FUN_00526260(1);
    FUN_005272e0(&iStack_14,uVar8,0xffffffff,0);
    this = (GRefCountNTSImpl *)FUN_0052add0(&iStack_14,0);
    if (this != (GRefCountNTSImpl *)0x0) {
      *(int *)(this + 4) = *(int *)(this + 4) + 1;
    }
    *(int *)(iStack_14 + 8) = *(int *)(iStack_14 + 8) + -1;
    if (*(int *)(iStack_14 + 8) == 0) {
      FUN_00525340();
    }
  }
  if (this == (GRefCountNTSImpl *)0x0) {
    puStack_4 = &DAT_00cca874;
    uVar6 = FUN_0051cf20();
    uVar8 = *(undefined4 *)(iVar3 + 0x18);
    uStack_8 = CONCAT31(uStack_8._1_3_,6 < uVar6);
    FUN_00526260(1);
    FUN_005272e0(&puStack_10,uVar8,0xffffffff,0);
    iVar4 = FUN_0056a360(*puStack_10,&puStack_4,uStack_8);
    puStack_10[2] = puStack_10[2] + -1;
    if (puStack_10[2] == 0) {
      FUN_00525340();
    }
    if (iVar4 == -1) goto LAB_005b9a4e;
    uVar8 = *puStack_18;
    uVar10 = *(undefined4 *)(iVar3 + 0x18);
    FUN_00526260(1);
    FUN_005272e0(&puStack_c,uVar10,0xffffffff,0);
    uVar10 = *puStack_c;
    uVar9 = *(undefined4 *)(iVar3 + 0x18);
    uVar11 = 0;
    FUN_005296a0(uVar10,uVar8,uVar9,0,param_1);
    FUN_00574d10(uVar10,uVar8,uVar9,uVar11,param_1);
    puStack_c[2] = puStack_c[2] + -1;
    if (puStack_c[2] == 0) {
      FUN_00525340();
    }
  }
  else {
    uVar8 = *puStack_18;
    uVar10 = 0;
    pGVar7 = this;
    FUN_005296a0(this,uVar8,0,param_1);
    FUN_00574f60(pGVar7,uVar8,uVar10,param_1);
  }
  puVar2 = *(undefined1 **)(iVar3 + 4);
  FUN_00526400();
  *puVar2 = 2;
  puVar2[4] = 1;
  if (this != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release(this);
  }
LAB_005b9a4e:
  puStack_18[2] = puStack_18[2] + -1;
  if (puStack_18[2] == 0) {
    FUN_00525340();
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
005b9860 : SUB ESP,0x18
005b9863 : PUSH ESI
005b9864 : MOV ESI,dword ptr [ESP + 0x20]
005b9868 : PUSH EDI
005b9869 : MOV EDI,dword ptr [ESI + 0x4]
005b986c : MOV ECX,EDI
005b986e : CALL 0x00526400
005b9873 : MOV byte ptr [EDI],0x2
005b9876 : MOV byte ptr [EDI + 0x4],0x0
005b987a : CMP dword ptr [ESI + 0x1c],0x2
005b987e : JL 0x005b9a62
005b9884 : MOV ECX,dword ptr [ESI + 0x8]
005b9887 : MOV EAX,dword ptr [ECX]
005b9889 : MOV EDX,dword ptr [EAX + 0x8]
005b988c : PUSH EBX
005b988d : XOR EBX,EBX
005b988f : MOV dword ptr [ESP + 0x28],EBX
005b9893 : CALL EDX
005b9895 : CMP EAX,0x19
005b9898 : JNZ 0x005b98ae
005b989a : MOV EAX,dword ptr [ESI + 0x8]
005b989d : CMP EAX,EBX
005b989f : JZ 0x005b98aa
005b98a1 : ADD EAX,-0x10
005b98a4 : MOV dword ptr [ESP + 0x28],EAX
005b98a8 : JMP 0x005b98ae
005b98aa : MOV dword ptr [ESP + 0x28],EBX
005b98ae : MOV EDI,dword ptr [ESI + 0x18]
005b98b1 : PUSH EBP
005b98b2 : PUSH EBX
005b98b3 : MOV ECX,ESI
005b98b5 : CALL 0x00526260
005b98ba : PUSH EBX
005b98bb : PUSH -0x1
005b98bd : PUSH EDI
005b98be : LEA ECX,[ESP + 0x1c]
005b98c2 : PUSH ECX
005b98c3 : MOV ECX,EAX
005b98c5 : CALL 0x005272e0
005b98ca : MOV EBP,0x1
005b98cf : PUSH EBP
005b98d0 : MOV ECX,ESI
005b98d2 : CALL 0x00526260
005b98d7 : CMP byte ptr [EAX],0x7
005b98da : MOV ECX,ESI
005b98dc : JNZ 0x005b98fa
005b98de : MOV EDX,dword ptr [ESI + 0x18]
005b98e1 : PUSH EDX
005b98e2 : PUSH EBP
005b98e3 : CALL 0x00526260
005b98e8 : MOV ECX,EAX
005b98ea : CALL 0x00525fa0
005b98ef : CMP EAX,EBX
005b98f1 : JZ 0x005b98f6
005b98f3 : ADD dword ptr [EAX + 0x4],EBP
005b98f6 : MOV EBX,EAX
005b98f8 : JMP 0x005b9940
005b98fa : MOV EDI,dword ptr [ESI + 0x18]
005b98fd : PUSH EBP
005b98fe : CALL 0x00526260
005b9903 : PUSH EBX
005b9904 : PUSH -0x1
005b9906 : PUSH EDI
005b9907 : LEA ECX,[ESP + 0x20]
005b990b : PUSH ECX
005b990c : MOV ECX,EAX
005b990e : CALL 0x005272e0
005b9913 : MOV ECX,dword ptr [ESI + 0x18]
005b9916 : PUSH EBX
005b9917 : LEA EDX,[ESP + 0x18]
005b991b : PUSH EDX
005b991c : CALL 0x0052add0
005b9921 : CMP EAX,EBX
005b9923 : JZ 0x005b9928
005b9925 : ADD dword ptr [EAX + 0x4],EBP
005b9928 : MOV EBX,EAX
005b992a : MOV EAX,dword ptr [ESP + 0x14]
005b992e : DEC dword ptr [EAX + 0x8]
005b9931 : MOV ECX,EAX
005b9933 : ADD EAX,0x8
005b9936 : CMP dword ptr [EAX],0x0
005b9939 : JNZ 0x005b9940
005b993b : CALL 0x00525340
005b9940 : TEST EBX,EBX
005b9942 : JZ 0x005b9967
005b9944 : MOV ECX,dword ptr [ESP + 0x2c]
005b9948 : MOV EAX,dword ptr [ESP + 0x10]
005b994c : MOV EAX,dword ptr [EAX]
005b994e : PUSH ECX
005b994f : MOV ECX,dword ptr [ESI + 0x18]
005b9952 : PUSH 0x0
005b9954 : PUSH EAX
005b9955 : PUSH EBX
005b9956 : CALL 0x005296a0
005b995b : MOV ECX,EAX
005b995d : CALL 0x00574f60
005b9962 : JMP 0x005b9a2e
005b9967 : MOV EDX,dword ptr [ESI + 0x18]
005b996a : MOV dword ptr [ESP + 0x24],0xcca874
005b9972 : MOV ECX,dword ptr [EDX + 0x74]
005b9975 : CALL 0x0051cf20
005b997a : MOV EDI,dword ptr [ESI + 0x18]
005b997d : CMP EAX,0x6
005b9980 : SETA AL
005b9983 : PUSH EBP
005b9984 : MOV ECX,ESI
005b9986 : MOV byte ptr [ESP + 0x24],AL
005b998a : CALL 0x00526260
005b998f : PUSH 0x0
005b9991 : PUSH -0x1
005b9993 : PUSH EDI
005b9994 : LEA ECX,[ESP + 0x24]
005b9998 : PUSH ECX
005b9999 : MOV ECX,EAX
005b999b : CALL 0x005272e0
005b99a0 : MOV EDX,dword ptr [ESP + 0x18]
005b99a4 : MOV EAX,dword ptr [EDX]
005b99a6 : MOV ECX,dword ptr [ESP + 0x20]
005b99aa : PUSH ECX
005b99ab : LEA EDX,[ESP + 0x28]
005b99af : PUSH EDX
005b99b0 : PUSH EAX
005b99b1 : CALL 0x0056a360
005b99b6 : MOV EDI,EAX
005b99b8 : MOV EAX,dword ptr [ESP + 0x24]
005b99bc : DEC dword ptr [EAX + 0x8]
005b99bf : MOV ECX,EAX
005b99c1 : ADD EAX,0x8
005b99c4 : ADD ESP,0xc
005b99c7 : CMP dword ptr [EAX],0x0
005b99ca : JNZ 0x005b99d1
005b99cc : CALL 0x00525340
005b99d1 : MOV EAX,dword ptr [ESP + 0x10]
005b99d5 : CMP EDI,-0x1
005b99d8 : JZ 0x005b9a4e
005b99da : MOV EDI,dword ptr [EAX]
005b99dc : MOV EBP,dword ptr [ESI + 0x18]
005b99df : PUSH 0x1
005b99e1 : MOV ECX,ESI
005b99e3 : CALL 0x00526260
005b99e8 : PUSH 0x0
005b99ea : PUSH -0x1
005b99ec : PUSH EBP
005b99ed : LEA ECX,[ESP + 0x28]
005b99f1 : PUSH ECX
005b99f2 : MOV ECX,EAX
005b99f4 : CALL 0x005272e0
005b99f9 : MOV EDX,dword ptr [ESP + 0x1c]
005b99fd : MOV EAX,dword ptr [EDX]
005b99ff : MOV EDX,dword ptr [ESP + 0x2c]
005b9a03 : MOV ECX,dword ptr [ESI + 0x18]
005b9a06 : PUSH EDX
005b9a07 : PUSH 0x0
005b9a09 : PUSH ECX
005b9a0a : PUSH EDI
005b9a0b : PUSH EAX
005b9a0c : CALL 0x005296a0
005b9a11 : MOV ECX,EAX
005b9a13 : CALL 0x00574d10
005b9a18 : MOV EAX,dword ptr [ESP + 0x1c]
005b9a1c : DEC dword ptr [EAX + 0x8]
005b9a1f : MOV ECX,EAX
005b9a21 : ADD EAX,0x8
005b9a24 : CMP dword ptr [EAX],0x0
005b9a27 : JNZ 0x005b9a2e
005b9a29 : CALL 0x00525340
005b9a2e : MOV ESI,dword ptr [ESI + 0x4]
005b9a31 : MOV ECX,ESI
005b9a33 : CALL 0x00526400
005b9a38 : MOV byte ptr [ESI],0x2
005b9a3b : MOV byte ptr [ESI + 0x4],0x1
005b9a3f : TEST EBX,EBX
005b9a41 : JZ 0x005b9a4a
005b9a43 : MOV ECX,EBX
005b9a45 : CALL 0x004ff7c0
005b9a4a : MOV EAX,dword ptr [ESP + 0x10]
005b9a4e : DEC dword ptr [EAX + 0x8]
005b9a51 : MOV ECX,EAX
005b9a53 : ADD EAX,0x8
005b9a56 : CMP dword ptr [EAX],0x0
005b9a59 : JNZ 0x005b9a60
005b9a5b : CALL 0x00525340
005b9a60 : POP EBP
005b9a61 : POP EBX
005b9a62 : POP EDI
005b9a63 : POP ESI
005b9a64 : ADD ESP,0x18
005b9a67 : RET
