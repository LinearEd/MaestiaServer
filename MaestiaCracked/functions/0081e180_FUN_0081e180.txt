PROGRAM  : Maestia.exe
FUNCTION : FUN_0081e180
ENTRY    : 0081e180
BODY     : [[0081e180, 0081e3fd]]

============================================================
DECOMPILED C CODE
============================================================

/* WARNING: Globals starting with '_' overlap smaller symbols at the same address */

void FUN_0081e180(uint param_1)

{
  int *piVar1;
  char cVar2;
  uint uVar3;
  BOOL BVar4;
  DWORD DVar5;
  short *psVar6;
  int iVar7;
  undefined4 uVar8;
  int in_ECX;
  undefined1 local_60 [28];
  LPCRITICAL_SECTION local_44;
  char *local_40;
  undefined4 local_3c;
  int local_38;
  undefined4 local_34;
  undefined1 local_30 [28];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  puStack_c = &LAB_00b1b0f5;
  local_10 = ExceptionList;
  uVar3 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_14 = uVar3;
  if ((DAT_01726804 & 1) == 0) {
    DAT_01726804 = DAT_01726804 | 1;
    local_8 = 0;
    _DAT_017267e8 = &PTR_FUN_00cdec94;
    BVar4 = InitializeCriticalSectionAndSpinCount((LPCRITICAL_SECTION)&DAT_017267ec,4000);
    if (BVar4 == 0) {
      InitializeCriticalSection((LPCRITICAL_SECTION)&DAT_017267ec);
    }
    _atexit((_func_4879 *)&LAB_00b841b0);
  }
  local_8 = 0xffffffff;
  local_38 = 0;
  local_44 = (LPCRITICAL_SECTION)&DAT_017267ec;
  local_40 = ".\\AvaGame.cpp";
  local_3c = 0xbfa;
  local_34 = 1;
  FUN_006ef1a0(&local_44);
  local_8 = 1;
  DVar5 = timeGetTime();
  if (((DVar5 - *(int *)(in_ECX + 0x30c) < param_1) ||
      (psVar6 = (short *)FUN_008125a0(*(undefined4 *)(DAT_017248c8 + 0x150)), psVar6 == (short *)0x0
      )) || (*psVar6 == 0)) {
    local_8 = 0xffffffff;
    if (local_38 != 0) {
      local_8 = 0xffffffff;
      LeaveCriticalSection(local_44);
      local_38 = 0;
    }
  }
  else {
    piVar1 = *(int **)(in_ECX + 0x368);
    if (piVar1 == (int *)0x0) {
      if ((*(int *)(in_ECX + 0x17c) != 0) && (*(uint *)(*(int *)(in_ECX + 0x17c) + 0xa0) < 0x10)) {
        cVar2 = FUN_008896a0(uVar3);
        if ((cVar2 == '\0') && (cVar2 = FUN_00889650(), cVar2 == '\0')) {
          local_8 = 0xffffffff;
          FUN_006ef180();
          goto LAB_0081e3e0;
        }
        iVar7 = _rand();
        if (iVar7 % 3 == 0) {
          FUN_00406460(L"IDS_CHAT_MSG_TIP");
          local_8._0_1_ = 2;
          uVar8 = FUN_00406460(psVar6);
          local_8._0_1_ = 3;
          FUN_0081d120(local_60);
          local_8._0_1_ = 4;
          FUN_00403450(local_30,uVar8);
          local_8._0_1_ = 6;
          FUN_00406560();
          local_8._0_1_ = 7;
          FUN_00406560();
          local_8._0_1_ = 8;
          FUN_00406560();
          (**(code **)(**(int **)(*DAT_00da9894 + 0x1a8) + 0x44))(local_30,0x10);
          local_8 = CONCAT31(local_8._1_3_,1);
          FUN_00406560();
        }
      }
    }
    else {
      (**(code **)(*piVar1 + 4))(piVar1,"SetTipText",&DAT_00c3274c,psVar6);
    }
    DVar5 = timeGetTime();
    *(DWORD *)(in_ECX + 0x30c) = DVar5;
    local_8 = 0xffffffff;
    if (local_38 != 0) {
      LeaveCriticalSection(local_44);
      local_38 = 0;
    }
  }
LAB_0081e3e0:
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
0081e180 : PUSH EBP
0081e181 : MOV EBP,ESP
0081e183 : PUSH -0x1
0081e185 : PUSH 0xb1b0f5
0081e18a : MOV EAX,FS:[0x0]
0081e190 : PUSH EAX
0081e191 : SUB ESP,0x88
0081e197 : MOV EAX,[0x00d66fa0]
0081e19c : XOR EAX,EBP
0081e19e : MOV dword ptr [EBP + -0x10],EAX
0081e1a1 : PUSH EBX
0081e1a2 : PUSH ESI
0081e1a3 : PUSH EDI
0081e1a4 : PUSH EAX
0081e1a5 : LEA EAX,[EBP + -0xc]
0081e1a8 : MOV FS:[0x0],EAX
0081e1ae : TEST byte ptr [0x01726804],0x1
0081e1b5 : MOV ESI,ECX
0081e1b7 : MOV EDI,0x1
0081e1bc : JNZ 0x0081e208
0081e1be : OR dword ptr [0x01726804],EDI
0081e1c4 : XOR EBX,EBX
0081e1c6 : MOV dword ptr [EBP + -0x4],EBX
0081e1c9 : PUSH 0xfa0
0081e1ce : PUSH 0x17267ec
0081e1d3 : MOV dword ptr [0x017267e8],0xcdec94
0081e1dd : CALL dword ptr [0x00b85110]
0081e1e3 : TEST EAX,EAX
0081e1e5 : JNZ 0x0081e1f2
0081e1e7 : PUSH 0x17267ec
0081e1ec : CALL dword ptr [0x00b85114]
0081e1f2 : PUSH 0xb841b0
0081e1f7 : CALL 0x006356bc
0081e1fc : ADD ESP,0x4
0081e1ff : MOV dword ptr [EBP + -0x4],0xffffffff
0081e206 : JMP 0x0081e20a
0081e208 : XOR EBX,EBX
0081e20a : LEA EAX,[EBP + -0x40]
0081e20d : PUSH EAX
0081e20e : MOV dword ptr [EBP + -0x34],EBX
0081e211 : MOV dword ptr [EBP + -0x40],0x17267ec
0081e218 : MOV dword ptr [EBP + -0x3c],0xc3273c
0081e21f : MOV dword ptr [EBP + -0x38],0xbfa
0081e226 : MOV dword ptr [EBP + -0x30],EDI
0081e229 : CALL 0x006ef1a0
0081e22e : MOV dword ptr [EBP + -0x4],EDI
0081e231 : CALL dword ptr [0x00b85598]
0081e237 : SUB EAX,dword ptr [ESI + 0x30c]
0081e23d : CMP EAX,dword ptr [EBP + 0x8]
0081e240 : JNC 0x0081e25b
0081e242 : MOV dword ptr [EBP + -0x4],0xffffffff
0081e249 : CMP dword ptr [EBP + -0x34],EBX
0081e24c : JZ 0x0081e3de
0081e252 : MOV ECX,dword ptr [EBP + -0x40]
0081e255 : PUSH ECX
0081e256 : JMP 0x0081e3d5
0081e25b : MOV EDX,dword ptr [0x017248c8]
0081e261 : MOV EAX,dword ptr [EDX + 0x150]
0081e267 : PUSH EAX
0081e268 : MOV EAX,dword ptr [ESI + 0x144]
0081e26e : CALL 0x008125a0
0081e273 : MOV EDI,EAX
0081e275 : CMP EDI,EBX
0081e277 : JZ 0x0081e3c5
0081e27d : CMP word ptr [EDI],BX
0081e280 : JZ 0x0081e3c5
0081e286 : MOV EAX,dword ptr [ESI + 0x368]
0081e28c : CMP EAX,EBX
0081e28e : JZ 0x0081e2ab
0081e290 : MOV ECX,dword ptr [EAX]
0081e292 : MOV EDX,dword ptr [ECX + 0x4]
0081e295 : PUSH EDI
0081e296 : PUSH 0xc3274c
0081e29b : PUSH 0xc32750
0081e2a0 : PUSH EAX
0081e2a1 : CALL EDX
0081e2a3 : ADD ESP,0x10
0081e2a6 : JMP 0x0081e39c
0081e2ab : MOV EBX,dword ptr [ESI + 0x17c]
0081e2b1 : TEST EBX,EBX
0081e2b3 : JZ 0x0081e39a
0081e2b9 : CMP dword ptr [EBX + 0xa0],0xf
0081e2c0 : JA 0x0081e39a
0081e2c6 : MOV EAX,EBX
0081e2c8 : CALL 0x008896a0
0081e2cd : TEST AL,AL
0081e2cf : JNZ 0x0081e2f0
0081e2d1 : MOV EAX,EBX
0081e2d3 : CALL 0x00889650
0081e2d8 : TEST AL,AL
0081e2da : JNZ 0x0081e2f0
0081e2dc : MOV dword ptr [EBP + -0x4],0xffffffff
0081e2e3 : LEA ESI,[EBP + -0x40]
0081e2e6 : CALL 0x006ef180
0081e2eb : JMP 0x0081e3de
0081e2f0 : CALL 0x00635d2f
0081e2f5 : CDQ
0081e2f6 : MOV ECX,0x3
0081e2fb : IDIV ECX
0081e2fd : TEST EDX,EDX
0081e2ff : JNZ 0x0081e39a
0081e305 : PUSH 0xc3275c
0081e30a : LEA ECX,[EBP + -0x5c]
0081e30d : CALL 0x00406460
0081e312 : MOV byte ptr [EBP + -0x4],0x2
0081e316 : PUSH EDI
0081e317 : LEA ECX,[EBP + 0xffffff6c]
0081e31d : CALL 0x00406460
0081e322 : MOV EBX,EAX
0081e324 : MOV byte ptr [EBP + -0x4],0x3
0081e328 : MOV ECX,dword ptr [0x0172491c]
0081e32e : LEA EDX,[EBP + -0x5c]
0081e331 : PUSH EDX
0081e332 : LEA EDI,[EBP + -0x78]
0081e335 : CALL 0x0081d120
0081e33a : MOV byte ptr [EBP + -0x4],0x4
0081e33e : LEA ECX,[EBP + -0x2c]
0081e341 : PUSH EBX
0081e342 : PUSH ECX
0081e343 : MOV ECX,EAX
0081e345 : CALL 0x00403450
0081e34a : ADD ESP,0x8
0081e34d : MOV byte ptr [EBP + -0x4],0x6
0081e351 : MOV ECX,EDI
0081e353 : CALL 0x00406560
0081e358 : MOV byte ptr [EBP + -0x4],0x7
0081e35c : LEA ECX,[EBP + 0xffffff6c]
0081e362 : CALL 0x00406560
0081e367 : MOV byte ptr [EBP + -0x4],0x8
0081e36b : LEA ECX,[EBP + -0x5c]
0081e36e : CALL 0x00406560
0081e373 : MOV EDX,dword ptr [0x00da9894]
0081e379 : MOV EAX,dword ptr [EDX]
0081e37b : MOV ECX,dword ptr [EAX + 0x1a8]
0081e381 : MOV EAX,dword ptr [ECX]
0081e383 : MOV EAX,dword ptr [EAX + 0x44]
0081e386 : PUSH 0x10
0081e388 : LEA EDX,[EBP + -0x2c]
0081e38b : PUSH EDX
0081e38c : CALL EAX
0081e38e : MOV byte ptr [EBP + -0x4],0x1
0081e392 : LEA ECX,[EBP + -0x2c]
0081e395 : CALL 0x00406560
0081e39a : XOR EBX,EBX
0081e39c : CALL dword ptr [0x00b85598]
0081e3a2 : MOV dword ptr [ESI + 0x30c],EAX
0081e3a8 : MOV dword ptr [EBP + -0x4],0xffffffff
0081e3af : CMP dword ptr [EBP + -0x34],EBX
0081e3b2 : JZ 0x0081e3c1
0081e3b4 : MOV ECX,dword ptr [EBP + -0x40]
0081e3b7 : PUSH ECX
0081e3b8 : CALL dword ptr [0x00b8511c]
0081e3be : MOV dword ptr [EBP + -0x34],EBX
0081e3c1 : MOV AL,0x1
0081e3c3 : JMP 0x0081e3e0
0081e3c5 : MOV dword ptr [EBP + -0x4],0xffffffff
0081e3cc : CMP dword ptr [EBP + -0x34],EBX
0081e3cf : JZ 0x0081e3de
0081e3d1 : MOV EDX,dword ptr [EBP + -0x40]
0081e3d4 : PUSH EDX
0081e3d5 : CALL dword ptr [0x00b8511c]
0081e3db : MOV dword ptr [EBP + -0x34],EBX
0081e3de : XOR AL,AL
0081e3e0 : MOV ECX,dword ptr [EBP + -0xc]
0081e3e3 : MOV dword ptr FS:[0x0],ECX
0081e3ea : POP ECX
0081e3eb : POP EDI
0081e3ec : POP ESI
0081e3ed : POP EBX
0081e3ee : MOV ECX,dword ptr [EBP + -0x10]
0081e3f1 : XOR ECX,EBP
0081e3f3 : CALL 0x00633e6b
0081e3f8 : MOV ESP,EBP
0081e3fa : POP EBP
0081e3fb : RET 0x4
