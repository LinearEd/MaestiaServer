PROGRAM  : Maestia.exe
FUNCTION : FUN_00a1cd50
ENTRY    : 00a1cd50
BODY     : [[00a1cd50, 00a1cfa4]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a1cd50(void)

{
  LPCRITICAL_SECTION lpCriticalSection;
  wchar_t wVar1;
  int *piVar2;
  int *piVar3;
  wchar_t *pwVar4;
  wchar_t *pwVar5;
  int in_ECX;
  int iVar6;
  wchar_t *pwVar7;
  int in_EDX;
  bool bVar8;
  undefined4 local_12c;
  undefined4 local_11c;
  uint local_118;
  wchar_t local_114;
  undefined1 local_112 [254];
  uint local_14;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b1395e;
  local_10 = ExceptionList;
  local_14 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_114 = L'\0';
  _memset(local_112,0,0xfe);
  if (*(uint *)(in_EDX + 0x18) < 8) {
    pwVar4 = (wchar_t *)(in_EDX + 4);
  }
  else {
    pwVar4 = *(wchar_t **)(in_EDX + 4);
  }
  _wcscpy_s(&local_114,0x80,pwVar4);
  pwVar4 = _wcsstr(&local_114,L"GM_");
  if (pwVar4 == (wchar_t *)0x0) {
    pwVar4 = &local_114;
  }
  else {
    pwVar4 = pwVar4 + 3;
  }
  iVar6 = *(int *)(in_ECX + 0xac);
  pwVar7 = pwVar4;
  if (*(uint *)(iVar6 + 0x40) < 8) {
    pwVar5 = (wchar_t *)(iVar6 + 0x2c);
  }
  else {
    pwVar5 = *(wchar_t **)(iVar6 + 0x2c);
  }
  do {
    wVar1 = *pwVar7;
    bVar8 = (ushort)wVar1 < (ushort)*pwVar5;
    if (wVar1 != *pwVar5) {
LAB_00a1ce27:
      iVar6 = (1 - (uint)bVar8) - (uint)(bVar8 != 0);
      goto LAB_00a1ce2c;
    }
    if (wVar1 == L'\0') break;
    wVar1 = pwVar7[1];
    bVar8 = (ushort)wVar1 < (ushort)pwVar5[1];
    if (wVar1 != pwVar5[1]) goto LAB_00a1ce27;
    pwVar5 = pwVar5 + 2;
    pwVar7 = pwVar7 + 2;
  } while (wVar1 != L'\0');
  iVar6 = 0;
LAB_00a1ce2c:
  if (iVar6 != 0) {
    lpCriticalSection = (LPCRITICAL_SECTION)(in_ECX + 0x1c);
    EnterCriticalSection(lpCriticalSection);
    local_8 = 0;
    piVar2 = *(int **)(in_ECX + 0xc0);
    piVar3 = (int *)*piVar2;
    while (piVar3 != piVar2) {
      local_118 = 7;
      local_11c = 0;
      local_12c = (wchar_t *)((uint)local_12c & 0xffff0000);
      FUN_00405eb0(piVar3[4] + 0x28,0,0xffffffff);
      local_8 = CONCAT31(local_8._1_3_,1);
      pwVar5 = pwVar4;
      pwVar7 = local_12c;
      if (local_118 < 8) {
        pwVar7 = (wchar_t *)&local_12c;
      }
      do {
        wVar1 = *pwVar5;
        bVar8 = (ushort)wVar1 < (ushort)*pwVar7;
        if (wVar1 != *pwVar7) {
LAB_00a1ced9:
          iVar6 = (1 - (uint)bVar8) - (uint)(bVar8 != 0);
          goto LAB_00a1cede;
        }
        if (wVar1 == L'\0') break;
        wVar1 = pwVar5[1];
        bVar8 = (ushort)wVar1 < (ushort)pwVar7[1];
        if (wVar1 != pwVar7[1]) goto LAB_00a1ced9;
        pwVar5 = pwVar5 + 2;
        pwVar7 = pwVar7 + 2;
      } while (wVar1 != L'\0');
      iVar6 = 0;
LAB_00a1cede:
      if (iVar6 == 0) {
        local_8 = (uint)local_8._1_3_ << 8;
        if (7 < local_118) {
                    /* WARNING: Subroutine does not return */
          FUN_006f04e0();
        }
        local_118 = 7;
        local_11c = 0;
        local_12c = (wchar_t *)((uint)local_12c._2_2_ << 0x10);
        local_8 = 0xffffffff;
        LeaveCriticalSection(lpCriticalSection);
        goto LAB_00a1cf41;
      }
      local_8 = (uint)local_8._1_3_ << 8;
      if (7 < local_118) {
                    /* WARNING: Subroutine does not return */
        FUN_006f04e0();
      }
      local_118 = 7;
      local_11c = 0;
      local_12c = (wchar_t *)((uint)local_12c._2_2_ << 0x10);
      FUN_00416210();
    }
    local_8 = 0xffffffff;
    LeaveCriticalSection(lpCriticalSection);
  }
LAB_00a1cf41:
  ExceptionList = local_10;
  __security_check_cookie(local_14 ^ (uint)&stack0xfffffffc);
  return;
}



============================================================
DISASSEMBLY
============================================================
00a1cd50 : PUSH EBP
00a1cd51 : MOV EBP,ESP
00a1cd53 : PUSH -0x1
00a1cd55 : PUSH 0xb1395e
00a1cd5a : MOV EAX,FS:[0x0]
00a1cd60 : PUSH EAX
00a1cd61 : SUB ESP,0x130
00a1cd67 : MOV EAX,[0x00d66fa0]
00a1cd6c : XOR EAX,EBP
00a1cd6e : MOV dword ptr [EBP + -0x10],EAX
00a1cd71 : PUSH EBX
00a1cd72 : PUSH ESI
00a1cd73 : PUSH EDI
00a1cd74 : PUSH EAX
00a1cd75 : LEA EAX,[EBP + -0xc]
00a1cd78 : MOV FS:[0x0],EAX
00a1cd7e : PUSH 0xfe
00a1cd83 : MOV EDI,ECX
00a1cd85 : XOR EBX,EBX
00a1cd87 : LEA ECX,[EBP + 0xfffffef2]
00a1cd8d : XOR EAX,EAX
00a1cd8f : PUSH EBX
00a1cd90 : PUSH ECX
00a1cd91 : MOV ESI,EDX
00a1cd93 : MOV word ptr [EBP + 0xfffffef0],AX
00a1cd9a : CALL 0x0063b700
00a1cd9f : ADD ESP,0xc
00a1cda2 : CMP dword ptr [ESI + 0x18],0x8
00a1cda6 : JC 0x00a1cdad
00a1cda8 : MOV ESI,dword ptr [ESI + 0x4]
00a1cdab : JMP 0x00a1cdb0
00a1cdad : ADD ESI,0x4
00a1cdb0 : PUSH ESI
00a1cdb1 : LEA EDX,[EBP + 0xfffffef0]
00a1cdb7 : PUSH 0x80
00a1cdbc : PUSH EDX
00a1cdbd : CALL 0x0063481b
00a1cdc2 : LEA EAX,[EBP + 0xfffffef0]
00a1cdc8 : PUSH 0xcc14b4
00a1cdcd : PUSH EAX
00a1cdce : CALL 0x006347ba
00a1cdd3 : MOV ECX,EAX
00a1cdd5 : ADD ESP,0x14
00a1cdd8 : CMP ECX,EBX
00a1cdda : JZ 0x00a1cde1
00a1cddc : ADD ECX,0x6
00a1cddf : JMP 0x00a1cde7
00a1cde1 : LEA ECX,[EBP + 0xfffffef0]
00a1cde7 : MOV EAX,dword ptr [EDI + 0xac]
00a1cded : CMP dword ptr [EAX + 0x40],0x8
00a1cdf1 : MOV dword ptr [EBP + 0xfffffed0],ECX
00a1cdf7 : JC 0x00a1cdfe
00a1cdf9 : MOV EDX,dword ptr [EAX + 0x2c]
00a1cdfc : JMP 0x00a1ce01
00a1cdfe : LEA EDX,[EAX + 0x2c]
00a1ce01 : MOV SI,word ptr [ECX]
00a1ce04 : CMP SI,word ptr [EDX]
00a1ce07 : JNZ 0x00a1ce27
00a1ce09 : CMP SI,BX
00a1ce0c : JZ 0x00a1ce23
00a1ce0e : MOV SI,word ptr [ECX + 0x2]
00a1ce12 : CMP SI,word ptr [EDX + 0x2]
00a1ce16 : JNZ 0x00a1ce27
00a1ce18 : ADD ECX,0x4
00a1ce1b : ADD EDX,0x4
00a1ce1e : CMP SI,BX
00a1ce21 : JNZ 0x00a1ce01
00a1ce23 : XOR ECX,ECX
00a1ce25 : JMP 0x00a1ce2c
00a1ce27 : SBB ECX,ECX
00a1ce29 : SBB ECX,-0x1
00a1ce2c : CMP ECX,EBX
00a1ce2e : JZ 0x00a1cf41
00a1ce34 : LEA EAX,[EDI + 0x18]
00a1ce37 : LEA ESI,[EAX + 0x4]
00a1ce3a : PUSH ESI
00a1ce3b : MOV dword ptr [EBP + 0xfffffec4],EAX
00a1ce41 : MOV dword ptr [EBP + 0xfffffecc],ESI
00a1ce47 : CALL dword ptr [0x00b85118]
00a1ce4d : MOV dword ptr [EBP + -0x4],EBX
00a1ce50 : MOV EDI,dword ptr [EDI + 0xc0]
00a1ce56 : MOV EAX,dword ptr [EDI]
00a1ce58 : MOV dword ptr [EBP + 0xfffffec8],EAX
00a1ce5e : CMP EAX,EDI
00a1ce60 : JZ 0x00a1cf31
00a1ce66 : MOV ESI,dword ptr [EAX + 0x10]
00a1ce69 : PUSH -0x1
00a1ce6b : LEA EAX,[ESI + 0x28]
00a1ce6e : PUSH EBX
00a1ce6f : XOR EDX,EDX
00a1ce71 : PUSH EAX
00a1ce72 : LEA ECX,[EBP + 0xfffffed4]
00a1ce78 : MOV dword ptr [EBP + 0xfffffeec],0x7
00a1ce82 : MOV dword ptr [EBP + 0xfffffee8],EBX
00a1ce88 : MOV word ptr [EBP + 0xfffffed8],DX
00a1ce8f : CALL 0x00405eb0
00a1ce94 : MOV byte ptr [EBP + -0x4],0x1
00a1ce98 : CMP dword ptr [EBP + 0xfffffeec],0x8
00a1ce9f : MOV ECX,dword ptr [EBP + 0xfffffed8]
00a1cea5 : JNC 0x00a1cead
00a1cea7 : LEA ECX,[EBP + 0xfffffed8]
00a1cead : MOV EAX,dword ptr [EBP + 0xfffffed0]
00a1ceb3 : MOV DX,word ptr [EAX]
00a1ceb6 : CMP DX,word ptr [ECX]
00a1ceb9 : JNZ 0x00a1ced9
00a1cebb : CMP DX,BX
00a1cebe : JZ 0x00a1ced5
00a1cec0 : MOV DX,word ptr [EAX + 0x2]
00a1cec4 : CMP DX,word ptr [ECX + 0x2]
00a1cec8 : JNZ 0x00a1ced9
00a1ceca : ADD EAX,0x4
00a1cecd : ADD ECX,0x4
00a1ced0 : CMP DX,BX
00a1ced3 : JNZ 0x00a1ceb3
00a1ced5 : XOR EAX,EAX
00a1ced7 : JMP 0x00a1cede
00a1ced9 : SBB EAX,EAX
00a1cedb : SBB EAX,-0x1
00a1cede : CMP EAX,EBX
00a1cee0 : JZ 0x00a1cf5d
00a1cee2 : MOV byte ptr [EBP + -0x4],BL
00a1cee5 : CMP dword ptr [EBP + 0xfffffeec],0x8
00a1ceec : JC 0x00a1cef9
00a1ceee : MOV ECX,dword ptr [EBP + 0xfffffed8]
00a1cef4 : CALL 0x006f04e0
00a1cef9 : XOR EAX,EAX
00a1cefb : LEA EDX,[EBP + 0xfffffec8]
00a1cf01 : MOV dword ptr [EBP + 0xfffffeec],0x7
00a1cf0b : MOV dword ptr [EBP + 0xfffffee8],EBX
00a1cf11 : MOV word ptr [EBP + 0xfffffed8],AX
00a1cf18 : CALL 0x00416210
00a1cf1d : MOV EAX,dword ptr [EBP + 0xfffffec8]
00a1cf23 : CMP EAX,EDI
00a1cf25 : JNZ 0x00a1ce66
00a1cf2b : MOV ESI,dword ptr [EBP + 0xfffffecc]
00a1cf31 : MOV dword ptr [EBP + -0x4],0xffffffff
00a1cf38 : PUSH ESI
00a1cf39 : CALL dword ptr [0x00b8511c]
00a1cf3f : XOR EAX,EAX
00a1cf41 : MOV ECX,dword ptr [EBP + -0xc]
00a1cf44 : MOV dword ptr FS:[0x0],ECX
00a1cf4b : POP ECX
00a1cf4c : POP EDI
00a1cf4d : POP ESI
00a1cf4e : POP EBX
00a1cf4f : MOV ECX,dword ptr [EBP + -0x10]
00a1cf52 : XOR ECX,EBP
00a1cf54 : CALL 0x00633e6b
00a1cf59 : MOV ESP,EBP
00a1cf5b : POP EBP
00a1cf5c : RET
00a1cf5d : MOV byte ptr [EBP + -0x4],BL
00a1cf60 : CMP dword ptr [EBP + 0xfffffeec],0x8
00a1cf67 : JC 0x00a1cf74
00a1cf69 : MOV ECX,dword ptr [EBP + 0xfffffed8]
00a1cf6f : CALL 0x006f04e0
00a1cf74 : XOR ECX,ECX
00a1cf76 : MOV dword ptr [EBP + 0xfffffeec],0x7
00a1cf80 : MOV dword ptr [EBP + 0xfffffee8],EBX
00a1cf86 : MOV word ptr [EBP + 0xfffffed8],CX
00a1cf8d : MOV dword ptr [EBP + -0x4],0xffffffff
00a1cf94 : MOV EDX,dword ptr [EBP + 0xfffffecc]
00a1cf9a : PUSH EDX
00a1cf9b : CALL dword ptr [0x00b8511c]
00a1cfa1 : MOV EAX,ESI
00a1cfa3 : JMP 0x00a1cf41
