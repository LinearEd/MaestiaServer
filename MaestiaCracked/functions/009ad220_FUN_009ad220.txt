PROGRAM  : Maestia.exe
FUNCTION : FUN_009ad220
ENTRY    : 009ad220
BODY     : [[009ad220, 009ad41f]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_009ad220(int param_1,undefined4 param_2)

{
  uint8_t *puVar1;
  uint uVar2;
  int iVar3;
  uint8_t *packet;
  byte bVar4;
  int iVar5;
  uint uVar6;
  undefined8 uVar7;
  undefined1 local_50 [4];
  undefined2 local_4c;
  undefined4 local_3c;
  uint local_38;
  undefined1 local_34 [4];
  int local_30;
  int local_2c;
  undefined4 local_20;
  uint local_1c;
  uint local_18;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b4143b;
  local_10 = ExceptionList;
  uVar2 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  uVar6 = 0;
  local_38 = 7;
  local_3c = 0;
  local_4c = 0;
  FUN_00406360(&DAT_00c8b4f8,1);
  local_8 = 0;
  FUN_0070cd60(local_34,param_2,local_50,0,uVar2);
  local_8 = CONCAT31(local_8._1_3_,2);
  if (7 < local_38) {
                    /* WARNING: Subroutine does not return */
    FUN_006f04e0();
  }
  local_4c = 0;
  local_38 = 7;
  iVar3 = local_2c - local_30 >> 0x1f;
  iVar5 = 0;
  local_3c = 0;
  local_1c = 0;
  local_18 = 0;
  if ((local_2c - local_30) / 0x1c + iVar3 != iVar3) {
    do {
      if (*(uint *)(iVar5 + 0x18 + local_30) < 8) {
        iVar3 = iVar5 + 4 + local_30;
      }
      else {
        iVar3 = *(int *)(iVar5 + 4 + local_30);
      }
      iVar3 = FUN_00634f4d(iVar3);
      if (iVar3 == 1) {
        uVar7 = __allshl();
        local_1c = local_1c | (uint)uVar7;
        local_18 = local_18 | (uint)((ulonglong)uVar7 >> 0x20);
      }
      uVar6 = uVar6 + 1;
      iVar5 = iVar5 + 0x1c;
    } while (uVar6 < (uint)((local_2c - local_30) / 0x1c));
  }
  uVar2 = local_1c;
  iVar3 = *DAT_00da9894;
  if ((iVar3 != 0) && (*(int *)(iVar3 + 0x114) != 0)) {
    local_20 = 0;
    (**(code **)(**(int **)(iVar3 + 0x114) + 4))
              (*(int **)(iVar3 + 0x114),"SetChatBackVisible",&DAT_00c8b4fc,(local_1c & 1) == 0);
  }
  iVar3 = *(int *)ThreadLocalStoragePointer;
  bVar4 = (byte)((ulonglong)(*(byte *)(iVar3 + 0x18) + 1) % 3);
  *(byte *)(iVar3 + 0x18) = bVar4;
  puVar1 = (uint8_t *)((uint)bVar4 * 0x2000 + 0x122cb8 + iVar3);
  if (puVar1 == (uint8_t *)0x0) {
    packet = (uint8_t *)0x0;
  }
  else {
    puVar1[0] = '\0';
    puVar1[1] = '\0';
    puVar1[2] = '8';
    puVar1[3] = '\x1b';
    *(uint *)(puVar1 + 4) = uVar2;
    *(uint *)(puVar1 + 8) = local_18;
    packet = puVar1;
  }
  local_8 = CONCAT31((int3)((uint)local_8 >> 8),2);
  if ((*(int *)(DAT_017247d4 + 4) != 0) && (*(char *)(DAT_017247d4 + 8) != '\0')) {
    FUN_00a0dd40(*(int *)(DAT_017247d4 + 4),0xc,packet);
  }
  *(uint *)(param_1 + 0x40) = uVar2;
  *(uint *)(param_1 + 0x44) = local_18;
  FUN_009acfc0();
  local_8 = 0xffffffff;
  if (local_30 == 0) {
    ExceptionList = local_10;
    return;
  }
  FUN_00405450(puVar1);
                    /* WARNING: Subroutine does not return */
  FUN_006f04e0();
}



============================================================
DISASSEMBLY
============================================================
009ad220 : PUSH EBP
009ad221 : MOV EBP,ESP
009ad223 : PUSH -0x1
009ad225 : PUSH 0xb4143b
009ad22a : MOV EAX,FS:[0x0]
009ad230 : PUSH EAX
009ad231 : SUB ESP,0x44
009ad234 : PUSH EBX
009ad235 : PUSH ESI
009ad236 : PUSH EDI
009ad237 : MOV EAX,[0x00d66fa0]
009ad23c : XOR EAX,EBP
009ad23e : PUSH EAX
009ad23f : LEA EAX,[EBP + -0xc]
009ad242 : MOV FS:[0x0],EAX
009ad248 : PUSH 0x1
009ad24a : XOR EAX,EAX
009ad24c : MOV ESI,0x7
009ad251 : XOR EDI,EDI
009ad253 : PUSH 0xc8b4f8
009ad258 : LEA ECX,[EBP + -0x4c]
009ad25b : MOV dword ptr [EBP + -0x34],ESI
009ad25e : MOV dword ptr [EBP + -0x38],EDI
009ad261 : MOV word ptr [EBP + -0x48],AX
009ad265 : CALL 0x00406360
009ad26a : MOV dword ptr [EBP + -0x4],EDI
009ad26d : MOV EDX,dword ptr [EBP + 0xc]
009ad270 : PUSH EDI
009ad271 : LEA ECX,[EBP + -0x4c]
009ad274 : PUSH ECX
009ad275 : PUSH EDX
009ad276 : LEA EAX,[EBP + -0x30]
009ad279 : PUSH EAX
009ad27a : CALL 0x0070cd60
009ad27f : ADD ESP,0x10
009ad282 : MOV byte ptr [EBP + -0x4],0x2
009ad286 : CMP dword ptr [EBP + -0x34],0x8
009ad28a : JC 0x009ad294
009ad28c : MOV ECX,dword ptr [EBP + -0x48]
009ad28f : CALL 0x006f04e0
009ad294 : XOR ECX,ECX
009ad296 : MOV word ptr [EBP + -0x48],CX
009ad29a : MOV ECX,dword ptr [EBP + -0x28]
009ad29d : MOV dword ptr [EBP + -0x34],ESI
009ad2a0 : MOV ESI,dword ptr [EBP + -0x2c]
009ad2a3 : SUB ECX,ESI
009ad2a5 : MOV EAX,0x92492493
009ad2aa : IMUL ECX
009ad2ac : ADD EDX,ECX
009ad2ae : SAR EDX,0x4
009ad2b1 : MOV EAX,EDX
009ad2b3 : XOR EBX,EBX
009ad2b5 : SHR EAX,0x1f
009ad2b8 : ADD EAX,EDX
009ad2ba : MOV dword ptr [EBP + -0x38],EDI
009ad2bd : MOV dword ptr [EBP + -0x18],EBX
009ad2c0 : MOV dword ptr [EBP + -0x14],EDI
009ad2c3 : JZ 0x009ad31a
009ad2c5 : CMP dword ptr [EBX + ESI*0x1 + 0x18],0x8
009ad2ca : JC 0x009ad2d2
009ad2cc : MOV ESI,dword ptr [EBX + ESI*0x1 + 0x4]
009ad2d0 : JMP 0x009ad2d6
009ad2d2 : LEA ESI,[EBX + ESI*0x1 + 0x4]
009ad2d6 : PUSH ESI
009ad2d7 : CALL 0x00634f4d
009ad2dc : ADD ESP,0x4
009ad2df : CMP EAX,0x1
009ad2e2 : JNZ 0x009ad2f4
009ad2e4 : MOVSX ECX,DI
009ad2e7 : XOR EDX,EDX
009ad2e9 : CALL 0x00b0aba0
009ad2ee : OR dword ptr [EBP + -0x18],EAX
009ad2f1 : OR dword ptr [EBP + -0x14],EDX
009ad2f4 : MOV ECX,dword ptr [EBP + -0x28]
009ad2f7 : MOV ESI,dword ptr [EBP + -0x2c]
009ad2fa : SUB ECX,ESI
009ad2fc : MOV EAX,0x92492493
009ad301 : IMUL ECX
009ad303 : ADD EDX,ECX
009ad305 : SAR EDX,0x4
009ad308 : MOV ECX,EDX
009ad30a : SHR ECX,0x1f
009ad30d : INC EDI
009ad30e : ADD ECX,EDX
009ad310 : ADD EBX,0x1c
009ad313 : CMP EDI,ECX
009ad315 : JC 0x009ad2c5
009ad317 : MOV EBX,dword ptr [EBP + -0x18]
009ad31a : MOV EDX,dword ptr [0x00da9894]
009ad320 : MOV EAX,dword ptr [EDX]
009ad322 : XOR ESI,ESI
009ad324 : CMP EAX,ESI
009ad326 : JZ 0x009ad361
009ad328 : CMP dword ptr [EAX + 0x114],ESI
009ad32e : JZ 0x009ad361
009ad330 : MOV ECX,dword ptr [EAX + 0x114]
009ad336 : MOV EDX,dword ptr [ECX]
009ad338 : MOV EAX,EBX
009ad33a : AND EAX,0x1
009ad33d : MOV dword ptr [EBP + 0xc],EBX
009ad340 : XOR EBX,EBX
009ad342 : TEST EAX,EAX
009ad344 : MOV EAX,dword ptr [EDX + 0x4]
009ad347 : SETZ BL
009ad34a : MOV dword ptr [EBP + -0x1c],ESI
009ad34d : PUSH EBX
009ad34e : PUSH 0xc8b4fc
009ad353 : PUSH 0xc8b500
009ad358 : PUSH ECX
009ad359 : CALL EAX
009ad35b : MOV EBX,dword ptr [EBP + 0xc]
009ad35e : ADD ESP,0x10
009ad361 : MOV ECX,dword ptr FS:[0x2c]
009ad368 : MOV ECX,dword ptr [ECX]
009ad36a : MOVZX EAX,byte ptr [ECX + 0x18]
009ad36e : INC EAX
009ad36f : CDQ
009ad370 : MOV EDI,0x3
009ad375 : IDIV EDI
009ad377 : MOV byte ptr [ECX + 0x18],DL
009ad37a : MOVZX EDX,DL
009ad37d : SHL EDX,0xd
009ad380 : LEA EAX,[EDX + ECX*0x1 + 0x122cb8]
009ad387 : MOV dword ptr [EBP + 0xc],EAX
009ad38a : MOV byte ptr [EBP + -0x4],0x3
009ad38e : CMP EAX,ESI
009ad390 : JZ 0x009ad3aa
009ad392 : MOV EDX,dword ptr [EBP + -0x14]
009ad395 : XOR ECX,ECX
009ad397 : MOV word ptr [EAX],CX
009ad39a : MOV byte ptr [EAX + 0x2],0x38
009ad39e : MOV byte ptr [EAX + 0x3],0x1b
009ad3a2 : MOV dword ptr [EAX + 0x4],EBX
009ad3a5 : MOV dword ptr [EAX + 0x8],EDX
009ad3a8 : JMP 0x009ad3ac
009ad3aa : XOR EAX,EAX
009ad3ac : MOV byte ptr [EBP + -0x4],0x2
009ad3b0 : MOV EDX,dword ptr [0x017247d4]
009ad3b6 : MOV ECX,dword ptr [EDX + 0x4]
009ad3b9 : CMP ECX,ESI
009ad3bb : JZ 0x009ad3cd
009ad3bd : CMP byte ptr [EDX + 0x8],0x0
009ad3c1 : JZ 0x009ad3cd
009ad3c3 : PUSH 0xc
009ad3c5 : PUSH ECX
009ad3c6 : MOV EDI,EAX
009ad3c8 : CALL 0x00a0dd40
009ad3cd : MOV ECX,dword ptr [EBP + 0x8]
009ad3d0 : MOV EAX,dword ptr [EBP + -0x14]
009ad3d3 : MOV dword ptr [ECX + 0x40],EBX
009ad3d6 : MOV dword ptr [ECX + 0x44],EAX
009ad3d9 : CALL 0x009acfc0
009ad3de : MOV dword ptr [EBP + -0x4],0xffffffff
009ad3e5 : MOV EAX,dword ptr [EBP + -0x2c]
009ad3e8 : CMP EAX,ESI
009ad3ea : JZ 0x009ad403
009ad3ec : MOV ECX,dword ptr [EBP + 0xc]
009ad3ef : MOV EDI,dword ptr [EBP + -0x28]
009ad3f2 : PUSH ECX
009ad3f3 : CALL 0x00405450
009ad3f8 : MOV ECX,dword ptr [EBP + -0x2c]
009ad3fb : ADD ESP,0x4
009ad3fe : CALL 0x006f04e0
009ad403 : MOV dword ptr [EBP + -0x2c],ESI
009ad406 : MOV dword ptr [EBP + -0x28],ESI
009ad409 : MOV dword ptr [EBP + -0x24],ESI
009ad40c : MOV ECX,dword ptr [EBP + -0xc]
009ad40f : MOV dword ptr FS:[0x0],ECX
009ad416 : POP ECX
009ad417 : POP EDI
009ad418 : POP ESI
009ad419 : POP EBX
009ad41a : MOV ESP,EBP
009ad41c : POP EBP
009ad41d : RET 0x8
