PROGRAM  : Maestia.exe
FUNCTION : FUN_00474cc0
ENTRY    : 00474cc0
BODY     : [[00474cc0, 00474cf8] [00474d00, 00474e59]]

============================================================
DECOMPILED C CODE
============================================================

undefined4 FUN_00474cc0(int param_1,int param_2)

{
  int *piVar1;
  int iVar2;
  bool bVar3;
  int iVar4;
  uint uVar5;
  int iVar6;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  iVar4 = param_2;
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b82b45;
  local_10 = ExceptionList;
  uVar5 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  piVar1 = (int *)(param_2 + 0x38);
  param_2 = 0;
  if (0 < *piVar1) {
    do {
      iVar6 = *(int *)(*(int *)(iVar4 + 0x34) + param_2 * 4);
      if ((*(int *)(iVar6 + 0x84) != -1) && (*(int *)(iVar6 + 0xc) != *(int *)(param_1 + 0x48))) {
        FUN_00472fd0(uVar5);
        *(undefined4 *)(iVar6 + 0x84) = 0xffffffff;
      }
      param_2 = param_2 + 1;
    } while (param_2 < *(int *)(iVar4 + 0x38));
  }
  iVar6 = 0;
  bVar3 = false;
  if (0 < *(int *)(iVar4 + 0x24)) {
    do {
      iVar2 = *(int *)(*(int *)(iVar4 + 0x20) + iVar6 * 4);
      if (*(int *)(iVar2 + 0x84) == -1) {
        if (*(int *)(param_1 + 0x58) == 0) {
          if (!bVar3) {
            FUN_00807d70("CForestRI::UpdateBillboards(), exceeded preset limit of %d billboard cells; use CForest::SetHint(HINT_MAX_NUM_VISIBLE_CELLS) to adjust"
                         ,*(undefined4 *)(param_1 + 0xc00));
            bVar3 = true;
          }
        }
        else {
          *(undefined4 *)(iVar2 + 0x84) =
               *(undefined4 *)(*(int *)(param_1 + 0x54) + -4 + *(int *)(param_1 + 0x58) * 4);
          if (*(int *)(param_1 + 0x58) != 0) {
            *(int *)(param_1 + 0x58) = *(int *)(param_1 + 0x58) + -1;
          }
        }
      }
      iVar6 = iVar6 + 1;
    } while (iVar6 < *(int *)(iVar4 + 0x24));
  }
  iVar6 = 0;
  if (0 < *(int *)(iVar4 + 0x24)) {
    do {
      iVar2 = *(int *)(*(int *)(iVar4 + 0x20) + iVar6 * 4);
      if (*(int *)(iVar2 + 0x84) != -1) {
        FUN_00473630(param_1,iVar2);
      }
      iVar6 = iVar6 + 1;
    } while (iVar6 < *(int *)(iVar4 + 0x24));
  }
  if (*(char *)(iVar4 + 0x44) != '\0') {
    if (*(int *)(iVar4 + 0x70) != 0) {
      FUN_00473a60(iVar4 + 0x6c);
      local_8 = 0xffffffff;
      FUN_00475450();
      *(undefined4 *)(*(int *)(iVar4 + 0x80) + *(int *)(iVar4 + 0x88) * 4) =
           *(undefined4 *)(iVar4 + 0x70);
      *(int *)(iVar4 + 0x88) = *(int *)(iVar4 + 0x88) + 1;
      *(undefined4 *)(iVar4 + 0x70) = 0;
    }
    *(undefined4 *)(iVar4 + 0x74) = 0;
  }
  if ((*(int *)(iVar4 + 0x24) != 0) || (*(int *)(iVar4 + 0x38) != 0)) {
    FUN_00474890(param_1,iVar4);
  }
  ExceptionList = local_10;
  return 1;
}



============================================================
DISASSEMBLY
============================================================
00474cc0 : PUSH EBP
00474cc1 : MOV EBP,ESP
00474cc3 : PUSH -0x1
00474cc5 : PUSH 0xb82b45
00474cca : MOV EAX,FS:[0x0]
00474cd0 : PUSH EAX
00474cd1 : SUB ESP,0x8
00474cd4 : PUSH EBX
00474cd5 : PUSH ESI
00474cd6 : PUSH EDI
00474cd7 : MOV EAX,[0x00d66fa0]
00474cdc : XOR EAX,EBP
00474cde : PUSH EAX
00474cdf : LEA EAX,[EBP + -0xc]
00474ce2 : MOV FS:[0x0],EAX
00474ce8 : MOV EBX,dword ptr [EBP + 0xc]
00474ceb : MOV EAX,dword ptr [EBX + 0x38]
00474cee : XOR EDX,EDX
00474cf0 : MOV dword ptr [EBP + 0xc],EDX
00474cf3 : TEST EAX,EAX
00474cf5 : JLE 0x00474d46
00474cf7 : JMP 0x00474d00
00474d00 : MOV EAX,dword ptr [EBX + 0x34]
00474d03 : MOV EAX,dword ptr [EAX + EDX*0x4]
00474d06 : MOV ECX,dword ptr [EAX + 0x84]
00474d0c : MOV dword ptr [EBP + -0x14],EAX
00474d0f : CMP ECX,-0x1
00474d12 : JZ 0x00474d3d
00474d14 : MOV EAX,dword ptr [EAX + 0xc]
00474d17 : MOV ESI,dword ptr [EBP + 0x8]
00474d1a : CMP EAX,dword ptr [ESI + 0x48]
00474d1d : JZ 0x00474d3d
00474d1f : ADD ESI,0x50
00474d22 : LEA EDI,[EBP + -0x10]
00474d25 : MOV dword ptr [EBP + -0x10],ECX
00474d28 : CALL 0x00472fd0
00474d2d : MOV ECX,dword ptr [EBP + -0x14]
00474d30 : MOV EDX,dword ptr [EBP + 0xc]
00474d33 : MOV dword ptr [ECX + 0x84],0xffffffff
00474d3d : INC EDX
00474d3e : CMP EDX,dword ptr [EBX + 0x38]
00474d41 : MOV dword ptr [EBP + 0xc],EDX
00474d44 : JL 0x00474d00
00474d46 : XOR ESI,ESI
00474d48 : CMP dword ptr [EBX + 0x24],ESI
00474d4b : MOV byte ptr [EBP + 0xf],0x0
00474d4f : JLE 0x00474daa
00474d51 : MOV EDX,dword ptr [EBX + 0x20]
00474d54 : MOV ECX,dword ptr [EDX + ESI*0x4]
00474d57 : CMP dword ptr [ECX + 0x84],-0x1
00474d5e : JNZ 0x00474da4
00474d60 : MOV EAX,dword ptr [EBP + 0x8]
00474d63 : CMP dword ptr [EAX + 0x58],0x0
00474d67 : JZ 0x00474d86
00474d69 : MOV EDX,dword ptr [EAX + 0x58]
00474d6c : MOV EDI,dword ptr [EAX + 0x54]
00474d6f : MOV EDX,dword ptr [EDI + EDX*0x4 + -0x4]
00474d73 : MOV dword ptr [ECX + 0x84],EDX
00474d79 : MOV ECX,dword ptr [EAX + 0x58]
00474d7c : TEST ECX,ECX
00474d7e : JBE 0x00474da4
00474d80 : DEC ECX
00474d81 : MOV dword ptr [EAX + 0x58],ECX
00474d84 : JMP 0x00474da4
00474d86 : CMP byte ptr [EBP + 0xf],0x0
00474d8a : JNZ 0x00474da4
00474d8c : MOV EAX,dword ptr [EAX + 0xc00]
00474d92 : PUSH EAX
00474d93 : PUSH 0xcd5f88
00474d98 : CALL 0x00807d70
00474d9d : ADD ESP,0x8
00474da0 : MOV byte ptr [EBP + 0xf],0x1
00474da4 : INC ESI
00474da5 : CMP ESI,dword ptr [EBX + 0x24]
00474da8 : JL 0x00474d51
00474daa : XOR ESI,ESI
00474dac : OR EDI,0xffffffff
00474daf : CMP dword ptr [EBX + 0x24],ESI
00474db2 : JLE 0x00474dd2
00474db4 : MOV ECX,dword ptr [EBX + 0x20]
00474db7 : MOV EAX,dword ptr [ECX + ESI*0x4]
00474dba : CMP dword ptr [EAX + 0x84],EDI
00474dc0 : JZ 0x00474dcc
00474dc2 : MOV EDX,dword ptr [EBP + 0x8]
00474dc5 : PUSH EAX
00474dc6 : PUSH EDX
00474dc7 : CALL 0x00473630
00474dcc : INC ESI
00474dcd : CMP ESI,dword ptr [EBX + 0x24]
00474dd0 : JL 0x00474db4
00474dd2 : CMP byte ptr [EBX + 0x44],0x0
00474dd6 : JZ 0x00474e2e
00474dd8 : MOV EAX,dword ptr [EBX + 0x70]
00474ddb : LEA ESI,[EBX + 0x6c]
00474dde : TEST EAX,EAX
00474de0 : JZ 0x00474e27
00474de2 : MOV ECX,dword ptr [ESI + 0x10]
00474de5 : PUSH ESI
00474de6 : ADD ECX,EAX
00474de8 : CALL 0x00473a60
00474ded : MOV ECX,dword ptr [ESI + 0x4]
00474df0 : TEST ECX,ECX
00474df2 : JZ 0x00474dfb
00474df4 : MOV EAX,dword ptr [ESI + 0x10]
00474df7 : ADD EAX,ECX
00474df9 : JMP 0x00474dfd
00474dfb : XOR EAX,EAX
00474dfd : MOV dword ptr [EBP + 0xc],EAX
00474e00 : MOV dword ptr [EBP + -0x4],EDI
00474e03 : ADD EAX,0x4
00474e06 : MOV dword ptr [EBP + 0xc],EAX
00474e09 : MOV dword ptr [EBP + -0x4],EDI
00474e0c : MOV ECX,EAX
00474e0e : CALL 0x00475450
00474e13 : MOV EAX,dword ptr [ESI + 0x1c]
00474e16 : MOV EDX,dword ptr [ESI + 0x4]
00474e19 : MOV ECX,dword ptr [ESI + 0x14]
00474e1c : MOV dword ptr [ECX + EAX*0x4],EDX
00474e1f : INC dword ptr [ESI + 0x1c]
00474e22 : XOR EAX,EAX
00474e24 : MOV dword ptr [ESI + 0x4],EAX
00474e27 : MOV dword ptr [ESI + 0x8],0x0
00474e2e : CMP dword ptr [EBX + 0x24],0x0
00474e32 : JNZ 0x00474e3a
00474e34 : CMP dword ptr [EBX + 0x38],0x0
00474e38 : JZ 0x00474e44
00474e3a : MOV EAX,dword ptr [EBP + 0x8]
00474e3d : PUSH EBX
00474e3e : PUSH EAX
00474e3f : CALL 0x00474890
00474e44 : MOV AL,0x1
00474e46 : MOV ECX,dword ptr [EBP + -0xc]
00474e49 : MOV dword ptr FS:[0x0],ECX
00474e50 : POP ECX
00474e51 : POP EDI
00474e52 : POP ESI
00474e53 : POP EBX
00474e54 : MOV ESP,EBP
00474e56 : POP EBP
00474e57 : RET 0x8
