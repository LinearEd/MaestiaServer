PROGRAM  : Maestia.exe
FUNCTION : FUN_00876980
ENTRY    : 00876980
BODY     : [[00876980, 00876b8e]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00876980(void)

{
  int *piVar1;
  float fVar2;
  char cVar3;
  DWORD DVar4;
  int iVar5;
  int unaff_EDI;
  ushort local_c;
  
  if (*(int **)(unaff_EDI + 0x40) != (int *)0x0) {
    (**(code **)(**(int **)(unaff_EDI + 0x40) + 0x248))();
    cVar3 = (**(code **)(**(int **)(unaff_EDI + 0x40) + 0x200))();
    if (cVar3 == '\0') {
      if (*(char *)(unaff_EDI + 0x29) != '\0') {
        *(undefined1 *)(unaff_EDI + 0x29) = 0;
        FUN_00404130();
        FUN_007cc680();
        piVar1 = *(int **)(*(int *)(unaff_EDI + 0x40) + 0x3f8);
        if (piVar1 != (int *)0x0) {
          (**(code **)(*piVar1 + 0x10))(0);
          *(undefined1 *)(*(int *)(*(int *)(unaff_EDI + 0x40) + 0x3f8) + 0x2a0) = 0;
        }
        piVar1 = *(int **)(*(int *)(unaff_EDI + 0x40) + 0x400);
        if (piVar1 != (int *)0x0) {
          (**(code **)(*piVar1 + 0x10))(1);
        }
        DVar4 = timeGetTime();
        *(DWORD *)(unaff_EDI + 0x30) = DVar4;
        *(undefined1 *)(unaff_EDI + 0x2a) = 1;
        *(undefined2 *)(unaff_EDI + 0x2c) = 0;
        piVar1 = *(int **)(*(int *)(unaff_EDI + 0x40) + 1000);
        if (piVar1 != (int *)0x0) {
          (**(code **)(*piVar1 + 0x9c))(0);
        }
        iVar5 = *(int *)(unaff_EDI + 0x40);
        (**(code **)(*(int *)(*(int *)(*(int *)(iVar5 + 0x138) + 4) + 0x138 + iVar5) + 0x10))
                  (iVar5 + 0x6d8,1,0,1);
      }
      if (*(char *)(unaff_EDI + 0x2a) != '\0') {
        DVar4 = timeGetTime();
        iVar5 = DVar4 - *(int *)(unaff_EDI + 0x30);
        fVar2 = (float)iVar5;
        if (iVar5 < 0) {
          fVar2 = fVar2 + 4.2949673e+09;
        }
        iVar5 = (int)ROUND(fVar2 * 0.00033333333 * 255.0);
        local_c = (ushort)iVar5;
        *(ushort *)(unaff_EDI + 0x2c) = local_c;
        if (local_c < 0x100) {
          (**(code **)(**(int **)(unaff_EDI + 0x40) + 0x278))(1,iVar5,0);
        }
        else {
          *(undefined2 *)(unaff_EDI + 0x2c) = 0xff;
          *(undefined1 *)(unaff_EDI + 0x2a) = 0;
          (**(code **)(**(int **)(unaff_EDI + 0x40) + 0x278))(0,0xff);
          piVar1 = *(int **)(*(int *)(unaff_EDI + 0x40) + 1000);
          if (piVar1 != (int *)0x0) {
            (**(code **)(*piVar1 + 0x9c))(2);
          }
        }
      }
      if (*(char *)(unaff_EDI + 0x34) != '\0') {
        GetTickCount();
        iVar5 = FUN_0063b380();
        *(int *)(unaff_EDI + 0x38) = iVar5;
        if (iVar5 < 1) {
          *(undefined4 *)(unaff_EDI + 0x38) = 0;
          *(undefined1 *)(unaff_EDI + 0x34) = 0;
          (**(code **)(**(int **)(unaff_EDI + 0x40) + 0x278))(0,0);
          FUN_008765f0();
        }
        else {
          (**(code **)(**(int **)(unaff_EDI + 0x40) + 0x278))(1,*(undefined2 *)(unaff_EDI + 0x38),0)
          ;
        }
        FUN_008018d0(&DAT_00c43368,*(undefined4 *)(unaff_EDI + 0x38));
      }
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
00876980 : PUSH EBP
00876981 : MOV EBP,ESP
00876983 : MOV ECX,dword ptr [EDI + 0x40]
00876986 : SUB ESP,0x8
00876989 : PUSH EBX
0087698a : XOR EBX,EBX
0087698c : PUSH ESI
0087698d : CMP ECX,EBX
0087698f : JZ 0x00876b89
00876995 : MOV EAX,dword ptr [ECX]
00876997 : MOV EDX,dword ptr [EAX + 0x248]
0087699d : CALL EDX
0087699f : MOV ECX,dword ptr [EDI + 0x40]
008769a2 : MOV EAX,dword ptr [ECX]
008769a4 : MOV EDX,dword ptr [EAX + 0x200]
008769aa : CALL EDX
008769ac : TEST AL,AL
008769ae : JNZ 0x00876b89
008769b4 : CMP byte ptr [EDI + 0x29],BL
008769b7 : JZ 0x00876a60
008769bd : MOV EAX,dword ptr [EDI + 0x1c]
008769c0 : LEA ECX,[EDI + 0x44]
008769c3 : MOV byte ptr [EDI + 0x29],BL
008769c6 : CALL 0x00404130
008769cb : MOV ESI,dword ptr [EDI + 0x1c]
008769ce : LEA EAX,[EDI + 0x50]
008769d1 : CALL 0x007cc680
008769d6 : MOV EAX,dword ptr [EDI + 0x40]
008769d9 : MOV ECX,dword ptr [EAX + 0x3f8]
008769df : CMP ECX,EBX
008769e1 : JZ 0x008769fa
008769e3 : MOV EDX,dword ptr [ECX]
008769e5 : MOV EAX,dword ptr [EDX + 0x10]
008769e8 : PUSH EBX
008769e9 : CALL EAX
008769eb : MOV ECX,dword ptr [EDI + 0x40]
008769ee : MOV EDX,dword ptr [ECX + 0x3f8]
008769f4 : MOV byte ptr [EDX + 0x2a0],BL
008769fa : MOV EAX,dword ptr [EDI + 0x40]
008769fd : MOV ECX,dword ptr [EAX + 0x400]
00876a03 : CMP ECX,EBX
00876a05 : JZ 0x00876a10
00876a07 : MOV EDX,dword ptr [ECX]
00876a09 : MOV EAX,dword ptr [EDX + 0x10]
00876a0c : PUSH 0x1
00876a0e : CALL EAX
00876a10 : CALL dword ptr [0x00b85598]
00876a16 : MOV EDX,dword ptr [EDI + 0x40]
00876a19 : XOR ECX,ECX
00876a1b : MOV dword ptr [EDI + 0x30],EAX
00876a1e : MOV byte ptr [EDI + 0x2a],0x1
00876a22 : MOV word ptr [EDI + 0x2c],CX
00876a26 : MOV ECX,dword ptr [EDX + 0x3e8]
00876a2c : CMP ECX,EBX
00876a2e : JZ 0x00876a3b
00876a30 : MOV EAX,dword ptr [ECX]
00876a32 : MOV EDX,dword ptr [EAX + 0x9c]
00876a38 : PUSH EBX
00876a39 : CALL EDX
00876a3b : MOV EAX,dword ptr [EDI + 0x40]
00876a3e : MOV ECX,dword ptr [EAX + 0x138]
00876a44 : MOV EDX,dword ptr [ECX + 0x4]
00876a47 : PUSH 0x1
00876a49 : LEA ECX,[EDX + EAX*0x1 + 0x138]
00876a50 : MOV EDX,dword ptr [ECX]
00876a52 : PUSH EBX
00876a53 : ADD EAX,0x6d8
00876a58 : PUSH 0x1
00876a5a : PUSH EAX
00876a5b : MOV EAX,dword ptr [EDX + 0x10]
00876a5e : CALL EAX
00876a60 : CMP byte ptr [EDI + 0x2a],BL
00876a63 : JZ 0x00876b00
00876a69 : CALL dword ptr [0x00b85598]
00876a6f : SUB EAX,dword ptr [EDI + 0x30]
00876a72 : MOV dword ptr [EBP + -0x8],EAX
00876a75 : FILD dword ptr [EBP + -0x8]
00876a78 : TEST EAX,EAX
00876a7a : JGE 0x00876a82
00876a7c : FADD float ptr [0x00cdf0e0]
00876a82 : FMUL float ptr [0x00cdf590]
00876a88 : MOV EDX,0xff
00876a8d : FNSTCW word ptr [EBP + -0x2]
00876a90 : PUSH EBX
00876a91 : MOVZX EAX,word ptr [EBP + -0x2]
00876a95 : FMUL float ptr [0x00cdf130]
00876a9b : OR EAX,0xc00
00876aa0 : MOV dword ptr [EBP + -0x8],EAX
00876aa3 : FLDCW word ptr [EBP + -0x8]
00876aa6 : FISTP dword ptr [EBP + -0x8]
00876aa9 : MOV CX,word ptr [EBP + -0x8]
00876aad : MOV word ptr [EBP + -0x8],CX
00876ab1 : MOV EAX,dword ptr [EBP + -0x8]
00876ab4 : FLDCW word ptr [EBP + -0x2]
00876ab7 : MOV ECX,dword ptr [EDI + 0x40]
00876aba : MOV word ptr [EDI + 0x2c],AX
00876abe : CMP AX,DX
00876ac1 : JBE 0x00876af3
00876ac3 : MOV EAX,EDX
00876ac5 : MOV word ptr [EDI + 0x2c],AX
00876ac9 : MOV byte ptr [EDI + 0x2a],BL
00876acc : MOV EDX,dword ptr [ECX]
00876ace : PUSH EAX
00876acf : MOV EAX,dword ptr [EDX + 0x278]
00876ad5 : PUSH EBX
00876ad6 : CALL EAX
00876ad8 : MOV ECX,dword ptr [EDI + 0x40]
00876adb : MOV ECX,dword ptr [ECX + 0x3e8]
00876ae1 : CMP ECX,EBX
00876ae3 : JZ 0x00876b00
00876ae5 : MOV EDX,dword ptr [ECX]
00876ae7 : MOV EAX,dword ptr [EDX + 0x9c]
00876aed : PUSH 0x2
00876aef : CALL EAX
00876af1 : JMP 0x00876b00
00876af3 : MOV EDX,dword ptr [ECX]
00876af5 : PUSH EAX
00876af6 : MOV EAX,dword ptr [EDX + 0x278]
00876afc : PUSH 0x1
00876afe : CALL EAX
00876b00 : CMP byte ptr [EDI + 0x34],BL
00876b03 : JZ 0x00876b89
00876b09 : CALL dword ptr [0x00b850d8]
00876b0f : SUB EAX,dword ptr [EDI + 0x3c]
00876b12 : MOV dword ptr [EBP + -0x8],EAX
00876b15 : FILD dword ptr [EBP + -0x8]
00876b18 : TEST EAX,EAX
00876b1a : JGE 0x00876b22
00876b1c : FADD float ptr [0x00cdf0e0]
00876b22 : FMUL float ptr [0x00cdf5cc]
00876b28 : FLD float ptr [0x00cdf130]
00876b2e : FMUL ST1
00876b30 : FSUBRP
00876b32 : CALL 0x0063b380
00876b37 : CMP EAX,0x1
00876b3a : MOV ECX,dword ptr [EDI + 0x40]
00876b3d : MOV dword ptr [EDI + 0x38],EAX
00876b40 : PUSH EBX
00876b41 : JGE 0x00876b61
00876b43 : MOVZX EAX,BX
00876b46 : MOV dword ptr [EDI + 0x38],EBX
00876b49 : MOV byte ptr [EDI + 0x34],BL
00876b4c : MOV EDX,dword ptr [ECX]
00876b4e : MOV EDX,dword ptr [EDX + 0x278]
00876b54 : PUSH EAX
00876b55 : PUSH EBX
00876b56 : CALL EDX
00876b58 : MOV ESI,EDI
00876b5a : CALL 0x008765f0
00876b5f : JMP 0x00876b72
00876b61 : MOVZX EDX,word ptr [EDI + 0x38]
00876b65 : MOV EAX,dword ptr [ECX]
00876b67 : MOV EAX,dword ptr [EAX + 0x278]
00876b6d : PUSH EDX
00876b6e : PUSH 0x1
00876b70 : CALL EAX
00876b72 : MOV ECX,dword ptr [EDI + 0x38]
00876b75 : MOV ESI,dword ptr [0x00da98e8]
00876b7b : PUSH ECX
00876b7c : PUSH 0xc43368
00876b81 : CALL 0x008018d0
00876b86 : ADD ESP,0x8
00876b89 : POP ESI
00876b8a : POP EBX
00876b8b : MOV ESP,EBP
00876b8d : POP EBP
00876b8e : RET
