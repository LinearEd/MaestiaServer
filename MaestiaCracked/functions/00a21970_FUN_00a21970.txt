PROGRAM  : Maestia.exe
FUNCTION : FUN_00a21970
ENTRY    : 00a21970
BODY     : [[00a21970, 00a21b6a]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00a21970(int param_1)

{
  int *piVar1;
  char cVar2;
  short sVar3;
  uint uVar4;
  uint uVar5;
  int iVar6;
  uint uVar7;
  int *piVar8;
  undefined1 local_54 [4];
  undefined2 local_50;
  undefined4 local_40;
  uint local_3c;
  uint local_34;
  int *local_30;
  uint local_2c;
  int *local_28;
  int local_20;
  LPCRITICAL_SECTION local_1c;
  int local_18;
  void *local_10;
  undefined1 *puStack_c;
  int local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b264df;
  local_10 = ExceptionList;
  uVar4 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  if (*(int *)(param_1 + 0x70) != 0) {
    local_20 = param_1 + 0x18;
    local_1c = (LPCRITICAL_SECTION)(param_1 + 0x1c);
    EnterCriticalSection(local_1c);
    local_8 = 0;
    uVar7 = *(uint *)(param_1 + 0x6c);
    local_28 = *(int **)(param_1 + 0x54);
    local_18 = 0;
    piVar8 = local_28;
    do {
      while( true ) {
        if ((piVar8 == *(int **)(param_1 + 0x54)) &&
           (uVar7 == *(int *)(param_1 + 0x70) + *(int *)(param_1 + 0x6c))) goto LAB_00a21b46;
        uVar5 = uVar7 >> 2;
        if (piVar8 == (int *)0x0) {
          iVar6 = 0;
        }
        else {
          iVar6 = *piVar8;
        }
        if (*(uint *)(iVar6 + 0x14) <= uVar5) {
          if (piVar8 == (int *)0x0) {
            iVar6 = 0;
          }
          else {
            iVar6 = *piVar8;
          }
          uVar5 = uVar5 - *(int *)(iVar6 + 0x14);
        }
        if (piVar8 == (int *)0x0) {
          iVar6 = 0;
        }
        else {
          iVar6 = *piVar8;
        }
        piVar1 = *(int **)(*(int *)(*(int *)(iVar6 + 0x10) + uVar5 * 4) + (uVar7 & 3) * 4);
        cVar2 = (**(code **)(*piVar1 + 0x200))(uVar4);
        if ((((cVar2 == '\0') && (cVar2 = (**(code **)(*piVar1 + 0x210))(), cVar2 == '\0')) &&
            (*(int *)(param_1 + 0x14) == 0)) &&
           (cVar2 = (**(code **)(*piVar1 + 0x22c))(), cVar2 == '\0')) break;
LAB_00a21ac6:
        uVar7 = uVar7 + 1;
      }
      if (piVar1[0x50] != 0x12345679) {
        FUN_00406460(L"dangling Pointer !!");
        local_8._0_1_ = 1;
        if ((int *)*DAT_00da98e8 != (int *)0x0) {
          (**(code **)(*(int *)*DAT_00da98e8 + 0x14))
                    (L"AvaGameZone::UpdateDeleteCharQueue",0xbbd,local_54);
        }
        local_8 = (uint)local_8._1_3_ << 8;
        if (7 < local_3c) {
                    /* WARNING: Subroutine does not return */
          FUN_006f04e0();
        }
        local_3c = 7;
        local_40 = 0;
        local_50 = 0;
        goto LAB_00a21ac6;
      }
      sVar3 = (**(code **)(*piVar1 + 0x1e4))();
      if (sVar3 == 0) {
        FUN_008018d0(L"UpdateDeleteCharQueue CharKey : %d",piVar1[1]);
        piVar8 = local_28;
      }
      local_34 = uVar7;
      FUN_0043ea30(&local_30,piVar8,uVar7,piVar8,uVar7 + 1);
      uVar7 = local_2c;
      local_28 = local_30;
      (**(code **)(*(int *)(*(int *)(piVar1[0x4e] + 4) + 0x138 + (int)piVar1) + 0xc))(1);
      local_18 = local_18 + 1;
      piVar8 = local_28;
    } while (local_18 < 0x32);
LAB_00a21b46:
    local_8 = 0xffffffff;
    LeaveCriticalSection(local_1c);
  }
  ExceptionList = local_10;
  return;
}



============================================================
DISASSEMBLY
============================================================
00a21970 : PUSH EBP
00a21971 : MOV EBP,ESP
00a21973 : PUSH -0x1
00a21975 : PUSH 0xb264df
00a2197a : MOV EAX,FS:[0x0]
00a21980 : PUSH EAX
00a21981 : SUB ESP,0x48
00a21984 : PUSH EBX
00a21985 : PUSH ESI
00a21986 : PUSH EDI
00a21987 : MOV EAX,[0x00d66fa0]
00a2198c : XOR EAX,EBP
00a2198e : PUSH EAX
00a2198f : LEA EAX,[EBP + -0xc]
00a21992 : MOV FS:[0x0],EAX
00a21998 : MOV ESI,dword ptr [EBP + 0x8]
00a2199b : MOV EAX,dword ptr [ESI + 0x70]
00a2199e : XOR EDI,EDI
00a219a0 : CMP EAX,EDI
00a219a2 : JZ 0x00a21b57
00a219a8 : LEA EAX,[ESI + 0x18]
00a219ab : MOV dword ptr [EBP + -0x1c],EAX
00a219ae : ADD EAX,0x4
00a219b1 : PUSH EAX
00a219b2 : MOV dword ptr [EBP + -0x18],EAX
00a219b5 : CALL dword ptr [0x00b85118]
00a219bb : MOV dword ptr [EBP + -0x4],EDI
00a219be : MOV EBX,dword ptr [ESI + 0x6c]
00a219c1 : LEA EAX,[ESI + 0x54]
00a219c4 : MOV ESI,dword ptr [EAX]
00a219c6 : MOV dword ptr [EBP + -0x14],EDI
00a219c9 : MOV dword ptr [EBP + -0x24],ESI
00a219cc : LEA ESP,[ESP]
00a219d0 : MOV EAX,dword ptr [EBP + 0x8]
00a219d3 : MOV ECX,dword ptr [EAX + 0x70]
00a219d6 : ADD ECX,dword ptr [EAX + 0x6c]
00a219d9 : ADD EAX,0x54
00a219dc : CMP ESI,dword ptr [EAX]
00a219de : JNZ 0x00a219e8
00a219e0 : CMP EBX,ECX
00a219e2 : JZ 0x00a21b46
00a219e8 : MOV EAX,EBX
00a219ea : MOV ECX,EBX
00a219ec : SHR EAX,0x2
00a219ef : AND ECX,0x3
00a219f2 : TEST ESI,ESI
00a219f4 : JZ 0x00a219fa
00a219f6 : MOV EDX,dword ptr [ESI]
00a219f8 : JMP 0x00a219fc
00a219fa : XOR EDX,EDX
00a219fc : CMP dword ptr [EDX + 0x14],EAX
00a219ff : JA 0x00a21a0e
00a21a01 : TEST ESI,ESI
00a21a03 : JZ 0x00a21a09
00a21a05 : MOV EDX,dword ptr [ESI]
00a21a07 : JMP 0x00a21a0b
00a21a09 : XOR EDX,EDX
00a21a0b : SUB EAX,dword ptr [EDX + 0x14]
00a21a0e : TEST ESI,ESI
00a21a10 : JZ 0x00a21a16
00a21a12 : MOV EDX,dword ptr [ESI]
00a21a14 : JMP 0x00a21a18
00a21a16 : XOR EDX,EDX
00a21a18 : MOV EDX,dword ptr [EDX + 0x10]
00a21a1b : MOV EAX,dword ptr [EDX + EAX*0x4]
00a21a1e : MOV EDI,dword ptr [EAX + ECX*0x4]
00a21a21 : MOV EDX,dword ptr [EDI]
00a21a23 : MOV EAX,dword ptr [EDX + 0x200]
00a21a29 : MOV ECX,EDI
00a21a2b : CALL EAX
00a21a2d : TEST AL,AL
00a21a2f : JNZ 0x00a21ac6
00a21a35 : MOV EDX,dword ptr [EDI]
00a21a37 : MOV EAX,dword ptr [EDX + 0x210]
00a21a3d : MOV ECX,EDI
00a21a3f : CALL EAX
00a21a41 : TEST AL,AL
00a21a43 : JNZ 0x00a21ac6
00a21a49 : MOV ECX,dword ptr [EBP + 0x8]
00a21a4c : CMP dword ptr [ECX + 0x14],0x0
00a21a50 : JNZ 0x00a21ac6
00a21a52 : MOV EDX,dword ptr [EDI]
00a21a54 : MOV EAX,dword ptr [EDX + 0x22c]
00a21a5a : MOV ECX,EDI
00a21a5c : CALL EAX
00a21a5e : TEST AL,AL
00a21a60 : JNZ 0x00a21ac6
00a21a62 : CMP dword ptr [EDI + 0x140],0x12345679
00a21a6c : JZ 0x00a21acc
00a21a6e : PUSH 0xcbf9bc
00a21a73 : LEA ECX,[EBP + -0x50]
00a21a76 : CALL 0x00406460
00a21a7b : MOV byte ptr [EBP + -0x4],0x1
00a21a7f : MOV ECX,dword ptr [0x00da98e8]
00a21a85 : MOV ECX,dword ptr [ECX]
00a21a87 : TEST ECX,ECX
00a21a89 : JZ 0x00a21aa0
00a21a8b : MOV EDX,dword ptr [ECX]
00a21a8d : MOV EDX,dword ptr [EDX + 0x14]
00a21a90 : LEA EAX,[EBP + -0x50]
00a21a93 : PUSH EAX
00a21a94 : PUSH 0xbbd
00a21a99 : PUSH 0xcbfa00
00a21a9e : CALL EDX
00a21aa0 : MOV byte ptr [EBP + -0x4],0x0
00a21aa4 : CMP dword ptr [EBP + -0x38],0x8
00a21aa8 : JC 0x00a21ab2
00a21aaa : MOV ECX,dword ptr [EBP + -0x4c]
00a21aad : CALL 0x006f04e0
00a21ab2 : XOR EAX,EAX
00a21ab4 : MOV dword ptr [EBP + -0x38],0x7
00a21abb : MOV dword ptr [EBP + -0x3c],0x0
00a21ac2 : MOV word ptr [EBP + -0x4c],AX
00a21ac6 : INC EBX
00a21ac7 : JMP 0x00a219d0
00a21acc : MOV EDX,dword ptr [EDI]
00a21ace : MOV EAX,dword ptr [EDX + 0x1e4]
00a21ad4 : MOV ECX,EDI
00a21ad6 : CALL EAX
00a21ad8 : TEST AX,AX
00a21adb : JNZ 0x00a21af7
00a21add : MOV EAX,dword ptr [EDI + 0x4]
00a21ae0 : MOV ESI,dword ptr [0x00da98e8]
00a21ae6 : PUSH EAX
00a21ae7 : PUSH 0xcbfa48
00a21aec : CALL 0x008018d0
00a21af1 : MOV ESI,dword ptr [EBP + -0x24]
00a21af4 : ADD ESP,0x8
00a21af7 : LEA EAX,[EBX + 0x1]
00a21afa : PUSH EAX
00a21afb : MOV EAX,dword ptr [EBP + 0x8]
00a21afe : PUSH ESI
00a21aff : PUSH EBX
00a21b00 : PUSH ESI
00a21b01 : LEA ECX,[EBP + -0x2c]
00a21b04 : PUSH ECX
00a21b05 : ADD EAX,0x54
00a21b08 : MOV dword ptr [EBP + -0x30],EBX
00a21b0b : CALL 0x0043ea30
00a21b10 : MOV EAX,dword ptr [EDI + 0x138]
00a21b16 : MOV ECX,dword ptr [EAX + 0x4]
00a21b19 : MOV EDX,dword ptr [EBP + -0x2c]
00a21b1c : MOV EBX,dword ptr [EBP + -0x28]
00a21b1f : LEA ECX,[ECX + EDI*0x1 + 0x138]
00a21b26 : MOV dword ptr [EBP + -0x24],EDX
00a21b29 : MOV EDX,dword ptr [ECX]
00a21b2b : MOV EAX,dword ptr [EDX + 0xc]
00a21b2e : PUSH 0x1
00a21b30 : CALL EAX
00a21b32 : MOV EAX,dword ptr [EBP + -0x14]
00a21b35 : INC EAX
00a21b36 : CMP EAX,0x32
00a21b39 : MOV dword ptr [EBP + -0x14],EAX
00a21b3c : JGE 0x00a21b46
00a21b3e : MOV ESI,dword ptr [EBP + -0x24]
00a21b41 : JMP 0x00a219d0
00a21b46 : MOV dword ptr [EBP + -0x4],0xffffffff
00a21b4d : MOV ECX,dword ptr [EBP + -0x18]
00a21b50 : PUSH ECX
00a21b51 : CALL dword ptr [0x00b8511c]
00a21b57 : MOV ECX,dword ptr [EBP + -0xc]
00a21b5a : MOV dword ptr FS:[0x0],ECX
00a21b61 : POP ECX
00a21b62 : POP EDI
00a21b63 : POP ESI
00a21b64 : POP EBX
00a21b65 : MOV ESP,EBP
00a21b67 : POP EBP
00a21b68 : RET 0x4
