PROGRAM  : Maestia.exe
FUNCTION : FUN_006bbc30
ENTRY    : 006bbc30
BODY     : [[006bbc30, 006bbd1c] [006bbd20, 006bbdef]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_006bbc30(int param_1)

{
  ushort *puVar1;
  ushort uVar2;
  short *psVar3;
  int in_EAX;
  int iVar4;
  short *psVar5;
  uint uVar6;
  undefined4 uVar7;
  ushort uVar8;
  uint uVar9;
  int iVar10;
  uint uVar11;
  ushort *puVar12;
  short *psVar13;
  
  puVar12 = *(ushort **)(in_EAX + 0x20);
  puVar1 = puVar12 + *(int *)(in_EAX + 0x1c) * 0x14;
  iVar4 = in_EAX + 0x30 + param_1 * 0x1c;
  psVar3 = *(short **)(iVar4 + 0x14);
  psVar13 = psVar3 + *(int *)(iVar4 + 0xc) * 0x18;
  uVar8 = (-(ushort)(param_1 != 0) & 0x40) + 0x40;
  if (psVar3 < psVar13) {
    for (; puVar12 < puVar1; puVar12 = puVar12 + 0x14) {
      uVar2 = *puVar12;
      if (((uVar8 & uVar2) == 0) && (((uVar2 & 0x100) == 0 || ((uVar2 & 0x200) != 0)))) {
        if (param_1 == 1) {
          uVar2 = puVar12[7];
          iVar4 = *(int *)(puVar12 + 4);
        }
        else {
          uVar2 = puVar12[6];
          iVar4 = *(int *)(puVar12 + 2);
        }
        iVar10 = (int)(short)uVar2;
        if (*psVar3 - iVar10 < 0) {
          if (iVar10 - psVar13[-0x18] < 0) {
            uVar9 = ((int)psVar13 - (int)psVar3) / 0x30;
            uVar11 = 0;
            if (uVar9 < 9) {
              psVar5 = psVar3;
              if (uVar9 != 0) {
                do {
                  if (iVar10 <= *psVar5) break;
                  uVar11 = uVar11 + 1;
                  psVar5 = psVar5 + 0x18;
                } while (uVar11 < uVar9);
              }
              if (psVar3[uVar11 * 0x18] == iVar10) {
                iVar4 = *(int *)(psVar3 + uVar11 * 0x18 + 4);
                goto LAB_006bbdb8;
              }
            }
            else if (uVar9 != 0) {
              do {
                uVar6 = uVar9 + uVar11 >> 1;
                if (psVar3[uVar6 * 0x18] <= iVar10) {
                  if (iVar10 <= psVar3[uVar6 * 0x18]) {
                    iVar4 = *(int *)(psVar3 + uVar6 * 0x18 + 4);
                    goto LAB_006bbdb8;
                  }
                  uVar11 = uVar6 + 1;
                  uVar6 = uVar9;
                }
                uVar9 = uVar6;
              } while (uVar11 < uVar6);
            }
            psVar5 = psVar3 + uVar11 * 0x18;
            if (*(int *)(psVar3 + uVar11 * 0x18 + -0x10) == 0) {
              uVar7 = FUN_00685f30(*(int *)(psVar5 + 4) - *(int *)(psVar5 + -0x14),
                                   (int)*psVar5 - (int)psVar5[-0x18]);
              *(undefined4 *)(psVar5 + -0x10) = uVar7;
            }
            iVar4 = FUN_00685ea0(iVar10 - psVar5[-0x18],*(undefined4 *)(psVar5 + -0x10));
            iVar4 = iVar4 + *(int *)(psVar5 + -0x14);
          }
          else {
            iVar4 = (*(int *)(psVar13 + -0x14) - *(int *)(psVar13 + -0x16)) + iVar4;
          }
        }
        else {
          iVar4 = (*(int *)(psVar3 + 4) - *(int *)(psVar3 + 2)) + iVar4;
        }
LAB_006bbdb8:
        if (param_1 == 0) {
          *(int *)(puVar12 + 8) = iVar4;
        }
        else {
          *(int *)(puVar12 + 10) = iVar4;
        }
        *puVar12 = *puVar12 | uVar8;
      }
    }
  }
  return;
}



============================================================
DISASSEMBLY
============================================================
006bbc30 : SUB ESP,0x14
006bbc33 : MOV ECX,dword ptr [EAX + 0x1c]
006bbc36 : MOV EDX,dword ptr [EAX + 0x20]
006bbc39 : LEA ECX,[ECX + ECX*0x4]
006bbc3c : LEA ECX,[EDX + ECX*0x8]
006bbc3f : MOV dword ptr [ESP + 0x10],ECX
006bbc43 : PUSH EBX
006bbc44 : MOV EBX,dword ptr [ESP + 0x1c]
006bbc48 : LEA ECX,[EBX*0x8 + 0x0]
006bbc4f : SUB ECX,EBX
006bbc51 : LEA EAX,[EAX + ECX*0x4 + 0x30]
006bbc55 : PUSH EBP
006bbc56 : MOV EBP,dword ptr [EAX + 0x14]
006bbc59 : MOV EAX,dword ptr [EAX + 0xc]
006bbc5c : PUSH EDI
006bbc5d : LEA EDI,[EAX + EAX*0x2]
006bbc60 : SHL EDI,0x4
006bbc63 : ADD EDI,EBP
006bbc65 : MOV ECX,EBX
006bbc67 : NEG ECX
006bbc69 : SBB ECX,ECX
006bbc6b : AND ECX,0x40
006bbc6e : ADD ECX,0x40
006bbc71 : MOV dword ptr [ESP + 0x18],EDI
006bbc75 : MOV dword ptr [ESP + 0x10],ECX
006bbc79 : CMP EBP,EDI
006bbc7b : JNC 0x006bbde9
006bbc81 : PUSH ESI
006bbc82 : MOV ESI,EDX
006bbc84 : MOV dword ptr [ESP + 0x10],EDX
006bbc88 : CMP EDX,dword ptr [ESP + 0x20]
006bbc8c : JNC 0x006bbde8
006bbc92 : MOVZX EAX,word ptr [ESI]
006bbc95 : MOVZX EDX,AX
006bbc98 : TEST ECX,EDX
006bbc9a : JNZ 0x006bbdd7
006bbca0 : TEST EAX,0x100
006bbca5 : JZ 0x006bbcb2
006bbca7 : TEST EAX,0x200
006bbcac : JZ 0x006bbdd7
006bbcb2 : CMP EBX,0x1
006bbcb5 : JNZ 0x006bbcc0
006bbcb7 : MOVSX EBX,word ptr [ESI + 0xe]
006bbcbb : MOV EDX,dword ptr [ESI + 0x8]
006bbcbe : JMP 0x006bbcc7
006bbcc0 : MOVSX EBX,word ptr [ESI + 0xc]
006bbcc4 : MOV EDX,dword ptr [ESI + 0x4]
006bbcc7 : MOVSX EAX,word ptr [EBP]
006bbccb : SUB EAX,EBX
006bbccd : MOV dword ptr [ESP + 0x18],EDX
006bbcd1 : JS 0x006bbce0
006bbcd3 : MOV EAX,dword ptr [EBP + 0x8]
006bbcd6 : SUB EAX,dword ptr [EBP + 0x4]
006bbcd9 : ADD EAX,EDX
006bbcdb : JMP 0x006bbdb8
006bbce0 : MOVSX EDX,word ptr [EDI + -0x30]
006bbce4 : MOV EAX,EBX
006bbce6 : SUB EAX,EDX
006bbce8 : JS 0x006bbcf9
006bbcea : MOV EAX,dword ptr [EDI + -0x28]
006bbced : SUB EAX,dword ptr [EDI + -0x2c]
006bbcf0 : ADD EAX,dword ptr [ESP + 0x18]
006bbcf4 : JMP 0x006bbdb8
006bbcf9 : MOV ECX,EDI
006bbcfb : SUB ECX,EBP
006bbcfd : MOV EAX,0x2aaaaaab
006bbd02 : IMUL ECX
006bbd04 : SAR EDX,0x3
006bbd07 : MOV ECX,EDX
006bbd09 : SHR ECX,0x1f
006bbd0c : ADD ECX,EDX
006bbd0e : XOR ESI,ESI
006bbd10 : CMP ECX,0x8
006bbd13 : JA 0x006bbd44
006bbd15 : TEST ECX,ECX
006bbd17 : JBE 0x006bbd2f
006bbd19 : MOV EAX,EBP
006bbd1b : JMP 0x006bbd20
006bbd20 : MOVSX EDX,word ptr [EAX]
006bbd23 : CMP EDX,EBX
006bbd25 : JGE 0x006bbd2f
006bbd27 : INC ESI
006bbd28 : ADD EAX,0x30
006bbd2b : CMP ESI,ECX
006bbd2d : JC 0x006bbd20
006bbd2f : LEA EAX,[ESI + ESI*0x2]
006bbd32 : SHL EAX,0x4
006bbd35 : MOVSX ECX,word ptr [EAX + EBP*0x1]
006bbd39 : ADD EAX,EBP
006bbd3b : CMP ECX,EBX
006bbd3d : JNZ 0x006bbd6e
006bbd3f : MOV EAX,dword ptr [EAX + 0x8]
006bbd42 : JMP 0x006bbdb0
006bbd44 : TEST ECX,ECX
006bbd46 : JBE 0x006bbd6e
006bbd48 : LEA EAX,[ECX + ESI*0x1]
006bbd4b : SHR EAX,0x1
006bbd4d : LEA EDX,[EAX + EAX*0x2]
006bbd50 : SHL EDX,0x4
006bbd53 : MOVSX EDI,word ptr [EDX + EBP*0x1]
006bbd57 : ADD EDX,EBP
006bbd59 : CMP EBX,EDI
006bbd5b : JGE 0x006bbd61
006bbd5d : MOV ECX,EAX
006bbd5f : JMP 0x006bbd66
006bbd61 : JLE 0x006bbdc4
006bbd63 : LEA ESI,[EAX + 0x1]
006bbd66 : CMP ESI,ECX
006bbd68 : JC 0x006bbd48
006bbd6a : MOV EDI,dword ptr [ESP + 0x1c]
006bbd6e : LEA EDX,[ESI + ESI*0x2]
006bbd71 : SHL EDX,0x4
006bbd74 : CMP dword ptr [EDX + EBP*0x1 + -0x20],0x0
006bbd79 : LEA ESI,[EDX + EBP*0x1]
006bbd7c : JNZ 0x006bbd9a
006bbd7e : MOVSX EAX,word ptr [ESI]
006bbd81 : MOVSX ECX,word ptr [ESI + -0x30]
006bbd85 : MOV EDX,dword ptr [ESI + 0x8]
006bbd88 : SUB EDX,dword ptr [ESI + -0x28]
006bbd8b : SUB EAX,ECX
006bbd8d : PUSH EAX
006bbd8e : PUSH EDX
006bbd8f : CALL 0x00685f30
006bbd94 : ADD ESP,0x8
006bbd97 : MOV dword ptr [ESI + -0x20],EAX
006bbd9a : MOVSX ECX,word ptr [ESI + -0x30]
006bbd9e : MOV EAX,dword ptr [ESI + -0x20]
006bbda1 : PUSH EAX
006bbda2 : SUB EBX,ECX
006bbda4 : PUSH EBX
006bbda5 : CALL 0x00685ea0
006bbdaa : ADD ESP,0x8
006bbdad : ADD EAX,dword ptr [ESI + -0x28]
006bbdb0 : MOV ESI,dword ptr [ESP + 0x10]
006bbdb4 : MOV ECX,dword ptr [ESP + 0x14]
006bbdb8 : CMP dword ptr [ESP + 0x28],0x0
006bbdbd : JNZ 0x006bbdcd
006bbdbf : MOV dword ptr [ESI + 0x10],EAX
006bbdc2 : JMP 0x006bbdd0
006bbdc4 : MOV EAX,dword ptr [EDX + 0x8]
006bbdc7 : MOV EDI,dword ptr [ESP + 0x1c]
006bbdcb : JMP 0x006bbdb0
006bbdcd : MOV dword ptr [ESI + 0x14],EAX
006bbdd0 : OR word ptr [ESI],CX
006bbdd3 : MOV EBX,dword ptr [ESP + 0x28]
006bbdd7 : ADD ESI,0x28
006bbdda : MOV dword ptr [ESP + 0x10],ESI
006bbdde : CMP ESI,dword ptr [ESP + 0x20]
006bbde2 : JC 0x006bbc92
006bbde8 : POP ESI
006bbde9 : POP EDI
006bbdea : POP EBP
006bbdeb : POP EBX
006bbdec : ADD ESP,0x14
006bbdef : RET
