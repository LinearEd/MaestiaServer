PROGRAM  : Maestia.exe
FUNCTION : FUN_005f6d70
ENTRY    : 005f6d70
BODY     : [[005f6d70, 005f6faa]]

============================================================
DECOMPILED C CODE
============================================================

int FUN_005f6d70(uint param_1,uint param_2,int *param_3)

{
  int iVar1;
  uint *puVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  byte bVar6;
  int iVar7;
  int iVar8;
  uint uVar9;
  int iVar10;
  byte bVar11;
  int *in_ECX;
  uint uVar12;
  uint uVar13;
  
  iVar3 = *in_ECX;
  bVar11 = (byte)iVar3;
  iVar7 = FUN_005a82f0(param_1 >> (bVar11 & 0x1f),iVar3,param_2 - 1);
  if (iVar7 != 0) {
    iVar4 = *(int *)(iVar7 + 8);
    iVar5 = *(int *)(iVar4 + 0x1c);
    iVar1 = iVar4 + 0x20;
    iVar8 = FUN_005a79f0(iVar7,param_2 - 1);
    uVar9 = (uint)*(ushort *)(iVar7 + 0xc);
    if (0x20 < uVar9) {
      uVar9 = *(uint *)(iVar7 + 0x10);
    }
    uVar9 = (((uVar9 << (bVar11 & 0x1f)) - iVar8) - param_1) + iVar7;
    if (iVar8 - iVar7 != 0) {
      uVar12 = (uint)(iVar8 - iVar7) >> (bVar11 & 0x1f);
      iVar10 = uVar12 << (bVar11 & 0x1f);
      if (uVar12 < 0x21) {
        *(short *)(iVar10 + -2 + iVar7) = (short)uVar12;
        *(short *)(iVar7 + 0xc) = (short)uVar12;
      }
      else {
        *(undefined2 *)(iVar10 + -2 + iVar7) = 0x21;
        *(undefined2 *)(iVar7 + 0xc) = 0x21;
        *(uint *)(iVar10 + -8 + iVar7) = uVar12;
        *(uint *)(iVar7 + 0x10) = uVar12;
      }
      *(int *)(iVar7 + 8) = iVar4;
      FUN_005a7f80(iVar7);
      uVar13 = iVar7 - iVar5 >> (bVar11 & 0x1f);
      puVar2 = (uint *)(iVar1 + (uVar13 >> 4) * 4);
      *puVar2 = *puVar2 & ~(3 << ((char)uVar13 * '\x02' & 0x1eU));
      uVar13 = (uVar12 - 1) + uVar13;
      puVar2 = (uint *)(iVar1 + (uVar13 >> 4) * 4);
      *puVar2 = *puVar2 & ~(3 << ((char)uVar13 * '\x02' & 0x1eU));
    }
    if (uVar9 < 0x10) {
      param_1 = param_1 + uVar9;
    }
    else {
      uVar9 = uVar9 >> (bVar11 & 0x1f);
      iVar7 = iVar8 + param_1;
      iVar10 = uVar9 << (bVar11 & 0x1f);
      if (uVar9 < 0x21) {
        *(short *)(iVar10 + -2 + iVar7) = (short)uVar9;
        *(short *)(iVar7 + 0xc) = (short)uVar9;
      }
      else {
        *(undefined2 *)(iVar10 + -2 + iVar7) = 0x21;
        *(undefined2 *)(iVar7 + 0xc) = 0x21;
        *(uint *)(iVar10 + -8 + iVar7) = uVar9;
        *(uint *)(iVar7 + 0x10) = uVar9;
      }
      *(int *)(iVar7 + 8) = iVar4;
      FUN_005a7f80(iVar7);
      uVar12 = (int)((iVar8 - iVar5) + param_1) >> (bVar11 & 0x1f);
      puVar2 = (uint *)(iVar1 + (uVar12 >> 4) * 4);
      uVar9 = (uVar9 - 1) + uVar12;
      *puVar2 = *puVar2 & ~(3 << ((char)uVar12 * '\x02' & 0x1eU));
      puVar2 = (uint *)(iVar1 + (uVar9 >> 4) * 4);
      *puVar2 = *puVar2 & ~(3 << ((char)uVar9 * '\x02' & 0x1eU));
    }
    if ((param_2 & 0xffff0000) == 0) {
      if ((param_2 & 0xff00) == 0) {
        bVar6 = *(byte *)((int)&PTR_DAT_00b94fc8 + (param_2 & 0xff));
      }
      else {
        bVar6 = *(char *)((int)&PTR_DAT_00b94fc8 + (param_2 >> 8 & 0xff)) + 8;
      }
    }
    else if ((param_2 & 0xff000000) == 0) {
      bVar6 = *(char *)((int)&PTR_DAT_00b94fc8 + (param_2 >> 0x10 & 0xff)) + 0x10;
    }
    else {
      bVar6 = *(char *)((int)&PTR_DAT_00b94fc8 + (param_2 >> 0x18)) + 0x18;
    }
    FUN_005f6640(iVar1,iVar8 - iVar5 >> (bVar11 & 0x1f),param_1 >> (bVar11 & 0x1f),
                 (uint)bVar6 - iVar3);
    *param_3 = iVar4;
    return iVar8;
  }
  return 0;
}



============================================================
DISASSEMBLY
============================================================
005f6d70 : SUB ESP,0x14
005f6d73 : MOV EAX,dword ptr [ESP + 0x1c]
005f6d77 : PUSH EBX
005f6d78 : MOV EBX,dword ptr [ESP + 0x1c]
005f6d7c : PUSH ESI
005f6d7d : PUSH EDI
005f6d7e : MOV EDI,dword ptr [ECX]
005f6d80 : DEC EAX
005f6d81 : PUSH EAX
005f6d82 : LEA EDX,[ECX + 0x8]
005f6d85 : MOV ECX,EDI
005f6d87 : MOV EAX,EBX
005f6d89 : SHR EAX,CL
005f6d8b : PUSH EDI
005f6d8c : MOV ECX,EDX
005f6d8e : MOV dword ptr [ESP + 0x20],EDX
005f6d92 : PUSH EAX
005f6d93 : CALL 0x005a82f0
005f6d98 : MOV ESI,EAX
005f6d9a : TEST ESI,ESI
005f6d9c : JZ 0x005f6fa0
005f6da2 : MOV EAX,dword ptr [ESI + 0x8]
005f6da5 : MOV ECX,dword ptr [EAX + 0x1c]
005f6da8 : PUSH EBP
005f6da9 : MOV dword ptr [ESP + 0x18],EAX
005f6dad : LEA EBP,[EAX + 0x20]
005f6db0 : MOV EAX,dword ptr [ESP + 0x2c]
005f6db4 : DEC EAX
005f6db5 : PUSH EAX
005f6db6 : PUSH ESI
005f6db7 : MOV dword ptr [ESP + 0x1c],ECX
005f6dbb : CALL 0x005a79f0
005f6dc0 : MOV EDX,EAX
005f6dc2 : MOV dword ptr [ESP + 0x18],EAX
005f6dc6 : MOVZX EAX,word ptr [ESI + 0xc]
005f6dca : ADD ESP,0x8
005f6dcd : SUB EDX,ESI
005f6dcf : CMP EAX,0x21
005f6dd2 : JC 0x005f6dd7
005f6dd4 : MOV EAX,dword ptr [ESI + 0x10]
005f6dd7 : MOV ECX,EDI
005f6dd9 : SHL EAX,CL
005f6ddb : SUB EAX,dword ptr [ESP + 0x10]
005f6ddf : SUB EAX,EBX
005f6de1 : ADD EAX,ESI
005f6de3 : MOV dword ptr [ESP + 0x20],EAX
005f6de7 : TEST EDX,EDX
005f6de9 : JZ 0x005f6e77
005f6def : MOV EBX,EDX
005f6df1 : SHR EBX,CL
005f6df3 : MOV EAX,EBX
005f6df5 : SHL EAX,CL
005f6df7 : CMP EBX,0x21
005f6dfa : JNC 0x005f6e07
005f6dfc : MOV word ptr [EAX + ESI*0x1 + -0x2],BX
005f6e01 : MOV word ptr [ESI + 0xc],BX
005f6e05 : JMP 0x005f6e1e
005f6e07 : MOV EDX,0x21
005f6e0c : MOV word ptr [EAX + ESI*0x1 + -0x2],DX
005f6e11 : MOV ECX,EDX
005f6e13 : MOV word ptr [ESI + 0xc],CX
005f6e17 : MOV dword ptr [EAX + ESI*0x1 + -0x8],EBX
005f6e1b : MOV dword ptr [ESI + 0x10],EBX
005f6e1e : MOV EDX,dword ptr [ESP + 0x18]
005f6e22 : MOV ECX,dword ptr [ESP + 0x1c]
005f6e26 : PUSH ESI
005f6e27 : MOV dword ptr [ESI + 0x8],EDX
005f6e2a : CALL 0x005a7f80
005f6e2f : SUB ESI,dword ptr [ESP + 0x14]
005f6e33 : MOV ECX,EDI
005f6e35 : SAR ESI,CL
005f6e37 : MOV EDX,0x3
005f6e3c : LEA ECX,[ESI + ESI*0x1]
005f6e3f : AND ECX,0x1e
005f6e42 : SHL EDX,CL
005f6e44 : MOV EAX,ESI
005f6e46 : SHR EAX,0x4
005f6e49 : LEA EAX,[EBP + EAX*0x4]
005f6e4d : NOT EDX
005f6e4f : AND dword ptr [EAX],EDX
005f6e51 : LEA ESI,[EBX + ESI*0x1 + -0x1]
005f6e55 : MOV EBX,dword ptr [ESP + 0x28]
005f6e59 : LEA ECX,[ESI + ESI*0x1]
005f6e5c : AND ECX,0x1e
005f6e5f : MOV EDX,0x3
005f6e64 : SHL EDX,CL
005f6e66 : MOV EAX,ESI
005f6e68 : SHR EAX,0x4
005f6e6b : LEA EAX,[EBP + EAX*0x4]
005f6e6f : NOT EDX
005f6e71 : AND dword ptr [EAX],EDX
005f6e73 : MOV EAX,dword ptr [ESP + 0x20]
005f6e77 : CMP EAX,0x10
005f6e7a : JC 0x005f6f12
005f6e80 : MOV ESI,EAX
005f6e82 : MOV EAX,dword ptr [ESP + 0x10]
005f6e86 : MOV ECX,EDI
005f6e88 : SHR ESI,CL
005f6e8a : ADD EAX,EBX
005f6e8c : MOV EDX,ESI
005f6e8e : SHL EDX,CL
005f6e90 : CMP ESI,0x21
005f6e93 : JNC 0x005f6ea0
005f6e95 : MOV word ptr [EDX + EAX*0x1 + -0x2],SI
005f6e9a : MOV word ptr [EAX + 0xc],SI
005f6e9e : JMP 0x005f6eb5
005f6ea0 : MOV ECX,0x21
005f6ea5 : MOV word ptr [EDX + EAX*0x1 + -0x2],CX
005f6eaa : MOV word ptr [EAX + 0xc],CX
005f6eae : MOV dword ptr [EDX + EAX*0x1 + -0x8],ESI
005f6eb2 : MOV dword ptr [EAX + 0x10],ESI
005f6eb5 : MOV EDX,dword ptr [ESP + 0x18]
005f6eb9 : MOV ECX,dword ptr [ESP + 0x1c]
005f6ebd : PUSH EAX
005f6ebe : MOV dword ptr [EAX + 0x8],EDX
005f6ec1 : CALL 0x005a7f80
005f6ec6 : MOV EAX,dword ptr [ESP + 0x10]
005f6eca : SUB EAX,dword ptr [ESP + 0x14]
005f6ece : MOV ECX,EDI
005f6ed0 : ADD EAX,EBX
005f6ed2 : SAR EAX,CL
005f6ed4 : MOV EBX,0x3
005f6ed9 : MOV ECX,EAX
005f6edb : SHR ECX,0x4
005f6ede : LEA EDX,[EBP + ECX*0x4]
005f6ee2 : LEA ECX,[EAX + EAX*0x1]
005f6ee5 : AND ECX,0x1e
005f6ee8 : SHL EBX,CL
005f6eea : LEA EAX,[ESI + EAX*0x1 + -0x1]
005f6eee : LEA ECX,[EAX + EAX*0x1]
005f6ef1 : AND ECX,0x1e
005f6ef4 : NOT EBX
005f6ef6 : AND dword ptr [EDX],EBX
005f6ef8 : MOV EBX,dword ptr [ESP + 0x28]
005f6efc : MOV EDX,EAX
005f6efe : MOV EAX,0x3
005f6f03 : SHL EAX,CL
005f6f05 : SHR EDX,0x4
005f6f08 : LEA EDX,[EBP + EDX*0x4]
005f6f0c : NOT EAX
005f6f0e : AND dword ptr [EDX],EAX
005f6f10 : JMP 0x005f6f14
005f6f12 : ADD EBX,EAX
005f6f14 : MOV EAX,dword ptr [ESP + 0x2c]
005f6f18 : TEST EAX,0xffff0000
005f6f1d : JZ 0x005f6f45
005f6f1f : TEST EAX,0xff000000
005f6f24 : JZ 0x005f6f33
005f6f26 : SHR EAX,0x18
005f6f29 : MOV AL,byte ptr [EAX + 0xb94fc8]
005f6f2f : ADD AL,0x18
005f6f31 : JMP 0x005f6f69
005f6f33 : SHR EAX,0x10
005f6f36 : AND EAX,0xff
005f6f3b : MOV AL,byte ptr [EAX + 0xb94fc8]
005f6f41 : ADD AL,0x10
005f6f43 : JMP 0x005f6f69
005f6f45 : TEST EAX,0xff00
005f6f4a : JZ 0x005f6f5e
005f6f4c : SHR EAX,0x8
005f6f4f : AND EAX,0xff
005f6f54 : MOV AL,byte ptr [EAX + 0xb94fc8]
005f6f5a : ADD AL,0x8
005f6f5c : JMP 0x005f6f69
005f6f5e : AND EAX,0xff
005f6f63 : MOV AL,byte ptr [EAX + 0xb94fc8]
005f6f69 : MOV EDX,dword ptr [ESP + 0x10]
005f6f6d : SUB EDX,dword ptr [ESP + 0x14]
005f6f71 : MOVZX ECX,AL
005f6f74 : SUB ECX,EDI
005f6f76 : PUSH ECX
005f6f77 : MOV ECX,EDI
005f6f79 : SHR EBX,CL
005f6f7b : SAR EDX,CL
005f6f7d : PUSH EBX
005f6f7e : PUSH EDX
005f6f7f : PUSH EBP
005f6f80 : CALL 0x005f6640
005f6f85 : MOV EAX,dword ptr [ESP + 0x40]
005f6f89 : MOV ECX,dword ptr [ESP + 0x28]
005f6f8d : ADD ESP,0x10
005f6f90 : POP EBP
005f6f91 : POP EDI
005f6f92 : POP ESI
005f6f93 : MOV dword ptr [EAX],ECX
005f6f95 : MOV EAX,dword ptr [ESP + 0x4]
005f6f99 : POP EBX
005f6f9a : ADD ESP,0x14
005f6f9d : RET 0xc
005f6fa0 : POP EDI
005f6fa1 : POP ESI
005f6fa2 : XOR EAX,EAX
005f6fa4 : POP EBX
005f6fa5 : ADD ESP,0x14
005f6fa8 : RET 0xc
