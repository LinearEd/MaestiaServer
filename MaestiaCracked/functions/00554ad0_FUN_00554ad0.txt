PROGRAM  : Maestia.exe
FUNCTION : FUN_00554ad0
ENTRY    : 00554ad0
BODY     : [[00554ad0, 00554e2a]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00554ad0(int *param_1,char param_2,int param_3)

{
  uint *puVar1;
  uint uVar2;
  uint uVar3;
  int iVar4;
  int *in_ECX;
  undefined4 uVar5;
  undefined4 uVar6;
  GRefCountNTSImpl *this;
  float fVar7;
  float local_78;
  char local_72;
  undefined1 local_71;
  float local_70;
  undefined4 local_6c;
  uint local_68;
  int *local_64;
  int local_60;
  int *local_5c;
  undefined1 local_58;
  char local_57;
  undefined1 local_56;
  uint local_4;
  
  local_4 = DAT_00d66fa0 ^ (uint)&local_78;
  puVar1 = (uint *)*param_1;
  local_6c = *(undefined4 *)(puVar1[6] + 0x14);
  uVar2 = *puVar1;
  local_64 = param_1;
  local_60 = param_3;
  if (((((*(byte *)(uVar2 + 0x14) & 0x10) == 0) || ((*(uint *)(uVar2 + 0x1c) & 0x100) == 0)) ||
      (((*(uint *)(uVar2 + 0x1c) >> 9 & 1) == 0 && ((*(byte *)(in_ECX + 9) & 1) != 0)))) ||
     ((param_2 != '\0' || (local_72 = '\x01', puVar1[0x13] != 0)))) {
    local_72 = '\0';
  }
  this = (GRefCountNTSImpl *)0x0;
  local_68 = uVar2;
  local_5c = in_ECX;
  if ((((*(byte *)(in_ECX + 9) & 0x80) != 0) && (param_3 != 0)) &&
     ((*(byte *)(param_3 + 0x66) & 1) != 0)) {
    local_70 = (float)puVar1[9];
    local_78 = *(float *)(uVar2 + 0x10) * local_70;
    this = (GRefCountNTSImpl *)FUN_0051d4a0(local_78);
  }
  if (((in_ECX[8] != 0) && (this == (GRefCountNTSImpl *)0x0)) &&
     (local_72 == *(char *)(in_ECX[8] + 0x15))) {
    FUN_005dbc40(param_1,0);
    __security_check_cookie(local_4 ^ (uint)&local_78);
    return;
  }
  fVar7 = GMatrix2D::GetMaxScale((GMatrix2D *)(param_1 + 3));
  local_78 = ABS(fVar7);
  if (1e-06 <= local_78) {
    local_71 = 1.0 <= ABS((float)param_1[0x10]);
    local_78 = ABS((float)param_1[0xf]);
    if (((0.001 <= local_78) || ((bool)local_71)) || (*(int *)(*param_1 + 0x4c) != 0)) {
      local_70 = fVar7 * *(float *)(*param_1 + 0x24);
      uVar3 = ((*(uint *)(uVar2 + 0x14) >> 5 & 1) * 2 | (uint)(byte)local_71) * 2 |
              (uint)(local_72 != '\0');
      if (this == (GRefCountNTSImpl *)0x0) {
        local_58 = (undefined1)uVar3;
        if (local_72 == '\0') {
          local_57 = (char)(((uint)local_70 >> 0x17 & 0xff) - 0x40 >> 1);
        }
        else {
          local_57 = (char)((uint)(local_70 * 0.841 * local_70 * 0.841) >> 0x17) + -0x40;
        }
        local_78 = *(float *)(uVar2 + 0x10);
        uVar6 = 3;
        local_56 = (undefined1)(((uint)local_78 >> 0x17 & 0xff) - 0x40 >> 1);
        uVar5 = 0;
      }
      else {
        FUN_005530a0(&local_58,0,uVar3);
        uVar6 = 0x54;
        uVar5 = 1;
      }
      iVar4 = FUN_005d9780(in_ECX,local_60,uVar5,&local_58,uVar6);
      uVar2 = local_68;
      if (iVar4 == 0) {
        local_70 = 20.0 / local_70;
        local_78 = local_70 * 0.75 * *(float *)(local_68 + 0x10);
        iVar4 = FUN_00515840(0x70,0);
        if (iVar4 == 0) {
          iVar4 = 0;
        }
        else {
          local_68 = CONCAT31(local_68._1_3_,(char)(*(uint *)(uVar2 + 0x14) >> 5)) & 0xffffff01;
          iVar4 = FUN_005dc3f0(local_70,local_78,local_72 == '\0',local_68);
        }
        *(undefined1 *)(iVar4 + 0x17) = local_71;
        (**(code **)(*local_5c + 0x10))(iVar4,local_78,*local_64,this);
        FUN_005da060(uVar5,&local_58,uVar6,local_60);
        FUN_005dbc40(local_64,this != (GRefCountNTSImpl *)0x0);
        FUN_005d9a50(local_5c,iVar4);
      }
      else {
        *(undefined1 *)(iVar4 + 0x19) = 1;
        FUN_005dbc40(local_64,this != (GRefCountNTSImpl *)0x0);
        *(undefined1 *)(iVar4 + 0x19) = 0;
      }
    }
  }
  if (this != (GRefCountNTSImpl *)0x0) {
    GRefCountNTSImpl::Release(this);
  }
  __security_check_cookie(local_4 ^ (uint)&local_78);
  return;
}



============================================================
DISASSEMBLY
============================================================
00554ad0 : SUB ESP,0x78
00554ad3 : MOV EAX,[0x00d66fa0]
00554ad8 : XOR EAX,ESP
00554ada : MOV dword ptr [ESP + 0x74],EAX
00554ade : PUSH EBX
00554adf : MOV EBX,dword ptr [ESP + 0x80]
00554ae6 : MOV EAX,dword ptr [EBX]
00554ae8 : MOV EDX,dword ptr [EAX + 0x18]
00554aeb : MOV EDX,dword ptr [EDX + 0x14]
00554aee : PUSH EBP
00554aef : MOV EBP,dword ptr [EAX]
00554af1 : TEST byte ptr [EBP + 0x14],0x10
00554af5 : PUSH ESI
00554af6 : MOV ESI,ECX
00554af8 : MOV ECX,dword ptr [ESP + 0x90]
00554aff : PUSH EDI
00554b00 : MOV dword ptr [ESP + 0x2c],ESI
00554b04 : MOV dword ptr [ESP + 0x24],EBX
00554b08 : MOV dword ptr [ESP + 0x28],ECX
00554b0c : MOV dword ptr [ESP + 0x20],EBP
00554b10 : MOV dword ptr [ESP + 0x1c],EDX
00554b14 : JZ 0x00554b46
00554b16 : MOV EDI,dword ptr [EBP + 0x1c]
00554b19 : TEST EDI,0x100
00554b1f : JZ 0x00554b46
00554b21 : MOV EDX,EDI
00554b23 : SHR EDX,0x9
00554b26 : TEST DL,0x1
00554b29 : JNZ 0x00554b31
00554b2b : TEST byte ptr [ESI + 0x24],0x1
00554b2f : JNZ 0x00554b46
00554b31 : CMP byte ptr [ESP + 0x90],0x0
00554b39 : JNZ 0x00554b46
00554b3b : CMP dword ptr [EAX + 0x4c],0x0
00554b3f : MOV byte ptr [ESP + 0x16],0x1
00554b44 : JZ 0x00554b4b
00554b46 : MOV byte ptr [ESP + 0x16],0x0
00554b4b : XOR EDI,EDI
00554b4d : TEST byte ptr [ESI + 0x24],0x80
00554b51 : JZ 0x00554b86
00554b53 : TEST ECX,ECX
00554b55 : JZ 0x00554b86
00554b57 : TEST byte ptr [ECX + 0x66],0x1
00554b5b : JZ 0x00554b86
00554b5d : FLD float ptr [EAX + 0x24]
00554b60 : PUSH ECX
00554b61 : FSTP float ptr [ESP + 0x1c]
00554b65 : FLD float ptr [EBP + 0x10]
00554b68 : FSTP float ptr [ESP + 0x14]
00554b6c : FLD float ptr [ESP + 0x14]
00554b70 : FMUL float ptr [ESP + 0x1c]
00554b74 : FSTP float ptr [ESP + 0x14]
00554b78 : FLD float ptr [ESP + 0x14]
00554b7c : FSTP float ptr [ESP]
00554b7f : CALL 0x0051d4a0
00554b84 : MOV EDI,EAX
00554b86 : MOV ECX,dword ptr [ESI + 0x20]
00554b89 : TEST ECX,ECX
00554b8b : JZ 0x00554bb6
00554b8d : TEST EDI,EDI
00554b8f : JNZ 0x00554bb6
00554b91 : MOV AL,byte ptr [ESP + 0x16]
00554b95 : CMP AL,byte ptr [ECX + 0x15]
00554b98 : JNZ 0x00554bb6
00554b9a : PUSH EDI
00554b9b : PUSH EBX
00554b9c : CALL 0x005dbc40
00554ba1 : POP EDI
00554ba2 : POP ESI
00554ba3 : POP EBP
00554ba4 : POP EBX
00554ba5 : MOV ECX,dword ptr [ESP + 0x74]
00554ba9 : XOR ECX,ESP
00554bab : CALL 0x00633e6b
00554bb0 : ADD ESP,0x78
00554bb3 : RET 0xc
00554bb6 : LEA ECX,[EBX + 0xc]
00554bb9 : CALL 0x00523050
00554bbe : FSTP float ptr [ESP + 0x10]
00554bc2 : FLD float ptr [ESP + 0x10]
00554bc6 : FLD ST0
00554bc8 : FABS
00554bca : FSTP float ptr [ESP + 0x10]
00554bce : FLD float ptr [ESP + 0x10]
00554bd2 : FCOMP float ptr [0x00cdf414]
00554bd8 : FNSTSW AX
00554bda : TEST AH,0x5
00554bdd : JP 0x00554be6
00554bdf : FSTP ST0
00554be1 : JMP 0x00554e08
00554be6 : FLD float ptr [EBX + 0x40]
00554be9 : FABS
00554beb : FSTP float ptr [ESP + 0x10]
00554bef : FLD float ptr [ESP + 0x10]
00554bf3 : FCOMP float ptr [0x00b86060]
00554bf9 : FNSTSW AX
00554bfb : TEST AH,0x1
00554bfe : JNZ 0x00554c08
00554c00 : MOV CL,0x1
00554c02 : MOV byte ptr [ESP + 0x17],CL
00554c06 : JMP 0x00554c11
00554c08 : MOV byte ptr [ESP + 0x17],0x0
00554c0d : MOV CL,byte ptr [ESP + 0x17]
00554c11 : FLD float ptr [EBX + 0x3c]
00554c14 : FABS
00554c16 : FSTP float ptr [ESP + 0x10]
00554c1a : FLD float ptr [ESP + 0x10]
00554c1e : FCOMP float ptr [0x00cdf128]
00554c24 : FNSTSW AX
00554c26 : TEST AH,0x5
00554c29 : JP 0x00554c3e
00554c2b : TEST CL,CL
00554c2d : JNZ 0x00554c3e
00554c2f : MOV EDX,dword ptr [EBX]
00554c31 : CMP dword ptr [EDX + 0x4c],0x0
00554c35 : JNZ 0x00554c3e
00554c37 : FSTP ST0
00554c39 : JMP 0x00554e08
00554c3e : MOV EAX,dword ptr [EBX]
00554c40 : FMUL float ptr [EAX + 0x24]
00554c43 : MOV EAX,dword ptr [EBP + 0x14]
00554c46 : SHR EAX,0x5
00554c49 : AND EAX,0x1
00554c4c : XOR EDX,EDX
00554c4e : FSTP float ptr [ESP + 0x18]
00554c52 : FLD float ptr [ESP + 0x18]
00554c56 : ADD EAX,EAX
00554c58 : TEST CL,CL
00554c5a : MOV CL,byte ptr [ESP + 0x16]
00554c5e : SETNZ DL
00554c61 : OR EAX,EDX
00554c63 : XOR EDX,EDX
00554c65 : ADD EAX,EAX
00554c67 : TEST CL,CL
00554c69 : SETNZ DL
00554c6c : OR EAX,EDX
00554c6e : TEST EDI,EDI
00554c70 : JNZ 0x00554cdd
00554c72 : MOV byte ptr [ESP + 0x30],AL
00554c76 : TEST CL,CL
00554c78 : JZ 0x00554c9f
00554c7a : FMUL double ptr [0x00b8c1c8]
00554c80 : FSTP float ptr [ESP + 0x10]
00554c84 : FLD float ptr [ESP + 0x10]
00554c88 : FMUL ST0
00554c8a : FSTP float ptr [ESP + 0x10]
00554c8e : MOV EAX,dword ptr [ESP + 0x10]
00554c92 : SHR EAX,0x17
00554c95 : AND EAX,0xff
00554c9a : SUB EAX,0x40
00554c9d : JMP 0x00554cb4
00554c9f : FSTP float ptr [ESP + 0x10]
00554ca3 : MOV EAX,dword ptr [ESP + 0x10]
00554ca7 : SHR EAX,0x17
00554caa : AND EAX,0xff
00554caf : SUB EAX,0x40
00554cb2 : SHR EAX,0x1
00554cb4 : MOV byte ptr [ESP + 0x31],AL
00554cb8 : FLD float ptr [EBP + 0x10]
00554cbb : FSTP float ptr [ESP + 0x10]
00554cbf : MOV EBP,0x3
00554cc4 : MOV EAX,dword ptr [ESP + 0x10]
00554cc8 : SHR EAX,0x17
00554ccb : AND EAX,0xff
00554cd0 : SUB EAX,0x40
00554cd3 : SHR EAX,0x1
00554cd5 : MOV byte ptr [ESP + 0x32],AL
00554cd9 : XOR EBX,EBX
00554cdb : JMP 0x00554cfc
00554cdd : PUSH EAX
00554cde : FSTP ST0
00554ce0 : FLDZ
00554ce2 : PUSH ECX
00554ce3 : LEA ECX,[ESP + 0x38]
00554ce7 : FSTP float ptr [ESP]
00554cea : PUSH ECX
00554ceb : MOV ECX,EDI
00554ced : CALL 0x005530a0
00554cf2 : MOV EBP,0x54
00554cf7 : MOV EBX,0x1
00554cfc : MOV EAX,dword ptr [ESP + 0x28]
00554d00 : MOV ECX,dword ptr [ESP + 0x1c]
00554d04 : PUSH EBP
00554d05 : LEA EDX,[ESP + 0x34]
00554d09 : PUSH EDX
00554d0a : PUSH EBX
00554d0b : PUSH EAX
00554d0c : PUSH ESI
00554d0d : CALL 0x005d9780
00554d12 : MOV ESI,EAX
00554d14 : TEST ESI,ESI
00554d16 : JZ 0x00554d3a
00554d18 : MOV EAX,dword ptr [ESP + 0x24]
00554d1c : TEST EDI,EDI
00554d1e : SETNZ CL
00554d21 : MOVZX EDX,CL
00554d24 : PUSH EDX
00554d25 : PUSH EAX
00554d26 : MOV ECX,ESI
00554d28 : MOV byte ptr [ESI + 0x19],0x1
00554d2c : CALL 0x005dbc40
00554d31 : MOV byte ptr [ESI + 0x19],0x0
00554d35 : JMP 0x00554e08
00554d3a : FLD float ptr [ESP + 0x18]
00554d3e : MOV ESI,dword ptr [ESP + 0x20]
00554d42 : FDIVR double ptr [0x00b86058]
00554d48 : MOV ECX,dword ptr [ESP + 0x1c]
00554d4c : MOV ECX,dword ptr [ECX + 0x8]
00554d4f : PUSH 0x0
00554d51 : PUSH 0x70
00554d53 : FSTP float ptr [ESP + 0x20]
00554d57 : FLD float ptr [ESP + 0x20]
00554d5b : FMUL double ptr [0x00b8c220]
00554d61 : FMUL float ptr [ESI + 0x10]
00554d64 : FSTP float ptr [ESP + 0x18]
00554d68 : CALL 0x00515840
00554d6d : TEST EAX,EAX
00554d6f : JZ 0x00554dac
00554d71 : MOV EDX,dword ptr [ESI + 0x14]
00554d74 : FLD float ptr [ESP + 0x10]
00554d78 : SHR EDX,0x5
00554d7b : AND DL,0x1
00554d7e : CMP byte ptr [ESP + 0x16],0x0
00554d83 : MOV byte ptr [ESP + 0x20],DL
00554d87 : MOV ECX,dword ptr [ESP + 0x20]
00554d8b : PUSH ECX
00554d8c : SETZ DL
00554d8f : MOVZX ECX,DL
00554d92 : PUSH ECX
00554d93 : SUB ESP,0x8
00554d96 : MOV ECX,EAX
00554d98 : FSTP float ptr [ESP + 0x4]
00554d9c : FLD float ptr [ESP + 0x28]
00554da0 : FSTP float ptr [ESP]
00554da3 : CALL 0x005dc3f0
00554da8 : MOV ESI,EAX
00554daa : JMP 0x00554dae
00554dac : XOR ESI,ESI
00554dae : MOV DL,byte ptr [ESP + 0x17]
00554db2 : FLD float ptr [ESP + 0x10]
00554db6 : MOV ECX,dword ptr [ESP + 0x2c]
00554dba : MOV byte ptr [ESI + 0x17],DL
00554dbd : MOV EDX,dword ptr [ESP + 0x24]
00554dc1 : MOV EDX,dword ptr [EDX]
00554dc3 : MOV EAX,dword ptr [ECX]
00554dc5 : MOV EAX,dword ptr [EAX + 0x10]
00554dc8 : PUSH EDI
00554dc9 : PUSH EDX
00554dca : PUSH ECX
00554dcb : FSTP float ptr [ESP]
00554dce : PUSH ESI
00554dcf : CALL EAX
00554dd1 : MOV ECX,dword ptr [ESP + 0x28]
00554dd5 : PUSH ECX
00554dd6 : PUSH EBP
00554dd7 : LEA EDX,[ESP + 0x38]
00554ddb : PUSH EDX
00554ddc : PUSH EBX
00554ddd : MOV ECX,ESI
00554ddf : CALL 0x005da060
00554de4 : MOV EDX,dword ptr [ESP + 0x24]
00554de8 : TEST EDI,EDI
00554dea : SETNZ AL
00554ded : MOVZX ECX,AL
00554df0 : PUSH ECX
00554df1 : PUSH EDX
00554df2 : MOV ECX,ESI
00554df4 : CALL 0x005dbc40
00554df9 : MOV EAX,dword ptr [ESP + 0x2c]
00554dfd : MOV ECX,dword ptr [ESP + 0x1c]
00554e01 : PUSH ESI
00554e02 : PUSH EAX
00554e03 : CALL 0x005d9a50
00554e08 : TEST EDI,EDI
00554e0a : JZ 0x00554e13
00554e0c : MOV ECX,EDI
00554e0e : CALL 0x004ff7c0
00554e13 : MOV ECX,dword ptr [ESP + 0x84]
00554e1a : POP EDI
00554e1b : POP ESI
00554e1c : POP EBP
00554e1d : POP EBX
00554e1e : XOR ECX,ESP
00554e20 : CALL 0x00633e6b
00554e25 : ADD ESP,0x78
00554e28 : RET 0xc
