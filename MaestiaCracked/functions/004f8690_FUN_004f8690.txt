PROGRAM  : Maestia.exe
FUNCTION : FUN_004f8690
ENTRY    : 004f8690
BODY     : [[004f8690, 004f88aa]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_004f8690(int *param_1,int *param_2)

{
  undefined1 *puVar1;
  rsize_t _DstSize;
  uint uVar2;
  rsize_t _MaxCount;
  void *_Dst;
  int *piVar3;
  uint uVar4;
  int *piVar5;
  uint unaff_ESI;
  int unaff_EDI;
  int *local_10;
  uint local_8;
  
  local_8 = 0xffffffff;
  if (*(uint *)(unaff_EDI + 0x14) < unaff_ESI) {
    FUN_00622f07();
  }
  uVar2 = *(int *)(unaff_EDI + 0x14) - unaff_ESI;
  if (uVar2 < param_1) {
    param_1 = (int *)uVar2;
  }
  if (*(uint *)((int)param_2 + 0x14) != 0xffffffff) {
    local_8 = *(uint *)((int)param_2 + 0x14);
  }
  if (-local_8 - 1 <= (uint)(*(int *)(unaff_EDI + 0x14) - (int)param_1)) {
    FUN_00622ecf();
  }
  uVar2 = *(uint *)(unaff_EDI + 0x14);
  _MaxCount = (uVar2 - unaff_ESI) - (int)param_1;
  uVar4 = (uVar2 - (int)param_1) + local_8;
  if (uVar2 < uVar4) {
    if (uVar4 == 0xffffffff) {
      FUN_00622ecf();
    }
    if (*(uint *)(unaff_EDI + 0x18) < uVar4) {
      FUN_00404ef0(uVar4,*(undefined4 *)(unaff_EDI + 0x14));
    }
    else if (uVar4 == 0) {
      *(undefined4 *)(unaff_EDI + 0x14) = 0;
      if (*(uint *)(unaff_EDI + 0x18) < 0x10) {
        puVar1 = (undefined1 *)(unaff_EDI + 4);
      }
      else {
        puVar1 = *(undefined1 **)(unaff_EDI + 4);
      }
      *puVar1 = 0;
    }
  }
  piVar5 = (int *)(unaff_EDI + 4);
  if ((int *)unaff_EDI == param_2) {
    uVar2 = *(uint *)(unaff_EDI + 0x18);
    param_2 = piVar5;
    if (param_1 < local_8) {
      piVar3 = piVar5;
      if (0xf < uVar2) {
        piVar3 = (int *)*piVar5;
        param_2 = (int *)*piVar5;
      }
      _memmove_s((void *)((int)piVar3 + unaff_ESI + local_8),(uVar2 - unaff_ESI) - local_8,
                 (void *)((int)param_2 + unaff_ESI + (int)param_1),_MaxCount);
      piVar3 = piVar5;
      param_1 = piVar5;
      if (0xf < *(uint *)(unaff_EDI + 0x18)) {
        piVar3 = (int *)*piVar5;
        param_1 = (void *)*piVar5;
      }
      _DstSize = *(uint *)(unaff_EDI + 0x18) - unaff_ESI;
      _Dst = (void *)((int)piVar3 + unaff_ESI);
    }
    else {
      piVar3 = piVar5;
      if (0xf < uVar2) {
        piVar3 = (int *)*piVar5;
        param_2 = (int *)*piVar5;
      }
      _memmove_s((void *)((int)piVar3 + unaff_ESI),uVar2 - unaff_ESI,param_2,local_8);
      piVar3 = piVar5;
      param_2 = piVar5;
      if (0xf < *(uint *)(unaff_EDI + 0x18)) {
        piVar3 = (int *)*piVar5;
        param_2 = (int *)*piVar5;
      }
      param_1 = (int *)((int)param_2 + (int)param_1 + unaff_ESI);
      _DstSize = (*(uint *)(unaff_EDI + 0x18) - unaff_ESI) - local_8;
      _Dst = (void *)((int)piVar3 + local_8 + unaff_ESI);
      local_8 = _MaxCount;
    }
    _memmove_s(_Dst,_DstSize,param_1,local_8);
  }
  else {
    piVar3 = piVar5;
    local_10 = piVar5;
    if (0xf < *(uint *)(unaff_EDI + 0x18)) {
      piVar3 = (int *)*piVar5;
      local_10 = (int *)*piVar5;
    }
    _memmove_s((void *)((int)piVar3 + local_8 + unaff_ESI),
               (*(uint *)(unaff_EDI + 0x18) - unaff_ESI) - local_8,
               (void *)((int)local_10 + (int)param_1 + unaff_ESI),_MaxCount);
    if (*(uint *)((int)param_2 + 0x18) < 0x10) {
      param_1 = (int *)((int)param_2 + 4);
    }
    else {
      param_1 = *(int **)((int)param_2 + 4);
    }
    piVar3 = piVar5;
    if (0xf < *(uint *)(unaff_EDI + 0x18)) {
      piVar3 = (int *)*piVar5;
    }
    _memcpy_s((void *)((int)piVar3 + unaff_ESI),*(uint *)(unaff_EDI + 0x18) - unaff_ESI,param_1,
              local_8);
  }
  *(uint *)(unaff_EDI + 0x14) = uVar4;
  if (0xf < *(uint *)(unaff_EDI + 0x18)) {
    piVar5 = (int *)*piVar5;
  }
  *(undefined1 *)((int)piVar5 + uVar4) = 0;
  return;
}



============================================================
DISASSEMBLY
============================================================
004f8690 : PUSH EBP
004f8691 : MOV EBP,ESP
004f8693 : SUB ESP,0x10
004f8696 : MOV dword ptr [EBP + -0x4],0xffffffff
004f869d : CMP dword ptr [EDI + 0x14],ESI
004f86a0 : JNC 0x004f86a7
004f86a2 : CALL 0x00622f07
004f86a7 : MOV EAX,dword ptr [EDI + 0x14]
004f86aa : MOV ECX,EAX
004f86ac : PUSH EBX
004f86ad : MOV EBX,dword ptr [EBP + 0x8]
004f86b0 : SUB ECX,ESI
004f86b2 : CMP ECX,EBX
004f86b4 : JNC 0x004f86bb
004f86b6 : MOV dword ptr [EBP + 0x8],ECX
004f86b9 : MOV EBX,ECX
004f86bb : MOV ECX,dword ptr [EBP + 0xc]
004f86be : MOV ECX,dword ptr [ECX + 0x14]
004f86c1 : CMP ECX,-0x1
004f86c4 : JNC 0x004f86c9
004f86c6 : MOV dword ptr [EBP + -0x4],ECX
004f86c9 : OR EDX,0xffffffff
004f86cc : SUB EDX,dword ptr [EBP + -0x4]
004f86cf : SUB EAX,EBX
004f86d1 : CMP EDX,EAX
004f86d3 : JA 0x004f86da
004f86d5 : CALL 0x00622ecf
004f86da : MOV EAX,dword ptr [EDI + 0x14]
004f86dd : MOV ECX,EAX
004f86df : SUB ECX,ESI
004f86e1 : SUB ECX,EBX
004f86e3 : MOV EBX,EAX
004f86e5 : SUB EBX,dword ptr [EBP + 0x8]
004f86e8 : MOV dword ptr [EBP + -0x8],ECX
004f86eb : ADD EBX,dword ptr [EBP + -0x4]
004f86ee : MOV dword ptr [EBP + -0x10],EBX
004f86f1 : CMP EAX,EBX
004f86f3 : JNC 0x004f872b
004f86f5 : CMP EBX,-0x2
004f86f8 : JBE 0x004f86ff
004f86fa : CALL 0x00622ecf
004f86ff : MOV EAX,dword ptr [EDI + 0x18]
004f8702 : CMP EAX,EBX
004f8704 : JNC 0x004f8714
004f8706 : MOV EAX,dword ptr [EDI + 0x14]
004f8709 : PUSH EAX
004f870a : PUSH EBX
004f870b : MOV ECX,EDI
004f870d : CALL 0x00404ef0
004f8712 : JMP 0x004f872b
004f8714 : TEST EBX,EBX
004f8716 : JNZ 0x004f872b
004f8718 : MOV dword ptr [EDI + 0x14],EBX
004f871b : CMP EAX,0x10
004f871e : JC 0x004f8725
004f8720 : MOV EAX,dword ptr [EDI + 0x4]
004f8723 : JMP 0x004f8728
004f8725 : LEA EAX,[EDI + 0x4]
004f8728 : MOV byte ptr [EAX],0x0
004f872b : LEA EBX,[EDI + 0x4]
004f872e : CMP EDI,dword ptr [EBP + 0xc]
004f8731 : JZ 0x004f87af
004f8733 : MOV EAX,dword ptr [EDI + 0x18]
004f8736 : CMP EAX,0x10
004f8739 : JC 0x004f8742
004f873b : MOV ECX,dword ptr [EBX]
004f873d : MOV dword ptr [EBP + -0xc],ECX
004f8740 : JMP 0x004f8745
004f8742 : MOV dword ptr [EBP + -0xc],EBX
004f8745 : CMP EAX,0x10
004f8748 : JC 0x004f874e
004f874a : MOV EDX,dword ptr [EBX]
004f874c : JMP 0x004f8750
004f874e : MOV EDX,EBX
004f8750 : MOV ECX,dword ptr [EBP + -0x8]
004f8753 : PUSH ECX
004f8754 : MOV ECX,dword ptr [EBP + -0xc]
004f8757 : ADD ECX,ESI
004f8759 : ADD ECX,dword ptr [EBP + 0x8]
004f875c : SUB EAX,ESI
004f875e : PUSH ECX
004f875f : MOV ECX,dword ptr [EBP + -0x4]
004f8762 : SUB EAX,ECX
004f8764 : ADD EDX,ESI
004f8766 : PUSH EAX
004f8767 : ADD EDX,ECX
004f8769 : PUSH EDX
004f876a : CALL 0x00634101
004f876f : MOV EAX,dword ptr [EBP + 0xc]
004f8772 : ADD ESP,0x10
004f8775 : CMP dword ptr [EAX + 0x18],0x10
004f8779 : JC 0x004f8783
004f877b : MOV EDX,dword ptr [EAX + 0x4]
004f877e : MOV dword ptr [EBP + 0x8],EDX
004f8781 : JMP 0x004f8789
004f8783 : ADD EAX,0x4
004f8786 : MOV dword ptr [EBP + 0x8],EAX
004f8789 : MOV EAX,dword ptr [EDI + 0x18]
004f878c : CMP EAX,0x10
004f878f : JC 0x004f8795
004f8791 : MOV ECX,dword ptr [EBX]
004f8793 : JMP 0x004f8797
004f8795 : MOV ECX,EBX
004f8797 : MOV EDX,dword ptr [EBP + -0x4]
004f879a : PUSH EDX
004f879b : MOV EDX,dword ptr [EBP + 0x8]
004f879e : PUSH EDX
004f879f : SUB EAX,ESI
004f87a1 : PUSH EAX
004f87a2 : ADD ECX,ESI
004f87a4 : PUSH ECX
004f87a5 : CALL 0x00633ea4
004f87aa : JMP 0x004f888d
004f87af : MOV EAX,dword ptr [EBP + 0x8]
004f87b2 : CMP dword ptr [EBP + -0x4],EAX
004f87b5 : MOV EAX,dword ptr [EDI + 0x18]
004f87b8 : JA 0x004f8821
004f87ba : CMP EAX,0x10
004f87bd : JC 0x004f87c6
004f87bf : MOV ECX,dword ptr [EBX]
004f87c1 : MOV dword ptr [EBP + 0xc],ECX
004f87c4 : JMP 0x004f87c9
004f87c6 : MOV dword ptr [EBP + 0xc],EBX
004f87c9 : CMP EAX,0x10
004f87cc : JC 0x004f87d2
004f87ce : MOV ECX,dword ptr [EBX]
004f87d0 : JMP 0x004f87d4
004f87d2 : MOV ECX,EBX
004f87d4 : MOV EDX,dword ptr [EBP + -0x4]
004f87d7 : PUSH EDX
004f87d8 : MOV EDX,dword ptr [EBP + 0xc]
004f87db : PUSH EDX
004f87dc : SUB EAX,ESI
004f87de : PUSH EAX
004f87df : ADD ECX,ESI
004f87e1 : PUSH ECX
004f87e2 : CALL 0x00634101
004f87e7 : MOV EAX,dword ptr [EDI + 0x18]
004f87ea : ADD ESP,0x10
004f87ed : CMP EAX,0x10
004f87f0 : JC 0x004f87f9
004f87f2 : MOV ECX,dword ptr [EBX]
004f87f4 : MOV dword ptr [EBP + 0xc],ECX
004f87f7 : JMP 0x004f87fc
004f87f9 : MOV dword ptr [EBP + 0xc],EBX
004f87fc : CMP EAX,0x10
004f87ff : JC 0x004f8805
004f8801 : MOV ECX,dword ptr [EBX]
004f8803 : JMP 0x004f8807
004f8805 : MOV ECX,EBX
004f8807 : MOV EDX,dword ptr [EBP + -0x8]
004f880a : PUSH EDX
004f880b : MOV EDX,dword ptr [EBP + 0xc]
004f880e : ADD EDX,ESI
004f8810 : ADD EDX,dword ptr [EBP + 0x8]
004f8813 : SUB EAX,ESI
004f8815 : PUSH EDX
004f8816 : MOV EDX,dword ptr [EBP + -0x4]
004f8819 : ADD ECX,ESI
004f881b : SUB EAX,EDX
004f881d : ADD ECX,EDX
004f881f : JMP 0x004f8886
004f8821 : CMP EAX,0x10
004f8824 : JC 0x004f882d
004f8826 : MOV ECX,dword ptr [EBX]
004f8828 : MOV dword ptr [EBP + 0xc],ECX
004f882b : JMP 0x004f8830
004f882d : MOV dword ptr [EBP + 0xc],EBX
004f8830 : CMP EAX,0x10
004f8833 : JC 0x004f8839
004f8835 : MOV EDX,dword ptr [EBX]
004f8837 : JMP 0x004f883b
004f8839 : MOV EDX,EBX
004f883b : MOV ECX,dword ptr [EBP + -0x8]
004f883e : PUSH ECX
004f883f : MOV ECX,dword ptr [EBP + 0xc]
004f8842 : ADD ECX,ESI
004f8844 : ADD ECX,dword ptr [EBP + 0x8]
004f8847 : SUB EAX,ESI
004f8849 : PUSH ECX
004f884a : MOV ECX,dword ptr [EBP + -0x4]
004f884d : SUB EAX,ECX
004f884f : ADD EDX,ESI
004f8851 : PUSH EAX
004f8852 : ADD EDX,ECX
004f8854 : PUSH EDX
004f8855 : CALL 0x00634101
004f885a : MOV EAX,dword ptr [EDI + 0x18]
004f885d : ADD ESP,0x10
004f8860 : CMP EAX,0x10
004f8863 : JC 0x004f886c
004f8865 : MOV EDX,dword ptr [EBX]
004f8867 : MOV dword ptr [EBP + 0x8],EDX
004f886a : JMP 0x004f886f
004f886c : MOV dword ptr [EBP + 0x8],EBX
004f886f : CMP EAX,0x10
004f8872 : JC 0x004f8878
004f8874 : MOV ECX,dword ptr [EBX]
004f8876 : JMP 0x004f887a
004f8878 : MOV ECX,EBX
004f887a : MOV EDX,dword ptr [EBP + -0x4]
004f887d : PUSH EDX
004f887e : MOV EDX,dword ptr [EBP + 0x8]
004f8881 : SUB EAX,ESI
004f8883 : PUSH EDX
004f8884 : ADD ECX,ESI
004f8886 : PUSH EAX
004f8887 : PUSH ECX
004f8888 : CALL 0x00634101
004f888d : MOV EAX,dword ptr [EBP + -0x10]
004f8890 : ADD ESP,0x10
004f8893 : CMP dword ptr [EDI + 0x18],0x10
004f8897 : MOV dword ptr [EDI + 0x14],EAX
004f889a : JC 0x004f889e
004f889c : MOV EBX,dword ptr [EBX]
004f889e : MOV byte ptr [EBX + EAX*0x1],0x0
004f88a2 : MOV EAX,EDI
004f88a4 : POP EBX
004f88a5 : MOV ESP,EBP
004f88a7 : POP EBP
004f88a8 : RET 0x8
