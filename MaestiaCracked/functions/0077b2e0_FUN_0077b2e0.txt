PROGRAM  : Maestia.exe
FUNCTION : FUN_0077b2e0
ENTRY    : 0077b2e0
BODY     : [[0077b2e0, 0077b516]]

============================================================
DECOMPILED C CODE
============================================================

undefined1 FUN_0077b2e0(int param_1)

{
  int iVar1;
  int iVar2;
  undefined4 *puVar3;
  char cVar4;
  undefined1 uVar5;
  uint uVar6;
  int iVar7;
  int iVar8;
  DWORD DVar9;
  int *in_ECX;
  int iVar10;
  wchar_t *pwVar11;
  LPCRITICAL_SECTION local_28;
  char *local_24;
  undefined4 local_20;
  int local_1c;
  undefined4 local_18;
  int *local_14;
  void *local_10;
  undefined1 *puStack_c;
  undefined4 local_8;
  
  local_8 = 0xffffffff;
  puStack_c = &LAB_00b39880;
  local_10 = ExceptionList;
  uVar6 = DAT_00d66fa0 ^ (uint)&stack0xfffffffc;
  ExceptionList = &local_10;
  local_28 = (LPCRITICAL_SECTION)(param_1 + 0x2eef0);
  local_1c = 0;
  local_24 = ".\\Terrain\\AvaPathFinder.cpp";
  local_20 = 0x423;
  local_18 = 1;
  FUN_006ef1a0(&local_28);
  local_8 = 0;
  cVar4 = FUN_00486300(uVar6);
  if (cVar4 != '\0') {
    local_8 = 0xffffffff;
    if (local_1c != 0) {
      LeaveCriticalSection(local_28);
    }
    ExceptionList = local_10;
    return 0;
  }
  iVar7 = *in_ECX;
  if (iVar7 != 0) {
    iVar7 = FUN_004862a0(*(undefined4 *)(iVar7 + 0xc),*(undefined4 *)(iVar7 + 0x10));
    in_ECX[7] = iVar7;
    FUN_00449610();
  }
  do {
    in_ECX = (int *)*in_ECX;
    local_14 = in_ECX;
    if (in_ECX != (int *)0x0) {
      iVar7 = *in_ECX;
      if (iVar7 == 0) {
        FUN_00449610();
        break;
      }
      iVar1 = *(int *)(iVar7 + 0x10);
      iVar2 = in_ECX[4];
      iVar10 = in_ECX[3] - *(int *)(iVar7 + 0xc);
      iVar8 = iVar2 - iVar1;
      if (iVar10 < 1) {
LAB_0077b3e3:
        if (in_ECX[3] == *(int *)(iVar7 + 0xc)) {
          if (iVar8 < 0) {
            iVar7 = 3;
          }
          else {
            if (iVar8 < 1) goto LAB_0077b40a;
            iVar7 = 7;
          }
        }
        else {
          if (((-1 < iVar10) || (iVar8 < 0)) || (iVar2 != iVar1)) goto LAB_0077b40a;
          iVar7 = 5;
        }
      }
      else {
        if (iVar8 < 1) {
          if (iVar2 == iVar1) {
            iVar7 = 1;
            goto LAB_0077b40d;
          }
          if (-1 < iVar8) goto LAB_0077b3e3;
        }
LAB_0077b40a:
        iVar7 = -1;
      }
LAB_0077b40d:
      in_ECX[7] = iVar7;
      iVar7 = *(int *)(param_1 + 0x24);
      if (iVar7 == 0) {
        uVar6 = 0;
      }
      else {
        uVar6 = *(int *)(param_1 + 0x2c) - iVar7 >> 2;
      }
      puVar3 = *(undefined4 **)(param_1 + 0x28);
      if ((uint)((int)puVar3 - iVar7 >> 2) < uVar6) {
        *puVar3 = in_ECX;
        *(undefined4 **)(param_1 + 0x28) = puVar3 + 1;
      }
      else {
        FUN_004d2c60(param_1 + 0x20,puVar3,&local_14);
      }
    }
    if (*(char *)(param_1 + 0x2eee9) != '\0') {
      pwVar11 = L"====== Path Find Force Abort ======";
LAB_0077b4be:
      FUN_008018d0(pwVar11);
      local_8 = 0xffffffff;
      if (local_1c != 0) {
        LeaveCriticalSection(local_28);
      }
      ExceptionList = local_10;
      return 0;
    }
    DVar9 = GetTickCount();
    uVar6 = DVar9 - *(int *)(param_1 + 0x2eecc);
    *(uint *)(param_1 + 0x2eed0) = uVar6;
    if (*(uint *)(param_1 + 0x2eed4) < uVar6) {
      pwVar11 = L"====== Path Find Time Over ======";
      goto LAB_0077b4be;
    }
  } while (in_ECX != (int *)0x0);
  uVar5 = FUN_0077b010(param_1);
  local_8 = 0xffffffff;
  if (local_1c != 0) {
    LeaveCriticalSection(local_28);
  }
  ExceptionList = local_10;
  return uVar5;
}



============================================================
DISASSEMBLY
============================================================
0077b2e0 : PUSH EBP
0077b2e1 : MOV EBP,ESP
0077b2e3 : PUSH -0x1
0077b2e5 : PUSH 0xb39880
0077b2ea : MOV EAX,FS:[0x0]
0077b2f0 : PUSH EAX
0077b2f1 : SUB ESP,0x18
0077b2f4 : PUSH EBX
0077b2f5 : PUSH ESI
0077b2f6 : PUSH EDI
0077b2f7 : MOV EAX,[0x00d66fa0]
0077b2fc : XOR EAX,EBP
0077b2fe : PUSH EAX
0077b2ff : LEA EAX,[EBP + -0xc]
0077b302 : MOV FS:[0x0],EAX
0077b308 : MOV ESI,ECX
0077b30a : MOV EBX,dword ptr [EBP + 0x8]
0077b30d : LEA ECX,[EBP + -0x24]
0077b310 : LEA EAX,[EBX + 0x2eef0]
0077b316 : XOR EDI,EDI
0077b318 : PUSH ECX
0077b319 : MOV dword ptr [EBP + -0x18],EDI
0077b31c : MOV dword ptr [EBP + -0x24],EAX
0077b31f : MOV dword ptr [EBP + -0x20],0xc104ac
0077b326 : MOV dword ptr [EBP + -0x1c],0x423
0077b32d : MOV dword ptr [EBP + -0x14],0x1
0077b334 : CALL 0x006ef1a0
0077b339 : MOV dword ptr [EBP + -0x4],EDI
0077b33c : MOV EAX,EBX
0077b33e : CALL 0x00486300
0077b343 : TEST AL,AL
0077b345 : JZ 0x0077b376
0077b347 : MOV dword ptr [EBP + -0x4],0xffffffff
0077b34e : CMP dword ptr [EBP + -0x18],EDI
0077b351 : JZ 0x0077b360
0077b353 : MOV EDX,dword ptr [EBP + -0x24]
0077b356 : PUSH EDX
0077b357 : CALL dword ptr [0x00b8511c]
0077b35d : MOV dword ptr [EBP + -0x18],EDI
0077b360 : XOR AL,AL
0077b362 : MOV ECX,dword ptr [EBP + -0xc]
0077b365 : MOV dword ptr FS:[0x0],ECX
0077b36c : POP ECX
0077b36d : POP EDI
0077b36e : POP ESI
0077b36f : POP EBX
0077b370 : MOV ESP,EBP
0077b372 : POP EBP
0077b373 : RET 0x4
0077b376 : MOV EAX,dword ptr [ESI]
0077b378 : MOV dword ptr [EBP + -0x10],ESI
0077b37b : CMP EAX,EDI
0077b37d : JZ 0x0077b3a5
0077b37f : MOV EDX,dword ptr [EAX + 0x10]
0077b382 : MOV EAX,dword ptr [EAX + 0xc]
0077b385 : MOV EDI,dword ptr [ESI + 0x10]
0077b388 : MOV ECX,dword ptr [ESI + 0xc]
0077b38b : PUSH EDX
0077b38c : PUSH EAX
0077b38d : MOV EAX,EDI
0077b38f : CALL 0x004862a0
0077b394 : MOV EBX,dword ptr [EBP + 0x8]
0077b397 : LEA EDX,[EBX + 0x20]
0077b39a : LEA EDI,[EBP + -0x10]
0077b39d : MOV dword ptr [ESI + 0x1c],EAX
0077b3a0 : CALL 0x00449610
0077b3a5 : MOV EDI,dword ptr [ESI]
0077b3a7 : MOV dword ptr [EBP + -0x10],EDI
0077b3aa : TEST EDI,EDI
0077b3ac : JZ 0x0077b44c
0077b3b2 : MOV EAX,dword ptr [EDI]
0077b3b4 : TEST EAX,EAX
0077b3b6 : JZ 0x0077b507
0077b3bc : MOV ESI,dword ptr [EAX + 0xc]
0077b3bf : MOV EDX,dword ptr [EAX + 0x10]
0077b3c2 : MOV ECX,dword ptr [EDI + 0xc]
0077b3c5 : MOV EAX,dword ptr [EDI + 0x10]
0077b3c8 : SUB ECX,ESI
0077b3ca : SUB EAX,EDX
0077b3cc : TEST ECX,ECX
0077b3ce : JLE 0x0077b3e3
0077b3d0 : TEST EAX,EAX
0077b3d2 : JG 0x0077b40a
0077b3d4 : JNZ 0x0077b3dd
0077b3d6 : MOV EAX,0x1
0077b3db : JMP 0x0077b40d
0077b3dd : TEST EAX,EAX
0077b3df : JL 0x0077b40a
0077b3e1 : TEST ECX,ECX
0077b3e3 : JNZ 0x0077b3f0
0077b3e5 : TEST EAX,EAX
0077b3e7 : JGE 0x0077b401
0077b3e9 : MOV EAX,0x3
0077b3ee : JMP 0x0077b40d
0077b3f0 : TEST ECX,ECX
0077b3f2 : JGE 0x0077b40a
0077b3f4 : TEST EAX,EAX
0077b3f6 : JL 0x0077b40a
0077b3f8 : JNZ 0x0077b40a
0077b3fa : MOV EAX,0x5
0077b3ff : JMP 0x0077b40d
0077b401 : JLE 0x0077b40a
0077b403 : MOV EAX,0x7
0077b408 : JMP 0x0077b40d
0077b40a : OR EAX,0xffffffff
0077b40d : MOV dword ptr [EDI + 0x1c],EAX
0077b410 : MOV EDX,dword ptr [EBX + 0x24]
0077b413 : LEA EAX,[EBX + 0x20]
0077b416 : TEST EDX,EDX
0077b418 : JNZ 0x0077b41e
0077b41a : XOR ECX,ECX
0077b41c : JMP 0x0077b426
0077b41e : MOV ECX,dword ptr [EAX + 0xc]
0077b421 : SUB ECX,EDX
0077b423 : SAR ECX,0x2
0077b426 : MOV ESI,dword ptr [EAX + 0x8]
0077b429 : MOV EBX,ESI
0077b42b : SUB EBX,EDX
0077b42d : SAR EBX,0x2
0077b430 : CMP EBX,ECX
0077b432 : JNC 0x0077b43e
0077b434 : MOV dword ptr [ESI],EDI
0077b436 : ADD ESI,0x4
0077b439 : MOV dword ptr [EAX + 0x8],ESI
0077b43c : JMP 0x0077b449
0077b43e : LEA ECX,[EBP + -0x10]
0077b441 : PUSH ECX
0077b442 : PUSH ESI
0077b443 : PUSH EAX
0077b444 : CALL 0x004d2c60
0077b449 : MOV EBX,dword ptr [EBP + 0x8]
0077b44c : CMP byte ptr [EBX + 0x2eee9],0x0
0077b453 : JNZ 0x0077b4b9
0077b455 : CALL dword ptr [0x00b850d8]
0077b45b : SUB EAX,dword ptr [EBX + 0x2eecc]
0077b461 : MOV dword ptr [EBX + 0x2eed0],EAX
0077b467 : CMP EAX,dword ptr [EBX + 0x2eed4]
0077b46d : JA 0x0077b500
0077b473 : MOV ESI,EDI
0077b475 : TEST EDI,EDI
0077b477 : JNZ 0x0077b3a5
0077b47d : PUSH EBX
0077b47e : CALL 0x0077b010
0077b483 : MOV BL,AL
0077b485 : MOV dword ptr [EBP + -0x4],0xffffffff
0077b48c : CMP dword ptr [EBP + -0x18],0x0
0077b490 : JZ 0x0077b4a3
0077b492 : MOV EAX,dword ptr [EBP + -0x24]
0077b495 : PUSH EAX
0077b496 : CALL dword ptr [0x00b8511c]
0077b49c : MOV dword ptr [EBP + -0x18],0x0
0077b4a3 : MOV AL,BL
0077b4a5 : MOV ECX,dword ptr [EBP + -0xc]
0077b4a8 : MOV dword ptr FS:[0x0],ECX
0077b4af : POP ECX
0077b4b0 : POP EDI
0077b4b1 : POP ESI
0077b4b2 : POP EBX
0077b4b3 : MOV ESP,EBP
0077b4b5 : POP EBP
0077b4b6 : RET 0x4
0077b4b9 : PUSH 0xcd7d58
0077b4be : MOV ESI,dword ptr [0x00da98e8]
0077b4c4 : CALL 0x008018d0
0077b4c9 : ADD ESP,0x4
0077b4cc : MOV dword ptr [EBP + -0x4],0xffffffff
0077b4d3 : CMP dword ptr [EBP + -0x18],0x0
0077b4d7 : JZ 0x0077b4ea
0077b4d9 : MOV EDX,dword ptr [EBP + -0x24]
0077b4dc : PUSH EDX
0077b4dd : CALL dword ptr [0x00b8511c]
0077b4e3 : MOV dword ptr [EBP + -0x18],0x0
0077b4ea : XOR AL,AL
0077b4ec : MOV ECX,dword ptr [EBP + -0xc]
0077b4ef : MOV dword ptr FS:[0x0],ECX
0077b4f6 : POP ECX
0077b4f7 : POP EDI
0077b4f8 : POP ESI
0077b4f9 : POP EBX
0077b4fa : MOV ESP,EBP
0077b4fc : POP EBP
0077b4fd : RET 0x4
0077b500 : PUSH 0xcd7da0
0077b505 : JMP 0x0077b4be
0077b507 : LEA EDX,[EBX + 0x20]
0077b50a : LEA EDI,[EBP + -0x10]
0077b50d : CALL 0x00449610
0077b512 : JMP 0x0077b47d
