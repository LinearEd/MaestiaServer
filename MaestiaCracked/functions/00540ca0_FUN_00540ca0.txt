PROGRAM  : Maestia.exe
FUNCTION : FUN_00540ca0
ENTRY    : 00540ca0
BODY     : [[00540ca0, 00540db2]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_00540ca0(undefined4 param_1)

{
  int *piVar1;
  int *piVar2;
  uint uVar3;
  undefined4 uVar4;
  int iVar5;
  int in_ECX;
  short *psVar6;
  int iVar7;
  
  iVar7 = 0;
  if (*(int *)(in_ECX + 0x10) != 0) {
    piVar2 = *(int **)(*(int *)(in_ECX + 0xc) + -4 + *(int *)(in_ECX + 0x10) * 4);
    uVar3 = piVar2[1];
    if (uVar3 != 0) {
      if ((*piVar2 == 0) || (uVar3 <= uVar3 - 1)) {
        psVar6 = (short *)0x0;
      }
      else {
        psVar6 = (short *)(*piVar2 + (uVar3 - 1) * 2);
      }
      if (*psVar6 == 0) {
        uVar3 = uVar3 - 1;
      }
    }
    iVar7 = uVar3 + piVar2[7];
  }
  if (*(int *)(in_ECX + 8) == 0) {
    uVar4 = FUN_00515dd0(in_ECX);
    iVar5 = FUN_00515840(0x50,0);
    if (iVar5 == 0) {
      uVar4 = 0;
    }
    else {
      uVar4 = FUN_00508200(uVar4,0);
    }
    if (*(GRefCountNTSImpl **)(in_ECX + 8) != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(in_ECX + 8));
    }
    *(undefined4 *)(in_ECX + 8) = uVar4;
  }
  uVar4 = *(undefined4 *)(in_ECX + 8);
  iVar5 = FUN_00515840(0x28,0);
  if (iVar5 == 0) {
    iVar5 = 0;
  }
  else {
    iVar5 = FUN_00540310(param_1,uVar4);
  }
  piVar2 = (int *)(in_ECX + 0xc);
  FUN_005402b0(piVar2,*(int *)(in_ECX + 0x10) + 1);
  piVar1 = (int *)(*piVar2 + -4 + *(int *)(in_ECX + 0x10) * 4);
  if (piVar1 != (int *)0x0) {
    *piVar1 = iVar5;
    *(int *)(*(int *)(*piVar2 + -4 + *(int *)(in_ECX + 0x10) * 4) + 0x1c) = iVar7;
    return;
  }
  if (iVar5 != 0) {
    FUN_0053bb30(*(undefined4 *)(iVar5 + 0x10),*(undefined4 *)(iVar5 + 0x14));
    FUN_00515cf0(*(undefined4 *)(iVar5 + 0x10));
    if (*(GRefCountNTSImpl **)(iVar5 + 0xc) != (GRefCountNTSImpl *)0x0) {
      GRefCountNTSImpl::Release(*(GRefCountNTSImpl **)(iVar5 + 0xc));
    }
    FUN_00515cf0(iVar5);
  }
  *(int *)(*(int *)(*piVar2 + -4 + *(int *)(in_ECX + 0x10) * 4) + 0x1c) = iVar7;
  return;
}



============================================================
DISASSEMBLY
============================================================
00540ca0 : PUSH EBX
00540ca1 : PUSH EBP
00540ca2 : PUSH ESI
00540ca3 : PUSH EDI
00540ca4 : MOV EDI,ECX
00540ca6 : MOV EAX,dword ptr [EDI + 0x10]
00540ca9 : XOR EBP,EBP
00540cab : TEST EAX,EAX
00540cad : JBE 0x00540cdd
00540caf : MOV ECX,dword ptr [EDI + 0xc]
00540cb2 : MOV ECX,dword ptr [ECX + EAX*0x4 + -0x4]
00540cb6 : MOV EAX,dword ptr [ECX + 0x4]
00540cb9 : MOV ESI,dword ptr [ECX + 0x1c]
00540cbc : TEST EAX,EAX
00540cbe : JBE 0x00540cda
00540cc0 : MOV ECX,dword ptr [ECX]
00540cc2 : LEA EDX,[EAX + -0x1]
00540cc5 : TEST ECX,ECX
00540cc7 : JZ 0x00540cd2
00540cc9 : CMP EDX,EAX
00540ccb : JNC 0x00540cd2
00540ccd : LEA ECX,[ECX + EDX*0x2]
00540cd0 : JMP 0x00540cd4
00540cd2 : XOR ECX,ECX
00540cd4 : CMP word ptr [ECX],BP
00540cd7 : JNZ 0x00540cda
00540cd9 : DEC EAX
00540cda : LEA EBP,[EAX + ESI*0x1]
00540cdd : CMP dword ptr [EDI + 0x8],0x0
00540ce1 : JNZ 0x00540d19
00540ce3 : PUSH EDI
00540ce4 : CALL 0x00515dd0
00540ce9 : MOV ESI,EAX
00540ceb : PUSH 0x0
00540ced : PUSH 0x50
00540cef : MOV ECX,ESI
00540cf1 : CALL 0x00515840
00540cf6 : TEST EAX,EAX
00540cf8 : JZ 0x00540d08
00540cfa : PUSH 0x0
00540cfc : PUSH ESI
00540cfd : MOV ECX,EAX
00540cff : CALL 0x00508200
00540d04 : MOV ESI,EAX
00540d06 : JMP 0x00540d0a
00540d08 : XOR ESI,ESI
00540d0a : MOV ECX,dword ptr [EDI + 0x8]
00540d0d : TEST ECX,ECX
00540d0f : JZ 0x00540d16
00540d11 : CALL 0x004ff7c0
00540d16 : MOV dword ptr [EDI + 0x8],ESI
00540d19 : MOV ESI,dword ptr [EDI + 0x8]
00540d1c : MOV ECX,dword ptr [ESI + 0x1c]
00540d1f : PUSH 0x0
00540d21 : PUSH 0x28
00540d23 : CALL 0x00515840
00540d28 : TEST EAX,EAX
00540d2a : JZ 0x00540d3d
00540d2c : MOV EDX,dword ptr [ESP + 0x14]
00540d30 : PUSH ESI
00540d31 : PUSH EDX
00540d32 : MOV ECX,EAX
00540d34 : CALL 0x00540310
00540d39 : MOV EBX,EAX
00540d3b : JMP 0x00540d3f
00540d3d : XOR EBX,EBX
00540d3f : MOV EAX,dword ptr [EDI + 0x10]
00540d42 : LEA ESI,[EDI + 0xc]
00540d45 : INC EAX
00540d46 : PUSH EAX
00540d47 : PUSH ESI
00540d48 : MOV ECX,ESI
00540d4a : CALL 0x005402b0
00540d4f : MOV ECX,dword ptr [ESI + 0x4]
00540d52 : MOV EDX,dword ptr [ESI]
00540d54 : LEA EAX,[EDX + ECX*0x4 + -0x4]
00540d58 : TEST EAX,EAX
00540d5a : JZ 0x00540d71
00540d5c : MOV dword ptr [EAX],EBX
00540d5e : MOV EAX,dword ptr [EDI + 0x10]
00540d61 : MOV ECX,dword ptr [ESI]
00540d63 : MOV EAX,dword ptr [ECX + EAX*0x4 + -0x4]
00540d67 : POP EDI
00540d68 : POP ESI
00540d69 : MOV dword ptr [EAX + 0x1c],EBP
00540d6c : POP EBP
00540d6d : POP EBX
00540d6e : RET 0x4
00540d71 : TEST EBX,EBX
00540d73 : JZ 0x00540da0
00540d75 : MOV EAX,dword ptr [EBX + 0x14]
00540d78 : MOV ECX,dword ptr [EBX + 0x10]
00540d7b : PUSH EAX
00540d7c : PUSH ECX
00540d7d : CALL 0x0053bb30
00540d82 : MOV EDX,dword ptr [EBX + 0x10]
00540d85 : ADD ESP,0x8
00540d88 : PUSH EDX
00540d89 : CALL 0x00515cf0
00540d8e : MOV ECX,dword ptr [EBX + 0xc]
00540d91 : TEST ECX,ECX
00540d93 : JZ 0x00540d9a
00540d95 : CALL 0x004ff7c0
00540d9a : PUSH EBX
00540d9b : CALL 0x00515cf0
00540da0 : MOV EAX,dword ptr [EDI + 0x10]
00540da3 : MOV ECX,dword ptr [ESI]
00540da5 : MOV EAX,dword ptr [ECX + EAX*0x4 + -0x4]
00540da9 : POP EDI
00540daa : POP ESI
00540dab : MOV dword ptr [EAX + 0x1c],EBP
00540dae : POP EBP
00540daf : POP EBX
00540db0 : RET 0x4
