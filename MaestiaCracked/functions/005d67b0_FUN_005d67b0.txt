PROGRAM  : Maestia.exe
FUNCTION : FUN_005d67b0
ENTRY    : 005d67b0
BODY     : [[005d67b0, 005d6b1e]]

============================================================
DECOMPILED C CODE
============================================================

void FUN_005d67b0(uint param_1,float param_2)

{
  int *piVar1;
  byte bVar2;
  int iVar3;
  undefined4 uVar4;
  int iVar5;
  char cVar6;
  short sVar7;
  undefined2 uVar8;
  int iVar9;
  GRefCountImpl *this;
  byte *in_ECX;
  GThread *this_00;
  GThread *this_01;
  GThread *this_02;
  int unaff_EBX;
  uint uVar10;
  uint local_10;
  undefined **local_c;
  undefined4 uStack_8;
  
  iVar5 = param_1;
  iVar9 = *(int *)(param_1 + 0x314);
  if (iVar9 == 0) {
    iVar9 = param_1 + 0x28;
  }
  *(undefined1 *)(iVar9 + 0x15) = 0;
  if (*(int *)(iVar9 + 0x30) - *(int *)(iVar9 + 0x2c) < 1) {
    FUN_0053a0a0();
  }
  iVar3 = *(int *)(iVar9 + 0x3c);
  bVar2 = *(byte *)(*(int *)(iVar9 + 0x2c) + iVar3);
  *(int *)(iVar9 + 0x2c) = *(int *)(iVar9 + 0x2c) + 1;
  *in_ECX = bVar2;
  in_ECX[1] = 0;
  GThread::OnExit((GThread *)CONCAT31((int3)((uint)iVar3 >> 8),bVar2));
  bVar2 = *in_ECX;
  if (bVar2 == 0) {
    FUN_005a0260(&param_2,param_2);
    GThread::OnExit(this_00);
    if (param_2._3_1_ != -1) {
      in_ECX[1] = in_ECX[1] | 2;
    }
    *(float *)(in_ECX + 4) = param_2;
    return;
  }
  if ((bVar2 & 0x10) == 0) {
    if ((bVar2 & 0x40) != 0) {
      uVar8 = FUN_00500140();
      GThread::OnExit(this_02);
      cVar6 = FUN_00565560(in_ECX + 8,uVar8);
      if (((cVar6 != '\0') && (*(int *)(param_1 + 0x2c0) != 0)) &&
         ((*in_ECX == 0x42 || (*in_ECX == 0x40)))) {
        param_2 = *(float *)(in_ECX + 0xc);
        FUN_005d65b0(&param_2);
      }
      FUN_0053acd0(in_ECX + 0x10);
      in_ECX[1] = in_ECX[1] | 2;
    }
    return;
  }
  FUN_0053acd0(in_ECX + 0x10);
  iVar9 = *(int *)(param_1 + 0x314);
  if (iVar9 == 0) {
    iVar9 = param_1 + 0x28;
  }
  *(undefined1 *)(iVar9 + 0x15) = 0;
  if (*(int *)(iVar9 + 0x30) - *(int *)(iVar9 + 0x2c) < 1) {
    FUN_0053a0a0();
  }
  bVar2 = *(byte *)(*(int *)(iVar9 + 0x2c) + *(int *)(iVar9 + 0x3c));
  *(int *)(iVar9 + 0x2c) = *(int *)(iVar9 + 0x2c) + 1;
  if ((bVar2 & 0x10) != 0) {
    in_ECX[1] = in_ECX[1] | 1;
  }
  uVar10 = bVar2 & 0xf;
  local_10 = uVar10;
  iVar9 = FUN_00515840(0x14,0);
  if (iVar9 == 0) {
    this = (GRefCountImpl *)0x0;
  }
  else {
    param_1 = CONCAT31(param_1._1_3_,in_ECX[1]) & 0xffffff01;
    this = (GRefCountImpl *)FUN_005d5d30(*in_ECX,uVar10,param_1);
  }
  *(GRefCountImpl **)(in_ECX + 4) = this;
  if (this != (GRefCountImpl *)0x0) {
    if (*(short *)(this + 10) == (short)uVar10) {
      this_01 = (GThread *)(local_10 & 0xffff);
      if (this_01 != (GThread *)0x0) {
        iVar9 = 0;
        do {
          FUN_005d4690(iVar5,param_2);
          if (*(char *)(*(int *)(*(int *)(in_ECX + 4) + 0xc) + 7 + iVar9 * 8) != -1) {
            in_ECX[1] = in_ECX[1] | 2;
          }
          iVar9 = iVar9 + 1;
        } while (iVar9 < (int)this_01);
      }
      GThread::OnExit(this_01);
      if (*in_ECX == 0x13) {
        sVar7 = FUN_00500140();
        param_2 = (float)(int)sVar7 * 0.00390625;
        *(float *)(*(int *)(in_ECX + 4) + 0x10) = param_2;
      }
      iVar9 = *(int *)(*(int *)(iVar5 + 0x20) + 0x108);
      *(int *)(*(int *)(iVar5 + 0x20) + 0x108) = iVar9 + 1;
      piVar1 = (int *)(*(int *)(iVar5 + 0x20) + 0x4c);
      uVar10 = -(uint)(*piVar1 != 0) & (uint)piVar1;
      if ((uVar10 != 0) && ((*(byte *)(uVar10 + 0x10) & 2) != 0)) {
        local_10 = 0;
        local_c = (undefined **)0x0;
        cVar6 = FUN_00565560(&local_10,iVar9);
        if (cVar6 != '\0') {
          FUN_005d5030(&local_10);
        }
        if (local_10 != 0) {
          return;
        }
        if (local_c == (undefined **)0x0) {
          return;
        }
        FUN_00524240();
        return;
      }
      uVar4 = *(undefined4 *)(in_ECX + 4);
      (**(code **)(PTR_PTR_00d65e48 + 4))(uVar4);
      local_c = &PTR_PTR_00d65e48;
      uStack_8 = uVar4;
      FUN_005a1610(&stack0xffffffec,iVar9,&local_c);
      if (((unaff_EBX != 0) || (local_10 != 0)) &&
         ((FUN_005d5030(&stack0xffffffec), unaff_EBX == 0 && (local_10 != 0)))) {
        FUN_00524240();
      }
      if (local_c == (undefined **)0x0) {
        return;
      }
      (**(code **)(*local_c + 8))(uStack_8);
      return;
    }
    GRefCountImpl::Release(this);
  }
  in_ECX[4] = 0;
  in_ECX[5] = 0;
  in_ECX[6] = 0;
  in_ECX[7] = 0;
  *in_ECX = 0;
  return;
}



============================================================
DISASSEMBLY
============================================================
005d67b0 : SUB ESP,0x10
005d67b3 : PUSH EBX
005d67b4 : PUSH EBP
005d67b5 : PUSH ESI
005d67b6 : PUSH EDI
005d67b7 : MOV EDI,dword ptr [ESP + 0x24]
005d67bb : MOV EBP,dword ptr [EDI + 0x314]
005d67c1 : MOV ESI,ECX
005d67c3 : TEST EBP,EBP
005d67c5 : JNZ 0x005d67ca
005d67c7 : LEA EBP,[EDI + 0x28]
005d67ca : MOV EAX,dword ptr [EBP + 0x30]
005d67cd : SUB EAX,dword ptr [EBP + 0x2c]
005d67d0 : MOV byte ptr [EBP + 0x15],0x0
005d67d4 : CMP EAX,0x1
005d67d7 : JGE 0x005d67e0
005d67d9 : MOV ECX,EBP
005d67db : CALL 0x0053a0a0
005d67e0 : MOV EAX,dword ptr [EBP + 0x2c]
005d67e3 : MOV ECX,dword ptr [EBP + 0x3c]
005d67e6 : MOV CL,byte ptr [EAX + ECX*0x1]
005d67e9 : MOVZX EDX,CL
005d67ec : INC EAX
005d67ed : MOV dword ptr [EBP + 0x2c],EAX
005d67f0 : PUSH EDX
005d67f1 : LEA EBP,[EDI + 0x14]
005d67f4 : PUSH 0xb937c0
005d67f9 : PUSH EBP
005d67fa : MOV byte ptr [ESI],CL
005d67fc : MOV byte ptr [ESI + 0x1],0x0
005d6800 : CALL 0x0051d420
005d6805 : MOV AL,byte ptr [ESI]
005d6807 : ADD ESP,0xc
005d680a : TEST AL,AL
005d680c : JNZ 0x005d6849
005d680e : MOV EAX,dword ptr [ESP + 0x28]
005d6812 : PUSH EAX
005d6813 : LEA ECX,[ESP + 0x2c]
005d6817 : PUSH ECX
005d6818 : MOV ECX,EDI
005d681a : CALL 0x005a0260
005d681f : PUSH 0xb937b4
005d6824 : PUSH EBP
005d6825 : CALL 0x0051d420
005d682a : ADD ESP,0x8
005d682d : CMP byte ptr [ESP + 0x2b],0xff
005d6832 : JNC 0x005d6838
005d6834 : OR byte ptr [ESI + 0x1],0x2
005d6838 : MOV EDX,dword ptr [ESP + 0x28]
005d683c : MOV dword ptr [ESI + 0x4],EDX
005d683f : POP EDI
005d6840 : POP ESI
005d6841 : POP EBP
005d6842 : POP EBX
005d6843 : ADD ESP,0x10
005d6846 : RET 0x8
005d6849 : TEST AL,0x10
005d684b : JZ 0x005d6aa0
005d6851 : MOV ECX,dword ptr [EDI + 0x314]
005d6857 : TEST ECX,ECX
005d6859 : JNZ 0x005d685e
005d685b : LEA ECX,[EDI + 0x28]
005d685e : LEA EAX,[ESI + 0x10]
005d6861 : PUSH EAX
005d6862 : CALL 0x0053acd0
005d6867 : MOV EBX,dword ptr [EDI + 0x314]
005d686d : TEST EBX,EBX
005d686f : JNZ 0x005d6874
005d6871 : LEA EBX,[EDI + 0x28]
005d6874 : MOV ECX,dword ptr [EBX + 0x30]
005d6877 : SUB ECX,dword ptr [EBX + 0x2c]
005d687a : MOV byte ptr [EBX + 0x15],0x0
005d687e : CMP ECX,0x1
005d6881 : JGE 0x005d688a
005d6883 : MOV ECX,EBX
005d6885 : CALL 0x0053a0a0
005d688a : MOV EAX,dword ptr [EBX + 0x2c]
005d688d : MOV EDX,dword ptr [EBX + 0x3c]
005d6890 : MOV CL,byte ptr [EAX + EDX*0x1]
005d6893 : INC EAX
005d6894 : MOV dword ptr [EBX + 0x2c],EAX
005d6897 : MOVZX AX,CL
005d689b : MOVZX EBX,AX
005d689e : TEST BL,0x10
005d68a1 : JZ 0x005d68a7
005d68a3 : OR byte ptr [ESI + 0x1],0x1
005d68a7 : MOV ECX,dword ptr [0x00d73250]
005d68ad : PUSH 0x0
005d68af : AND EBX,0xf
005d68b2 : PUSH 0x14
005d68b4 : MOV dword ptr [ESP + 0x18],EBX
005d68b8 : CALL 0x00515840
005d68bd : TEST EAX,EAX
005d68bf : JZ 0x005d68de
005d68c1 : MOV CL,byte ptr [ESI + 0x1]
005d68c4 : AND CL,0x1
005d68c7 : MOV byte ptr [ESP + 0x24],CL
005d68cb : MOV EDX,dword ptr [ESP + 0x24]
005d68cf : MOVZX ECX,byte ptr [ESI]
005d68d2 : PUSH EDX
005d68d3 : PUSH EBX
005d68d4 : PUSH ECX
005d68d5 : MOV ECX,EAX
005d68d7 : CALL 0x005d5d30
005d68dc : JMP 0x005d68e0
005d68de : XOR EAX,EAX
005d68e0 : MOV dword ptr [ESI + 0x4],EAX
005d68e3 : TEST EAX,EAX
005d68e5 : JZ 0x005d6a8c
005d68eb : MOVZX ECX,word ptr [EAX + 0xa]
005d68ef : CMP CX,BX
005d68f2 : JNZ 0x005d6a85
005d68f8 : MOVZX ECX,word ptr [ESP + 0x10]
005d68fd : XOR EBX,EBX
005d68ff : MOV dword ptr [ESP + 0x24],ECX
005d6903 : TEST ECX,ECX
005d6905 : JLE 0x005d6945
005d6907 : ADD EAX,0xc
005d690a : LEA EBX,[EBX]
005d6910 : MOV EDX,dword ptr [ESP + 0x28]
005d6914 : MOV ECX,dword ptr [EAX]
005d6916 : PUSH EDX
005d6917 : LEA EBP,[EBX*0x8 + 0x0]
005d691e : PUSH EDI
005d691f : ADD ECX,EBP
005d6921 : CALL 0x005d4690
005d6926 : MOV EAX,dword ptr [ESI + 0x4]
005d6929 : MOV ECX,dword ptr [EAX + 0xc]
005d692c : ADD EAX,0xc
005d692f : CMP byte ptr [ECX + EBP*0x1 + 0x7],0xff
005d6934 : JNC 0x005d693a
005d6936 : OR byte ptr [ESI + 0x1],0x2
005d693a : INC EBX
005d693b : CMP EBX,dword ptr [ESP + 0x24]
005d693f : JL 0x005d6910
005d6941 : MOV ECX,dword ptr [ESP + 0x24]
005d6945 : PUSH ECX
005d6946 : LEA EAX,[EDI + 0x14]
005d6949 : PUSH 0xb93794
005d694e : PUSH EAX
005d694f : CALL 0x0051d420
005d6954 : ADD ESP,0xc
005d6957 : CMP byte ptr [ESI],0x13
005d695a : JNZ 0x005d6982
005d695c : MOV ECX,EDI
005d695e : CALL 0x00500140
005d6963 : MOVSX EDX,AX
005d6966 : MOV EAX,dword ptr [ESI + 0x4]
005d6969 : MOV dword ptr [ESP + 0x28],EDX
005d696d : FILD dword ptr [ESP + 0x28]
005d6971 : FMUL double ptr [0x00b86f00]
005d6977 : FSTP float ptr [ESP + 0x28]
005d697b : FLD float ptr [ESP + 0x28]
005d697f : FSTP float ptr [EAX + 0x10]
005d6982 : MOV EAX,dword ptr [EDI + 0x20]
005d6985 : MOV EBX,dword ptr [EAX + 0x108]
005d698b : LEA ECX,[EBX + 0x1]
005d698e : MOV dword ptr [EAX + 0x108],ECX
005d6994 : MOV EAX,dword ptr [EDI + 0x20]
005d6997 : LEA ECX,[EAX + 0x4c]
005d699a : MOV EAX,dword ptr [ECX]
005d699c : NEG EAX
005d699e : SBB EAX,EAX
005d69a0 : AND EAX,ECX
005d69a2 : JZ 0x005d69fe
005d69a4 : TEST byte ptr [EAX + 0x10],0x2
005d69a8 : JZ 0x005d69fe
005d69aa : PUSH ECX
005d69ab : XOR EBP,EBP
005d69ad : MOV EAX,ESP
005d69af : MOV dword ptr [ESP + 0x14],EBP
005d69b3 : MOV dword ptr [ESP + 0x18],EBP
005d69b7 : MOV dword ptr [EAX],EBX
005d69b9 : MOV EDI,dword ptr [EDI + 0x20]
005d69bc : LEA EDX,[ESP + 0x14]
005d69c0 : PUSH EDX
005d69c1 : MOV ECX,EDI
005d69c3 : CALL 0x00565560
005d69c8 : TEST AL,AL
005d69ca : JZ 0x005d69d9
005d69cc : LEA EAX,[ESP + 0x10]
005d69d0 : PUSH EAX
005d69d1 : LEA ECX,[ESI + 0x8]
005d69d4 : CALL 0x005d5030
005d69d9 : CMP dword ptr [ESP + 0x10],EBP
005d69dd : JNZ 0x005d6b15
005d69e3 : MOV ECX,dword ptr [ESP + 0x14]
005d69e7 : CMP ECX,EBP
005d69e9 : JZ 0x005d6b15
005d69ef : CALL 0x00524240
005d69f4 : POP EDI
005d69f5 : POP ESI
005d69f6 : POP EBP
005d69f7 : POP EBX
005d69f8 : ADD ESP,0x10
005d69fb : RET 0x8
005d69fe : MOV EBP,dword ptr [ESI + 0x4]
005d6a01 : MOV EDX,dword ptr [0x00d65e48]
005d6a07 : MOV EAX,dword ptr [EDX + 0x4]
005d6a0a : PUSH EBP
005d6a0b : MOV ECX,0xd65e48
005d6a10 : CALL EAX
005d6a12 : LEA ECX,[ESP + 0x18]
005d6a16 : PUSH ECX
005d6a17 : PUSH ECX
005d6a18 : MOV EAX,ESP
005d6a1a : LEA EDX,[ESP + 0x18]
005d6a1e : MOV dword ptr [ESP + 0x20],0xd65e48
005d6a26 : MOV dword ptr [ESP + 0x24],EBP
005d6a2a : PUSH EDX
005d6a2b : MOV ECX,EDI
005d6a2d : MOV dword ptr [EAX],EBX
005d6a2f : CALL 0x005a1610
005d6a34 : CMP dword ptr [ESP + 0x10],0x0
005d6a39 : JNZ 0x005d6a42
005d6a3b : CMP dword ptr [ESP + 0x14],0x0
005d6a40 : JZ 0x005d6a63
005d6a42 : LEA EAX,[ESP + 0x10]
005d6a46 : PUSH EAX
005d6a47 : LEA ECX,[ESI + 0x8]
005d6a4a : CALL 0x005d5030
005d6a4f : CMP dword ptr [ESP + 0x10],0x0
005d6a54 : JNZ 0x005d6a63
005d6a56 : MOV ECX,dword ptr [ESP + 0x14]
005d6a5a : TEST ECX,ECX
005d6a5c : JZ 0x005d6a63
005d6a5e : CALL 0x00524240
005d6a63 : MOV ECX,dword ptr [ESP + 0x18]
005d6a67 : TEST ECX,ECX
005d6a69 : JZ 0x005d6b15
005d6a6f : MOV EDX,dword ptr [ECX]
005d6a71 : MOV EAX,dword ptr [ESP + 0x1c]
005d6a75 : MOV EDX,dword ptr [EDX + 0x8]
005d6a78 : PUSH EAX
005d6a79 : CALL EDX
005d6a7b : POP EDI
005d6a7c : POP ESI
005d6a7d : POP EBP
005d6a7e : POP EBX
005d6a7f : ADD ESP,0x10
005d6a82 : RET 0x8
005d6a85 : MOV ECX,EAX
005d6a87 : CALL 0x004ff7e0
005d6a8c : MOV dword ptr [ESI + 0x4],0x0
005d6a93 : MOV byte ptr [ESI],0x0
005d6a96 : POP EDI
005d6a97 : POP ESI
005d6a98 : POP EBP
005d6a99 : POP EBX
005d6a9a : ADD ESP,0x10
005d6a9d : RET 0x8
005d6aa0 : TEST AL,0x40
005d6aa2 : JZ 0x005d6b15
005d6aa4 : MOV ECX,EDI
005d6aa6 : CALL 0x00500140
005d6aab : MOVZX EBX,AX
005d6aae : MOVZX EAX,BX
005d6ab1 : PUSH EAX
005d6ab2 : PUSH 0xb93780
005d6ab7 : PUSH EBP
005d6ab8 : CALL 0x0051d420
005d6abd : ADD ESP,0x8
005d6ac0 : MOV EAX,ESP
005d6ac2 : LEA EDX,[ESI + 0x8]
005d6ac5 : MOV dword ptr [EAX],EBX
005d6ac7 : MOV ECX,dword ptr [EDI + 0x20]
005d6aca : PUSH EDX
005d6acb : CALL 0x00565560
005d6ad0 : TEST AL,AL
005d6ad2 : JZ 0x005d6af9
005d6ad4 : MOV ECX,dword ptr [EDI + 0x2c0]
005d6ada : TEST ECX,ECX
005d6adc : JZ 0x005d6af9
005d6ade : MOV AL,byte ptr [ESI]
005d6ae0 : CMP AL,0x42
005d6ae2 : JZ 0x005d6ae8
005d6ae4 : CMP AL,0x40
005d6ae6 : JNZ 0x005d6af9
005d6ae8 : MOV EAX,dword ptr [ESI + 0xc]
005d6aeb : LEA EDX,[ESP + 0x28]
005d6aef : PUSH EDX
005d6af0 : MOV dword ptr [ESP + 0x2c],EAX
005d6af4 : CALL 0x005d65b0
005d6af9 : MOV EAX,dword ptr [EDI + 0x314]
005d6aff : TEST EAX,EAX
005d6b01 : JNZ 0x005d6b06
005d6b03 : LEA EAX,[EDI + 0x28]
005d6b06 : LEA ECX,[ESI + 0x10]
005d6b09 : PUSH ECX
005d6b0a : MOV ECX,EAX
005d6b0c : CALL 0x0053acd0
005d6b11 : OR byte ptr [ESI + 0x1],0x2
005d6b15 : POP EDI
005d6b16 : POP ESI
005d6b17 : POP EBP
005d6b18 : POP EBX
005d6b19 : ADD ESP,0x10
005d6b1c : RET 0x8
